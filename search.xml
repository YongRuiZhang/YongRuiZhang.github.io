<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>搭建Hadoop HA(高可用)集群</title>
      <link href="/posts/3297135020.html"/>
      <url>/posts/3297135020.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hadoop-HA-高可用"><a href="#Hadoop-HA-高可用" class="headerlink" title="Hadoop HA 高可用"></a>Hadoop HA 高可用</h1><h2 id="HA-概述"><a href="#HA-概述" class="headerlink" title="HA 概述"></a>HA 概述</h2><ol><li>所谓 HA（High Availablity），即高可用（7*24 小时不中断服务）</li><li>实现高可用最关键的策略是<strong>消除单点故障</strong>。HA 严格来说应该分成各个组件的 HA机制：HDFS-HA 和 YARN-HA</li><li>NameNode 主要在以下两个方面影响 HDFS 集群<ul><li>NameNode 机器发生意外，例如宕机，集群将无法使用，直到管理员重启</li><li>NameNode 机器需要升级，包括软件、硬件升级，此时集群也将无法使用</li></ul></li></ol><p>HDFS HA 功能通过配置多个 NameNodes(Active/Standby)实现在集群中对 NameNode 的热备来解决上述问题。如果出现故障，如机器崩溃或机器需要升级维护，这时可通过此种方式将 NameNode 很快的切换到另外一台机器。 </p><h2 id="HDFS-HA集群搭建"><a href="#HDFS-HA集群搭建" class="headerlink" title="HDFS-HA集群搭建"></a>HDFS-HA集群搭建</h2><p>当前HDFS集群的规划：</p><div class="table-container"><table><thead><tr><th></th><th>1 号服务器</th><th>2 号服务器</th><th>3 号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode</td><td>DataNode</td><td>SecondaryNameNode、DataNode</td></tr></tbody></table></div><p>HA 的主要目的是消除 NameNode 的<strong>单点故障</strong>,需要将 hdfs 集群规划成以下模样: </p><div class="table-container"><table><thead><tr><th></th><th>1 号服务器</th><th>2 号服务器</th><th>3 号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode</td><td><strong>NameNode</strong>、DataNode</td><td><strong>NameNode</strong>、DataNode</td></tr></tbody></table></div><h3 id="HDFS-HA-核心问题"><a href="#HDFS-HA-核心问题" class="headerlink" title="HDFS-HA 核心问题"></a>HDFS-HA 核心问题</h3><ol><li><p>怎么保证三台 namenode 的数据一致</p><p>答：</p><ul><li>Fsimage:让一台 NameNode 生成数据,让其他机器的 NameNode 同步</li><li>Edits:需要引进新的模块 JournalNode 来保证 edtis 的文件的数据一致性</li></ul><p>相当于其他机器的NameNode在主机NameNode存活时充当类似于SecondaryNameNode的角色。</p></li><li><p>怎么让同时只有一台 NameNode 是 active，其他所有的机器的NameNode都是 standby 的</p><p>两种策略：</p><ul><li>手动分配 </li><li>自动分配</li></ul></li><li><p>SecondaryNameNode 在 HA 架构中并不存在，定期合并 fsimage 和 edtis 的活谁来干</p><p>答：由 standby 的 NameNode 来干 </p></li><li><p>如果 NameNode 真的发生了问题，怎么让其他的 NameNode 上位干活 </p><ul><li>手动故障转移</li><li>自动股炸转移</li></ul></li></ol><h3 id="HDFS-HA手动模式"><a href="#HDFS-HA手动模式" class="headerlink" title="HDFS-HA手动模式"></a>HDFS-HA手动模式</h3><h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h4><ol><li>修改 IP </li><li>修改主机名及主机名和 IP 地址的映射 </li><li>关闭防火墙 </li><li>ssh 免密登录 </li><li>安装 JDK，配置环境变量等</li></ol><p>以上步骤在搭建集群时应该已经做过了，主要是检查一下，降低后续出错概率。</p><h4 id="规划集群"><a href="#规划集群" class="headerlink" title="规划集群"></a>规划集群</h4><div class="table-container"><table><thead><tr><th></th><th>1 号服务器</th><th>2 号服务器</th><th>3 号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode、<strong>JournalNode</strong></td><td><strong>NameNode</strong>、DataNode、<strong>JournalNode</strong></td><td><strong>NameNode</strong>、DataNode、<strong>JournalNode</strong></td></tr></tbody></table></div><h4 id="配置HDFS-HA集群"><a href="#配置HDFS-HA集群" class="headerlink" title="配置HDFS-HA集群"></a>配置HDFS-HA集群</h4><h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><p>建议在搭建HA集群时将原本的集群拷贝一份，这样如果搭建失败原本的集群仍可继续使用。</p><p>我原本的Hadoop位置为：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2009.32.34.png" alt="截屏2023-05-17 09.32.34" style="zoom:50%;" /></p><p>先拷贝到ha目录下：</p><ul><li><p>新建ha目录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local$ sudo <span class="built_in">mkdir</span> ha</span><br></pre></td></tr></table></figure></li><li><p>修改ha目录权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local$ sudo <span class="built_in">chown</span> hadoop103:hadoop103 ha</span><br></pre></td></tr></table></figure></li><li><p>将原集群文件拷贝过来</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local$ <span class="built_in">cp</span> -r hadoop/ ha/</span><br></pre></td></tr></table></figure></li></ul><p>这样新的集群文件路径为：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2009.37.03.png" alt="截屏2023-05-17 09.37.03" style="zoom:50%;" /></p><p>删除data和logs目录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ <span class="built_in">rm</span> -rf data/ logs/</span><br></pre></td></tr></table></figure><p>这一步的效果：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2009.39.04.png" alt="截屏2023-05-17 09.39.04" style="zoom:50%;" /></p><h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><blockquote><p>  这里的修改是把原本的配置删除，写入下面的配置</p></blockquote><ul><li><p>core-site.xml</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ <span class="built_in">cd</span> etc/hadoop/</span><br><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop/etc/hadoop$ vim core-site.xml</span><br></pre></td></tr></table></figure><p>vim打开文件后，修改<code>&lt;configuration&gt;&lt;/configuration&gt;</code>内的内容，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 把多个 NameNode 的地址组装成一个集群 myhacluster --&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://myhacluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 hadoop 运行时产生文件的存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/ha/hadoop/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure><p>内容写好后按 <kbd>esc</kbd>,再输入<code>:wq</code>保存退出。</p></li><li><p>pdfs-site.xml</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop/etc/hadoop$ vim hdfs-site.xml</span><br></pre></td></tr></table></figure><p>vim打开文件后，修改<code>&lt;configuration&gt;&lt;/configuration&gt;</code>内的内容，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- NameNode 数据存储目录 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- DataNode 数据存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- JournalNode 数据存储目录 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;hadoop.tmp.dir&#125;/jn<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 完全分布式集群名称 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>myhacluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 集群中 NameNode 节点都有哪些 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.myhacluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>nn1,nn2,nn3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- NameNode 的 RPC 通信地址 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.myhacluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.myhacluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.myhacluster.nn3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- NameNode 的 http 通信地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.myhacluster.nn1<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.myhacluster.nn2<span class="tag">&lt;/<span class="name">name</span>&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.myhacluster.nn3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 NameNode 元数据在 JournalNode 上的存放位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://hadoop103:8485;hadoop104:8485;hadoop105:8485/myhacluster<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 访问代理类：client 用于确定哪个 NameNode 为 Active --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.myhacluster<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 关闭检查权限 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置隔离机制，即同一时刻只能有一台服务器对外响应 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>sshfence<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>shell(true)<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 使用隔离机制时需要 ssh 秘钥登录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop103/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure></li></ul><h5 id="分发ha目录下的hadoop文件"><a href="#分发ha目录下的hadoop文件" class="headerlink" title="分发ha目录下的hadoop文件"></a>分发ha目录下的hadoop文件</h5><ul><li><p>分别在hadoop104、hadoop105下创建ha目录并修改权限</p><p>hadoop104:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop104@hadoop104:/usr/local$ sudo <span class="built_in">mkdir</span> ha</span><br><span class="line">hadoop104@hadoop104:/usr/local$ sudo <span class="built_in">chown</span> hadoop104:hadoop104 ha</span><br></pre></td></tr></table></figure><p>hadoop105:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:/usr/local$ sudo <span class="built_in">mkdir</span> ha</span><br><span class="line">hadoop105@hadoop105:/usr/local$ sudo <span class="built_in">chown</span> hadoop105:hadoop105 ha</span><br></pre></td></tr></table></figure></li><li><p>在hadoop103上执行分发脚本命令</p><p>如果你还没有集群分发脚本命令，可参看：<a href="/posts/3772089482.html" title="集群分发脚本">集群分发脚本</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha$ xsync hadoop/</span><br></pre></td></tr></table></figure></li></ul><p>最好再到hadoop104、hadoop105查看是否分发成功。</p><p><strong>分发成功后有一个地方需要修改：</strong></p><p>在hdfs-site.xml文件的最后：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用隔离机制时需要 ssh 秘钥登录--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop103/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的<code>/home/hadoop103/.ssh/id_rsa</code>需要修改。</p><ul><li>hadoop104修改为<code>/home/hadoop104/.ssh/id_rsa</code></li><li>hadoop105修改为<code>/home/hadoop105/.ssh/id_rsa</code></li></ul><h4 id="启动HDFS-HA集群"><a href="#启动HDFS-HA集群" class="headerlink" title="启动HDFS-HA集群"></a>启动HDFS-HA集群</h4><blockquote><p>  注意，启动前先关闭原本的hadoop集群</p></blockquote><ol><li><p>先去修改环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p>将 HADOOP_HOME 部分改为如下(其实就是把原本的/usr/local/hadoop改成/usr/local/ha/hadoop):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/local/ha/hadoop</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin </span><br></pre></td></tr></table></figure><p>内容修改好后按 <kbd>esc</kbd>,再输入<code>:wq</code>保存退出。</p><p>环境变量生效：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><blockquote><p>  注意：三台机器都要这样修改，否则集群启动时可能会调用原本集群的配置。</p></blockquote></li><li><p>启动JournalNode服务</p><p>hadoop103:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ hdfs --daemon start journalnode</span><br></pre></td></tr></table></figure><p>hadoop104:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop104@hadoop104:/usr/local/ha/hadoop$ hdfs --daemon start journalnode</span><br></pre></td></tr></table></figure><p>hadoop105:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:/usr/local/ha/hadoop$ hdfs --daemon start journalnode</span><br></pre></td></tr></table></figure><p>在初次启动时有这样的警告：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING: /usr/local/ha/hadoop/logs does not exist. Creating.</span><br></pre></td></tr></table></figure><p>这个不用管它，它说的是没有logs文件（本来就还没有，它提示它创建了）</p><p>启动好后检查一下：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2010.34.37.png" alt="截屏2023-05-17 10.34.37" style="zoom:50%;" /></p></li><li><p>在 nn1 (hadoop103) 上格式化hadoop，并启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ hdfs namenode -format</span><br><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ hdfs --daemon start namenode</span><br></pre></td></tr></table></figure><p>检查一下是否启动：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2010.35.50.png" alt="截屏2023-05-17 10.35.50" style="zoom:50%;" /></p></li><li><p>在 nn2（hadoop104）和nn3（hadoop105）上，同步nn1的元数据信息</p><blockquote><p>  执行前一定要先启动nn1——NameNode</p></blockquote><p>hadoop104:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop104@hadoop104:/usr/local/ha/hadoop$ hdfs namenode -bootstrapStandby</span><br></pre></td></tr></table></figure><p>hadoop105:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:/usr/local/ha/hadoop$ hdfs namenode -bootstrapStandby</span><br></pre></td></tr></table></figure></li><li><p>启动 nn2 和 nn3：</p><p>hadoop104:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop104@hadoop104:/usr/local/ha/hadoop$ hdfs --daemon start namenode</span><br></pre></td></tr></table></figure><p>hadoop105:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:/usr/local/ha/hadoop$ hdfs --daemon start namenode </span><br></pre></td></tr></table></figure><p>检查是否启动成功：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2011.49.38.png" alt="截屏2023-05-17 11.49.38" style="zoom:50%;" /></p><p>如图则成功。</p></li><li><p>查看web页面</p><p>访问<a href="http://hadoop103:9870、http://hadoop104:9870、http://hadoop105:9870">http://hadoop103:9870、http://hadoop104:9870、http://hadoop105:9870</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2015.44.55.png" alt="截屏2023-05-17 15.44.55" style="zoom: 33%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2015.45.23.png" alt="截屏2023-05-17 15.45.23" style="zoom:33%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2015.45.53.png" alt="截屏2023-05-17 15.45.53" style="zoom:33%;" /></p><p>如图可以看出：</p><ol><li>hadoop103、hadoop104、hadoop105都是standby的状态。</li><li>可以看到集群名称空间为：myhacluster，是我们想要设置的。</li><li>Namenode ID:分别也是nn1、nn2、nn3。</li><li>同样还有其他信息，可以检查。</li></ol></li><li><p>所有服务器启动datanode</p><p>hadoop103:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ hdfs --daemon start datanode</span><br></pre></td></tr></table></figure><p>hadoop104:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop104@hadoop104:/usr/local/ha/hadoop$ hdfs --daemon start datanode</span><br></pre></td></tr></table></figure><p>hadoop105:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:/usr/local/ha/hadoop$ hdfs --daemon start datanode</span><br></pre></td></tr></table></figure><p>启动后检查是否成功启动：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2015.55.20.png" alt="截屏2023-05-17 15.55.20" style="zoom: 50%;" /></p></li><li><p>将 nn1 切换为 Active</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ hdfs haadmin -transitionToActive nn1</span><br></pre></td></tr></table></figure><p>此时查看hadoop103的web端：<a href="http://hadoop103:9870">http://hadoop103:9870</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2015.56.58.png" alt="截屏2023-05-17 15.56.58"></p><p>可以看到状态已经变成Active了。</p><p>也可以通过命令查看是否为Active：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ hdfs haadmin -getServiceState nn1</span><br></pre></td></tr></table></figure><p>结果如图：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2015.58.36.png" alt="截屏2023-05-17 15.58.36" style="zoom:50%;" /></p><p>也可验证状态修改成功。</p></li></ol><h3 id="HDFS-HA自动模式"><a href="#HDFS-HA自动模式" class="headerlink" title="HDFS-HA自动模式"></a>HDFS-HA自动模式</h3><h4 id="HDFS-HA自动故障转移工作机制"><a href="#HDFS-HA自动故障转移工作机制" class="headerlink" title="HDFS- HA自动故障转移工作机制"></a>HDFS- HA自动故障转移工作机制</h4><p>自动故障转移为 HDFS 部署增加了两个新组件：ZooKeeper 和 ZKFailoverController（ZKFC）</p><blockquote><p>  Zookeeper集群搭建参看：<a href="/posts/983786067.html" title="搭建Zookeeper集群">搭建Zookeeper集群</a></p></blockquote><p>如图所示:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2016.00.34.png" alt="截屏2023-05-17 16.00.34" style="zoom: 25%;" /></p><p>ZooKeeper 是维护少量协调数据，通知客户端这些数据的改变和监视客户端故障的高可用服务。</p><h4 id="HDFS-HA自动故障转移的集群配置规划"><a href="#HDFS-HA自动故障转移的集群配置规划" class="headerlink" title="HDFS-HA自动故障转移的集群配置规划"></a>HDFS-HA自动故障转移的集群配置规划</h4><div class="table-container"><table><thead><tr><th></th><th>1 号服务器</th><th>2 号服务器</th><th>3 号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode、<strong>JournalNode</strong>、<strong>Zookeeper</strong>、<strong>ZKFC</strong></td><td><strong>NameNode</strong>、DataNode、<strong>JournalNode</strong>、<strong>Zookeeper</strong>、<strong>ZKFC</strong></td><td><strong>NameNode</strong>、DataNode、<strong>JournalNode</strong>、<strong>Zookeeper</strong>、<strong>ZKFC</strong></td></tr></tbody></table></div><h4 id="HDFS-HA自动故障转移"><a href="#HDFS-HA自动故障转移" class="headerlink" title="HDFS-HA自动故障转移"></a>HDFS-HA自动故障转移</h4><ol><li><p>修改配置</p><blockquote><p>  注意：一下修改配置都是在原配置文件中<strong>添加</strong>以下内容。</p></blockquote><ul><li><p>hdfs-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 启用 nn 故障自动转移 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>core-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定 zkfc 要连接的 zkServer 地址 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:2181,hadoop104:2181,hadoop105:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>利用分发脚本分发配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ xsync etc/hadoop/hdfs-site.xml etc/hadoop/core-site.xml</span><br></pre></td></tr></table></figure><blockquote><p>  hadoop104和hadoop105的hdfs-site.xml中需要修改内容：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用隔离机制时需要 ssh 秘钥登录--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop103/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  这里的<code>/home/hadoop103/.ssh/id_rsa</code>需要修改。</p><ul><li>hadoop104修改为<code>/home/hadoop104/.ssh/id_rsa</code></li><li>hadoop105修改为<code>/home/hadoop105/.ssh/id_rsa</code></li></ul></blockquote></li><li><p>启动</p><blockquote><p>  启动前先关闭所有的HDFS服务：</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:/usr/local/ha/hadoop$ myhadoop stop</span><br></pre></td></tr></table></figure><p>  检查是否成功关闭：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-17%2016.22.34.png" alt="截屏2023-05-17 16.22.34" style="zoom:33%;" /></p></blockquote><ul><li><p>启动Zookeeper集群</p><blockquote><p>  Zookeeper集群搭建参看：<a href="/posts/983786067.html" title="搭建Zookeeper集群">搭建Zookeeper集群</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:~$ zk start</span><br></pre></td></tr></table></figure><p>检查启动状态：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-18%2018.09.13.png" alt="截屏2023-05-18 18.09.13" style="zoom:33%;" /></p></li><li><p>成功启动Zookeeper后，再初始化HA在Zookeeper中的状态：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:~$ hdfs zkfc -formatZK</span><br></pre></td></tr></table></figure></li><li><p>启动HDFS服务：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:~$ start-dfs.sh</span><br></pre></td></tr></table></figure><p>启动后检查一下状态：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-18%2018.15.02.png" alt="截屏2023-05-18 18.15.02" style="zoom:50%;" /></p></li><li><p>去zkCli（Zookeeper的客户端）查看NameNode选举锁节点的内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:~$ <span class="variable">$ZOOKEEPER_HOME</span>/bin/zkCli.sh</span><br></pre></td></tr></table></figure><p>客户端中输入 <code>get -s /hadoop-ha/myhacluster/ActiveStandbyElectorLock</code> 查看集群选举状态：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-18%2018.23.49.png" alt="截屏2023-05-18 18.23.49" style="zoom:50%;" /></p><p>从 <code>myhaclusternn3    hadoop105</code> 可以看出：选举的Active节点是集群中的nn3节点，即hadoop105。</p><p>可分别访问<a href="http://hadoop103:9870、http://hadoop104:9870、http://hadoop105:9870">http://hadoop103:9870、http://hadoop104:9870、http://hadoop105:9870</a></p><p>检查后的确如此（我这里就不贴图了）。</p></li><li><p>验证是否可以故障转移</p><p>通过<code>jpsall</code>命令查看所有进程的进程号：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-18%2018.27.09.png" alt="截屏2023-05-18 18.27.09"></p><p>这里可以看到hadoop105中的NameNode的进程号为：26598。</p><p>结束这个进程(在hadoop105中)：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop105@hadoop105:~$ <span class="built_in">kill</span> -9 26598</span><br></pre></td></tr></table></figure><p>此时jpsall查看后hadoop105的NameNode服务就停止了。再次查看新的Active节点是谁（重复上一步的步骤）结果为：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-18%2018.30.02.png" alt="截屏2023-05-18 18.30.02"></p><p>从 <code>myhaclusternn1    hadoop103</code> 可以看出，新选举出的Active节点是集群中的nn1，即hadoop103。这样就可以验证自动故障转移成功了。</p><p>当然也可以去Web端查看验证：分别访问：<a href="http://hadoop103:9870、http://hadoop104:9870、http://hadoop105:9870">http://hadoop103:9870、http://hadoop104:9870、http://hadoop105:9870</a></p><p>理论情况就是hadoop103的状态变为Active、hadoop104还是StandBy、hadoop105访问不上。</p></li></ul></li></ol><h2 id="YARN-HA集群搭建"><a href="#YARN-HA集群搭建" class="headerlink" title="YARN-HA集群搭建"></a>YARN-HA集群搭建</h2><h3 id="YARN-HA核心问题"><a href="#YARN-HA核心问题" class="headerlink" title="YARN-HA核心问题"></a>YARN-HA核心问题</h3><ul><li>如果当前 active ResourceManager 挂了，怎么将其他 standby ResourceManager 上位？<br>答：核心原理跟 hdfs 一样，利用了 Zookeeper 的临时节点。</li><li>当前 ResourceManager 上有很多的计算程序在等待运行,其他的 ResourceManager 怎么将这些程序接手过来接着跑？<br>答：ResourceManager 会将当前的所有计算程序的状态存储在 Zookeeper 中,其他 ResourceManager 上位后会去读取，然后接着跑。</li></ul><h3 id="YARN-HA规划集群"><a href="#YARN-HA规划集群" class="headerlink" title="YARN-HA规划集群"></a>YARN-HA规划集群</h3><div class="table-container"><table><thead><tr><th></th><th>1 号服务器</th><th>2 号服务器</th><th>3 号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>YARN</td><td>NodeManager、<strong>ResourceManager</strong></td><td>ResourceManager、NodeManager</td><td>NodeManager、<strong>ResourceManager</strong></td></tr></tbody></table></div><h3 id="YARN-HA具体配置"><a href="#YARN-HA具体配置" class="headerlink" title="YARN-HA具体配置"></a>YARN-HA具体配置</h3><p>在hadoop103上修改yarn-site.xml文件内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop/etc/hadoop$ vim yarn-site.xml</span><br></pre></td></tr></table></figure><p>将yarn-site.xml文件内容修改为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 启用 resourcemanager ha --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 声明两台 resourcemanager 的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>cluster-yarn1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--指定 resourcemanager 的逻辑列表--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2,rm3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ========== rm1 的配置 ========== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm1 的主机名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm1 的 web 端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm1 的内部通信地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 AM 向 rm1 申请资源的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定供 NM 连接的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ========== rm2 的配置 ========== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm2 的主机名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm2 的 web 端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm2 的内部通信地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 AM 向 rm2 申请资源的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定供 NM 连接的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ========== rm3 的配置 ========== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm3 的主机名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm3 的 web 端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 rm3 的内部通信地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 AM 向 rm3 申请资源的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:8030<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定供 NM 连接的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.resource-tracker.address.rm3<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:8031<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 zookeeper 集群的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:2181,hadoop104:2181,hadoop105:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 启用自动恢复 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.recovery.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 resourcemanager 的状态信息存储在 zookeeper 集群 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.store.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 环境变量的继承 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure><p>按<kbd>esc</kbd>kbd&gt;之后输入<code>:wq</code>保存退出。</p><p>将配置文件分发出去：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop/etc/hadoop$ xsync yarn-site.xml</span><br></pre></td></tr></table></figure><h3 id="启动YARN"><a href="#启动YARN" class="headerlink" title="启动YARN"></a>启动YARN</h3><ol><li><p>在hadoop103下执行:</p><blockquote><p>  在启动前一定要先启动 Zookeeper 集群</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ start-yarn.sh</span><br></pre></td></tr></table></figure><p>查看启动情况：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-19%2013.05.06.png" alt="截屏2023-05-19 13.05.06" style="zoom: 50%;" /></p></li><li><p>查看服务状态：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ yarn rmadmin -getServiceState rm1</span><br></pre></td></tr></table></figure><p>结果为：standby。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ yarn rmadmin -getServiceState rm2</span><br></pre></td></tr></table></figure><p>结果为：active。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ yarn rmadmin -getServiceState rm3</span><br></pre></td></tr></table></figure><p>结果为：standby。</p><p>整体如图：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-19%2013.07.52.png" alt="截屏2023-05-19 13.07.52" style="zoom:50%;" /></p></li><li><p>去Zookeeper客户端查看ResourceManager选举锁节点内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/ha/hadoop$ <span class="variable">$ZOOKEEPER_HOME</span>/bin/zkCli.sh</span><br></pre></td></tr></table></figure><p>输入：<code>get -s /yarn-leader-election/cluster-yarn1/ActiveStandbyElectorLock</code></p><p>效果如图：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-05-19%2013.11.57.png" alt="截屏2023-05-19 13.11.57" style="zoom:50%;" /></p><p>从 <code>cluster-yarn1rm2</code> 可以看出：当前YARN-HA集群多Active节点为rm2。</p></li><li><p>web端查看YARN的状态</p><p>访问：<a href="http://hadoop103:8088、http://hadoop104:8088、http://hadoop105:8088">http://hadoop103:8088、http://hadoop104:8088、http://hadoop105:8088</a></p></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>两者都搭建好后就是Hadoop-HA集群了，即Hadoop高可用集群。</p><p>搭建好后集群最终效果：</p><div class="table-container"><table><thead><tr><th></th><th>1 号服务器</th><th>2 号服务器</th><th>3 号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode、<strong>JournalNode</strong>、<strong>Zookeeper</strong>、<strong>ZKFC</strong></td><td><strong>NameNode</strong>、DataNode、<strong>JournalNode</strong>、<strong>Zookeeper</strong>、<strong>ZKFC</strong></td><td><strong>NameNode</strong>、DataNode、<strong>JournalNode</strong>、<strong>Zookeeper</strong>、<strong>ZKFC</strong></td></tr><tr><td>YARN</td><td>NodeManager、<strong>ResourceManager</strong></td><td>ResourceManager、NodeManager</td><td>NodeManager、<strong>ResourceManager</strong></td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis笔记</title>
      <link href="/posts/3213899550.html"/>
      <url>/posts/3213899550.html</url>
      
        <content type="html"><![CDATA[<details>此笔记是我学习 B站 尚硅谷相关课程的学习笔记</details><h1 id="一、课程大纲"><a href="#一、课程大纲" class="headerlink" title="一、课程大纲"></a>一、课程大纲</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824110521483.png" alt="image-20220824110521483"></p><h1 id="二、安装、启动与关闭"><a href="#二、安装、启动与关闭" class="headerlink" title="二、安装、启动与关闭"></a>二、安装、启动与关闭</h1><p>安装去网上学。<a href="https://blog.51cto.com/niuben/5203089">https://blog.51cto.com/niuben/5203089</a></p><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>启动服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service start redis</span><br></pre></td></tr></table></figure><p>启动客户端：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br></pre></td></tr></table></figure><p>多个端口启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379</span><br></pre></td></tr></table></figure><p>测试：<code>ping</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824110903208.png" alt="image-20220824110903208"></p><p>查看运行状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure><h2 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h2><p>单实例关闭客户端：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure><p>进入终端关闭</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824111046500.png" alt="image-20220824111046500"></p><p>多实例关闭，指定端口关闭：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379 shutdown</span><br></pre></td></tr></table></figure><p>关闭服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service stop redis</span><br></pre></td></tr></table></figure><h1 id="三、相关知识"><a href="#三、相关知识" class="headerlink" title="三、相关知识"></a>三、相关知识</h1><blockquote><p>端口：6379</p></blockquote><ul><li><p>默认16个数据库，类似数组下标从0开始，初始默认使用0号库。</p></li><li><p>使用命令 <code>select  &lt;dbid&gt;</code>来切换数据库。如: select 8 统一密码管理，所有库同样密码。</p></li><li><p><code>dbsize</code> 查看当前数据库的key的数量</p></li><li><p><code>flushdb</code> 清空当前库</p></li><li><p><code>flushall</code> 通杀全部库</p></li></ul><blockquote><p>Redis 是单线程+多路IO复用技术</p></blockquote><p>多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用select和poll函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）</p><p>与Memcache三点不同: 支持多数据类型，支持持久化，单线程+多路IO复用</p><h1 id="四、常用五大数据类型"><a href="#四、常用五大数据类型" class="headerlink" title="四、常用五大数据类型"></a>四、常用五大数据类型</h1><blockquote><p>常见数据类型操作命令：<a href="http://www.redis.cn/commands.html">http://www.redis.cn/commands.html</a></p></blockquote><h2 id="4-1、Redis-键（key）"><a href="#4-1、Redis-键（key）" class="headerlink" title="4.1、Redis 键（key）"></a>4.1、Redis 键（key）</h2><ul><li><code>keys *</code>：查看当前库所有key （匹配：<code>keys *1</code>）</li><li><code>exists &lt;key&gt;</code>：判断<code>&lt;key&gt;</code>是否存在</li><li><code>type &lt;key&gt;</code>：查看<code>&lt;key&gt;</code>的类型</li><li><code>del &lt;key&gt;</code>：删除指定的<code>&lt;key&gt;</code>的数据</li><li><code>unlink key</code>：根据<code>value</code>选择非阻塞删除。仅将keys冲keyspace元数据中删除，<strong>真正的删除会在后续异步操作</strong>。</li><li><code>expire &lt;key&gt; &lt;time&gt;</code>：设置<code>&lt;time&gt;</code>秒后<code>&lt;key&gt;</code>过期</li><li><code>ttl &lt;key&gt;</code>：查看<code>&lt;key&gt;</code>还有多少秒过期，-1表示永不过期，-2表示已过期</li></ul><hr><ul><li><code>select &lt;n&gt;</code>：切换到n号数据库</li><li><code>dbsize</code>：查看当前数据库的key的数量</li><li><code>flushdb</code>：清空<strong>当前</strong>数据库</li><li><code>flushall</code>：清空<strong>全部</strong>数据库</li></ul><h2 id="4-2、Redis字符串（String）"><a href="#4-2、Redis字符串（String）" class="headerlink" title="4.2、Redis字符串（String）"></a>4.2、Redis字符串（String）</h2><h3 id="4-2-1、简介"><a href="#4-2-1、简介" class="headerlink" title="4.2.1、简介"></a>4.2.1、简介</h3><p>String是Redis最基本的类型，可以理解成与Memcached一模一样的类型，一个key对应一个value。</p><p><strong>String类型是二进制安全的</strong>。意味着Redis的<strong>string可以包含任何数据</strong>。比如jpg图片或者序列化的对象。</p><p>String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是512M</p><h3 id="4-2-2、常用命令"><a href="#4-2-2、常用命令" class="headerlink" title="4.2.2、常用命令"></a>4.2.2、常用命令</h3><blockquote><p>增：<code>set</code>、<code>setnx</code>、<code>setex</code>、<code>append</code>、<code>mset</code>、<code>setrange</code></p><p>改：<code>getset</code>、<code>incr</code>、<code>decr</code>、<code>incrby</code>、<code>decrby</code>、<code>set</code>、<code>setex</code>、<code>setrange</code></p><p>查：<code>get</code>、<code>strlen</code>、<code>mget</code>、<code>getrange</code></p></blockquote><ul><li><p><code>set &lt;key&gt; &lt;value&gt;</code>：添加键值对</p><p>  ​    <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824162552062.png" alt="image-20220824162552062"></p><ul><li><p>NX：当数据库中key不存在时，可以将key-value添加到数据库</p></li><li><p>XX：当数据库中key存在时，可以将key-value添加到数据库，与NX参数互斥</p><p>  <strong>当key存在时，再设置这个key，相当于是修改这个key对应的键值</strong></p></li><li><p>EX：key的超时秒数</p></li><li><p>PX：key的超时毫秒数，与EX互斥</p></li></ul></li><li><p><code>get &lt;key&gt;</code>：查询<code>&lt;key&gt;</code>对应键值</p></li><li><p><code>append &lt;key&gt; &lt;value&gt;</code>：将给定的<code>&lt;value&gt;</code><strong>追加</strong>到原值的末尾，返回值是追加后字符串的长度</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824163129841.png" alt="image-20220824163129841"></p></li><li><p><code>strlen &lt;key&gt;</code>：获取<code>&lt;key&gt;</code>对应的键值的长度</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824163344231.png" alt="image-20220824163344231"></p></li><li><p><code>setnx &lt;key&gt; &lt;value&gt;</code>：只有 key 不存在时，才能设置key的值。相当于set命令带了NX参数</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824163600073.png" alt="image-20220824163600073"></p><hr></li></ul><blockquote><p>对数字类型的操作（如果value中没有字母只有数字就是数字类型）：</p><ul><li><p><code>incr &lt;key&gt;</code>：将 <code>&lt;key&gt;</code> 中存储的数字类型的值增1，<strong>只能对数字类型的值操作，如果为空，新增值为1</strong></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824164021139.png" alt="image-20220824164021139"></p></li><li><p><code>decr &lt;key&gt;</code>：将 <code>&lt;key&gt;</code> 中存储的数字类型的值减1，<strong>只能对数字类型的值操作，如果为空，新增值为-1</strong></p></li><li><p><code>incrby/decrby &lt;key&gt; &lt;step&gt;</code>：给<code>&lt;key&gt;</code>的数字值增加/减少<code>step</code></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824164344942.png" alt="image-20220824164344942"></p></li></ul><p>redis的操作是原子性的</p><p>所谓<strong>原子</strong>操作是指<strong>不会被线程调度机制打断的操作</strong>；</p><p>这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch （切换到另一个线程）。</p><ul><li>在单线程中， 能够在单条指令中完成的操作都可以认为是”原子操作”，因为中断只能发生于指令之间。</li><li>在多线程中，不能被其它进程（线程）打断的操作就叫原子操作。</li></ul><p>Redis单命令的原子性主要得益于Redis的单线程。</p></blockquote><hr><ul><li><p><code>mset &lt;key1&gt; &lt;value1&gt; &lt;key2&gt; &lt;value2&gt; &lt;key3&gt; &lt;value3&gt;...</code>：同时设置一个或多个key-value对</p></li><li><p><code>mget &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;...</code>：同时获取一个或多个key对应的value值</p></li><li><p><code>msetnx &lt;key1&gt; &lt;value1&gt; &lt;key2&gt; &lt;value2&gt;...</code>：同时设置一个或多个key-value对，当且仅当所有指定的key都不存在是才能添加成功。由于原子性，有一个失败则都失败</p></li><li><p><code>getrange &lt;key&gt; &lt;起始位置&gt; &lt;结束位置&gt;</code>：获取值的范围，类似于java中的substring方法，左右都是闭区间（<strong>索引从0开始</strong>）</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824170133260.png" alt="image-20220824170133260"></p></li><li><p><code>setrange &lt;key&gt; &lt;起始位置&gt; &lt;value&gt;</code>：用<code>value</code>覆写<code>&lt;key&gt;</code>所存储的字符串值，从<code>&lt;起始位置&gt;</code>开始（<strong>索引从1开始</strong>，将该位置之后的值都替换为<code>&lt;value&gt;</code>）</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824170441493.png" alt="image-20220824170441493"></p></li><li><p><code>setex &lt;key&gt; &lt;过期时间&gt; &lt;value&gt;</code>：设置键值的同时，设置过期的时间，单位是秒</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824170851446.png" alt="image-20220824170851446"></p></li><li><p><code>getset &lt;key&gt; &lt;value&gt;</code>：以新换旧，设置了新值同时获得（返回）旧值</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824170659272.png" alt="image-20220824170659272"></p></li></ul><h3 id="4-2-3、数据结构"><a href="#4-2-3、数据结构" class="headerlink" title="4.2.3、数据结构"></a>4.2.3、数据结构</h3><p>String的数据结构为<strong>简单动态字符串</strong>(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824165923342.png" alt="image-20220824165923342"></p><p>如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。</p><ul><li>当字符串长度小于1M时，扩容都是<strong>加倍</strong>现有的空间</li><li>如果超过1M，扩容时一次只会<strong>多扩1M</strong>的空间。</li></ul><p>需要注意的是字符串最大长度为512M。</p><h2 id="4-3、Redis-列表（List）"><a href="#4-3、Redis-列表（List）" class="headerlink" title="4.3、Redis 列表（List）"></a>4.3、Redis 列表（List）</h2><h3 id="4-3-1、简介"><a href="#4-3-1、简介" class="headerlink" title="4.3.1、简介"></a>4.3.1、简介</h3><blockquote><p><strong>单键多值</strong></p></blockquote><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p><p>它的底层实际是个<strong>双向链表</strong>，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824171151681.png" alt="image-20220824171151681"></p><h3 id="4-3-2、常用命令"><a href="#4-3-2、常用命令" class="headerlink" title="4.3.2、常用命令"></a>4.3.2、常用命令</h3><blockquote><p>增：<code>lpush</code>、<code>rpush</code>、<code>linsert</code>、<code>rpoplpush</code></p><p>删：<code>lpop</code>、<code>rpop</code>、<code>lrem</code></p><p>改：<code>lset</code></p><p>查：<code>lrange</code>、<code>lindex</code>、<code>llen</code></p></blockquote><ul><li><p><code>lpush/rpush &lt;key&gt; &lt;value1&gt; &lt;value2&gt; ...</code>：从 左边 / 右边 插入一个或多个值</p><p>  解释：起始对于单边来所，和栈差不多。但是是双边的，所以需要指定左或右。</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824171526999.png" alt="image-20220824171526999"></p><p>  注意点：</p><ul><li><code>lpush</code> 使得值都是从左边插入，也就是后面的值显示在前面，比如添加v1 v2 v3。但是查出来的结果是v3 v2 v1，顺序是反的</li><li>查询列表不能使用字符串的查询方式（<code>get</code>）</li><li>查询列表使用<code>lrang</code>命令（后几个命令中有）</li></ul></li><li><p><code>lpop/rpop &lt;key&gt;</code>：从 左边 / 右边 pop出一个值。<strong>值在键在，值光键亡</strong></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824172207743.png" alt="image-20220824172207743"></p></li><li><p><code>rpoplpush &lt;key1&gt; &lt;key2&gt;</code>：从<code>&lt;key1&gt;</code>列表右边吐出一个值，插入到<code>&lt;key2&gt;</code>列表右边</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824172436971.png" alt="image-20220824172436971"></p><p>  注意没有<code>lpoplpush</code>等其他组合了，只有这一个</p></li></ul><hr><ul><li><p><code>lrange &lt;key&gt; &lt;startIndex&gt; &lt;stopIndex&gt;</code>：按照索引，从左往右获得列表中的元素</p><p>  索引和Python类似，有两套索引机制，正数是左往右，负数是倒数几个，一般获取所有值：</p><p>  <code>lrange &lt;key&gt; 0 -1</code>：0 —— -1就是所有值</p><p>  注意，没有<code>rrange</code>。不掩饰了，很常用，前面也用到了的。</p></li><li><p><code>lindex &lt;key&gt; &lt;index&gt;</code>：按照索引下标获得元素（从左到右，索引从0开始）</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824173306113.png" alt="image-20220824173306113"></p><p>  没有<code>rindex</code></p></li><li><p><code>llen &lt;key&gt;</code>：获得<code>&lt;key&gt;</code>对应列表的长度</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824173431479.png" alt="image-20220824173431479"></p><p>  没有<code>rlen</code></p></li></ul><hr><ul><li><p><code>linsert &lt;key&gt; before/after &lt;value&gt; &lt;newvalue&gt;</code>：在<code>&lt;value&gt;</code>的 前面 / 后面 插入<code>&lt;newvalue&gt;</code></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824173948479.png" alt="image-20220824173948479"></p></li><li><p><code>lrem &lt;key&gt; &lt;n&gt; &lt;value&gt;</code>：从左边删除 n 个 value（从左到右）</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824174355558.png" alt="image-20220824174355558"></p><p>  如果没有n个就是有多少个删除多少个，不会报错。</p></li><li><p><code>lset &lt;key&gt; &lt;index&gt; &lt;value&gt;</code>：将列表<code>&lt;key&gt;</code>下标为<code>&lt;index&gt;</code>的值替换成<code>&lt;value&gt;</code></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824174636024.png" alt="image-20220824174636024"></p></li></ul><h3 id="4-3-3、数据结构"><a href="#4-3-3、数据结构" class="headerlink" title="4.3.3、数据结构"></a>4.3.3、数据结构</h3><blockquote><p>Redis 的 List的数据结构为快速链表quickList。</p></blockquote><p>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是 ziplist ，即压缩列表。</p><p>它将所有的元素紧挨着一起存储，分配的是一块连续的内存。</p><p>当数据量比较多的时候才会改成quicklist。</p><p>因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824175213730.png" alt="image-20220824175213730"></p><p>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p><h2 id="4-4、Redis-集合（Set）"><a href="#4-4、Redis-集合（Set）" class="headerlink" title="4.4、Redis 集合（Set）"></a>4.4、Redis 集合（Set）</h2><h3 id="4-4-1、简介"><a href="#4-4-1、简介" class="headerlink" title="4.4.1、简介"></a>4.4.1、简介</h3><p>Redis 的 Set 对外提供的功能与 List 类似是一个列表的功能，特殊之处在于Set是可以<strong>自动排重</strong>的，当你需要存储一个列表数据，又不希望出现重复数据时，Set是一个很好的选择，并且set提供了判断某个成员是否在一个Set集合内的重要接口，这个也是List所不能提供的。</p><p>Redis 的 Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的<strong>复杂度都是O(1)</strong>。</p><p>一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变</p><h3 id="4-4-2、常用命令"><a href="#4-4-2、常用命令" class="headerlink" title="4.4.2、常用命令"></a>4.4.2、常用命令</h3><ul><li><p><code>sadd &lt;key&gt; &lt;value1&gt; &lt;value2&gt; ...</code>：将一个或多个 member 元素加入到集合key中，已经存在的 member 元素将被<strong>忽略</strong>，不会报错。</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824180622340.png" alt="image-20220824180622340"></p></li><li><p><code>smembers &lt;key&gt;</code>：取出 <code>&lt;key&gt;</code> 对应集合中的所有值</p></li><li><p><code>sismember &lt;key&gt; &lt;value&gt;</code>：判断集合<code>&lt;key&gt;</code>是否为含有该<code>&lt;value&gt;</code>值，有1，没有0</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824181058159.png" alt="image-20220824181058159"></p></li><li><p><code>scard &lt;key&gt;</code>：返回该集合的元素的个数</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824181203313.png" alt="image-20220824181203313"></p></li><li><p><code>srem &lt;key&gt; &lt;value1&gt; &lt;value2&gt;...</code>：删除<code>&lt;key&gt;</code>对应的集合中的一个或多个元素</p></li><li><p><code>spop &lt;key&gt;</code>：<strong>随机</strong>从<code>&lt;key&gt;</code>对应的集合中 pop 出一个值</p></li><li><p><code>srandmember &lt;key&gt; &lt;n&gt;</code>：<strong>随机</strong>从 <code>&lt;key&gt;</code>对应的集合中<strong>取出 n 个值</strong>。<strong>不会从集合中删除</strong></p></li><li><p><code>smove &lt;sourcekey&gt; &lt;destinationkey&gt; &lt;value&gt;</code>：把<code>&lt;sourcekey&gt;</code>对应的集合中的<code>&lt;value&gt;</code>移动到<code>&lt;destinationkey&gt;</code>对应的集合中</p></li><li><p><code>sinter &lt;key1&gt; &lt;key2&gt;</code>：返回<code>&lt;key1&gt;</code>与<code>&lt;key2&gt;</code>对应的集合的<strong>交集</strong>元素</p></li><li><p><code>sunion &lt;key1&gt; &lt;key2&gt;</code>：返回<code>&lt;key1&gt;</code>与<code>&lt;key2&gt;</code>对应的集合的<strong>并集</strong>元素</p></li><li><p><code>sdiff &lt;key1&gt; &lt;key2&gt;</code>：返回<code>&lt;key1&gt;</code>与<code>&lt;key2&gt;</code>对应的集合的<strong>差集</strong>元素（包含key1中的，不包含key2中的，也就是key1 - key2）</p></li></ul><h3 id="4-4-3、数据结构"><a href="#4-4-3、数据结构" class="headerlink" title="4.4.3、数据结构"></a>4.4.3、数据结构</h3><blockquote><p>Set数据结构是dict字典，字典是用哈希表实现的。</p></blockquote><p>Java中 HashSet 的内部实现使用的是 HashMap ，只不过所有的 value 都指向同一个对象。Redis 的 Set 结构也是一样，它的内部也使用 Hash 结构，所有的value都指向同一个内部值。</p><h2 id="4-5、Redis-哈希（Hash）"><a href="#4-5、Redis-哈希（Hash）" class="headerlink" title="4.5、Redis 哈希（Hash）"></a>4.5、Redis 哈希（Hash）</h2><h3 id="4-5-1、简介"><a href="#4-5-1、简介" class="headerlink" title="4.5.1、简介"></a>4.5.1、简介</h3><ul><li><p>Redis hash 是一个键值对集合。</p></li><li><p>Redis hash 是一个string类型的 field 和 value 的映射表，hash 特别适合用于<strong>存储对象</strong>。</p></li><li><p>类似Java里面的Map<String,Object></p></li></ul><p>举例：</p><p>用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储</p><p>主要有以下3种存储方式：</p><ol><li><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824190207212.png" alt="image-20220824190207212" style="zoom: 67%;" /></p><p> 每次修改用户的某个属性需要，先反序列化改好后再序列化回去。开销较大。</p></li><li><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824190219774.png" alt="image-20220824190219774" style="zoom:67%;" /></p><p> 用户ID数据冗余</p></li><li><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824190318307.png" alt="image-20220824190318307" style="zoom:67%;" /></p><p> 通过 <strong>key(用户ID) + field(属性标签)</strong> 就可以操作对应属性数据了，既不需要重复存储数据，也不会带来序列化和并发修改控制的问题</p></li></ol><h3 id="4-5-2、常用命令"><a href="#4-5-2、常用命令" class="headerlink" title="4.5.2、常用命令"></a>4.5.2、常用命令</h3><ul><li><p><code>hset &lt;key&gt; &lt;field&gt; &lt;value&gt;</code>：给<code>&lt;key&gt;</code>集合中的 <code>&lt;field&gt;</code>键赋值<code>&lt;value&gt;</code> (h  set)</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824191722626.png" alt="image-20220824191722626" style="zoom: 67%;" /></p></li><li><p><code>hget &lt;key1&gt; &lt;field&gt;</code>：从<code>&lt;key1&gt;</code>集合<code>&lt;field&gt;</code>取出 value (h  get)</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824191803414.png" alt="image-20220824191803414" style="zoom:67%;" /></p></li><li><p><code>hmset &lt;key1&gt; &lt;field1&gt; &lt;value1&gt; &lt;field2&gt; &lt;value2&gt;...</code>：批量设置hash的值(h  mset)</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824191852857.png" alt="image-20220824191852857" style="zoom:67%;" /></p></li><li><p><code>hexists &lt;key1&gt; &lt;field&gt;</code>：查看哈希表 <code>&lt;key1&gt;</code> 中，给定属性 <code>&lt;field&gt;</code> 是否存在。 (h  exists)</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824191951793.png" alt="image-20220824191951793" style="zoom:67%;" /></p></li><li><p><code>hkeys &lt;key&gt;</code>：列出<code>&lt;key&gt;</code>对应的 hash集合 的所有 属性 field</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824192028668.png" alt="image-20220824192028668" style="zoom:67%;" /></p></li><li><p><code>hvals &lt;key&gt;</code>：列出该hash集合的所有 属性对应的 值 value</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824192107456.png" alt="image-20220824192107456" style="zoom:67%;" /></p></li><li><p><code>hincrby &lt;key&gt; &lt;field&gt; &lt;increment&gt;</code>：为哈希表 <code>&lt;key&gt;</code> 中的域 <code>&lt;field&gt;</code> 的值加上增量 <code>&lt;increment&gt;</code>（h  incrby）</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824192202144.png" alt="image-20220824192202144"></p></li><li><p><code>hsetnx &lt;key&gt; &lt;field&gt; &lt;value&gt;</code>：将哈希表 key 中的域 field 的值设置为 value ，当且仅当域 field 不存在 (h  setnx)</p></li></ul><h3 id="4-5-3、数据结构"><a href="#4-5-3、数据结构" class="headerlink" title="4.5.3、数据结构"></a>4.5.3、数据结构</h3><p>Hash类型对应的数据结构是两种：</p><ul><li>ziplist（压缩列表）</li><li>hashtable（哈希表）。</li></ul><p>当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable。</p><h2 id="4-6、Redis-有序集合Zset-（sorted-set）"><a href="#4-6、Redis-有序集合Zset-（sorted-set）" class="headerlink" title="4.6、Redis 有序集合Zset （sorted set）"></a>4.6、Redis 有序集合Zset （sorted set）</h2><h3 id="4-6-1、简介"><a href="#4-6-1、简介" class="headerlink" title="4.6.1、简介"></a>4.6.1、简介</h3><p>Redis 有序集合 Zset 与 普通集合 Set 非常相似，是一个没有重复元素的字符串集合。</p><p>不同之处是 <strong>有序集合</strong> 的 <strong>每个成员</strong> 都关联了一个 <strong>评分（score）</strong>,这个评分（score）被用来 按照从最低分到最高分的方式 <strong>排序</strong>集合中的成员。<strong>集合的成员是唯一的，但是评分可以是重复了</strong> 。==每个成员有一个评分，利用评分来排序==</p><p>因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。</p><p>访问有序集合的中间元素也是非常快的，因此你能够使用有序集合<strong>作为一个没有重复成员的智能列表</strong>。</p><h3 id="4-6-2、常用命令"><a href="#4-6-2、常用命令" class="headerlink" title="4.6.2、常用命令"></a>4.6.2、常用命令</h3><ul><li><p><code>zadd &lt;key&gt; &lt;score1&gt; &lt;value1&gt; &lt;score2&gt; &lt;value2&gt;…</code>：将一个或多个 member 元素及其 score 值加入到有序集 key 当中。==注意，是key-socre-value对，不是key-value对了。==</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824193319810.png" alt="image-20220824193319810" style="zoom:67%;" /></p></li><li><p><code>zrange &lt;key&gt; &lt;startIndex&gt; &lt;stopIndex&gt; [WITHSCORES]</code>：返回有序集 key 中，下标索引在<code>&lt;startIndex&gt;</code>与<code>&lt;stopIndex&gt;</code>之间的元素（带<code>[WITHSCORES]</code>，可以让 分数score 一起和 值 返回到结果集。）</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824193454710.png" alt="image-20220824193454710" style="zoom:50%;" /></p></li><li><p><code>zrangebyscore &lt;key&gt; &lt;min&gt; &lt;max&gt; [withscores] [limit offset count]</code>：返回有序集 <code>&lt;key&gt;</code> 中，所有 score 值介于 <code>&lt;min&gt;</code> 和 <code>&lt;max&gt;</code> 之间(包括等于 <code>&lt;min&gt;</code> 或 <code>&lt;max&gt;</code> )的成员。有序集成员按 score 值递增(从小到大)次序排列。 </p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824193820954.png" alt="image-20220824193820954" style="zoom:50%;" /></p></li><li><p><code>zrevrangebyscore &lt;key&gt; &lt;max&gt; &lt;min&gt; [withscores] [limit offset count]</code>：同上，改为从大到小排列。</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824193937548.png" alt="image-20220824193937548" style="zoom: 67%;" /></p><p>  注意：<code>&lt;max&gt;</code> 在<code>&lt;min&gt;</code>前</p></li><li><p><code>zincrby &lt;key&gt; &lt;increment&gt; &lt;value&gt;</code>：为<code>&lt;key&gt;</code>对应的有序集合中<code>&lt;value&gt;</code>值对应的元素的<strong>score</strong>加上增量<code>&lt;increment&gt;</code> ==操作的是score==</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824194212768.png" alt="image-20220824194212768" style="zoom: 67%;" /></p></li><li><p><code>zrem &lt;key&gt; &lt;value&gt;</code>：删除该集合下，指定值的元素（<code>&lt;key&gt;</code>对应的有序集合中<code>&lt;value&gt;</code>元素）</p></li><li><p><code>zcount &lt;key&gt; &lt;min&gt; &lt;max&gt;</code>：统计该集合，分数score 在区间内的 元素 个数==利用分数的区间统计元素个数== </p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824194332862.png" alt="image-20220824194332862" style="zoom:67%;" /></p></li><li><p><code>zrank &lt;key&gt; &lt;value&gt;</code>返回该<code>&lt;value&gt;</code>在有序集合<code>&lt;key&gt;</code>中的排名，==从 <strong>0</strong> 开始==。</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824194419193.png" alt="image-20220824194419193" style="zoom:80%;" /></p></li></ul><h3 id="4-6-3、数据结构"><a href="#4-6-3、数据结构" class="headerlink" title="4.6.3、数据结构"></a>4.6.3、数据结构</h3><p>SortedSet(zset)是Redis提供的一个<strong>非常特别</strong>的数据结构，一方面它等价于Java的数据结构Map<String, Double>，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。</p><p>zset底层使用了两个数据结构</p><ol><li><p>hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。</p><p> hash的filed就是value，hash的value就是权重score。</p></li><li><p>跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。</p></li></ol><h3 id="4-6-4、跳跃表"><a href="#4-6-4、跳跃表" class="headerlink" title="4.6.4、跳跃表"></a>4.6.4、跳跃表</h3><ol><li><p>简介</p><p> <strong>应用场景</strong>：有序集合在生活中比较常见，例如根据成绩对学生排名，根据得分对玩家排名等。</p><p> 对于有序集合的底层实现，可以用数组、平衡树、链表等。</p><p> 数组不便元素的插入、删除；</p><p> 平衡树或红黑树虽然效率高但结构复杂；</p><p> 链表查询需要遍历所有效率低。</p><p> <strong>Redis采用的是跳跃表。跳跃表效率堪比红黑树，实现远比红黑树简单。</strong></p></li><li><p>实例</p><p> 对比有序链表和跳跃表，从链表中查询出51</p><ul><li><p>有序链表：</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824194843636.png" alt="image-20220824194843636" style="zoom:67%;" /></p><p>  要查找值为51的元素，需要从第一个元素开始依次查找、比较才能找到。共需要<strong>6次</strong>比较。</p></li><li><p>跳跃表：</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824194913189.png" alt="image-20220824194913189" style="zoom:67%;" /></p><ul><li><p>从第2层开始，1节点比51节点小，向后比较。21节点比51节点小，继续向后比较，后面就是NULL了，所以从21节点向下到第1层</p></li><li><p>在第1层，41节点比51节点小，继续向后，61节点比51节点大，所以从41向下</p></li><li><p>在第0层，51节点为要查找的节点，节点被找到，共查找<strong>4次</strong>。</p></li></ul><p>从此可以看出跳跃表比有序链表效率要高</p></li></ul></li></ol><h1 id="五、Redis-的发布和订阅"><a href="#五、Redis-的发布和订阅" class="headerlink" title="五、Redis 的发布和订阅"></a>五、Redis 的发布和订阅</h1><h2 id="5-1、什么是发布和订阅"><a href="#5-1、什么是发布和订阅" class="headerlink" title="5.1、什么是发布和订阅"></a>5.1、什么是发布和订阅</h2><p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p><p>Redis 客户端可以订阅<strong>任意数量</strong>的频道。</p><h2 id="5-2-Redis-的发布和订阅"><a href="#5-2-Redis-的发布和订阅" class="headerlink" title="5.2 Redis 的发布和订阅"></a>5.2 Redis 的发布和订阅</h2><ol><li><p>客户端可以订阅频道如下图</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824200846002.png" alt="image-20220824200846002" style="zoom:67%;" /></p></li><li><p>当给这个频道发布消息后，消息就会发送给订阅的客户端</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824200906950.png" alt="image-20220824200906950" style="zoom: 67%;" /></p></li></ol><h2 id="5-3、发布和订阅命令行实现"><a href="#5-3、发布和订阅命令行实现" class="headerlink" title="5.3、发布和订阅命令行实现"></a>5.3、发布和订阅命令行实现</h2><ol><li><p>打开一个客户端订阅 channel1 频道</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subscribe channel1</span><br></pre></td></tr></table></figure></li><li><p>打开另一个客户端，给 channel1 频道发送消息 hello</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publish channel1 hello</span><br></pre></td></tr></table></figure><p> 返回值是频道 channel1的订阅者数量</p></li><li><p>打开第一个客户端可以看到发送的消息</p><p> 注：发布的消息没有持久化，如果在订阅的客户端收不到hello，只能收到订阅后发布的消息</p></li></ol><h1 id="六、Reidis-新数据类型"><a href="#六、Reidis-新数据类型" class="headerlink" title="六、Reidis 新数据类型"></a>六、Reidis 新数据类型</h1><h2 id="6-1、Bitmaps"><a href="#6-1、Bitmaps" class="headerlink" title="6.1、Bitmaps"></a>6.1、Bitmaps</h2><h3 id="6-1-1、简介"><a href="#6-1-1、简介" class="headerlink" title="6.1.1、简介"></a>6.1.1、简介</h3><blockquote><p>实际类型还是string，但是不能正常用string的命令（但是不会报错）</p></blockquote><p>现代计算机用二进制（位） 作为信息的基础单位， 1个字节等于8位， 例如“abc”字符串是由3个字节组成， 但实际在计算机存储时将其用二进制表示， “abc”分别对应的ASCII码分别是97、 98、 99， 对应的二进制分别是01100001、 01100010和01100011，如下图</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824204804442.png" alt="image-20220824204804442" style="zoom:67%;" /></p><p>合理地使用操作位能够有效地提高内存使用率和开发效率。</p><p>Redis提供了Bitmaps这个“数据类型”可以实现对位的操作：</p><ol><li><p>Bitmaps本身不是一种数据类型， 实际上它就是字符串（key-value） ， 但是它可以对字符串的位进行操作。</p></li><li><p>Bitmaps单独提供了一套命令， 所以在Redis中使用Bitmaps和使用字符串的方法不太相同。 可以把Bitmaps想象成一个以位为单位的<strong>数组</strong>， 数组的每个单元只能存储0和1， 数组的<strong>下标</strong>在Bitmaps中叫做<strong>偏移量</strong>。</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824204941917.png" alt="image-20220824204941917" style="zoom:80%;" /></p><h3 id="6-1-2、常用命令"><a href="#6-1-2、常用命令" class="headerlink" title="6.1.2、常用命令"></a>6.1.2、常用命令</h3><h4 id="6-1-2-1、setbit"><a href="#6-1-2-1、setbit" class="headerlink" title="6.1.2.1、setbit"></a>6.1.2.1、setbit</h4><ol><li><p>语法;</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setbit &lt;key&gt; &lt;offset&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure><p> 设置<code>&lt;key&gt;</code>对应的Bitmaps中某个偏移量（<code>&lt;offset&gt;</code>）的值（<code>&lt;value&gt;</code>）（0 或 1）</p><p> <strong>offset 偏移量从0开始</strong></p></li><li><p>案例</p><p> 每个 独立用户是否访问过网站 存放在Bitmaps中， 将访问的用户记做1， 没有访问的用户记做0， 用偏移量作为用户的id。</p><p> 设置键的第offset个位的值（从0算起） ， 假设现在有20个用户，userid=1， 6， 11， 15， 19的用户对网站进行了访问， 那么当前Bitmaps初始化<strong>结果</strong>如图</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824205450840.png" alt="image-20220824205450840" style="zoom:80%;" /></p><p> 实际操作：</p><p> unique:users:20201106代表2020-11-06这天的独立访问用户的Bitmaps</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824205559494.png" alt="image-20220824205559494" style="zoom: 67%;" /></p><blockquote><p>很多应用的用户id以一个指定数字（例如10000） 开头（<strong>有公共前缀</strong>）， 直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费， 通常的做法是每次做setbit操作时将用户id减去这个指定数字，<strong>即去掉公共前缀</strong>。</p><p>在第一次初始化Bitmaps时， 假如偏移量非常大， 那么整个初始化过程执行会比较慢， 可能会造成Redis的阻塞。</p></blockquote></li></ol><h4 id="6-1-2-2、getbit"><a href="#6-1-2-2、getbit" class="headerlink" title="6.1.2.2、getbit"></a>6.1.2.2、getbit</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getbit &lt;key&gt; &lt;offset&gt;</span><br></pre></td></tr></table></figure><p> 获取<code>&lt;key&gt;</code>对应的Bitmaps中的某个偏移量（<code>&lt;offset&gt;</code>）的值</p></li><li><p>案例：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824210430544.png" alt="image-20220824210430544" style="zoom: 80%;" /></p></li></ol><h4 id="6-1-2-3、bitcount"><a href="#6-1-2-3、bitcount" class="headerlink" title="6.1.2.3、bitcount"></a>6.1.2.3、bitcount</h4><blockquote><p>统计<strong>字符串</strong>被设置为1的bit数。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在特定的位上进行。start 和 end 参数的设置，都可以使用负数值：比如 -1 表示最后一个位，而 -2 表示倒数第二个位，start、end 是指bit组的字节的下标索引数，二者皆包含。</p><p>==这里的单位是byte，1 byte = 8 bit==</p></blockquote><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitcount &lt;key&gt; [start end]</span><br></pre></td></tr></table></figure><p> 统计字符串从 start字节 到 end字节 比特值为 1 的位的数量 ==一个字节是8位==</p></li><li><p>案例</p><p> 计算2022-11-06这天全天的独立访问用户数量</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824211250216.png" alt="image-20220824211250216"></p><p> start和end代表起始和结束字节数，下面操作计算用户 id 在第1个字节到第3个字节之间的独立访问用户数， 对应的用户id是11， 15， 19。==相当于是区间：[9,24]==</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824211512224.png" alt="image-20220824211512224" style="zoom: 80%;" /></p><p> 结果数为3，对应的是11，15，19</p><blockquote><p>举例： K1 【01000001 01000000 00000000 00100001】，对应【0，1，2，3】</p><p>bitcount K1 1 2 ： 统计下标1、2字节组中bit=1的个数，即01000000 00000000</p><p>—》bitcount K1 1 2 　　—》1</p><p>bitcount K1 1 3 ： 统计下标1、2字节组中bit=1的个数，即01000000 00000000 00100001</p><p>—》bitcount K1 1 3　　—》3</p><p>bitcount K1 0 -2 ： 统计下标0到下标倒数第2，字节组中bit=1的个数，即01000001 01000000  00000000</p><p>—》bitcount K1 0 -2　　—》3</p></blockquote></li></ol><h4 id="6-1-2-4、bitop"><a href="#6-1-2-4、bitop" class="headerlink" title="6.1.2.4、bitop"></a>6.1.2.4、bitop</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitop &lt;operation&gt; &lt;destkey&gt; [key1 key2 ...]</span><br></pre></td></tr></table></figure><p> bitop是一个复合操作。<code>&lt;operation&gt;</code>的取值为：and（交集）、or（并集）、not（非）、xor（异或）。将操作结果保存在<code>&lt;destkey&gt;</code>中。被操作的对象就是<code>[key1,key2...]</code>所对应的Bitmaps。</p></li><li><p>案例</p><ul><li><p>先设置值:</p><p>  2020-11-04 这天访问网站的userid=1,2,5,9。</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setbit unique:users:20201104 1 1</span><br><span class="line">setbit unique:users:20201104 2 1</span><br><span class="line">setbit unique:users:20201104 5 1</span><br><span class="line">setbit unique:users:20201104 9 1</span><br></pre></td></tr></table></figure><p>  2020-11-03 这天访问网站的userid=0,1,4,9。</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setbit unique:users:20201103 0 1</span><br><span class="line">setbit unique:users:20201103 1 1</span><br><span class="line">setbit unique:users:20201103 4 1</span><br><span class="line">setbit unique:users:20201103 9 1</span><br></pre></td></tr></table></figure></li><li><p>需求:</p><p>  计算出两天都访问过网站的<strong>用户数量</strong></p></li><li><p>实现</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitop and unique:users:and:20201104_03 unique:users:20201103 unique:users:20201104</span><br></pre></td></tr></table></figure><p>  意思是，将<code>unique:users:20201103</code>对应的的Bitmaps与<code>unique:users:20201104</code>对应的Bitmaps进行and（与操作），将操作结果存到新的key：<code>unique:users:and:20201104_03</code>中，这个key对应的value就是前面两者进行与操作的结果。</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bitcount unique:users:and:20201104_03</span><br></pre></td></tr></table></figure><p>  最后再对其计数。</p><blockquote><p>对于不同需求使用不同操作就可以了，这里只是演示一种操作。</p></blockquote></li></ul></li></ol><h3 id="6-1-3、Bitmaps-与-set-对比"><a href="#6-1-3、Bitmaps-与-set-对比" class="headerlink" title="6.1.3、Bitmaps 与 set 对比"></a>6.1.3、Bitmaps 与 set 对比</h3><blockquote><p>对比基础条件：</p><p>假设网站有1亿用户， 每天独立访问的用户有5千万， 如果每天用集合类型和Bitmaps分别存储活跃用户可以得到表</p></blockquote><ul><li><p><strong>set和Bitmaps存储一天活跃用户对比：</strong></p><p>  | 数据  类型 | 每个用户id占用空间 | 需要存储的用户量 | 全部内存量             |<br>  | ————— | ————————— | ———————— | ——————————— |<br>  | Set        | 64位               | 50000000         | 64位<em>50000000 = 400MB  |<br>  | Bitmaps    | 1位                | 100000000        | 1位</em>100000000 = 12.5MB |</p><p>  很明显， 这种情况下使用Bitmaps能节省很多的内存空间， 尤其是随着时间推移节省的内存还是非常可观的</p></li><li><p><strong>set和Bitmaps存储独立用户空间对比  </strong></p><p>  | 数据类型 | 一天   | 一个月 | 一年  |<br>  | ———— | ——— | ——— | ——- |<br>  | Set      | 400MB  | 12GB   | 144GB |<br>  | Bitmaps  | 12.5MB | 375MB  | 4.5GB |</p><p>  但Bitmaps并不是万金油， 假如该网站每天的独立访问用户很少， 例如只有10万（<strong>有大量的僵尸用户</strong>） ， 那么两者的对比如下表所示， 很显然， 这时候使用Bitmaps就不太合适了， 因为基本上大部分位都是0。</p></li><li><p><strong>set和Bitmaps存储一天活跃用户对比（独立用户比较少）</strong></p><p>  | 数据类型 | 每个userid占用空间 | 需要存储的用户量 | 全部内存量             |<br>  | ———— | ————————— | ———————— | ——————————— |<br>  | Set      | 64位               | 100000           | 64位<em>100000 = 800KB    |<br>  | Bitmaps  | 1位                | 100000000        | 1位</em>100000000 = 12.5MB |</p></li></ul><h2 id="6-2、HyperLogLog"><a href="#6-2、HyperLogLog" class="headerlink" title="6.2、HyperLogLog"></a>6.2、HyperLogLog</h2><h3 id="6-2-1、简介"><a href="#6-2-1、简介" class="headerlink" title="6.2.1、简介"></a>6.2.1、简介</h3><blockquote><p>在工作当中，我们经常会遇到与统计相关的功能需求，比如统计网站PV（PageView页面访问量）,可以使用Redis的 <code>incr</code>、<code>incrby</code>轻松实现。</p></blockquote><p>但像UV（UniqueVisitor，独立访客）、独立IP数、搜索记录数等需要去重和计数的问题如何解决？这种<strong>求集合中不重复元素个数</strong>的问题称为<strong>基数问题</strong>。</p><p>解决基数问题有很多种方案：</p><ol><li><p>数据存储在MySQL表中，使用<code>distinct count</code>计算不重复个数</p></li><li><p>使用Redis提供的hash、set、bitmaps等数据结构来处理</p></li></ol><p>以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，对于非常大的数据集是不切实际的。</p><blockquote><p>能否能够降低一定的精度来平衡存储空间？</p></blockquote><p>Redis推出了HyperLogLog</p><p>Redis HyperLogLog 是<strong>用来做基数统计</strong>的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。</p><p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p><p><strong>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</strong></p><p>什么是基数?</p><p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p><h3 id="6-2-2、常用命令"><a href="#6-2-2、常用命令" class="headerlink" title="6.2.2、常用命令"></a>6.2.2、常用命令</h3><h4 id="6-2-2-1、pfadd"><a href="#6-2-2-1、pfadd" class="headerlink" title="6.2.2.1、pfadd"></a>6.2.2.1、pfadd</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pfadd &lt;key&gt; &lt;element&gt; [element ...]</span><br></pre></td></tr></table></figure><p> 添加指定元素（一次可以添加多个元素）到HyperLogLog中</p></li><li><p>案例</p><p> 将所有元素添加到指定HyperLogLog数据结构中。如果执行命令后HLL估计的近似基数发生变化，则返回1，否则返回0。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824214739257.png" alt="image-20220824214739257"></p></li></ol><h4 id="6-2-2-2、pfcount"><a href="#6-2-2-2、pfcount" class="headerlink" title="6.2.2.2、pfcount"></a>6.2.2.2、pfcount</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pfcount &lt;key&gt; [key ...]</span><br></pre></td></tr></table></figure><p> 计算<code>&lt;key&gt;</code>的近似基数，可以多个<code>&lt;key&gt;</code>合并起来然后求基数。例如hll1存储周一的UV，hll2存储周二的UV….。那么求一周的近似基数就是把hll1,hll2….hll7合并起来 然后 求基数</p></li><li><p>案例</p><p> 计算hll1与hll2合并之后的的基数</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824215157445.png" alt="image-20220824215157445"></p></li></ol><h4 id="6-2-2-3、pfmerge"><a href="#6-2-2-3、pfmerge" class="headerlink" title="6.2.2.3、pfmerge"></a>6.2.2.3、pfmerge</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pfmerge &lt;destkey&gt; &lt;sourcekey&gt; [sourcekey ...]</span><br></pre></td></tr></table></figure><p> 将一个或多个HLL合并后的结果存储在另一个HLL中，比如每月活跃用户可以使用每天的活跃用户来合并计算可得</p></li><li><p>案例</p><p> 将hll1与hll2合并，将结果存储到hll3中，然后求hll3的基数</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824220034112.png" alt="image-20220824220034112"></p></li></ol><h2 id="6-3、Geospatial"><a href="#6-3、Geospatial" class="headerlink" title="6.3、Geospatial"></a>6.3、Geospatial</h2><h3 id="6-3-1、简介"><a href="#6-3-1、简介" class="headerlink" title="6.3.1、简介"></a>6.3.1、简介</h3><p>Redis 3.2 中增加了对GEO类型的支持。</p><p>GEO，Geographic，地理信息的缩写。</p><p>该类型，就是元素的2维坐标，在地图上就是经纬度。</p><p>redis基于该类型，提供了经纬度设置，查询，范围查询，距离查询，经纬度Hash等常见操作。</p><h3 id="6-3-2、常用命令"><a href="#6-3-2、常用命令" class="headerlink" title="6.3.2、常用命令"></a>6.3.2、常用命令</h3><h4 id="6-3-2-1、geoadd"><a href="#6-3-2-1、geoadd" class="headerlink" title="6.3.2.1、geoadd"></a>6.3.2.1、geoadd</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geoadd &lt;key&gt; &lt;longitude&gt; &lt;latitude&gt; &lt;member&gt; [longitude latitude member ...]</span><br></pre></td></tr></table></figure><p> 添加地理位置（经度<code>&lt;longitude&gt;</code>，纬度<code>&lt;latitude&gt;</code>，名称<code>&lt;member&gt;</code>）（一次可以添加多组）</p></li><li><p>案例</p><p> 添加上海，重庆，深圳，北京的经纬度：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824220726865.png" alt="image-20220824220726865"></p><p> 两极无法直接添加，一般会下载城市数据，直接通过 Java 程序一次性导入。</p><ul><li><p>有效的经度从 -180 度到 180 度。</p></li><li><p>有效的纬度从 -85.05112878 度到 85.05112878 度。</p><p>当坐标位置超出指定范围时，该命令将会返回一个错误。</p><p>已经添加的数据，是无法再次往里面添加的。</p></li></ul></li></ol><h4 id="6-3-2-2、geopos"><a href="#6-3-2-2、geopos" class="headerlink" title="6.3.2.2、geopos"></a>6.3.2.2、geopos</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geopos &lt;key&gt; &lt;member&gt; [member ...]</span><br></pre></td></tr></table></figure><p> 获取<code>&lt;key&gt;</code>对应的geo中的指定地区（member）的坐标值（一次可获取多个）</p></li><li><p>案例</p><p> 获取上海，重庆，深圳，北京的经纬度：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824220957511.png" alt="image-20220824220957511"></p></li></ol><h4 id="6-3-2-3、geodist"><a href="#6-3-2-3、geodist" class="headerlink" title="6.3.2.3、geodist"></a>6.3.2.3、geodist</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geodist &lt;key&gt; &lt;member1&gt; &lt;member2&gt; [m|km|ft|mi]</span><br></pre></td></tr></table></figure><p> 获取<strong>两个</strong>位置之间（需要两个位置元素）的直线距离。</p><p> 单位：</p><ul><li><p>m 表示单位为米<strong>[默认值]</strong>。</p></li><li><p>km 表示单位为千米。</p></li><li><p>mi 表示单位为英里。</p></li><li><p>ft 表示单位为英尺。</p></li></ul></li><li><p>案例</p><p> 获取上海和北京之间的距离，使用千米作为单位</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824221252456.png" alt="image-20220824221252456"></p></li></ol><h4 id="6-3-2-4、georadius"><a href="#6-3-2-4、georadius" class="headerlink" title="6.3.2.4、georadius"></a>6.3.2.4、georadius</h4><ol><li><p>语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">georadius &lt;key&gt; &lt;longitude&gt; &lt;latitude&gt; radius m|km|ft|mi</span><br></pre></td></tr></table></figure><p> 以给定的经度（<code>&lt;longitude&gt;</code>）和纬度（<code>&lt;latitude&gt;</code>）为中心，找出某一半径（<code>radius</code>）内的元素。需要指定单位。单位和上面一样。</p></li><li><p>案例</p><p> 查找以经度为110，纬度30为中心，半径为1000 km的元素</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220824221705337.png" alt="image-20220824221705337"></p></li></ol><h1 id="七、Jedis"><a href="#七、Jedis" class="headerlink" title="七、Jedis"></a>七、Jedis</h1><blockquote><p>和JDBC类似，是使用java操作Redis的工具</p></blockquote><h2 id="7-1、引入依赖"><a href="#7-1、引入依赖" class="headerlink" title="7.1、引入依赖"></a>7.1、引入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="7-2、连接Redis注意事项"><a href="#7-2、连接Redis注意事项" class="headerlink" title="7.2、连接Redis注意事项"></a>7.2、连接Redis注意事项</h2><ul><li><p>禁用Linux的防火墙</p></li><li><p>redis.conf中注释调bind 127.0.0.1</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825104626995.png" alt="image-20220825104626995" style="zoom:50%;" /></p><p>  69行左右的位置</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825104733766.png" alt="image-20220825104733766" style="zoom:50%;" /></p></li><li><p>redis.conf中设置protected-mode 为no</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825104529894.png" alt="image-20220825104529894" style="zoom:50%;" /></p><p>  88行左右的位置</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825104600113.png" alt="image-20220825104600113" style="zoom: 50%;" /></p></li></ul><blockquote><p>设置好了之后可以用xshell试试是否真的可以连接。</p></blockquote><h2 id="7-3、Jedis测试"><a href="#7-3、Jedis测试" class="headerlink" title="7.3、Jedis测试"></a>7.3、Jedis测试</h2><p>创建JedisTest01类</p><p>写入代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTest01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 创建Jedis对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>,<span class="number">6379</span>); <span class="comment">// 参数一：host，参数二：port</span></span><br><span class="line">        <span class="comment">// 2. 测试</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试能否ping通</p><p>正确运行结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825110113644.png" alt="image-20220825110113644"></p><p>SLF4J提示的东西可以不用管，输出了PONG就是对的。</p><h2 id="7-4、测试相关数据类型"><a href="#7-4、测试相关数据类型" class="headerlink" title="7.4、测试相关数据类型"></a>7.4、测试相关数据类型</h2><h3 id="7-4-1、Key"><a href="#7-4-1、Key" class="headerlink" title="7.4.1、Key"></a>7.4.1、Key</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestKey</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        jedis.set(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        jedis.set(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        System.out.println(keys.size());</span><br><span class="line">        <span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(jedis.exists(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">        System.out.println(jedis.ttl(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825110638605.png" alt="image-20220825110638605"></p><h3 id="7-4-2、String"><a href="#7-4-2、String" class="headerlink" title="7.4.2、String"></a>7.4.2、String</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestString</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.mset(<span class="string">&quot;str1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;str2&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;str3&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        System.out.println(jedis.mget(<span class="string">&quot;str1&quot;</span>,<span class="string">&quot;str2&quot;</span>,<span class="string">&quot;str3&quot;</span>));</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825111113377.png" alt="image-20220825111113377"></p><h3 id="7-4-3、List"><a href="#7-4-3、List" class="headerlink" title="7.4.3、List"></a>7.4.3、List</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestList</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        jedis.lpush(<span class="string">&quot;myList&quot;</span>, <span class="string">&quot;List1&quot;</span>,<span class="string">&quot;List2&quot;</span>,<span class="string">&quot;List3&quot;</span>);</span><br><span class="line">        List&lt;String&gt; list = jedis.lrange(<span class="string">&quot;myList&quot;</span>,<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String element : list) &#123;</span><br><span class="line">            System.out.println(element);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825111354720.png" alt="image-20220825111354720"></p><h3 id="7-4-4、Set"><a href="#7-4-4、Set" class="headerlink" title="7.4.4、Set"></a>7.4.4、Set</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestSet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        jedis.sadd(<span class="string">&quot;orders&quot;</span>, <span class="string">&quot;order01&quot;</span>);</span><br><span class="line">        jedis.sadd(<span class="string">&quot;orders&quot;</span>, <span class="string">&quot;order02&quot;</span>);</span><br><span class="line">        jedis.sadd(<span class="string">&quot;orders&quot;</span>, <span class="string">&quot;order03&quot;</span>,<span class="string">&quot;order04&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; smembers = jedis.smembers(<span class="string">&quot;orders&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String order : smembers) &#123;</span><br><span class="line">            System.out.println(order);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">        jedis.srem(<span class="string">&quot;orders&quot;</span>, <span class="string">&quot;order02&quot;</span>);</span><br><span class="line">        smembers = jedis.smembers(<span class="string">&quot;orders&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String order : smembers) &#123;</span><br><span class="line">            System.out.println(order);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825111742469.png" alt="image-20220825111742469"></p><p>Set无序</p><h3 id="7-4-5-Hash"><a href="#7-4-5-Hash" class="headerlink" title="7.4.5 Hash"></a>7.4.5 Hash</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestHash</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        jedis.hset(<span class="string">&quot;hash1&quot;</span>,<span class="string">&quot;userName&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(jedis.hget(<span class="string">&quot;hash1&quot;</span>,<span class="string">&quot;userName&quot;</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,String&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;telPhone&quot;</span>,<span class="string">&quot;13810169999&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;address&quot;</span>,<span class="string">&quot;chongqing&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;abc@163.com&quot;</span>);</span><br><span class="line">        jedis.hmset(<span class="string">&quot;hash2&quot;</span>,map);</span><br><span class="line">        List&lt;String&gt; result = jedis.hmget(<span class="string">&quot;hash2&quot;</span>, <span class="string">&quot;telPhone&quot;</span>,<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String element : result) &#123;</span><br><span class="line">            System.out.println(element);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825112309330.png" alt="image-20220825112309330"></p><h3 id="7-4-6-Zset"><a href="#7-4-6-Zset" class="headerlink" title="7.4.6 Zset"></a>7.4.6 Zset</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestZset</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">100d</span>, <span class="string">&quot;z3&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">90d</span>, <span class="string">&quot;l4&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">80d</span>, <span class="string">&quot;w5&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset01&quot;</span>, <span class="number">70d</span>, <span class="string">&quot;z6&quot;</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; zrange = jedis.zrange(<span class="string">&quot;zset01&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (String e : zrange) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825112659378.png" alt="image-20220825112659378"></p><h3 id="7-4-7-总结"><a href="#7-4-7-总结" class="headerlink" title="7.4.7 总结"></a>7.4.7 总结</h3><p>最终运行结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825112811478.png" alt="image-20220825112811478"></p><p>Linux下可以查到keys 的变化，所以以后要使用Jedis，需要Linux是打开状态。</p><p>jedis可以调用常用方法，包括Bitmaps等新数据类型的命令都能调用。</p><h1 id="八、Jedis案例"><a href="#八、Jedis案例" class="headerlink" title="八、Jedis案例"></a>八、Jedis案例</h1><h2 id="8-1、需求"><a href="#8-1、需求" class="headerlink" title="8.1、需求"></a>8.1、需求</h2><p><strong>模拟</strong>验证码发送：</p><ol><li><p>输入手机号，点击发送后随机生成6位数字码，2分钟有效</p><ul><li>随机生成6位数字码：利用Random</li><li>2分钟有效：Redis设置key的有效时间</li></ul></li><li><p>输入验证码，点击验证，返回成功或失败</p><ul><li>从Redis中获取验证码，和输入的验证码作比较</li></ul></li><li><p>每个手机号每天只能输入3次</p><ul><li>用 incr 命令</li></ul></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825113358925.png" alt="image-20220825113358925" style="zoom:50%;" /></p><h2 id="8-2、实现"><a href="#8-2、实现" class="headerlink" title="8.2、实现"></a>8.2、实现</h2><p>小案例，就不写页面了，主要写Java代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTestVerificationCode</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟验证码发送：</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;请输入手机号： &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">phoneNum</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> verifyCode(phoneNum);</span><br><span class="line">            System.out.println(result);</span><br><span class="line">            System.out.print(<span class="string">&quot;请输入验证码： &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">inputCode</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            checkCode(phoneNum,inputCode);</span><br><span class="line">            System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成验证码数字</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 生成的验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getVerificationCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">code</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">6</span> ; i++)&#123;</span><br><span class="line">            code.append(random.nextInt(<span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化验证码（产生真正验证码），需要判断24小时内是否产生了三次验证码，也需要设置验证码过期时间是120秒</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phoneNUm 手机号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 真正生成的验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">verifyCode</span><span class="params">(String phoneNUm)</span>&#123;</span><br><span class="line">        <span class="comment">// 连接Jedis</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接key</span></span><br><span class="line">        <span class="comment">// 手机发送次数 key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">countKey</span> <span class="operator">=</span> phoneNUm + <span class="string">&quot;:count&quot;</span>;</span><br><span class="line">        <span class="comment">// 验证码的key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codeKey</span> <span class="operator">=</span> phoneNUm + <span class="string">&quot;:code&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 每个手机每天只能发送三次验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">count</span> <span class="operator">=</span> jedis.get(codeKey);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 还没有发送过一次</span></span><br><span class="line">            <span class="comment">// 存入key-value</span></span><br><span class="line">            jedis.setex(countKey, <span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(Integer.parseInt(count) &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="comment">// 发送过，但没有达到三次</span></span><br><span class="line">            <span class="keyword">if</span>(jedis.exists(codeKey))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;目前还有有效的验证码&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 发送次数加一</span></span><br><span class="line">            jedis.incr(countKey);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 发送超过三次</span></span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;今天发送次数已经超过三次了&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成并获取验证码，将验证码放到redis中，设置存在时间为120秒</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">verificationCode</span> <span class="operator">=</span> getVerificationCode();</span><br><span class="line">        jedis.setex(codeKey, <span class="number">120</span>, verificationCode);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;产生的验证码为: &quot;</span> + verificationCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证输入验证码是否正确</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phoneNum 手机号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputCode 用户输入的验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkCode</span><span class="params">(String phoneNum,String inputCode)</span> &#123;</span><br><span class="line">        <span class="comment">// 连接Jedis</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.104&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// 拼接该手机号对应的验证码的key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codeKey</span> <span class="operator">=</span> phoneNum + <span class="string">&quot;:code&quot;</span>;</span><br><span class="line">        <span class="comment">// 获取Redis中保存的手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> jedis.get(codeKey);</span><br><span class="line">        <span class="comment">// 比较验证码是否一致</span></span><br><span class="line">        <span class="keyword">if</span>(code.equals(inputCode)) &#123;</span><br><span class="line">            <span class="comment">// 验证码输入正确</span></span><br><span class="line">            System.out.println(<span class="string">&quot;验证码输入正确&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 验证码输入错误</span></span><br><span class="line">            System.out.println(<span class="string">&quot;验证码输入错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="九、Redis与SpringBoot整合"><a href="#九、Redis与SpringBoot整合" class="headerlink" title="九、Redis与SpringBoot整合"></a>九、Redis与SpringBoot整合</h1><h2 id="9-1、引入依赖"><a href="#9-1、引入依赖" class="headerlink" title="9.1、引入依赖"></a>9.1、引入依赖</h2><p>使用脚手架：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825154908544.png" alt="image-20220825154908544" style="zoom:67%;" /></p><p>产生的默认依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还需要添加;</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-pool2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="9-2、相关配置"><a href="#9-2、相关配置" class="headerlink" title="9.2、相关配置"></a>9.2、相关配置</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># Redis 服务器地址</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.104</span></span><br><span class="line">    <span class="comment"># Redis 端口位置</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment"># 数据库索引（默认为0）</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># 连接超时时间，单位毫秒</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="comment"># 配置连接池</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="comment"># 连接池最大连接数 （使用负值表示没有影响）</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">        <span class="comment"># 最大阻塞等待时间（负数表示没有限制）单位毫秒</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">-1</span></span><br><span class="line">        <span class="comment"># 连接池中的最大空闲连接</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="comment"># 连接池终端最小空闲连接</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="9-3、配置类"><a href="#9-3、配置类" class="headerlink" title="9.3、配置类"></a>9.3、配置类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeInfo;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.jsontype.impl.LaissezFaireSubTypeValidator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        </span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.WRAPPER_ARRAY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        </span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//key序列化方式</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//value序列化</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value hashmap序列化</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解决查询缓存转换异常的问题</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.WRAPPER_ARRAY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-4、测试"><a href="#9-4、测试" class="headerlink" title="9.4、测试"></a>9.4、测试</h2><p>编写一个RedisTestController方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/redisTest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRedis</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 设置值到redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;k1&quot;</span>,<span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取值</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(<span class="string">&quot;k1&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220825171423590.png" alt="image-20220825171423590"></p><h1 id="十、事务、锁机制"><a href="#十、事务、锁机制" class="headerlink" title="十、事务、锁机制"></a>十、事务、锁机制</h1><h2 id="10-1、Redis的事务定义"><a href="#10-1、Redis的事务定义" class="headerlink" title="10.1、Redis的事务定义"></a>10.1、Redis的事务定义</h2><p>Redis事务是一个<strong>单独的隔离操作</strong>：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p><p>Redis事务的主要作用就是<strong>串联多个命令防止别的命令插队</strong>。</p><h2 id="10-2、Multi、Exec、discard"><a href="#10-2、Multi、Exec、discard" class="headerlink" title="10.2、Multi、Exec、discard"></a>10.2、Multi、Exec、discard</h2><ul><li><p>从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，等待按顺序执行（相当于开启事务）</p></li><li><p>直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。（相当于提交事务）</p></li><li><p>组队的过程中可以通过discard来放弃组队。 （相当于事务回滚）</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826105919953.png" alt="image-20220826105919953"></p><p>案例：</p><p>exec:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826111113774.png" alt="image-20220826111113774" style="zoom:67%;" /></p><p>discard:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826111253308.png" alt="image-20220826111253308" style="zoom:67%;" /></p><p>组队阶段出错（如果组队阶段出错，所有命令都不执行）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826111500581.png" alt="image-20220826111500581" style="zoom:67%;" /></p><p>组队阶段成功，执行阶段出错（除了出错的命令都会成功）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826111840955.png" alt="image-20220826111840955" style="zoom: 80%;" /></p><h2 id="10-4、悲观锁"><a href="#10-4、悲观锁" class="headerlink" title="10.4、悲观锁"></a>10.4、悲观锁</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826141543634.png" alt="image-20220826141543634" style="zoom:50%;" /></p><p><strong>悲观锁(Pessimistic Lock)</strong>, 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。<strong>传统的关系型数据库里边就用到了很多这种锁机制</strong>，比如<strong>行锁</strong>，<strong>表锁</strong>等，<strong>读锁</strong>，<strong>写锁</strong>等，都是在做操作之前先上锁。</p><h2 id="10-5、乐观锁"><a href="#10-5、乐观锁" class="headerlink" title="10.5、乐观锁"></a>10.5、乐观锁</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826141623532.png" alt="image-20220826141623532" style="zoom:50%;" /></p><p><strong>乐观锁(Optimistic Lock),</strong> 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。<strong>乐观锁适用于多读的应用类型，这样可以提高吞吐量</strong>。Redis就是利用这种check-and-set机制实现事务的。</p><h3 id="10-5-1、watch"><a href="#10-5-1、watch" class="headerlink" title="10.5.1、watch"></a>10.5.1、watch</h3><blockquote><p>使用watch监视一个key</p></blockquote><p>在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务<strong>执行之前 这个(或这些) key被其他命令所改动，那么事务将被打断。</strong></p><h3 id="10-5-2、unwatch"><a href="#10-5-2、unwatch" class="headerlink" title="10.5.2、unwatch"></a>10.5.2、unwatch</h3><blockquote><p>取消watch命令对所有key的监视</p></blockquote><h2 id="10-6、Redis事务三特性"><a href="#10-6、Redis事务三特性" class="headerlink" title="10.6、Redis事务三特性"></a>10.6、Redis事务三特性</h2><ul><li><p>单独的隔离操作</p><p>  事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。 </p></li><li><p>没有隔离级别的概念</p><p>  队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行</p></li><li><p>不保证原子性</p><p>  事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚 </p></li></ul><h1 id="十一、秒杀案例"><a href="#十一、秒杀案例" class="headerlink" title="十一、秒杀案例"></a>十一、秒杀案例</h1><p>看视频吧，我没动手写。</p><h1 id="十二、Redis持久化之RDB"><a href="#十二、Redis持久化之RDB" class="headerlink" title="十二、Redis持久化之RDB"></a>十二、Redis持久化之RDB</h1><h2 id="12-1、总体介绍"><a href="#12-1、总体介绍" class="headerlink" title="12.1、总体介绍"></a>12.1、总体介绍</h2><blockquote><p>官网介绍：<a href="http://www.redis.io">http://www.redis.io</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826154814431.png" alt="image-20220826154814431"></p></blockquote><p>Redis 提供了2个不同形式的持久化方式。</p><ul><li><p>RDB（Redis DataBase）</p></li><li><p>AOF（Append Of File）</p></li></ul><h2 id="12-2、RDB（Redis-DataBase）"><a href="#12-2、RDB（Redis-DataBase）" class="headerlink" title="12.2、RDB（Redis DataBase）"></a>12.2、RDB（Redis DataBase）</h2><h3 id="12-2-1、官网介绍"><a href="#12-2-1、官网介绍" class="headerlink" title="12.2.1、官网介绍"></a>12.2.1、官网介绍</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826154850036.png" alt="image-20220826154850036"></p><h3 id="12-2-2、是什么"><a href="#12-2-2、是什么" class="headerlink" title="12.2.2、是什么"></a>12.2.2、是什么</h3><p>在指定的<strong>时间间隔</strong>内将内存中的数据集<strong>快照</strong>写入磁盘， 也就是行话讲的<strong>Snapshot快照</strong>，它恢复时是将快照文件直接读到内存里</p><h3 id="12-2-3、备份是如何执行的"><a href="#12-2-3、备份是如何执行的" class="headerlink" title="12.2.3、备份是如何执行的"></a>12.2.3、备份是如何执行的</h3><p>Redis会单独创建（fork）一个子进程来进行持久化，会<strong>先将数据写入到 一个==临时文件==中</strong>，待持久化过程都结束了，再用这个==临时文件替换上次持久化好的文件==。 整个过程中，<strong>主进程是不进行任何IO操作的</strong>，这就 <strong>确保了极高的性能</strong> 如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。<strong>RDB的缺点</strong>是最后一次持久化后的数据可能丢失。</p><h3 id="12-2-4、Fork"><a href="#12-2-4、Fork" class="headerlink" title="12.2.4、Fork"></a>12.2.4、Fork</h3><ul><li><p>Fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等） 数值都和原进程一致，但是是一个全新的进程，并<strong>作为原进程的子进程</strong>。</p></li><li><p>在Linux程序中，fork()会产生一个和父进程完全相同的子进程，但子进程在此后多会 exec 系统调用，出于效率考虑，Linux中引入了“<strong>写时复制技术</strong>”</p></li><li><p><strong>一般情况父进程和子进程会共用同一段物理内存</strong>，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。</p></li></ul><h3 id="12-2-5、持久化流程"><a href="#12-2-5、持久化流程" class="headerlink" title="12.2.5、持久化流程"></a>12.2.5、持久化流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826155347759.png" alt="image-20220826155347759" style="zoom:67%;" /></p><h3 id="12-2-6、dump-rdb"><a href="#12-2-6、dump-rdb" class="headerlink" title="12.2.6、dump.rdb"></a>12.2.6、dump.rdb</h3><p>在 redis.conf 中配置文件名称，默认为 dump.rdb</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826155622341.png" alt="image-20220826155622341" style="zoom:50%;" /></p><h3 id="12-2-7、配置位置"><a href="#12-2-7、配置位置" class="headerlink" title="12.2.7、配置位置"></a>12.2.7、配置位置</h3><p>rdb文件的保存路径，也可以修改。默认为Redis启动时命令行所在的目录下</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826155744603.png" alt="image-20220826155744603" style="zoom: 50%;" /></p><h3 id="12-2-8、触发RDB快照；保持策略"><a href="#12-2-8、触发RDB快照；保持策略" class="headerlink" title="12.2.8、触发RDB快照；保持策略"></a>12.2.8、触发RDB快照；保持策略</h3><h4 id="12-2-8-1、配置文件中默认的快照配置"><a href="#12-2-8-1、配置文件中默认的快照配置" class="headerlink" title="12.2.8.1、配置文件中默认的快照配置"></a>12.2.8.1、配置文件中默认的快照配置</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826155850234.png" alt="image-20220826155850234" style="zoom:50%;" /></p><p>解释一个就行了：</p><p>save 3600 1：表示在 3600 秒内，有 1 个key发生变化就执行替换操作。执行替换操作之后又继续记录时间和发生变化的key的个数。</p><h4 id="12-2-8-2、save-命令-VS-bgsave-命令"><a href="#12-2-8-2、save-命令-VS-bgsave-命令" class="headerlink" title="12.2.8.2、save 命令 VS bgsave 命令"></a>12.2.8.2、save 命令 VS bgsave 命令</h4><ul><li><code>save</code>：save时只管保存，其它不管，全部阻塞。手动保存。<strong>不建议</strong>。</li><li><code>bgsave</code>：<strong>Redis会在后台异步进行快照操作， 快照同时还可以响应客户端请求。</strong></li></ul><p>可以通过 <code>lastsave</code> 命令获取最后一次成功执行快照的时间</p><h4 id="12-2-8-3、flushall-命令"><a href="#12-2-8-3、flushall-命令" class="headerlink" title="12.2.8.3、flushall 命令"></a>12.2.8.3、flushall 命令</h4><p>执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义</p><h4 id="12-2-8-4、save-命令"><a href="#12-2-8-4、save-命令" class="headerlink" title="12.2.8.4、save 命令"></a>12.2.8.4、save 命令</h4><p>格式：save 秒钟 写操作次数</p><p>RDB是整个内存的压缩过的Snapshot，RDB的数据结构，可以配置复合的快照触发条件，</p><p>默认是 1 分钟内改了 1 万次，或5 分钟内改了 10 次，或15 分钟内改了1次</p><p>不适用save（禁用）：不设置save指令，或者给save传入空字符串</p><h4 id="12-2-8-5、stop-writes-on-bgsave-error"><a href="#12-2-8-5、stop-writes-on-bgsave-error" class="headerlink" title="12.2.8.5、stop-writes-on-bgsave-error"></a>12.2.8.5、stop-writes-on-bgsave-error</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826161400040.png" alt="image-20220826161400040" style="zoom:67%;" /></p><p>当Redis无法写入磁盘的话，直接关掉Redis的写操作。<strong>推荐yes</strong>.</p><h4 id="12-2-8-6、rdbcompression-压缩文件"><a href="#12-2-8-6、rdbcompression-压缩文件" class="headerlink" title="12.2.8.6、rdbcompression 压缩文件"></a>12.2.8.6、rdbcompression 压缩文件</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826161439478.png" alt="image-20220826161439478" style="zoom:67%;" /></p><p>对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。</p><p>如果不想消耗CPU来进行压缩的话，可以设置为关闭此功能。<strong>推荐yes</strong>.</p><h4 id="12-2-8-7、rdbchecksum-检查完整性"><a href="#12-2-8-7、rdbchecksum-检查完整性" class="headerlink" title="12.2.8.7、rdbchecksum 检查完整性"></a>12.2.8.7、rdbchecksum 检查完整性</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826162236514.png" alt="image-20220826162236514" style="zoom:67%;" /></p><p>在存储快照后，还可以让redis使用CRC64算法来进行数据校验，</p><p>但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能。<strong>推荐yes</strong>.</p><h4 id="12-2-8-8、rdb的备份"><a href="#12-2-8-8、rdb的备份" class="headerlink" title="12.2.8.8、rdb的备份"></a>12.2.8.8、rdb的备份</h4><ol><li><p>先通过 <code>config get dir</code> 查询 rdb文件的目录 </p></li><li><p>将 <code>*.rdb</code> 的文件拷贝到别的地方</p></li><li><p>rdb 的恢复:</p><ul><li>关闭Redis</li><li>先把备份的文件拷贝到工作目录下 <code>cp dump2.rdb dump.rdb</code></li><li>启动Redis, 备份数据会直接加载</li></ul></li></ol><h3 id="12-2-9、优势"><a href="#12-2-9、优势" class="headerlink" title="12.2.9、优势"></a>12.2.9、优势</h3><ul><li><p>适合大规模的数据恢复</p></li><li><p>对数据完整性和一致性要求不高更适合使用</p></li><li><p>节省磁盘空间</p></li><li><p>恢复速度快</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826162526604.png" alt="image-20220826162526604" style="zoom:67%;" /></p><h3 id="12-2-10、劣势"><a href="#12-2-10、劣势" class="headerlink" title="12.2.10、劣势"></a>12.2.10、劣势</h3><ul><li><p>Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑</p></li><li><p>虽然Redis在fork时使用了<strong>写时拷贝技术</strong>,但是如果数据庞大时还是比较消耗性能。</p></li><li><p>在备份周期在一定间隔时间做一次备份，所以如果Redis意外down掉的话，就会丢失最后一次快照后的所有修改。</p></li></ul><h3 id="12-2-11、如何停止"><a href="#12-2-11、如何停止" class="headerlink" title="12.2.11、如何停止"></a>12.2.11、如何停止</h3><p>动态停止RDB：<code>redis-cli config set save &quot;&quot;</code> </p><p>save后给空值，表示禁用保存策略</p><h3 id="12-2-12、总结"><a href="#12-2-12、总结" class="headerlink" title="12.2.12、总结"></a>12.2.12、总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826162732185.png" alt="image-20220826162732185"></p><h1 id="十三、Redis持久化之AOF"><a href="#十三、Redis持久化之AOF" class="headerlink" title="十三、Redis持久化之AOF"></a>十三、Redis持久化之AOF</h1><h2 id="13-1-AOF（Append-Only-File）"><a href="#13-1-AOF（Append-Only-File）" class="headerlink" title="13.1 AOF（Append Only File）"></a>13.1 AOF（Append Only File）</h2><h3 id="13-1-1-是什么"><a href="#13-1-1-是什么" class="headerlink" title="13.1.1 是什么"></a>13.1.1 是什么</h3><p>以<strong>日志</strong>的形式来记录每个写操作（增量保存），将Redis执行过的所有写指令记录下来(<strong>读操作不记录</strong>)， <strong>只许追加文件但不可以改写文件</strong>，redis启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p><h3 id="13-1-2、AOF持久化流程"><a href="#13-1-2、AOF持久化流程" class="headerlink" title="13.1.2、AOF持久化流程"></a>13.1.2、AOF持久化流程</h3><ol><li><p>客户端的请求写命令会被append追加到AOF缓冲区内；</p></li><li><p>AOF缓冲区根据AOF持久化策略[always,everysec,no]将操作sync同步到磁盘的AOF文件中；</p></li><li><p>AOF文件大小超过重写策略或手动重写时，会对AOF文件rewrite重写，压缩AOF文件容量；</p></li><li><p>Redis服务重启时，会重新load加载AOF文件中的写操作达到数据恢复的目的；</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826163405116.png" alt="image-20220826163405116" style="zoom:50%;" /></p><h3 id="13-1-3、AOF默认不开启"><a href="#13-1-3、AOF默认不开启" class="headerlink" title="13.1.3、AOF默认不开启"></a>13.1.3、AOF默认不开启</h3><p>可以在redis.conf中配置文件名称，默认为 <code>appendonly.aof</code></p><p>AOF文件的保存路径，同RDB的路径一致。</p><h3 id="13-1-4、AOF-和-RDB-同时开启，redis执行哪一个？"><a href="#13-1-4、AOF-和-RDB-同时开启，redis执行哪一个？" class="headerlink" title="13.1.4、AOF 和 RDB 同时开启，redis执行哪一个？"></a>13.1.4、AOF 和 RDB 同时开启，redis执行哪一个？</h3><p>AOF和RDB同时开启，系统默认取AOF的数据（数据不会存在丢失）</p><h3 id="13-1-5、AOF-启动、修复、恢复"><a href="#13-1-5、AOF-启动、修复、恢复" class="headerlink" title="13.1.5、AOF 启动、修复、恢复"></a>13.1.5、AOF 启动、修复、恢复</h3><ul><li><p>AOF的备份机制和性能虽然和RDB不同, 但是备份和恢复的操作同RDB一样，都是拷贝备份文件，需要恢复时再拷贝到Redis工作目录下，启动系统即加载。</p></li><li><p>正常恢复</p><ul><li><p>修改默认的appendonly no，改为yes</p></li><li><p>将有数据的aof文件复制一份保存到对应目录(查看目录：config get dir)</p></li><li><p>恢复：重启redis然后重新加载</p></li></ul></li><li><p>异常恢复</p><ul><li><p>修改默认的appendonly no，改为yes</p></li><li><p>如遇到<strong>AOF文件损坏</strong>，通过/usr/local/bin/<strong>redis-check-aof—fix appendonly.aof</strong>进行恢复</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix appendonly.aof</span><br></pre></td></tr></table></figure></li><li><p>备份被写坏的AOF文件</p></li><li><p>恢复：重启redis，然后重新加载</p></li></ul></li></ul><h3 id="13-1-6-AOF同步频率设置（持久化策略）"><a href="#13-1-6-AOF同步频率设置（持久化策略）" class="headerlink" title="13.1.6 AOF同步频率设置（持久化策略）"></a>13.1.6 AOF同步频率设置（持久化策略）</h3><ul><li><p>appendfsync always</p><p>  始终同步，每次Redis的写入都会立刻记入日志；性能较差但数据完整性比较好</p></li><li><p>appendfsync everysec</p><p>  每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失。</p></li><li><p>appendfsync no</p><p>  redis不主动进行同步，把同步时机交给操作系统。</p></li></ul><h3 id="13-1-7、Rewrite-压缩"><a href="#13-1-7、Rewrite-压缩" class="headerlink" title="13.1.7、Rewrite 压缩"></a>13.1.7、Rewrite 压缩</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826170710759.png" alt="image-20220826170710759"></p><ol><li><p>是什么</p><p> AOF采用文件追加方式，文件会越来越大为避免出现此种情况，新增了重写机制, 当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩， 只保留可以恢复数据的最小指令集.可以使用命令bgrewriteaof</p></li><li><p>重写原理，如何实现重写</p><p> AOF文件持续增长而过大时，会fork出一条新进程来将文件重写(也是先写临时文件最后再rename)，redis4.0版本后的重写，是指上就是把 rdb 的快照，以<strong>二级制</strong>的形式附在<strong>新的aof头部</strong>，作为已有的历史数据，替换掉原来的流水账操作。</p><ul><li><p>no-appendfsync-on-rewrite：</p><ul><li>如果 no-appendfsync-on-rewrite=yes ,不写入aof文件只写入缓存，用户请求不会阻塞，但是在这段时间如果宕机会丢失这段时间的缓存数据。（降低数据安全性，提高性能）</li><li>如果 no-appendfsync-on-rewrite=no, 还是会把数据往磁盘里刷，但是遇到重写操作，可能会发生阻塞。（数据安全，但是性能降低）</li></ul></li><li><p>触发机制，何时重写</p><p>  Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发</p><p>重写虽然可以节约大量磁盘空间，减少恢复时间。但是每次重写还是有一定的负担的，因此设定Redis要满足一定条件才会进行重写。 </p></li><li><p>auto-aof-rewrite-percentage：设置重写的基准值，文件达到100%时开始重写（文件是原来重写后文件的2倍时触发）</p></li><li><p>auto-aof-rewrite-min-size：设置重写的基准值，最小文件64MB。达到这个值开始重写。</p><p>例如：文件达到70MB开始重写，降到50MB，下次什么时候开始重写？100MB</p><p>系统载入时或者上次重写完毕时，Redis会记录此时AOF大小，设为base_size,</p><p>如果Redis的AOF当前大小 &gt;= base_size +base_size*100% (默认)且当前大小&gt;=64mb(默认)的情况下，Redis会对AOF进行重写。 </p></li></ul></li><li><p>重写流程</p><ol><li>bgrewriteaof触发重写，判断是否当前有bgsave或bgrewriteaof在运行，如果有，则等待该命令结束后再继续执行。</li><li>主进程fork出子进程执行重写操作，保证主进程不会阻塞。</li><li>子进程遍历redis内存中数据到临时文件，客户端的写请求同时写入aof_buf缓冲区和aof_rewrite_buf重写缓冲区保证原AOF文件完整以及新AOF文件生成期间的新的数据修改动作不会丢失。</li><li>子进程写完新的AOF文件后，向主进程发信号，父进程更新统计信息。</li><li>主进程把aof_rewrite_buf中的数据写入到新的AOF文件。</li><li>使用新的AOF文件覆盖旧的AOF文件，完成AOF重写。</li></ol></li></ol><h3 id="13-1-8、优势"><a href="#13-1-8、优势" class="headerlink" title="13.1.8、优势"></a>13.1.8、优势</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826170959394.png" alt="image-20220826170959394" style="zoom:67%;" /></p><ul><li>备份机制更稳健，丢失数据概率更低。</li><li>可读的日志文本，通过操作AOF稳健，可以处理误操作。</li></ul><h3 id="13-1-9、劣势"><a href="#13-1-9、劣势" class="headerlink" title="13.1.9、劣势"></a>13.1.9、劣势</h3><ul><li><p>比起RDB占用更多的磁盘空间。</p></li><li><p>恢复备份速度要慢。</p></li><li><p>每次读写都同步的话，有一定的性能压力。</p></li><li><p>存在个别Bug，造成恢复不能。</p></li></ul><h3 id="13-1-10、总结"><a href="#13-1-10、总结" class="headerlink" title="13.1.10、总结"></a>13.1.10、总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826171116796.png" alt="image-20220826171116796"></p><h1 id="十二——十三、用哪个好"><a href="#十二——十三、用哪个好" class="headerlink" title="十二——十三、用哪个好"></a>十二——十三、用哪个好</h1><p>官方推荐两个都启用。</p><p>如果对数据不敏感，也就是允许部分数据丢失，可以选单独用RDB。</p><p>不建议单独用 AOF，因为可能会出现Bug。</p><p>如果只是做纯内存缓存，可以都不用。</p><p>官网建议：</p><ul><li><p>RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储</p></li><li><p>AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾. </p></li><li>Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大</li><li>只做缓存：如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.</li><li>同时开启两种持久化方式</li><li>在这种情况下,当redis重启的时候会优先载入AOF文件来恢复原始的数据, 因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整.</li><li>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。那要不要只使用AOF呢？</li><li>建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份)， 快速重启，而且不会有AOF可能潜在的bug，留着作为一个万一的手段。</li></ul><p>性能建议：</p><blockquote><p>因为RDB文件只用作后备用途，建议只在 <strong>Slave上持久化RDB文件</strong>，而且只要15分钟备份一次就够了，只保留<strong>save 900 1</strong>这条规则。</p><p>如果使用AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了。</p><p>代价,一是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。</p><p>只要硬盘许可，应该尽量减少AOF  rewrite的频率，AOF重写的基础大小默认值 <strong>64M太小</strong> 了，可以设到 <strong>5G</strong> 以上。</p><p>默认超过原大小100%大小时重写可以改到适当的数值。  </p></blockquote><h1 id="十四、主从复制"><a href="#十四、主从复制" class="headerlink" title="十四、主从复制"></a>十四、主从复制</h1><h2 id="14-1、是什么"><a href="#14-1、是什么" class="headerlink" title="14.1、是什么"></a>14.1、是什么</h2><p>主机数据更新后根据配置和策略， 自动同步到备机的 <code>master/slaver</code> 机制，<strong>Master</strong>以<strong>写</strong>为主，<strong>Slaver</strong>以<strong>读</strong>为主</p><h2 id="14-2、能干嘛"><a href="#14-2、能干嘛" class="headerlink" title="14.2、能干嘛"></a>14.2、能干嘛</h2><ul><li><p>读写分离，性能扩展</p></li><li><p>容灾快速恢复</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826182302989.png" alt="image-20220826182302989" style="zoom:67%;" /></p><h2 id="14-3、怎么用"><a href="#14-3、怎么用" class="headerlink" title="14.3、怎么用"></a>14.3、怎么用</h2><p>看视频，看文档，看笔记</p><p>网络下显示：</p><p><code>&lt;iframe src=&quot;//player.bilibili.com/player.html?aid=247670776&amp;bvid=BV1Rv41177Af&amp;cid=326382019&amp;page=32&quot; scrolling=&quot;no&quot; border=&quot;1px&quot; width=100% height=550px frameborder=&quot;no&quot; framespacing=&quot;0&quot; allowfullscreen=&quot;true&quot;&gt;&lt;/iframe&gt;</code></p><h2 id="14-4、常用3招"><a href="#14-4、常用3招" class="headerlink" title="14.4、常用3招"></a>14.4、常用3招</h2><h3 id="14-4-1、一主二仆"><a href="#14-4-1、一主二仆" class="headerlink" title="14.4.1、一主二仆"></a>14.4.1、一主二仆</h3><ul><li><p>切入点问题？slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的k1,k2,k3是否也可以复制？</p><p>  不可以</p></li><li><p>从机是否可以写？set可否？</p><p>  不可写</p></li><li><p>主机shutdown后情况如何？从机是上位还是原地待命？</p><p>  原地待命</p></li><li><p>主机又回来了后，主机新增记录，从机还能否顺利复制？ </p><p>  能</p></li><li><p>其中一台从机down后情况如何？依照原有它能跟上大部队吗？</p><p>  恢复之后能跟上之后的数据，down的这段时间的数据就没有了</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826184632972.png" alt="image-20220826184632972" style="zoom: 80%;" /></p><h3 id="14-4-2、薪火相传"><a href="#14-4-2、薪火相传" class="headerlink" title="14.4.2、薪火相传"></a>14.4.2、薪火相传</h3><blockquote><p>就像是N叉树一样</p></blockquote><p>上一个Slave可以是下一个slave的Master，Slave同样可以接收其他 slaves的连接和同步请求，那么该slave作为了链条中下一个的master, 可以有效减轻master的写压力,去中心化降低风险。</p><p>用 <code>slaveof &lt;ip&gt; &lt;port&gt;</code></p><p>中途变更转向：会清除之前的数据，重新建立拷贝最新的</p><p>风险是一旦某个slave宕机，后面的slave都没法备份</p><p>主机挂了，从机还是从机，无法写数据了</p><h3 id="14-4-3、反客为主"><a href="#14-4-3、反客为主" class="headerlink" title="14.4.3、反客为主"></a>14.4.3、反客为主</h3><p>当一个master宕机后，后面的slave可以立刻升为master，其后面的slave不用做任何修改。</p><p>用 <code>slaveof no one</code>  将从机变为主机。<strong>如果不用命令就不会反客为主</strong></p><p>但是如果输入命令也需要人力，还不如快速再把主机重启。</p><p>自动化的反客为主：<a href="#14.6、哨兵模式">14.6、哨兵模式</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826214212693.png" alt="image-20220826214212693"></p><h2 id="14-5、复制原理"><a href="#14-5、复制原理" class="headerlink" title="14.5、复制原理"></a>14.5、复制原理</h2><ul><li><p>Slave启动成功连接到master后会发送一个sync命令</p></li><li><p>Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</p></li><li><p>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p></li><li>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li><li>但是只要是重新连接master,一次完全同步（全量复制)将被自动执行</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826214304724.png" alt="image-20220826214304724" style="zoom:67%;" /></p><h2 id="14-6、哨兵模式"><a href="#14-6、哨兵模式" class="headerlink" title="14.6、哨兵模式"></a>14.6、哨兵模式</h2><h3 id="14-6-1、是什么"><a href="#14-6-1、是什么" class="headerlink" title="14.6.1、是什么"></a>14.6.1、是什么</h3><p><strong>反客为主的自动版</strong>，能够后台监控主机是否故障，如果故障了<strong>根据投票数</strong>自动将从库转换为主库</p><p>==哨兵不是从服务器，就只是监听主机状态，还有选择<strong>合适</strong>从机做主机（原本主机down了的情况下）==</p><p><strong>之后即使是原本的主机再次上线，新主机也不会再变成从机，而是让原本的主机做新主机的从机</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826215924396.png" alt="image-20220826215924396"></p><h3 id="14-6-2、使用步骤"><a href="#14-6-2、使用步骤" class="headerlink" title="14.6.2、使用步骤"></a>14.6.2、使用步骤</h3><p>看文档</p><h3 id="14-6-3、故障修复"><a href="#14-6-3、故障修复" class="headerlink" title="14.6.3、故障修复"></a>14.6.3、故障修复</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220826220041510.png" alt="image-20220826220041510"></p><ol><li><p>优先级在redis.conf中默认：<code>slave-priority 100</code>，可以自己设置。值越小优先级越高</p></li><li><p>偏移量是指获得原主机数据最全的服务器</p></li><li><p>每个redis实例启动后都会随机生成一个40位的runid</p></li></ol><h2 id="14-7、Java代码实现"><a href="#14-7、Java代码实现" class="headerlink" title="14.7、Java代码实现"></a>14.7、Java代码实现</h2><p>写一个获得哨兵的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> JedisSentinelPool jedisSentinelPool=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>  Jedis <span class="title function_">getJedisFromSentinel</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(jedisSentinelPool==<span class="literal">null</span>)&#123;</span><br><span class="line">        Set&lt;String&gt; sentinelSet=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        sentinelSet.add(<span class="string">&quot;192.168.10.104:26379&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">        jedisPoolConfig.setMaxTotal(<span class="number">10</span>); <span class="comment">//最大可用连接数</span></span><br><span class="line">        jedisPoolConfig.setMaxIdle(<span class="number">5</span>); <span class="comment">//最大闲置连接数</span></span><br><span class="line">        jedisPoolConfig.setMinIdle(<span class="number">5</span>); <span class="comment">//最小闲置连接数</span></span><br><span class="line">        jedisPoolConfig.setBlockWhenExhausted(<span class="literal">true</span>); <span class="comment">//连接耗尽是否等待</span></span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(<span class="number">2000</span>); <span class="comment">//等待时间</span></span><br><span class="line">        jedisPoolConfig.setTestOnBorrow(<span class="literal">true</span>); <span class="comment">//取连接的时候进行一下测试 ping pong</span></span><br><span class="line"></span><br><span class="line">        jedisSentinelPool=<span class="keyword">new</span> <span class="title class_">JedisSentinelPool</span>(<span class="string">&quot;mymaster&quot;</span>,sentinelSet,jedisPoolConfig);</span><br><span class="line">        <span class="keyword">return</span> jedisSentinelPool.getResource();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisSentinelPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="十五、集群"><a href="#十五、集群" class="headerlink" title="十五、集群"></a>十五、集群</h1><blockquote><p>  集群搭建具体可看我博客的另一篇文章，更加详细。</p></blockquote><h2 id="15-1、问题"><a href="#15-1、问题" class="headerlink" title="15.1、问题"></a>15.1、问题</h2><p>容量不够，redis如何进行扩容？</p><p>并发写操作， redis如何分摊？</p><p>另外，主从模式，薪火相传模式，主机宕机，导致ip地址发生变化，应用程序中配置需要修改对应的主机地址、端口等信息。</p><p><strong>之前</strong>通过<strong>代理主机</strong>来解决，但是redis3.0中提供了解决方案。就是<strong>无中心化集群</strong>配置。</p><h2 id="15-2、什么是集群"><a href="#15-2、什么是集群" class="headerlink" title="15.2、什么是集群"></a>15.2、什么是集群</h2><p>Redis 集群实现了对Redis的水平扩容，即启动N个redis节点，将整个数据库分布存储在这N个节点中，每个节点存储总数据的1/N。</p><p>Redis 集群通过分区（partition）来提供一定程度的可用性（availability）： 即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。</p><h2 id="15-3、删除持久化数据"><a href="#15-3、删除持久化数据" class="headerlink" title="15.3、删除持久化数据"></a>15.3、删除持久化数据</h2><p>将rdb,aof文件都删除掉。</p><h2 id="15-4、搭建模拟集群"><a href="#15-4、搭建模拟集群" class="headerlink" title="15.4、搭建模拟集群"></a>15.4、搭建模拟集群</h2><p>看视频看文档</p><p>主要步骤：</p><ol><li><p>先配置全局配置文件：</p><p> 开启 <code>daemonize yes</code></p><p> Appendonly 关掉或者换名字</p></li><li><p>配置局部配置</p><ul><li><p><code>cluster-enabled yes</code>  打开集群模式</p></li><li><p><code>cluster-config-file nodes-6379.conf</code> 设定节点配置文件名</p></li><li><p><code>cluster-node-timeout 15000</code>  设定节点失联时间，超过该时间（毫秒），集群自动进行主从切换。</p><p>最终配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">include /home/bigdata/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">pidfile &quot;/var/run/redis_6379.pid&quot;</span><br><span class="line">dbfilename &quot;dump6379.rdb&quot;</span><br><span class="line">dir &quot;/home/bigdata/redis_cluster&quot;</span><br><span class="line">logfile &quot;/home/bigdata/redis_cluster/redis_err_6379.log&quot;</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes-6379.conf</span><br><span class="line">cluster-node-timeout 15000</span><br></pre></td></tr></table></figure></li></ul></li><li><p>然后拷贝几份这个局部配置文件，对端口等做修改。</p><p> 可以利用vim快捷方式（例如将6379</p><p> 改成6380）：<code>:%s /6379 /6380</code></p></li><li><p>启动这几个Redis服务</p><p> 例如启动 redis6379 ：<code>redis-server redis6379.conf</code></p><p> 可通过进程命令查看是否成功启动：<code>ps -ef | grep redis</code></p></li><li><p>将节点合成一个集群</p><p> 组合之前，请确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827103308069.png" alt="image-20220827103308069" style="zoom: 50%;" /></p><p> 合体：</p><ol><li><p>进入redis安装目录下的src目录</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd  /opt/redis-7.0.4/src</span><br></pre></td></tr></table></figure></li><li><p>集群化启动</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create --cluster-replicas 1 192.168.11.101:6379 192.168.11.101:6380 192.168.11.101:6381 192.168.11.101:6389 192.168.11.101:6390 192.168.11.101:6391</span><br></pre></td></tr></table></figure><p> 此处不要用127.0.0.1， 请用真实IP地址</p><p> —replicas 1 采用最简单的方式配置集群，一台主机，一台从机，正好三组。</p></li></ol></li><li><p>登录集群</p><p> 可能直接进入读主机，存储数据时，会出现MOVED重定向操作。所以，应该以集群方式登录。</p></li><li><p>切换到相应的写主机</p><p> 使用 -c 选项</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -p 6379</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827153712835.png" alt="image-20220827153712835" style="zoom:50%;" /></p></li><li><p>查看集群信息</p><p> 通过 <code>cluster nodes</code> 命令</p></li></ol><hr><blockquote><p>redis cluster <strong>如何分配这六个节点?</strong></p></blockquote><p>一个集群至少要有三个主节点。</p><p>选项 <code>--cluster-replicas 1</code> 表示我们希望为集群中的每个主节点创建一个从节点。</p><p>分配原则尽量保证每个主数据库运行在不同的IP地址，<strong>每个从库和主库不在一个IP地址上</strong>。</p><hr><blockquote><p>什么是插槽？</p></blockquote><p><strong>[OK] All nodes agree about slots configuration.</strong></p><p><strong>&gt;&gt;&gt; Check for open slots…</strong></p><p><strong>&gt;&gt;&gt; Check slots coverage…</strong></p><p><strong>[OK] All 16384 slots covered.</strong></p><p>一个 Redis 集群包含 16384 个插槽（hash slot）， 数据库中的每个键都属于这 16384 个插槽的其中一个， </p><p>集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 。</p><p>集群中的每个节点负责处理一部分插槽。 举个例子， 如果一个集群可以有主节点， 其中：</p><p>节点 A 负责处理 0 号至 5460 号插槽。</p><p>节点 B 负责处理 5461 号至 10922 号插槽。</p><p>节点 C 负责处理 10923 号至 16383 号插槽。</p><hr><blockquote><p>在集群中 <strong>录入</strong> 值</p></blockquote><p>在redis-cli每次录入、查询键值，redis都会计算出该key应该送往的插槽，如果不是该客户端对应服务器的插槽，redis会报错，并告知应前往的redis实例地址和端口。</p><p>redis-cli客户端提供了 –c 参数实现自动重定向。</p><p>如 redis-cli -c –p 6379 登入后，再录入、查询键值对可以自动重定向。</p><p>不在一个slot下的键值，是不能使用mget,mset等多键操作。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827154211315.png" alt="image-20220827154211315" style="zoom:67%;" /></p><p>可以通过{}来定义组的概念，从而使key中{}内相同内容的键值对放到一个slot中去。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827154225033.png" alt="image-20220827154225033" style="zoom:67%;" /></p><hr><blockquote><p>在集群中 <strong>查询</strong> 值</p></blockquote><p><code>CLUSTER GETKEYSINSLOT &lt;slot&gt;&lt;count&gt;</code> 返回 <code>&lt;count&gt;</code> 个 <code>&lt;slot&gt;</code> 槽中的键。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827154333884.png" alt="image-20220827154333884" style="zoom:67%;" /></p><hr><blockquote><p>故障恢复</p></blockquote><p>如果主节点下线？从节点能否自动升为主节点？注意：<strong>15秒超时</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827154409693.png" alt="image-20220827154409693"></p><p>主节点恢复后，主从关系会如何？主节点回来变成从机。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220827154445110.png" alt="image-20220827154445110"></p><p>如果所有某一段插槽的主从节点都宕掉，redis服务是否还能继续?</p><p>如果某一段插槽的主从都挂掉，而 <code>cluster-require-full-coverage</code> 为yes ，那么 ，整个集群都挂掉</p><p>如果某一段插槽的主从都挂掉，而 <code>cluster-require-full-coverage</code> 为no ，那么，该插槽数据全都不能使用，也无法存储。</p><p>redis.conf中的参数 <code>cluster-require-full-coverage</code></p><h2 id="15-5、集群的Jedis开发"><a href="#15-5、集群的Jedis开发" class="headerlink" title="15.5、集群的Jedis开发"></a>15.5、集群的Jedis开发</h2><p>即使连接的不是主机，集群会自动切换主机存储。主机写，从机读。</p><p>==无中心化主从集群。无论从哪台主机写的数据，其他主机上都能读到数据。==</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisClusterTest</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; </span><br><span class="line">Set&lt;HostAndPort&gt;set =<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;HostAndPort&gt;();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">HostAndPort</span>(<span class="string">&quot;192.168.10.104&quot;</span>,<span class="number">6379</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// new 的是JedisCluster</span></span><br><span class="line">        JedisCluster jedisCluster=<span class="keyword">new</span> <span class="title class_">JedisCluster</span>(set);</span><br><span class="line">        jedisCluster.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        System.out.println(jedisCluster.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-6、集群优势"><a href="#15-6、集群优势" class="headerlink" title="15.6、集群优势"></a>15.6、集群优势</h2><p>实现扩容</p><p>分摊压力</p><p>无中心配置相对简单</p><h2 id="15-7、集群不足"><a href="#15-7、集群不足" class="headerlink" title="15.7、集群不足"></a>15.7、集群不足</h2><p>多键操作是不被支持的 </p><p>多键的Redis事务是不被支持的。lua脚本不被支持</p><p>由于集群方案出现较晚，很多公司已经采用了其他的集群方案，而代理或者客户端分片的方案想要迁移至redis cluster，需要整体迁移而不是逐步过渡，复杂度较大。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 大数据开发 </category>
          
          <category> 后端 </category>
          
          <category> Redis </category>
          
          <category> 技术 </category>
          
          <category> 中间件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Linux </tag>
            
            <tag> Java后端 </tag>
            
            <tag> Redis </tag>
            
            <tag> 中间件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MapReduce</title>
      <link href="/posts/3156194925.html"/>
      <url>/posts/3156194925.html</url>
      
        <content type="html"><![CDATA[<details>此笔记是我学习 B站 尚硅谷相关课程的学习笔记</details><blockquote><p><strong>项目源码：</strong><a href="https://github.com/YongRuiZhang/hadoop_study_demo">https://github.com/YongRuiZhang/hadoop_study_demo</a></p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817181510929.png" alt="image-20220817181510929"  style="zoom:33%;" /></p><h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h1><h2 id="1-1-、定义"><a href="#1-1-、定义" class="headerlink" title="1.1 、定义"></a>1.1 、定义</h2><p>MapReduce 是一个<strong>分布式运算程序</strong>的<strong>编程框架</strong>，是用户开发“基于 Hadoop 的数据分析应用”的核心框架。</p><p>MapReduce 核心功能是<strong>将用户编写的业务逻辑代码</strong>和<strong>自带默认组件</strong>整合成一个完整的<strong>分布式运算程序</strong>，并发运行在一个 Hadoop 集群上。</p><h2 id="1-2、优缺点"><a href="#1-2、优缺点" class="headerlink" title="1.2、优缺点"></a>1.2、优缺点</h2><h3 id="1-2-1、优点"><a href="#1-2-1、优点" class="headerlink" title="1.2.1、优点"></a>1.2.1、优点</h3><ol><li><p>易于编程</p><p> <strong>它简单的实现一些接口，就可以完成一个分布式程序</strong>，这个分布式程序可以分布到大量廉价的 PC 机器上运行。也就是说你写一个分布式程序，跟写一个简单的串行程序是一模一 样的。就是因为这个特点使得 MapReduce 编程变得非常流行。</p></li><li><p>良好的扩展性</p><p> 当你的计算资源不能得到满足的时候，你可以通过<strong>简单的增加机器</strong>来扩展它的计算能力。</p></li><li><p>高容错性</p><p> MapReduce 设计的初衷就是使程序能够部署在廉价的 PC 机器上，这就要求它具有很高的容错性。比如<strong>其中一台机器挂了，它可以把上面的计算任务转移到另外一个节点上运行， 不至于这个任务运行失败</strong>，而且这个过程<strong>不需要人工参与</strong>，而完全是由 Hadoop 内部完成的。</p></li><li><p>适合 <strong>PB 级</strong>以上海量数据的<strong>离线处理</strong></p><p> 可以实现上千台服务器集群并发工作，提供数据处理能力。</p></li></ol><h3 id="1-2-2、缺点"><a href="#1-2-2、缺点" class="headerlink" title="1.2.2、缺点"></a>1.2.2、缺点</h3><ol><li><p>不擅长实时计算</p><p> MapReduce 无法像 MySQL 一样，在毫秒或者秒级内返回结果。</p></li><li><p>不擅长流式计算</p><p> 流式计算的输入数据是动态的，而 MapReduce 的<strong>输入数据集是静态的</strong>，不能动态变化。这是因为 MapReduce 自身的设计特点决定了数据源必须是静态的。</p></li><li><p>）不擅长 DAG（有向无环图）计算</p><p> 多个应用程序<strong>存在依赖关系</strong>，后一个应用程序的输入为前一个的输出。在这种情况下， MapReduce 并不是不能做，而是使用后，<strong>每个 MapReduce 作业的输出结果都会写入到磁盘， 会造成大量的磁盘 IO，导致性能非常的低下。</strong></p></li></ol><h2 id="1-3、核心思想"><a href="#1-3、核心思想" class="headerlink" title="1.3、核心思想"></a>1.3、核心思想</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817192236901.png" alt="image-20220817192236901"></p><ol><li>分布式的运算程序往往需要分成至少 2 个阶段。</li><li>第一个阶段的 MapTask 并发实例，完全并行运行，互不相干。</li><li>第二个阶段的 ReduceTask 并发实例互不相干，但是他们的数据依赖于上一个阶段 的所有 MapTask 并发实例的输出。</li><li>MapReduce 编程模型只能包含一个 Map 阶段和一个 Reduce 阶段，如果用户的业 务逻辑非常复杂，那就只能多个 MapReduce 程序，串行运行。</li></ol><p>总结：分析 WordCount 数据流走向深入理解 MapReduce 核心思想。</p><p>Map阶段是切分操作，Reduce阶段是计算操作</p><p>==WordCount相当于就是HelloWorld程序一样==</p><h2 id="1-4、MapReduce-进程"><a href="#1-4、MapReduce-进程" class="headerlink" title="1.4、MapReduce 进程"></a>1.4、MapReduce 进程</h2><p>一个完整的 MapReduce 程序在分布式运行时有三类实例进程： </p><ol><li>MrAppMaster：负责整个程序的过程调度及状态协调。 </li><li>MapTask：负责 Map 阶段的整个数据处理流程。 </li><li>ReduceTask：负责 Reduce 阶段的整个数据处理流程。</li></ol><h2 id="1-5、官方-WordCount-源码"><a href="#1-5、官方-WordCount-源码" class="headerlink" title="1.5、官方 WordCount 源码"></a>1.5、官方 WordCount 源码</h2><p>hadoop包里面由/share文件夹，用来存储官方的一些jar包，其中在<code>/share/hadoop/mapreduce</code>下存了一些mapreduce有关的jar包：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817193846283.png" alt="image-20220817193846283"></p><p>其中 WordCount 就在hadoop-mapreduce-example-3.3.3.jar包中。我们将这个包传到Windows。然后反编译源码。</p><p>==采用反编译工具反编译源码，发现 WordCount 案例有 Map 类、Reduce 类和驱动类。且数据的类型是 Hadoop 自身封装的序列化类型。==</p><h2 id="1-6、重用数据序列化类型"><a href="#1-6、重用数据序列化类型" class="headerlink" title="1.6、重用数据序列化类型"></a>1.6、重用数据序列化类型</h2><div class="table-container"><table><thead><tr><th>Java类型</th><th>Hadoop Writable 类型</th></tr></thead><tbody><tr><td>Boolean</td><td>BooleanWritable</td></tr><tr><td>Byte</td><td>ByteWritable</td></tr><tr><td>Integer / int</td><td>IntWritable</td></tr><tr><td>Float</td><td>FloatWritable</td></tr><tr><td>Long</td><td>LongWritable</td></tr><tr><td>Double</td><td>DoubleWritable</td></tr><tr><td><span style="color:red">String</span></td><td><span style="color:red">Text</span></td></tr><tr><td>Map</td><td>MapWritable</td></tr><tr><td>Array</td><td>ArrayWritable</td></tr><tr><td>Null</td><td>NullWritable</td></tr></tbody></table></div><p>除了标红的一组之外，都是在在原本的类型后面加Writable。</p><h2 id="1-7、MapReduce-编程规范"><a href="#1-7、MapReduce-编程规范" class="headerlink" title="1.7、MapReduce 编程规范"></a>1.7、MapReduce 编程规范</h2><blockquote><p>用户编写的程序分成三个部分：<a href="#1、Mapper">Mapper</a>、<a href="#2、Reducer">Reducer</a>、<a href="#3、Driver">Driver</a>。</p></blockquote><h3 id="1、Mapper"><a href="#1、Mapper" class="headerlink" title="1、Mapper"></a>1、Mapper</h3><ol><li>用户自定义的Mapper要继承自己的父类</li><li>Mapper的输入数据是KV对的形式（KV的类型可自定义）</li><li>Mapper中的业务逻辑写在map（）方法中</li><li>Mapper的输出数据是KV对的形式（KV的类型可自定义）</li><li>map()方法（MapTask进程）对每一个<K,V>调用一次</li></ol><h3 id="2、Reducer"><a href="#2、Reducer" class="headerlink" title="2、Reducer"></a>2、Reducer</h3><ol><li>用户自定义的Reducer要继承之际的父类</li><li>Reducer的输入数据对应Mapper的输出数据类型，也是KV</li><li>Reducer的业务逻辑写在reduce()方法中</li><li>ReduceTask进程对每一组相同k的组调用一次reduce()方法</li></ol><h3 id="3、Driver"><a href="#3、Driver" class="headerlink" title="3、Driver"></a>3、Driver</h3><p>相当于YARN集群的客户端，用于提交我们整个程序到YARN集群，提交的是：封装了MapReduce程序相关运行参数的==job对象==</p><h2 id="1-8、WordCount案例实操"><a href="#1-8、WordCount案例实操" class="headerlink" title="1.8、WordCount案例实操"></a>1.8、WordCount案例实操</h2><h3 id="本地测试"><a href="#本地测试" class="headerlink" title="本地测试"></a>本地测试</h3><ol><li><p>需求</p><p> 在给定的文本文件中统计输出每一个单词出现的总次数</p></li><li><p>需求分析</p><p> 按照 MapReduce 编程规范，分别编写 Mapper，Reducer，Driver。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817200102256.png" alt="image-20220817200102256"></p></li><li><p>环境准备</p><p> 就是创建maven工程，然后引入hadoop依赖，和HDFS的API操作中的一样。</p></li><li><p>编写程序</p><ol><li><p>Mapper</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817202237084.png" alt="image-20220817202237084"></p><p> 第一个是hadoop2.x和hadoop3.x需要继承的类。第二个是hadoop1.x的。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 注意Mapper中的类型都是包org.apache.hadoop.io中的包</p><p> 此时的import：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br></pre></td></tr></table></figure><p> 完整代码：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 输入：</span></span><br><span class="line"><span class="comment"> *      KEY ： LongWritable  // 第几行</span></span><br><span class="line"><span class="comment"> *      VALUE ： Text        // 该行的内容</span></span><br><span class="line"><span class="comment"> * 输出：</span></span><br><span class="line"><span class="comment"> *      KEY ： Text          // 被统计的单词</span></span><br><span class="line"><span class="comment"> *      VALUE ： IntWritable // 该单词的数量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outKEY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outVALUE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写map方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 输入数据的KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 输入数据的VALUE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context 充当上下文，进行map和reduce之间的联络</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, IntWritable&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取一行 zyr zyr zyr</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.切割 [zyr,zyr,zyr]</span></span><br><span class="line">        String[] words = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.循环写出</span></span><br><span class="line">        <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">            <span class="comment">// 封装outKEY</span></span><br><span class="line">            outKEY.set(word);</span><br><span class="line">            <span class="comment">// 写出</span></span><br><span class="line">            context.write(outKEY,outVALUE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Reducer</p><p> 导包规则和Mapper中的一样，不要导错了。</p><p> 完整代码：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.mapreduce.wordcount;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里和Mapper中的输入输出刚好相反</span></span><br><span class="line"><span class="comment"> * 输入：</span></span><br><span class="line"><span class="comment"> *      KEY ： Text          // 被统计的单词</span></span><br><span class="line"><span class="comment"> *      VALUE ： IntWritable // 该单词的数量</span></span><br><span class="line"><span class="comment"> * 输出：</span></span><br><span class="line"><span class="comment"> *      KEY ： Text          // 被统计的单词</span></span><br><span class="line"><span class="comment"> *      VALUE ： IntWritable // 该单词的数量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写reduce</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   输入的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values    输入的value，是一个可迭代对象(不是迭代器，它时一个集合，如果想要遍历它，需要先用value.iterator()得到一个迭代器，或者增强for循环，集合的遍历方式都可)</span></span><br><span class="line"><span class="comment">     *      例如zyr zyr zyr,被mapper弄成了三个，所以传入的K-V实际上是三组 zyr-1。但是Reducer在接收数据时会转化为：zyr-(1,1,1)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context   上下文作用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 累加  zyr-(1,1,1)</span></span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        outValue.set(sum);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 写出</span></span><br><span class="line">        context.write(key,outValue);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Driver</p><p> 写Driver类有固定套路，==最需要注意的是导包（一般就是hadoop中的包，然后两个一样的选长的）==：</p><ol><li>获取配置信息以及获取 job 对象</li><li>关联本 Driver 程序的 jar</li><li>关联 Mapper 和 Reducer 的 jar</li><li>设置 Mapper 输出的 kv 类型</li><li>设置最终输出 kv 类型</li><li>设置输入和输出路径</li><li><p>提交 job</p><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        1. 获取配置信息以及获取 job 对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2. 关联本 Driver 程序的 jar</span></span><br><span class="line">        job.setJarByClass(WordCountDriver.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        3. 关联 Mapper 和 Reducer 的 jar</span></span><br><span class="line">        job.setMapperClass(WordCountMapper.class); <span class="comment">// 关联 Mapper</span></span><br><span class="line">        job.setReducerClass(WordCountReducer.class); <span class="comment">// 关联 Reducer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        4. 设置 Mapper 输出的 kv 类型 ,注意有Map，没有map的是第5步调用的方法</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        5. 设置最终输出 kv 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        6. 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello.txt&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello_output&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        7. 提交 job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);<span class="comment">// 参数true表示需要获取job的工作信息，false不用</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据结果返回值，如果result == true（成功）返回0，如果失败返回1</span></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>本地测试</p><ol><li>需要配置好HADOOP_HOME环境变量以及Windows运行依赖</li><li>在IDEA上运行程序（driver写成的一个main函数）</li></ol></li><li><p>运行结果：</p><ol><li><p>控制台输出很多数据，是因为第7步的时候的参数是true。但是如果不是false也会有很多输出，只是没有true的时候那么多</p></li><li><p>产生一个文件夹，里面有四个文件</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817211510195.png" alt="image-20220817211510195" style="zoom: 50%;" /></p><p> 前面两个是校验。_SUCCESS中啥也没有，第四个文件才是结果。</p></li><li><p>打开part-r-00000,查看结果</p><ul><li><p>part表示部分（块）</p></li><li><p>r表示reducer处理结果，</p></li><li><p>00000是第几块（00000，00001，—-99999），这里数据小，只有00000</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817211805514.png" alt="image-20220817211805514" style="zoom:50%;" /></p><p>发现结果符合预期。</p></li></ul></li></ol></li></ol></li></ol><h2 id="1-9、提交到集群测试"><a href="#1-9、提交到集群测试" class="headerlink" title="1.9、提交到集群测试"></a>1.9、提交到集群测试</h2><p>注意：</p><p>Driver类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello.txt&quot;</span>));</span><br><span class="line">FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello_output&quot;</span>));</span><br></pre></td></tr></table></figure><p>配死了文件的路径，我们需要改一下，不然集群上面没有，会报错。</p><p>改成：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">0</span>]));</span><br><span class="line">FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">1</span>]));</span><br></pre></td></tr></table></figure><p>这样就可以像之前的hadoop自带的WordCount一样使用了。</p><ol><li><p>用maven打jar包，需要添加的打包插件依赖</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      下面配置表示把我们pom中的依赖一起打包进去--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>将程序打成 jar 包</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817214434565.png" alt="image-20220817214434565"></p><p> 可以看出带依赖的打包文件的内存都比较大。（这部分不会可以去学学Maven，Java相关开发一般用得比较多）</p></li><li><p>这里没有用到多余的依赖，Linux上都有，所以用不带依赖的jar包，改名为wc.jar，并拷贝到Hadoop集群的<code>/usr/local/hadoop</code>路径下</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817215101669.png" alt="image-20220817215101669"></p></li><li><p>启动Hadoop集群，创建测试文件夹和文件</p><p> 先创建好输入输出的文件夹，并产生word.txt文件</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817222143787.png" alt="image-20220817222143787"></p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817222156818.png" alt="image-20220817222156818"></p></li><li><p>执行WordCount程序</p><p> 调用的时候要拷贝全类名，因为我们这个jar包中有两个Driver类</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar wc.jar com.zhang.mapreduce.wordcount2.WordCountDriver /input output/</span><br></pre></td></tr></table></figure><p> 效果：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817223626175.png" alt="image-20220817223626175"></p><p> yarn的任务资源调度页面也出现新的命令。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817222800251.png" alt="image-20220817222800251"></p><p> 在NameNode web端中：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817223653739.png" alt="image-20220817223653739"></p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817223743268.png" alt="image-20220817223743268" style="zoom:50%;" /></p><p> 可以看到效果是正确的。</p></li></ol><h1 id="二、Hadoop序列化"><a href="#二、Hadoop序列化" class="headerlink" title="二、Hadoop序列化"></a>二、Hadoop序列化</h1><h2 id="2-1、概念"><a href="#2-1、概念" class="headerlink" title="2.1、概念"></a>2.1、概念</h2><ol><li><p>什么是序列化</p><p> 序列化就是把内存中的对象，转换成字节序列（或其他数据传输协议）以便于（持久化）存储到磁盘和网络传输。</p><p> 反序列化就是将收到字节序列（或其他数据传输协议）或者是磁盘的持久化数据，转换成内存中的对象。</p><p> 序列化：内存=&gt;磁盘      反序列化：磁盘=&gt;内存</p></li><li><p>为什么要序列化</p><p> 一般来说，“活的”对象只生存在内存里，关机断电就没有了。而且“活的”对象只能由本地的进程使用，不能被发送到网络上的另外一台计算机。 然而<strong>序列化可以存储“活的” 对象，可以将“活的”对象发送到远程计算机</strong>。</p></li><li><p>为什么不用 Java 的序列化</p><p> Java 的序列化是一个<strong>重量级</strong>序列化框架（Serializable），一个对象被序列化后，会<strong>附带很多<u>额外</u>的信息</strong>（各种校验信息，Header，继承体系等），<strong>不便于</strong>在网络中<strong>高效</strong>传输。所以， Hadoop 自己开发了一套序列化机制（Writable）。</p></li><li><p>Hadoop 序列化特点：</p><ol><li>紧凑 ：高效使用存储空间。 </li><li>快速：读写数据的额外开销小。</li><li>互操作：支持多语言的交互</li></ol></li></ol><h2 id="2-2、自定义bean对象实现序列化接口（Writable）"><a href="#2-2、自定义bean对象实现序列化接口（Writable）" class="headerlink" title="2.2、自定义bean对象实现序列化接口（Writable）"></a>2.2、自定义bean对象实现序列化接口（Writable）</h2><blockquote><p>在企业开发中往往常用的基本序列化类型不能满足所有需求，比如在 Hadoop 框架内部传递一个 bean 对象，那么该对象就需要实现序列化接口。我们就要自定义这个接口。</p></blockquote><p>具体步骤，分为七步：</p><ol><li><p>必须实现（implements）Writable接口</p></li><li><p>反序列化时，需要反射调用空参构造函数，所以必须有空参构造函数</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">FlowBean</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>重写序列化方法</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    out.writeLong(upFlow);</span><br><span class="line">    out.writeLong(downFlow);</span><br><span class="line">    out.writeLong(sumFlow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>重写反序列化方法</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    upFlow = in.readLong();</span><br><span class="line">    downFlow = in.readLong();</span><br><span class="line">    sumFlow = in.readLong();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>注意反序列化的顺序和序列化的顺序完全一致</p></li><li><p>要想把结果显示在文件中，需要重写toString()，可用”\t”分开，方便后续使用。</p></li><li><p>如果需要自定义的bean放在key中传输，则还需要实现Comparable接口，因为MapReducer框架中的Shuffle过程要求对key必须能排序。（如果只在value中传输就可以不实现）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(FlowBean o)</span> &#123;</span><br><span class="line">    <span class="comment">// 倒序排列，从大到小</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-3、序列化案例实操"><a href="#2-3、序列化案例实操" class="headerlink" title="2.3、序列化案例实操"></a>2.3、序列化案例实操</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>统计每一个手机号耗费的总上行流量、总下行流量、总流量</p><ol><li><p>输入数据</p><p> phone_data.txt    为了便于切割，用的tab。注意有手机号重复的，应当一起加起来，有IP地址缺失的（上行和下行流量分开取数组倒数几个）。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818100609043.png" alt="image-20220818100609043"></p></li><li><p>输入数据格式</p> <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  7 13560436666 120.196.100.99 1116954200</span><br><span class="line"><span class="comment">%id 手机号码      网络ip         上行流量 下行流量  网络状态码</span></span><br></pre></td></tr></table></figure></li><li><p>期望输出数据格式</p> <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">13560436666 1116    954    2070</span><br><span class="line"><span class="comment">%手机号码    上行流量 下行流量 总流量</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818093304143.png" alt="image-20220818093304143"></p><blockquote><p>总结：</p><p>Map阶段：</p><ul><li>输入：<ul><li>key：行号                    LongWritable</li><li>value：一行的信息     Text</li></ul></li><li>输出：<ul><li>key：手机号              Text</li><li>value：bean对象        FlowBean</li></ul></li></ul><p>Reduce阶段</p><ul><li><p>输入：</p><ul><li><p>key：手机号              Text</p></li><li><p>value：bean对象        FlowBean</p></li></ul></li><li><p>输出：</p><ul><li><p>key：手机号              Text</p></li><li><p>value：bean对象        FlowBean</p></li></ul></li></ul><p>bean对象：具有以下属性：</p><ul><li>手机号，以key的形式传播了，可有可无</li><li>上行流量</li><li>下行流量</li><li>总流量可以计算得到，在那里计算都一样。可有可无</li></ul></blockquote><h3 id="编写-MapReduce-程序"><a href="#编写-MapReduce-程序" class="headerlink" title="编写 MapReduce 程序"></a>编写 MapReduce 程序</h3><ol><li><p>编写流量统计的Bean对象——FlowBean</p><p> 还是提醒导包。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.mapreduce.writable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Writable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInput;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. 实现writable接口</span></span><br><span class="line"><span class="comment"> * 2. 重写序列化和反序列化方法</span></span><br><span class="line"><span class="comment"> * 3. 重写空参构造</span></span><br><span class="line"><span class="comment"> * 4. 重写toString方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowBean</span> <span class="keyword">implements</span> <span class="title class_">Writable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 属性</span></span><br><span class="line">    <span class="keyword">private</span> Long upFlow; <span class="comment">// 上行流量</span></span><br><span class="line">    <span class="keyword">private</span> Long downFlow; <span class="comment">// 下行流量</span></span><br><span class="line">    <span class="keyword">private</span> Long sumFlow; <span class="comment">// 总流量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空参构造</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FlowBean</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写序列化方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataOutput</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 序列化的顺序无所谓，但是要保证序列化和反序列化的顺序一致</span></span><br><span class="line">        dataOutput.writeLong(upFlow);</span><br><span class="line">        dataOutput.writeLong(downFlow);</span><br><span class="line">        dataOutput.writeLong(sumFlow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写反序列化方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataInput</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.upFlow = dataInput.readLong();</span><br><span class="line">        <span class="built_in">this</span>.downFlow = dataInput.readLong();</span><br><span class="line">        <span class="built_in">this</span>.sumFlow = dataInput.readLong();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写toString()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> upFlow + <span class="string">&quot;\t&quot;</span> + downFlow + <span class="string">&quot;\t&quot;</span> + sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter和setter</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getUpFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> upFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpFlow</span><span class="params">(Long upFlow)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.upFlow = upFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getDownFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> downFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDownFlow</span><span class="params">(Long downFlow)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.downFlow = downFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getSumFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSumFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sumFlow = <span class="built_in">this</span>.upFlow + <span class="built_in">this</span>.downFlow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写Mapper类——FlowMapper</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, FlowBean&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FlowBean</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FlowBean</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, FlowBean&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取一行信息</span></span><br><span class="line">        <span class="comment">// 7 13560436666 120.196.100.99 1116954200</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 切割</span></span><br><span class="line">        <span class="comment">// [7,13560436666,120.196.100.99,1116,954,200]</span></span><br><span class="line">        String[] split = line.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 提取想要的数据</span></span><br><span class="line">        <span class="comment">// 手机号：13560436666=&gt;split[1],上行流量：1116=&gt;split[len - 3],下行流量：954=&gt;split[len - 2]</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneNum</span> <span class="operator">=</span> split[<span class="number">1</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">up</span> <span class="operator">=</span> split[split.length - <span class="number">3</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">down</span> <span class="operator">=</span> split[split.length - <span class="number">2</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 封装输出Key-Value</span></span><br><span class="line">        outKey.set(phoneNum);</span><br><span class="line">        outValue.setUpFlow(Long.parseLong(up));</span><br><span class="line">        outValue.setDownFlow(Long.parseLong(down));</span><br><span class="line">        outValue.setSumFlow();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5.写出</span></span><br><span class="line">        context.write(outKey, outValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写Reducer类——FlowReducer</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, FlowBean, Text, FlowBean&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">FlowBean</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FlowBean</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;FlowBean&gt; values, Reducer&lt;Text, FlowBean, Text, FlowBean&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 遍历 values,将其中的上行流量,下行流量分别累加</span></span><br><span class="line">        <span class="comment">// phoneNum - [bean1,bean2]</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">sumUp</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">sumDown</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">for</span> (FlowBean value : values) &#123;</span><br><span class="line">            sumUp += value.getUpFlow();</span><br><span class="line">            sumDown += value.getDownFlow();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 封装 outKV</span></span><br><span class="line">        outValue.setUpFlow(sumUp);</span><br><span class="line">        outValue.setDownFlow(sumDown);</span><br><span class="line">        outValue.setSumFlow();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 写出</span></span><br><span class="line">        context.write(key, outValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写Driver驱动类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//1. 获取配置信息以及获取 job 对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 关联本 Driver 程序的 jar</span></span><br><span class="line">        job.setJarByClass(FlowDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 关联 Mapper 和 Reducer 的 jar</span></span><br><span class="line">        job.setMapperClass(FlowMapper.class);</span><br><span class="line">        job.setReducerClass(FlowReducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 设置 Mapper 输出的 kv 类型</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(FlowBean.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 设置最终输出 kv 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(FlowBean.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\phone_data .txt&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7. 提交 job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试结果</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818104317585.png" alt="image-20220818104317585" style="zoom:50%;" /></p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818104114200.png" alt="image-20220818104114200" style="zoom:50%;" /></p><p> 结果正确。</p></li></ol><h1 id="三、MapReduce-框架原理"><a href="#三、MapReduce-框架原理" class="headerlink" title="三、MapReduce 框架原理"></a>三、MapReduce 框架原理</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818104657592.png" alt="image-20220818104657592"></p><h2 id="3-1、InputFormat-数据输入"><a href="#3-1、InputFormat-数据输入" class="headerlink" title="3.1、InputFormat 数据输入"></a>3.1、InputFormat 数据输入</h2><h3 id="3-1-1-切片于MapTask并行度决定机制"><a href="#3-1-1-切片于MapTask并行度决定机制" class="headerlink" title="3.1.1 切片于MapTask并行度决定机制"></a>3.1.1 切片于MapTask并行度决定机制</h3><ol><li><p>问题引出</p><blockquote><p>MapTask 的并行度决定 Map 阶段的任务处理并发度，进而影响到整个 Job 的处理速度。</p></blockquote><p> 思考：1G 的数据，启动 8 个 MapTask，可以提高集群的并发处理能力。那么 1K 的数 据，也启动 8 个 MapTask，会提高集群性能吗？MapTask 并行任务是否越多越好呢？哪些因素影响了 MapTask 并行度？</p></li><li><p>MapTask 并行度决定机制</p><p> 数据块：Block 是 HDFS 物理上把数据分成一块一块。数据块是 HDFS 存储数据单位。</p><p> 数据切片：数据切片只是在逻辑上对输入进行分片，并不会在磁盘上将其切分成片进行存储。数据切片是 MapReduce 程序计算输入数据的单位，一个切片会对应启动一个 MapTask。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818105208230.png" alt="image-20220818105208230"></p></li></ol><p><a href="#3.5.3、ReduceTask并行度决定机制">ReduceTask并行度决定机制</a></p><h3 id="3-1-2、Job提交流程源码详解"><a href="#3-1-2、Job提交流程源码详解" class="headerlink" title="3.1.2、Job提交流程源码详解"></a>3.1.2、Job提交流程源码详解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自己代码中调用的函数</span></span><br><span class="line">job.waitForCompletion()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 进入函数第一个方法</span></span><br><span class="line">    submit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// submit()中第一个函数（ensureState）是判断是否有异常</span></span><br><span class="line">        <span class="comment">// 第二个函数（setUseNewAPI）是处理版本兼容用的</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 真正关心的函数：</span></span><br><span class="line">        <span class="comment">// 1 建立连接</span></span><br><span class="line">        connect();</span><br><span class="line">            <span class="comment">// 1）创建提交 Job 的代理</span></span><br><span class="line">            <span class="type">Cluster</span> <span class="variable">cluster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cluster</span>(getConfiguration());</span><br><span class="line">                <span class="comment">// 在Cluster类的构造方法中判断是本地运行环境还是 yarn 集群运行环境</span></span><br><span class="line">                initialize(jobTrackAddr, conf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 提交 job</span></span><br><span class="line">        submitter.submitJobInternal(Job.<span class="built_in">this</span>, cluster)</span><br><span class="line">            <span class="comment">// 1）创建给集群提交数据的 Stag 路径</span></span><br><span class="line">            <span class="type">Path</span> <span class="variable">jobStagingArea</span> <span class="operator">=</span> JobSubmissionFiles.getStagingDir(cluster, conf);</span><br><span class="line">            <span class="comment">// 2）获取 jobid ，并创建 Job 路径</span></span><br><span class="line">            <span class="type">JobID</span> <span class="variable">jobId</span> <span class="operator">=</span> submitClient.getNewJobID();</span><br><span class="line">            <span class="comment">// 3）拷贝 jar 包到集群</span></span><br><span class="line">            copyAndConfigureFiles(job, submitJobDir);</span><br><span class="line">            rUploader.uploadFiles(job, jobSubmitDir);</span><br><span class="line">            <span class="comment">// 4）计算切片，生成切片规划文件</span></span><br><span class="line">            writeSplits(job, submitJobDir);</span><br><span class="line">            maps = writeNewSplits(job, jobSubmitDir);</span><br><span class="line">            input.getSplits(job);</span><br><span class="line">            <span class="comment">// 5）向 Stag 路径写 XML 配置文件</span></span><br><span class="line">            writeConf(conf, submitJobFile);</span><br><span class="line">            conf.writeXml(out);</span><br><span class="line">            <span class="comment">// 6）提交 Job,返回提交状态</span></span><br><span class="line">            status=submitClient.submitJob(jobId,submitJobDir.toString(),job.getCredentials());</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818192246053.png" alt="image-20220818192246053"></p><h3 id="3-1-3、-FileInputFormat-切片源码和切片机制"><a href="#3-1-3、-FileInputFormat-切片源码和切片机制" class="headerlink" title="3.1.3、 FileInputFormat 切片源码和切片机制"></a>3.1.3、 FileInputFormat 切片源码和切片机制</h3><ol><li><p>FileInputFormat 切片源码解析（input.getSplits(job))</p><ol><li><p>程序先找到你数据存储的目录。</p></li><li><p>开始遍历处理（规划切片）目录下的每一个文件</p></li><li>遍历第一个文件ss.txt<ol><li>获取文件大小fs.sizeOf(ss.txt)</li><li>计算切片大小 computeSplitSize(Math.max(minSize,Math.min(maxSize,blocksize)))=blocksize=128M</li><li><strong>默认情况下，切片大小=blocksize</strong></li><li>开始切，形成第1个切片：ss.txt—0:128M 第2个切片ss.txt—128:256M 第3个切片ss.txt—256M:300M （<strong>每次切片时，都要判断切完剩下的部分是否大于块的==1.1倍==，不大于1.1倍就划分一块切片</strong>）</li><li>将切片信息写到一个切片规划文件中 f）整个切片的核心过程在getSplit()方法中完成</li><li><strong>InputSplit只记录了切片的元数据信息</strong>，比如起始位置、长度以及所在的节点列表等。</li></ol></li><li><strong>提交切片规划文件到YARN上，YARN上的MrAppMaster就可以根据切片规划文件计算开启MapTask个数</strong></li></ol></li><li><p>FileInputFormat 切片机制</p><ol><li><p>切片机制</p><ol><li>简单地按照文件的内容长度进行切片</li><li>切片大小，默认等于Block大小</li><li><strong>切片时不考虑数据集整体，而是逐个针对每一个文件单独切片</strong></li></ol></li><li><p>案例分析：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818194643496.png" alt="image-20220818194643496" style="zoom:50%;" /></p><ol><li><p>源码中计算切片大小的公式：</p><ul><li><code>Math.max(minSize, Math.min(maxSize, blockSize))</code></li><li><code>mapreduce.input,fileformat.split.minsize=1</code>      <strong>默认值为1</strong></li><li><p><code>mapreduce.input.fileinputformat.split.maxsize=Long.MAX_VALUE</code>   <strong>默认值时Long的最大值</strong></p><p>==所以默认情况下，切片大小=blocksize==</p></li></ul></li><li><p>切片大小设置</p><ul><li><code>maxsize</code>（切片最大值）：参数如果比blockSize小，则会让切片变小，而且就等于配置的这个参数的值</li><li><code>minsize</code>（切片最小值）：参数调的比blockSize大，则可以让切片变得比blockSize还大</li></ul></li><li><p>获取切片信息的API</p><ul><li><p>获取切片的文件名称：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> inputSplit.getPath().getName();</span><br></pre></td></tr></table></figure></li><li><p>根据文件类型获取切片信息</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileSplit</span> <span class="variable">inputSplit</span> <span class="operator">=</span> (FileSplit) context.getInputSplit();</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ol></li></ol><h3 id="3-1-4、TextInputFormat"><a href="#3-1-4、TextInputFormat" class="headerlink" title="3.1.4、TextInputFormat"></a>3.1.4、TextInputFormat</h3><blockquote><p>思考：在运行 MapReduce 程序时，输入的文件格式包括：基于行的日志文件、二进制格式文件、数据库表等。那么，针对不同的数据类型，MapReduce 是如何读取这些数据的呢？</p><p>FileInputFormat 常见的接口实现类包括：<strong>TextInputFormat</strong>、KeyValueTextInputFormat、 NLineInputFormat、<strong>CombineTextInputFormat</strong> 和自定义 InputFormat 等。</p></blockquote><p>TextInputFormat 是默认的 FileInputFormat 实现类。按行读取每条记录。键是存储该行在整个文件中的起始字节偏移量， LongWritable 类型。值是这行的内容，不包括任何行终止符（换行符和回车符），Text 类型。</p><p>以下是一个示例，比如，一个分片包含了如下 4 条文本记录</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rich learning form</span><br><span class="line">Intelligent learning engine</span><br><span class="line">Learning more convenient</span><br><span class="line">From the real demand for more close to the enterprise</span><br></pre></td></tr></table></figure><p>每条记录表示为以下键/值对：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(0,Rich learning form)</span><br><span class="line">(20,Intelligent learning engine)</span><br><span class="line">(49,Learning more convenient)</span><br><span class="line">(74,From the real demand for more close to the enterprise)</span><br></pre></td></tr></table></figure><h3 id="3-1-5、CombineTextInputFormat-切片机制"><a href="#3-1-5、CombineTextInputFormat-切片机制" class="headerlink" title="3.1.5、CombineTextInputFormat 切片机制"></a>3.1.5、CombineTextInputFormat 切片机制</h3><blockquote><p>框架默认的 <strong>TextInputFormat</strong> 切片机制是对任务按文件规划切片，不管文件多小，都会是一个单独的切片，都会交给一个 MapTask，这样如果有<strong>大量小文件</strong>，就会产生大量的 MapTask，<strong>处理效率极其低下。</strong></p></blockquote><p>==CombineTextInputFormat 切片机制就是解决大量小文件的办法之一==</p><ol><li><p>应用场景</p><p> <strong>CombineTextInputFormat 用于小文件过多的场景</strong>，它可以将多个小文件从逻辑上规划到一个切片中，这样，多个小文件就可以交给一个 MapTask 处理。</p></li><li><p>虚拟存储切片最大值设置</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CombineTextInputFormat.setMaxInputSplitSize(job, <span class="number">4194304</span>);<span class="comment">// 4m </span></span><br></pre></td></tr></table></figure><p> 注意：虚拟存储切片最大值设置最好根据实际的小文件大小情况来设置具体的值。</p></li><li><p>切片机制</p><p> 生成切片过程包括：虚拟存储过程和切片过程二部分。</p><ul><li><p>虚拟存储过程：</p><p>  将输入目录下所有文件大小，依次和设置的 setMaxInputSplitSize 值比较</p><ul><li>如果不大于设置的最大值，逻辑上划分一个块。</li><li>如果输入文件大于设置的最大值且大于两倍， 那么以最大值切割一块；</li><li><p><strong>当剩余数据大小超过设置的最大值且不大于最大值 2 倍，此时将文件均分成 2 个虚拟存储块（防止出现太小切片）。</strong></p><p>例如 setMaxInputSplitSize 值为 4M，输入文件大小为 8.02M，则先逻辑上分成一个 4M。剩余的大小为 4.02M，如果按照 4M 逻辑划分，就会出现 0.02M 的小的虚拟存储 文件，所以将剩余的 4.02M 文件切分成（2.01M 和 2.01M）两个文件。</p></li></ul></li><li><p>切片过程：</p><ul><li>判断虚拟存储的文件大小是否大于 setMaxInputSplitSize 值<ul><li>大于等于则单独形成一个切片。</li><li>如果不大于则跟下一个虚拟存储文件进行合并，共同形成一个切片。</li></ul></li></ul></li></ul></li><li><p>测试举例：</p><p> 有 4 个小文件大小分别为 1.7M、5.1M、3.4M 以及 6.8M 这四个小文件。</p><p> 则虚拟存储之后形成 6 个文件块，大小分别为：1.7M，（2.55M、2.55M），3.4M 以及（3.4M、3.4M）</p><p> 最终会形成 3 个切片，大小分别为：（1.7+2.55）M，（2.55+3.4）M，（3.4+3.4）M</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818204040423.png" alt="image-20220818204040423"></p><h2 id="3-2、MapReduce-工作流程"><a href="#3-2、MapReduce-工作流程" class="headerlink" title="3.2、MapReduce 工作流程"></a>3.2、MapReduce 工作流程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818204953965.png" alt="image-20220818204953965"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818205006031.png" alt="image-20220818205006031"></p><p>上面的流程是整个 MapReduce 最全工作流程，但是 Shuffle 过程只是从第 7 步开始到第 16 步结束，具体 Shuffle 过程详解，如下： </p><ol><li>MapTask 收集我们的 map()方法输出的 kv 对，放到内存缓冲区中</li><li>从内存缓冲区不断溢出本地磁盘文件，可能会溢出多个文件</li><li>多个溢出文件会被合并成大的溢出文件</li><li>在溢出过程及合并的过程中，都要调用 Partitioner 进行分区和针对 key 进行排序</li><li>ReduceTask 根据自己的分区号，去各个 MapTask 机器上取相应的结果分区数据</li><li>ReduceTask 会抓取到同一个分区的来自不同 MapTask 的结果文件，ReduceTask 会将这些文件再进行合并（归并排序） </li><li>合并成大文件后，Shuffle 的过程也就结束了，后面进入 ReduceTask 的逻辑运算过 程（从文件中取出一个一个的键值对 Group，调用用户自定义的 reduce()方法） </li></ol><p>注意：</p><ol><li>Shuffle 中的缓冲区大小会影响到 MapReduce 程序的执行效率，原则上说，缓冲区越大，磁盘 io 的次数越少，执行速度就越快。</li><li>缓冲区的大小可以通过参数调整，参数：mapreduce.task.io.sort.mb 默认 100M。</li></ol><blockquote><p>为什么排序，排序排的是什么？</p><p>我的思考：排序是拍的输出数据的key的顺序。我们之前做的WordCount的案例的结果就是按照单词（也就是输出数据的key）的字典序进行排序的。所以这里的快排和归并排序就是排输出数据的key的顺序</p></blockquote><h2 id="3-3、Shuffle-机制"><a href="#3-3、Shuffle-机制" class="headerlink" title="3.3、Shuffle 机制"></a>3.3、Shuffle 机制</h2><h3 id="3-3-1、Shuffle机制"><a href="#3-3-1、Shuffle机制" class="headerlink" title="3.3.1、Shuffle机制"></a>3.3.1、Shuffle机制</h3><blockquote><p>Map方法之后，Reduce方法之前的数据处理过程称之为Shuffle（洗牌）。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818210524303.png" alt="image-20220818210524303"></p><h3 id="3-3-2、Partition-分区"><a href="#3-3-2、Partition-分区" class="headerlink" title="3.3.2、Partition 分区"></a>3.3.2、Partition 分区</h3><ol><li><p>需求</p><p> 要求将统计结果按照条件输出到不同文件中（分区）。</p><p> 比如：将统计结果按照手机归属地不同省份输出到不同文件中（分区）</p></li><li><p>默认 Partitioner 分区</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashPartitioner</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">Partitioner</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(K key, V value, <span class="type">int</span> numReduceTasks)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (key.hashCode() &amp; Integer.MAX_VALUE) % numReduceTasks;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 默认分区是根据key的hashCode对ReduceTasks个数取模得到的。用户没法控制哪个key存储到哪个分区。</p></li><li><p>自定义 Partitioner 步骤</p><ol><li><p>自定义继承Partitioner的类，重写getPartition()方法</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomPartitioner</span> <span class="keyword">extends</span> <span class="title class_">Partitioner</span>&lt;Text, FlowBean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(Text key, FlowBean value, <span class="type">int</span> numPartitions)</span> &#123;</span><br><span class="line">        <span class="comment">// 控制分区代码逻辑</span></span><br><span class="line">        … …</span><br><span class="line">        <span class="keyword">return</span> partition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在Job驱动中，设置自定义Patitioner</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setPartitionerClass(CustomPatitioner.class);</span><br></pre></td></tr></table></figure></li><li><p>自定义Patition后，要根据自定义Patitioner的逻辑设置相应数量的ReduceTask</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setNumReduceTasks(<span class="number">5</span>);</span><br></pre></td></tr></table></figure></li></ol></li><li><p>分区总结</p><ol><li>如果<code>ReduceTask的数量 &gt; getPartition的结果数</code>，则会多产生几个空的输出文件part-r-000xx；</li><li>如果<code>1 &lt; ReduceTask的数量 &lt; getPartition的结果数</code>，则有一部分分区数据无处安放，会Exception；</li><li>如果<code>ReduceTask的数量 = 1</code>，则不管MapTask端输出多少个分区文件，最终结果都交给这一个<br> ReduceTask，最终也就只会产生一个结果文件 part-r-00000；</li><li><p>分区号必须从零开始，逐一累加</p><p>例如：假设自定义分区数为5，则</p></li><li><p>job.setNumReduceTasks(1); 小于5，会正常运行，只不过会产生一个输出文件</p></li><li>job.setNumReduceTasks(2); 大于1，小于5，会报错</li><li>job.setNumReduceTasks(6); 大于5，程序会正常运行，会产生空文件</li></ol></li></ol><h3 id="3-3-3、-Partition-分区案例实操"><a href="#3-3-3、-Partition-分区案例实操" class="headerlink" title="3.3.3、 Partition 分区案例实操"></a>3.3.3、 Partition 分区案例实操</h3><ol><li><p>需求</p><p> 将统计结果按照手机归属地不同省份输出到不同文件中（分区）</p><ul><li><p>输入数据</p><p>  phone_data.txt</p></li><li><p>期望输出数据</p><p>  手机号136、137、138、139开头都分别放到一个独立的文件中，其他开头通通放到一个文件中（总共5个文件）</p></li></ul></li><li><p>需求分析</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220818214147665.png" alt="image-20220818214147665"></p></li><li><p>在<a href="#2.3、序列化案例实操">案例2.3</a>的基础上修改</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Partitioner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProvincePartitioner</span> <span class="keyword">extends</span> <span class="title class_">Partitioner</span>&lt;Text,FlowBean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(Text text, FlowBean flowBean, <span class="type">int</span> numPartitions)</span> &#123;</span><br><span class="line">        <span class="comment">// text 是手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneNum</span> <span class="operator">=</span> text.toString();</span><br><span class="line">        <span class="comment">// 获取前三位</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prePhoneNum</span> <span class="operator">=</span> phoneNum.substring(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分区号</span></span><br><span class="line">        <span class="type">int</span> partition;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置分区</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;136&quot;</span>.equals(prePhoneNum))&#123;</span><br><span class="line">            partition = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;137&quot;</span>.equals(prePhoneNum)) &#123;</span><br><span class="line">            partition = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;138&quot;</span>.equals(prePhoneNum)) &#123;</span><br><span class="line">            partition = <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;139&quot;</span>.equals(prePhoneNum)) &#123;</span><br><span class="line">            partition = <span class="number">3</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            partition = <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 返回分区号</span></span><br><span class="line">        <span class="keyword">return</span> partition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 再修改一下Driver类，添加8，9两步（在第5步后面）。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//1. 获取配置信息以及获取 job 对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 关联本 Driver 程序的 jar</span></span><br><span class="line">        job.setJarByClass(FlowDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 关联 Mapper 和 Reducer 的 jar</span></span><br><span class="line">        job.setMapperClass(FlowMapper.class);</span><br><span class="line">        job.setReducerClass(FlowReducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 设置 Mapper 输出的 kv 类型</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(FlowBean.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 设置最终输出 kv 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(FlowBean.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//8. 指定自定义分区器</span></span><br><span class="line">        job.setPartitionerClass(ProvincePartitioner.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9. 同时指定相应数量的 ReduceTask</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\phone_data .txt&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7. 提交 job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 注意：NumReduceTasks的数量最好和分区数相同，效果最好。但是也可以是1（相当于白分区了（不设置的默认值也是1））或比5大（会多产生空文件）。但是大于1，小于5就会报错。原因看上一节。</p></li><li><p>结果</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819093104178.png" alt="image-20220819093104178" style="zoom:50%;" /></p><p> 确实产生了五个分区文件。</p><p> 内容：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819093340612.png" alt="image-20220819093340612" style="zoom:50%;" /></p></li></ol><h3 id="3-3-4、WritableComparable-排序"><a href="#3-3-4、WritableComparable-排序" class="headerlink" title="3.3.4、WritableComparable 排序"></a>3.3.4、WritableComparable 排序</h3><blockquote><p>排序是MapReduce框架中最重要的操作之一。</p><p>MapTask和ReduceTask均会对数据按照<strong>key</strong>进行排序。该操作属于Hadoop的<strong>默认行为</strong>。任何应用程序中的数据均会被排序，而<strong>不管逻辑上是否需要</strong>。</p><p><strong>默认</strong>排序是<strong>按照字典顺序排序</strong>，且实现该排序的方法是<strong>快速排序</strong>。</p><p>对于MapTask，它会将处理的结果暂时放到环形缓冲区中，当环形缓冲区使用率<strong>达到一定阈值后</strong>，再对<strong>缓冲区中的数据</strong>进行一次<strong>快速排序</strong>，并将这些有序数据溢写到磁盘上，而当数据处理完毕后，它会对磁盘上<strong>所有文件</strong>进行<strong>归并排序</strong>。</p><p>对于ReduceTask，它从每个MapTask上远程拷贝相应的数据文件</p><ul><li>如果文件大小超过一定阈值，则溢写磁盘上，否则存储在内存中。</li><li>如果磁盘上文件数目达到一定阈值，则进行一次归并排序以生成一个更大文件；</li><li>如果内存中文件大小或者数目超过一定阈值，则进行一次合并后将数据溢写到磁盘上。</li><li>当所有数据拷贝完毕后，<strong>ReduceTask统一对内存和磁盘上的所有数据进行一次归并排序。</strong></li></ul></blockquote><ol><li><p>排序分类</p><ol><li><p>部分排序</p><p> MapReduce根据输入记录的键对数据集排序。保证输出的每个文件<strong>内部有序</strong>。</p></li><li><p>全排序</p><p> <strong>最终输出结果只有一个文件，且文件内部有序</strong>。实现方式是只设置一个ReduceTask。但该方法在处理大型文件时效率极低，因为一台机器处理所有文件，完全丧失了MapReduce所提供的并行架构。</p></li><li><p>辅助排序：（GroupingComparator 分组）</p><p> 在Reduce端对key进行分组。应用于：在接收的key为bean对象时，想让一个或几个字段相同（全部字段比较不相同）的key进入到同一个reduce方法时，可以采用分组排序。</p></li><li><p>二次排序</p><p> 在自定义排序过程中，如果compareTo中的判断条件为两个即为二次排序。</p></li></ol></li><li><p>自定义排序 WritableComparable 原理分析</p><p> bean 对象做为 key 传输，需要实现 <code>WritableComparable</code> 接口重写 <code>compareTo</code> 方法，就可以实现排序。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(FlowBean bean)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> result;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 按照总流量大小，倒序排列</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.sumFlow &gt; bean.getSumFlow()) &#123;</span><br><span class="line">    result = -<span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.sumFlow &lt; bean.getSumFlow()) &#123;</span><br><span class="line">    result = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-3-5、WritableComparable-排序案例实操（全排序）"><a href="#3-3-5、WritableComparable-排序案例实操（全排序）" class="headerlink" title="3.3.5、WritableComparable 排序案例实操（全排序）"></a>3.3.5、WritableComparable 排序案例实操（全排序）</h3><ol><li><p>需求</p><p> 根据<a href="#2.3、序列化案例实操">案例2.3</a>序列化案例<strong>产生的结果</strong>，再次对<strong>总流量</strong>进行<strong>倒序</strong>排序，如果总流量一样，就<strong>上行流量升序</strong>排序。</p></li><li><p>需求分析</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819095224931.png" alt="image-20220819095224931"></p><blockquote><p>Map阶段：</p><p>输入：</p><ul><li>key：LongWritable  行号</li><li>value：Text            一行数据</li></ul><p>输出：</p><ul><li>key：FlowBean       自定义Bean（要求可排序）</li><li>value：Text             手机号</li></ul><p>Reduce阶段：</p><p>输入：</p><ul><li>key：FlowBean         自定义Bean</li><li>value：Text             手机号</li></ul><p>输出：</p><ul><li>key：Text                    手机号</li><li>value：FlowBean       自定义Bean</li></ul></blockquote></li><li><p>代码实现</p><ol><li><p>FlowBean 对象在在需求 1 基础上<strong>增加了比较功能</strong></p><ul><li>原本实现Writable接口，现在修改为实现WritableComparable接口（注意，这是一个接口，之前实现成了Writable和Comparable两个接口，就无法比较会报错），泛型是FlowBean（同类比较）</li><li><p>实现ompareTo方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.mapreduce.writableComparable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.WritableComparable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInput;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. 实现writable接口</span></span><br><span class="line"><span class="comment"> * 2. 重写序列化和反序列化方法</span></span><br><span class="line"><span class="comment"> * 3. 重写空参构造</span></span><br><span class="line"><span class="comment"> * 4. 重写toString方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowBean</span> <span class="keyword">implements</span> <span class="title class_">WritableComparable</span>&lt;FlowBean&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long upFlow; <span class="comment">// 上行流量</span></span><br><span class="line">    <span class="keyword">private</span> Long downFlow; <span class="comment">// 下行流量</span></span><br><span class="line">    <span class="keyword">private</span> Long sumFlow; <span class="comment">// 总流量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空参构造</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FlowBean</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写序列化方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataOutput</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 序列化的顺序无所谓，但是要保证序列化和反序列化的顺序一致</span></span><br><span class="line">        dataOutput.writeLong(upFlow);</span><br><span class="line">        dataOutput.writeLong(downFlow);</span><br><span class="line">        dataOutput.writeLong(sumFlow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写反序列化方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataInput</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.upFlow = dataInput.readLong();</span><br><span class="line">        <span class="built_in">this</span>.downFlow = dataInput.readLong();</span><br><span class="line">        <span class="built_in">this</span>.sumFlow = dataInput.readLong();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写toString()方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> upFlow + <span class="string">&quot;\t&quot;</span> + downFlow + <span class="string">&quot;\t&quot;</span> + sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(FlowBean o)</span> &#123;</span><br><span class="line">        <span class="comment">// 总流量的倒序排序</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.sumFlow &gt; o.sumFlow)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.sumFlow &lt; o.sumFlow) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 按上行流量正序排序</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">this</span>.upFlow &gt; o.upFlow)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">this</span>.upFlow &lt; o.upFlow)&#123;</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getUpFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> upFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpFlow</span><span class="params">(Long upFlow)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.upFlow = upFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getDownFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> downFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDownFlow</span><span class="params">(Long downFlow)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.downFlow = downFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getSumFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sumFlow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSumFlow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sumFlow = <span class="built_in">this</span>.upFlow + <span class="built_in">this</span>.downFlow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>编写Mapper类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, FlowBean, Text&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">FlowBean</span> <span class="variable">outKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FlowBean</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, FlowBean, Text&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 获取一行 1331568857744812268127162</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line">        <span class="comment">// 切割 [13315688577,4481,22681,27162]</span></span><br><span class="line">        String[] split = line.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">        <span class="comment">// 封装</span></span><br><span class="line">        outKey.setUpFlow(Long.parseLong(split[<span class="number">1</span>]));</span><br><span class="line">        outKey.setDownFlow(Long.parseLong(split[<span class="number">2</span>]));</span><br><span class="line">        outKey.setSumFlow();</span><br><span class="line">        outValue.set(split[<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">// 写出</span></span><br><span class="line">        context.write(outKey, outValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写Reduce类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;FlowBean, Text, Text, FlowBean&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(FlowBean key, Iterable&lt;Text&gt; values, Reducer&lt;FlowBean, Text, Text, FlowBean&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (Text value : values) &#123;</span><br><span class="line">            context.write(value, key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写Driver类</p><ul><li>修改Mapper输出的key和value</li><li><p>修改输入输出的路径（输入数据是之前的结果，要把其他三个文件删掉，否则会一起存）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//1. 获取配置信息以及获取 job 对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 关联本 Driver 程序的 jar</span></span><br><span class="line">        job.setJarByClass(FlowDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 关联 Mapper 和 Reducer 的 jar</span></span><br><span class="line">        job.setMapperClass(FlowMapper.class);</span><br><span class="line">        job.setReducerClass(FlowReducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 设置 Mapper 输出的 kv 类型</span></span><br><span class="line">        job.setMapOutputKeyClass(FlowBean.class);</span><br><span class="line">        job.setMapOutputValueClass(Text.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 设置最终输出 kv 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(FlowBean.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output2&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7. 提交 job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>效果：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819150121474.png" alt="image-20220819150121474" style="zoom:50%;" /></p><p> 结果的确倒序排序了。</p></li></ol></li></ol><h3 id="3-3-6、WritableComparable排序案例实操（区内排序）"><a href="#3-3-6、WritableComparable排序案例实操（区内排序）" class="headerlink" title="3.3.6、WritableComparable排序案例实操（区内排序）"></a>3.3.6、WritableComparable排序案例实操（区内排序）</h3><ol><li><p>需求</p><p> 要求每个省份手机号输出的文件中按照总流量内部排序。</p></li><li><p>需求分析</p><p> 基于前一个需求，增加自定义分区类，<a href="#3.3.3、 Partition 分区案例实操">分区</a>按照省份手机号设置</p></li><li><p>案例实操</p><ol><li><p>添加自定义分区类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Partitioner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProvincePartitioner</span> <span class="keyword">extends</span> <span class="title class_">Partitioner</span>&lt;Text,FlowBean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(Text text, FlowBean flowBean, <span class="type">int</span> numPartitions)</span> &#123;</span><br><span class="line">        <span class="comment">// text 是手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phoneNum</span> <span class="operator">=</span> text.toString();</span><br><span class="line">        <span class="comment">// 获取前三位</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prePhoneNum</span> <span class="operator">=</span> phoneNum.substring(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分区号</span></span><br><span class="line">        <span class="type">int</span> partition;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置分区</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;136&quot;</span>.equals(prePhoneNum))&#123;</span><br><span class="line">            partition = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;137&quot;</span>.equals(prePhoneNum)) &#123;</span><br><span class="line">            partition = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;138&quot;</span>.equals(prePhoneNum)) &#123;</span><br><span class="line">            partition = <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;139&quot;</span>.equals(prePhoneNum)) &#123;</span><br><span class="line">            partition = <span class="number">3</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            partition = <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回分区号</span></span><br><span class="line">        <span class="keyword">return</span> partition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在驱动类中添加分区</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8. 指定自定义分区器</span></span><br><span class="line">job.setPartitionerClass(ProvincePartitioner.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//9. 同时指定相应数量的 ReduceTask</span></span><br><span class="line">job.setNumReduceTasks(<span class="number">5</span>);</span><br></pre></td></tr></table></figure></li></ol></li><li><p>效果</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819151333412.png" alt="image-20220819151333412"></p></li></ol><h3 id="3-3-7、Combiner-合并"><a href="#3-3-7、Combiner-合并" class="headerlink" title="3.3.7、Combiner 合并"></a>3.3.7、Combiner 合并</h3><blockquote><p>Combiner是MR程序中Mapper和Reducer之外的一种组件。</p><p>Combiner组件的父类就是Reducer。</p><p>Combiner和Reducer的区别在于运行的位置</p><ul><li>Combiner是在每一个MapTask所在的节点运行;</li><li>Reducer是接收全局所有Mapper的输出结果；</li></ul><p>Combiner的意义就是对每一个MapTask的输出进行局部汇总，以减小网络传输量。</p><p>Combiner能够应用的前提是不能影响最终的业务逻辑，而且，Combiner的输出kv应该跟Reducer的输入kv类型要对应起来。</p></blockquote><p>自定义Combiner 实现步骤</p><ol><li><p>自定义一个Combiner继承Reducer，重写Reduce方法</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountCombiner</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable, Text,IntWritable&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Contextcontext)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        outV.set(sum);</span><br><span class="line"></span><br><span class="line">        context.write(key,outV);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在Job驱动类中设置：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setCombinerClass(WordCountCombiner.class);</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-3-8、Combiner合并案例实操"><a href="#3-3-8、Combiner合并案例实操" class="headerlink" title="3.3.8、Combiner合并案例实操"></a>3.3.8、Combiner合并案例实操</h3><ol><li><p>需求</p><p> 统计过程中对每一个 MapTask 的输出进行局部汇总，以减小网络传输量即采用 Combiner 功能。</p></li><li><p>需求分析</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819152417658.png" alt="image-20220819152417658"></p></li><li><p>案例实操——方案一</p><ol><li><p>增加一个WordCountCombiner类继承Reducer</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountCombiner</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable,Text, IntWritable&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line">        outValue.set(sum);</span><br><span class="line">        context.write(key, outValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在WordCountDriver驱动类中指定Combiner</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setCombinerClass(WordCountCombiner.class);</span><br></pre></td></tr></table></figure></li></ol></li><li><p>案例实操——方案二</p><ol><li><p>将WordCountReducer 作为 Combiner 在 WordCountDriver驱动类中指定</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setCombinerClass(WordCountReducer.class);</span><br></pre></td></tr></table></figure></li></ol></li></ol><h2 id="3-4、OutPutFormat-数据输出"><a href="#3-4、OutPutFormat-数据输出" class="headerlink" title="3.4、OutPutFormat 数据输出"></a>3.4、OutPutFormat 数据输出</h2><blockquote><p>OutputFormat是MapReduce输出的基类，所有实现MapReduce输出都实现了 OutputFormat 接口。下面我们介绍几种常见的OutputFormat实现类。</p></blockquote><h3 id="3-4-1、OutputFormat-接口实现类"><a href="#3-4-1、OutputFormat-接口实现类" class="headerlink" title="3.4.1、OutputFormat 接口实现类"></a>3.4.1、OutputFormat 接口实现类</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819154538228.png" alt="image-20220819154538228"></p><p>默认输出格式<code>TextOutputFormat</code></p><p>自定义OutputFormat：</p><ol><li><p>应用场景：</p><p> 输出数据到MySQL/HBase/Elasticsearch等存储框架中。</p></li><li><p>自定义OutputFormat步骤</p><ol><li>自定义一个类继承<code>FileOutPutFormat</code></li><li>改写<code>RecordWriter</code>，具体改写输出数据的方法<code>write()</code></li></ol></li></ol><h3 id="3-4-2、自定义OutputFormat案例实操"><a href="#3-4-2、自定义OutputFormat案例实操" class="headerlink" title="3.4.2、自定义OutputFormat案例实操"></a>3.4.2、自定义OutputFormat案例实操</h3><ol><li><p>需求</p><p> 过滤输入的 log 日志，包含 study 的网站输出到 e:/study.log，不包含 study 的网站输出到 e:/other.log。</p></li><li><p>需求分析</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819154957495.png" alt="image-20220819154957495"></p></li><li><p>案例实操</p><ol><li><p>编写 LogMapper 类（Map阶段不做任何操作）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 在Map阶段不做任何处理</span></span><br><span class="line">        context.write(value, NullWritable.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写 LogReducer 类（Reduce阶段基本上也是不做任何操作）</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, NullWritable, Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;NullWritable&gt; values, Reducer&lt;Text, NullWritable, Text, NullWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 防止有相同数据，丢数据</span></span><br><span class="line">        <span class="keyword">for</span> (NullWritable value : values) &#123;</span><br><span class="line">            context.write(key, NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>自定义一个 LogOutputFormat 类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.RecordWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.TaskAttemptContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogOutputFormat</span> <span class="keyword">extends</span> <span class="title class_">FileOutputFormat</span>&lt;Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RecordWriter&lt;Text, NullWritable&gt; <span class="title function_">getRecordWriter</span><span class="params">(TaskAttemptContext taskAttemptContext)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">LogRecordWriter</span> <span class="variable">logRecordWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogRecordWriter</span>(taskAttemptContext);</span><br><span class="line">        <span class="keyword">return</span> logRecordWriter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写 LogRecordWriter 类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FSDataOutputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.RecordWriter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.TaskAttemptContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogRecordWriter</span> <span class="keyword">extends</span> <span class="title class_">RecordWriter</span>&lt;Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FSDataOutputStream study;</span><br><span class="line">    <span class="keyword">private</span> FSDataOutputStream other;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造方法，参数是job，要利用job的配置对象创建文件系统</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogRecordWriter</span><span class="params">(TaskAttemptContext job)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建两个流，一个流存喊study的数据，一个流存其他的不含study的数据</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileSystem</span> <span class="variable">fileSystem</span> <span class="operator">=</span> FileSystem.get(job.getConfiguration());</span><br><span class="line">            study = fileSystem.create(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\study.log&quot;</span>));</span><br><span class="line">            other = fileSystem.create(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\other.log&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(Text text, NullWritable nullWritable)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">log</span> <span class="operator">=</span> text.toString();</span><br><span class="line">        <span class="comment">// 具体写</span></span><br><span class="line">        <span class="keyword">if</span> (log.contains(<span class="string">&quot;study&quot;</span>))&#123;</span><br><span class="line">            study.writeBytes(log + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            other.writeBytes(log + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(TaskAttemptContext taskAttemptContext)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 关流</span></span><br><span class="line">        IOUtils.close(study);</span><br><span class="line">        IOUtils.close(other);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写 LogDriver 类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line">        job.setJarByClass(LogDriver.class);</span><br><span class="line">        job.setMapperClass(LogMapper.class);</span><br><span class="line">        job.setReducerClass(LogReducer.class);</span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(NullWritable.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(NullWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置自定义的 outputFormat</span></span><br><span class="line">        job.setOutputFormatClass(LogOutputFormat.class);</span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\log.txt&quot;</span>));</span><br><span class="line">        <span class="comment">// 虽然我们自定义了outputFormat，但是因为我们的outputFormat继承自fileOutputFormat而fileOutputFormat要输出一个_SUCCESS 文件，所以在这还得指定一个输出目录</span></span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>效果</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819162955910.png" alt="image-20220819162955910" style="zoom:50%;" /></p><p> 第二个指定FileOutputFormat实际上就是输出一个标记而已，指定的文件夹中只有success。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819163257465.png" alt="image-20220819163257465" style="zoom:50%;" /></p><p> 输出结果也满足预期。</p></li></ol></li></ol><h2 id="3-5、MapReduce-内核源码解析"><a href="#3-5、MapReduce-内核源码解析" class="headerlink" title="3.5、MapReduce 内核源码解析"></a>3.5、MapReduce 内核源码解析</h2><h3 id="3-5-1、MapTask工作机制"><a href="#3-5-1、MapTask工作机制" class="headerlink" title="3.5.1、MapTask工作机制"></a>3.5.1、MapTask工作机制</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819163406982.png" alt="image-20220819163406982"></p><ol><li>Read 阶段：MapTask 通过 InputFormat 获得的 RecordReader，从输入 InputSplit 中 解析出一个个 key/value。</li><li>Map 阶段：该节点主要是将解析出的 key/value 交给用户编写 map()函数处理，并 产生一系列新的 key/value。</li><li>Collect 收集阶段：在用户编写 map()函数中，当数据处理完成后，一般会调用 OutputCollector.collect()输出结果。在该函数内部，它会将生成的 key/value 分区（调用 Partitioner），并写入一个环形内存缓冲区中。</li><li>Spill 阶段（溢写阶段）：当环形缓冲区满后，MapReduce 会将数据写到本地磁盘上， 生成一个临时文件。需要注意的是，将数据写入本地磁盘之前，先要对数据进行一次本地排序，并在必要时对数据进行合并、压缩等操作。<ol><li>步骤 1：利用快速排序算法对缓存区内的数据进行排序，排序方式是，先按照分区编号 Partition 进行排序，然后按照 key 进行排序。这样，经过排序后，数据以分区为单位聚集在 一起，且同一分区内所有数据按照 key 有序。</li><li>步骤 2：按照分区编号由小到大依次将每个分区中的数据写入任务工作目录下的临时文 件 output/spillN.out（N 表示当前溢写次数）中。如果用户设置了 Combiner，则写入文件之 前，对每个分区中的数据进行一次聚集操作。</li><li>步骤 3：将分区数据的元信息写到内存索引数据结构 SpillRecord 中，其中每个分区的元 信息包括在临时文件中的偏移量、压缩前数据大小和压缩后数据大小。如果当前内存索引大 小超过 1MB，则将内存索引写到文件 output/spillN.out.index 中。</li></ol></li><li>Merge 阶段：当所有数据处理完成后，MapTask 对所有临时文件进行一次合并， 以确保最终只会生成一个数据文件。 当所有数据处理完后，MapTask 会将所有临时文件合并成一个大文件，并保存到文件 output/file.out 中，同时生成相应的索引文件 output/file.out.index。 在进行文件合并过程中，MapTask 以分区为单位进行合并。对于某个分区，它将采用多 轮递归合并的方式。每轮合并 mapreduce.task.io.sort.factor（默认 10）个文件，并将产生的文 件重新加入待合并列表中，对文件排序后，重复以上过程，直到最终得到一个大文件。 让每个 MapTask 最终只生成一个数据文件，可避免同时打开大量文件和同时读取大量小文件产生的随机读取带来的开销。</li></ol><h3 id="3-5-2、ReduceTask-工作机制"><a href="#3-5-2、ReduceTask-工作机制" class="headerlink" title="3.5.2、ReduceTask 工作机制"></a>3.5.2、ReduceTask 工作机制</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819163938386.png" alt="image-20220819163938386"></p><ol><li>Copy 阶段：ReduceTask 从各个 MapTask 上远程拷贝一片数据，并针对某一片数 据，如果其大小超过一定阈值，则写到磁盘上，否则直接放到内存中。</li><li>Sort 阶段：在远程拷贝数据的同时，ReduceTask 启动了两个后台线程对内存和磁 盘上的文件进行合并，以防止内存使用过多或磁盘上文件过多。按照 MapReduce 语义，用 户编写 reduce()函数输入数据是按 key 进行聚集的一组数据。为了将 key 相同的数据聚在一 起，Hadoop 采用了基于排序的策略。由于各个 MapTask 已经实现对自己的处理结果进行了 局部排序，因此，ReduceTask 只需对所有数据进行一次归并排序即可。</li><li>Reduce 阶段：reduce()函数将计算结果写到 HDFS 上。</li></ol><h3 id="3-5-3、ReduceTask并行度决定机制"><a href="#3-5-3、ReduceTask并行度决定机制" class="headerlink" title="3.5.3、ReduceTask并行度决定机制"></a>3.5.3、ReduceTask并行度决定机制</h3><p>回顾：<a href="#3.1.1 切片于MapTask并行度决定机制">MapTask并行度</a>由切片个数决定，切片个数由输入文件和切片规则决定。</p><p>思考：ReduceTask并行度由谁决定？</p><ol><li><p>设置ReduceTask并行度（个数）</p><p> ReduceTask的并行度同样影响真个Job的执行并发度和执行效率，但于MapTask的并发数由切片数决定不同，ReduceTask数量的决定是可以直接手动设置：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认值是 1，手动设置为 4</span></span><br><span class="line">job.setNumReduceTasks(<span class="number">4</span>);</span><br></pre></td></tr></table></figure></li><li><p>实验：测试ReduceTask多少合适</p><ol><li><p>实验环境：1个Master节点，16个Slave节点：CPU：8GHZ，内存：2G</p></li><li><p>实验结论：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819165406820.png" alt="image-20220819165406820" style="zoom:67%;" /></p></li><li><p>注意事项</p><ol><li><p>ReduceTask=0，表示没有Reduce阶段，输出文件个数和Map个数一致。</p></li><li><p>ReduceTask默认值就是1，所以输出文件个数为一个。</p></li><li><p>如果数据分布不均匀，就有可能在Reduce阶段产生数据倾斜</p></li><li><p>ReduceTask数量并不是任意设置，还要考虑业务逻辑需求，有些情况下，需要计算全局汇总结果，就只能有1个ReduceTask。</p></li><li><p>具体多少个ReduceTask，需要根据集群性能而定。</p></li><li><p>如果分区数不是1，但是ReduceTask为1，是否执行分区过程。</p><p> 答案是：不执行分区过程。因为在MapTask的源码中，执行分区的前提是先判断ReduceNum个数是否大于1。不大于1肯定不执行。</p></li></ol></li></ol></li></ol><h2 id="3-6、Join应用"><a href="#3-6、Join应用" class="headerlink" title="3.6、Join应用"></a>3.6、Join应用</h2><h3 id="3-6-1、Reduce-Join"><a href="#3-6-1、Reduce-Join" class="headerlink" title="3.6.1、Reduce Join"></a>3.6.1、Reduce Join</h3><p>Map 端的主要工作：为来自不同表或文件的 key/value 对，<strong>打标签以区别不同来源的记录</strong>。然后<strong>用连接字段作为 key</strong>，其余部分和新加的标志作为 value，最后进行输出。</p><p>Reduce 端的主要工作：在 Reduce 端<strong>以连接字段作为 key 的分组已经完成</strong>，我们只需要在每一个分组当中将那些来源于不同文件的记录（在 Map 阶段已经打标志）分开，最后进行合并就 ok 了。</p><h3 id="3-6-2、Reduce-Join-案例实操"><a href="#3-6-2、Reduce-Join-案例实操" class="headerlink" title="3.6.2、Reduce Join 案例实操"></a>3.6.2、Reduce Join 案例实操</h3><ol><li><p>需求</p><p> 将商品信息表中数据根据商品 pid 合并到订单数据表中。</p></li><li><p>数据：</p><p> order.txt</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819173039166.png" alt="image-20220819173039166" style="zoom:50%;" /></p><p> pd.txt</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819173158477.png" alt="image-20220819173158477" style="zoom: 79%;" /></p></li><li><p>需求分析</p><p> 通过将关联条件（pid）作为 Map 输出的 key，将两表满足 Join 条件的数据并携带数据所来源的文件信息，发往同一个 ReduceTask，在 Reduce 中进行数据的串联。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220819173326552.png" alt="image-20220819173326552"></p><blockquote><ul><li>Map阶段：<ul><li>输入：<ul><li>key：LongWritable    行号</li><li>value：Text              每一行的内容</li></ul></li><li>输出：<ul><li>key：Text                 id</li><li>value：TableBean      自定义Bean</li></ul></li></ul></li><li>Reduce阶段：<ul><li>输入：<ul><li>key：</li><li>value：</li></ul></li><li>输出：<ul><li>key：</li><li>value：</li></ul></li></ul></li></ul></blockquote></li><li><p>代码实现</p><ol><li><p>创建商品和订单合并后的TableBean类</p><p> 用Lombok创建的无参构造和getter和setter。</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Writable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInput;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableBean</span> <span class="keyword">implements</span> <span class="title class_">Writable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// id pid amount</span></span><br><span class="line">    <span class="comment">// pid name</span></span><br><span class="line">    <span class="keyword">private</span> String id; <span class="comment">// 订单id</span></span><br><span class="line">    <span class="keyword">private</span> String pid; <span class="comment">// 商品id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> amount; <span class="comment">// 商品数量</span></span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">private</span> String flag; <span class="comment">// 标记是那个表</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        dataOutput.writeUTF(id);</span><br><span class="line">        dataOutput.writeUTF(pid);</span><br><span class="line">        dataOutput.writeInt(amount);</span><br><span class="line">        dataOutput.writeUTF(name);</span><br><span class="line">        dataOutput.writeUTF(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = dataInput.readUTF();</span><br><span class="line">        <span class="built_in">this</span>.pid = dataInput.readUTF();</span><br><span class="line">        <span class="built_in">this</span>.amount = dataInput.readInt();</span><br><span class="line">        <span class="built_in">this</span>.name = dataInput.readUTF();</span><br><span class="line">        <span class="built_in">this</span>.flag = dataInput.readUTF();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// id name amount</span></span><br><span class="line">        <span class="keyword">return</span> id + <span class="string">&#x27;\t&#x27;</span> + name + <span class="string">&#x27;\t&#x27;</span> + amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写TableMapper类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileSplit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, TableBean&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">TableBean</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TableBean</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">(Mapper&lt;LongWritable, Text, Text, TableBean&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 初始化 order.txt  pd.txt</span></span><br><span class="line">        <span class="type">FileSplit</span> <span class="variable">split</span> <span class="operator">=</span> (FileSplit) context.getInputSplit();</span><br><span class="line"></span><br><span class="line">        fileName = split.getPath().getName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, TableBean&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取一行</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line">        <span class="comment">// 2. 判断是哪一个文件的</span></span><br><span class="line">        <span class="keyword">if</span> (fileName.contains(<span class="string">&quot;order&quot;</span>)) &#123; <span class="comment">// 处理的是 order.txt</span></span><br><span class="line">            <span class="comment">// 3. 分割 [1001,01,1]</span></span><br><span class="line">            String[] split = line.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            <span class="comment">// 4. 封装kv</span></span><br><span class="line">            outKey.set(split[<span class="number">1</span>]);</span><br><span class="line">            outValue.setId(split[<span class="number">0</span>]);</span><br><span class="line">            outValue.setPid(split[<span class="number">1</span>]);</span><br><span class="line">            outValue.setAmount(Integer.parseInt(split[<span class="number">2</span>]));</span><br><span class="line">            outValue.setName(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            outValue.setFlag(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 处理的是 pd.txt</span></span><br><span class="line">            <span class="comment">// 3. 分割 [01,小米]</span></span><br><span class="line">            String[] split = line.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            <span class="comment">// 4. 封装</span></span><br><span class="line">            outKey.set(split[<span class="number">0</span>]);</span><br><span class="line">            outValue.setId(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            outValue.setPid(split[<span class="number">0</span>]);</span><br><span class="line">            outValue.setAmount(<span class="number">0</span>);</span><br><span class="line">            outValue.setName(split[<span class="number">1</span>]);</span><br><span class="line">            outValue.setFlag(<span class="string">&quot;pd&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.写出</span></span><br><span class="line">        context.write(outKey, outValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写TableReducer类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, TableBean, TableBean, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;TableBean&gt; values, Reducer&lt;Text, TableBean, TableBean, NullWritable&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 01   1001    1   order</span></span><br><span class="line">        <span class="comment">// 01   1004    4   order</span></span><br><span class="line">        <span class="comment">// 01   小米         pd</span></span><br><span class="line">        <span class="comment">// 准备初始化集合</span></span><br><span class="line">        ArrayList&lt;TableBean&gt; orderBeans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TableBean</span> <span class="variable">pdBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TableBean</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环遍历</span></span><br><span class="line">        <span class="keyword">for</span> (TableBean value : values) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;order&quot;</span>.equals(value.getFlag()))&#123; <span class="comment">// 处理订单表</span></span><br><span class="line">                <span class="type">TableBean</span> <span class="variable">tempTableBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TableBean</span>();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    BeanUtils.copyProperties(tempTableBean, value);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                orderBeans.add(tempTableBean);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 处理商品表</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    BeanUtils.copyProperties(pdBean, value);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 循环遍历 orderBeans ,赋值 name</span></span><br><span class="line">        <span class="keyword">for</span> (TableBean orderBean : orderBeans) &#123;</span><br><span class="line">            orderBean.setName(pdBean.getName());</span><br><span class="line">            <span class="comment">// 写出</span></span><br><span class="line">            context.write(orderBean, NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写TableDriver类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableDriver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(<span class="keyword">new</span> <span class="title class_">Configuration</span>());</span><br><span class="line">        job.setJarByClass(TableDriver.class);</span><br><span class="line">        job.setMapperClass(TableMapper.class);</span><br><span class="line">        job.setReducerClass(TableReducer.class);</span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(TableBean.class);</span><br><span class="line">        job.setOutputKeyClass(TableBean.class);</span><br><span class="line">        job.setOutputValueClass(NullWritable.class);</span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\input&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output&quot;</span>));</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>总结</p><p> 缺点：这种方式中，合并的操作是在 Reduce 阶段完成，Reduce 端的处理压力太大，Map 节点的运算负载则很低，资源利用率不高，且在 Reduce 阶段极易产生数据倾斜。 </p><p> ==解决方案：Map 端实现数据合并（利用Map Join）。==</p></li></ol><h3 id="3-6-3、Map-Join"><a href="#3-6-3、Map-Join" class="headerlink" title="3.6.3、Map Join"></a>3.6.3、Map Join</h3><ol><li><p>使用场景</p><p> Map Join适用于一张表十分小、一张表很大的场景。</p></li><li><p>优点</p><p> 思考：在Reduce端处理过多的表，非常容易产生数据倾斜。怎么办？</p><p> 在Map端缓存多张表，提前处理业务逻辑，这样增加Map端业务，减少Reduce端数据的压力，尽可能的减少数据倾斜。</p></li><li><p>具体办法：采用DistributedCache</p><ol><li><p>在Mapper的setup阶段，将文件读取到缓存集合中</p></li><li><p>在Driver驱动类中加载缓存</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//缓存普通文件到 Task 运行节点。</span></span><br><span class="line">job.addCacheFile(<span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;file:///e:/cache/pd.txt&quot;</span>));</span><br><span class="line"><span class="comment">//如果是集群运行,需要设置 HDFS 路径</span></span><br><span class="line">job.addCacheFile(<span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020/cache/pd.txt&quot;</span>));</span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="3-6-4、Map-Join-案例实操"><a href="#3-6-4、Map-Join-案例实操" class="headerlink" title="3.6.4、Map Join 案例实操"></a>3.6.4、Map Join 案例实操</h3><ol><li><p>需求</p><p> 和<a href="#3.6.2、Reduce Join 案例实操">3.6.2、Reduce Join 案例实操</a>一样</p></li><li><p>需求分析</p><p> MapJoin适用于关联表中有表的情况</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220820091952393.png" alt="image-20220820091952393" style="zoom:67%;" /></p></li><li><p>实现代码</p><ol><li><p>在MapJoinDriver驱动类中添加缓存文件</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapJoinDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, URISyntaxException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 1 获取 job 信息</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(conf);</span><br><span class="line">        <span class="comment">// 2 设置加载 jar 包路径</span></span><br><span class="line">        job.setJarByClass(MapJoinDriver.class);</span><br><span class="line">        <span class="comment">// 3 关联 mapper</span></span><br><span class="line">        job.setMapperClass(MapJoinMapper.class);</span><br><span class="line">        <span class="comment">// 4 设置 Map 输出 KV 类型</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(NullWritable.class);</span><br><span class="line">        <span class="comment">// 5 设置最终输出 KV 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(NullWritable.class);</span><br><span class="line">        <span class="comment">// 加载缓存数据</span></span><br><span class="line">        job.addCacheFile(<span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;file:///D:/桌面/input/pd.txt&quot;</span>));</span><br><span class="line">        <span class="comment">// Map 端 Join 的逻辑不需要 Reduce 阶段，设置 reduceTask 数量为 0</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 6 设置输入输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\input\\order.txt&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\output&quot;</span>));</span><br><span class="line">        <span class="comment">// 7 提交</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在MapJoinMapper类中的setup方法中读取缓存文件</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FSDataInputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapJoinMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, String&gt; pdMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">(Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 获取缓存文件，并把缓存文件内容封装到集合 pd.txt中</span></span><br><span class="line">        URI[] cacheFiles = context.getCacheFiles();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取流</span></span><br><span class="line">        <span class="type">FileSystem</span> <span class="variable">fs</span> <span class="operator">=</span> FileSystem.get(context.getConfiguration());</span><br><span class="line">        <span class="type">FSDataInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> fs.open(<span class="keyword">new</span> <span class="title class_">Path</span>(cacheFiles[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从流中读取数据</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(fis, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> (StringUtils.isNotEmpty(line = reader.readLine()))&#123;</span><br><span class="line">            <span class="comment">// 切割 [01,小米]</span></span><br><span class="line">            String[] split = line.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            pdMap.put(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关流</span></span><br><span class="line">        IOUtils.closeStream(reader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 处理 order.txt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line">        <span class="comment">// 分割 [1001,01,1]</span></span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取pid</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">pName</span> <span class="operator">=</span> pdMap.get(fields[<span class="number">1</span>]);</span><br><span class="line">        <span class="comment">// 封装kv</span></span><br><span class="line">        outKey.set(fields[<span class="number">0</span>] + <span class="string">&quot;\t&quot;</span> + pName + <span class="string">&quot;\t&quot;</span> + fields[<span class="number">2</span>]);</span><br><span class="line">        context.write(outKey, NullWritable.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>效果</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220820101110988.png" alt="image-20220820101110988" style="zoom:50%;" /></p></li></ol><h2 id="3-7、数据清洗（ETL）"><a href="#3-7、数据清洗（ETL）" class="headerlink" title="3.7、数据清洗（ETL）"></a>3.7、数据清洗（ETL）</h2><p>“ETL，是英文 Extract-Transform-Load 的缩写，用来描述将数据从来源端经过抽取 （Extract）、转换（Transform）、加载（Load）至目的端的过程。ETL 一词较常用在数据仓库，但其对象并不限于数据仓库。</p><p>在运行核心业务 MapReduce 程序之前，往往要先对数据进行清洗，清理掉不符合用户 要求的数据。<strong>清理的过程往往只需要运行 Mapper 程序，不需要运行 Reduce 程序。</strong></p><ol><li><p>需求</p><p> 取出日志中字段个数小于等于11的日志</p></li><li><p>需求分析</p><p> 需要在Map阶段对输入的数据根据规则进行过滤</p></li><li><p>实现代码</p><ol><li><p>编写WebLogMapper类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebLogMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, NullWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取一行</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line">        <span class="comment">// 3. ETL</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> parseLog(line,context);</span><br><span class="line">        <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. 写出</span></span><br><span class="line">        context.write(value, NullWritable.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">parseLog</span><span class="params">(String line, Context context)</span> &#123;</span><br><span class="line">        <span class="comment">// 2. 切割</span></span><br><span class="line">        String[] split = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">// 判断日志长度是否大于11</span></span><br><span class="line">        <span class="keyword">if</span>(split.length &gt; <span class="number">11</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写WebLogDriver类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.zhang.mapreduce.outputFormat.LogDriver;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebLogDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">// 输入输出路径需要根据自己电脑上实际的输入输出路径设置</span></span><br><span class="line">        args = <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;D:/桌面/input&quot;</span>, <span class="string">&quot;D:/桌面/output&quot;</span> &#125;;</span><br><span class="line"><span class="comment">// 1 获取 job 信息</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(conf);</span><br><span class="line"><span class="comment">// 2 加载 jar 包</span></span><br><span class="line">        job.setJarByClass(LogDriver.class);</span><br><span class="line"><span class="comment">// 3 关联 map</span></span><br><span class="line">        job.setMapperClass(WebLogMapper.class);</span><br><span class="line"><span class="comment">// 4 设置最终输出类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(NullWritable.class);</span><br><span class="line"><span class="comment">// 设置 reduceTask 个数为 0</span></span><br><span class="line">        job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 5 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">1</span>]));</span><br><span class="line"><span class="comment">// 6 提交</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol><h2 id="3-8、MapReduce开发总结"><a href="#3-8、MapReduce开发总结" class="headerlink" title="3.8、MapReduce开发总结"></a>3.8、MapReduce开发总结</h2><ol><li><p>输入数据接口：<code>InputFormat</code></p><ol><li>默认使用的实现类是：<code>TextInputFormat</code></li><li><code>TextInputFormat</code> 的功能逻辑是：一次读一行文本，然后将该行的起始偏移量作为key，行内容作为value返回</li><li><code>CombineTextInputFormat</code> 可以把多个小文件合并成一个切片处理，提高处理效率。</li></ol></li><li><p>逻辑处理接口：Mapper</p><p> 用户根据业务需求实现其中三个方法：<code>map()</code>、<code>setip()</code>、<code>cleanup()</code></p></li><li><p>Partitioner 分区</p><ol><li>有默认实现 <code>HashPartitioner</code>，逻辑是根据key的哈希值和<code>numReduces</code>来返回一个分区号；<code>key.hashCode()&amp;Integer.MAX_VALUE%numReduces</code></li><li>如果业务上有特变的需求，可以自定义分区。</li></ol></li><li><p>Comparable 排序</p><ol><li>当我们用自定义的对象作为key来输出时，就必须要是实现<code>WritableComparable</code>接口，重写其中的<code>compareTo()</code>方法</li><li>部分排序：对最终输出的每一个文件进行内部排序</li><li>全排序：对所有数据进行排序，通常只有一个Reduce</li><li>二次排序：排序的条件有两个</li></ol></li><li><p>Combiner 合并</p><p> Combiner 合并可以提高程序执行效率，减少IO传输。但是使用时必须不能影响原有的业务处理结果</p></li><li><p>逻辑处理接口：Reducer</p><p> 用户根据业务需求实现其中三个方法：<code>reduce()</code>、<code>setup()</code>、<code>cleanup()</code></p></li><li><p>输出数据接口：OutputFormat</p><ol><li>默认实现类时<code>TextOutputFormat</code>，功能逻辑时：将每一个KV对，向目标文本文件输出一行</li><li>用户还可以自定义<code>OutputFormat</code></li></ol></li></ol><h1 id="四、Hadoop数据压缩"><a href="#四、Hadoop数据压缩" class="headerlink" title="四、Hadoop数据压缩"></a>四、Hadoop数据压缩</h1><h2 id="4-1、概述"><a href="#4-1、概述" class="headerlink" title="4.1、概述"></a>4.1、概述</h2><ol><li><p>压缩的好处和坏处</p><p> 压缩的优点：以减少磁盘IO、减少磁盘存储空间。</p><p> 压缩的缺点：增加CPU开销。</p></li><li><p>压缩原则</p><ol><li>运算密集型的Job，少用压缩</li><li>IO密集型的Job，多用压缩</li></ol></li></ol><h2 id="4-2-MR支持的压缩编码"><a href="#4-2-MR支持的压缩编码" class="headerlink" title="4.2 MR支持的压缩编码"></a>4.2 MR支持的压缩编码</h2><ol><li><p>压缩算法对比介绍</p><p> | 压缩格式 | hadoop自带？                                | 算法    | 文件扩展名 | 是否可切片                        | 换成压缩格式后。原来的程序是否需要修改                       |<br> | ———— | —————————————————————- | ———- | ————— | ————————————————- | —————————————————————————————— |<br> | DEFLATE  | 是，直接使用                                | DEFLATE | .deflate   | 否                                | 和文本处理一样，不需要修改                                   |<br> | Gzip     | 是，直接使用                                | DEFLATE | .gz        | 否                                | 和文本处理一样，不需要修改                                   |<br> | bzip2    | 是，直接使用                                | bzip2   | .bz2       | <span style="color:red">是</span> | 和文本处理一样，不需要修改                                   |<br> | LZO      | <span style="color:red">否，需要安装</span> | LZO     | .lzo       | <span style="color:red">是</span> | <span style="color:red">需要建索引，还需要指定输入格式</span> |<br> | Snappy   | 是，直接使用                                | Snappy  | .snappy    | 否                                | 和文本处理一样，不需要修改                                   |</p></li><li><p>压缩性能的比较</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220820155328626.png" alt="image-20220820155328626"></p></li><li><p>压缩方式选择</p><p> 压缩方式选择时重点考虑：</p><ul><li>压缩/解压缩速度</li><li>压缩率（压缩后存储大小）</li><li>压缩后是否 可以支持切片。</li></ul></li></ol><h3 id="4-3-1、Gzip压缩"><a href="#4-3-1、Gzip压缩" class="headerlink" title="4.3.1、Gzip压缩"></a>4.3.1、Gzip压缩</h3><p>优点：压缩率比较高；</p><p>缺点：不支持Split；压缩/解压速度一般；</p><h3 id="4-3-2、Bzip2压缩"><a href="#4-3-2、Bzip2压缩" class="headerlink" title="4.3.2、Bzip2压缩"></a>4.3.2、Bzip2压缩</h3><p>优点：压缩率高；支持Split；</p><p>缺点：压缩/解压速度慢</p><h3 id="4-3-3-Lzo压缩"><a href="#4-3-3-Lzo压缩" class="headerlink" title="4.3.3 Lzo压缩"></a>4.3.3 Lzo压缩</h3><p>优点：压缩/解压速度比较块；支持Split；</p><p>缺点：压缩率一般；想支持切片需要额外创建索引</p><h3 id="4-3-4-Snappy压缩"><a href="#4-3-4-Snappy压缩" class="headerlink" title="4.3.4 Snappy压缩"></a>4.3.4 Snappy压缩</h3><p>优点：压缩饿解压速度块；</p><p>缺点：不支持Split；压缩率一般</p><h3 id="压缩位置选择"><a href="#压缩位置选择" class="headerlink" title="压缩位置选择"></a>压缩位置选择</h3><blockquote><p>压缩可以在MapReduce作用的任意阶段启用</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220820155853410.png" alt="image-20220820155853410"></p><h2 id="4-4、压缩参数配置"><a href="#4-4、压缩参数配置" class="headerlink" title="4.4、压缩参数配置"></a>4.4、压缩参数配置</h2><ol><li><p>为了支持多种压缩/解压缩算法，Hadoop 引入了编码/解码器</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220820160043206.png" alt="image-20220820160043206"></p></li><li><p>要在Hadoop中启用压缩，可以配置如下参数</p><p> | 参数                                                         | 默认值                                                       | 阶段                                          | 建议                                                         |<br> | —————————————————————————————— | —————————————————————————————— | ——————————————————————- | —————————————————————————————— |<br> | <span style="color:blue">io.compression.codecs（在 core-site.xml 中配置）</span> | <span style="color:blue">无，这个需要在命令行输入<code>hadoop checknative</code> 查看</span> | <span style="color:blue">输入压缩</span>      | <span style="color:blue">Hadoop 使用文件扩展 名判断是否支持某种 编解码器</span> |<br> | <span style="color:pink">mapreduce.map.output.compress（在 mapred-site.xml 中配置）</span> | <span style="color:pink">false</span>                        | <span style="color:pink">mapper 输出</span>   | <span style="color:pink">这个参数设为 true 启 用压缩</span>  |<br> | <span style="color:pink">mapreduce.map.output.compress.codec（在 mapred-site.xml 中配置）</span> | <span style="color:pink">org.apache.hadoop.io.com press.DefaultCodec</span> | <span style="color:pink">mapper 输出</span>   | <span style="color:pink">企业多使用 LZO 或 Snappy 编解码器在此 阶段压缩数据</span> |<br> | <span style="color:brown">mapreduce.output.fileoutputformat.compress（在 mapred-site.xml 中配置）</span> | <span style="color:brown">false</span>                       | <span style="color:brown">reducer 输出</span> | <span style="color:brown">这个参数设为 true 启 用压缩</span> |<br> | <span style="color:brown">mapreduce.output.fileoutputformat.compress.codec（在 mapred-site.xml 中配置）</span> | <span style="color:brown">org.apache.hadoop.io.com press.DefaultCodec</span> | <span style="color:brown">reducer 输出</span> | <span style="color:brown">使用标准工具或者编 解码器，如 gzip 和 bzip2</span> |</p></li></ol><h2 id="4-5、压缩案例实操"><a href="#4-5、压缩案例实操" class="headerlink" title="4.5、压缩案例实操"></a>4.5、压缩案例实操</h2><blockquote><p>以最简单的WordCount为例</p></blockquote><h3 id="4-5-1、Map输出端采用压缩"><a href="#4-5-1、Map输出端采用压缩" class="headerlink" title="4.5.1、Map输出端采用压缩"></a>4.5.1、Map输出端采用压缩</h3><p>即使你的 MapReduce 的输入输出文件都是未压缩的文件，你仍然可以对 Map 任务的中间结果输出做压缩，因为它要写在硬盘并且通过网络传输到 Reduce 节点，对其压缩可以提高很多性能，这些工作只要设置两个属性即可，我们来看下代码怎么设置。</p><ol><li><p>提供的 Hadoop 源码支持的压缩格式有：BZip2Codec、DefaultCodec</p><p> 修改WordCountDriver类，添加20-23行代码</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启 map 端输出压缩</span></span><br><span class="line">configuration.setBoolean(<span class="string">&quot;mapreduce.map.output.compress&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 设置 map 端输出压缩方式</span></span><br><span class="line">configuration.setClass(<span class="string">&quot;mapreduce.map.output.compress.codec&quot;</span>, BZip2Codec.class, CompressionCodec.class);</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.compress.BZip2Codec;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.compress.CompressionCodec;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 获取配置信息以及获取 job 对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开启 map 端输出压缩</span></span><br><span class="line">        configuration.setBoolean(<span class="string">&quot;mapreduce.map.output.compress&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 设置 map 端输出压缩方式</span></span><br><span class="line">        configuration.setClass(<span class="string">&quot;mapreduce.map.output.compress.codec&quot;</span>, BZip2Codec.class, CompressionCodec.class);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 关联本 Driver 程序的 jar</span></span><br><span class="line">        job.setJarByClass(WordCountDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 关联 Mapper 和 Reducer 的 jar</span></span><br><span class="line">        job.setMapperClass(WordCountMapper.class); <span class="comment">// 关联 Mapper</span></span><br><span class="line">        job.setReducerClass(WordCountReducer.class); <span class="comment">// 关联 Reducer</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 设置 Mapper 输出的 kv 类型 ,注意有Map，没有map的是第5步调用的方法</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 设置最终输出 kv 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello.txt&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello_output&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7. 提交 job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">false</span>);<span class="comment">// 参数true表示需要获取job的工作信息，false不用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据结果返回值，如果result == true（成功）返回0，如果失败返回1</span></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Mapper 保持不变</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 输入：</span></span><br><span class="line"><span class="comment"> *      KEY ： LongWritable  // 第几行</span></span><br><span class="line"><span class="comment"> *      VALUE ： Text        // 该行的内容</span></span><br><span class="line"><span class="comment"> * 输出：</span></span><br><span class="line"><span class="comment"> *      KEY ： Text          // 被统计的单词</span></span><br><span class="line"><span class="comment"> *      VALUE ： IntWritable // 该单词的数量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Text</span> <span class="variable">outKEY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outVALUE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>(<span class="number">1</span>); <span class="comment">// 一个单词数量是 1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写map方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 输入数据的KEY</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 输入数据的VALUE</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context 充当上下文，进行map和reduce之间的联络</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, IntWritable&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.获取一行 zyr zyr zyr</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> value.toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.切割 [zyr,zyr,zyr]</span></span><br><span class="line">        String[] words = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.循环写出</span></span><br><span class="line">        <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">            <span class="comment">// 封装outKEY</span></span><br><span class="line">            outKEY.set(word);</span><br><span class="line">            <span class="comment">// 写出</span></span><br><span class="line">            context.write(outKEY,outVALUE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Reducer 保持不变</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里和Mapper中的输入输出刚好相反</span></span><br><span class="line"><span class="comment"> * 输入：</span></span><br><span class="line"><span class="comment"> *      KEY ： Text          // 被统计的单词</span></span><br><span class="line"><span class="comment"> *      VALUE ： IntWritable // 该单词的数量</span></span><br><span class="line"><span class="comment"> * 输出：</span></span><br><span class="line"><span class="comment"> *      KEY ： Text          // 被统计的单词</span></span><br><span class="line"><span class="comment"> *      VALUE ： IntWritable // 该单词的数量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountReducer</span> <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text, IntWritable, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntWritable</span> <span class="variable">outValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntWritable</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写reduce</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   输入的key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values    输入的value，是一个可迭代对象(不是迭代器，它时一个集合，如果想要遍历它，需要先用value.iterator()得到一个迭代器，或者增强for循环，集合的遍历方式都可)</span></span><br><span class="line"><span class="comment">     *      例如zyr zyr zyr,被mapper弄成了三个，所以传入的K-V实际上是三组 zyr-1。但是Reducer在接收数据时会转化为：zyr-(1,1,1)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context   上下文作用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 累加  zyr-(1,1,1)</span></span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        outValue.set(sum);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写出</span></span><br><span class="line">        context.write(key,outValue);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>效果和之前一样，因为设置的压缩式Mapper输出压缩，到了Reducer又加压缩了。</p></li></ol><h3 id="4-5-2、Reduce输出端采用压缩"><a href="#4-5-2、Reduce输出端采用压缩" class="headerlink" title="4.5.2、Reduce输出端采用压缩"></a>4.5.2、Reduce输出端采用压缩</h3><p>基于WordCount案例吃力</p><ol><li><p>修改WordCountDriver驱动类,添加46-49行的内容</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.compress.BZip2Codec;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.compress.CompressionCodec;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCountDriver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 获取配置信息以及获取 job 对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开启 map 端输出压缩</span></span><br><span class="line">        configuration.setBoolean(<span class="string">&quot;mapreduce.map.output.compress&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 设置 map 端输出压缩方式</span></span><br><span class="line">        configuration.setClass(<span class="string">&quot;mapreduce.map.output.compress.codec&quot;</span>, BZip2Codec.class, CompressionCodec.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 关联本 Driver 程序的 jar</span></span><br><span class="line">        job.setJarByClass(WordCountDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 关联 Mapper 和 Reducer 的 jar</span></span><br><span class="line">        job.setMapperClass(WordCountMapper.class); <span class="comment">// 关联 Mapper</span></span><br><span class="line">        job.setReducerClass(WordCountReducer.class); <span class="comment">// 关联 Reducer</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 设置 Mapper 输出的 kv 类型 ,注意有Map，没有map的是第5步调用的方法</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 设置最终输出 kv 类型</span></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. 设置输入和输出路径</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello.txt&quot;</span>));</span><br><span class="line">        FileOutputFormat.setOutputPath(job,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;D:\\桌面\\hello_output&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 reduce 端输出压缩开启</span></span><br><span class="line">        FileOutputFormat.setCompressOutput(job, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 设置压缩的方式</span></span><br><span class="line">        FileOutputFormat.setOutputCompressorClass(job, BZip2Codec.class);</span><br><span class="line"><span class="comment">//        FileOutputFormat.setOutputCompressorClass(job, GzipCodec.class);</span></span><br><span class="line"><span class="comment">//   FileOutputFormat.setOutputCompressorClass(job,DefaultCodec.class);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7. 提交 job</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">false</span>);<span class="comment">// 参数true表示需要获取job的工作信息，false不用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据结果返回值，如果result == true（成功）返回0，如果失败返回1</span></span><br><span class="line">        System.exit(result ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Mapper和Reducer保持不变</p></li><li><p>效果：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220820162626137.png" alt="image-20220820162626137" style="zoom:67%;" /></p></li></ol><p>==各个阶段的压缩方式不同也影响结果==</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yarn</title>
      <link href="/posts/1767336200.html"/>
      <url>/posts/1767336200.html</url>
      
        <content type="html"><![CDATA[<details>此笔记是我学习 B站 尚硅谷相关课程的学习笔记</details><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823101148083.png" alt="image-20220823101148083"></p><h1 id="一、Yarn-资源调度器"><a href="#一、Yarn-资源调度器" class="headerlink" title="一、Yarn 资源调度器"></a>一、Yarn 资源调度器</h1><p>Yarn 是一个<strong>资源调度平台</strong>，负责为<strong>运算程序</strong>提供<strong>服务器运算资源</strong>。</p><p>相当于一个<strong>分布式的操作系统平台</strong>，而 <code>MapReduce</code> 等运算程序则相当于运行于<strong>操作系统之上的应用程序</strong>。</p><h2 id="1-1、Yarn-基础架构"><a href="#1-1、Yarn-基础架构" class="headerlink" title="1.1、Yarn 基础架构"></a>1.1、Yarn 基础架构</h2><p>YARN 主要由 <code>ResourceManager</code>、<code>NodeManager</code>、<code>ApplicationMaster</code> 和 <code>Container</code> 等组件构成。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823101527661.png" alt="image-20220823101527661"></p><p><code>RecourceManager</code>相当于是整个资源管理器的老大。<code>NodeManager</code>相当于是一个节点的资源管理器的老大。<code>ApplicationMaster</code>相当于是控制一次任务的管理器老大。<code>Contaier</code>相当于是执行任务的环境。</p><h2 id="1-2、Tarn-工作机制"><a href="#1-2、Tarn-工作机制" class="headerlink" title="1.2、Tarn 工作机制"></a>1.2、Tarn 工作机制</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823101922146.png" alt="image-20220823101922146"></p><ol><li><code>MapReduce</code> 程序提交到客户端所在的节点。</li><li><code>YarnRunner</code> 向 <code>ResourceManager</code> 申请一个 <code>Application</code>。</li><li><code>ResourceManager</code> 将该应用程序的资源路径返回给 <code>YarnRunner</code>。</li><li>该程序将运行所需资源提交到 <code>HDFS</code> 上。</li><li>程序资源提交完毕后，申请运行 <code>mrAppMaster</code>。</li><li><code>ResourceManager</code> 将用户的请求初始化成一个 Task。</li><li>其中一个 <code>NodeManager</code> 领取到 Task 任务。</li><li>该 <code>NodeManager</code> 创建容器 Container，并产生 <code>MRAppmaster</code>。</li><li><code>Container</code> 从 <code>HDFS</code> 上拷贝资源到本地。</li><li><code>MRAppmaster</code> 向 RM 申请运行 <code>MapTask</code> 资源。</li><li>RM 将运行 <code>MapTask</code> 任务分配给另外两个 <code>NodeManager</code>，另两个 <code>NodeManager</code> 分 别领取任务并创建容器。 </li><li>MR 向两个接收到任务的 <code>NodeManager</code> 发送程序启动脚本，这两个 <code>NodeManager</code> 分别启动 <code>MapTask</code>，<code>MapTask</code> 对数据分区排序。</li><li><code>MrAppMaster</code> 等待所有 <code>MapTask</code> 运行完毕后，向 RM 申请容器，运行 <code>ReduceTask</code>。</li><li><code>ReduceTask</code> 向 <code>MapTask</code> 获取相应分区的数据。</li><li>程序运行完毕后，MR 会向 RM 申请注销自己。</li></ol><h2 id="1-3、作业提交全过程"><a href="#1-3、作业提交全过程" class="headerlink" title="1.3、作业提交全过程"></a>1.3、作业提交全过程</h2><h3 id="1-3-1、流程图"><a href="#1-3-1、流程图" class="headerlink" title="1.3.1、流程图"></a>1.3.1、流程图</h3><p>HDFS、Yarn、MapReduce三者关系：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823102459202.png" alt="image-20220823102459202"></p><p>作业提交过程之Yarn：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823102606883.png" alt="image-20220823102606883"></p><p>作业提交过程之 HDFS &amp; MapReduce</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823102621208.png" alt="image-20220823102621208"></p><h3 id="1-3-2、作业提交全过程详解"><a href="#1-3-2、作业提交全过程详解" class="headerlink" title="1.3.2、作业提交全过程详解"></a>1.3.2、作业提交全过程详解</h3><ol><li><p>作业提交</p><ol><li>Client 调用 <code>job.waitForCompletion</code> 方法，向整个集群提交 <code>MapReduce</code> 作业。</li><li>Client 向 RM 申请一个作业 id。</li><li>RM 给 Client 返回该 job 资源的提交路径和作业 id。</li><li>Client 提交 jar 包、切片信息和配置文件到指定的资源提交路径。</li><li>Client 提交完资源后，向 RM 申请运行 <code>MrAppMaster</code>。</li></ol></li><li><p>作业初始化</p><ol><li>当 RM 收到 Client 的请求后，将该 job 添加到容量调度器中。</li><li>某一个空闲的 NM 领取到该 Job。</li><li>该 NM 创建 Container，并产生 <code>MRAppmaster</code>。</li><li>下载 Client 提交的资源到本地。</li></ol></li><li><p>任务分配</p><ol><li><code>MrAppMaster</code> 向 RM 申请运行多个 <code>MapTask</code> 任务资源。</li><li>RM 将运行 <code>MapTask</code> 任务分配给另外两个 <code>NodeManager</code>，另两个 <code>NodeManager</code> 分别领取任务并创建容器。</li></ol></li><li><p>任务运行</p><ol><li>MR 向两个接收到任务的 <code>NodeManager</code> 发送程序启动脚本，这两个 <code>NodeManager</code> 分别启动 <code>MapTask</code>，<code>MapTask</code> 对数据分区排序。</li><li><code>MrAppMaster</code>等待所有<code>MapTask</code>运行完毕后，向RM申请容器，运行<code>ReduceTask</code>。</li><li><code>ReduceTask</code> 向 <code>MapTask</code> 获取相应分区的数据。</li><li>程序运行完毕后，MR 会向 RM 申请注销自己。</li></ol></li><li><p>进度和状态更新</p><p> Yarn中的任务将器进度和状态（包括 counter ）返回给应用管理器，客户端每秒（通过 <code>mapreduce.client.progressmonitor.pollinterval</code> 设置）向应用管理器请求进度更新，展示给用户。</p></li><li><p>作业完成</p><p> 除了向应用管理器请求作业进度外, 客户端每 5 秒都会通过调用 <code>waitForCompletion()</code>来 检查作业是否完成。时间间隔可以通过 <code>mapreduce.client.completion.pollinterval</code> 来设置。作业 完成之后, 应用管理器和 Container 会清理工作状态。作业的信息会被作业历史服务器存储 以备之后用户核查。</p></li></ol><h2 id="1-4、Yarn-调度器和调度算法"><a href="#1-4、Yarn-调度器和调度算法" class="headerlink" title="1.4、Yarn 调度器和调度算法"></a>1.4、Yarn 调度器和调度算法</h2><p>目前，Hadoop 作业调度器主要有三种：</p><ul><li>先进先出调度器（FIFO）</li><li>容量（Capacity Scheduler）</li><li>公平（Fair Scheduler）</li></ul><p>Apache Hadoop3.3.3 默认的资源调度器是 容量（Capacity Scheduler）。</p><p>CDH 框架默认调度器是 公平（Fair Scheduler）</p><p>具体设置详见：yarn-default.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The class to use as the resource scheduler.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.scheduler.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-4-1、先进先出调度器（FIFO）"><a href="#1-4-1、先进先出调度器（FIFO）" class="headerlink" title="1.4.1、先进先出调度器（FIFO）"></a>1.4.1、先进先出调度器（FIFO）</h3><p>FIFO 调度器（First In First Out）：单队列，根据提交作业的先后顺序，先来先服务。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823105454008.png" alt="image-20220823105454008"></p><p>优点：简单易懂</p><p>缺点：不支持多队列，<strong>生产环境很少使用</strong></p><h3 id="1-4-2、容量调度器（Capacity-Scheduler）"><a href="#1-4-2、容量调度器（Capacity-Scheduler）" class="headerlink" title="1.4.2、容量调度器（Capacity Scheduler）"></a>1.4.2、容量调度器（Capacity Scheduler）</h3><p>Capacity Scheduler 是 Yahoo 开发的多用户调度器。</p><h4 id="1-4-2-1、特点"><a href="#1-4-2-1、特点" class="headerlink" title="1.4.2.1、特点"></a>1.4.2.1、特点</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823105611366.png" alt="image-20220823105611366"></p><ol><li>多队列：每个队列可配置一定的资源量，每个队列采用FIFO调度策略</li><li>容量保证：管理员可为每个队列设置资源最低保证和资源使用上限</li><li>灵活性：如果一个队列中的资源有剩余，可以暂时共享给那些需要资源的队列，而一旦该队列有新的应用 程序提交，则其他队列借调的资源会归还给该队列。</li><li>多租户：<ul><li>支持多用户共享集群和多应用程序同时运行。 </li><li>为了防止同一个用户的作业独占队列中的资源，该调度器会对<strong>同一用户提交的作业所占资源量进行限定</strong></li></ul></li></ol><h4 id="1-4-2-2、分配算法"><a href="#1-4-2-2、分配算法" class="headerlink" title="1.4.2.2、分配算法"></a>1.4.2.2、分配算法</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823105815020.png" alt="image-20220823105815020"></p><ol><li>队列资源分配 从root开始，使用深度优先算法，<strong>优先选择资源占用率最低</strong>的队列分配资源。</li><li>作业资源分配 默认按照提交作业的<strong>优先级</strong>和<strong>提交时间</strong>顺序分配资源。</li><li>容器资源分配按照容器的<strong>优先级</strong>分配资源， 如果优先级相同，按照数据本地性原则：<ol><li>任务和数据在同一节点</li><li>任务和数据在同一机架</li><li>任务和数据不在同一节点也不在同一机架</li></ol></li></ol><h3 id="1-4-3、公平调度器（Fair-Scheduler）"><a href="#1-4-3、公平调度器（Fair-Scheduler）" class="headerlink" title="1.4.3、公平调度器（Fair Scheduler）"></a>1.4.3、公平调度器（Fair Scheduler）</h3><p>Fair Schedulere 是 Facebook 开发的多用户调度器。</p><h4 id="1-4-3-1、特点"><a href="#1-4-3-1、特点" class="headerlink" title="1.4.3.1、特点"></a>1.4.3.1、特点</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823121255600.png" alt="image-20220823121255600"></p><h4 id="1-4-3-2、缺额"><a href="#1-4-3-2、缺额" class="headerlink" title="1.4.3.2、缺额"></a>1.4.3.2、缺额</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823121334003.png" alt="image-20220823121334003"></p><h4 id="1-4-3-3、队列资源分配方式"><a href="#1-4-3-3、队列资源分配方式" class="headerlink" title="1.4.3.3、队列资源分配方式"></a>1.4.3.3、队列资源分配方式</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823121408417.png" alt="image-20220823121408417"></p><h4 id="1-4-3-4、资源分配算法"><a href="#1-4-3-4、资源分配算法" class="headerlink" title="1.4.3.4、资源分配算法"></a>1.4.3.4、资源分配算法</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823121448907.png" alt="image-20220823121448907"></p><h4 id="1-4-3-5、队列资源分配方式"><a href="#1-4-3-5、队列资源分配方式" class="headerlink" title="1.4.3.5、队列资源分配方式"></a>1.4.3.5、队列资源分配方式</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823121538568.png" alt="image-20220823121538568"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220823121701486.png" alt="image-20220823121701486"></p><h2 id="1-5、Yarn-常用命令"><a href="#1-5、Yarn-常用命令" class="headerlink" title="1.5、Yarn 常用命令"></a>1.5、Yarn 常用命令</h2><p>Yarn 状态的查询，除了可以在 hadoop103:8088 页面查看外，还可以通过命令操作。常 见的命令操作如下所示：</p><p>需求：执行 WordCount 案例，并用 Yarn 命令查看任务运行情况。</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDFS</title>
      <link href="/posts/1547067935.html"/>
      <url>/posts/1547067935.html</url>
      
        <content type="html"><![CDATA[<details>此笔记是我学习 B站 尚硅谷相关课程的学习笔记</details><blockquote><p><strong>项目源码：</strong><a href="https://github.com/YongRuiZhang/hadoop_study_demo">https://github.com/YongRuiZhang/hadoop_study_demo</a></p></blockquote><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>HDFS（Hadoop Distributed File System），它是一个<strong>文件系统</strong>，用于存储文件，通过目录树来定位文件；其次，它是分布式的，由很多服务器联合起来实现其功能，集群中的服务器有各自的角色。 </p><p>HDFS 的使用场景：适合一次写入，多次读出的场景。一个文件经过创建、写入和关闭 之后就不需要改变。</p><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol><li>高容错<ul><li>数据自动保存多个副本。</li><li>某一个副本丢失以后，它可以自动恢复。</li></ul></li><li>适合处理海量数据<ul><li>数据规模：能够处理数据规模达到GB、TB、甚至PB级别的数据；</li><li>文件规模：能够处理百万规模以上的文件数量</li></ul></li><li>可构建的廉价的机器上，通过多副本机制，提高可靠性。</li></ol><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol><li>不适合低延时数据访问，比如毫秒级的存储结构（MySQL）</li><li>无法高效的对大量的小文件进行存储<ul><li>存储大量小文件的话，它会占用NameNode大量的内存来存储文件目录和块信息。这样试试不可取的，因为NameNode的内存总是有限的</li><li>小文件存储的寻址时间会超过读取时间，它违反了HDFS的设计目标</li></ul></li><li>不支持并发写入、文件随机修改<ul><li>一个文件只能由一个写，不允许多个线程同时写</li><li>仅支持数据append（追加），不支持文件的随机修改</li></ul></li></ol><h2 id="组成架构"><a href="#组成架构" class="headerlink" title="组成架构"></a>组成架构</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816095921419.png" alt="image-20220816095921419" style="zoom:67%;" /></p><ol><li><p>NameNode（nn）：就是Master，它 是一个主管、管理者。 </p><ol><li>管理HDFS的名称空间； </li><li>配置副本策略； </li><li>管理数据块（Block）映射信息； </li><li>处理客户端读写请求。 </li></ol></li><li><p>DataNode：就是Slave。NameNode 下达命令，DataNode执行实际的操作。 </p><ol><li>存储实际的数据块； </li><li>执行数据块的读/写操作。</li></ol></li><li><p>Client：就是客户端。 （网页和命令都是客户端，可以操作数据的端口）</p><ol><li>文件切分。文件上传HDFS的时候，Client将文件切分成一个一个的Block，然后进行上传； </li><li>与NameNode交互，获取文件的位置信息； </li><li>与DataNode交互，读取或者写入数据； </li><li>Client提供一些命令来管理HDFS，比如NameNode格式化； </li><li>Client可以通过一些命令来访问HDFS，比如对HDFS增删查改操作；</li></ol></li><li><p>Secondary NameNode：并非NameNode的热备。当NameNode挂掉的时候，它并不 能马上替换NameNode并提供服务。 </p><ol><li>辅助NameNode，分担其工作量，比如定期合并Fsimage和Edits，并推送给NameNode ； </li><li>在紧急情况下，可辅助恢复NameNode。但是只能恢复一部分数据，因为Secondary NameNode毕竟是老板的秘书，知道的信息没有老板多。</li></ol></li></ol><h2 id="HDFS文件块大小"><a href="#HDFS文件块大小" class="headerlink" title="HDFS文件块大小"></a>HDFS文件块大小</h2><p>这部分是面试重点。</p><p>HDFS中的文件在物理上是分块存储（Block），块的大小可以通过配置参数 (dfs.blocksize)来规定，默认大小在Hadoop2.x/3.x版本中是128M，1.x版本中是64M。</p><p>思考：为什么块的大小不能设置太小，也不能设置太大？ </p><p>答案：</p><ol><li>HDFS的块设置太小，会增加寻址时间，程序一直在找块的开始位置； </li><li>如果块设置的太大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间。导致程序在处理这块数据时，会非常慢。 </li></ol><p>总结：HDFS块的大小设置主要取决于磁盘传输速率。</p><h1 id="HDFS的Shell操作"><a href="#HDFS的Shell操作" class="headerlink" title="HDFS的Shell操作"></a>HDFS的Shell操作</h1><p> <strong><span style="font-size:30px">开发重点</span></strong> </p><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>如果 没有配置环境变量 就在<code>$HADOOP_HOME/bin</code>下使用命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs 具体命令</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">hdfs dfs 具体命令</span><br></pre></td></tr></table></figure><p><strong> 两者完全一样 </strong>，根据习惯使用就行了，涉及的具体命令也都是一模一样的。</p><h2 id="命令大全"><a href="#命令大全" class="headerlink" title="命令大全"></a>命令大全</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816112527249.png" alt="image-20220816112527249"></p><blockquote><p>整体分为两类：</p><ul><li>HDFS和服务器之间的数据操作<ul><li>上传（服务器上的文件送到HDFS上去）</li><li>下载（HDFS上的文件下载到服务器）</li></ul></li><li>HDFS自己的数据操作<ul><li>基本是就是linux的文件操作，大致一模一样</li></ul></li></ul></blockquote><h2 id="常用命令实操"><a href="#常用命令实操" class="headerlink" title="常用命令实操"></a>常用命令实操</h2><h3 id="1、准备工作"><a href="#1、准备工作" class="headerlink" title="1、准备工作"></a>1、准备工作</h3><ol><li><p>启动Hadoop集群（方便后续的测试工作）</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 <span class="variable">$HADOOP_HOME</span>下：</span></span><br><span class="line">sbin/start-dfs.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在任意路径下：</span></span><br><span class="line">myhadoop.sh start</span><br></pre></td></tr></table></figure><p> 现在学HDFS只启动HDFS就行，可以不用启动Yarn。</p></li><li><p>使用-help命令，输出命令的参数等</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdaoop fs -help rm</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816121624315.png" alt="image-20220816121624315"></p></li><li><p>打开web端<br>先尝试自己能否打开这些端口，能否使用Hadoop的web端：<a href="/posts/4130790367.html" title="hadoop常用端口号">hadoop常用端口号</a>。<br>现在需要使用的是9870端口，即访问： <a href="http://hadoop103:9870">http://hadoop103:9870</a><br>进入之后点击顶部菜单的 Utilities &gt; Browse the file system</p></li><li><p>创建一个<code>/sanguo</code>文件夹</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /sanguo</span><br></pre></td></tr></table></figure><p> 注意：要让创建的文件夹归HDFS管就要使用HDFS的命令来生成</p><p> 效果：</p><p> web端：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816202233983.png" alt="image-20220816202233983"></p><p> 命令行端：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816202357293.png" alt="image-20220816202357293"></p><p> 注意两者都是客户端。</p></li></ol><h3 id="2、上传"><a href="#2、上传" class="headerlink" title="2、上传"></a>2、上传</h3><div class="table-container"><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><a href="#`-moveFromLocal`"><code>-moveFromLocal</code></a></td><td>从本地<strong>剪切粘贴</strong>到 HDFS（move，也就是移动，移动之后本地就没有了）</td></tr><tr><td><a href="#`-copyFromLocal`"><code>-copyFromLocal</code></a></td><td>从本地文件系统中<strong>拷贝</strong>文件到 HDFS 路径去（拷贝之后本地还有）</td></tr><tr><td><a href="#`-put`"><code>-put</code></a></td><td>等同于 <code>-copyFromLocal</code>，生产环境更习惯用 <code>-put</code>（简洁啊，少打字）</td></tr><tr><td><a href="#`-appendToFile`"><code>-appendToFile</code></a></td><td>追加一个文件到<strong>已经存在</strong>的文件<strong>末尾</strong></td></tr></tbody></table></div><p>命令可点击跳转</p><h4 id="moveFromLocal"><a href="#moveFromLocal" class="headerlink" title="-moveFromLocal"></a><code>-moveFromLocal</code></h4><p>从本地剪切粘贴到 HDFS（移动，移动之后本地就没有了）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim shuguo.txt   # 创建一个文件用来上传</span><br><span class="line">写入内容:shuguo  # 蜀国</span><br><span class="line"></span><br><span class="line">hadoop fs -moveFromLocal ./shuguo.txt /sanguo</span><br><span class="line">命令名     从本地移动待移动的文件 移动的目标位置</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816202954368.png" alt="image-20220816202954368"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816203036181.png" alt="image-20220816203036181"></p><h4 id="copyFromLocal"><a href="#copyFromLocal" class="headerlink" title="-copyFromLocal"></a><code>-copyFromLocal</code></h4><p>从本地文件系统中<strong>拷贝</strong>文件到 HDFS 路径去（拷贝之后本地还有）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim weiguo.txt  # 创建一个文件用来上传</span><br><span class="line">写入内容：weiguo    # 魏国</span><br><span class="line"></span><br><span class="line">hadoop fs -copyFromLocal ./weiguo.txt /sanguo</span><br><span class="line">命令名从本地拷贝待拷贝的文件名 拷贝到的地方</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816203845165.png" alt="image-20220816203845165"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816204027291.png" alt="image-20220816204027291"></p><h4 id="put"><a href="#put" class="headerlink" title="-put"></a><code>-put</code></h4><p>等同于 <code>-copyFromLocal</code>，生产环境更习惯用 <code>-put</code>（简洁啊，少打字）。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim wuguo.txt  # 创建一个文件用来上传</span><br><span class="line">写入内容：wuguo# 吴国</span><br><span class="line"></span><br><span class="line">hadoop fs -put  ./weiguo.txt /sanguo</span><br><span class="line">命令名从本地拷贝待拷贝的文件名 拷贝到的地方</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816204327371.png" alt="image-20220816204327371"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816204437112.png" alt="image-20220816204437112"></p><h4 id="appendToFile"><a href="#appendToFile" class="headerlink" title="-appendToFile"></a><code>-appendToFile</code></h4><p>追加一个文件到已经存在的文件末尾.</p><p>这个用得少。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim liubei.txt # 创建一个文件用于演示</span><br><span class="line">输入内容：liubei# 刘备</span><br><span class="line"></span><br><span class="line">hadoop fs -appendToFile ./liubei.txt /sanguo/shuguo.txt</span><br><span class="line">命令名追加到文件待追加的文件接收追加的文件</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816205633423.png" alt="image-20220816205633423"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816205451689.png" alt="image-20220816205451689"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816205333123.png" alt="image-20220816205333123" style="zoom: 50%;" /></p><h3 id="3、下载"><a href="#3、下载" class="headerlink" title="3、下载"></a>3、下载</h3><div class="table-container"><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><a href="#`-copyToLocal`"><code>-copyToLocal</code></a></td><td>从 HDFS <strong>拷贝</strong>到<strong>本地</strong></td></tr><tr><td><a href="#`-get`"><code>-get</code></a></td><td>等同于 <code>-copyToLocal</code>，生产环境更习惯用 <code>-get</code>（还是因为简洁）</td></tr></tbody></table></div><blockquote><p> 因为蜀国是移动到HDFS上的（-moveFormLocal）所以本地是没有蜀国的，接下来的例子就演示下载蜀国。</p></blockquote><h4 id="copyToLocal"><a href="#copyToLocal" class="headerlink" title="-copyToLocal"></a><code>-copyToLocal</code></h4><p>从 HDFS 拷贝到本地</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -copyToLocal /sanguo/shuguo.txt ./</span><br><span class="line">命令名拷贝到本地  拷贝的位置  下载的位置</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816211709438.png" alt="image-20220816211709438"></p><h4 id="get"><a href="#get" class="headerlink" title="-get"></a><code>-get</code></h4><p>等同于 <code>-copyToLocal</code>，生产环境更习惯用 <code>-get</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -get    /sanguo/shuguo.txt ./shuguo2.txt</span><br><span class="line">命令名拷贝到本地  拷贝的位置  下载的位置</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816211813714.png" alt="image-20220816211813714"></p><h3 id="4、HDFS直接操作（Linux上也有的命令）"><a href="#4、HDFS直接操作（Linux上也有的命令）" class="headerlink" title="4、HDFS直接操作（Linux上也有的命令）"></a>4、HDFS直接操作（Linux上也有的命令）</h3><blockquote><p>也就是直接操作HDFS上的文件。上传和下载都是服务器本地和HDFS之间的操作。</p></blockquote><p>基本上和Linux命令一样。</p><div class="table-container"><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><code>-ls</code></td><td>显示目录信息</td></tr><tr><td><code>-cat</code></td><td>显示文件内容</td></tr><tr><td><code>-chgrp</code>、<code>-chmod</code>、<code>-chown</code></td><td>修改文件所属权限</td></tr><tr><td><code>-mkdir</code></td><td>创建路径</td></tr><tr><td><code>-cp</code></td><td>从 HDFS 的一个路径拷贝到 HDFS 的另一个路径</td></tr><tr><td><code>-mv</code></td><td>在 HDFS 目录中移动文件</td></tr><tr><td><code>-tail</code></td><td>显示一个文件的末尾 <strong> 1kb </strong> 的数据</td></tr><tr><td><code>-rm</code></td><td>删除文件或文件夹</td></tr><tr><td><code>-rm -r</code></td><td>递归删除目录及目录里面内容</td></tr><tr><td><code>-du</code></td><td>统计文件夹的大小信息</td></tr><tr><td><code>setrep</code></td><td>设置 HDFS 中文件的副本数量</td></tr></tbody></table></div><h4 id="ls："><a href="#ls：" class="headerlink" title="-ls："></a><code>-ls</code>：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /sanguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816211946705.png" alt="image-20220816211946705"></p><h4 id="cat："><a href="#cat：" class="headerlink" title="-cat："></a><code>-cat</code>：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -cat /sanguo/shuguo.txt</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816212040418.png" alt="image-20220816212040418"></p><h4 id="chmod"><a href="#chmod" class="headerlink" title="-chmod"></a><code>-chmod</code></h4><p>演示一个就够了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -chmod 666 /sanguo/shuguo.txt</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816212210137.png" alt="image-20220816212210137"></p><h4 id="mkdir"><a href="#mkdir" class="headerlink" title="-mkdir"></a><code>-mkdir</code></h4><p>前面的sanguo文件夹就是用这个命令传创建的。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /jinguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816212443741.png" alt="image-20220816212443741"></p><h4 id="cp"><a href="#cp" class="headerlink" title="-cp"></a><code>-cp</code></h4><p>将蜀国拷贝到晋国。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -cp /sanguo/shuguo.txt /jinguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816212647668.png" alt="image-20220816212647668"></p><h4 id="mv"><a href="#mv" class="headerlink" title="-mv"></a><code>-mv</code></h4><p>将吴国移动到晋国</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mv /sanguo/wuguo.txt /jinguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816212936529.png" alt="image-20220816212936529"></p><h4 id="tail"><a href="#tail" class="headerlink" title="-tail"></a><code>-tail</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -tail /jinguo/shuguo.txt</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816213111666.png" alt="image-20220816213111666"></p><h4 id="rm"><a href="#rm" class="headerlink" title="-rm"></a><code>-rm</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -rm /sanguo/shuguo.txt</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816213219315.png" alt="image-20220816213219315"></p><h4 id="rm-r"><a href="#rm-r" class="headerlink" title="-rm -r"></a><code>-rm -r</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -rm -r /sanguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816213318272.png" alt="image-20220816213318272"></p><h4 id="du"><a href="#du" class="headerlink" title="-du"></a><code>-du</code></h4><p>du的参数选项：</p><blockquote><ul><li>-s或—summarize 仅显示总计。</li><li>-h或—human-readable 以K，M，G为单位，提高信息的可读性。</li></ul></blockquote><p>统计文件夹的大小</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -du -s -h /jinguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816213506749.png" alt="image-20220816213506749"></p><blockquote><p>27表示文件大小</p><p>81表示总三个副本：27*3</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -du -h /jinguo</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816213532559.png" alt="image-20220816213532559"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816213803253.png" alt="image-20220816213803253"></p><h4 id="setrep"><a href="#setrep" class="headerlink" title="-setrep"></a><code>-setrep</code></h4><p>设置晋国下面的蜀国有10个副本。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -setrep 10 /jinguo/shuguo.txt</span><br></pre></td></tr></table></figure><p>这里设置的副本数只是记录在 NameNode 的元数据中，是否真的会有这么多副本，还得看 DataNode 的数量。因为目前只有 3 台设备，最多也就 3 个副本，只有节点数的增加到 10 台时，副本数才能达到 10。</p><p>如果只有一个副本，是谁还得学到后面才知道。</p><h1 id="HDFS的API操作"><a href="#HDFS的API操作" class="headerlink" title="HDFS的API操作"></a>HDFS的API操作</h1><blockquote><p> 目的是想要在windows中通过api操作HDFS。在Mac中使用API操作一样步骤，但是可以不获取winutils，不用配置winutils环境。</p><p> <strong>使用时一定要保证集群时启动的</strong></p><p> 注意如果Hadoop的版本是2.x的话会有一定差异（<strong>尤其是端口号</strong>），注意Hadoop版本。</p></blockquote><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><ol><li><p>获取依赖包</p><p> <a href="https://github.com/kontext-tech/winutils">https://github.com/kontext-tech/winutils</a></p></li><li><p>将依赖包放到<strong>无中文的目录</strong></p></li><li><p>配置环境变量（类似于配置Windows中的JDK）</p></li></ol><h2 id="在IDEA中做准备工作"><a href="#在IDEA中做准备工作" class="headerlink" title="在IDEA中做准备工作"></a>在IDEA中做准备工作</h2><ol><li>创建maven项目</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220816221537811.png" alt="image-20220816221537811" style="zoom:50%;" /></p><ol><li>引入hadoop-client的依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>版本不是和winutils的版本，<strong>是Linux中的Hadoop版本</strong>。</p><p>为了打印日志等其他功能，总共引入：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>在<code>src/main/resources</code>目录下新建一个文件，命名为：“log4j.properties”在文件中填入：</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">INFO, stdout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br><span class="line"><span class="attr">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.File</span>=<span class="string">target/spring.log</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br></pre></td></tr></table></figure><ol><li><p>创建包<code>com.zhang.hdfs</code></p></li><li><p>创建<code>HdfsClient</code>类</p><p> 客户端代码常用套路（最满足的就是HDFS和ZooKeeper）：</p><ol><li>获取一个客户端对象</li><li>执行相关的操作命令</li><li><p>关闭资源</p><p><strong>接下来写一个创建目录的函数。</strong></p><p>注意要连接的URI：</p></li></ol><ul><li><p>我们在hdfs-site.xml中设置了打开namenode web端的网址：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  这个网址就只是namenode web端的网址</p></li><li><p>我们在core-site.xml中设置了namenode的地址，这个地址才是真正的 namenode 的URI，我们就是要访问这个URI：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HdfsClient</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMkdirs</span><span class="params">()</span> <span class="keyword">throws</span> IOException, URISyntaxException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 连接集群的NameNode地址</span></span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020&quot;</span>);</span><br><span class="line">        <span class="comment">// 配置文件</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="comment">// 用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;zyr&quot;</span>;</span><br><span class="line">        <span class="comment">// 1. 获取到客户端对象</span></span><br><span class="line">        <span class="type">FileSystem</span> <span class="variable">fileSystem</span> <span class="operator">=</span> FileSystem.get(uri, configuration, user);</span><br><span class="line">        <span class="comment">// 2. 创建一给文件夹 西游 下面一个 花果山</span></span><br><span class="line">        fileSystem.mkdirs(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/xiyou/huaguoshan&quot;</span>)); <span class="comment">// 注意参数是一个Path对象，创建对象，用构造函数赋值</span></span><br><span class="line">        <span class="comment">// 3. 关闭资源</span></span><br><span class="line">        fileSystem.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意使用的包,知道那几个是要用hadoop的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br></pre></td></tr></table></figure></li></ul></li></ol><pre><code>效果：![image-20220817094651701](https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817094651701.png)</code></pre><ol><li><p>由于有大量相同操作，所以我们可以做一次封装，把获取一个客户端对象和关闭资源封装起来</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HdfsClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FileSystem fileSystem;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> URISyntaxException, IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 连接集群的NameNode地址</span></span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020&quot;</span>);</span><br><span class="line">        <span class="comment">// 配置文件</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="comment">// 用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;zyr&quot;</span>;</span><br><span class="line">        <span class="comment">// 1. 获取到客户端对象</span></span><br><span class="line">        fileSystem = FileSystem.get(uri, configuration, user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 3. 关闭资源</span></span><br><span class="line">        fileSystem.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMkdirs</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 创建一给文件夹 西游 下面一个 花果山</span></span><br><span class="line">        fileSystem.mkdirs(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/xiyou/huaguoshan1&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 效果：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817095950022.png" alt="image-20220817095950022"></p></li></ol><h2 id="参数优先级"><a href="#参数优先级" class="headerlink" title="参数优先级"></a>参数优先级</h2><p>参数优先级排序：客户端代码中设置的值 &gt; ClassPath 下的用户自定义配置文件 &gt; 然后是服务器的自定义配置（xxx-site.xml）&gt; 服务器的默认配置（xxx-default.xml）</p><p>客户端代码中设置的值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> URISyntaxException, IOException, InterruptedException &#123;</span><br><span class="line">    <span class="comment">// 连接集群的NameNode地址</span></span><br><span class="line">    <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020&quot;</span>);</span><br><span class="line">    <span class="comment">// 配置文件</span></span><br><span class="line">    <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">    configuration.set(<span class="string">&quot;dfs.replication&quot;</span>,<span class="string">&quot;2&quot;</span>);<span class="comment">//设置副本数为2</span></span><br><span class="line">    <span class="comment">// 用户</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;zyr&quot;</span>;</span><br><span class="line">    <span class="comment">// 1. 获取到客户端对象</span></span><br><span class="line">    fileSystem = FileSystem.get(uri, configuration, user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ClassPath 下的用户自定义配置文件：</p><p>在<code>src/main/resources</code>下创建hdfs-site.xml文件，写入配置（设置副本数为1）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>服务器也就是Ubuntu中的Hadoop配置文件了。我们写的xxx-site.xml，优先级比xxx-defalut.xml高。</p><h2 id="进行HDFS的API操作"><a href="#进行HDFS的API操作" class="headerlink" title="进行HDFS的API操作"></a>进行HDFS的API操作</h2><h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><p><code>copyFromLocalFile()</code>：参数一：是否删除原数据，参数二：是否允许覆盖，参数三：源数据路径（Win），参数四：目的地路径（HDFS）</p><hr><p>在windows的E盘创建一个文本文件，sunwukong，写入sunwukong，用来测试上传。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPut</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：是否删除原数据，参数二：是否允许覆盖，参数三：源数据路径（Win），参数四：目的地路径（HDFS）</span></span><br><span class="line">    fileSystem.copyFromLocalFile(<span class="literal">false</span>,<span class="literal">false</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;E:\\sunwukong.txt&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;hdfs://hadoop102/xiyou/huaguoshan&quot;</span>) );<span class="comment">//加不加协议头都无所谓，实际开发不加，直接写/xiyou/huaguoshan</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果：</p><p> 如果已经存在了文件，就会报错，因为第二个参数是false，表示不能覆盖，所以就上传不上去，就会报错 </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817102854602.png" alt="image-20220817102854602"></p><p>因为第一个参数时false，表示不删除原数据，所以原数据还在：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817102905963.png" alt="image-20220817102905963"></p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><code>copyToLocalFile()</code>：参数一：是否删除原数据，参数二：源数据路径（HDFS），参数三：目的地路径（Win）,参数四：是否本地校验</p><hr><p>删掉本地的sunwukong.txxt，来测试下载</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试下载</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 参数一：是否删除原数据，参数二：源数据路径（HDFS），参数三：目的地路径（Win）,参数四：是否本地校验</span></span><br><span class="line">        fileSystem.copyToLocalFile(<span class="literal">false</span>,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/xiyou/huaguoshan&quot;</span>),<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;E:\\sunwukong.txt&quot;</span>),<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>效果：</p><p>生成的是文件夹：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817105805791.png" alt="image-20220817105805791" style="zoom:50%;" /></p><p>文件夹中内容：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817105822929.png" alt="image-20220817105822929" style="zoom:50%;" /></p><p>sunwukong.txt中内容是一样的。。sunwukong.txt.crc是校验文件的工具。</p><p> 如果第四个参数为true，就不会产生.sunwukong.txt.crc文件 </p><p>第四个参数一般都不使用。</p><h3 id="直接操作"><a href="#直接操作" class="headerlink" title="直接操作"></a>直接操作</h3><h4 id="文件删除"><a href="#文件删除" class="headerlink" title="文件删除"></a>文件删除</h4><p><code>delete()</code>：参数一：三处文件的地址，参数二：是否递归删除</p><hr><p>删除一个文件（不用递归）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文件删除</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：三处文件的地址，参数二：是否递归删除</span></span><br><span class="line">    fileSystem.delete(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/jinguo/wuguo.txt&quot;</span>),<span class="literal">false</span>); <span class="comment">// 一个文件，用不用递归都一样</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除一个目录（非空目录用递归（否则报错）、空目录（用不用递归都无所谓））</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文件删除</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：三处文件的地址，参数二：是否递归删除</span></span><br><span class="line">    fileSystem.delete(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/jinguo&quot;</span>),<span class="literal">true</span>); <span class="comment">// 一个文件，用不用递归都一样</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文件的更名和移动"><a href="#文件的更名和移动" class="headerlink" title="文件的更名和移动"></a>文件的更名和移动</h4><p><code>rename</code>：参数一：原文件路径，参数二：目标文件路径</p><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 文件的移动和更名</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testmv</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 参数一：原文件路径，参数二：目标文件路径</span></span><br><span class="line">        <span class="comment">// 文件的更名</span></span><br><span class="line"><span class="comment">//        fileSystem.rename(new Path(&quot;/xiyou/huaguoshan/sunwukong.txt&quot;),</span></span><br><span class="line"><span class="comment">//                new Path(&quot;/xiyou/huaguoshan/qitiandasheng.txt&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 文件移动和更名，又要移动，又要更名</span></span><br><span class="line"><span class="comment">//        fileSystem.rename(new Path(&quot;/input/word.txt&quot;),new Path(&quot;/word_mv.txt&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 目录的更名</span></span><br><span class="line">        fileSystem.rename(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/input&quot;</span>), <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/output&quot;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="获取文件详情查看"><a href="#获取文件详情查看" class="headerlink" title="获取文件详情查看"></a>获取文件详情查看</h4><p><code>listFiles</code>：参数一：查看的路径，参数二：是否递归。返回一个迭代器</p><hr><p>相当于<code>-ls</code>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文件详细信息</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fileDetail</span> <span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：查看的路径，参数二：是否递归。返回一个迭代器</span></span><br><span class="line">    RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fileSystem.listFiles(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 遍历文件</span></span><br><span class="line">    <span class="keyword">while</span> (listFiles.hasNext()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">        <span class="type">LocatedFileStatus</span> <span class="variable">fileStatus</span> <span class="operator">=</span> listFiles.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;Path : &quot;</span> + fileStatus.getPath());</span><br><span class="line">        System.out.println(<span class="string">&quot;Name : &quot;</span> + fileStatus.getPath().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Permission : &quot;</span> + fileStatus.getPermission());</span><br><span class="line">        System.out.println(<span class="string">&quot;Owner : &quot;</span> + fileStatus.getOwner());</span><br><span class="line">        System.out.println(<span class="string">&quot;Group : &quot;</span> + fileStatus.getGroup());</span><br><span class="line">        System.out.println(<span class="string">&quot;Len : &quot;</span> + fileStatus.getLen());</span><br><span class="line">        System.out.println(<span class="string">&quot;ModificationTime : &quot;</span> + fileStatus.getModificationTime());</span><br><span class="line">        System.out.println(<span class="string">&quot;Replication : &quot;</span> + fileStatus.getReplication());</span><br><span class="line">        System.out.println(<span class="string">&quot;BlockSize : &quot;</span> + fileStatus.getBlockSize());</span><br><span class="line">        <span class="comment">// 获取块信息</span></span><br><span class="line">        BlockLocation[] blockLocations = fileStatus.getBlockLocations();</span><br><span class="line">        System.out.println(Arrays.toString(blockLocations));</span><br><span class="line">        System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果（输出）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">===============================================</span><br><span class="line">Path : hdfs:<span class="comment">//hadoop102:8020/word_mv.txt</span></span><br><span class="line">Name : word_mv.txt</span><br><span class="line">Permission : rw-r--r--</span><br><span class="line">Owner : zyr</span><br><span class="line">Group : zyr</span><br><span class="line">Len : <span class="number">12</span></span><br><span class="line">ModificationTime : <span class="number">1660706721280</span></span><br><span class="line">Replication : <span class="number">3</span></span><br><span class="line">BlockSize : <span class="number">134217728</span></span><br><span class="line">[<span class="number">0</span>,<span class="number">12</span>,hadoop104,hadoop103,hadoop103]</span><br><span class="line">===============================================</span><br><span class="line">===============================================</span><br><span class="line">Path : hdfs:<span class="comment">//hadoop102:8020/xiyou/huaguoshan/qitiandasheng.txt</span></span><br><span class="line">Name : qitiandasheng.txt</span><br><span class="line">Permission : rw-r--r--</span><br><span class="line">Owner : zyr</span><br><span class="line">Group : zyr</span><br><span class="line">Len : <span class="number">9</span></span><br><span class="line">ModificationTime : <span class="number">1660703296473</span></span><br><span class="line">Replication : <span class="number">3</span></span><br><span class="line">BlockSize : <span class="number">134217728</span></span><br><span class="line">[<span class="number">0</span>,<span class="number">9</span>,hadoop104,hadoop103,hadoop103]</span><br><span class="line">===============================================</span><br></pre></td></tr></table></figure><h4 id="文件和文件夹判断"><a href="#文件和文件夹判断" class="headerlink" title="文件和文件夹判断"></a>文件和文件夹判断</h4><p><code>listStatus</code>：参数一：路径</p><hr><p>判断目录下那些事文件夹那些事文件。</p><p>每一个对象都是<code>FileStatus</code>，上面的<code>listFiles()</code>得到的迭代器中的对象是<code>LocatedFileStatus</code>。方法都一样，上面也能判断是否是文件。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是文件夹还是文件</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    FileStatus[] listStatus = fileSystem.listStatus(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">    <span class="keyword">for</span> (FileStatus status : listStatus) &#123;</span><br><span class="line">        <span class="keyword">if</span> (status.isFile()) &#123;</span><br><span class="line">            System.out.println(status.getPath().getName() + <span class="string">&quot;是一个文件&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(status.getPath().getName() + <span class="string">&quot;是一个目录&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果（输出）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output是一个目录</span><br><span class="line">tmp是一个目录</span><br><span class="line">word_mv.txt是一个文件</span><br><span class="line">xiyou是一个目录</span><br></pre></td></tr></table></figure><h1 id="HDFS的读写流程（面试重点）"><a href="#HDFS的读写流程（面试重点）" class="headerlink" title="HDFS的读写流程（面试重点）"></a>HDFS的读写流程（面试重点）</h1><h2 id="HDFS写数据流程"><a href="#HDFS写数据流程" class="headerlink" title="HDFS写数据流程"></a>HDFS写数据流程</h2><h3 id="剖析文件写入"><a href="#剖析文件写入" class="headerlink" title="剖析文件写入"></a>剖析文件写入</h3><blockquote><p>写数据就是客户端想要向HDFS上传文件的过程。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817160253882.png" alt="image-20220817160253882"></p><ol><li><p>客户端想要上传文件先创建一个Distributed FileSystem（分布式文件系统）模块向NameNode请求上传文件</p></li><li><p>NameNode检查目录树是否可以创建文件，可以上传文件就响应给客户端说可以上传文件</p><ol><li>检查权限是否满足</li><li>检查目录结构看目录是否存在</li></ol></li><li><p>客户端请求上传第一个Block（0-128M），请求返回DataNode节点用来储存数据</p></li><li><p>NameNode接收请求返回n个（副本数）DataNode节点（我们这里是三个，因为有三台服务器）（dn1,dn2,dn3）</p><p> 副本节点选择顺序</p><ol><li>本地节点</li><li>其他机架一个节点 （机架之后再讲）</li><li>其他机架另一个节点</li></ol></li><li><p>客户端接收到响应回来的节点，创建<code>FSDataOutputStream</code>输出流流对象，之后就请求建立Bolck通道。这个请求会向第3步返回的节点发送，并且只会往一个（dn1）里发送，这一个（dn1）通过了，由这一个向后面的节点（dn2）继续发送（有点串行的感觉）</p><p> 就是：客户端—&gt;dn1—&gt;dn2—&gt;dn3</p></li><li><p>最后一个节点（dn3）搜到请求建立好了Bolck通道之后就会响应，向发送给它请求的节点（dn2）响应，一层一层直到客户端</p><p> 就是：dn3—&gt;dn2—&gt;dn1—&gt;客户端</p></li><li><p>客户端收到响应后，开始往 dn1 上传第一个 Block（先从磁盘读取数据放到一个本地内存缓存）， 以 Packet 为单位，dn1 收到一个 Packet 就会传给 dn2，dn2 传给 dn3；dn1 每传一个 packet 会放入一个应答队列等待应答。</p></li><li><p>当一个 Block 传输完成之后，客户端再次请求 NameNode 上传第二个 Block 的服务器。（重复执行 3-7 步）。</p></li></ol><h3 id="网络拓扑——节点距离计算"><a href="#网络拓扑——节点距离计算" class="headerlink" title="网络拓扑——节点距离计算"></a>网络拓扑——节点距离计算</h3><blockquote><p>在 HDFS 写数据的过程中，NameNode 会选择距离待上传数据最近距离的 DataNode 接收数据。那么这个最近距离怎么计算呢？</p></blockquote><p> 节点距离：两个节点到达<strong>最近</strong>的<strong>共同祖先</strong>的<strong>距离总和</strong>。 </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817154322485.png" alt="image-20220817154322485"></p><ul><li>Distance(/d1/r1/n0,/d1/r1/n0)=0 ： 因为本来就是同一个节点</li><li>Distance(/d1/r1/n1,/d1/r1/n2)=2 ： 因为这两个不是同一个节点，都往上找发现机架r1是这两个节点最近的共同祖先。/d1/r1/n1距离这个公共祖先的距离为1，/d1/r1/n2距离这个公祖先的距离为1，所以距离总和为2</li><li>Distance(/d1/r2/n0,/d1/r3/n2)=4 ： 因为这两个不是同一个节点，都往上找发现集群d1是这两个节点最近的共同祖先。/d1/r2/n0距离这个公共祖先的距离为2，/d1/r3/n2距离这个公祖先的距离为2，所以距离总和为4</li><li>Distance(/d1/r2/n1,/d2/r4/n1)=6 ： 因为这两个不是同一个节点，都往上找发现根节点是这两个节点最近的共同祖先。/d1/r2/n1距离这个公共祖先的距离为3，/d2/r4/n1距离这个公祖先的距离为3，所以距离总和为6</li></ul><h3 id="机架感知——副本存储节点选择"><a href="#机架感知——副本存储节点选择" class="headerlink" title="机架感知——副本存储节点选择"></a>机架感知——副本存储节点选择</h3><ol><li><p>机架感知说明</p><p> 官方说明：</p> <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">For the common case, when the replication factor is three, HDFS’s placement policy is to put one replica on the local machine if the writer is on a datanode, otherwise on a random datanode, another replica on a node in a different (remote) rack, and the last on a different node in the same remote rack. This policy cuts the inter-rack write traffic which generally improves write performance. The chance of rack failure is far less than that of node failure; this policy does not impact data reliability and availability guarantees. However, it does reduce the aggregate network bandwidth used when reading data since a block is placed in only two unique racks rather than three. With this policy, the replicas of a file do not evenly distribute across the racks. One third of replicas are on one node, two thirds of replicas are on one rack, and the other third are evenly distributed across the remaining racks. This policy improves write performance without compromising data reliability or read performance.</span><br></pre></td></tr></table></figure><p> 翻译：</p> <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于常见情况，当复制系数为3时，HDFS的放置策略是，如果编写器位于DataNode上，则将一个副本放在本地计算机上，否则放在随机DataNode上，将另一个副本放在不同(远程)机架中的节点上，最后将最后一个副本放在同一远程机架中的不同节点上。此策略减少了机架间写入流量，这通常会提高写入性能。机架故障的可能性远远小于节点故障的可能性；此策略不会影响数据可靠性和可用性保证。但是，它确实减少了读取数据时使用的聚合网络带宽，因为一个数据块只放置在两个唯一的机架中，而不是三个。使用此策略时，文件的副本不会在机架上均匀分布。三分之一的副本位于一个节点上，三分之二的副本位于一个机架上，另外三分之一均匀分布在其余机架上。此策略可在不影响数据可靠性或读取性能的情况下提高写入性能。</span><br></pre></td></tr></table></figure></li><li><p>副本节点选择</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817155622663.png" alt="image-20220817155622663"></p><ol><li>第一个副本保证效率，所以存在客户端所处的节点上（如果客户端再集群中）。如果客户端不在集群中根本就不知道客户端再哪一个节点上，选择任何一个节点的效率都差不多，所以就随机选一个节点</li><li>第二个副本保证可靠性，不和第一份节点存在同一个机架上，只要是另一个机架就行，随机选一个节点</li><li><p>第三个副本又要保证效率，就随机存在第二个副本所在的机架的随机另一个节点就可以了</p><p><strong>存到同一个机架的效率比存到另一个机架效率更高</strong></p></li></ol></li></ol><h2 id="HDFS读数据流程"><a href="#HDFS读数据流程" class="headerlink" title="HDFS读数据流程"></a>HDFS读数据流程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817160320155.png" alt="image-20220817160320155"></p><ol><li>客户端先请求读数据，先创建DistributedFileSystem（分布式文件系统）向NameNode发送请求，请求下载文件。</li><li>NameNode先检查是否满足权限，再通过查找元数据，找到文件块所在的DataNode地址，返回该文件块的DataNode节点位置给客户端</li><li>客户端拿到DataNode节点地址后，创建<code>FSDataInputStream</code>输入数据流，之后向元数据中的DataNode发送请求，请求读入数据，也是分块拿。选择读取的DataNode顺序和写入一样。</li><li>节点收到请求，返回数据给客户端</li><li>如果前面的DataNode由于访问量过大，就可以先去访问其他DataNode节点。实际上还是串行不是并行</li><li>后面的节点接收到请求，响应数据给客户端</li></ol><h1 id="NameNode-和-SecondaryNameNode"><a href="#NameNode-和-SecondaryNameNode" class="headerlink" title="NameNode 和 SecondaryNameNode"></a>NameNode 和 SecondaryNameNode</h1><blockquote><p>NameNode 简称 NN 或 nn</p><p>SecondaryNamdeNode 简称 2NN 或 2nn</p></blockquote><h2 id="NN-和-2NN-工作机制"><a href="#NN-和-2NN-工作机制" class="headerlink" title="NN 和 2NN 工作机制"></a>NN 和 2NN 工作机制</h2><p> 思考：NameNode 中的元数据是存储在哪里的？ </p><blockquote><p>首先，我们做个假设，如果存储在 NameNode 节点的磁盘中，因为经常需要进行随机访问，还有响应客户请求，必然是效率过低。因此，<strong>元数据需要存放在内存中</strong>。</p><p>但如果<strong>只存在</strong>内存中，一旦断电，元数据丢失，整个集群就无法工作了。因此产生在<strong>磁盘</strong>中<strong>备份</strong>元数据的<strong>FsImage</strong>。 </p><p>这样又会带来新的问题，当在内存中的元数据更新时，如果同时更新 FsImage，就会导致效率过低，但如果不更新，就会发生一致性问题，一旦 NameNode 节点断电，就会产生数据丢失。因此，引入 Edits 文件（只进行追加操作，效率很高）。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到 Edits 中。这样，一旦 NameNode 节点断电，可以通过 FsImage 和 Edits 的合并，合成元数据。</p><p>但是，如果长时间添加数据到 Edits 中，会导致该文件数据过大，效率降低，而且一旦断电，恢复元数据需要的时间过长。因此，需要定期进行 FsImage 和 Edits 的合并，如果这 个操作由NameNode节点完成，又会效率过低。因此，引入一个新的节点SecondaryNamenode， 专门用于 FsImage 和 Edits 的合并。</p></blockquote><p>总结：数据存在内存中。为了安全产生FsImage，为了更新FsImage引入Edits文件。通过FsImage和Edits的合并可以合成元数据。但避免恢复元数据效率慢，引入SecondaryNameNode来定期进行FsImage和Edits的合并。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817161904373.png" alt="image-20220817161904373"></p><h3 id="第一阶段：NameNode启动"><a href="#第一阶段：NameNode启动" class="headerlink" title="第一阶段：NameNode启动"></a>第一阶段：NameNode启动</h3><ol><li>第一次启动 NameNode 格式化后，创建 Fsimage 和 Edits 文件。如果不是第一次启动，直接加载编辑日志和镜像文件到内存。</li><li>客户端对元数据进行增删改的请求。</li><li>NameNode 记录操作日志，更新滚动日志。</li><li>NameNode 在内存中对元数据进行增删改。</li></ol><h3 id="第二阶段：SecondaryNameNode工作"><a href="#第二阶段：SecondaryNameNode工作" class="headerlink" title="第二阶段：SecondaryNameNode工作"></a>第二阶段：SecondaryNameNode工作</h3><ol><li>Secondary NameNode 询问 NameNode 是否需要 CheckPoint。直接带回 NameNode 是否检查结果。</li><li>Secondary NameNode 请求执行 CheckPoint。</li><li>NameNode 滚动正在写的 Edits 日志</li><li>将滚动前的编辑日志和镜像文件拷贝到 Secondary NameNode。</li><li>Secondary NameNode 加载编辑日志和镜像文件到内存，并合并。</li><li>生成新的镜像文件 fsimage.chkpoint。</li><li>拷贝 fsimage.chkpoint 到 NameNode。</li><li>NameNode 将 fsimage.chkpoint 重新命名成 fsimage。</li></ol><h2 id="FsImage-和-Edits-解析"><a href="#FsImage-和-Edits-解析" class="headerlink" title="FsImage 和 Edits 解析"></a>FsImage 和 Edits 解析</h2><p>NameNode被格式化之后，将在<code>/usr/local/hadoop/data/dfs/name/current</code>目录中产生如下文件</p><p>​                            fsimage_0000000000000000000</p><p>​                            fsimage_0000000000000000000.md5</p><p>​                            seen_txid</p><p>​                            VERSION</p><ol><li><p>FsImage文件：HDFS文件系统元数据的一个<strong>永久性的检查点</strong>，其中包含HDFS文件系统的所有目录和文件inode的序列化信息。 </p></li><li><p>Edits文件：存放HDFS文件系统的所有更新操作的<strong>路径</strong>，文件系统客户端执行的所有写操作首先会被记录到Edits文件中。 </p></li><li><p>seen<em>txid文件保存的是一个<strong>数字</strong>，就是最后一个edits</em>的数字 </p></li><li><p>每次NameNode启动的时候都会将FsImage文件读入内存，加载Edits里面的更新操作，保证内存中的元数据信息是<strong>最新的、同步的</strong>，可以看成NameNode启动的时候就将FsImage和Edits文件进行了合并。</p></li></ol><h3 id="oiv-查看-FsImage-文件"><a href="#oiv-查看-FsImage-文件" class="headerlink" title="oiv 查看 FsImage 文件"></a>oiv 查看 FsImage 文件</h3><ul><li><p>基本语法</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oiv -p 转换后的文件类型 -i 镜像文件 -o 转换后文件输出路径（即保存路径）</span><br></pre></td></tr></table></figure></li><li><p>案例实操</p><p>  再<code>/usr/local/hadoop/data/dfs/name/current</code>目录下：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oiv -p XML -i fsimage_0000000000000000125 -o /usr/local/hadoop/fsimage.xml</span><br></pre></td></tr></table></figure><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817164247588.png" alt="image-20220817164247588"></p><p>  通过Xftp将文件传到Windows，将这个xml文件内容拷贝到IDEA中创建的xml文件中，并格式化（不格式化也能看懂，只是乱七八糟的不太好看）。</p><p>  内容太多，就不粘贴了。在可以看出来里面执行了写什么操作。</p><blockquote><p>思考：可以看出，Fsimage 中没有记录块所对应 DataNode，为什么？ </p><p>在集群启动后，要求 DataNode 上报数据块信息，并间隔一段时间后再次上报。</p></blockquote></li></ul><h3 id="oev-查看-Edits-文件"><a href="#oev-查看-Edits-文件" class="headerlink" title="oev 查看 Edits 文件"></a>oev 查看 Edits 文件</h3><ul><li><p>基本语法</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oev -p 转换后的文件类型 -i 编辑日志 -o 转化后文件输出路径（保存地址）</span><br></pre></td></tr></table></figure></li><li><p>案例实操</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oev -p XML -i edits_inprogress_0000000000000000128 -o  /usr/local/hadoop/edits.xml</span><br></pre></td></tr></table></figure><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817173235373.png" alt="image-20220817173235373"></p><p>  看了xml之后得出结论， Edits是对文件做追加操作 </p><blockquote><p>思考：NameNode 如何确定下次开机启动的时候合并哪些 Edits？</p><p>合并大于127的因为：fsimage_0000000000000000127，最后的fsimage是127的。</p><p>所以下一次就是合并：edits_inprogress_0000000000000000128，其他的edits已经合并过了</p><p>edits_inprogress_0000000000000000128这个就是现在最新的操作数据。唯一比SecondaryNameNode多的文件</p></blockquote></li></ul><h2 id="CheckPoint-时间设置"><a href="#CheckPoint-时间设置" class="headerlink" title="CheckPoint 时间设置"></a>CheckPoint 时间设置</h2><ul><li><p>通常情况下，SecondaryNameNode 每隔一小时执行一次。</p><p>  因为：hdfs-defaule.xml中：(一般都不会配置这个，所以通常就是3600s)</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.period<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>3600s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817174042498.png" alt="image-20220817174042498" style="zoom: 67%;" /></p><p>  可以看出来，除了关闭服务器之外，两次备份实际上就是间隔3600s也就是1h。</p></li><li><p>一分钟检查一次操作次数，当操作次数达到1百万是，SecondaryNameNode执行一次（我们数据量没有那么大）</p><p>  hdfs-defaule.xml中：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.txns<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1000000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h1><h2 id="DataNode-工作机制"><a href="#DataNode-工作机制" class="headerlink" title="DataNode 工作机制"></a>DataNode 工作机制</h2><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817174352584.png" alt="image-20220817174352584"></p></li></ul><ol><li><p>一个数据块在 DataNode 上以<strong>文件形式</strong>存储在<strong>磁盘</strong>上，包括两个文件：</p><ul><li>一个是数据本身</li><li>一个是元数据包括数据块的长度，块数据的校验和，以及时间戳。</li></ul></li><li><p>DataNode 启动后向 NameNode 注册，通过后，周期性（6 小时）地向 NameNode <strong>上报</strong>所有的块信息。</p><p> 配置在hdfs-default.xml中：</p><p> DN 扫描自己节点块信息列表的时间，默认 6 小时</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.directoryscan.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>21600s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p> DN 向 NN 汇报当前解读信息的时间间隔，默认 6 小时；</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.blockreport.intervalMsec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>21600000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>心跳是每 3 秒一次，心跳返回结果带有 NameNode 给该 DataNode 的命令如复制 块数据 到另一台机器，或删除某个 数据块 。<a href="#掉线时限参数有关设置">如果超过 10 分钟没有收到某个 DataNode 的心跳， 则 NameNode 认为该节点已不可用。</a></p><p> 心跳主要是为了证明还存活，周期性的交互（不会像第2步那样传那么多信息）</p></li><li><p>集群运行中可以安全加入和退出一些机器。</p></li></ol><h2 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h2><blockquote><p>思考：如果电脑磁盘里面存储的数据是控制高铁信号灯的红灯信号（1）和绿灯信号（0）， 但是存储该数据的磁盘坏了，一直显示是绿灯，是否很危险？同理 DataNode 节点上的数据 损坏了，却没有发现，是否也很危险，那么如何解决呢？</p></blockquote><p>DataNode保证数据完整性的方法：</p><ol><li>当 DataNode 读取 Block 的时候，它会计算 CheckSum。 </li><li>如果计算后的 CheckSum，与 Block 创建时值不一样，说明 Block 已经损坏。 </li><li>Client 读取其他 DataNode 上的 Block。 </li><li>常见的校验算法 crc（32），md5（128），sha1（160） —— 都是些加密算法，原理是先保存数据，然后加密发过去，之后再解密看看数据是不是一样。数据不一样就是第2步</li><li>DataNode 在其文件创建后周期验证 CheckSum。</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817175610441.png" alt="image-20220817175610441"></p><h2 id="掉线时限参数有关设置"><a href="#掉线时限参数有关设置" class="headerlink" title="掉线时限参数有关设置"></a>掉线时限参数有关设置</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220817180207789.png" alt="image-20220817180207789"></p><blockquote><p>需要注意的是 hdfs-site.xml 配置文件中的 heartbeat.recheck.interval （超时时长） 的单位为毫秒， dfs.heartbeat.interval （心跳间隔时间）的单位为秒。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.heartbeat.recheck-interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>300000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.heartbeat.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol><li><p>HDFS文件块大小（面试重点）</p><ul><li>硬盘读写速度</li><li>在企业中  一般128m（中小公司）   256m （大公司）</li></ul></li><li><p>HDFS的Shell操作（开发重点）</p><p> 熟悉相关命令就行，不然开发速度不够</p></li><li><p>HDFS的读写流程（面试重点）</p></li><li><p>NN和2NN、DataNode有关东西了解就好</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Redis集群</title>
      <link href="/posts/778231993.html"/>
      <url>/posts/778231993.html</url>
      
        <content type="html"><![CDATA[<h1 id="基本环境"><a href="#基本环境" class="headerlink" title="基本环境"></a>基本环境</h1><p>这里搭建的是三主三从的redis集群。需要三台虚拟机，每一台虚拟机都会有一主一从。</p><p>三台虚拟机可以相互访问。</p><h1 id="下载Redis"><a href="#下载Redis" class="headerlink" title="下载Redis"></a>下载Redis</h1><p>访问官网：<a href="https://redis.io/">https://redis.io/</a></p><blockquote><p>Redis有中文网：<a href="http://redis.cn/这个是根据英文官网翻译过来的，有一定滞后性">http://redis.cn/这个是根据英文官网翻译过来的，有一定滞后性</a></p></blockquote><p>点击右上角的Download</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-25%2017.06.43.png" style="zoom:33%;" /></p><p>然后点击左边的Download 7.0.10。即可下载</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-25%2017.13.23.png" alt="截屏2023-03-25 17.13.23" style="zoom:33%;" /></p><p>下载好后上传到虚拟机。Windows电脑用Xftp传输即可，Mac使用FileZilla传输。注意目标文件夹到权限。</p><h1 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h1><blockquote><p>注意，安装Redis必须先具备gcc到编译环境</p><p>输入命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -v</span><br></pre></td></tr></table></figure><p>如果出现对应版本，则表示有gcc编译环境。</p><p>如果没有就下载：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gcc</span><br></pre></td></tr></table></figure><p>可以更新一下apt：<code>sudo apt update</code>之后再下载gcc。这里默认是下载的gcc-11</p></blockquote><p>因为提前将安装包传递到你虚拟机内。去到指定目录，然后解压。</p><p>我是将安装包放在：/usr/local/redis目录下的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf redis-7.0.10.tar</span><br></pre></td></tr></table></figure><p>如果是.tar.gz结尾则输入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf redis-7.0.10.tar.gz</span><br></pre></td></tr></table></figure><p>之后将解压后的包放在一个位置即可，这个压缩包就可以删除了。</p><p>我是这样操作的：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> redis-7.0.10 ../ <span class="comment"># 把解压好后的文件夹放到 /usr/local 目录下</span></span><br><span class="line"><span class="built_in">cd</span> .. <span class="comment"># 退回到 /usr/local 目录下</span></span><br><span class="line">sudo <span class="built_in">rm</span> -rf redis <span class="comment"># 删除包含redis安装包的redis文件夹</span></span><br><span class="line">sudo <span class="built_in">mv</span> redis-7.0.10 redis <span class="comment"># 将解压好后的redis文件夹改名为redis</span></span><br></pre></td></tr></table></figure><p>这样就完成了一台虚拟机的安装。</p><p>利用分发脚本，将文件夹分发给其他两个服务器：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync redis</span><br></pre></td></tr></table></figure><blockquote><p>xsync命令是我自己封装的，如果你想要封装参考文章：集群分发脚本</p><p>如果你没有分发命令，也不想自己封装，就在其他两台服务器上重复上述操作即可。</p></blockquote><h1 id="配置Redis"><a href="#配置Redis" class="headerlink" title="配置Redis"></a>配置Redis</h1><h2 id="编译Redis"><a href="#编译Redis" class="headerlink" title="编译Redis"></a>编译Redis</h2><p>进入redis目录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/redis</span><br></pre></td></tr></table></figure><p>编译redis，<strong>这一步最好切换到root用户执行</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><blockquote><p>如果没有make命令，则安装：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install make</span><br></pre></td></tr></table></figure></blockquote><p>出现：<code>Hint: It&#39;s a good idea to run &#39;make test&#39; ;)</code>且没有ERROR就表示编译成功。</p><p>它默认会安装到<code>/usr/local/bin</code>目录下</p><p>到<code>/usr/local/bin</code>目录下查看，如图情况即为成功：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-25%2017.45.10.png" style="zoom:50%;" /></p><h2 id="便写Redis的配置文件"><a href="#便写Redis的配置文件" class="headerlink" title="便写Redis的配置文件"></a>便写Redis的配置文件</h2><p>接下来继续写Redis的配置文件<code>/usr/local/redis</code>目录下的redis.conf文件：</p><p>为了稳妥起见如此操作（在<code>/usr/local/redis</code>目录下）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> myredis</span><br><span class="line"><span class="built_in">cp</span> redis.conf myredis/redis7.conf</span><br></pre></td></tr></table></figure><p>这个意思是：创建一个myredis目录，然后把原本的redis.conf文件拷贝到myredis目录下。相当于是做了一个备份。</p><p>接下来打开文件修改内容（<code>/usr/local/redis/myredis</code>目录下）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redis7.conf</span><br></pre></td></tr></table></figure><p>修改内容：</p><p>可以在命令模式下利用/requirepass查找对应位置。</p><ol><li><p>默认<code>daemonize no</code> 修改为 <code>daemonize yes</code></p><p> 默认是服务前台打开，改为后台启动</p></li><li><p>默认 <code>protected-mode yes</code> 修改为 <code>protected-mode no</code></p><p> 默认的保护模式打开，现在关闭，如果不关闭外部无法连接</p></li><li><p>默认 <code>bind 127.0.0.1</code> 直接注释掉或者改成本机IP，否则影响远程IP连接。我选择直接注释掉。</p></li><li><p>添加redis密码：<code>你的密码</code></p><p> 这里默认是注释掉，需要打开注释。或者直接添加<code>requirepass 密码</code>例如我：<code>requirepass 111111</code></p></li></ol><p>保存退出。</p><h1 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h1><p>先配置环境变量吧：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis</span></span><br><span class="line"><span class="built_in">export</span> REDIS_HOME=/usr/local/redis</span><br></pre></td></tr></table></figure><p>保存后生效：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>在<code>/usr/local/redis</code>目录下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server myredis/redis7.conf</span><br></pre></td></tr></table></figure><p>检查一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep redis|grep -v grep</span><br></pre></td></tr></table></figure><p>出现：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop1+   45203       1  0 10:03 ?        00:00:01 redis-server *:6379</span><br></pre></td></tr></table></figure><p>这种的就表示启动了。默认的端口就是6379。</p><h1 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 -p 6379</span><br></pre></td></tr></table></figure><p>说明：</p><p>-a 命令后是密码</p><p>-p 命令后是服务的端口，默认是6379，其实也可以不写</p><blockquote><p>出现这个警告是正常的：</p><p>Warning: Using a password with ‘-a’ or ‘-u’ option on the command line interface may not be safe.</p></blockquote><p>可以简单玩一玩：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>到这里单机安装就成功啦。</p><p>一些说明，如果前面配置文件没有写：<code>requirepass</code>配置，就不用-a选项</p><p>如果是单机启动，一般启动的默认端口就是6379，可以不指定端口。</p><p>如果有密码但是输入：<code>redis-cli</code>直接回车也可以进入，但是会出现如下情况：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/redis/myredis$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>这个时候需要再输入：<code>auth 111111</code>，完整操作：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/redis/myredis$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">127.0.0.1:6379&gt; auth 111111</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>退出连接直接输入：<code>quit</code>或者<code>exit</code></p><h1 id="关闭服务"><a href="#关闭服务" class="headerlink" title="关闭服务"></a>关闭服务</h1><h2 id="单实例关闭"><a href="#单实例关闭" class="headerlink" title="单实例关闭"></a>单实例关闭</h2><p>在redis-cli即客户端中输入<code>shutdown</code>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; shutdown</span><br><span class="line">not connected&gt; <span class="built_in">exit</span></span><br><span class="line">hadoop103@hadoop103:/usr/local/redis/myredis$ ps -ef|grep redis|grep -v grep</span><br><span class="line">hadoop103@hadoop103:/usr/local/redis/myredis$</span><br></pre></td></tr></table></figure><p>如果没有在redis客户端中，输入：<code>redis-cli -a 111111 shutdown</code></p><h2 id="多实例关闭"><a href="#多实例关闭" class="headerlink" title="多实例关闭"></a>多实例关闭</h2><p>假设指定关闭6379端口的redis：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 -p 6379 shutdown</span><br></pre></td></tr></table></figure><p>其实原理差不多。</p><h1 id="卸载redis"><a href="#卸载redis" class="headerlink" title="卸载redis"></a>卸载redis</h1><p>如果想要更换版本就一定要先卸载原本的redis。</p><ol><li><p>停止服务，看上一章</p></li><li><p>删除<code>/usr/local/bin</code>下的所有配置：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/local/bin/redis-*</span><br></pre></td></tr></table></figure></li></ol><h1 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h1><p>创建redis集群文件夹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/redis/myredis/cluster</span><br></pre></td></tr></table></figure><p>然后进入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/redis/myredis/cluster</span><br></pre></td></tr></table></figure><blockquote><p>三个虚拟机都要如此执行</p></blockquote><h2 id="新建6个独立的redis实例"><a href="#新建6个独立的redis实例" class="headerlink" title="新建6个独立的redis实例"></a>新建6个独立的redis实例</h2><p>分配端口：我们知道单机启动时redis默认在6379端口启动，所以我们从6381端口开始分配：</p><p>hadoop103：6381、6382</p><p>hadoop104：6383、6384</p><p>hadoop105：6385、6386</p><h3 id="hadoop103"><a href="#hadoop103" class="headerlink" title="hadoop103"></a>hadoop103</h3><p>在hadoop103上编写集群配置文件：redisCluster6381.conf、redisCluster6382.conf</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redisCluster6381.conf</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6381</span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/myredis/cluster/cluster6381.log&quot;</span></span><br><span class="line">pidfile /usr/local/redis/myredis/cluster6381.pid</span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/myredis/cluster</span><br><span class="line">dbfilename dump6381.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly6381.aof&quot;</span></span><br><span class="line">requirepass 111111</span><br><span class="line">masterauth 111111</span><br><span class="line"></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6381.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redisCluster6382.conf</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6382</span><br><span class="line">logfile <span class="string">&quot;//usr/local/redismyredis/cluster/cluster6382.log&quot;</span></span><br><span class="line">pidfile /usr/local/redis/myredis/cluster6382.pid</span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/myredis/cluster</span><br><span class="line">dbfilename dump6382.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly6382.aof&quot;</span></span><br><span class="line">requirepass 111111</span><br><span class="line">masterauth 111111</span><br><span class="line"></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6382.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure><h3 id="hadoop104"><a href="#hadoop104" class="headerlink" title="hadoop104"></a>hadoop104</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redisCluster6383.conf</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6383</span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/myredis/cluster/cluster6383.log&quot;</span></span><br><span class="line">pidfile /usr/local/redis/myredis/cluster6383.pid</span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/myredis/cluster</span><br><span class="line">dbfilename dump6383.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly6383.aof&quot;</span></span><br><span class="line">requirepass 111111</span><br><span class="line">masterauth 111111</span><br><span class="line"></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6383.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redisCluster6384.conf</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6384</span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/myredis/cluster/cluster6384.log&quot;</span></span><br><span class="line">pidfile /usr/local/redis/myredis/cluster6384.pid</span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/myredis/cluster</span><br><span class="line">dbfilename dump6384.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly6384.aof&quot;</span></span><br><span class="line">requirepass 111111</span><br><span class="line">masterauth 111111</span><br><span class="line"></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6384.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure><h3 id="hadoop105"><a href="#hadoop105" class="headerlink" title="hadoop105"></a>hadoop105</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redisCluster6385.conf</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6385</span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/myredis/cluster/cluster6385.log&quot;</span></span><br><span class="line">pidfile /usr/local/redis/myredis/cluster6385.pid</span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/myredis/cluster</span><br><span class="line">dbfilename dump6385.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly6385.aof&quot;</span></span><br><span class="line">requirepass 111111</span><br><span class="line">masterauth 111111</span><br><span class="line"></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6385.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redisCluster6386.conf</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line">protected-mode no</span><br><span class="line">port 6386</span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/myredis/cluster/cluster6386.log&quot;</span></span><br><span class="line">pidfile /usr/local/redis/myredis/cluster6386.pid</span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/myredis/cluster</span><br><span class="line">dbfilename dump6386.rdb</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly6386.aof&quot;</span></span><br><span class="line">requirepass 111111</span><br><span class="line">masterauth 111111</span><br><span class="line"></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes-6386.conf</span><br><span class="line">cluster-node-timeout 5000</span><br></pre></td></tr></table></figure><h2 id="启动六个redis服务实例"><a href="#启动六个redis服务实例" class="headerlink" title="启动六个redis服务实例"></a>启动六个redis服务实例</h2><p>在对应虚拟机上启动：</p><ul><li><p>hadoop103</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server myredis/cluster/redisCluster6381.conf</span><br><span class="line">redis-server myredis/cluster/redisCluster6382.conf</span><br></pre></td></tr></table></figure></li><li><p>hadoop104</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server myredis/cluster/redisCluster6383.conf</span><br><span class="line">redis-server myredis/cluster/redisCluster6384.conf</span><br></pre></td></tr></table></figure></li><li><p>hadoop105</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-server myredis/cluster/redisCluster6385.conf</span><br><span class="line">redis-server myredis/cluster/redisCluster6386.conf</span><br></pre></td></tr></table></figure></li></ul><p>测试：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep redis|grep -v grep</span><br></pre></td></tr></table></figure><p>结果（后面带有<code>[cluster]</code>就是成功了）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/redis$ ps -ef|grep redis|grep -v grep</span><br><span class="line">hadoop1+   47113       1  0 14:18 ?        00:00:01 redis-server 0.0.0.0:6381 [cluster]</span><br><span class="line">hadoop1+   47151       1  0 14:21 ?        00:00:00 redis-server 0.0.0.0:6382 [cluster]</span><br></pre></td></tr></table></figure><h2 id="构建主从关系"><a href="#构建主从关系" class="headerlink" title="构建主从关系"></a>构建主从关系</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 --cluster create --cluster-replicas 1 hadoop103:6381 hadoop103:6382 hadoop104:6383 hadoop104:6384 hadoop105:6385 hadoop105:6386</span><br></pre></td></tr></table></figure><p>—cluster create 表示创建集群环境</p><p>—cluster-replicas 1 表示每一个master给一个slave节点</p><blockquote><p>要把所有实例的redis-server启动起来之后再执行上面的命令</p></blockquote><p>执行结果：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/redis$ redis-cli -a 111111 --cluster create --cluster-replicas 1 hadoop103:6381 hadoop103:6382 hadoop104:6383 hadoop104:6384 hadoop105:6385 hadoop105:6386</span><br><span class="line">Warning: Using a password with <span class="string">&#x27;-a&#x27;</span> or <span class="string">&#x27;-u&#x27;</span> option on the <span class="built_in">command</span> line interface may not be safe.</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica hadoop104:6384 to hadoop103:6381</span><br><span class="line">Adding replica hadoop105:6386 to hadoop104:6383</span><br><span class="line">Adding replica hadoop103:6382 to hadoop105:6385</span><br><span class="line">M: 322b0e3ca2879165cadff469c409e454ce7fe50d hadoop103:6381</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">S: f02366fcfa1a74f7b642c69787605c825506efe9 hadoop103:6382</span><br><span class="line">   replicates e211f8a39ac8a24f5b68e9bd0aae590c101073a2</span><br><span class="line">M: 188a4323f92bcd33c52ac418ce820dcf192c7749 hadoop104:6383</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">S: b05f518d17fc839d455752e296a1ae31547def93 hadoop104:6384</span><br><span class="line">   replicates 322b0e3ca2879165cadff469c409e454ce7fe50d</span><br><span class="line">M: e211f8a39ac8a24f5b68e9bd0aae590c101073a2 hadoop105:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 1944d02efaa72cb1e941e5c9b39398d158f62bea hadoop105:6386</span><br><span class="line">   replicates 188a4323f92bcd33c52ac418ce820dcf192c7749</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">&#x27;yes&#x27;</span> to accept): <span class="built_in">yes</span></span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to <span class="built_in">join</span></span><br><span class="line">.</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node hadoop103:6381)</span><br><span class="line">M: 322b0e3ca2879165cadff469c409e454ce7fe50d hadoop103:6381</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b05f518d17fc839d455752e296a1ae31547def93 192.168.70.104:6384</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 322b0e3ca2879165cadff469c409e454ce7fe50d</span><br><span class="line">S: 1944d02efaa72cb1e941e5c9b39398d158f62bea 192.168.70.105:6386</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 188a4323f92bcd33c52ac418ce820dcf192c7749</span><br><span class="line">M: 188a4323f92bcd33c52ac418ce820dcf192c7749 192.168.70.104:6383</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: f02366fcfa1a74f7b642c69787605c825506efe9 192.168.70.103:6382</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates e211f8a39ac8a24f5b68e9bd0aae590c101073a2</span><br><span class="line">M: e211f8a39ac8a24f5b68e9bd0aae590c101073a2 192.168.70.105:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica hadoop104:6384 to hadoop103:6381</span><br><span class="line">Adding replica hadoop105:6386 to hadoop104:6383</span><br><span class="line">Adding replica hadoop103:6382 to hadoop105:6385</span><br><span class="line">M: 322b0e3ca2879165cadff469c409e454ce7fe50d hadoop103:6381</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">S: f02366fcfa1a74f7b642c69787605c825506efe9 hadoop103:6382</span><br><span class="line">   replicates e211f8a39ac8a24f5b68e9bd0aae590c101073a2</span><br><span class="line">M: 188a4323f92bcd33c52ac418ce820dcf192c7749 hadoop104:6383</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">S: b05f518d17fc839d455752e296a1ae31547def93 hadoop104:6384</span><br><span class="line">   replicates 322b0e3ca2879165cadff469c409e454ce7fe50d</span><br><span class="line">M: e211f8a39ac8a24f5b68e9bd0aae590c101073a2 hadoop105:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 1944d02efaa72cb1e941e5c9b39398d158f62bea hadoop105:6386</span><br><span class="line">   replicates 188a4323f92bcd33c52ac418ce820dcf192c7749</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">&#x27;yes&#x27;</span> to accept): <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>这里是提示分配原则，分配redis的槽点为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br></pre></td></tr></table></figure><p>之后就是添加主从关系：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Adding replica hadoop104:6384 to hadoop103:6381</span><br><span class="line">Adding replica hadoop105:6386 to hadoop104:6383</span><br><span class="line">Adding replica hadoop103:6382 to hadoop105:6385</span><br></pre></td></tr></table></figure><p>意思是hadoop103下的6381端口是一个master，它的slave是hadoop104下的6384端口…</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">M: 322b0e3ca2879165cadff469c409e454ce7fe50d hadoop103:6381</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">S: f02366fcfa1a74f7b642c69787605c825506efe9 hadoop103:6382</span><br><span class="line">   replicates e211f8a39ac8a24f5b68e9bd0aae590c101073a2</span><br><span class="line">M: 188a4323f92bcd33c52ac418ce820dcf192c7749 hadoop104:6383</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">S: b05f518d17fc839d455752e296a1ae31547def93 hadoop104:6384</span><br><span class="line">   replicates 322b0e3ca2879165cadff469c409e454ce7fe50d</span><br><span class="line">M: e211f8a39ac8a24f5b68e9bd0aae590c101073a2 hadoop105:6385</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 1944d02efaa72cb1e941e5c9b39398d158f62bea hadoop105:6386</span><br><span class="line">   replicates 188a4323f92bcd33c52ac418ce820dcf192c7749</span><br></pre></td></tr></table></figure><p>这也是描述主从关系的：M表示Master，S表示slave</p><p>这里需要手动输入<code>yes</code>表示服从这样的分配。</p><p>之后的应用就是如此配置了。</p><h2 id="检查集群情况"><a href="#检查集群情况" class="headerlink" title="检查集群情况"></a>检查集群情况</h2><p>这里用hadoop103来检查即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 -p 6381</span><br></pre></td></tr></table></figure><p>这里登陆6381看看，注意这种集群启动的情况一定要指定端口了。</p><p>打开客户端后：输入<code>info replication</code>查看信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hadoop103@hadoop103:/usr/local/redis$ redis-cli -a 111111 -p 6381</span><br><span class="line">Warning: Using a password with <span class="string">&#x27;-a&#x27;</span> or <span class="string">&#x27;-u&#x27;</span> option on the <span class="built_in">command</span> line interface may not be safe.</span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=192.168.70.104,port=6384,state=online,offset=672,lag=1</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:ba6e029edb67301b96744ef2c8767107fe6f5312</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:672</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:672</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></table></figure><p>可以从输出看出：</p><p><code>role:master</code> 身份是master</p><p><code>connected_slaves:1</code> 连接的salve数为1</p><p><code>slave0:ip=192.168.70.104,port=6384,state=online,offset=672,lag=1</code> slave的ip等信息，和构建主从关系这一步的分配是一样的：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Adding replica hadoop104:6384 to hadoop103:6381</span><br><span class="line">Adding replica hadoop105:6386 to hadoop104:6383</span><br><span class="line">Adding replica hadoop103:6382 to hadoop105:6385</span><br></pre></td></tr></table></figure><p>这样的结果就是正确的。</p><hr><p>可以输入<code>cluster nodes</code>查看信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; cluster nodes</span><br><span class="line">b05f518d17fc839d455752e296a1ae31547def93 192.168.70.104:6384@16384 slave 322b0e3ca2879165cadff469c409e454ce7fe50d 0 1679755326000 1 connected</span><br><span class="line">1944d02efaa72cb1e941e5c9b39398d158f62bea 192.168.70.105:6386@16386 slave 188a4323f92bcd33c52ac418ce820dcf192c7749 0 1679755326951 3 connected</span><br><span class="line">188a4323f92bcd33c52ac418ce820dcf192c7749 192.168.70.104:6383@16383 master - 0 1679755326442 3 connected 5461-10922</span><br><span class="line">f02366fcfa1a74f7b642c69787605c825506efe9 192.168.70.103:6382@16382 slave e211f8a39ac8a24f5b68e9bd0aae590c101073a2 0 1679755326000 5 connected</span><br><span class="line">e211f8a39ac8a24f5b68e9bd0aae590c101073a2 192.168.70.105:6385@16385 master - 0 1679755326000 5 connected 10923-16383</span><br><span class="line">322b0e3ca2879165cadff469c409e454ce7fe50d 192.168.70.103:6381@16381 myself,master - 0 1679755325000 1 connected 0-5460</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">322b0e3ca2879165cadff469c409e454ce7fe50d 192.168.70.103:6381@16381 myself,master - 0 1679755325000 1 connected 0-5460</span><br></pre></td></tr></table></figure><p>上面这句的意思就是标记这是我，身份是master，我对应的槽点：0-5468</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b05f518d17fc839d455752e296a1ae31547def93 192.168.70.104:6384@16384 slave 322b0e3ca2879165cadff469c409e454ce7fe50d 0 1679755326000 1 connected</span><br></pre></td></tr></table></figure><p>这一句表示：我的身份是slave，我是b05f518d17fc839d455752e296a1ae31547def93，我服务的master是322b0e3ca2879165cadff469c409e454ce7fe50d。</p><hr><p>可以输入<code>cluster info</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:1689</span><br><span class="line">cluster_stats_messages_pong_sent:1836</span><br><span class="line">cluster_stats_messages_sent:3525</span><br><span class="line">cluster_stats_messages_ping_received:1831</span><br><span class="line">cluster_stats_messages_pong_received:1689</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:3525</span><br><span class="line">total_cluster_links_buffer_limit_exceeded:0</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></table></figure><p>这就是查看集群的状态，总槽点，节点数量，服务器数量等。</p><h1 id="使用集群"><a href="#使用集群" class="headerlink" title="使用集群"></a>使用集群</h1><p>这里是使用集群的一些注意事项：</p><p>引出问题：</p><p>一般启动：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 -p 6381</span><br></pre></td></tr></table></figure><p>输入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">(error) MOVED 12706 192.168.70.105:6385</span><br><span class="line">127.0.0.1:6381&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6381&gt;</span><br></pre></td></tr></table></figure><p>发现set k1的时候报错了，意思是计算出来k1应该属于12706这个槽点，但是6381只能管0-5468这部分槽点，所以要求我去能关12706槽点的节点才能set k1，也就是hadoop105。</p><p>如果要解决这种问题，之后使用客户端时需要添加<code>-c</code>选项：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 111111 -p 6381 -c</span><br></pre></td></tr></table></figure><p>再输入命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">192.168.70.105:6385&gt; flushall</span><br><span class="line">OK</span><br><span class="line">192.168.70.105:6385&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">192.168.70.105:6385&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">192.168.70.105:6385&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">-&gt; Redirected to slot [449] located at 192.168.70.103:6381</span><br><span class="line">OK</span><br><span class="line">192.168.70.103:6381&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k2&quot;</span></span><br><span class="line">192.168.70.103:6381&gt; get k1</span><br><span class="line">-&gt; Redirected to slot [12706] located at 192.168.70.105:6385</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">192.168.70.105:6385&gt; get k2</span><br><span class="line">-&gt; Redirected to slot [449] located at 192.168.70.103:6381</span><br><span class="line"><span class="string">&quot;v2&quot;</span></span><br><span class="line">192.168.70.103:6381&gt;</span><br></pre></td></tr></table></figure><p>可以看出，它会自己帮忙定向到对应位置了。每次定向之后前面的IP也在变化105和103之间变化。</p><p>所以其他节点也可以读到了。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 大数据开发 </category>
          
          <category> 后端 </category>
          
          <category> Redis </category>
          
          <category> 环境搭建 </category>
          
          <category> 中间件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Linux </tag>
            
            <tag> Java后端 </tag>
            
            <tag> Redis </tag>
            
            <tag> 中间件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HBase API</title>
      <link href="/posts/2106547339.html"/>
      <url>/posts/2106547339.html</url>
      
        <content type="html"><![CDATA[<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>新建项目后在 pom.xml 中添加依赖（API的版本要与HBase的版本一致HBase是2.4.11，所以maven版本也是2.4.11）： </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：如果报错 javax.el 包不存在，是一个测试用的依赖，不影响使用，如果介意则如此添加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1-b06<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h1 id="创建链接"><a href="#创建链接" class="headerlink" title="创建链接"></a>创建链接</h1><p>根据官方 API 介绍，HBase 的客户端连接由 <strong>ConnectionFactory 类</strong>来创建，用户使用完成之后<strong>需要手动关闭连接</strong>。同时连接是一个<strong>重量级的</strong>，推荐<strong>一个进程使用一个连接</strong>，对 HBase的命令通过连接中的<strong>两个属性 Admin 和 Table 来实现</strong>。 </p><h2 id="单线程创建链接"><a href="#单线程创建链接" class="headerlink" title="单线程创建链接"></a>单线程创建链接</h2><p>HBaseConnection1：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.A_TestConnection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Connection;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yonruizhang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/3/20 15:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 尝试 单线程 连接HBase —— 注意导入的包名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HBaseConnection1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 创建连接 配置对象</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 给配置对象添加配置参数 —— zookeeper地址，利用zookeeper管理</span></span><br><span class="line">        conf.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>,<span class="string">&quot;hadoop103,hadoop104,hadoop105&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 利用工厂类 创建连接对象</span></span><br><span class="line">        <span class="comment">// 默认使用同步连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionFactory.createConnection(conf); <span class="comment">// 其实默认会去resources下的hbase-site.xml文件的配置内容，所以可以不传参数</span></span><br><span class="line">        <span class="comment">// 异步链接（Hbase2.3.x之后才有）:</span></span><br><span class="line"><span class="comment">//        CompletableFuture&lt;AsyncConnection&gt; asyncConnection = ConnectionFactory.createAsyncConnection(conf);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 测试是否链接上了</span></span><br><span class="line">        System.out.println(connection);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 关闭连接</span></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多线程创建链接"><a href="#多线程创建链接" class="headerlink" title="多线程创建链接"></a>多线程创建链接</h2><p>使用类单例模式,确保使用一个连接，可以同时用于多个线程。即设置hbase链接为静态属性。</p><p>HBaseConnection2：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.A_TestConnection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Connection;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yonruizhang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/3/20 15:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 尝试 多线程 连接HBase —— 注意导入的包名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HBaseConnection2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明一个静态属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 在静态代码块中创建链接</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 直接在resources下的hbase-site.xml写入配置即可，ConnectionFactory.createConnection()会自动去读入。</span></span><br><span class="line">        <span class="comment">// 1. 利用工厂类 创建连接对象</span></span><br><span class="line">        <span class="comment">// 默认使用同步连接</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = ConnectionFactory.createConnection();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 直接使用创建好的连接，不要在main线程中单独创建</span></span><br><span class="line">        System.out.println(connection);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在main线程最后关闭连接</span></span><br><span class="line">        closeConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里就不再创建 <code>Configuration</code> 对象，将描述信息给链接了，因为通过追踪<code>ConnectionFactory.createConnection()</code>发现它默认会去 resources 目录下找 hbase-site.xml 文件，该文件就是配置文件。我们也应该将配置写在配置文件中，以此可以使得连接更加方便和灵活。</p><p>在resources下创建hbase-site.xml文件，并写入：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103,hadoop104,hadoop105<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><p>创建 HBaseDDL 类，添加静态方法即可作为工具类 。</p><p>直接利用HBaseConnection2文件中创建的静态连接即可：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> HBaseConnection2.connection;</span><br></pre></td></tr></table></figure><p>DDL操作使用Admin操作，都获取Admin：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br></pre></td></tr></table></figure><h2 id="创建命名空间"><a href="#创建命名空间" class="headerlink" title="创建命名空间"></a>创建命名空间</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 创建一个namespace</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> namespace namespace的名字</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createNamespace</span><span class="params">(String namespace)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// 1. 获取Admin</span></span><br><span class="line">       <span class="comment">// admin 的连接是轻量级的 不是线程安全的 不推荐池化或者缓存这个连接</span></span><br><span class="line">       <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 2. 调用方法创建命名空间</span></span><br><span class="line">       <span class="comment">// 代码相对shell更加底层，保证shell能完成的功能代码也能完成</span></span><br><span class="line">       <span class="comment">// 所以参数是 NamespaceDescriptor 对象，需要填写完整的命名空间描述</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// 2.1 创建 NamespaceDescriptor 的 builder 对象（相当于是建造师）</span></span><br><span class="line">       NamespaceDescriptor.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> NamespaceDescriptor.create(namespace);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 2.2 给命名空间添加需求（描述信息）</span></span><br><span class="line">       builder.addConfiguration(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;ZYR&quot;</span>); <span class="comment">// 只是给人看这个namespace的描述，实际上和注释差不多</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// 2.3 构造添加好参数的对象，完成创建</span></span><br><span class="line">       <span class="comment">// 创建命名空间出现的问题 都属于本方法自身的问题 不应该抛出异常</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           admin.createNamespace(builder.build()); <span class="comment">// 建造NamespaceDescriptor对象</span></span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;命名空间已经存在&quot;</span>); <span class="comment">// 正式开发中应该打印日志</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 3. 关闭Admin</span></span><br><span class="line">       admin.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>在类中的main函数中写测试代码即可，记得关闭HBase连接：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 测试创建命名空间</span></span><br><span class="line">    createNamespace(<span class="string">&quot;studyHBase&quot;</span>); <span class="comment">// 创建一个名叫 studyHBase 的名称空间，具体结果去命令行验证</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭HBase的连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="判断表格是否存在"><a href="#判断表格是否存在" class="headerlink" title="判断表格是否存在"></a>判断表格是否存在</h2><p>其中重点是表格的表达，是利用<code>TableName</code>对象，但是不能直接new，要用：<code>TableName.valueOf(namespace, tableName)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断表格是否存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 命令空间名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true表示存在，false表示不存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isTableExists</span><span class="params">(String namespace, String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1 获取admin</span></span><br><span class="line">    <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 使用方法判断表格表格是否存在</span></span><br><span class="line">    <span class="comment">// admin.tableExists() 的参数是 TableName 对象，不要直接创建TableName对象，因为底层是私有的</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        exists = admin.tableExists(TableName.valueOf(namespace, tableName));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 关闭admin</span></span><br><span class="line">    admin.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4 返回结果</span></span><br><span class="line">    <span class="keyword">return</span> exists;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 测试表格是否存在</span></span><br><span class="line">       <span class="comment">// 这个是通过HBase Shell事先创建好的，本身存在的表,应该输出true</span></span><br><span class="line">       System.out.println(isTableExists(<span class="string">&quot;bigdata&quot;</span>,<span class="string">&quot;student&quot;</span>)); </span><br><span class="line"></span><br><span class="line">       <span class="comment">// 关闭HBase的连接</span></span><br><span class="line">       HBaseConnection2.closeConnection();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="创建表格"><a href="#创建表格" class="headerlink" title="创建表格"></a>创建表格</h2><p>通过HBase Shell中的<code>help &quot;create&quot;</code>命令，查看帮助：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Create a table with namespace=ns1 and table qualifier=t1</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;ns1:t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, VERSIONS =&gt; <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">Create a table with namespace=<span class="keyword">default</span> and table qualifier=t1</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>&#125;, &#123;NAME =&gt; <span class="string">&#x27;f2&#x27;</span>&#125;, &#123;NAME =&gt; <span class="string">&#x27;f3&#x27;</span>&#125;</span><br><span class="line">  hbase&gt; # The above in shorthand would be the following:</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;f2&#x27;</span>, <span class="string">&#x27;f3&#x27;</span></span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, VERSIONS =&gt; <span class="number">1</span>, TTL =&gt; <span class="number">2592000</span>, BLOCKCACHE =&gt; <span class="literal">true</span>&#125;</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, CONFIGURATION =&gt; &#123;<span class="string">&#x27;hbase.hstore.blockingStoreFiles&#x27;</span> =&gt; <span class="string">&#x27;10&#x27;</span>&#125;&#125;</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, IS_MOB =&gt; <span class="literal">true</span>, MOB_THRESHOLD =&gt; <span class="number">1000000</span>, MOB_COMPACT_PARTITION_POLICY =&gt; <span class="string">&#x27;weekly&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">Table configuration options can be put at the end.</span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">  hbase&gt; create <span class="string">&#x27;ns1:t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, SPLITS =&gt; [<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;40&#x27;</span>]</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, SPLITS =&gt; [<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;40&#x27;</span>]</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, SPLITS_FILE =&gt; <span class="string">&#x27;splits.txt&#x27;</span>, OWNER =&gt; <span class="string">&#x27;johndoe&#x27;</span></span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, VERSIONS =&gt; <span class="number">5</span>&#125;, METADATA =&gt; &#123; <span class="string">&#x27;mykey&#x27;</span> =&gt; <span class="string">&#x27;myvalue&#x27;</span> &#125;</span><br><span class="line">  hbase&gt; # Optionally pre-split the table into NUMREGIONS, using</span><br><span class="line">  hbase&gt; # SPLITALGO (<span class="string">&quot;HexStringSplit&quot;</span>, <span class="string">&quot;UniformSplit&quot;</span> or classname)</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, &#123;NUMREGIONS =&gt; <span class="number">15</span>, SPLITALGO =&gt; <span class="string">&#x27;HexStringSplit&#x27;</span>&#125;</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, &#123;NUMREGIONS =&gt; <span class="number">15</span>, SPLITALGO =&gt; <span class="string">&#x27;HexStringSplit&#x27;</span>, REGION_REPLICATION =&gt; <span class="number">2</span>, CONFIGURATION =&gt; &#123;<span class="string">&#x27;hbase.hregion.scan.loadColumnFamiliesOnDemand&#x27;</span> =&gt; <span class="string">&#x27;true&#x27;</span>&#125;&#125;</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, &#123;SPLIT_ENABLED =&gt; <span class="literal">false</span>, MERGE_ENABLED =&gt; <span class="literal">false</span>&#125;</span><br><span class="line">  hbase&gt; create <span class="string">&#x27;t1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, DFS_REPLICATION =&gt; <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">You can also keep around a reference to the created table:</span><br><span class="line"></span><br><span class="line">  hbase&gt; t1 = create <span class="string">&#x27;t1&#x27;</span>, <span class="string">&#x27;f1&#x27;</span></span><br><span class="line"></span><br><span class="line">Which gives you a reference to the table named <span class="string">&#x27;t1&#x27;</span>, on which you can then</span><br><span class="line">call methods.</span><br></pre></td></tr></table></figure><p>基本的信息是：命名空间名称，表格名称，列族的名称。其他信息是拓展。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建表格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamilies 列族名称，因为可能会有多个列族，所以用变成数组作为参数类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createTable</span><span class="params">(String namespace, String tableName, String... columnFamilies)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取Admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 使用admin的方法创建表格</span></span><br><span class="line">        <span class="comment">// 方法参数是TableDescriptor，和创建连接时的配置对象类似，不能直接new</span></span><br><span class="line">        <span class="comment">// 2.1 创建表格描述类，该类的参数是TableName类，这个类在上面判断表格是否存在时已经创建过了</span></span><br><span class="line">        <span class="type">TableDescriptorBuilder</span> <span class="variable">tableDescriptorBuilder</span> <span class="operator">=</span> TableDescriptorBuilder.newBuilder(TableName.valueOf(namespace, tableName));</span><br><span class="line">        <span class="comment">// 2.2 添加参数，描述信息</span></span><br><span class="line">        <span class="comment">// 可以直接用tableDescriptorBuilder.setColumnFamilies()方法，参数是Collection&lt;ColumnFamilyDescriptor&gt;类型的对象，用起来很复杂</span></span><br><span class="line"><span class="comment">//        tableDescriptorBuilder.setColumnFamilies();</span></span><br><span class="line">        <span class="comment">// 推荐使用 tableDescriptorBuilder.setColumnFamily() 方法一个一个添加设置，参数是ColumnFamilyDescriptor类型的对象</span></span><br><span class="line">        <span class="keyword">for</span> (String columnFamily : columnFamilies) &#123;</span><br><span class="line">            <span class="comment">// 2.2.1 创建构造者,列族描述的建造者</span></span><br><span class="line">            <span class="comment">// 参数是byte[]，这是字符数组。一般是不能直接加String类型的，这里使用HBase工具包中的Bytes.toBytes()方法，注意是HBase的util表，不要错误导包</span></span><br><span class="line">            <span class="type">ColumnFamilyDescriptorBuilder</span> <span class="variable">columnFamilyDescriptorBuilder</span> <span class="operator">=</span> ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(columnFamily));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.2 给对应的列族描述建造者添加描述信息</span></span><br><span class="line">            <span class="comment">// 添加版本参数</span></span><br><span class="line">            columnFamilyDescriptorBuilder.setMaxVersions(<span class="number">5</span>);<span class="comment">// 最多保存5个版本</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.3 bulider建造描述，并设置列族</span></span><br><span class="line">            tableDescriptorBuilder.setColumnFamily(columnFamilyDescriptorBuilder.build());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 创建表格</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            admin.createTable(tableDescriptorBuilder.build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;表格已经存在了&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 关闭admin</span></span><br><span class="line">        admin.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试创建表格</span></span><br><span class="line">    createTable(<span class="string">&quot;studyHBase&quot;</span>,<span class="string">&quot;student&quot;</span>,<span class="string">&quot;info&quot;</span>,<span class="string">&quot;msg&quot;</span>); <span class="comment">// 在新创建的命名空间中添加表格</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭HBase的连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过前后两次在HBase Shell中执行的<code>list</code>命令，可以验证创建表格成功：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hbase:<span class="number">006</span>:<span class="number">0</span>&gt; list</span><br><span class="line">TABLE</span><br><span class="line">bigdata:student</span><br><span class="line"><span class="number">1</span> row(s)</span><br><span class="line">Took <span class="number">0.0343</span> seconds</span><br><span class="line">=&gt; [<span class="string">&quot;bigdata:student&quot;</span>]</span><br><span class="line">hbase:<span class="number">007</span>:<span class="number">0</span>&gt; list</span><br><span class="line">TABLE</span><br><span class="line">bigdata:student</span><br><span class="line">studyHBase:student</span><br><span class="line"><span class="number">2</span> row(s)</span><br><span class="line">Took <span class="number">0.0309</span> seconds</span><br><span class="line">=&gt; [<span class="string">&quot;bigdata:student&quot;</span>, <span class="string">&quot;studyHBase:student&quot;</span>]</span><br></pre></td></tr></table></figure><p>通过HBase Shell中的<code>describe &quot;studyHBase:student&quot;</code>可以查看描述信息。我们设置的两个列族，分别叫info和msg，version都设置为5：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hbase:008:<span class="number">0</span>&gt; describe <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">Table studyHBase:student is ENABLED</span><br><span class="line">studyHBase:student</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;info&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, <span class="type">DATA_BLOCK_</span></span><br><span class="line"><span class="variable">ENCODING</span> <span class="operator">=</span>&gt; <span class="string">&#x27;NONE&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;65</span></span><br><span class="line"><span class="string">536&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;msg&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, <span class="type">DATA_BLOCK_E</span></span><br><span class="line"><span class="variable">NCODING</span> <span class="operator">=</span>&gt; <span class="string">&#x27;NONE&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;655</span></span><br><span class="line"><span class="string">36&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> row(s)</span><br></pre></td></tr></table></figure><h3 id="表格创建的问题"><a href="#表格创建的问题" class="headerlink" title="表格创建的问题"></a>表格创建的问题</h3><ul><li><p>表格已经存在会报错</p><p>  事先判断表格是否存在</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0.2 判断 表格 是否存在</span></span><br><span class="line"><span class="keyword">if</span> (isTableExists(namespace, tableName)) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;表格已经存在了&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>列族是变长数组类型，即可能没有参数。但是一个表格至少需要一个列族，所以也会报错。</p><p>  事先判断是否至少有一个列族</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0.1 判断 columnFamilies 是否为空</span></span><br><span class="line"><span class="keyword">if</span> (columnFamilies.length == <span class="number">0</span>) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;创建表格至少需要一个列族&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>最终代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建表格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamilies 列族名称，因为可能会有多个列族，所以用变成数组作为参数类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createTable</span><span class="params">(String namespace, String tableName, String... columnFamilies)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 0 判断是否可以创建</span></span><br><span class="line">        <span class="comment">// 0.1 判断 columnFamilies 是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (columnFamilies.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;创建表格至少需要一个列族&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 0.2 判断 表格 是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (isTableExists(namespace, tableName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;表格已经存在了&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 获取Admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 使用admin的方法创建表格</span></span><br><span class="line">        <span class="comment">// 方法参数是TableDescriptor，和创建连接时的配置对象类似，不能直接new</span></span><br><span class="line">        <span class="comment">// 2.1 创建表格描述类，该类的参数是TableName类，这个类在上面判断表格是否存在时已经创建过了</span></span><br><span class="line">        <span class="type">TableDescriptorBuilder</span> <span class="variable">tableDescriptorBuilder</span> <span class="operator">=</span> TableDescriptorBuilder.newBuilder(TableName.valueOf(namespace, tableName));</span><br><span class="line">        <span class="comment">// 2.2 添加参数，描述信息</span></span><br><span class="line">        <span class="comment">// 可以直接用tableDescriptorBuilder.setColumnFamilies()方法，参数是Collection&lt;ColumnFamilyDescriptor&gt;类型的对象，用起来很复杂</span></span><br><span class="line"><span class="comment">//        tableDescriptorBuilder.setColumnFamilies();</span></span><br><span class="line">        <span class="comment">// 推荐使用 tableDescriptorBuilder.setColumnFamily() 方法一个一个添加设置，参数是ColumnFamilyDescriptor类型的对象</span></span><br><span class="line">        <span class="keyword">for</span> (String columnFamily : columnFamilies) &#123;</span><br><span class="line">            <span class="comment">// 2.2.1 创建构造者,列族描述的建造者</span></span><br><span class="line">            <span class="comment">// 参数是byte[]，这是字符数组。一般是不能直接加String类型的，这里使用HBase工具包中的Bytes.toBytes()方法，注意是HBase的util表，不要错误导包</span></span><br><span class="line">            <span class="type">ColumnFamilyDescriptorBuilder</span> <span class="variable">columnFamilyDescriptorBuilder</span> <span class="operator">=</span> ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(columnFamily));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.2 给对应的列族描述建造者添加描述信息</span></span><br><span class="line">            <span class="comment">// 添加版本参数</span></span><br><span class="line">            columnFamilyDescriptorBuilder.setMaxVersions(<span class="number">5</span>);<span class="comment">// 最多保存5个版本</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.3 bulider建造描述，并设置列族</span></span><br><span class="line">            tableDescriptorBuilder.setColumnFamily(columnFamilyDescriptorBuilder.build());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 创建表格</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            admin.createTable(tableDescriptorBuilder.build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 关闭admin</span></span><br><span class="line">        admin.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h2><blockquote><p>重点是创建一个表格建造者是一个新的，这样修改会报错：无法找到该列族。</p><p>修改表时应该利用admin获取旧的表格描述，然后获取旧的列族描述。之后再对列族描述建造者添加对应列族描述完成修改。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 修改表格中一个列族的版本号</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> version 版本号</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">modifyTable</span><span class="params">(String namespace, String tableName, String columnFamily, <span class="type">int</span> version)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// 0 提前判断，避免异常</span></span><br><span class="line">       <span class="comment">// 0.1 判断表格是否存在</span></span><br><span class="line">       <span class="keyword">if</span> (!isTableExists(namespace, tableName)) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;表格不存在&quot;</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 1 获取Admin</span></span><br><span class="line">       <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// 2 修改表格信息</span></span><br><span class="line">           <span class="comment">// 使用 admin.modifyTable() 方法，参数是TableDescriptor对象</span></span><br><span class="line">           <span class="comment">// 2.0 获取旧的表格描述，即getDescriptor()</span></span><br><span class="line">           <span class="type">TableDescriptor</span> <span class="variable">descriptor</span> <span class="operator">=</span> admin.getDescriptor(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 2.1 创建TableDescriptor的建造者</span></span><br><span class="line">           <span class="comment">// 如果使用的方法填写了TableName.valueOf()，则相当于创建了一个新的表格创建者，没有之前的信息</span></span><br><span class="line">           <span class="comment">// 如果想要修改之前的信息，必须调用方法填写一个旧的表格描述，即2.0的作用</span></span><br><span class="line">           <span class="comment">// TableDescriptorBuilder tableDescriptorBuilder = TableDescriptorBuilder.newBuilder(TableName.valueOf(namespace, tableName));</span></span><br><span class="line">           <span class="comment">// 利用得到的旧的表格描述作为参数</span></span><br><span class="line">           <span class="type">TableDescriptorBuilder</span> <span class="variable">tableDescriptorBuilder</span> <span class="operator">=</span> TableDescriptorBuilder.newBuilder(descriptor);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 2.2 对建造者管理的信息进行修改</span></span><br><span class="line">           <span class="comment">// 使用 tableDescriptorBuilder.modifyColumnFamily(),参数是 ColumnFamilyDescriptor 对象</span></span><br><span class="line">           <span class="comment">// 2.2.1 创建 ColumnFamilyDescriptor 对象</span></span><br><span class="line">           <span class="comment">// ColumnFamilyDescriptorBuilder columnFamilyDescriptorBuilder = ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(columnFamily));</span></span><br><span class="line">           <span class="comment">// 需要填写旧的列族描述</span></span><br><span class="line">           <span class="comment">// 2.2.1.1 获取旧的表格描述</span></span><br><span class="line">           <span class="type">ColumnFamilyDescriptor</span> <span class="variable">columnFamily1</span> <span class="operator">=</span> descriptor.getColumnFamily(Bytes.toBytes(columnFamily));</span><br><span class="line">           <span class="comment">// 2.2.1.2 创建建造者</span></span><br><span class="line">           <span class="type">ColumnFamilyDescriptorBuilder</span> <span class="variable">columnFamilyDescriptorBuilder</span> <span class="operator">=</span> ColumnFamilyDescriptorBuilder.newBuilder(columnFamily1);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 2.2.2 修改版本号</span></span><br><span class="line">           columnFamilyDescriptorBuilder.setMaxVersions(version);</span><br><span class="line">           <span class="comment">// 2.2.3 列族建造者建造</span></span><br><span class="line">           tableDescriptorBuilder.modifyColumnFamily(columnFamilyDescriptorBuilder.build());</span><br><span class="line">           <span class="comment">// 3 修改表格</span></span><br><span class="line">           admin.modifyTable(tableDescriptorBuilder.build());</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 4 关闭 admin</span></span><br><span class="line">       admin.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试修改表格版本号</span></span><br><span class="line">    modifyTable(<span class="string">&quot;studyHBase&quot;</span>,<span class="string">&quot;student&quot;</span>,<span class="string">&quot;info&quot;</span>, <span class="number">10</span>); <span class="comment">// 把studyHBase:student info列族 的版本改成10（原本是5）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭HBase的连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>去HBase Shell中检查：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">hbase:008:<span class="number">0</span>&gt; describe <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">Table studyHBase:student is ENABLED</span><br><span class="line">studyHBase:student</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;info&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, <span class="type">DATA_BLOCK_</span></span><br><span class="line"><span class="variable">ENCODING</span> <span class="operator">=</span>&gt; <span class="string">&#x27;NONE&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;65</span></span><br><span class="line"><span class="string">536&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;msg&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, <span class="type">DATA_BLOCK_E</span></span><br><span class="line"><span class="variable">NCODING</span> <span class="operator">=</span>&gt; <span class="string">&#x27;NONE&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;655</span></span><br><span class="line"><span class="string">36&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> row(s)</span><br><span class="line">Quota is disabled</span><br><span class="line">Took <span class="number">0.1055</span> seconds</span><br><span class="line">hbase:009:<span class="number">0</span>&gt; describe <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">Table studyHBase:student is ENABLED</span><br><span class="line">studyHBase:student</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;info&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;10&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, <span class="type">DATA_BLOCK</span></span><br><span class="line"><span class="variable">_ENCODING</span> <span class="operator">=</span>&gt; <span class="string">&#x27;NONE&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;6</span></span><br><span class="line"><span class="string">5536&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;msg&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, <span class="type">DATA_BLOCK_E</span></span><br><span class="line"><span class="variable">NCODING</span> <span class="operator">=</span>&gt; <span class="string">&#x27;NONE&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;655</span></span><br><span class="line"><span class="string">36&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> row(s)</span><br><span class="line">Quota is disabled</span><br><span class="line">Took <span class="number">0.0701</span> seconds</span><br></pre></td></tr></table></figure><p>可以通过两次查询看出来info列族的VERSIONS确实从5变成了10。</p><h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除表格</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 删除成功放回true，删除失败返回false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">deleteTable</span><span class="params">(String namespace, String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1. 判断表格是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (!isTableExists(namespace, tableName)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;表格不存在，无法删除&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 获取admin</span></span><br><span class="line">    <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 调用admin.deleteTable()删除表格</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 注意 HBase 删除表格之前一定要标记表格不可用</span></span><br><span class="line">        <span class="type">TableName</span> <span class="variable">tableName1</span> <span class="operator">=</span> TableName.valueOf(namespace, tableName);</span><br><span class="line">        admin.disableTable(tableName1);</span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        admin.deleteTable(tableName1);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 关闭admin</span></span><br><span class="line">    admin.close();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试删除表格</span></span><br><span class="line">    deleteTable(<span class="string">&quot;studyHBase&quot;</span>,<span class="string">&quot;student&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭HBase的连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="操作DDL的完整代码"><a href="#操作DDL的完整代码" class="headerlink" title="操作DDL的完整代码"></a>操作DDL的完整代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.B_TestDDL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhang.A_TestConnection.HBaseConnection2;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.NamespaceDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yonruizhang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/3/20 15:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 测试DDL的相关操作 （获取Admin —— Admin管理DDL；Table是用来管理DML的）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HBaseDDL1</span> &#123;</span><br><span class="line">    <span class="comment">// 直接使用前面的连接类即可</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> HBaseConnection2.connection;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个namespace</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace namespace的名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createNamespace</span><span class="params">(String namespace)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取Admin</span></span><br><span class="line">        <span class="comment">// admin 的连接是轻量级的 不是线程安全的 不推荐池化或者缓存这个连接</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 调用方法创建命名空间</span></span><br><span class="line">        <span class="comment">// 代码相对shell更加底，保证shell能完成的功能代码也能完成，所以参数是 NamespaceDescriptor 对象，需要填写完整的命名空间描述</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.1 创建 NamespaceDescriptor 的 builder 对象（相当于是建造师）</span></span><br><span class="line">        NamespaceDescriptor.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> NamespaceDescriptor.create(namespace);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2 给命名空间添加需求（描述信息）</span></span><br><span class="line">        builder.addConfiguration(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;ZYR&quot;</span>); <span class="comment">// 只是给人看这个namespace的描述，实际上没有什么描述，和注释差不多</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3 构造添加好参数的对象，完成创建</span></span><br><span class="line">        <span class="comment">// 创建命名空间出现的问题 都属于本方法自身的问题 不应该抛出异常</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            admin.createNamespace(builder.build()); <span class="comment">// 建造NamespaceDescriptor对象</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;命名空间已经存在&quot;</span>); <span class="comment">// 正式开发中应该打印日志</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 关闭Admin</span></span><br><span class="line">        admin.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断表格是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命令空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true表示存在，false表示不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isTableExists</span><span class="params">(String namespace, String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 使用方法判断表格表格是否存在</span></span><br><span class="line">        <span class="comment">// admin.tableExists() 的参数是 TableName 对象，不要直接创建TableName对象，因为底层是私有的，去看底层文档</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            exists = admin.tableExists(TableName.valueOf(namespace, tableName));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 关闭admin</span></span><br><span class="line">        admin.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 返回结果</span></span><br><span class="line">        <span class="keyword">return</span> exists;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建表格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamilies 列族名称，因为可能会有多个列族，所以用变成数组作为参数类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createTable</span><span class="params">(String namespace, String tableName, String... columnFamilies)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 0 判断是否可以创建</span></span><br><span class="line">        <span class="comment">// 0.1 判断 columnFamilies 是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (columnFamilies.length == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;创建表格至少需要一个列族&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 0.2 判断 表格 是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (isTableExists(namespace, tableName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;表格已经存在了&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 获取Admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 使用admin的方法创建表格</span></span><br><span class="line">        <span class="comment">// 方法参数是TableDescriptor，和创建连接时的配置对象类似，不能直接new</span></span><br><span class="line">        <span class="comment">// 2.1 创建表格描述类，该类的参数是TableName类，这个类在上面判断表格是否存在时已经创建过了</span></span><br><span class="line">        <span class="type">TableDescriptorBuilder</span> <span class="variable">tableDescriptorBuilder</span> <span class="operator">=</span> TableDescriptorBuilder.newBuilder(TableName.valueOf(namespace, tableName));</span><br><span class="line">        <span class="comment">// 2.2 添加参数，描述信息</span></span><br><span class="line">        <span class="comment">// 可以直接用tableDescriptorBuilder.setColumnFamilies()方法，参数是Collection&lt;ColumnFamilyDescriptor&gt;类型的对象，用起来很复杂</span></span><br><span class="line"><span class="comment">//        tableDescriptorBuilder.setColumnFamilies();</span></span><br><span class="line">        <span class="comment">// 推荐使用 tableDescriptorBuilder.setColumnFamily() 方法一个一个添加设置，参数是ColumnFamilyDescriptor类型的对象</span></span><br><span class="line">        <span class="keyword">for</span> (String columnFamily : columnFamilies) &#123;</span><br><span class="line">            <span class="comment">// 2.2.1 创建构造者,列族描述的建造者</span></span><br><span class="line">            <span class="comment">// 参数是byte[]，这是字符数组。一般是不能直接加String类型的，这里使用HBase工具包中的Bytes.toBytes()方法，注意是HBase的util表，不要错误导包</span></span><br><span class="line">            <span class="type">ColumnFamilyDescriptorBuilder</span> <span class="variable">columnFamilyDescriptorBuilder</span> <span class="operator">=</span> ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(columnFamily));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.2 给对应的列族描述建造者添加描述信息</span></span><br><span class="line">            <span class="comment">// 添加版本参数</span></span><br><span class="line">            columnFamilyDescriptorBuilder.setMaxVersions(<span class="number">5</span>);<span class="comment">// 最多保存5个版本</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.3 bulider 建造描述，并设置列族</span></span><br><span class="line">            tableDescriptorBuilder.setColumnFamily(columnFamilyDescriptorBuilder.build());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 创建表格</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            admin.createTable(tableDescriptorBuilder.build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 关闭admin</span></span><br><span class="line">        admin.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改表格中一个列族的版本号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> version 版本号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">modifyTable</span><span class="params">(String namespace, String tableName, String columnFamily, <span class="type">int</span> version)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 0 提前判断，避免异常</span></span><br><span class="line">        <span class="comment">// 0.1 判断表格是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!isTableExists(namespace, tableName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;表格不存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 获取Admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2 修改表格信息</span></span><br><span class="line">            <span class="comment">// 使用 admin.modifyTable() 方法，参数是TableDescriptor对象</span></span><br><span class="line">            <span class="comment">// 2.0 获取旧的表格描述，即getDescriptor()</span></span><br><span class="line">            <span class="type">TableDescriptor</span> <span class="variable">descriptor</span> <span class="operator">=</span> admin.getDescriptor(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.1 创建TableDescriptor的建造者</span></span><br><span class="line">            <span class="comment">// 如果使用的方法填写了TableName.valueOf()，则相当于创建了一个新的表格创建者，没有之前的信息</span></span><br><span class="line">            <span class="comment">// 如果想要修改之前的信息，必须调用方法填写一个旧的表格描述，即2.0的作用</span></span><br><span class="line">            <span class="comment">// TableDescriptorBuilder tableDescriptorBuilder = TableDescriptorBuilder.newBuilder(TableName.valueOf(namespace, tableName));</span></span><br><span class="line">            <span class="comment">// 利用得到的旧的表格描述作为参数</span></span><br><span class="line">            <span class="type">TableDescriptorBuilder</span> <span class="variable">tableDescriptorBuilder</span> <span class="operator">=</span> TableDescriptorBuilder.newBuilder(descriptor);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2 对建造者管理的信息进行修改</span></span><br><span class="line">            <span class="comment">// 使用 tableDescriptorBuilder.modifyColumnFamily(),参数是 ColumnFamilyDescriptor 对象</span></span><br><span class="line">            <span class="comment">// 2.2.1 创建 ColumnFamilyDescriptor 对象</span></span><br><span class="line">            <span class="comment">// ColumnFamilyDescriptorBuilder columnFamilyDescriptorBuilder = ColumnFamilyDescriptorBuilder.newBuilder(Bytes.toBytes(columnFamily));</span></span><br><span class="line">            <span class="comment">// 需要填写旧的列族描述</span></span><br><span class="line">            <span class="comment">// 2.2.1.1 获取旧的表格描述</span></span><br><span class="line">            <span class="type">ColumnFamilyDescriptor</span> <span class="variable">columnFamily1</span> <span class="operator">=</span> descriptor.getColumnFamily(Bytes.toBytes(columnFamily));</span><br><span class="line">            <span class="comment">// 2.2.1.2 创建建造者</span></span><br><span class="line">            <span class="type">ColumnFamilyDescriptorBuilder</span> <span class="variable">columnFamilyDescriptorBuilder</span> <span class="operator">=</span> ColumnFamilyDescriptorBuilder.newBuilder(columnFamily1);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.2.2 修改版本号</span></span><br><span class="line">            columnFamilyDescriptorBuilder.setMaxVersions(version);</span><br><span class="line">            <span class="comment">// 2.2.3 列族建造者建造</span></span><br><span class="line">            tableDescriptorBuilder.modifyColumnFamily(columnFamilyDescriptorBuilder.build());</span><br><span class="line">            <span class="comment">// 3 修改表格</span></span><br><span class="line">            admin.modifyTable(tableDescriptorBuilder.build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 关闭 admin</span></span><br><span class="line">        admin.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除表格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除成功放回true，删除失败返回false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">deleteTable</span><span class="params">(String namespace, String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 判断表格是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!isTableExists(namespace, tableName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;表格不存在，无法删除&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 获取admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 调用admin.deleteTable()删除表格</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 注意 HBase 删除表格之前一定要标记表格不可用</span></span><br><span class="line">            <span class="type">TableName</span> <span class="variable">tableName1</span> <span class="operator">=</span> TableName.valueOf(namespace, tableName);</span><br><span class="line">            admin.disableTable(tableName1);</span><br><span class="line">            <span class="comment">// 删除</span></span><br><span class="line">            admin.deleteTable(tableName1);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 关闭admin</span></span><br><span class="line">        admin.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 测试创建命名空间</span></span><br><span class="line">        <span class="comment">// createNamespace(&quot;studyHBase&quot;); // 创建一个名叫 studyHBase 的名称空间，具体结果去命令行验证</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试表格是否存在</span></span><br><span class="line">        <span class="comment">// System.out.println(isTableExists(&quot;bigdata&quot;,&quot;student&quot;)); // 这个是通过HBase Shell事先创建好的，本身存在的表</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试创建表格</span></span><br><span class="line">        <span class="comment">// createTable(&quot;studyHBase&quot;,&quot;student&quot;,&quot;info&quot;,&quot;msg&quot;); // 在新创建的命名空间中添加表格</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试修改表格版本号</span></span><br><span class="line">        <span class="comment">// modifyTable(&quot;studyHBase&quot;,&quot;student&quot;,&quot;info&quot;, 10); // 把studyHBase:student info列族 的版本改成10（原本是5）</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试删除表格</span></span><br><span class="line">        deleteTable(<span class="string">&quot;studyHBase&quot;</span>,<span class="string">&quot;student&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭HBase的连接</span></span><br><span class="line">        HBaseConnection2.closeConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><p>DML的相关操作是利用connection获取Table执行的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br></pre></td></tr></table></figure><h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 插入数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rowKey 主键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columnFamily 列族名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> column 列名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 插入的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">putCell</span><span class="params">(String namespace, String tableName, String rowKey, String columnFamily, String column, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 0 判断表格是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (!HBaseDDL1.isTableExists(namespace, tableName)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;表格不存在&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 获取table</span></span><br><span class="line">    <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 调用相关方法插入数据</span></span><br><span class="line">    <span class="comment">// 使用 table.put() 方法，参数是Put对象</span></span><br><span class="line">    <span class="comment">// 2.1 创建Put对象</span></span><br><span class="line">    <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(rowKey));</span><br><span class="line">    <span class="comment">// 2.2 向Put对象添加数据</span></span><br><span class="line">    put.addColumn(Bytes.toBytes(columnFamily),Bytes.toBytes(column),Bytes.toBytes(value));</span><br><span class="line">    <span class="comment">// 2.3 将对象写入方法</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        table.put(put);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭table</span></span><br><span class="line">    table.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 测试添加数据</span></span><br><span class="line">    putCell(<span class="string">&quot;studyHBase&quot;</span>,<span class="string">&quot;student&quot;</span>,<span class="string">&quot;2001&quot;</span>,<span class="string">&quot;info&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hbase:<span class="number">001</span>:<span class="number">0</span>&gt; scan <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">ROW                             COLUMN+CELL</span><br><span class="line"><span class="number">0</span> row(s)</span><br><span class="line">Took <span class="number">0.2841</span> seconds</span><br><span class="line">hbase:<span class="number">002</span>:<span class="number">0</span>&gt; scan <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">ROW                             COLUMN+CELL</span><br><span class="line"> <span class="number">2001</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-24T08:<span class="number">21</span>:<span class="number">22.454</span>, value=zhangsan</span><br><span class="line"><span class="number">1</span> row(s)</span><br><span class="line">Took <span class="number">0.0464</span> seconds</span><br></pre></td></tr></table></figure><blockquote><p>为了后续读取数据时的操作演示效果更加明显，可以再自行添加一些数据。</p></blockquote><h2 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 详细读取表格中的某一列数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rowKey 主键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columnFamily 列族</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> column 列名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getCells</span><span class="params">(String namespace, String tableName, String rowKey, String columnFamily, String column)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1 获取table对象</span></span><br><span class="line">    <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 创建 get 对象</span></span><br><span class="line">    <span class="type">Get</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Get</span>(Bytes.toBytes(rowKey)); <span class="comment">// 如果不再做设置，直接读数据，此时读一整行数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取某一列数据，需要添加对应参数</span></span><br><span class="line">    get.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(column));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 还可以设置读取数据的版本,默认有读全部版本的方法</span></span><br><span class="line">    get.readAllVersions();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 3 设置完成就调用 table.get() 方法得到result对象</span></span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> table.get(get);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 处理数据</span></span><br><span class="line">        Cell[] cells = result.rawCells();</span><br><span class="line">        <span class="comment">// 如果是实际开发就应该放回result，这里简单演示</span></span><br><span class="line">        <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">            <span class="comment">// cell 存储数据比较底层</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell));</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5 关闭 table</span></span><br><span class="line">    table.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试读取数据</span></span><br><span class="line">    getCells(<span class="string">&quot;studyHBase&quot;</span>,<span class="string">&quot;student&quot;</span>,<span class="string">&quot;2001&quot;</span>,<span class="string">&quot;info&quot;</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="扫描数据"><a href="#扫描数据" class="headerlink" title="扫描数据"></a>扫描数据</h2><p>读取数据的效率太低，一般只能看一行的消息，但实际开发中可能会需要数十亿行的数据，所以不能简单读取数据。要实现同时读数十亿行数据就要使用扫描数据的API。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扫描数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 命名空间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startRow 开始的行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> stopRow 结束的行</span></span><br><span class="line"><span class="comment"> *                HBase Shell中默认：[ startRow , stopRow )</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">scanRaws</span><span class="params">(String namespace, String tableName, String startRow, String stopRow)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1 获取table</span></span><br><span class="line">    <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 创建 Scan 对象</span></span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>(); <span class="comment">// 如果此时什么都不填，这是扫描整张表</span></span><br><span class="line">    <span class="comment">// 实际开发中很少扫描整张表，所以要设置参数规定其实行和终止行</span></span><br><span class="line">    <span class="comment">// 函数原型：this.withStartRow(startRow, true); 第一个参数是其实行，第二个参数表示默认要包含改行，可以给定参数指定</span></span><br><span class="line">    scan.withStartRow(Bytes.toBytes(startRow));</span><br><span class="line">    <span class="comment">// 默认是不包含终止行，可自己给定第二个参数为 true 则可包含</span></span><br><span class="line">    scan.withStopRow(Bytes.toBytes(stopRow));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 读取多行数据获取 scanner</span></span><br><span class="line">        <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Result 是记录一行数据           本质是：Cell    数组</span></span><br><span class="line">        <span class="comment">// ResultScanner 是记录多行数据    本质是：Result  数组</span></span><br><span class="line">        <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">            Cell[] cells = result.rawCells();</span><br><span class="line">            <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneRow(cell)) + <span class="string">&quot;-&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneQualifier(cell)) + <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneFamily(cell))+ <span class="string">&#x27;-&#x27;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell)) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3 关闭table</span></span><br><span class="line">    table.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试扫描数据</span></span><br><span class="line">    scanRaws(<span class="string">&quot;studyHBase&quot;</span>, <span class="string">&quot;student&quot;</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;2003&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2001</span>-name-info-zhangsan</span><br><span class="line"><span class="number">2002</span>-name-info-lisi</span><br></pre></td></tr></table></figure><p>因为这里是默认不包含终止行，所以只有两条数据。</p><p>实际扫描全表内容：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase:<span class="number">003</span>:<span class="number">0</span>&gt; scan <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">ROW                             COLUMN+CELL</span><br><span class="line"> <span class="number">2001</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-24T08:<span class="number">21</span>:<span class="number">22.454</span>, value=zhangsan</span><br><span class="line"> <span class="number">2002</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">07</span>:<span class="number">01.510</span>, value=lisi</span><br><span class="line"> <span class="number">2003</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">07</span>:<span class="number">01.521</span>, value=wangwu</span><br><span class="line"><span class="number">3</span> row(s)</span><br><span class="line">Took <span class="number">0.0390</span> seconds</span><br></pre></td></tr></table></figure><h2 id="带过滤器的扫描"><a href="#带过滤器的扫描" class="headerlink" title="带过滤器的扫描"></a>带过滤器的扫描</h2><blockquote><p>过滤器有两种：</p><p>单列过滤、整行过滤</p></blockquote><p>也就是添加条件，得到满足一定条件的结果。</p><p>但是注意，由于HBase的性质，是允许有缺失数据的，所以有些数据不一定能过滤掉。</p><p>举个例子：</p><p>假设按照info列族下的name列进行过滤匹配，但是有一行数据只有其他属性，name列没有数据，则会跳过匹配这一行的数据。</p><p>对于单列过滤来说无法察觉，但是对于整行过滤就可以看到效果。例如输出一行内容，但是这一行内容中并没有对应的过滤列的值。</p><h3 id="带单列过滤的扫描"><a href="#带单列过滤的扫描" class="headerlink" title="带单列过滤的扫描"></a>带单列过滤的扫描</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 带过滤的扫描数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 命名空间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表格名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startRow 开始行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> stopRow 结束行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 查询值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">filterScanRows</span><span class="params">(String namespace, String tableName, String startRow, String stopRow, String columnFamily, String columnName, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1 获取table</span></span><br><span class="line">    <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 创建 Scan 对象</span></span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.withStartRow(Bytes.toBytes(startRow));</span><br><span class="line">    scan.withStopRow(Bytes.toBytes(stopRow));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加过滤器的列表 （过滤器的集合）</span></span><br><span class="line">    <span class="type">FilterList</span> <span class="variable">filterList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterList</span>();</span><br><span class="line">    <span class="comment">// 创建过滤器</span></span><br><span class="line">    <span class="comment">// （1）结果只保留当前列的数据</span></span><br><span class="line">    <span class="type">ColumnValueFilter</span> <span class="variable">columnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColumnValueFilter</span>(</span><br><span class="line">            <span class="comment">// 列族名称</span></span><br><span class="line">            Bytes.toBytes(columnFamily),</span><br><span class="line">            <span class="comment">// 列名</span></span><br><span class="line">            Bytes.toBytes(columnName),</span><br><span class="line">            <span class="comment">// 比较关系 是一个枚举类，可以根据实际情况是大于还是小于之类的关系</span></span><br><span class="line">            CompareOperator.EQUAL,</span><br><span class="line">            <span class="comment">// 比较的值</span></span><br><span class="line">            Bytes.toBytes(value)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 将过滤器添加到集合</span></span><br><span class="line">    filterList.addFilter(columnValueFilter);</span><br><span class="line">    scan.setFilter(filterList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">            Cell[] cells = result.rawCells();</span><br><span class="line">            <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneRow(cell)) + <span class="string">&quot;-&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneQualifier(cell)) + <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneFamily(cell))+ <span class="string">&#x27;-&#x27;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell)) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 关闭table</span></span><br><span class="line">    table.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 测试带过滤器的扫描 假设具体找到张三这一行的信息</span></span><br><span class="line">    filterScanRows(<span class="string">&quot;studyHBase&quot;</span>, <span class="string">&quot;student&quot;</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;2004&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2001-name-info-zhangsan</span><br></pre></td></tr></table></figure><p>这一个列族下其实还有其他属性。</p><h3 id="带整行过滤的扫描"><a href="#带整行过滤的扫描" class="headerlink" title="带整行过滤的扫描"></a>带整行过滤的扫描</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带过滤的扫描数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startRow 开始行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stopRow 结束行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 查询值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">filterScanRows</span><span class="params">(String namespace, String tableName, String startRow, String stopRow, String columnFamily, String columnName, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建 Scan 对象</span></span><br><span class="line">        <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">        scan.withStartRow(Bytes.toBytes(startRow));</span><br><span class="line">        scan.withStopRow(Bytes.toBytes(stopRow));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加过滤器的列表 （过滤器的集合）</span></span><br><span class="line">        <span class="type">FilterList</span> <span class="variable">filterList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterList</span>();</span><br><span class="line">        <span class="comment">// 创建过滤器</span></span><br><span class="line">        <span class="comment">// （1）结果只保留当前列的数据</span></span><br><span class="line">        <span class="type">ColumnValueFilter</span> <span class="variable">columnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColumnValueFilter</span>(</span><br><span class="line">                <span class="comment">// 列族名称</span></span><br><span class="line">                Bytes.toBytes(columnFamily),</span><br><span class="line">                <span class="comment">// 列名</span></span><br><span class="line">                Bytes.toBytes(columnName),</span><br><span class="line">                <span class="comment">// 比较关系 是一个枚举类，可以根据实际情况是大于还是小于之类的关系</span></span><br><span class="line">                CompareOperator.EQUAL,</span><br><span class="line">                <span class="comment">// 比较的值</span></span><br><span class="line">                Bytes.toBytes(value)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// （2）结果保留整行数据 构造器参数实际上是一样的</span></span><br><span class="line">        <span class="type">SingleColumnValueFilter</span> <span class="variable">singleColumnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">                <span class="comment">// 列族名称</span></span><br><span class="line">                Bytes.toBytes(columnFamily),</span><br><span class="line">                <span class="comment">// 列名</span></span><br><span class="line">                Bytes.toBytes(columnName),</span><br><span class="line">                <span class="comment">// 比较关系 是一个枚举类，可以根据实际情况是大于还是小于之类的关系</span></span><br><span class="line">                CompareOperator.EQUAL,</span><br><span class="line">                <span class="comment">// 比较的值</span></span><br><span class="line">                Bytes.toBytes(value)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将过滤器添加到集合，本质可以添加多个过滤器，最终结果是越过滤数据越少，所以这里注释一个过滤器的添加</span></span><br><span class="line"><span class="comment">//        filterList.addFilter(columnValueFilter);</span></span><br><span class="line">        filterList.addFilter(singleColumnValueFilter);</span><br><span class="line">        scan.setFilter(filterList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">                Cell[] cells = result.rawCells();</span><br><span class="line">                <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                    System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneRow(cell)) + <span class="string">&quot;-&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneQualifier(cell)) + <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneFamily(cell))+ <span class="string">&#x27;-&#x27;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell)) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 关闭table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 测试带过滤器的扫描 假设具体找到张三这一行的信息</span></span><br><span class="line">    filterScanRows(<span class="string">&quot;studyHBase&quot;</span>, <span class="string">&quot;student&quot;</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;2004&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2001-age-info-112001-name-info-zhangsan</span><br></pre></td></tr></table></figure><h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除一行数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> namespace 名称空间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rowKey 主键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteColumn</span><span class="params">(String namespace, String tableName, String rowKey, String columnFamily, String columnName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1 获取table</span></span><br><span class="line">    <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 创建 delete 对象</span></span><br><span class="line">    <span class="type">Delete</span> <span class="variable">delete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Delete</span>(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3 添加列信息</span></span><br><span class="line">    <span class="comment">// delete.addColumn() 等价于 delete 是删除一个版本的数据</span></span><br><span class="line">    <span class="comment">// delete.addColumns() 等价于 deleteAll 是删除所有版本的数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一般是不会删除数据的，如果真的要删除数据大多数情况也是删除所有版本的数据</span></span><br><span class="line">    delete.addColumns(Bytes.toBytes(columnFamily), Bytes.toBytes(columnName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4 删除数据</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        table.delete(delete);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5 关闭table</span></span><br><span class="line">    table.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 测试删除zhangsan所在列数据</span></span><br><span class="line">    deleteColumn(<span class="string">&quot;studyHBase&quot;</span>, <span class="string">&quot;student&quot;</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭连接</span></span><br><span class="line">    HBaseConnection2.closeConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hbase:<span class="number">003</span>:<span class="number">0</span>&gt; scan <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">ROW                             COLUMN+CELL</span><br><span class="line"> <span class="number">2001</span>                           column=info:age, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">34</span>:<span class="number">00.445</span>, value=<span class="number">11</span></span><br><span class="line"> <span class="number">2001</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-24T08:<span class="number">21</span>:<span class="number">22.454</span>, value=zhangsan</span><br><span class="line"> <span class="number">2002</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">07</span>:<span class="number">01.510</span>, value=lisi</span><br><span class="line"> <span class="number">2003</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">07</span>:<span class="number">01.521</span>, value=wangwu</span><br><span class="line"><span class="number">3</span> row(s)</span><br><span class="line">Took <span class="number">0.0390</span> seconds</span><br><span class="line">hbase:<span class="number">004</span>:<span class="number">0</span>&gt; scan <span class="string">&quot;studyHBase:student&quot;</span></span><br><span class="line">ROW                             COLUMN+CELL</span><br><span class="line"> <span class="number">2001</span>                           column=info:age, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">34</span>:<span class="number">00.445</span>, value=<span class="number">11</span></span><br><span class="line"> <span class="number">2002</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">07</span>:<span class="number">01.510</span>, value=lisi</span><br><span class="line"> <span class="number">2003</span>                           column=info:name, timestamp=<span class="number">2023</span>-<span class="number">03</span>-25T04:<span class="number">07</span>:<span class="number">01.521</span>, value=wangwu</span><br><span class="line"><span class="number">3</span> row(s)</span><br><span class="line">Took <span class="number">0.0190</span> seconds</span><br></pre></td></tr></table></figure><p>可以看到实际上删除的是info列族，name列中rowKey行的数据。它不会删除其他数据，不会删除rowKey行的其他列，例如info列族下的age列的信息就没有删除。</p><h2 id="操作DML的完整代码"><a href="#操作DML的完整代码" class="headerlink" title="操作DML的完整代码"></a>操作DML的完整代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhang.C_TestDML;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhang.A_TestConnection.HBaseConnection2;</span><br><span class="line"><span class="keyword">import</span> com.zhang.B_TestDDL.HBaseDDL1;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CellUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CompareOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.filter.ColumnValueFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.filter.FilterList;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.filter.SingleColumnValueFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yonruizhang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/3/23 18:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HBaseDML1</span> &#123;</span><br><span class="line">    <span class="comment">// 添加连接的静态属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> HBaseConnection2.connection;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey 主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> column 列名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 插入的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">putCell</span><span class="params">(String namespace, String tableName, String rowKey, String columnFamily, String column, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 0 判断表格是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!HBaseDDL1.isTableExists(namespace, tableName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;表格不存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 获取table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 调用相关方法插入数据</span></span><br><span class="line">        <span class="comment">// 使用 table.put() 方法，参数是Put对象</span></span><br><span class="line">        <span class="comment">// 2.1 创建Put对象</span></span><br><span class="line">        <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(rowKey));</span><br><span class="line">        <span class="comment">// 2.2 向Put对象添加数据</span></span><br><span class="line">        put.addColumn(Bytes.toBytes(columnFamily),Bytes.toBytes(column),Bytes.toBytes(value));</span><br><span class="line">        <span class="comment">// 2.3 将对象写入方法</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            table.put(put);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 详细读取表格中的某一列数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey 主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> column 列名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getCells</span><span class="params">(String namespace, String tableName, String rowKey, String columnFamily, String column)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取table对象</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建 get 对象</span></span><br><span class="line">        <span class="type">Get</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Get</span>(Bytes.toBytes(rowKey)); <span class="comment">// 如果不再做设置，直接读数据，此时读一整行数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读取某一列数据，需要添加对应参数</span></span><br><span class="line">        get.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(column));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 还可以设置读取数据的版本,默认有读全部版本的方法</span></span><br><span class="line">        get.readAllVersions();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3 设置完成就调用 table.get() 方法得到result对象</span></span><br><span class="line">            <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> table.get(get);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4 处理数据</span></span><br><span class="line">            Cell[] cells = result.rawCells();</span><br><span class="line">            <span class="comment">// 如果是实际开发就应该放回result，这里简单演示</span></span><br><span class="line">            <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                <span class="comment">// cell 存储数据比较底层</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell));</span><br><span class="line">                System.out.println(value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5 关闭 table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扫描数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startRow 开始的行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stopRow 结束的行</span></span><br><span class="line"><span class="comment">     *                HBase Shell中默认：[ startRow , stopRow )</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">scanRows</span><span class="params">(String namespace, String tableName, String startRow, String stopRow)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建 Scan 对象</span></span><br><span class="line">        <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>(); <span class="comment">// 如果此时什么都不填，这是扫描整张表</span></span><br><span class="line">        <span class="comment">// 实际开发中很少扫描整张表，所以要设置参数规定其实行和终止行</span></span><br><span class="line">        <span class="comment">// 函数原型：this.withStartRow(startRow, true); 第一个参数是其实行，第二个参数表示默认要包含改行，可以给定参数指定</span></span><br><span class="line">        scan.withStartRow(Bytes.toBytes(startRow));</span><br><span class="line">        <span class="comment">// 默认是不包含终止行，可自己给定第二个参数为 true 则可包含</span></span><br><span class="line">        scan.withStopRow(Bytes.toBytes(stopRow));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取多行数据获取 scanner</span></span><br><span class="line">            <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Result 是记录一行数据           本质是：Cell    数组</span></span><br><span class="line">            <span class="comment">// ResultScanner 是记录多行数据    本质是：Result  数组</span></span><br><span class="line">            <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">                Cell[] cells = result.rawCells();</span><br><span class="line">                <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                    System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneRow(cell)) + <span class="string">&quot;-&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneQualifier(cell)) + <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneFamily(cell))+ <span class="string">&#x27;-&#x27;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell)) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 关闭table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带过滤的扫描数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表格名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> startRow 开始行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stopRow 结束行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 查询值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">filterScanRows</span><span class="params">(String namespace, String tableName, String startRow, String stopRow, String columnFamily, String columnName, String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建 Scan 对象</span></span><br><span class="line">        <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">        scan.withStartRow(Bytes.toBytes(startRow));</span><br><span class="line">        scan.withStopRow(Bytes.toBytes(stopRow));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加过滤器的列表 （过滤器的集合）</span></span><br><span class="line">        <span class="type">FilterList</span> <span class="variable">filterList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterList</span>();</span><br><span class="line">        <span class="comment">// 创建过滤器</span></span><br><span class="line">        <span class="comment">// （1）结果只保留当前列的数据</span></span><br><span class="line">        <span class="type">ColumnValueFilter</span> <span class="variable">columnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColumnValueFilter</span>(</span><br><span class="line">                <span class="comment">// 列族名称</span></span><br><span class="line">                Bytes.toBytes(columnFamily),</span><br><span class="line">                <span class="comment">// 列名</span></span><br><span class="line">                Bytes.toBytes(columnName),</span><br><span class="line">                <span class="comment">// 比较关系 是一个枚举类，可以根据实际情况是大于还是小于之类的关系</span></span><br><span class="line">                CompareOperator.EQUAL,</span><br><span class="line">                <span class="comment">// 比较的值</span></span><br><span class="line">                Bytes.toBytes(value)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// （2）结果保留整行数据 构造器参数实际上是一样的</span></span><br><span class="line">        <span class="type">SingleColumnValueFilter</span> <span class="variable">singleColumnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">                <span class="comment">// 列族名称</span></span><br><span class="line">                Bytes.toBytes(columnFamily),</span><br><span class="line">                <span class="comment">// 列名</span></span><br><span class="line">                Bytes.toBytes(columnName),</span><br><span class="line">                <span class="comment">// 比较关系 是一个枚举类，可以根据实际情况是大于还是小于之类的关系</span></span><br><span class="line">                CompareOperator.EQUAL,</span><br><span class="line">                <span class="comment">// 比较的值</span></span><br><span class="line">                Bytes.toBytes(value)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将过滤器添加到集合，本质可以添加多个过滤器，最终结果是越过滤数据越少，所以这里注释一个过滤器的添加</span></span><br><span class="line"><span class="comment">//        filterList.addFilter(columnValueFilter);</span></span><br><span class="line">        filterList.addFilter(singleColumnValueFilter);</span><br><span class="line">        scan.setFilter(filterList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">                Cell[] cells = result.rawCells();</span><br><span class="line">                <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                    System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneRow(cell)) + <span class="string">&quot;-&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneQualifier(cell)) + <span class="string">&quot;-&quot;</span> +</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneFamily(cell))+ <span class="string">&#x27;-&#x27;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell)) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 关闭table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一行数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 名称空间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey 主键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteColumn</span><span class="params">(String namespace, String tableName, String rowKey, String columnFamily, String columnName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1 获取table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 创建 delete 对象</span></span><br><span class="line">        <span class="type">Delete</span> <span class="variable">delete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Delete</span>(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 添加列信息</span></span><br><span class="line">        <span class="comment">// delete.addColumn() 等价于 delete 是删除一个版本的数据</span></span><br><span class="line">        <span class="comment">// delete.addColumns() 等价于 deleteAll 是删除所有版本的数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一般是不会删除数据的，如果真的要删除数据大多数情况也是删除所有版本的数据</span></span><br><span class="line">        delete.addColumns(Bytes.toBytes(columnFamily), Bytes.toBytes(columnName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 删除数据</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            table.delete(delete);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5 关闭table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 测试添加数据</span></span><br><span class="line">        <span class="comment">// putCell(&quot;studyHBase&quot;,&quot;student&quot;,&quot;2001&quot;,&quot;info&quot;,&quot;age&quot;,&quot;11&quot;);</span></span><br><span class="line">        <span class="comment">// putCell(&quot;studyHBase&quot;,&quot;student&quot;,&quot;2001&quot;,&quot;info&quot;,&quot;name&quot;,&quot;zhangsan&quot;);</span></span><br><span class="line">        <span class="comment">// putCell(&quot;studyHBase&quot;,&quot;student&quot;,&quot;2002&quot;,&quot;info&quot;,&quot;name&quot;,&quot;lisi&quot;);</span></span><br><span class="line">        <span class="comment">// putCell(&quot;studyHBase&quot;,&quot;student&quot;,&quot;2003&quot;,&quot;info&quot;,&quot;name&quot;,&quot;wangwu&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试读取数据</span></span><br><span class="line">        <span class="comment">// getCells(&quot;studyHBase&quot;,&quot;student&quot;,&quot;2001&quot;,&quot;info&quot;,&quot;name&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试扫描数据</span></span><br><span class="line">        <span class="comment">// scanRows(&quot;studyHBase&quot;, &quot;student&quot;, &quot;2001&quot;, &quot;2003&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试带过滤器的扫描 假设具体找到张三这一行的信息</span></span><br><span class="line">        <span class="comment">// filterScanRows(&quot;studyHBase&quot;, &quot;student&quot;, &quot;2001&quot;, &quot;2004&quot;, &quot;info&quot;, &quot;name&quot;, &quot;zhangsan&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试删除zhangsan所在列数据</span></span><br><span class="line">        deleteColumn(<span class="string">&quot;studyHBase&quot;</span>, <span class="string">&quot;student&quot;</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭连接</span></span><br><span class="line">        HBaseConnection2.closeConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>HBase API是很底层的东西，调用起来比HBase Shell更加麻烦，但可查看源码，很容易理解。开放性也很好，HBase Shell能干的事情它也能干。</p><p>具体要写好，用好HBase API首先就需要先了解HBase的底层数据结构，也要了解HBase Shell的一些基本操作。</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> HBase </category>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HBase </tag>
            
            <tag> 大数据 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis-Plus</title>
      <link href="/posts/309775400.html"/>
      <url>/posts/309775400.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、MyBatis-Plus"><a href="#一、MyBatis-Plus" class="headerlink" title="一、MyBatis-Plus"></a>一、MyBatis-Plus</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus (opens new window)</a>（简称 MP）是一个 <a href="https://www.mybatis.org/mybatis-3/">MyBatis (opens new window)</a>的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。</p><blockquote><p>我们的愿景是成为 MyBatis 最好的搭档，就像 <a href="https://baomidou.com/img/contra.jpg">魂斗罗</a> 中的 1P、2P，基友搭配，效率翻倍。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/relationship-with-mybatis.png" alt="img"></p><h2 id="2-特性"><a href="#2-特性" class="headerlink" title="2.特性"></a>2.特性</h2><ul><li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li><li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li><li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li><li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li><li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li><li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li><li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li><li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li><li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li><li><strong>分页插件支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li><li><strong>内置性能分析插件</strong>：可输出 SQL 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li><li><strong>内置全局拦截插件</strong>：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li></ul><h2 id="3-支持数据库"><a href="#3-支持数据库" class="headerlink" title="3.支持数据库"></a>3.支持数据库</h2><blockquote><p>任何能使用 <code>MyBatis</code> 进行 CRUD, 并且支持标准 SQL 的数据库，具体支持情况如下，如果不在下列表查看分页部分教程 PR 您的支持。</p></blockquote><ul><li>MySQL，Oracle，DB2，H2，HSQL，SQLite，PostgreSQL，SQLServer，Phoenix，Gauss ，ClickHouse，Sybase，OceanBase，Firebird，Cubrid，Goldilocks，csiidb</li><li>达梦数据库，虚谷数据库，人大金仓数据库，南大通用(华库)数据库，南大通用数据库，神通数据库，瀚高数据库</li></ul><h2 id="4-框架结构"><a href="#4-框架结构" class="headerlink" title="4.框架结构"></a>4.框架结构</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://baomidou.com/img/mybatis-plus-framework.jpg" alt="framework" style="zoom:50%;" /></p><h2 id="5-官方地址"><a href="#5-官方地址" class="headerlink" title="5.官方地址"></a>5.官方地址</h2><blockquote><p><strong>官方网站：</strong><a href="https://baomidou.com/">https://baomidou.com/</a></p><p><strong>官方文档：</strong><a href="https://baomidou.com/pages/24112f/">https://baomidou.com/pages/24112f/</a></p></blockquote><h1 id="二、入门案例"><a href="#二、入门案例" class="headerlink" title="二、入门案例"></a>二、入门案例</h1><h2 id="1-开发环境"><a href="#1-开发环境" class="headerlink" title="1.开发环境"></a>1.开发环境</h2><ul><li><strong>IDE：IDEA 2022.2.0</strong></li><li><strong>JDK：JDK17</strong></li><li><strong>构建工具：Maven 3.6.3</strong></li><li><strong>MySQL：MySQL 5.7</strong></li><li><strong>Navicat：Navicat Premium 15</strong></li><li><strong>Spring Boot：2.7.0</strong></li><li><strong>MyBatis-Plus：3.5.1</strong></li></ul><h2 id="2-建库建表"><a href="#2-建库建表" class="headerlink" title="2.建库建表"></a>2.建库建表</h2><ul><li><p><strong>打开Navicat运行以下SQL脚本进行建库建表</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `mybatis_plus` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 */</span>; </span><br><span class="line">use `mybatis_plus`; </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` ( </span><br><span class="line">    `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>, </span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>, </span><br><span class="line">    `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>, </span><br><span class="line">    `email` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`) </span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure></li><li><p><strong>插入几条测试数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> (id, name, age, email) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>), </span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-创建工程"><a href="#3-创建工程" class="headerlink" title="3.创建工程"></a>3.创建工程</h2><ul><li><p><strong>使用<code>Spring Initializer</code>快速初始化一个 Spring Boot 工程</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519140839640.png" alt="image-20220519140839640" style="zoom:80%;" /></p></li></ul><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519141335981.png" alt="image-20220519141335981" style="zoom:80%;" /></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519141737405.png" alt="image-20220519141737405" style="zoom:80%;" /></p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519141849937.png" alt="image-20220519141849937" style="zoom:80%;" /></p><ul><li><p><strong>引入<code>MyBatis-Plus</code>的依赖</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>安装<code>Lombok</code>插件</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519143257305.png" alt="image-20220519143257305" style="zoom:80%;" /></p></li></ul><h2 id="4-配置编码"><a href="#4-配置编码" class="headerlink" title="4.配置编码"></a>4.配置编码</h2><ul><li><p><strong>配置<code>application.yml</code>文件</strong></p><p>其中的功能选择配置，不用全配。</p><p>需要多数据源的时候看：<a href="#3.编写配置文件">3.编写配置文件</a></p><p>主要配置：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置端口</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="comment"># 配置数据源 必要</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span>  <span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment"># 打印日志文件</span></span><br><span class="line">  <span class="comment"># 设置MyBatisPlus的全局配置</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="comment"># 关于数据库的配置（一般都不会配置这下面的东西）</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span>  <span class="comment">#设置数据库中表的同意前缀</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span>     <span class="comment">#设置id生成策略</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值(默认为 1)</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值(默认为 0)</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span>  <span class="comment"># 设置映射文件位置</span></span><br><span class="line">  <span class="comment">#设置类型别名所在包，方便在XXXMapper.xml中使用resultType</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.zhang.mybatisplus01.entity</span> </span><br><span class="line">  <span class="attr">type-enums-package:</span> <span class="string">com.zhang.mybatisplus01.enums</span> <span class="comment">#设置通用枚举所在包（使用@EnumValue注解时配置）</span></span><br></pre></td></tr></table></figure><hr><p>注意（只是解释，操作中不用实现）：</p><p>之前使用时因为数据库是5.7版本的所以可以选择直接再pom.xml中添加版本信息如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样之后就可以修改<code>application.xml</code>文件中的<code>spring.datasource.driver-class-name:</code>为<code>com.mysql.jdbc.Driver</code>。</p><p>当然，没有这么麻烦。如果在<code>pom.xml</code>中直接使用没有版本标注的依赖引入即可，但是<code>spring.datasource.driver-class-name:</code>的值需要为<code>com.mysql.cj.jdbc.Driver</code>，即使是5.7版本的数据库也不会有问题。</p></li><li><p><strong>在 Spring Boot 启动类中添加 <code>@MapperScan</code> 注解，扫描 Mapper 文件夹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;指定Mapper接口所在的包&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusDemoApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(MybatisPlusDemoApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>编写实体类 <code>User.java</code>（此处使用了 Lombok 简化代码）</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>编写 Mapper 包下的 <code>UserMapper</code>接口</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><p>注意：需要继承BaseMapper，BaseMapper是灵魂，它为我们写好了一些基本的增删改查操作，且它支持泛型，指定的实体类型就是操作的对象（表）</p></li></ul><h2 id="5-测试查询"><a href="#5-测试查询" class="headerlink" title="5.测试查询"></a>5.测试查询</h2><ul><li><p><strong>编写一个测试类<code>MyBatisPlusTest.java</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusTest</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试查询所有数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//通过条件构造器查询一个list集合，若没有条件，则可以设置null为参数</span></span><br><span class="line">        List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>控制台打印查询结果</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220519150454211.png" alt="image-20220519150454211"></p></li></ul><h1 id="三、增删改查"><a href="#三、增删改查" class="headerlink" title="三、增删改查"></a>三、增删改查</h1><h2 id="1-BaseMapper-lt-gt"><a href="#1-BaseMapper-lt-gt" class="headerlink" title="1.BaseMapper&lt;&gt;"></a>1.BaseMapper&lt;&gt;</h2><blockquote><p>说明:</p><ul><li>通用 CRUD 封装BaseMapper 接口，为 <code>Mybatis-Plus</code> 启动时自动解析实体表关系映射转换为 <code>Mybatis</code> 内部对象注入容器</li><li>泛型 <code>T</code> 为任意实体对象</li><li>参数 <code>Serializable</code> 为任意类型主键 <code>Mybatis-Plus</code> 不推荐使用复合主键约定每一张表都有自己的唯一 <code>id</code> 主键</li><li>对象 <code>Wrapper</code> 为条件构造器</li></ul></blockquote><p>MyBatis-Plus中的基本CRUD在内置的BaseMapper中都已得到了实现，因此我们继承该接口以后可以直接使用。</p><p>本次演示的CRUD操作不包含参数带有条件构造器的方法，关于条件构造器将单独在一个章节进行演示。</p><hr><blockquote><p><strong>BaseMapper中提供的CRUD方法：</strong></p></blockquote><ul><li><p><strong>增加：Insert</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(T entity)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>删除：Delete</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 entity 条件，删除记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; wrapper)</span>;</span><br><span class="line"><span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 删除</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>修改：Update</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 whereWrapper 条件，更新记录</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T updateEntity, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; whereWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 修改</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateById</span><span class="params">(<span class="meta">@Param(Constants.ENTITY)</span> T entity)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>查询：Selete</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 ID 查询</span></span><br><span class="line">T <span class="title function_">selectById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 entity 条件，查询一条记录</span></span><br><span class="line">T <span class="title function_">selectOne</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// 根据 entity 条件，查询全部记录</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">selectByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMaps</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录。注意： 只返回第一个字段的值</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">selectObjs</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 entity 条件，查询全部记录（并翻页）</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">selectPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录（并翻页）</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectMapsPage</span><span class="params">(IPage&lt;T&gt; page, <span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line">Integer <span class="title function_">selectCount</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-调用Mapper层实现CRUD"><a href="#2-调用Mapper层实现CRUD" class="headerlink" title="2.调用Mapper层实现CRUD"></a>2.调用Mapper层实现CRUD</h2><h3 id="2-1-插入"><a href="#2-1-插入" class="headerlink" title="2.1 插入"></a>2.1 插入</h3><blockquote><p><strong>最终执行的结果，所获取的id为1527206783590903810</strong></p><p><strong>这是因为MyBatis-Plus在实现插入数据时，会默认基于雪花算法的策略生成id</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 测试插入一条数据</span></span><br><span class="line"><span class="comment">  * MyBatis-Plus在实现插入数据时，会默认基于雪花算法的策略生成id</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;Vz&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">21</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;vz@oz6.cn&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;添加成功！&quot;</span> : <span class="string">&quot;添加失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">    <span class="comment">//1527206783590903810（当前 id 为雪花算法自动生成的id）</span></span><br><span class="line">    System.out.println(<span class="string">&quot;id自动获取&quot;</span> + user.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> ( id, name, age, email ) <span class="keyword">VALUES</span> ( ?, ?, ?, ? )</span><br></pre></td></tr></table></figure><hr><h3 id="2-2-删除"><a href="#2-2-删除" class="headerlink" title="2.2 删除"></a>2.2 删除</h3><h4 id="a、根据ID删除数据"><a href="#a、根据ID删除数据" class="headerlink" title="a、根据ID删除数据"></a>a、根据ID删除数据</h4><blockquote><p><strong>调用方法：int deleteById(Serializable id);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 测试根据id删除一条数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteById(<span class="number">1527206783590903810L</span>);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;删除成功！&quot;</span> : <span class="string">&quot;删除失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id<span class="operator">=</span>?</span><br></pre></td></tr></table></figure><h4 id="b、根据ID批量删除数据"><a href="#b、根据ID批量删除数据" class="headerlink" title="b、根据ID批量删除数据"></a>b、根据ID批量删除数据</h4><blockquote><p><strong>调用方法：int deleteBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 测试通过id批量删除数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteBatchIds</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Long&gt; ids = Arrays.asList(<span class="number">6L</span>,<span class="number">7L</span>,<span class="number">8L</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteBatchIds(ids);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;删除成功！&quot;</span> : <span class="string">&quot;删除失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="keyword">IN</span> ( ? , ? , ? )</span><br></pre></td></tr></table></figure><h4 id="c、根据Map条件删除数据"><a href="#c、根据Map条件删除数据" class="headerlink" title="c、根据Map条件删除数据"></a>c、根据Map条件删除数据</h4><blockquote><p><strong>调用方法：int deleteByMap(@Param(Constants.COLUMN_MAP) Map<String, Object> columnMap);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 测试根据Map集合中所设置的条件删除数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteByMap</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 因为产生的新数据的id是通过雪花算法自动生成的，所以不太可控，可以通过指定其他信息来删除对应数据</span></span><br><span class="line">    <span class="comment">// 要删除的条件：key为字段名，value为需要匹配的值，即 where k = v</span></span><br><span class="line">    <span class="comment">// 当前演示为根据name和age删除数据</span></span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Vz&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>,<span class="number">21</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteByMap(map);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;删除成功！&quot;</span> : <span class="string">&quot;删除失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> ? <span class="keyword">AND</span> age <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><h3 id="2-3-修改"><a href="#2-3-修改" class="headerlink" title="2.3 修改"></a>2.3 修改</h3><blockquote><p><strong>调用方法：int updateById(@Param(Constants.ENTITY) T entity);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 测试根据id修改用户信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(<span class="number">6L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;VzUpdate&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;Vz@sina.com&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;修改成功！&quot;</span> : <span class="string">&quot;修改失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> name<span class="operator">=</span>?, age<span class="operator">=</span>?, email<span class="operator">=</span>? <span class="keyword">WHERE</span> id<span class="operator">=</span>?</span><br></pre></td></tr></table></figure><p>上面是设置了多个修改后信息，如果有一个为空的话，那么生成的sql中不会出现其条件；</p><p>如（此写法需要对实体类添加<code>@AllArgsConstructorl</code>注解（使用Lombok生成有参构造））：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">4L</span>, <span class="string">&quot;李四&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;lisi@gmail.com&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.updateById(user);</span><br><span class="line">System.out.println(<span class="string">&quot;result = &quot;</span> + result);</span><br></pre></td></tr></table></figure><p>生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> name<span class="operator">=</span>?, email<span class="operator">=</span>? <span class="keyword">WHERE</span> id<span class="operator">=</span>?</span><br></pre></td></tr></table></figure><hr><h3 id="2-4-查询"><a href="#2-4-查询" class="headerlink" title="2.4    查询"></a>2.4    查询</h3><h4 id="a、根据ID查询用户信息"><a href="#a、根据ID查询用户信息" class="headerlink" title="a、根据ID查询用户信息"></a>a、根据ID查询用户信息</h4><blockquote><p><strong>调用方法：T selectById(Serializable id);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 测试根据id查询用户数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,age,email <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id<span class="operator">=</span>?</span><br></pre></td></tr></table></figure><h4 id="b、根据多个ID查询多个用户信息"><a href="#b、根据多个ID查询多个用户信息" class="headerlink" title="b、根据多个ID查询多个用户信息"></a>b、根据多个ID查询多个用户信息</h4><blockquote><p><strong>调用方法：List<T> selectBatchIds(@Param(Constants.COLLECTION) Collection&lt;? extends Serializable&gt; idList);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据多个id查询用户数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectBatchIds</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Long&gt; ids = Arrays.asList(<span class="number">1L</span>,<span class="number">2L</span>,<span class="number">3L</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectBatchIds(ids);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,age,email <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="keyword">IN</span> ( ? , ? , ? )</span><br></pre></td></tr></table></figure><p>list中有多少条数据则有几个问好需要数据填充。</p><h4 id="c、根据Map条件查询用户信息"><a href="#c、根据Map条件查询用户信息" class="headerlink" title="c、根据Map条件查询用户信息"></a>c、根据Map条件查询用户信息</h4><blockquote><p><strong>调用方法：List<T> selectByMap(@Param(Constants.COLUMN_MAP) Map<String, Object> columnMap);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据Map所设置的条件查询用户</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectByMap</span><span class="params">()</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectByMap(map);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句（和deleteByMap的匹配规则类似）：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,age,email <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> ? <span class="keyword">AND</span> age <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure><h4 id="d、查询所有用户信息"><a href="#d、查询所有用户信息" class="headerlink" title="d、查询所有用户信息"></a>d、查询所有用户信息</h4><blockquote><p><strong>调用方法：List<T> selectList(@Param(Constants.WRAPPER) Wrapper<T> queryWrapper);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 测试查询所有数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(<span class="literal">null</span>); <span class="comment">// 没有条件就是null</span></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自动生成的sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,age,email <span class="keyword">FROM</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure><p><strong>具体的条件查询规则Wrapper看：</strong><a href="#五、条件构造器">五、条件构造器</a></p><h2 id="3-通用Service"><a href="#3-通用Service" class="headerlink" title="3.通用Service"></a>3.通用Service</h2><blockquote><p>说明:</p><ul><li>通用 Service CRUD 封装<code>IService</code><strong>接口</strong>，进一步封装 CRUD 采用 <code>get 查询单行</code> <code>remove 删除</code> <code>list 查询集合</code> <code>page 分页</code> 前缀命名方式区分 <code>Mapper</code> 层避免混淆，</li><li>泛型 <code>T</code> 为任意实体对象</li><li>建议如果存在自定义通用 Service 方法的可能，请创建自己的 <code>IBaseService</code> 继承 <code>Mybatis-Plus</code> 提供的基类</li><li>对象 <code>Wrapper</code> 为 条件构造器</li></ul></blockquote><p>MyBatis-Plus中有一个接口 <strong><code>IService</code></strong>和其实现类 <strong><code>ServiceImpl</code></strong>，封装了常见的业务层逻辑，详情查看源码<code>IService</code>和<code>ServiceImpl</code></p><p>但是，有时我们的业务逻辑会很复杂，因此我们在使用的时候仅需在自己定义的<strong><code>Service</code></strong>接口中继承<strong><code>IService</code></strong>接口，在自己的实现类中实现自己的Service并继承<strong><code>ServiceImpl</code></strong>即可，具体演示可见：<a href="#4.调用Service层操作数据">4.调用Service层操作数据</a></p><hr><blockquote><p><strong>IService中的CRUD方法</strong></p></blockquote><h3 id="增加：save"><a href="#增加：save" class="headerlink" title="增加：save"></a>增加：save</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入一条记录（选择字段，策略插入）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">save</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// 插入（批量）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// 插入（批量）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">T</td><td style="text-align:center">entity</td><td style="text-align:center">实体对象</td></tr><tr><td style="text-align:center">Collection<T></td><td style="text-align:center">entityList</td><td style="text-align:center">实体对象集合</td></tr><tr><td style="text-align:center">int</td><td style="text-align:center">batchSize</td><td style="text-align:center">插入批次数量</td></tr></tbody></table></div><h3 id="增加：SaveOrUpdate"><a href="#增加：SaveOrUpdate" class="headerlink" title="增加：SaveOrUpdate"></a>增加：SaveOrUpdate</h3><p>存在一种情况：可能会错误添加主键值相同的数据，这种会报错，但是主键值相同也可能数想要修改。所以，使用这个方法则是，如果有id则是修改，没有id则是添加，比较灵活。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TableId 注解存在更新记录，否插入一条记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// 根据updateWrapper尝试更新，否继续执行saveOrUpdate(T)方法</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity, Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"><span class="comment">// 批量修改插入</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// 批量修改插入</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">saveOrUpdateBatch</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">T</td><td style="text-align:center">entity</td><td style="text-align:center">实体对象</td></tr><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">updateWrapper</td><td style="text-align:center">实体对象封装操作类 UpdateWrapper</td></tr><tr><td style="text-align:center">Collection<T></td><td style="text-align:center">entityList</td><td style="text-align:center">实体对象集合</td></tr><tr><td style="text-align:center">int</td><td style="text-align:center">batchSize</td><td style="text-align:center">插入批次数量</td></tr></tbody></table></div><h3 id="删除：Remove"><a href="#删除：Remove" class="headerlink" title="删除：Remove"></a><strong>删除：Remove</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 entity 条件，删除记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 删除</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 columnMap 条件，删除记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// 删除（根据ID 批量删除）</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">removeByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-2"><a href="#参数说明-2" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">queryWrapper</td><td style="text-align:center">实体包装类 QueryWrapper</td></tr><tr><td style="text-align:center">Serializable</td><td style="text-align:center">id</td><td style="text-align:center">主键 ID</td></tr><tr><td style="text-align:center">Map<String, Object></td><td style="text-align:center">columnMap</td><td style="text-align:center">表字段 map 对象</td></tr><tr><td style="text-align:center">Collection&lt;? extends Serializable&gt;</td><td style="text-align:center">idList</td><td style="text-align:center">主键 ID 列表</td></tr></tbody></table></div><h3 id="修改：Update"><a href="#修改：Update" class="headerlink" title="修改：Update"></a><strong>修改：Update</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 UpdateWrapper 条件，更新记录 需要设置sqlset</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Wrapper&lt;T&gt; updateWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 whereWrapper 条件，更新记录</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">update</span><span class="params">(T updateEntity, Wrapper&lt;T&gt; whereWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 ID 选择修改</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(T entity)</span>;</span><br><span class="line"><span class="comment">// 根据ID 批量更新</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList)</span>;</span><br><span class="line"><span class="comment">// 根据ID 批量更新</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">updateBatchById</span><span class="params">(Collection&lt;T&gt; entityList, <span class="type">int</span> batchSize)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-3"><a href="#参数说明-3" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">updateWrapper</td><td style="text-align:center">实体对象封装操作类 UpdateWrapper</td></tr><tr><td style="text-align:center">T</td><td style="text-align:center">entity</td><td style="text-align:center">实体对象</td></tr><tr><td style="text-align:center">Collection<T></td><td style="text-align:center">entityList</td><td style="text-align:center">实体对象集合</td></tr><tr><td style="text-align:center">int</td><td style="text-align:center">batchSize</td><td style="text-align:center">更新批次数量</td></tr></tbody></table></div><h3 id="查询：Get"><a href="#查询：Get" class="headerlink" title="查询：Get"></a><strong>查询：Get</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 ID 查询</span></span><br><span class="line">T <span class="title function_">getById</span><span class="params">(Serializable id)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录。结果集，如果是多个会抛出异常，随机取一条加上限制条件 wrapper.last(&quot;LIMIT 1&quot;)</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">T <span class="title function_">getOne</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, <span class="type">boolean</span> throwEx)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getMap</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper，查询一条记录</span></span><br><span class="line">&lt;V&gt; V <span class="title function_">getObj</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-4"><a href="#参数说明-4" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Serializable</td><td style="text-align:center">id</td><td style="text-align:center">主键 ID</td></tr><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">queryWrapper</td><td style="text-align:center">实体对象封装操作类 QueryWrapper</td></tr><tr><td style="text-align:center">boolean</td><td style="text-align:center">throwEx</td><td style="text-align:center">有多个 result 是否抛出异常</td></tr><tr><td style="text-align:center">T</td><td style="text-align:center">entity</td><td style="text-align:center">实体对象</td></tr><tr><td style="text-align:center">Function&lt;? super Object, V&gt;</td><td style="text-align:center">mapper</td><td style="text-align:center">转换函数</td></tr></tbody></table></div><h3 id="查询List"><a href="#查询List" class="headerlink" title="查询List"></a>查询List</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 查询列表</span></span><br><span class="line">List&lt;T&gt; <span class="title function_">list</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 查询（根据ID 批量查询）</span></span><br><span class="line">Collection&lt;T&gt; <span class="title function_">listByIds</span><span class="params">(Collection&lt;? extends Serializable&gt; idList)</span>;</span><br><span class="line"><span class="comment">// 查询（根据 columnMap 条件）</span></span><br><span class="line">Collection&lt;T&gt; <span class="title function_">listByMap</span><span class="params">(Map&lt;String, Object&gt; columnMap)</span>;</span><br><span class="line"><span class="comment">// 查询所有列表</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 查询列表</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">listMaps</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 查询全部记录</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 查询全部记录</span></span><br><span class="line">&lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">List&lt;Object&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询全部记录</span></span><br><span class="line">&lt;V&gt; List&lt;V&gt; <span class="title function_">listObjs</span><span class="params">(Wrapper&lt;T&gt; queryWrapper, Function&lt;? <span class="built_in">super</span> Object, V&gt; mapper)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-5"><a href="#参数说明-5" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">queryWrapper</td><td style="text-align:center">实体对象封装操作类 QueryWrapper</td></tr><tr><td style="text-align:center">Collection&lt;? extends Serializable&gt;</td><td style="text-align:center">idList</td><td style="text-align:center">主键 ID 列表</td></tr><tr><td style="text-align:center">Map<String, Object></td><td style="text-align:center">columnMap</td><td style="text-align:center">表字段 map 对象</td></tr><tr><td style="text-align:center">Function&lt;? super Object, V&gt;</td><td style="text-align:center">mapper</td><td style="text-align:center">转换函数</td></tr></tbody></table></div><h3 id="查询Count"><a href="#查询Count" class="headerlink" title="查询Count"></a>查询Count</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询总记录数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 根据 Wrapper 条件，查询总记录数</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">count</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-6"><a href="#参数说明-6" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">queryWrapper</td><td style="text-align:center">实体对象封装操作类 QueryWrapper</td></tr></tbody></table></div><h3 id="分页：Page"><a href="#分页：Page" class="headerlink" title="分页：Page"></a><strong>分页：Page</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无条件分页查询</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page)</span>;</span><br><span class="line"><span class="comment">// 条件分页查询</span></span><br><span class="line">IPage&lt;T&gt; <span class="title function_">page</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line"><span class="comment">// 无条件分页查询</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">pageMaps</span><span class="params">(IPage&lt;T&gt; page)</span>;</span><br><span class="line"><span class="comment">// 条件分页查询</span></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">pageMaps</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span>;</span><br></pre></td></tr></table></figure><h4 id="参数说明-7"><a href="#参数说明-7" class="headerlink" title="参数说明"></a>参数说明</h4><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">参数名</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">IPage<T></td><td style="text-align:center">page</td><td style="text-align:center">翻页对象</td></tr><tr><td style="text-align:center">Wrapper<T></td><td style="text-align:center">queryWrapper</td><td style="text-align:center">实体对象封装操作类 QueryWrapper</td></tr></tbody></table></div><h2 id="4-调用Service层操作数据"><a href="#4-调用Service层操作数据" class="headerlink" title="4.调用Service层操作数据"></a>4.调用Service层操作数据</h2><blockquote><p>我们在自己的Service接口中通过继承MyBatis-Plus提供的<code>IService</code>接口，不仅可以获得其提供的CRUD方法，而且还可以使用自身定义的方法。</p></blockquote><ul><li><p><strong>创建<code>UserService</code>并继承<code>IService</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * UserService继承IService模板提供的基础功能 </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>创建<code>UserService</code>的实现类并继承<code>ServiceImpl</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ServiceImpl实现了IService，提供了IService中基础功能的实现 </span></span><br><span class="line"><span class="comment">  * 若ServiceImpl无法满足业务需求，则可以使用自定的UserService定义方法，并在实现类中实现</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>第一个泛型为执行命令的mapper，第二个泛型为实体类。</p></li><li><p><strong>测试查询记录数</strong></p><blockquote><p><strong>调用方法：int count();</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//查询总记录数</span></span><br><span class="line">    <span class="comment">//执行的SQL为：SELECT COUNT( * ) FROM user</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> userService.count();</span><br><span class="line">    System.out.println(<span class="string">&quot;总记录数：&quot;</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>测试批量插入数据</strong></p><blockquote><p><strong>调用方法：boolean saveBatch(Collection<T> entityList);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;zyr&quot;</span>+i);</span><br><span class="line">        user.setAge(<span class="number">20</span>+i);</span><br><span class="line">        list.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> userService.saveBatch(list);</span><br><span class="line">    System.out.println(b ? <span class="string">&quot;添加成功！&quot;</span> : <span class="string">&quot;添加失败！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="四、常用注解"><a href="#四、常用注解" class="headerlink" title="四、常用注解"></a>四、常用注解</h1><blockquote><p>MyBatis-Plus提供的注解可以帮我们解决一些数据库与实体之间相互映射的问题。</p></blockquote><h2 id="0、提前总结"><a href="#0、提前总结" class="headerlink" title="0、提前总结"></a>0、提前总结</h2><ul><li><p>各自特点与需求：</p><ul><li><p>表名有关问题就用<code>@Tablename</code>(一般就是表名和实体类名不同，需要设置value为对应表明)</p></li><li><p>主键有关设置就用<code>@TabelId</code>(一般是实体类属性名和字段名不同，和是否使用雪花算法的类型开启)</p></li><li><p>字段有关设施就用<code>@TableField</code>(一般就是实体类属性名和字段名不同，需要设置value为对应字段名)</p></li><li><p>需要逻辑删除就用<code>@TableLogin</code></p></li></ul></li><li><p>共同点：</p><ol><li><p>只是需要value属性，那么value可以省略，直接写对应的名字</p></li><li><p>application.yaml中配置在：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 配置mp的主键策略为自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="comment"># 设置实体类所对应的表的统一前缀</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br></pre></td></tr></table></figure></li><li><p>一般都需要参数（value）</p></li></ol></li><li><p>不需要注解的情况</p><ul><li>字体类名和表名一致</li><li>主键的字段名就是id（但是一般业务中都不是，因为会做区分和外键联系）</li><li>就是要用雪花算法生成id</li><li>实体类属性名和字段名一致</li><li>实体类属性名使用驼峰命名(SpringBoot默认配置)修改过后和字段名一致</li><li>不需要逻辑删除时</li></ul></li></ul><h2 id="1-TableName"><a href="#1-TableName" class="headerlink" title="1.@TableName"></a>1.@TableName</h2><p>经过以上的测试，在使用MyBatis-Plus实现基本的CRUD时，我们并没有指定要操作的表，只是在Mapper接口继承BaseMapper时，设置了泛型User，而操作的表为user表，由此得出结论，MyBatis-Plus在确定操作的表时，由BaseMapper的泛型决定，即实体类型决定，且默认操作的表名和实体类型的类名一致。</p><h3 id="1-1-引出问题"><a href="#1-1-引出问题" class="headerlink" title="1.1    引出问题"></a>1.1    引出问题</h3><blockquote><p><strong>若实体类类型的类名和要操作的表的表名不一致，会出现什么问题？</strong></p></blockquote><ul><li><p>我们将表<code>user</code>更名为<code>t_user</code>，测试查询功能</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520093844842.png" alt="image-20220520093844842"></p></li><li><p>程序抛出异常，<strong>Table ‘mybatis_plus.user’ doesn’t exist</strong>，因为现在的表名为<code>t_user</code>，而默认操作的表名和实体类型的类名一致，即<code>user</code>表</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520094126411.png" alt="image-20220520094126411"></p></li></ul><h3 id="1-2-解决问题"><a href="#1-2-解决问题" class="headerlink" title="1.2    解决问题"></a>1.2    解决问题</h3><h4 id="a、使用注解解决问题"><a href="#a、使用注解解决问题" class="headerlink" title="a、使用注解解决问题"></a>a、使用注解解决问题</h4><blockquote><p><strong>在实体类类型上添加<code>@TableName(&quot;t_user&quot;)</code>，标识实体类对应的表，即可成功执行SQL语句</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span><span class="comment">//设置实体类对应的表名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="b、使用全局配置解决问题"><a href="#b、使用全局配置解决问题" class="headerlink" title="b、使用全局配置解决问题"></a>b、使用全局配置解决问题</h4><blockquote><p><strong>在开发的过程中，我们经常遇到以上的问题，即实体类所对应的表都有固定的前缀，例如 <code>t_</code> 或 <code>tbl_</code> 此时，可以使用MyBatis-Plus提供的全局配置，为实体类所对应的表名设置默认的前缀，那么就不需要在每个实体类上通过@TableName标识实体类对应的表</strong></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 设置实体类所对应的表的统一前缀</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br></pre></td></tr></table></figure><p><strong>主要针对一次开发中的表名的前缀统一的情况，或者个人又特殊习惯的情况</strong></p><h2 id="2-TableId"><a href="#2-TableId" class="headerlink" title="2.@TableId"></a>2.@TableId</h2><blockquote><p><strong>经过以上的测试，MyBatis-Plus在实现CRUD时，会默认将id作为主键列，并在插入数据时，默认基于雪花算法的策略生成id</strong></p></blockquote><h3 id="2-1-引出问题"><a href="#2-1-引出问题" class="headerlink" title="2.1    引出问题"></a>2.1    引出问题</h3><blockquote><p><strong>若实体类和表中表示主键的不是id，而是其他字段，例如uid，MyBatis-Plus会自动识别uid为主键列吗？</strong></p></blockquote><ul><li><p>我们实体类中的属性<code>id</code>改为<code>uid</code>，将表中的字段<code>id</code>也改为<code>uid</code>，测试添加功能</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520100939157.png" alt="image-20220520100939157"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520100715109.png" alt="image-20220520100715109"></p></li><li><p>程序抛出异常，<strong>Field ‘uid’ doesn’t have a default value</strong>，说明MyBatis-Plus没有将<code>uid</code>作为主键赋值</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520101317761.png" alt="image-20220520101317761"></p></li></ul><h3 id="2-2-解决问题"><a href="#2-2-解决问题" class="headerlink" title="2.2    解决问题"></a>2.2    解决问题</h3><blockquote><p><strong>在实体类中uid属性上通过<code>@TableId</code>将其标识为主键，即可成功执行SQL语句</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Date</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long uid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-TableId的value属性"><a href="#2-3-TableId的value属性" class="headerlink" title="2.3    @TableId的value属性"></a>2.3    @TableId的value属性</h3><blockquote><p>若实体类中主键对应的属性为id，而表中表示主键的字段为uid，此时若只在属性id上添加注解@TableId，则抛出异常<strong>Unknown column ‘id’ in ‘field list’</strong>，即MyBatis-Plus仍然会将id作为表的主键操作，而表中表示主键的是字段uid此时需要通过@TableId注解的value属性，指定表中的主键字段，<code>@TableId(&quot;uid&quot;)</code>或<code>@TableId(value=&quot;uid&quot;)</code></p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520103030977.png" alt="image-20220520103030977"></p><h3 id="2-4-TableId的type属性"><a href="#2-4-TableId的type属性" class="headerlink" title="2.4    @TableId的type属性"></a>2.4    @TableId的type属性</h3><blockquote><p><strong>type属性用来定义主键策略：默认雪花算法</strong></p></blockquote><p><strong>常用的主键策略：</strong></p><div class="table-container"><table><thead><tr><th style="text-align:center">值</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">IdType.ASSIGN_ID（默认）</td><td style="text-align:center">基于雪花算法的策略生成数据id，与数据库id是否设置自增无关</td></tr><tr><td style="text-align:center">IdType.AUTO</td><td style="text-align:center">使用数据库的自增策略，==注意，该类型请确保数据库设置了id自增==</td></tr></tbody></table></div><p><strong>配置全局主键策略：</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MyBatis-Plus相关配置</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#配置日志</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span><span class="comment"># 全局配置</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#配置mp的主键策略为自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="comment"># 设置实体类所对应的表的统一前缀</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br></pre></td></tr></table></figure><h2 id="3-TbaleField"><a href="#3-TbaleField" class="headerlink" title="3.@TbaleField"></a>3.@TbaleField</h2><blockquote><p>经过以上的测试，我们可以发现，MyBatis-Plus在执行SQL语句时，要保证实体类中的属性名和表中的字段名一致</p><p>如果实体类中的属性名和字段名不一致的情况，会出现什么问题呢？</p></blockquote><h3 id="3-1-情况一"><a href="#3-1-情况一" class="headerlink" title="3.1    情况一"></a>3.1    情况一</h3><p>若实体类中的属性使用的是驼峰命名风格，而表中的字段使用的是下划线命名风格</p><p>例如实体类属性<code>userName</code>，表中字段<code>user_name</code></p><p>此时MyBatis-Plus会自动将下划线命名风格转化为驼峰命名风格</p><p>相当于在MyBatis中配置</p><h3 id="3-2-情况二"><a href="#3-2-情况二" class="headerlink" title="3.2    情况二"></a>3.2    情况二</h3><blockquote><p>若实体类中的属性和表中的字段不满足情况1</p><p>例如实体类属性<code>name</code>，表中字段<code>username</code></p><p>此时需要在实体类属性上使用<code>@TableField(&quot;username&quot;)</code>设置属性所对应的字段名</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(&quot;uid&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-TableLogic"><a href="#4-TableLogic" class="headerlink" title="4.@TableLogic"></a>4.@TableLogic</h2><h3 id="4-1-逻辑删除"><a href="#4-1-逻辑删除" class="headerlink" title="4.1 逻辑删除"></a>4.1 逻辑删除</h3><blockquote><p>物理删除：真实删除，将对应数据从数据库中删除，之后查询不到此条被删除的数据</p><p>逻辑删除：假删除，将对应数据中代表是否被删除字段的状态修改为“被删除状态”，之后在数据库中仍旧能看到此条数据记录</p><p>使用场景：可以进行数据恢复</p></blockquote><h3 id="4-2-实现逻辑删除"><a href="#4-2-实现逻辑删除" class="headerlink" title="4.2 实现逻辑删除"></a>4.2 实现逻辑删除</h3><ul><li><p><strong>数据库中创建逻辑删除状态列，设置默认值为0</strong></p><p>要先创建一列。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520134529809.png" alt="image-20220520134529809"></p></li><li><p><strong>实体类中添加逻辑删除属性</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520134636112.png" alt="image-20220520134636112"></p></li><li><p><strong>测试删除功能，真正执行的是修改</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.deleteById(<span class="number">1527472864163348482L</span>);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;删除成功！&quot;</span> : <span class="string">&quot;删除失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520135637388.png" alt="image-20220520135637388"></p></li><li><p><strong>此时执行查询方法，查询的结果为自动添加条件<code>is_deleted=0</code></strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220520140036445.png" alt="image-20220520140036445"></p></li></ul><p><strong>如果想要实现恢复逻辑删除或者查出逻辑删除的数据就需要自己手动写xml文件了（或者纯注解开发）</strong></p><h1 id="五、条件构造器"><a href="#五、条件构造器" class="headerlink" title="五、条件构造器"></a>五、条件构造器</h1><h2 id="1-Wrapper介绍"><a href="#1-Wrapper介绍" class="headerlink" title="1.Wrapper介绍"></a>1.Wrapper介绍</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521092812125.png" alt="image-20220521092812125"></p><ul><li><p><code>Wrapper</code> ： 条件构造抽象类，最顶端父类</p><ul><li><code>AbstractWrapper</code>： 用于查询条件封装，生成 sql 的 where 条件</li></ul></li><li><p><code>QueryWrapper</code>： 查询条件封装</p></li><li><p><code>UpdateWrapper</code>： Update 条件封装</p></li><li><p><code>AbstractLambdaWrapper</code>： 使用Lambda 语法</p><ul><li><p><code>LambdaQueryWrapper</code>：用于Lambda语法使用的查询Wrapper</p></li><li><p><code>LambdaUpdateWrapper</code>： Lambda 更新封装Wrapper</p></li></ul></li></ul><h3 id="关系及区别"><a href="#关系及区别" class="headerlink" title="关系及区别"></a>关系及区别</h3><ol><li>一般使用的都是实现类</li><li>UpdateQuery相当于是比QueryWrapper多一点点功能的类（只多了一个<code>set()</code>方法）</li><li>Lambda开头的两个类分别的对应的类几乎一样，唯一的区别是功能上的拓展（可以使用Lambda表达式来表示字段名（因为一般开发中实体类属性名和字段名不同时会使用<code>@TableFiled</code>注解标记好对应的字段名）这个时候在条件中写lambda就是对应的字段名，在开发中更少出错）</li><li>当然LambdaUpdateWrapper的<code>set()</code>方法的字段名的参数位置也只能使用Lambda表达式了。</li></ol><p>总结起来使用场景：</p><ul><li><p>一般表设置的很好才使用QueryWrapper和UpdateWrapper</p></li><li><p>使用LambdaQueryWrapper和LambdaUpdateWrapper更加方便，更少出错，常使用这两个</p><ul><li>但是要注意，使用了Lambda……类之后原本的表示字段名的参数只能使用Lambda的表达式了，不支持字符串了</li></ul></li><li>一般不使用修改操作就使用LambdaQueryWrapper就好了。</li></ul><p><span style="color:blue">条件构造器的官方文档：</span><a href="https://baomidou.com/pages/10c804/#abstractwrapper">条件构造器</a></p><h2 id="2-QueryWrapper"><a href="#2-QueryWrapper" class="headerlink" title="2.QueryWrapper"></a>2.QueryWrapper</h2><blockquote><p>基本除了增操作以为都可以实现。因为增根本就没有使用Wrapper，不需要。</p></blockquote><ul><li><p><strong>组装查询条件</strong></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid <span class="keyword">AS</span> id,username <span class="keyword">AS</span> name,age,email,is_deleted <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> (username <span class="keyword">LIKE</span> ? <span class="keyword">AND</span> age <span class="keyword">BETWEEN</span> ? <span class="keyword">AND</span> ? <span class="keyword">AND</span> email <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br></pre></td></tr></table></figure><p>注意条件中的is_deleted=0,这里时前面实现的逻辑删除</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//查询用户名包含a，年龄在20到30之间，邮箱信息不为null的用户信息</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).between(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>,<span class="number">30</span>).isNotNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以选择使用链式调用，也可以不使用。更具方法名可以见名知意，一般第一个参数都是字段名，后面的参数为值之类的。</p></li><li><p><strong>组装排序条件</strong></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid <span class="keyword">AS</span> id,username <span class="keyword">AS</span> name,age,email,is_deleted <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">DESC</span>,id <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//查询用户信息，按照年龄的降序排序，若年龄相同，则按照id升序排序</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;age&quot;</span>).orderByAsc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>组装删除条件</strong></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> is_deleted<span class="operator">=</span><span class="number">1</span> <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> (email <span class="keyword">IS</span> <span class="keyword">NULL</span>)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//删除邮箱地址为null的用户信息</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.isNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.delete(queryWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;删除成功！&quot;</span> : <span class="string">&quot;删除失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>条件的优先级</strong></p><p>主要是<code>and()</code>和<code>or()</code>方法，这两个方法可以实现“给条件加括号”操作，它们两个的参数都是消费性接口。</p><p>同时这里也演示了修改操作，但是这样需要先创建实体类，有些麻烦，所以修改最好还是使用UpdateWrapper，详细操作看：<a href="#3.UpdateWrapper">3.UpdateWrapper</a></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> user_name<span class="operator">=</span>?, email<span class="operator">=</span>? <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> (age <span class="operator">&gt;</span> ? <span class="keyword">AND</span> user_name <span class="keyword">LIKE</span> ? <span class="keyword">OR</span> email <span class="keyword">IS</span> <span class="keyword">NULL</span>)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//将（年龄大于20并且用户名中包含有a） 或 邮箱为null的用户信息修改</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.gt(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>).like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).or().isNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;zyr&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;test@zyr6.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(user, updateWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;修改成功！&quot;</span> : <span class="string">&quot;修改失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> username<span class="operator">=</span>?, email<span class="operator">=</span>? <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> (username <span class="keyword">LIKE</span> ? <span class="keyword">AND</span> (age <span class="operator">&gt;</span> ? <span class="keyword">OR</span> email <span class="keyword">IS</span> <span class="keyword">NULL</span>))</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//将用户名中包含有a并且（年龄大于20或邮箱为null）的用户信息修改</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;a&quot;</span>).and(i-&gt;i.gt(<span class="string">&quot;age&quot;</span>,<span class="number">20</span>).or().isNull(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">    <span class="comment">// and()中的参数为消费性接口（使用lambda表达式）；or()也是。</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;zyr7797&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;test@ss8o.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(user, updateWrapper);</span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;修改成功！&quot;</span> : <span class="string">&quot;修改失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>组装select子句</strong></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username,age,email <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//查询用户的用户名、年龄、邮箱信息</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.select(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(queryWrapper);</span><br><span class="line">    maps.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>实现子查询</strong></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid <span class="keyword">AS</span> id,user_name <span class="keyword">AS</span> name,age,email,is_deleted <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> (uid <span class="keyword">IN</span> (<span class="keyword">select</span> uid <span class="keyword">from</span> t_user <span class="keyword">where</span> uid <span class="operator">&lt;=</span> <span class="number">100</span>))</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 查询id小于等于100的用户信息</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.inSql(<span class="string">&quot;uid&quot;</span>, <span class="string">&quot;select uid from t_user where uid &lt;= 100&quot;</span>);</span><br><span class="line">    <span class="comment">// 第一个参数为字段名,第二个参数为第一次分布查询的结果（临时表）</span></span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要用于单表的自链接。先查出一张临时表（<code>select uid from t_user where uid &lt;= 100</code>）再在其中查。当然这道题其实不用这样写（这样只是方便演示）。如下写效果一样：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 查询id小于等于100的用户信息</span></span><br><span class="line">    <span class="comment">// SELECT name,age,email FROM User WHERE (id &lt;= ?)</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.select(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;email&quot;</span>).le(<span class="string">&quot;id&quot;</span>, <span class="number">100</span>);</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(queryWrapper);</span><br><span class="line">    maps.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-UpdateWrapper"><a href="#3-UpdateWrapper" class="headerlink" title="3.UpdateWrapper"></a>3.UpdateWrapper</h2><blockquote><p>UpdateWrapper不仅拥有QueryWrapper的组装条件功能，还提供了set方法进行修改对应条件的数据库信息</p><p><code>set()</code>方法的第一个参数表示要修改的字段名，第二个参数表示修改后的值。也是支持链式操作。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//将用户名中包含有a并且（年龄大于20或邮箱为null）的用户信息修改</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/*updateWrapper.like(&quot;username&quot;,&quot;a&quot;).and(i-&gt;i.gt(&quot;age&quot;,20).or().isNull(&quot;email&quot;))</span></span><br><span class="line"><span class="comment">         .set(&quot;email&quot;,&quot;svip@qq.com&quot;);  */</span></span><br><span class="line">    updateWrapper.like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;a&quot;</span>).and(qw -&gt; qw.ge(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>).or(l -&gt; l.isNull(<span class="string">&quot;email&quot;</span>)))</span><br><span class="line">                .set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小黑&quot;</span>).set(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;abc@Gmail.com&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(<span class="literal">null</span>, updateWrapper);</span><br><span class="line">    <span class="comment">//注意第一个参数表示修改后的实体类，使用UpdateWrapper时可以直接设置为null；</span></span><br><span class="line">    </span><br><span class="line">    System.out.println(result &gt; <span class="number">0</span> ? <span class="string">&quot;修改成功！&quot;</span> : <span class="string">&quot;修改失败！&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;受影响的行数为：&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-condition"><a href="#4-condition" class="headerlink" title="4.condition"></a>4.condition</h2><blockquote><p>在真正开发的过程中，组装条件是常见的功能，而这些条件数据来源于用户输入，是可选的，因此我们在组装这些条件时，必须先判断用户是否选择了这些条件，若选择则需要组装该条件，若没有选择则一定不能组装，以免影响SQL执行的结果</p></blockquote><ul><li><p><strong>思路一</strong></p><blockquote><p><strong>执行SQL：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid <span class="keyword">AS</span> id,user_name <span class="keyword">AS</span> name,age,email,is_deleted <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> is_deleted<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> (user_name <span class="keyword">LIKE</span> ? <span class="keyword">AND</span> age <span class="operator">&lt;=</span> ?)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageBegin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageEnd</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isNotBlank(username))&#123;</span><br><span class="line">        <span class="comment">//isNotBlank判断某个字符创是否不为空字符串、不为null、不为空白符</span></span><br><span class="line">        queryWrapper.like(<span class="string">&quot;user_name&quot;</span>, username);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ageBegin != <span class="literal">null</span>)&#123;</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;age&quot;</span>, ageBegin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ageEnd != <span class="literal">null</span>)&#123;</span><br><span class="line">        queryWrapper.le(<span class="string">&quot;age&quot;</span>, ageEnd);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>思路二</strong></p><blockquote><p>上面的实现方案没有问题，但是代码比较复杂，我们可以使用带condition参数的重载方法构建查询条件，简化代码的编写</p><p>和原本的编写代码并无多少区别，唯一的区别在于使用了另外的重载方法，在之前的参数前添加了一个判断是否组装的前置条件</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageBegin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageEnd</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotBlank(username), <span class="string">&quot;user_name&quot;</span>, username)</span><br><span class="line">        .ge(ageBegin != <span class="literal">null</span>, <span class="string">&quot;age&quot;</span>, ageBegin)</span><br><span class="line">        .le(ageEnd != <span class="literal">null</span>, <span class="string">&quot;age&quot;</span>, ageEnd);</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5-LambdaQueryWrapper"><a href="#5-LambdaQueryWrapper" class="headerlink" title="5.LambdaQueryWrapper"></a>5.LambdaQueryWrapper</h2><blockquote><p>功能等同于QueryWrapper，提供了Lambda表达式的语法可以避免填错列名。</p><p>前提是需要提前在实体类的属性前面标记好<code>@TableFiled</code></p><p><strong>注意</strong></p><p>​    使用了LambdaQueryWrapper之后就不能再使用字符串作为字段名了，只能使用 实体类：：属性名</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test11</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageBegin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ageEnd</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotBlank(username), User::getName, username)</span><br><span class="line">        .ge(ageBegin != <span class="literal">null</span>, User::getAge, ageBegin)</span><br><span class="line">        .le(ageEnd != <span class="literal">null</span>, User::getAge, ageEnd);</span><br><span class="line">    List&lt;User&gt; list = userMapper.selectList(queryWrapper);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-LambdaUpdateWrapper"><a href="#6-LambdaUpdateWrapper" class="headerlink" title="6.LambdaUpdateWrapper"></a>6.LambdaUpdateWrapper</h2><blockquote><p>功能等同于UpdateWrapper，提供了Lambda表达式的语法可以避免填错列名。</p><p><strong>注意</strong></p><p>​    使用了LambdaQueryWrapper之后就不能再使用字符串作为字段名了，只能使用 实体类：：属性名</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test12</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//将用户名中包含有a并且（年龄大于20或邮箱为null）的用户信息修改</span></span><br><span class="line">    LambdaUpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.like(User::getName, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">        .and(i -&gt; i.gt(User::getAge, <span class="number">20</span>).or().isNull(User::getEmail));</span><br><span class="line">    updateWrapper.set(User::getName, <span class="string">&quot;小黑&quot;</span>).set(User::getEmail,<span class="string">&quot;abc@atguigu.com&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.update(<span class="literal">null</span>, updateWrapper);</span><br><span class="line">    System.out.println(<span class="string">&quot;result：&quot;</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="六、常用插件"><a href="#六、常用插件" class="headerlink" title="六、常用插件"></a>六、常用插件</h1><h2 id="1-分页插件"><a href="#1-分页插件" class="headerlink" title="1.分页插件"></a>1.分页插件</h2><blockquote><p>MyBatis Plus自带分页插件，只要简单的配置即可实现分页功能</p></blockquote><ul><li><p><strong>添加配置类<code>MyBatisPlusConfig</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="comment">//注意声明为配置类</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.zhang.mybatisplus01.mapper&quot;)</span><span class="comment">//写有mybatisplus的配置类时就可以将主程序上的这个注解写到这里来了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;<span class="comment">// 返回的是MyBatisPlus的拦截器对象，这个对象是专门用来配置插件的</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//添加分页插件</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));<span class="comment">//添加分页插件，注意分页插件中要配置对应数据库，使用的是DbType枚举类的枚举常量MYSQL</span></span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>编写测试方法</strong></p><ol><li><p>先创建分页的对象Page（实现的IPage）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Page&lt;User&gt; userPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;User&gt;();<span class="comment">//泛型类型为实体类类型</span></span><br></pre></td></tr></table></figure><p>构造器参数：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220715155432733.png" alt="image-20220715155432733" style="zoom:80%;" /></p><ul><li><code>current</code>：当前查询的页数</li><li><code>size</code>：每页展示的内容条数</li><li><code>total</code>：最大显示总条数</li><li><code>searchCount</code>：是否查询所有</li></ul><p>默认情况：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220715155840099.png" alt="image-20220715155840099" style="zoom:80%;" /></p><p>默认开启searchCount会查询到所有数据。开启和不开启可以自行选择，看对前后端要求情况，是一种时间和空间的选择。开启会节约时间，浪费空间（一次查询所有数据之后截取展示，之后再查就不用再执行sql而是直接调用第一次查询的数据，而其他数据就需要有空间储存）；不开启会浪费时间，节约空间（每次需要查看其他页的数据就需要再调用一次sql）。</p><p>一般可能会关闭。</p></li><li><p>使用Mapper接口自带的<code>selectPage()</code>方法或者<code>selectMapsPage()</code>方法，选择原则是需要的返回值是List还是Map，其他没有区别。两者的第一个参数为Page对象，第二个参数为Wrapper。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userMapper.selectPage(userPage,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure></li><li><p>完整代码为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPage</span><span class="params">()</span>&#123;</span><br><span class="line">    Page&lt;User&gt; userPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;User&gt;(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    userMapper.selectPage(userPage,<span class="literal">null</span>);<span class="comment">//可以看出实际上修改的是userPage对象，查询后的数据在userPage中</span></span><br><span class="line">    List&lt;User&gt; users = userPage.getRecords();</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>执行sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,age,email <span class="keyword">FROM</span> <span class="keyword">User</span> LIMIT ?</span><br></pre></td></tr></table></figure><p>Parameters: 2(Long)</p></blockquote><p>也可以为： </p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPage</span><span class="params">()</span>&#123;</span><br><span class="line">    Page&lt;User&gt; page = userMapper.selectPage(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>), <span class="literal">null</span>);</span><br><span class="line">    List&lt;User&gt; users = page.getRecords();</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行sql语句和上一种方式一样。</p></li></ol></li></ul><h3 id="Page对象的常用方法"><a href="#Page对象的常用方法" class="headerlink" title="Page对象的常用方法"></a>Page对象的常用方法</h3><ul><li><code>getRecords()</code>：获取当前页的数据</li><li><code>getCurrent()</code>：获取当前页的页码</li><li><code>getSize()</code>：获取当前页的信息条数</li><li><code>getPages()</code>：获取总页数</li><li><code>getTotal()</code>：获取总记录数</li><li><code>hasNext()</code>：是否有下一页</li><li><code>hasPrevious()</code>：是否有上一页</li><li><code>addOrder()</code>：添加排序规则，和QueryWrapper的使用和功能都一样</li></ul><h2 id="2-自定义分页"><a href="#2-自定义分页" class="headerlink" title="2.自定义分页"></a>2.自定义分页</h2><blockquote><p>上面调用的是MyBatis-Plus提供的带有分页的方法，那么我们自己定义的方法如何实现分页呢？</p></blockquote><ul><li><p><strong>在<code>UserMapper</code>接口中定义一个方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据年龄查询用户列表，分页显示 </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> page 分页对象,xml中可以从里面进行取值,传递参数 Page 即自动分页,必须放在第一位 </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> age 年龄 </span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">Page&lt;User&gt; <span class="title function_">selectPageVo</span><span class="params">(<span class="meta">@Param(&quot;page&quot;)</span> Page&lt;User&gt; page,<span class="meta">@Param(&quot;age&quot;)</span> Integer age)</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>在<code>UserMapper.xml</code>中编写SQL实现该方法</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPageVo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select id,username as name,age,email from t_user where age &gt; #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意这里是的sql语句是没有limit的，因为分页体现在方法的page参数上了。</p></li><li><p><strong>编写测试方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageVo</span><span class="params">()</span>&#123;</span><br><span class="line">    Page&lt;User&gt; page = userMapper.selectPageVo(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;User&gt;(<span class="number">1</span>,<span class="number">2</span>), <span class="number">20</span>);</span><br><span class="line">    List&lt;User&gt; users = page.getRecords();</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际执行sql语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> total <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> ?;# 先自动执行了这条<span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">select</span> id,username <span class="keyword">as</span> name,age,email <span class="keyword">from</span> t_user <span class="keyword">where</span> age <span class="operator">&gt;</span> ? limit ?#自动在自己写的<span class="keyword">sql</span>语句后面加上了limit</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-乐观锁"><a href="#3-乐观锁" class="headerlink" title="3.乐观锁"></a>3.乐观锁</h2><blockquote><p><strong>作用：当要更新一条记录的时候，希望这条记录没有被别人更新</strong></p></blockquote><p>乐观锁的实现方式：</p><ul><li>取出记录时，获取当前 version（注意version是表中的字段，其实和逻辑删除类似）</li><li>更新时，带上这个 version</li><li><p>执行更新时， set version = newVersion where version = oldVersion</p><ul><li>version = oldaVersion表示没有有修改，版本没有改变</li></ul></li><li><p>如果 version 不对，就重新获取新的版本的数据修改</p></li></ul><h3 id="3-1-场景"><a href="#3-1-场景" class="headerlink" title="3.1 场景"></a>3.1 场景</h3><ul><li>一件商品，成本价是80元，售价是100元。老板先是通知小李，说你去把商品价格增加50元。小李正在玩游戏，耽搁了一个小时。正好一个小时后，老板觉得商品价格增加到150元，价格太高，可能会影响销量。又通知小王，你把商品价格降低30元。</li><li>此时，小李和小王同时操作商品后台系统。小李操作的时候，系统先取出商品价格100元；小王也在操作，取出的商品价格也是100元。小李将价格加了50元，并将100+50=150元存入了数据库；小王将商品减了30元，并将100-30=70元存入了数据库。是的，如果没有锁，小李的操作就完全被小王的覆盖了。</li><li>现在商品价格是70元，比成本价低10元。几分钟后，这个商品很快出售了1千多件商品，老板亏1万多。</li></ul><h3 id="3-2-乐观锁与悲观锁"><a href="#3-2-乐观锁与悲观锁" class="headerlink" title="3.2 乐观锁与悲观锁"></a>3.2 乐观锁与悲观锁</h3><ul><li>上面的故事，如果是乐观锁，小王保存价格前，会检查下价格是否被人修改过了。如果被修改过了，则重新取出的被修改后的价格，150元，这样他会将120元存入数据库。</li><li>如果是悲观锁，小李取出数据后，小王只能等小李操作完之后，才能对价格进行操作，也会保证最终的价格是120元。</li></ul><h3 id="3-3-模拟修改冲突"><a href="#3-3-模拟修改冲突" class="headerlink" title="3.3 模拟修改冲突"></a>3.3 模拟修改冲突</h3><ul><li><p><strong>数据库中增加商品表</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product ( </span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>, </span><br><span class="line">    NAME <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>, </span><br><span class="line">    price <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;价格&#x27;</span>, </span><br><span class="line">    VERSION <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;乐观锁版本号&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p><strong>添加一条数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_product (id, NAME, price) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;外星人笔记本&#x27;</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>添加一个实体类<code>Product</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer version;<span class="comment">//注意一开始写的大写（和数据库的字段名匹配）会报错，用小写就不会报错（因为sql语句的执行会自动将字段名转换为小写执行，所有以后都要注意是小写属性名）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>添加一个Mapper接口<code>ProductMapper</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>测试方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProduct01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.小李获取商品价格</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productLi</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;小李获取的商品价格为：&quot;</span> + productLi.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.小王获取商品价格</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productWang</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;小李获取的商品价格为：&quot;</span> + productWang.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.小李修改商品价格+50</span></span><br><span class="line">    productLi.setPrice(productLi.getPrice()+<span class="number">50</span>);</span><br><span class="line">    productMapper.updateById(productLi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.小王修改商品价格-30</span></span><br><span class="line">    productWang.setPrice(productWang.getPrice()-<span class="number">30</span>);</span><br><span class="line">    productMapper.updateById(productWang);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.老板查询商品价格</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productBoss</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;老板获取的商品价格为：&quot;</span> + productBoss.getPrice());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>执行结果</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521225803162.png" alt="image-20220521225803162"></p></li></ul><h3 id="3-4-乐观锁解决问题"><a href="#3-4-乐观锁解决问题" class="headerlink" title="3.4 乐观锁解决问题"></a>3.4 乐观锁解决问题</h3><ul><li><p><strong>实体类<code>version</code>字段添加注解<code>@Version</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>添加乐观锁插件配置</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    <span class="comment">//添加分页插件</span></span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line">    <span class="comment">//添加乐观锁插件</span></span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>再次执行测试方法</strong></p><blockquote><p>小李查询商品信息：</p><p>​    SELECT id,name,price,version FROM t_product WHERE id=?</p><p>小王查询商品信息：</p><p>​    SELECT id,name,price,version FROM t_product WHERE id=?</p><p>小李修改商品价格，自动将version+1</p><p>​    UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=?</p><p>​    Parameters: 外星人笔记本(String), 150(Integer), 1(Integer), 1(Long), 0(Integer)</p><p>小王修改商品价格，此时version已更新，条件不成立，修改失败</p><p>​    UPDATE t_product SET name=?, price=?, version=? WHERE id=? AND version=?</p><p>​    Parameters: 外星人笔记本(String), 70(Integer), 1(Integer), 1(Long), 0(Integer)</p><p>最终，小王修改失败，查询价格：150</p><p>​    SELECT id,name,price,version FROM t_product WHERE id=?</p></blockquote></li><li><p><strong>优化执行流程</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProduct01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.小李获取商品价格</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productLi</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;小李获取的商品价格为：&quot;</span> + productLi.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.小王获取商品价格</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productWang</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;小李获取的商品价格为：&quot;</span> + productWang.getPrice());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.小李修改商品价格+50</span></span><br><span class="line">    productLi.setPrice(productLi.getPrice()+<span class="number">50</span>);</span><br><span class="line">    productMapper.updateById(productLi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.小王修改商品价格-30</span></span><br><span class="line">    productWang.setPrice(productWang.getPrice()-<span class="number">30</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> productMapper.updateById(productWang);</span><br><span class="line">    <span class="keyword">if</span>(result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//操作失败，重试</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">productNew</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">        productNew.setPrice(productNew.getPrice()-<span class="number">30</span>);</span><br><span class="line">        productMapper.updateById(productNew);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.老板查询商品价格</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">productBoss</span> <span class="operator">=</span> productMapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;老板获取的商品价格为：&quot;</span> + productBoss.getPrice());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521230448577.png" alt="image-20220521230448577"></p></li></ul><h1 id="七、通用枚举"><a href="#七、通用枚举" class="headerlink" title="七、通用枚举"></a>七、通用枚举</h1><blockquote><p>表中的有些字段值是固定的，例如性别（男或女），此时我们可以使用MyBatis-Plus的通用枚举来实现</p></blockquote><ul><li><p><strong>数据库表添加字段<code>sex</code></strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220521231317777.png" alt="image-20220521231317777"></p></li><li><p><strong>创建通用枚举类型</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">SexEnum</span> &#123;</span><br><span class="line">    MALE(<span class="number">1</span>, <span class="string">&quot;男&quot;</span>),</span><br><span class="line">    FEMALE(<span class="number">2</span>, <span class="string">&quot;女&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span> <span class="comment">//将注解所标识的属性的值存储到数据库中</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> sex;</span><br><span class="line">    <span class="keyword">private</span> String sexName;</span><br><span class="line"></span><br><span class="line">    SexEnum(Integer sex, String sexName) &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">        <span class="built_in">this</span>.sexName = sexName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>User实体类中添加属性sex</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> isDeleted;  <span class="comment">//逻辑删除</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SexEnum sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>配置扫描通用枚举</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MyBatis-Plus相关配置</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment">#指定mapper文件所在的地址</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#配置日志</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">banner:</span> <span class="string">off</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#配置mp的主键策略为自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="comment"># 设置实体类所对应的表的统一前缀</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">t_</span></span><br><span class="line">  <span class="comment">#配置类型别名所对应的包</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.atguigu.mybatisplus.pojo</span></span><br><span class="line">  <span class="comment"># 扫描通用枚举的包</span></span><br><span class="line">  <span class="attr">type-enums-package:</span> <span class="string">com.atguigu.mybatisplus.enums</span></span><br></pre></td></tr></table></figure></li><li><p><strong>执行测试方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setName(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">33</span>);</span><br><span class="line">    user.setSex(SexEnum.MALE);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.insert(user);</span><br><span class="line">    System.out.println(<span class="string">&quot;result:&quot;</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>如果没有设置通用枚举就只能<code>SexEnum.MALE.getSex()</code>。</p><h1 id="八、代码生成器"><a href="#八、代码生成器" class="headerlink" title="八、代码生成器"></a>八、代码生成器</h1><h2 id="1、引入依赖"><a href="#1、引入依赖" class="headerlink" title="1、引入依赖"></a>1、引入依赖</h2><p>在pom.xml中引入依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span><span class="comment">&lt;!-- 以为会使用Freemarker引擎模板 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">&lt;/dependency</span><br></pre></td></tr></table></figure><h2 id="2、快速生成"><a href="#2、快速生成" class="headerlink" title="2、快速生成"></a>2、快速生成</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastAutoGeneratorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">FastAutoGenerator.create(<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mybatis_plus?</span></span><br><span class="line"><span class="string">        characterEncoding=utf-8&amp;userSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>)</span><br><span class="line">        .globalConfig(builder -&gt; &#123;</span><br><span class="line">        builder.author(<span class="string">&quot;zhang&quot;</span>) <span class="comment">// 设置作者</span></span><br><span class="line">        <span class="comment">//.enableSwagger() // 开启 swagger 模式</span></span><br><span class="line">       .fileOverride() <span class="comment">// 覆盖已生成文件</span></span><br><span class="line">        .outputDir(<span class="string">&quot;D://mybatis_plus&quot;</span>); <span class="comment">// 指定输出目录</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .packageConfig(builder -&gt; &#123;</span><br><span class="line">        builder.parent(<span class="string">&quot;com.zhang&quot;</span>) <span class="comment">// 设置父包名</span></span><br><span class="line">        .moduleName(<span class="string">&quot;mybatisplus&quot;</span>) <span class="comment">// 设置父包模块名</span></span><br><span class="line">        .pathInfo(Collections.singletonMap(OutputFile.mapperXml, <span class="string">&quot;D://mybatis_plus&quot;</span>));</span><br><span class="line">        <span class="comment">// 设置mapperXml生成路径</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .strategyConfig(builder -&gt; &#123;</span><br><span class="line">       builder.addInclude(<span class="string">&quot;t_user&quot;</span>) <span class="comment">// 设置需要生成的表名</span></span><br><span class="line">        .addTablePrefix(<span class="string">&quot;t_&quot;</span>, <span class="string">&quot;c_&quot;</span>); <span class="comment">// 设置过滤表前缀</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .templateEngine(<span class="keyword">new</span> <span class="title class_">FreemarkerTemplateEngine</span>()) <span class="comment">// 使用Freemarker引擎模板，默认的是Velocity引擎模板</span></span><br><span class="line">        .execute();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="九、多数据源"><a href="#九、多数据源" class="headerlink" title="九、多数据源"></a>九、多数据源</h1><blockquote><p>适用于多种场景：纯粹多库、 读写分离、 一主多从、 混合模式等</p></blockquote><p>场景说明：</p><p>我们创建两个库，分别为：<code>mybatis_plus</code>（以前的库不动）与<code>mybatis_plus_1</code>（新建），将mybatis_plus库的<code>product</code>表移动到mybatis_plus_1库，这样每个库一张表，通过一个测试用例分别获取用户数据与商品数据，如果获取到说明多库模拟成功。</p><h2 id="1-创建数据库及表"><a href="#1-创建数据库及表" class="headerlink" title="1.创建数据库及表"></a>1.创建数据库及表</h2><ul><li><p><strong>创建数据库<code>mybatis_plus_1</code>和表`product</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `mybatis_plus_1` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 */</span>;</span><br><span class="line">use `mybatis_plus_1`; </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product ( </span><br><span class="line">    id <span class="type">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>, </span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>, </span><br><span class="line">    price <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;价格&#x27;</span>, </span><br><span class="line">    version <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;乐观锁版本号&#x27;</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p><strong>添加测试数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> product (id, NAME, price) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;外星人笔记本&#x27;</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure></li><li><p><strong>删除<code>mybatis_plus</code>库中的<code>product</code>表</strong> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mybatis_plus; </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> product;</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-新建工程引入依赖"><a href="#2-新建工程引入依赖" class="headerlink" title="2.新建工程引入依赖"></a>2.新建工程引入依赖</h2><blockquote><p><strong>自行新建一个Spring Boot工程并选择MySQL驱动及Lombok依赖</strong></p></blockquote><p><strong>引入MyBaits-Plus的依赖及多数据源的依赖</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-编写配置文件"><a href="#3-编写配置文件" class="headerlink" title="3.编写配置文件"></a>3.编写配置文件</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># 配置数据源信息</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">dynamic:</span></span><br><span class="line">      <span class="comment"># 设置默认的数据源或者数据源组,默认值即为master</span></span><br><span class="line">      <span class="attr">primary:</span> <span class="string">master</span> <span class="comment"># 下面的datasource的配置中的第一个就是master，就是这样对应的</span></span><br><span class="line">      <span class="comment"># 严格匹配数据源,默认false，如果为true则未匹配到指定数据源时抛异常,false使用默认数据源</span></span><br><span class="line">      <span class="attr">strict:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">master:</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">        <span class="attr">slave_1:</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus_1?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><h2 id="4-创建实体类"><a href="#4-创建实体类" class="headerlink" title="4.创建实体类"></a>4.创建实体类</h2><ul><li><p>新建一个<code>User</code>实体类（如果数据库表名有t_前缀记得配置）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建一个实体类<code>Product</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5-创建Mapper及Service"><a href="#5-创建Mapper及Service" class="headerlink" title="5.创建Mapper及Service"></a>5.创建Mapper及Service</h2><ul><li><p>新建接口<code>UserMapper</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建接口<code>ProductMapper</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建Service接口<code>UserService</code>指定操作的数据源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DS(&quot;master&quot;)</span> <span class="comment">//指定操作的数据源，master为user表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建Service接口<code>ProductService</code>指定操作的数据源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DS(&quot;slave_1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Product&gt; &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>自行建立Service的实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><h2 id="6-编写测试方法"><a href="#6-编写测试方法" class="headerlink" title="6.编写测试方法"></a>6.编写测试方法</h2><blockquote><p><strong>记得在启动类中添加注解<code>@MapperScan()</code></strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestDatasourceApplicationTests</span> &#123;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">ProductService productService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(<span class="number">1L</span>);</span><br><span class="line"><span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.getById(<span class="number">1L</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;User = &quot;</span> + user);</span><br><span class="line">System.out.println(<span class="string">&quot;Product = &quot;</span> + product);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522113049945.png" alt="image-20220522113049945"></p><h1 id="十、MyBatisX插件"><a href="#十、MyBatisX插件" class="headerlink" title="十、MyBatisX插件"></a>十、MyBatisX插件</h1><blockquote><p>MyBatis-Plus为我们提供了强大的mapper和service模板，能够大大的提高开发效率。</p><p>但是在真正开发过程中，MyBatis-Plus并不能为我们解决所有问题，例如一些复杂的SQL，多表联查，我们就需要自己去编写代码和SQL语句，我们该如何快速的解决这个问题呢，这个时候可以使用MyBatisX插件。</p><p>MyBatisX一款基于 IDEA 的快速开发插件，为效率而生。</p></blockquote><h2 id="1-安装MyBatisX插件"><a href="#1-安装MyBatisX插件" class="headerlink" title="1.安装MyBatisX插件"></a>1.安装MyBatisX插件</h2><blockquote><p><strong>打开IDEA，File-&gt; Setteings-&gt;Plugins-&gt;MyBatisX，搜索栏搜索MyBatisX然后安装。</strong></p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522115718361.png" alt="image-20220522115718361"></p><h2 id="2-快速生成代码"><a href="#2-快速生成代码" class="headerlink" title="2.快速生成代码"></a>2.快速生成代码</h2><ul><li><p>新建一个Spring Boot项目引入依赖（创建工程时记得勾选lombok及mysql驱动）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dynamic-datasource-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置数据源信息</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_plus?characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">132537</span></span><br></pre></td></tr></table></figure></li><li><p>在IDEA中与数据库建立链接</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522120758740.png" alt="image-20220522120758740"></p></li><li><p>填写数据库信息并保存</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522121434468.png" alt="image-20220522121434468"></p></li><li><p>找到我们需要生成的表点击右键</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522121613909.png" alt="image-20220522121613909"></p></li><li><p>填写完信息以后下一步</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522122127649.png" alt="image-20220522122127649"></p><p>解释：</p><ol><li>module path：如果一个项目中有多个模块时需要选择，IDEA会提示。比如为了study，创建了mybatisplus01模块，现在测试MybatisX插件创建mybatisplus02模块，时就需要选择mybatisplus02模块。</li><li>base.package：写自己的包名，创建时的项目包名，例如这时候就是：com.zhang.mybatisplus02</li><li>encoding：编码格式，默认为UTF-8,一般不用修改</li><li>superClass：父类，没有就不用写</li><li>base path：基础路径，一般也不用改，默认为src/main/java</li><li>relative pakage：实体类所在包的包名：比如我喜欢entity就是entity，默认是domain，可以选择不修改。</li><li>ignore field prefix（suffix）：忽略字段的前缀（后缀）生成实体类属性（会自动添加<code>@TableFiled</code>注解），在这张表都统一使用了某个前缀（后缀）时填写该前缀（后缀）。例如，一个student表中的所有数据都是1<code>_id</code>,<code>s_name</code>等以<code>s_</code>为前缀开头的字段时可以将<code>s_</code>写在框中。方便对应字段间关系。</li><li>ignore table prefix（suffix）：与上面的字段差不多意思。方便对应表名与实体类关系。比如这里这个表叫作<code>t_user</code>,就需要在ignore table prefix中写<code>t_</code>，上面截屏时已经写了<code>t_</code>了，如果没写在className一栏中就不是User而是TPUser。</li><li>extra class suffix：额外的类的后缀，一般不用</li></ol></li><li><p>继续填写信息</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522122525598.png" alt="image-20220522122525598"></p><ul><li>一般都是按上面的选，注意检查下面的生成文件的路径。</li></ul></li><li><p><strong>大功告成（注意逻辑删除和乐观锁的版本号等某些注解需要自己添加）</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522122612334.png" alt="image-20220522122612334"></p></li></ul><h2 id="3-快速生成CRUD"><a href="#3-快速生成CRUD" class="headerlink" title="3.快速生成CRUD"></a>3.快速生成CRUD</h2><blockquote><p>MyBaitsX可以根据我们在Mapper接口中输入的方法名快速帮我们生成对应的sql语句</p><p><strong>方法一定要见名知意，不然MyBatisPlus不知道如何生成，固定的开头</strong></p><ul><li>增：insert</li><li>删：delete</li><li>改：update</li><li>查：select</li></ul></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522123143852.png" alt="image-20220522123143852"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image-bed-vz.oss-cn-hangzhou.aliyuncs.com/MyBatis-Plus/image-20220522123202310.png" alt="image-20220522123202310"></p><p>也可以多个条件执行：例如：<code>deleteByIdAndName</code>可以用And连接</p><p>select也很方便，</p><ul><li><p>如：<code>selectPriceByPriceBetween</code></p><p>生成：<code>List&lt;Product&gt; selectPriceByPriceBetween(@Param(&quot;beginPrice&quot;) Integer beginPrice, @Param(&quot;endPrice&quot;) Integer endPrice);</code></p></li><li><p>如:<code>selectAllOrderByPriceDesc</code></p><p>生成：<code>List&lt;Product&gt; selectAllOrderByPriceDesc();</code></p></li></ul><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="https://baomidou.com/pages/ba5b24/">MyBatisX插件用法</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis</title>
      <link href="/posts/469711973.html"/>
      <url>/posts/469711973.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、Mybatis简介"><a href="#一、Mybatis简介" class="headerlink" title="一、Mybatis简介"></a>一、Mybatis简介</h1><h2 id="1、MyBatis历史"><a href="#1、MyBatis历史" class="headerlink" title="1、MyBatis历史"></a>1、MyBatis历史</h2><ul><li>MyBatis最初是Apache的一个开源项目iBatis, 2010年6月这个项目由Apache Software Foundation迁移到了Google Code。随着开发团队转投Google Code旗下，iBatis3.x正式更名为MyBatis。代码于2013年11月迁移到Github</li><li>iBatis一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。iBatis提供的持久层框架包括SQL Maps和Data Access Objects（DAO）<h2 id="2、MyBatis特性"><a href="#2、MyBatis特性" class="headerlink" title="2、MyBatis特性"></a>2、MyBatis特性</h2></li></ul><ol><li>MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架</li><li>MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集</li><li>MyBatis可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（Plain Old Java Objects，普通的Java对象）映射成数据库中的记录</li><li>MyBatis 是一个 半自动的ORM（Object Relation Mapping）框架<h2 id="3、MyBatis下载"><a href="#3、MyBatis下载" class="headerlink" title="3、MyBatis下载"></a>3、MyBatis下载</h2></li></ol><ul><li><a href="https://github.com/mybatis/mybatis-3">MyBatis下载地址</a></li><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/MyBatis%E4%B8%8B%E8%BD%BD.png" alt=""><h2 id="4、和其它持久化层技术对比"><a href="#4、和其它持久化层技术对比" class="headerlink" title="4、和其它持久化层技术对比"></a>4、和其它持久化层技术对比</h2></li><li>JDBC  <ul><li>SQL 夹杂在Java代码中耦合度高，导致硬编码内伤  </li><li>维护不易且实际开发需求中 SQL 有变化，频繁修改的情况多见  </li><li>代码冗长，开发效率低</li></ul></li><li>Hibernate 和 JPA<ul><li>操作简便，开发效率高  </li><li>程序中的长难复杂 SQL 需要绕过框架  </li><li>内部自动生产的 SQL，不容易做特殊优化  </li><li>基于全映射的全自动框架，大量字段的 POJO 进行部分映射时比较困难。  </li><li>反射操作太多，导致数据库性能下降</li></ul></li><li>MyBatis<ul><li>轻量级，性能出色  </li><li>SQL 和 Java 编码分开，功能边界清晰。Java代码专注业务、SQL语句专注数据  </li><li>开发效率稍逊于HIbernate，但是完全能够接受<h1 id="二、搭建MyBatis"><a href="#二、搭建MyBatis" class="headerlink" title="二、搭建MyBatis"></a>二、搭建MyBatis</h1><h2 id="1、开发环境"><a href="#1、开发环境" class="headerlink" title="1、开发环境"></a>1、开发环境</h2></li></ul></li><li>IDE：idea 2022.2  </li><li>构建工具：maven 3.6.3  </li><li>MySQL版本：MySQL 5.7  </li><li>MyBatis版本：MyBatis 3.5.7<h2 id="2、创建maven工程"><a href="#2、创建maven工程" class="headerlink" title="2、创建maven工程"></a>2、创建maven工程</h2><h3 id="a-gt-打包方式：jar"><a href="#a-gt-打包方式：jar" class="headerlink" title="a&gt;打包方式：jar"></a>a&gt;打包方式：jar</h3></li></ul><h3 id="b-gt-引入依赖"><a href="#b-gt-引入依赖" class="headerlink" title="b&gt;引入依赖"></a>b&gt;引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Mybatis核心 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- junit测试 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- MySQL驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3、创建MyBatis的核心配置文件"><a href="#3、创建MyBatis的核心配置文件" class="headerlink" title="3、创建MyBatis的核心配置文件"></a>3、创建MyBatis的核心配置文件</h2><blockquote><p>习惯上命名为<code>mybatis-config.xml</code>，这个文件名仅仅只是建议，并非强制要求。将来整合Spring之后，这个配置文件可以省略，所以大家操作时可以直接复制、粘贴。<br>核心配置文件主要用于配置连接数据库的环境以及MyBatis的全局配置信息<br>核心配置文件存放的位置是src/main/resources目录下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span>  </span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span>  </span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--设置连接数据库的环境--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/MyBatis&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span>  </span><br><span class="line"><span class="comment">&lt;!--引入映射文件--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="4、创建mapper接口"><a href="#4、创建mapper接口" class="headerlink" title="4、创建mapper接口"></a>4、创建mapper接口</h2><p>MyBatis中的mapper接口相当于以前的dao。但是区别在于，mapper仅仅是接口，我们不需要提供实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mybatis.mapper;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;  </span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* 添加用户信息  </span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"><span class="type">int</span> <span class="title function_">insertUser</span><span class="params">()</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="5、创建MyBatis的映射文件"><a href="#5、创建MyBatis的映射文件" class="headerlink" title="5、创建MyBatis的映射文件"></a>5、创建MyBatis的映射文件</h2><ul><li>相关概念：ORM（Object Relationship Mapping）对象关系映射。  <ul><li>对象：Java的实体类对象  </li><li>关系：关系型数据库  </li><li>映射：二者之间的对应关系</li></ul></li></ul></blockquote><div class="table-container"><table><thead><tr><th>Java概念</th><th>数据库概念</th></tr></thead><tbody><tr><td>类</td><td>表</td></tr><tr><td>属性</td><td>字段/列</td></tr><tr><td>对象</td><td>记录/行</td></tr></tbody></table></div><blockquote><p>1、映射文件的命名规则</p><p>表所对应的实体类的类名+Mapper.xml</p><p>例如：表t_user，映射的实体类为User，所对应的映射文件为UserMapper.xml </p><p>因此一个映射文件对应一个实体类，对应一张表的操作</p><p>MyBatis映射文件用于编写SQL，访问以及操作表中的数据</p><p>MyBatis映射文件存放的位置是src/main/resources/mappers目录下</p><p>2 、MyBatis中可以面向接口操作数据，要保证两个一致</p><p>a&gt; mapper接口的全类名和映射文件的命名空间（namespace）保持一致</p><p>b&gt; mapper接口中方法的方法名和映射文件中编写SQL的标签的id属性保持一致</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span>  </span></span><br><span class="line"><span class="meta"><span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>  </span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--int insertUser();--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span>  </span><br><span class="line">insert into t_user values(null,&#x27;张三&#x27;,&#x27;123&#x27;,23,&#x27;女&#x27;)  </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="6、通过junit测试功能"><a href="#6、通过junit测试功能" class="headerlink" title="6、通过junit测试功能"></a>6、通过junit测试功能</h2><ul><li>SqlSession：代表Java程序和数据库之间的会话。（HttpSession是Java程序和浏览器之间的会话）</li><li>SqlSessionFactory：是“生产”SqlSession的“工厂”</li><li>工厂模式：如果创建某一个对象，使用的过程基本固定，那么我们就可以把创建这个对象的相关代码封装到一个“工厂类”中，以后都使用这个工厂类来“生产”我们需要的对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertUser</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//读取MyBatis的核心配置文件</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取SqlSessionFactoryBuilder对象</span></span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">        <span class="comment">//通过核心配置文件所对应的字节输入流创建工厂类SqlSessionFactory，生产SqlSession对象</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line">        <span class="comment">//获取sqlSession，此时通过SqlSession对象所操作的sql都必须手动提交或回滚事务</span></span><br><span class="line">        <span class="comment">//SqlSession sqlSession = sqlSessionFactory.openSession();</span></span><br><span class="line">    <span class="comment">//创建SqlSession对象，此时通过SqlSession对象所操作的sql都会自动提交  </span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//通过代理模式创建UserMapper接口的代理实现类对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//调用UserMapper接口中的方法，就可以根据UserMapper的全类名匹配元素文件，通过调用的方法名匹配映射文件中的SQL标签，并执行标签中的SQL语句</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.insertUser();</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        <span class="comment">//sqlSession.commit();</span></span><br><span class="line">        System.out.println(<span class="string">&quot;result:&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>此时需要手动提交事务，如果要自动提交事务，则在获取sqlSession对象时，使用<code>SqlSession sqlSession = sqlSessionFactory.openSession(true);</code>，传入一个Boolean类型的参数，值为true，这样就可以自动提交<h2 id="7、加入log4j日志功能"><a href="#7、加入log4j日志功能" class="headerlink" title="7、加入log4j日志功能"></a>7、加入log4j日志功能</h2></li></ul><h3 id="a-gt-加入依赖"><a href="#a-gt-加入依赖" class="headerlink" title="a&gt;加入依赖"></a>a&gt;加入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- log4j日志 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="b-gt-加入log4j的配置文件"><a href="#b-gt-加入log4j的配置文件" class="headerlink" title="b&gt;加入log4j的配置文件"></a>b&gt;加入log4j的配置文件</h3><blockquote><p>log4j的配置文件名为log4j.xml，存放的位置是src/main/resources目录下</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">log4j</span>:configuration <span class="keyword">SYSTEM</span> <span class="string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%-5p %d&#123;MM-dd HH:mm:ss,SSS&#125; %m (%F:%L) \n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><span style="font-size:20px"><strong>日志的级别</strong></span></p><p>FATAL(致命)&gt;ERROR(错误)&gt;WARN(警告)&gt;INFO(信息)&gt;DEBUG(调试) </p><p>从左到右打印的内容越来越详细</p></blockquote><h1 id="三、核心配置文件详解"><a href="#三、核心配置文件详解" class="headerlink" title="三、核心配置文件详解"></a>三、核心配置文件详解</h1><blockquote><p>核心配置文件中的标签必须按照固定的顺序(有的标签可以不写，但顺序一定不能乱)：<br>properties、settings、typeAliases、typeHandlers、objectFactory、objectWrapperFactory、reflectorFactory、plugins、environments、databaseIdProvider、mappers</p></blockquote><ol><li><p>environments中可以设置多个连接数据库的环境，这个设置是必要的，当然也可以只设一个environment，设置了多个可以指定默认值</p></li><li><p>一开始environment中的驱动，url，username，password都是写死的，很不好，想要使用properties，就需要再最开头配置properties</p></li><li><p>后期查询功能回会很多，但是UserMapper.xml中如果resultType使用全类名就很复杂如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.zhang.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.t_user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>但是如果配置别名：<code>&lt;typeAlias type=&quot;com.zhang.mybatis.pojo.User&quot; alias=&quot;User&quot;/&gt;</code>就可简写为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from mybatis.t_user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果不写alias就使用默认的别名，即类名==不区分大小写==。</p><p><strong>最常用的是：以包为单位，设置改包下所有的类型都拥有默认的别名，即类名且不区分大小写</strong>。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.atguigu.mybatis.bean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>映射文件会很多，但是可以直接引入包，引入包下的所有映射文件（只有将映射文件配置了之后该映射文件才能起作用（Mapper相当于一个Dao，后期需要的Dao很多，所以需要引入包的功能））</p></li></ol><p>整体配置文件（目前需要的配置）：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//MyBatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://MyBatis.org/dtd/MyBatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--引入properties文件，此时就可以$&#123;属性名&#125;的方式访问属性值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--将表中字段的下划线自动转换为驼峰--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--开启延迟加载--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        typeAlias：设置某个具体的类型的别名</span></span><br><span class="line"><span class="comment">        属性：</span></span><br><span class="line"><span class="comment">        type：需要设置别名的类型的全类名</span></span><br><span class="line"><span class="comment">        alias：设置此类型的别名，且别名  不区分大小写  。若不设置此属性，该类型拥有默认的别名，即类名</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;typeAlias type=&quot;com.atguigu.mybatis.bean.User&quot;&gt;&lt;/typeAlias&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;typeAlias type=&quot;com.atguigu.mybatis.bean.User&quot; alias=&quot;user&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;/typeAlias&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--以包为单位，设置改包下所有的类型都拥有默认的别名，即类名且不区分大小写--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.atguigu.mybatis.bean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    environments：设置多个连接数据库的环境</span></span><br><span class="line"><span class="comment">    属性：</span></span><br><span class="line"><span class="comment">    default：设置默认使用的环境的id</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        environment：设置具体的连接数据库的环境信息</span></span><br><span class="line"><span class="comment">        属性：</span></span><br><span class="line"><span class="comment">        id：设置环境的唯一标识，可通过environments标签中的default设置某一个环境的id，表示默认使用的环境</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            transactionManager：设置事务管理方式</span></span><br><span class="line"><span class="comment">            属性：</span></span><br><span class="line"><span class="comment">            type：设置事务管理方式，type=&quot;JDBC|MANAGED&quot;</span></span><br><span class="line"><span class="comment">            type=&quot;JDBC&quot;：设置当前环境的事务管理都必须手动处理</span></span><br><span class="line"><span class="comment">            type=&quot;MANAGED&quot;：设置事务被管理，例如spring中的AOP</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            dataSource：设置数据源</span></span><br><span class="line"><span class="comment">            属性：</span></span><br><span class="line"><span class="comment">            type：设置数据源的类型，type=&quot;POOLED|UNPOOLED|JNDI&quot;</span></span><br><span class="line"><span class="comment">            type=&quot;POOLED&quot;：使用数据库连接池，即会将创建的连接进行缓存，下次使用可以从缓存中直接获取，不需要重新创建</span></span><br><span class="line"><span class="comment">            type=&quot;UNPOOLED&quot;：不使用数据库连接池，即每次使用连接都需要重新创建</span></span><br><span class="line"><span class="comment">            type=&quot;JNDI&quot;：调用上下文中的数据源</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 这样写的前提是上面引入了properties文件 --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--设置驱动类的全类名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--设置连接数据库的连接地址--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--设置连接数据库的用户名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--设置连接数据库的密码--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--引入映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;mapper resource=&quot;UserMapper.xml&quot;/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        以包为单位，将包下所有的映射文件引入核心配置文件</span></span><br><span class="line"><span class="comment">        注意：</span></span><br><span class="line"><span class="comment">1. 此方式必须保证mapper接口和mapper映射文件必须在相同的包下</span></span><br><span class="line"><span class="comment">2. mapper接口要和mapper映射文件的名字一致</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.atguigu.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/mapper%E6%8E%A5%E5%8F%A3%E5%92%8Cmapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8C%85%E4%B8%8B.png" alt=""></li></ul><h3 id="默认的类型别名"><a href="#默认的类型别名" class="headerlink" title="默认的类型别名"></a>默认的类型别名</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E9%BB%98%E8%AE%A4%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D1.png" alt=""><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E9%BB%98%E8%AE%A4%E7%9A%84%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D2.png" alt=""></p><h1 id="四、MyBatis的增删改查"><a href="#四、MyBatis的增删改查" class="headerlink" title="四、MyBatis的增删改查"></a>四、MyBatis的增删改查</h1><ol><li>添加 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int insertUser();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">insert into t_user values(null,&#x27;admin&#x27;,&#x27;123456&#x27;,23,&#x27;男&#x27;,&#x27;12345@qq.com&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>删除 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int deleteUser();--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span>&gt;</span></span><br><span class="line">       delete from t_user where id = 6</span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>修改 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int updateUser();--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span>&gt;</span></span><br><span class="line">       update t_user set username = &#x27;张三&#x27; where id = 5</span><br><span class="line">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>查询一个实体类对象 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--User getUserById();--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.User&quot;</span>&gt;</span>  </span><br><span class="line">select * from t_user where id = 2  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>查询集合 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;User&gt; getUserList();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.User&quot;</span>&gt;</span></span><br><span class="line">select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><blockquote><p>注意：</p><ol><li>查询的标签select必须设置属性resultType或resultMap，用于设置实体类和数据库表的映射关系 <pre><code>- resultType：自动映射，用于属性名和表中字段名一致的情况  - resultMap：自定义映射，用于一对多或多对一或字段名和属性名不一致的情况  </code></pre></li></ol></blockquote><pre><code>2. 当查询的数据为多条时，不能使用实体类作为返回值，只能使用集合，否则会抛出异常TooManyResultsException；但是若查询的数据只有一条，可以使用实体类或集合作为返回值</code></pre><h1 id="五、MyBatis获取参数值的两种方式（重点）"><a href="#五、MyBatis获取参数值的两种方式（重点）" class="headerlink" title="五、MyBatis获取参数值的两种方式（重点）"></a>五、MyBatis获取参数值的两种方式（重点）</h1><ul><li>MyBatis获取参数值的两种方式：<code>$&#123;&#125;</code>和<code>#&#123;&#125;</code>  </li><li><code>$&#123;&#125;</code>的本质就是字符串拼接，<code>#&#123;&#125;</code>的本质就是占位符赋值  </li><li><code>$&#123;&#125;</code>使用字符串拼接的方式拼接sql，若为字符串类型或日期类型的字段进行赋值时，需要手动加单引号；但是<code>#&#123;&#125;</code>使用占位符赋值的方式拼接sql，此时为字符串类型或日期类型的字段进行赋值时，可以自动添加单引号</li><li><code>$&#123;&#125;</code> 相当于Statement；<code>#&#123;&#125;</code>PreparedStatement，同样的道理，能用<code>#&#123;&#125;</code>就不用<code>$&#123;&#125;</code><h2 id="1、单个字面量类型的参数"><a href="#1、单个字面量类型的参数" class="headerlink" title="1、单个字面量类型的参数"></a>1、单个字面量类型的参数</h2></li><li>若mapper接口中的方法参数为单个的字面量类型，此时可以使用${}和#{}以任意的名称(#{aaa}这样的也能正常运行)（最好见名识意）获取参数的值，注意${}需要手动加单引号<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User getUserByUsername(String username);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from t_user where username = #&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User getUserByUsername(String username);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span>  </span><br><span class="line">select * from t_user where username = &#x27;$&#123;username&#125;&#x27;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、多个字面量类型的参数"><a href="#2、多个字面量类型的参数" class="headerlink" title="2、多个字面量类型的参数"></a>2、多个字面量类型的参数</h2></li><li><p>若mapper接口中的方法参数为多个时，此时MyBatis会自动将这些参数放在一个map集合中</p><ol><li><p>以arg0,arg1…为键，以参数为值；</p></li><li><p>以param1,param2…为键，以参数为值；</p></li></ol></li><li><p>因此只需要通过${}和#{}访问map集合的键就可以获取相对应的值，注意${}需要手动加单引号。</p></li><li><p>使用arg或者param都行，要注意的是，arg是从arg0开始的，param是从param1开始的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User checkLogin(String username,String password);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span>  </span><br><span class="line">select * from t_user where username = #&#123;arg0&#125; and password = #&#123;arg1&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User checkLogin(String username,String password);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from t_user where username = &#x27;$&#123;param1&#125;&#x27; and password = &#x27;$&#123;param2&#125;&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3、map集合类型的参数"><a href="#3、map集合类型的参数" class="headerlink" title="3、map集合类型的参数"></a>3、map集合类型的参数</h2></li><li>若mapper接口中的方法需要的参数为多个时，此时可以手动创建map集合，将这些数据放在map中只需要通过${}和#{}访问map集合的键就可以获取相对应的值，注意${}需要手动加单引号<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User checkLoginByMap(Map&lt;String,Object&gt; map);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLoginByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkLoginByMap</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">ParameterMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ParameterMapper.class);</span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//key的值要和#&#123;&#125;中的字面量一样</span></span><br><span class="line">    map.put(<span class="string">&quot;usermane&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.checkLoginByMap(map);</span><br><span class="line">System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、实体类类型的参数"><a href="#4、实体类类型的参数" class="headerlink" title="4、实体类类型的参数"></a>4、实体类类型的参数</h2></li><li>若mapper接口中的方法参数为实体类对象时此时可以使用${}和#{}，通过访问实体类对象中的属性名获取属性值，注意${}需要手动加单引号<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int insertUser(User user);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">insert into t_user values(null,#&#123;username&#125;,#&#123;password&#125;,#&#123;age&#125;,#&#123;sex&#125;,#&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">ParameterMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ParameterMapper.class);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>,<span class="string">&quot;Tom&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="number">12</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;123@321.com&quot;</span>);</span><br><span class="line">mapper.insertUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5、使用-Param标识参数"><a href="#5、使用-Param标识参数" class="headerlink" title="5、使用@Param标识参数"></a>5、使用@Param标识参数</h2></li><li>可以通过@Param注解标识mapper接口中的方法参数，此时，会将这些参数放在map集合中 <ol><li>以@Param注解的value属性值为键，以参数为值；</li><li>以param1,param2…为键，以参数为值；（这种参数也可以）</li></ol></li><li>只需要通过${}和#{}访问map集合的键就可以获取相对应的值，注意${}需要手动加单引号</li></ul><p>其实就是第2种和第3种方法的加强版（不用像2那样不能见名知意，也不用像3那样代码复杂）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User CheckLoginByParam(@Param(&quot;username&quot;) String username, @Param(&quot;password&quot;) String password);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;CheckLoginByParam&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkLoginByParam</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">ParameterMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ParameterMapper.class);</span><br><span class="line">mapper.CheckLoginByParam(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6、总结"><a href="#6、总结" class="headerlink" title="6、总结"></a>6、总结</h2><blockquote><p>看调用函数的参数个数：</p><ul><li>单个参数#{}的大括号中的值随意（一般见名知意即可）</li><li>多个参数<ul><li>看调用函数的参数类型<ol><li>普通类型</li><li>Map类型</li><li>实体类类型</li><li>@Param标识类型</li></ol></li></ul></li></ul></blockquote><ul><li>多个参数时建议分成两种情况进行处理<ol><li>实体类类型的参数</li><li>使用@Param标识参数</li></ol></li><li>原因：<ol><li>普通类型时的arg0，arg1…不容易见名知意</li><li>Map类型再调用时，需要手动new一个map再把值put进map中，且map的key也要和#{}中的名字一样，耦合度高，且代码复杂</li></ol></li></ul><h1 id="六、MyBatis的各种查询功能"><a href="#六、MyBatis的各种查询功能" class="headerlink" title="六、MyBatis的各种查询功能"></a>六、MyBatis的各种查询功能</h1><ol><li>如果查询出的数据只有一条，可以通过<ol><li>实体类对象接收</li><li>List集合接收</li><li>Map集合接收，结果<code>&#123;password=123456, sex=男, id=1, age=23, username=admin&#125;</code></li></ol></li><li>如果查询出的数据有多条，一定不能用实体类对象接收，会抛异常TooManyResultsException，可以通过<ol><li>实体类类型的LIst集合接收</li><li>Map类型的LIst集合接收</li><li>在mapper接口的方法上添加@MapKey注解<h2 id="1、查询一个实体类对象"><a href="#1、查询一个实体类对象" class="headerlink" title="1、查询一个实体类对象"></a>1、查询一个实体类对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户id查询用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--User getUserById(@Param(&quot;id&quot;) int id);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from t_user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、查询一个List集合"><a href="#2、查询一个List集合" class="headerlink" title="2、查询一个List集合"></a>2、查询一个List集合</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;User&gt; getUserList();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3、查询单个数据"><a href="#3、查询单个数据" class="headerlink" title="3、查询单个数据"></a>3、查询单个数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 查询用户的总记录数  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment"> * 在MyBatis中，对于Java中常用的类型都设置了类型别名  </span></span><br><span class="line"><span class="comment"> * 例如：java.lang.Integer--&gt;int|integer  </span></span><br><span class="line"><span class="comment"> * 例如：int--&gt;_int|_integer  </span></span><br><span class="line"><span class="comment"> * 例如：Map--&gt;map,List--&gt;list  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int getCount();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;_integer&quot;</span>&gt;</span></span><br><span class="line">select count(id) from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、查询一条数据为map集合"><a href="#4、查询一条数据为map集合" class="headerlink" title="4、查询一条数据为map集合"></a>4、查询一条数据为map集合</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 根据用户id查询用户信息为map集合  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getUserToMap</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Map&lt;String, Object&gt; getUserToMap(@Param(&quot;id&quot;) int id);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">select * from t_user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--结果：&#123;password=123456, sex=男, id=1, age=23, username=admin&#125;--&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5、查询多条数据为map集合"><a href="#5、查询多条数据为map集合" class="headerlink" title="5、查询多条数据为map集合"></a>5、查询多条数据为map集合</h2><h3 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 查询所有用户信息为map集合  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment"> * 将表中的数据以map集合的方式查询，一条数据对应一个map；若有多条数据，就会产生多个map集合，此时可以将这些map放在一个list集合中获取  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">getAllUserToMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Map&lt;String, Object&gt; getAllUserToMap();--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUserToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span>  </span><br><span class="line">select * from t_user  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">结果：</span></span><br><span class="line"><span class="comment">[&#123;password=123456, sex=男, id=1, age=23, username=admin&#125;,</span></span><br><span class="line"><span class="comment">&#123;password=123456, sex=男, id=2, age=23, username=张三&#125;,</span></span><br><span class="line"><span class="comment">&#123;password=123456, sex=男, id=3, age=23, username=张三&#125;]</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><h3 id="方法二：（使用较多）"><a href="#方法二：（使用较多）" class="headerlink" title="方法二：（使用较多）"></a>方法二：（使用较多）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有用户信息为map集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * 将表中的数据以map集合的方式查询，一条数据对应一个map；若有多条数据，就会产生多个map集合，并且最终要以一个map的方式返回数据，此时需要通过<span class="doctag">@MapKey</span>注解设置map集合的键，值是每条数据所对应的map集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@MapKey(&quot;id&quot;)</span>&lt;!-- id是主键不会重复 --&gt;</span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getAllUserToMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Map&lt;String, Object&gt; getAllUserToMap();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUserToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">结果：</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">1=&#123;password=123456, sex=男, id=1, age=23, username=admin&#125;,</span></span><br><span class="line"><span class="comment">2=&#123;password=123456, sex=男, id=2, age=23, username=张三&#125;,</span></span><br><span class="line"><span class="comment">3=&#123;password=123456, sex=男, id=3, age=23, username=张三&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><h1 id="七、特殊SQL的执行"><a href="#七、特殊SQL的执行" class="headerlink" title="七、特殊SQL的执行"></a>七、特殊SQL的执行</h1><h2 id="1、模糊查询"><a href="#1、模糊查询" class="headerlink" title="1、模糊查询"></a>1、模糊查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户名进行模糊查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> java.util.List&lt;com.atguigu.mybatis.pojo.User&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/26 21:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getUserByLike</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;User&gt; getUserByLike(@Param(&quot;username&quot;) String username);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 解决方式一 ，直接将#换成$即可，因为$&#123;&#125;需要手动加引号 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SELECT * FROM mybatis.t_user where username like &#x27;%$&#123;username&#125;%&#x27; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 解决方式二 ， 使用字符串拼接函数 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SELECT * FROM mybatis.t_user where username like concat(&#x27;%&#x27;,#&#123;username&#125;,&#x27;%&#x27;) --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 解决方式三 ， 最常用，有点像字符串拼接 --&gt;</span></span><br><span class="line">    SELECT * FROM mybatis.t_user where username like &quot;%&quot;#&#123;username&#125;&quot;%&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li></ol><ul><li><strong>其中</strong><code>select * from t_user where username like &quot;%&quot;#&#123;username&#125;&quot;%&quot;</code><strong>是最常用的</strong></li><li><span style="color:red"> ’%‘ 只是SQL语句的模糊查询的符号，使用 ’_‘ 也可以，且和sql的意思一样</span><h2 id="2、批量删除"><a href="#2、批量删除" class="headerlink" title="2、批量删除"></a>2、批量删除</h2></li><li>==<strong>只能使用${}</strong>==，如果使用#{}，则解析后的sql语句为<code>delete from t_user where id in (&#39;1,2,3&#39;)</code>，这样是将<code>1,2,3</code>看做是一个整体，只有id为<code>1,2,3</code>的数据会被删除。正确的语句应该是<code>delete from t_user where id in (1,2,3)</code>，或者<code>delete from t_user where id in (&#39;1&#39;,&#39;2&#39;,&#39;3&#39;)</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id批量删除</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/26 22:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteMore</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String ids)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteMore&quot;</span>&gt;</span></span><br><span class="line">delete from t_user where id in ($&#123;ids&#125;)<span class="comment">&lt;!-- in 后面的只能用$&#123;&#125; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMore</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">SQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SQLMapper.class);</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> mapper.deleteMore(<span class="string">&quot;1,2,3,8&quot;</span>);</span><br><span class="line">System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、动态设置表名"><a href="#3、动态设置表名" class="headerlink" title="3、动态设置表名"></a>3、动态设置表名</h2></li><li><p>只能使用${}，因为表名不能加单引号</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询指定表中的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> java.util.List&lt;com.atguigu.mybatis.pojo.User&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/27 14:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getUserByTable</span><span class="params">(<span class="meta">@Param(&quot;tableName&quot;)</span> String tableName)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;User&gt; getUserByTable(@Param(&quot;tableName&quot;) String tableName);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByTable&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">select * from $&#123;tableName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4、添加功能获取自增的主键"><a href="#4、添加功能获取自增的主键" class="headerlink" title="4、添加功能获取自增的主键"></a>4、添加功能获取自增的主键</h2><p>使用场景:</p></li><li><p>t_clazz(clazz_id,clazz_name)  </p></li><li>t_student(student_id,student_name,clazz_id)  <ol><li>添加班级信息  </li><li>获取新添加的班级的id</li><li>为班级分配学生，即将某学的班级id修改为新添加的班级的id</li></ol></li><li>在mapper.xml中设置两个属性<ul><li>useGeneratedKeys：设置使用自增的主键  </li><li>keyProperty：因为增删改有统一的返回值是受影响的行数，因此只能将获取的自增的主键放在传输的参数user对象的某个属性中</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/27 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--void insertUser(User user);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">insert into t_user values (null,#&#123;username&#125;,#&#123;password&#125;,#&#123;age&#125;,#&#123;sex&#125;,#&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">SQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SQLMapper.class);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;ton&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="number">23</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;123@321.com&quot;</span>);</span><br><span class="line">mapper.insertUser(user);</span><br><span class="line">System.out.println(user);</span><br><span class="line"><span class="comment">//输出：user&#123;id=10, username=&#x27;ton&#x27;, password=&#x27;123&#x27;, age=23, sex=&#x27;男&#x27;, email=&#x27;123@321.com&#x27;&#125;，自增主键存放到了user的id属性中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="八、自定义映射resultMap"><a href="#八、自定义映射resultMap" class="headerlink" title="八、自定义映射resultMap"></a>八、自定义映射resultMap</h1><p>如果实体类的属性和表中的字段不一样时，使用普通的查询会将该字段的内容显示为null</p><p>这个时候就需要使用自定义映射了</p><h2 id="1、resultMap处理字段和属性的映射关系"><a href="#1、resultMap处理字段和属性的映射关系" class="headerlink" title="1、resultMap处理字段和属性的映射关系"></a>1、resultMap处理字段和属性的映射关系</h2><ul><li>若字段名和实体类中的属性名不一致，则可以通过resultMap设置自定义映射，即使字段名和属性名一致的属性也要映射，也就是全部属性都要列出来</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">resultMap：设置自定义映射  </span></span><br><span class="line"><span class="comment"> 属性：  </span></span><br><span class="line"><span class="comment">   id：表示自定义映射的唯一标识，不能重复</span></span><br><span class="line"><span class="comment">    type：查询的数据要映射的实体类的类型</span></span><br><span class="line"><span class="comment">   子标签：  </span></span><br><span class="line"><span class="comment">    id：设置主键的映射关系  </span></span><br><span class="line"><span class="comment">    result：设置普通字段的映射关系  </span></span><br><span class="line"><span class="comment">    子标签属性：  </span></span><br><span class="line"><span class="comment">    property：设置映射关系中实体类中的属性名（可以是属性，也可以是对象的对象属性的属性  dept.did） </span></span><br><span class="line"><span class="comment">    column：设置映射关系中表中的字段名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getAllEmp();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmp&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>若字段名和实体类中的属性名不一致，但是字段名符合数据库的规则（使用_），实体类中的属性名符合Java的规则（使用驼峰）。此时也可通过以下两种方式处理字段名和实体类中的属性的映射关系  </p></blockquote><ol><li>可以通过为字段起别名的方式，保证和实体类中的属性名保持一致  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getAllEmp();--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllEmp&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select eid,emp_name empName,age,sex,email from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>可以在MyBatis的核心配置文件中的<code>setting</code>标签中，设置一个全局配置信息mapUnderscoreToCamelCase，可以在查询表中数据时，<strong>自动将_类型的字段名转换为驼峰</strong>，例如：字段名user_name，设置了mapUnderscoreToCamelCase，此时字段名就会转换为userName。<a href="#核心配置文件详解">核心配置文件详解</a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、多对一映射处理"><a href="#2、多对一映射处理" class="headerlink" title="2、多对一映射处理"></a>2、多对一映射处理</h2><blockquote><p>查询员工信息以及员工所对应的部门信息（多表联查）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;  </span><br><span class="line"><span class="keyword">private</span> Integer eid;  </span><br><span class="line"><span class="keyword">private</span> String empName;  </span><br><span class="line"><span class="keyword">private</span> Integer age;  </span><br><span class="line"><span class="keyword">private</span> String sex;  </span><br><span class="line"><span class="keyword">private</span> String email;  </span><br><span class="line"><span class="keyword">private</span> Dept dept;</span><br><span class="line"><span class="comment">//...构造器、get、set方法等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="a-gt-级联方式处理映射关系"><a href="#a-gt-级联方式处理映射关系" class="headerlink" title="a&gt;级联方式处理映射关系"></a>a&gt;级联方式处理映射关系</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMapOne&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 级联方式处理映射关系 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dept.deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Emp getEmpAndDept(@Param(&quot;eid&quot;)Integer eid);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptResultMapOne&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp left join t_dept on t_emp.eid = t_dept.did where t_emp.eid = #&#123;eid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="b-gt-使用association处理映射关系"><a href="#b-gt-使用association处理映射关系" class="headerlink" title="b&gt;使用association处理映射关系"></a>b&gt;使用association处理映射关系</h3></blockquote></li></ol><ul><li>association：处理多对一的映射关系</li><li>property：需要处理多对的映射关系的属性名</li><li>javaType：该属性的类型（如果是对象就是对象的类名）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMapTwo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用association处理映射关系 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Emp getEmpAndDept(@Param(&quot;eid&quot;)Integer eid);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptResultMapTwo&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp left join t_dept on t_emp.eid = t_dept.did where t_emp.eid = #&#123;eid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="c-gt-分步查询"><a href="#c-gt-分步查询" class="headerlink" title="c&gt;分步查询"></a>c&gt;分步查询</h3><h4 id="1-查询员工信息"><a href="#1-查询员工信息" class="headerlink" title="1. 查询员工信息"></a>1. 查询员工信息</h4></li><li>select：设置分布查询的sql的唯一标识（namespace.SQLId或mapper接口的全类名.方法名）</li><li>column：设置分步查询的条件<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EmpMapper里的方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询，员工及所对应的部门信息</span></span><br><span class="line"><span class="comment"> * 分步查询第一步：查询员工信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> com.atguigu.mybatis.pojo.Emp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/27 20:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Emp <span class="title function_">getEmpAndDeptByStepOne</span><span class="params">(<span class="meta">@Param(&quot;eid&quot;)</span> Integer eid)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptByStepResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">select</span>=<span class="string">&quot;com.atguigu.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Emp getEmpAndDeptByStepOne(@Param(&quot;eid&quot;) Integer eid);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptByStepOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptByStepResultMap&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp where eid = #&#123;eid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-查询部门信息"><a href="#2-查询部门信息" class="headerlink" title="2. 查询部门信息"></a>2. 查询部门信息</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DeptMapper里的方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询，员工及所对应的部门信息</span></span><br><span class="line"><span class="comment"> * 分步查询第二步：通过did查询员工对应的部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> com.atguigu.mybatis.pojo.Emp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/27 20:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Dept <span class="title function_">getEmpAndDeptByStepTwo</span><span class="params">(<span class="meta">@Param(&quot;did&quot;)</span> Integer did)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--此处的resultMap仅是处理字段和属性的映射关系--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;EmpAndDeptByStepTwoResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Dept getEmpAndDeptByStepTwo(@Param(&quot;did&quot;) Integer did);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptByStepTwo&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;EmpAndDeptByStepTwoResultMap&quot;</span>&gt;</span></span><br><span class="line">select * from t_dept where did = #&#123;did&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3、一对多映射处理"><a href="#3、一对多映射处理" class="headerlink" title="3、一对多映射处理"></a>3、一对多映射处理</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dept</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer did;</span><br><span class="line">    <span class="keyword">private</span> String deptName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Emp&gt; emps;<span class="comment">//有一个属性是Emp的集合，想要查询出这个结果</span></span><br><span class="line"><span class="comment">//...构造器、get、set方法等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="a-gt-collection"><a href="#a-gt-collection" class="headerlink" title="a&gt;collection"></a>a&gt;collection</h3></li><li>collection：用来处理一对多的映射关系</li><li>ofType：表示该属性对应的集合中存储的数据的类型<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;DeptAndEmpResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Dept getDeptAndEmp(@Param(&quot;did&quot;) Integer did);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmp&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;DeptAndEmpResultMap&quot;</span>&gt;</span></span><br><span class="line">select * from t_dept left join t_emp on t_dept.did = t_emp.did where t_dept.did = #&#123;did&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="b-gt-分步查询"><a href="#b-gt-分步查询" class="headerlink" title="b&gt;分步查询"></a>b&gt;分步查询</h3></li></ul><h4 id="1-查询部门信息"><a href="#1-查询部门信息" class="headerlink" title="1. 查询部门信息"></a>1. 查询部门信息</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询，查询部门及对应的所有员工信息</span></span><br><span class="line"><span class="comment"> * 分步查询第一步：查询部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> did </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> com.atguigu.mybatis.pojo.Dept</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/27 22:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Dept <span class="title function_">getDeptAndEmpByStepOne</span><span class="params">(<span class="meta">@Param(&quot;did&quot;)</span> Integer did)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;DeptAndEmpByStepOneResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;did&quot;</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">select</span>=<span class="string">&quot;com.atguigu.mybatis.mapper.EmpMapper.getDeptAndEmpByStepTwo&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">column</span>=<span class="string">&quot;did&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Dept getDeptAndEmpByStepOne(@Param(&quot;did&quot;) Integer did);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpByStepOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;DeptAndEmpByStepOneResultMap&quot;</span>&gt;</span></span><br><span class="line">select * from t_dept where did = #&#123;did&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-根据部门id查询部门中的所有员工"><a href="#2-根据部门id查询部门中的所有员工" class="headerlink" title="2. 根据部门id查询部门中的所有员工"></a>2. 根据部门id查询部门中的所有员工</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询，查询部门及对应的所有员工信息</span></span><br><span class="line"><span class="comment"> * 分步查询第二步：根据部门id查询部门中的所有员工</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> did</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> java.util.List&lt;com.atguigu.mybatis.pojo.Emp&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/27 22:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getDeptAndEmpByStepTwo</span><span class="params">(<span class="meta">@Param(&quot;did&quot;)</span> Integer did)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getDeptAndEmpByStepTwo(@Param(&quot;did&quot;) Integer did);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpByStepTwo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp where did = #&#123;did&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="c-gt-延迟加载"><a href="#c-gt-延迟加载" class="headerlink" title="c&gt;延迟加载"></a>c&gt;延迟加载</h3><ul><li>分步查询的优点：可以实现延迟加载，但是必须在核心配置文件中设置全局配置信息：</li><li>lazyLoadingEnabled：延迟加载的全局开关。当开启时，所有关联对象都会延迟加载  </li><li>aggressiveLazyLoading：当开启时，任何方法的调用都会加载该对象的所有属性。 否则，每个属性会按需加载  </li><li>此时就可以实现按需加载，获取的数据是什么，就只会执行相应的sql。此时可通过association和collection中的fetchType属性设置当前的分步查询是否使用延迟加载，<strong>fetchType=”lazy(延迟加载)|eager(立即加载)”</strong><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启延迟加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getEmpAndDeptByStepOne</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> mapper.getEmpAndDeptByStepOne(<span class="number">1</span>);</span><br><span class="line">System.out.println(emp.getEmpName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>关闭延迟加载，两条SQL语句都运行了<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E6%B5%8B%E8%AF%951.png" alt=""></li><li>开启延迟加载，只运行获取emp的SQL语句<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E6%B5%8B%E8%AF%952.png" alt=""><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getEmpAndDeptByStepOne</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> mapper.getEmpAndDeptByStepOne(<span class="number">1</span>);</span><br><span class="line">System.out.println(emp.getEmpName());</span><br><span class="line">System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br><span class="line">System.out.println(emp.getDept());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>开启后，需要用到查询dept的时候才会调用相应的SQL语句<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E6%B5%8B%E8%AF%953.png" alt=""></li><li>fetchType：当开启了全局的延迟加载之后，可以通过该属性手动控制延迟加载的效果，fetchType=”lazy(延迟加载)|eager(立即加载)”</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptByStepResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">select</span>=<span class="string">&quot;com.atguigu.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">column</span>=<span class="string">&quot;did&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>多对一映射用association</li><li>一对多映射用collection</li><li>分布查询都是一样的<ul><li>都是property中写查询属性类型</li><li>select后面调用语句（用全类名+方法名）</li><li>column后面相当于就是join on结构中on后面要求建立的关系的字段</li></ul></li><li>都可使用延迟加载，效果也一样</li></ul><h1 id="九、动态SQL"><a href="#九、动态SQL" class="headerlink" title="九、动态SQL"></a>九、动态SQL</h1><ul><li>Mybatis框架的动态SQL技术是一种根据特定条件动态拼装SQL语句的功能，它存在的意义是为了解决拼接SQL语句字符串时的痛点问题<h2 id="1、if"><a href="#1、if" class="headerlink" title="1、if"></a>1、if</h2></li><li>if标签可通过test属性（即传递过来的数据）的表达式进行判断，若表达式的结果为true，则标签中的内容会执行；反之标签中的内容不会执行</li><li><p>一般要在where后面添加一个恒成立条件<code>1=1</code></p><ul><li>这个恒成立条件并不会影响查询的结果</li><li>这个<code>1=1</code>可以用来拼接<code>and</code>语句，例如：当empName为null时</li><li><p>如果不加上恒成立条件，当第一个if标签中的内容不满足要求，则SQL语句为<code>select * from t_emp where and age = ? and sex = ? and email = ?</code>，<strong>此时<code>where</code>会与<code>and</code>连用，SQL语句会报错</strong>。</p></li><li><p>如果加上一个恒成立条件，则SQL语句为<code>select * from t_emp where 1= 1 and age = ? and sex = ? and email = ?</code>，此时不报错</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp where 1=1</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName !=&#x27;&#x27;&quot;</span>&gt;</span><span class="comment">&lt;!-- test中使用的是属性名 --&gt;</span></span><br><span class="line">and emp_name = #&#123;empName&#125;<span class="comment">&lt;!-- 要拼接的内容用字段名，#&#123;&#125;中的内容用属性名  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">and age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">and sex = #&#123;sex&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">and email = #&#123;email&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、where"><a href="#2、where" class="headerlink" title="2、where"></a>2、where</h2></li></ul></li><li>where和if一般结合使用：<ul><li>若where标签中的if条件都不满足，则where标签没有任何功能，即不会添加where关键字  </li><li>若where标签中的if条件满足，则where标签会自动添加where关键字，并将条件<strong>最前方</strong>多余的and/or去掉  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp</span><br><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">emp_name = #&#123;empName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">and age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">and sex = #&#123;sex&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">and email = #&#123;email&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li>注意：where标签不能去掉条件<strong>后</strong>多余的and/or</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--这种用法是错误的，只能去掉条件前面的and/or，条件后面的不行--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">emp_name = #&#123;empName&#125; and</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3、trim"><a href="#3、trim" class="headerlink" title="3、trim"></a>3、trim</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp</span><br><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and|or&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">emp_name = #&#123;empName&#125; and</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">age = #&#123;age&#125; and</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">sex = #&#123;sex&#125; or</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email !=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">email = #&#123;email&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getEmpByCondition</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">List&lt;Emp&gt; emps= mapper.getEmpByCondition(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;张三&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>));</span><br><span class="line">System.out.println(emps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>trim用于去掉或添加标签中的内容  </p><p>常用属性</p><p>prefix：在trim标签中的内容的前面 添加 某些内容  </p><p>suffix：在trim标签中的内容的后面 添加 某些内容 </p><p>prefixOverrides：在trim标签中的内容的前面 去掉 某些内容  </p><p>suffixOverrides：在trim标签中的内容的后面 去掉 某些内容</p><p>若trim中的标签都不满足条件，则trim标签没有任何效果，也就是只剩下<code>select * from t_emp</code></p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="Resources/trim测试结果.png" alt=""></p><h2 id="4、choose、when、otherwise"><a href="#4、choose、when、otherwise" class="headerlink" title="4、choose、when、otherwise"></a>4、choose、when、otherwise</h2><ul><li><code>choose、when、otherwise</code>相当于<code>if...else if..else</code><ul><li><code>when</code> 相当于<code>else if</code> ； <code>otherwise</code> 相当于<code>else</code> </li></ul></li><li>when至少要有一个，otherwise至多只有一个<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select * from t_emp</span><br><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">emp_name = #&#123;empName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">sex = #&#123;sex&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">email = #&#123;email&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">did = 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getEmpByChoose</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line">List&lt;Emp&gt; emps = mapper.getEmpByChoose(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">23</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;123@qq.com&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">System.out.println(emps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/choose%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt=""></li><li>相当于<code>if a else if b else if c else d</code>，只会执行其中一个<h2 id="5、foreach"><a href="#5、foreach" class="headerlink" title="5、foreach"></a>5、foreach</h2></li><li>批量删除</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int deleteMoreByArray(Integer[] eids);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteMoreByArray&quot;</span>&gt;</span></span><br><span class="line">delete from t_emp where eid in</span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;eids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">#&#123;eid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteMoreByArray</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> mapper.deleteMoreByArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;);</span><br><span class="line">System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>属性：  </p><p>collection：设置要循环的数组或集合  </p><p>item：表示集合或数组中的每一个数据  </p><p>separator：设置循环体之间的分隔符，分隔符前后默认有一个空格，如<code>,</code></p><p>open：设置foreach标签中的内容的开始符  </p><p>close：设置foreach标签中的内容的结束符</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/foreach%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C1.png" alt=""></p><ul><li>批量添加</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--int insertMoreByList(@Param(&quot;emps&quot;) List&lt;Emp&gt; emps);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertMoreByList&quot;</span>&gt;</span></span><br><span class="line">insert into t_emp values</span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">(null,#&#123;emp.empName&#125;,#&#123;emp.age&#125;,#&#123;emp.sex&#125;,#&#123;emp.email&#125;,null)</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertMoreByList</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtils.getSqlSession();</span><br><span class="line"><span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">emp1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>,<span class="string">&quot;a&quot;</span>,<span class="number">1</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;123@321.com&quot;</span>,<span class="literal">null</span>);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">emp2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>,<span class="string">&quot;b&quot;</span>,<span class="number">1</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;123@321.com&quot;</span>,<span class="literal">null</span>);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">emp3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>,<span class="string">&quot;c&quot;</span>,<span class="number">1</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;123@321.com&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">List&lt;Emp&gt; emps = Arrays.asList(emp1, emp2, emp3);</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> mapper.insertMoreByList(emps);</span><br><span class="line">System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/foreach%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C2.png" alt=""></p><h2 id="6、SQL片段"><a href="#6、SQL片段" class="headerlink" title="6、SQL片段"></a>6、SQL片段</h2><ul><li>sql片段，可以记录一段公共sql片段，在使用的地方通过include标签进行引入</li><li>声明sql片段：<code>&lt;sql&gt;</code>标签<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;empColumns&quot;</span>&gt;</span>eid,emp_name,age,sex,email<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>引用sql片段：<code>&lt;include&gt;</code>标签<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List&lt;Emp&gt; getEmpByCondition(Emp emp);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;empColumns&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span> from t_emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="十、MyBatis的缓存"><a href="#十、MyBatis的缓存" class="headerlink" title="十、MyBatis的缓存"></a>十、MyBatis的缓存</h1><h2 id="1、MyBatis的一级缓存"><a href="#1、MyBatis的一级缓存" class="headerlink" title="1、MyBatis的一级缓存"></a>1、MyBatis的一级缓存</h2></li><li>一级缓存是SqlSession级别的，通过同一个SqlSession查询的数据会被缓存，下次查询相同的数据，就会从缓存中直接获取，不会从数据库重新访问  </li><li>使一级缓存失效的四种情况：  <ol><li>不同的SqlSession对应不同的一级缓存  </li><li>同一个SqlSession但是查询条件不同</li><li>同一个SqlSession两次查询期间执行了任何一次增删改操作</li><li>同一个SqlSession两次查询期间手动清空了缓存         sqlSession有个方法clearCache，调用之后就清空了缓存</li></ol></li><li>注意范围和功能<h2 id="2、MyBatis的二级缓存"><a href="#2、MyBatis的二级缓存" class="headerlink" title="2、MyBatis的二级缓存"></a>2、MyBatis的二级缓存</h2></li><li><p>二级缓存是SqlSessionFactory级别，通过同一个SqlSessionFactory创建的SqlSession查询的结果会被缓存；此后若再次执行相同的查询语句，结果就会从缓存中获取  </p></li><li><p>二级缓存开启的条件</p><ol><li><p>在核心配置文件中，设置全局配置属性cacheEnabled=”true”，默认为true，不需要设置</p></li><li><p>在映射文件中设置标签<cache /></p></li><li><p>二级缓存必须在SqlSession关闭或提交之后有效                        <code>sqlSession.commit();</code></p></li><li><p>查询的数据所转换的实体类类型必须实现序列化的接口</p></li></ol></li><li><p>使二级缓存失效的情况：两次查询之间执行了任意的增删改，会使一级和二级缓存同时失效</p><h2 id="3、二级缓存的相关配置"><a href="#3、二级缓存的相关配置" class="headerlink" title="3、二级缓存的相关配置"></a>3、二级缓存的相关配置</h2></li><li><p>在mapper配置文件中添加的cache标签可以设置一些属性</p></li><li><p>eviction属性：缓存回收策略  </p><ul><li>LRU（Least Recently Used） – 最近最少使用的：移除最长时间不被使用的对象。  </li><li>FIFO（First in First out） – 先进先出：按对象进入缓存的顺序来移除它们。  </li><li>SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。  </li><li>WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</li><li>默认的是 LRU</li></ul></li><li><p>flushInterval属性：刷新间隔，单位毫秒</p><p>默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句（增删改）时刷新</p></li><li><p>size属性：引用数目，正整数</p><p>代表缓存最多可以存储多少个对象，太大容易导致内存溢出</p></li><li><p>readOnly属性：只读，true/false</p><ul><li>true：只读缓存；会给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。  </li><li>false：读写缓存；会返回缓存对象的拷贝（通过序列化）。这会慢一些，但是安全，因此默认是false<h2 id="4、MyBatis缓存查询的顺序"><a href="#4、MyBatis缓存查询的顺序" class="headerlink" title="4、MyBatis缓存查询的顺序"></a>4、MyBatis缓存查询的顺序</h2></li></ul></li><li>先查询二级缓存，因为二级缓存中可能会有其他程序已经查出来的数据，可以拿来直接使用  </li><li>如果二级缓存没有命中，再查询一级缓存  </li><li>如果一级缓存也没有命中，则查询数据库  </li><li>SqlSession关闭之后，一级缓存中的数据会写入二级缓存<h2 id="5、整合第三方缓存EHCache（了解）"><a href="#5、整合第三方缓存EHCache（了解）" class="headerlink" title="5、整合第三方缓存EHCache（了解）"></a>5、整合第三方缓存EHCache（了解）</h2><h3 id="a-gt-添加依赖"><a href="#a-gt-添加依赖" class="headerlink" title="a&gt;添加依赖"></a>a&gt;添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mybatis EHCache整合包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- slf4j日志门面的一个具体实现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="b-gt-各个jar包的功能"><a href="#b-gt-各个jar包的功能" class="headerlink" title="b&gt;各个jar包的功能"></a>b&gt;各个jar包的功能</h3>| jar包名称 | 作用 |<br>| —- | —- |<br>| mybatis-ehcache | Mybatis和EHCache的整合包 |<br>| ehcache | EHCache核心包 |<br>| slf4j-api | SLF4J日志门面包 |<br>| logback-classic | 支持SLF4J门面接口的一个具体实现 |</li></ul><h3 id="c-gt-创建EHCache的配置文件ehcache-xml"><a href="#c-gt-创建EHCache的配置文件ehcache-xml" class="headerlink" title="c&gt;创建EHCache的配置文件ehcache.xml"></a>c&gt;创建EHCache的配置文件ehcache.xml</h3><ul><li>名字必须叫<code>ehcache.xml</code><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;../config/ehcache.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 磁盘保存路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;D:\atguigu\ehcache&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsOnDisk</span>=<span class="string">&quot;10000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="d-gt-设置二级缓存的类型"><a href="#d-gt-设置二级缓存的类型" class="headerlink" title="d&gt;设置二级缓存的类型"></a>d&gt;设置二级缓存的类型</h3></li><li>在xxxMapper.xml文件中设置二级缓存类型<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="e-gt-加入logback日志"><a href="#e-gt-加入logback日志" class="headerlink" title="e&gt;加入logback日志"></a>e&gt;加入logback日志</h3></li><li>存在SLF4J时，作为简易日志的log4j将失效，此时我们需要借助SLF4J的具体实现logback来打印日志。创建logback的配置文件<code>logback.xml</code>，名字固定，不可改变<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定日志输出的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志输出的格式 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 按照顺序分别是：时间、日志级别、线程名称、打印日志的类、日志主体内容、换行 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%d&#123;HH:mm:ss.SSS&#125;] [%-5level] [%thread] [%logger] [%msg]%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置全局日志级别。日志级别按顺序分别是：DEBUG、INFO、WARN、ERROR --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定打印日志的appender，这里通过“STDOUT”引用了前面配置的appender --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根据特殊需求指定局部日志级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.atguigu.crowd.mapper&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="f-gt-EHCache配置文件说明"><a href="#f-gt-EHCache配置文件说明" class="headerlink" title="f&gt;EHCache配置文件说明"></a>f&gt;EHCache配置文件说明</h3>| 属性名 | 是否必须 | 作用 |<br>| —- | —- | —- |<br>| maxElementsInMemory | 是 | 在内存中缓存的element的最大数目 |<br>| maxElementsOnDisk | 是 | 在磁盘上缓存的element的最大数目，若是0表示无穷大 |<br>| eternal | 是 | 设定缓存的elements是否永远不过期。 如果为true，则缓存的数据始终有效， 如果为false那么还要根据timeToIdleSeconds、timeToLiveSeconds判断 |<br>| overflowToDisk | 是 | 设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上 |<br>| timeToIdleSeconds | 否 | 当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时， 这些数据便会删除，默认值是0,也就是可闲置时间无穷大 |<br>| timeToLiveSeconds | 否 | 缓存element的有效生命期，默认是0.,也就是element存活时间无穷大 |<br>| diskSpoolBufferSizeMB | 否 | DiskStore(磁盘缓存)的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区 |<br>| diskPersistent | 否 | 在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false |<br>| diskExpiryThreadIntervalSeconds | 否 | 磁盘缓存的清理线程运行间隔，默认是120秒。每个120s， 相应的线程会进行一次EhCache中数据的清理工作 |<br>| memoryStoreEvictionPolicy | 否 | 当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。 默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出 |<h1 id="十一、MyBatis的逆向工程"><a href="#十一、MyBatis的逆向工程" class="headerlink" title="十一、MyBatis的逆向工程"></a>十一、MyBatis的逆向工程</h1></li><li>正向工程：先创建Java实体类，由框架负责根据实体类生成数据库表。Hibernate是支持正向工程的</li><li>逆向工程：先创建数据库表，由框架负责根据数据库表，反向生成如下资源：  <ul><li>Java实体类  </li><li>Mapper接口  </li><li>Mapper映射文件<h2 id="1、创建逆向工程的步骤"><a href="#1、创建逆向工程的步骤" class="headerlink" title="1、创建逆向工程的步骤"></a>1、创建逆向工程的步骤</h2><h3 id="a-gt-添加依赖和插件"><a href="#a-gt-添加依赖和插件" class="headerlink" title="a&gt;添加依赖和插件"></a>a&gt;添加依赖和插件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- MyBatis核心依赖包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- junit测试 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- MySQL驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- log4j日志 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 控制Maven在构建过程中相关配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 构建过程中用到的插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 具体插件，逆向工程的操作是以构建过程中插件形式出现的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 插件的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 逆向工程的核心依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- MySQL驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="b-gt-创建MyBatis的核心配置文件"><a href="#b-gt-创建MyBatis的核心配置文件" class="headerlink" title="b&gt;创建MyBatis的核心配置文件"></a>b&gt;创建MyBatis的核心配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="c-gt-创建逆向工程的配置文件"><a href="#c-gt-创建逆向工程的配置文件" class="headerlink" title="c&gt;创建逆向工程的配置文件"></a>c&gt;创建逆向工程的配置文件</h3></li></ul></li><li>文件名必须是：<code>generatorConfig.xml</code><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    targetRuntime: 执行生成的逆向工程的版本</span></span><br><span class="line"><span class="comment">    MyBatis3Simple: 生成基本的CRUD（清新简洁版）</span></span><br><span class="line"><span class="comment">    MyBatis3: 生成带条件的CRUD（奢华尊享版）</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库的连接信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- javaBean的生成策略--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.zhang.mybatis.entity&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SQL映射文件的生成策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.zhang.mybatis.mappers&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Mapper接口的生成策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetPackage</span>=<span class="string">&quot;com.zhang.mybatis.mappers&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 逆向分析的表 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tableName设置为*号，可以对应所有表，此时不写domainObjectName --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- domainObjectName属性指定生成出来的实体类的类名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_emp&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Emp&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Dept&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="d-gt-执行MBG插件的generate目标"><a href="#d-gt-执行MBG插件的generate目标" class="headerlink" title="d&gt;执行MBG插件的generate目标"></a>d&gt;执行MBG插件的generate目标</h3></li><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%89%A7%E8%A1%8CMBG%E6%8F%92%E4%BB%B6%E7%9A%84generate%E7%9B%AE%E6%A0%87.png" alt=""></li><li>如果出现报错：<code>Exception getting JDBC Driver</code>，可能是pom.xml中，数据库驱动配置错误<ul><li>dependency中的驱动<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/dependency%E4%B8%AD%E7%9A%84%E9%A9%B1%E5%8A%A8.png" alt=""></li><li>mybatis-generator-maven-plugin插件中的驱动<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%8F%92%E4%BB%B6%E4%B8%AD%E7%9A%84%E9%A9%B1%E5%8A%A8.png" alt=""></li><li>两者的驱动版本应该相同</li></ul></li><li>执行结果<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E9%80%86%E5%90%91%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C.png" alt=""><h2 id="2、QBC"><a href="#2、QBC" class="headerlink" title="2、QBC"></a>2、QBC</h2><h3 id="a-gt-查询"><a href="#a-gt-查询" class="headerlink" title="a&gt;查询"></a>a&gt;查询</h3></li><li><code>selectByExample</code>：按条件查询，需要传入一个example对象或者null；如果传入一个null，则表示没有条件，也就是查询所有数据</li><li><code>example.createCriteria().xxx</code>：创建条件对象，通过andXXX方法为SQL添加查询添加，每个条件之间是and关系</li><li><code>example.or().xxx</code>：将之前添加的条件通过or拼接其他条件<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/example%E7%9A%84%E6%96%B9%E6%B3%95.png" alt=""><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMBG</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"><span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"><span class="type">EmpExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpExample</span>();</span><br><span class="line"><span class="comment">//名字为张三，且年龄大于等于20</span></span><br><span class="line">example.createCriteria().andEmpNameEqualTo(<span class="string">&quot;张三&quot;</span>).andAgeGreaterThanOrEqualTo(<span class="number">20</span>);</span><br><span class="line"><span class="comment">//或者did不为空</span></span><br><span class="line">example.or().andDidIsNotNull();</span><br><span class="line">List&lt;Emp&gt; emps = mapper.selectByExample(example);</span><br><span class="line">emps.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/example%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt=""><h3 id="b-gt-增改"><a href="#b-gt-增改" class="headerlink" title="b&gt;增改"></a>b&gt;增改</h3></li><li><code>updateByPrimaryKey</code>：通过主键进行数据修改，如果某一个值为null，也会将对应的字段改为null<ul><li><code>mapper.updateByPrimaryKey(new Emp(1,&quot;admin&quot;,22,null,&quot;456@qq.com&quot;,3));</code></li><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%A2%9E%E5%88%A0%E6%94%B9%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C1.png" alt=""></li></ul></li><li><code>updateByPrimaryKeySelective()</code>：通过主键进行选择性数据修改，如果某个值为null，则不修改这个字段<ul><li><code>mapper.updateByPrimaryKeySelective(new Emp(2,&quot;admin2&quot;,22,null,&quot;456@qq.com&quot;,3));</code></li><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%A2%9E%E5%88%A0%E6%94%B9%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C2.png" alt=""><h1 id="十二、分页插件"><a href="#十二、分页插件" class="headerlink" title="十二、分页插件"></a>十二、分页插件</h1><h2 id="1、分页插件使用步骤"><a href="#1、分页插件使用步骤" class="headerlink" title="1、分页插件使用步骤"></a>1、分页插件使用步骤</h2><h3 id="a-gt-添加依赖-1"><a href="#a-gt-添加依赖-1" class="headerlink" title="a&gt;添加依赖"></a>a&gt;添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="b-gt-配置分页插件"><a href="#b-gt-配置分页插件" class="headerlink" title="b&gt;配置分页插件"></a>b&gt;配置分页插件</h3></li></ul></li><li>在MyBatis的核心配置文件（mybatis-config.xml）中配置插件</li><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6.png" alt=""><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设置分页插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2、分页插件的使用"><a href="#2、分页插件的使用" class="headerlink" title="2、分页插件的使用"></a>2、分页插件的使用</h2><h3 id="a-gt-开启分页功能"><a href="#a-gt-开启分页功能" class="headerlink" title="a&gt;开启分页功能"></a>a&gt;开启分页功能</h3></li><li>在查询功能之前使用<code>PageHelper.startPage(int pageNum, int pageSize)</code>开启分页功能<ul><li>pageNum：当前页的页码  </li><li>pageSize：每页显示的条数<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageHelper</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"><span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"><span class="comment">//访问第一页，每页四条数据</span></span><br><span class="line">PageHelper.startPage(<span class="number">1</span>,<span class="number">4</span>);</span><br><span class="line">List&lt;Emp&gt; emps = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line">emps.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%88%86%E9%A1%B5%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt=""></p><h3 id="b-gt-分页相关数据"><a href="#b-gt-分页相关数据" class="headerlink" title="b&gt;分页相关数据"></a>b&gt;分页相关数据</h3><h4 id="方法一：直接输出"><a href="#方法一：直接输出" class="headerlink" title="方法一：直接输出"></a>方法一：直接输出</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageHelper</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"><span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"><span class="comment">//访问第一页，每页四条数据</span></span><br><span class="line">    <span class="comment">//使用`PageHelper.startPage(int pageNum,int pageSize);`</span></span><br><span class="line">Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">List&lt;Emp&gt; emps = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//在查询到List集合后，打印分页数据</span></span><br><span class="line">System.out.println(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>分页相关数据：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Page<span class="punctuation">&#123;</span>count=<span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> pageNum=<span class="number">1</span><span class="punctuation">,</span> pageSize=<span class="number">4</span><span class="punctuation">,</span> startRow=<span class="number">0</span><span class="punctuation">,</span> endRow=<span class="number">4</span><span class="punctuation">,</span> total=<span class="number">8</span><span class="punctuation">,</span> pages=<span class="number">2</span><span class="punctuation">,</span> reasonable=<span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span> pageSizeZero=<span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">[</span>Emp<span class="punctuation">&#123;</span>eid=<span class="number">1</span><span class="punctuation">,</span> empName=&#x27;admin&#x27;<span class="punctuation">,</span> age=<span class="number">22</span><span class="punctuation">,</span> sex=&#x27;男&#x27;<span class="punctuation">,</span> email=&#x27;<span class="number">456</span>@qq.com&#x27;<span class="punctuation">,</span> did=<span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> Emp<span class="punctuation">&#123;</span>eid=<span class="number">2</span><span class="punctuation">,</span> empName=&#x27;admin2&#x27;<span class="punctuation">,</span> age=<span class="number">22</span><span class="punctuation">,</span> sex=&#x27;男&#x27;<span class="punctuation">,</span> email=&#x27;<span class="number">456</span>@qq.com&#x27;<span class="punctuation">,</span> did=<span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> Emp<span class="punctuation">&#123;</span>eid=<span class="number">3</span><span class="punctuation">,</span> empName=&#x27;王五&#x27;<span class="punctuation">,</span> age=<span class="number">12</span><span class="punctuation">,</span> sex=&#x27;女&#x27;<span class="punctuation">,</span> email=&#x27;<span class="number">123</span>@qq.com&#x27;<span class="punctuation">,</span> did=<span class="number">3</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> Emp<span class="punctuation">&#123;</span>eid=<span class="number">4</span><span class="punctuation">,</span> empName=&#x27;赵六&#x27;<span class="punctuation">,</span> age=<span class="number">32</span><span class="punctuation">,</span> sex=&#x27;男&#x27;<span class="punctuation">,</span> email=&#x27;<span class="number">123</span>@qq.com&#x27;<span class="punctuation">,</span> did=<span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h4 id="方法二使用PageInfo"><a href="#方法二使用PageInfo" class="headerlink" title="方法二使用PageInfo"></a>方法二使用PageInfo</h4><ul><li>在查询获取list集合之后，使用<code>PageInfo&lt;T&gt; pageInfo = new PageInfo&lt;&gt;(List&lt;T&gt; list, intnavigatePages)</code>获取分页相关数据<ul><li>list：分页之后的数据  </li><li>navigatePages：导航分页的页码数 （一般是奇数）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageHelper</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"><span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line">PageHelper.startPage(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">List&lt;Emp&gt; emps = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line">PageInfo&lt;Emp&gt; page = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(emps,<span class="number">5</span>);</span><br><span class="line">System.out.println(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li>分页相关数据：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PageInfo&#123;</span><br><span class="line">pageNum=<span class="number">1</span>, pageSize=<span class="number">4</span>, size=<span class="number">4</span>, startRow=<span class="number">1</span>, endRow=<span class="number">4</span>, total=<span class="number">8</span>, pages=<span class="number">2</span>, </span><br><span class="line">list=Page&#123;count=<span class="literal">true</span>, pageNum=<span class="number">1</span>, pageSize=<span class="number">4</span>, startRow=<span class="number">0</span>, endRow=<span class="number">4</span>, total=<span class="number">8</span>, pages=<span class="number">2</span>, reasonable=<span class="literal">false</span>, pageSizeZero=<span class="literal">false</span>&#125;[Emp&#123;eid=<span class="number">1</span>, empName=<span class="string">&#x27;admin&#x27;</span>, age=<span class="number">22</span>, sex=<span class="string">&#x27;男&#x27;</span>, email=<span class="string">&#x27;456@qq.com&#x27;</span>, did=<span class="number">3</span>&#125;, Emp&#123;eid=<span class="number">2</span>, empName=<span class="string">&#x27;admin2&#x27;</span>, age=<span class="number">22</span>, sex=<span class="string">&#x27;男&#x27;</span>, email=<span class="string">&#x27;456@qq.com&#x27;</span>, did=<span class="number">3</span>&#125;, Emp&#123;eid=<span class="number">3</span>, empName=<span class="string">&#x27;王五&#x27;</span>, age=<span class="number">12</span>, sex=<span class="string">&#x27;女&#x27;</span>, email=<span class="string">&#x27;123@qq.com&#x27;</span>, did=<span class="number">3</span>&#125;, Emp&#123;eid=<span class="number">4</span>, empName=<span class="string">&#x27;赵六&#x27;</span>, age=<span class="number">32</span>, sex=<span class="string">&#x27;男&#x27;</span>, email=<span class="string">&#x27;123@qq.com&#x27;</span>, did=<span class="number">1</span>&#125;], </span><br><span class="line">prePage=<span class="number">0</span>, nextPage=<span class="number">2</span>, isFirstPage=<span class="literal">true</span>, isLastPage=<span class="literal">false</span>, hasPreviousPage=<span class="literal">false</span>, hasNextPage=<span class="literal">true</span>, navigatePages=<span class="number">5</span>, navigateFirstPage=<span class="number">1</span>, navigateLastPage=<span class="number">2</span>, navigatepageNums=[<span class="number">1</span>, <span class="number">2</span>]&#125;</span><br></pre></td></tr></table></figure><ul><li>其中list中的数据等同于方法一中直接输出的page数据<h4 id="常用数据："><a href="#常用数据：" class="headerlink" title="常用数据："></a>常用数据：</h4></li><li>pageNum：当前页的页码  </li><li>pageSize：每页显示的条数  </li><li>size：当前页显示的真实条数  </li><li>total：总记录数  </li><li>pages：总页数  </li><li>prePage：上一页的页码  </li><li>nextPage：下一页的页码</li><li>isFirstPage/isLastPage：是否为第一页/最后一页  </li><li>hasPreviousPage/hasNextPage：是否存在上一页/下一页  </li><li>navigatePages：导航分页的页码数  </li><li>navigatepageNums：导航分页的页码，[1,2,3,4,5]</li><li>getList ： 取出存入的数据（<code>List&lt;Emp&gt;</code>）</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC</title>
      <link href="/posts/2920256992.html"/>
      <url>/posts/2920256992.html</url>
      
        <content type="html"><![CDATA[<h1 id="一、SpringMVC简介"><a href="#一、SpringMVC简介" class="headerlink" title="一、SpringMVC简介"></a>一、SpringMVC简介</h1><h3 id="1、什么是MVC"><a href="#1、什么是MVC" class="headerlink" title="1、什么是MVC"></a>1、什么是MVC</h3><p>MVC是一种软件架构的思想，将软件按照模型、视图、控制器来划分</p><p>M：Model，模型层，指工程中的JavaBean，作用是处理数据</p><p>JavaBean分为两类：</p><ul><li>一类称为实体类Bean：专门存储业务数据的，如 Student、User 等</li><li>一类称为业务处理 Bean：指 Service 或 Dao 对象，专门用于处理业务逻辑和数据访问。</li></ul><p>V：View，视图层，指工程中的html或jsp等页面，作用是与用户进行交互，展示数据</p><p>C：Controller，控制层，指工程中的servlet，作用是接收请求和响应浏览器</p><p>MVC的工作流程：<br>用户通过视图层发送请求到服务器，在服务器中请求被Controller接收，Controller调用相应的Model层处理请求，处理完毕将结果返回到Controller，Controller再根据请求处理的结果找到相应的View视图，渲染数据后最终响应给浏览器</p><h3 id="2、什么是SpringMVC"><a href="#2、什么是SpringMVC" class="headerlink" title="2、什么是SpringMVC"></a>2、什么是SpringMVC</h3><p>SpringMVC是Spring的一个后续产品，是Spring的一个子项目</p><p>SpringMVC 是 Spring 为表述层开发提供的一整套完备的解决方案。在表述层框架历经 Strust、WebWork、Strust2 等诸多产品的历代更迭之后，目前业界普遍选择了 SpringMVC 作为 Java EE 项目表述层开发的<strong>首选方案</strong>。</p><blockquote><p>注：三层架构分为表述层（或表示层）、业务逻辑层、数据访问层，表述层表示前台页面和后台servlet</p></blockquote><h3 id="3、SpringMVC的特点"><a href="#3、SpringMVC的特点" class="headerlink" title="3、SpringMVC的特点"></a>3、SpringMVC的特点</h3><ul><li><strong>Spring 家族原生产品</strong>，与 IOC 容器等基础设施无缝对接</li><li><strong>基于原生的Servlet</strong>，通过了功能强大的<strong>前端控制器DispatcherServlet</strong>，对请求和响应进行统一处理</li><li>表述层各细分领域需要解决的问题<strong>全方位覆盖</strong>，提供<strong>全面解决方案</strong></li><li><strong>代码清新简洁</strong>，大幅度提升开发效率</li><li>内部组件化程度高，可插拔式组件<strong>即插即用</strong>，想要什么功能配置相应组件即可</li><li><strong>性能卓著</strong>，尤其适合现代大型、超大型互联网项目要求</li></ul><h1 id="二、HelloWorld"><a href="#二、HelloWorld" class="headerlink" title="二、HelloWorld"></a>二、HelloWorld</h1><h3 id="1、开发环境"><a href="#1、开发环境" class="headerlink" title="1、开发环境"></a>1、开发环境</h3><p>IDE：idea 2021.2</p><p>构建工具：maven3.6.3</p><p>服务器：tomcat9</p><p>Spring版本：5.3.1</p><h3 id="2、创建maven工程"><a href="#2、创建maven工程" class="headerlink" title="2、创建maven工程"></a>2、创建maven工程</h3><h5 id="a-gt-添加web模块"><a href="#a-gt-添加web模块" class="headerlink" title="a&gt;添加web模块"></a>a&gt;添加web模块</h5><h5 id="b-gt-打包方式：war"><a href="#b-gt-打包方式：war" class="headerlink" title="b&gt;打包方式：war"></a>b&gt;打包方式：war</h5><h5 id="c-gt-引入依赖"><a href="#c-gt-引入依赖" class="headerlink" title="c&gt;引入依赖"></a>c&gt;引入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringMVC --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ServletAPI --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- tomcat10：--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;jakarta.servlet&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;jakarta.servlet-api&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;4.0.4&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;scope&gt;provided&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring5和Thymeleaf整合包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注：由于 Maven 的传递性，我们不必将所有需要的包全部配置依赖，而是配置最顶端的依赖，其他靠传递性导入。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img001.png" alt=""></p><h3 id="3、配置web-xml"><a href="#3、配置web-xml" class="headerlink" title="3、配置web.xml"></a>3、配置web.xml</h3><p>注册SpringMVC的前端控制器DispatcherServlet</p><h5 id="a-gt-默认配置方式"><a href="#a-gt-默认配置方式" class="headerlink" title="a&gt;默认配置方式"></a>a&gt;默认配置方式</h5><p>此配置作用下，SpringMVC的配置文件默认位于WEB-INF下，默认名称为\<servlet-name>-servlet.xml，例如，以下配置所对应SpringMVC的配置文件位于WEB-INF下，文件名为springMVC-servlet.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置SpringMVC的前端控制器，对浏览器发送的请求统一进行处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        设置springMVC的核心控制器所能处理的请求的请求路径</span></span><br><span class="line"><span class="comment">        /所匹配的请求可以是/login或.html或.js或.css方式的请求路径</span></span><br><span class="line"><span class="comment">        但是/不能匹配.jsp请求路径的请求</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-gt-扩展配置方式"><a href="#b-gt-扩展配置方式" class="headerlink" title="b&gt;扩展配置方式"></a>b&gt;扩展配置方式</h5><p>可通过init-param标签设置SpringMVC配置文件的位置和名称，通过load-on-startup标签设置SpringMVC前端控制器DispatcherServlet的初始化时间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置SpringMVC的前端控制器，对浏览器发送的请求统一进行处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过初始化参数指定SpringMVC配置文件的位置和名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- contextConfigLocation为固定值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用classpath:表示从类路径查找配置文件，例如maven工程中的src/main/resources --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> 作为框架的核心组件，在启动过程中有大量的初始化操作要做</span></span><br><span class="line"><span class="comment">而这些操作放在第一次请求时才执行会严重影响访问速度</span></span><br><span class="line"><span class="comment">因此需要通过此标签将启动控制DispatcherServlet的初始化时间提前到服务器启动时</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        设置springMVC的核心控制器所能处理的请求的请求路径</span></span><br><span class="line"><span class="comment">        /所匹配的请求可以是/login或.html或.js或.css方式的请求路径</span></span><br><span class="line"><span class="comment">        但是/不能匹配.jsp请求路径的请求</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>\<url-pattern>标签中使用/和/*的区别：</p><p>/所匹配的请求可以是/login或.html或.js或.css方式的请求路径，但是/不能匹配.jsp请求路径的请求</p><p>因此就可以避免在访问jsp页面时，该请求被DispatcherServlet处理，从而找不到相应的页面</p><p>/<em>则能够匹配所有请求，例如在使用过滤器时，若需要对所有请求进行过滤，就需要使用/\</em>的写法</p></blockquote><h3 id="4、创建请求控制器"><a href="#4、创建请求控制器" class="headerlink" title="4、创建请求控制器"></a>4、创建请求控制器</h3><p>由于前端控制器对浏览器发送的请求进行了统一的处理，但是具体的请求有不同的处理过程，因此需要创建处理具体请求的类，即请求控制器</p><p>请求控制器中每一个处理请求的方法成为控制器方法</p><p>因为SpringMVC的控制器由一个POJO（普通的Java类）担任，因此需要通过@Controller注解将其标识为一个控制层组件，交给Spring的IoC容器管理，此时SpringMVC才能够识别控制器的存在</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5、创建springMVC的配置文件"><a href="#5、创建springMVC的配置文件" class="headerlink" title="5、创建springMVC的配置文件"></a>5、创建springMVC的配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自动扫描包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.mvc.controller&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置Thymeleaf视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring5.view.ThymeleafViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span><span class="comment">&lt;!-- 设置优先级为1 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span><span class="comment">&lt;!-- 设置字符集编码为 UTF-8 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateEngine&quot;</span>&gt;</span><span class="comment">&lt;!-- 使用内部bean配置模板引擎的配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring5.SpringTemplateEngine&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateResolver&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!-- 视图前缀 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/templates/&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!-- 视图后缀 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.html&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateMode&quot;</span> <span class="attr">value</span>=<span class="string">&quot;HTML5&quot;</span>/&gt;</span><span class="comment">&lt;!-- 设置模板模型为HTML5 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><span class="comment">&lt;!-- 设置字符集编码为 UTF-8 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">   处理静态资源，例如html、js、css、jpg</span></span><br><span class="line"><span class="comment">  若只设置该标签，则只能访问静态资源，其他请求则无法访问</span></span><br><span class="line"><span class="comment">  此时必须设置&lt;mvc:annotation-driven/&gt;解决问题</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启mvc注解驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 处理响应中文内容乱码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultCharset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>application/json<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6、测试HelloWorld"><a href="#6、测试HelloWorld" class="headerlink" title="6、测试HelloWorld"></a>6、测试HelloWorld</h3><h5 id="a-gt-实现对首页的访问"><a href="#a-gt-实现对首页的访问" class="headerlink" title="a&gt;实现对首页的访问"></a>a&gt;实现对首页的访问</h5><p>在请求控制器中创建处理请求的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @RequestMapping注解：处理请求和控制器方法之间的映射关系</span></span><br><span class="line"><span class="comment">// @RequestMapping注解的value属性可以通过请求地址匹配请求，/表示的当前工程的上下文路径</span></span><br><span class="line"><span class="comment">// localhost:8080/springMVC/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//设置视图名称</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-gt-通过超链接跳转到指定页面"><a href="#b-gt-通过超链接跳转到指定页面" class="headerlink" title="b&gt;通过超链接跳转到指定页面"></a>b&gt;通过超链接跳转到指定页面</h5><p>在主页index.html中设置超链接</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/hello&#125;&quot;</span>&gt;</span>HelloWorld<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在请求控制器中创建处理请求的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">HelloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7、总结"><a href="#7、总结" class="headerlink" title="7、总结"></a>7、总结</h3><p>浏览器发送请求，若请求地址符合前端控制器的url-pattern，该请求就会被前端控制器DispatcherServlet处理。前端控制器会读取SpringMVC的核心配置文件，通过扫描组件找到控制器，将请求地址和控制器中@RequestMapping注解的value属性值进行匹配，若匹配成功，该注解所标识的控制器方法就是处理请求的方法。处理请求的方法需要返回一个字符串类型的视图名称，该视图名称会被视图解析器解析，加上前缀和后缀组成视图的路径，通过Thymeleaf对视图进行渲染，最终转发到视图所对应页面</p><h1 id="三、-RequestMapping注解"><a href="#三、-RequestMapping注解" class="headerlink" title="三、@RequestMapping注解"></a>三、@RequestMapping注解</h1><h3 id="1、-RequestMapping注解的功能"><a href="#1、-RequestMapping注解的功能" class="headerlink" title="1、@RequestMapping注解的功能"></a>1、@RequestMapping注解的功能</h3><p>从注解名称上我们可以看到，@RequestMapping注解的作用就是将请求和处理请求的控制器方法关联起来，建立映射关系。</p><p>SpringMVC 接收到指定的请求，就会来找到在映射关系中对应的控制器方法来处理这个请求。</p><h3 id="2、-RequestMapping注解的位置"><a href="#2、-RequestMapping注解的位置" class="headerlink" title="2、@RequestMapping注解的位置"></a>2、@RequestMapping注解的位置</h3><p>@RequestMapping标识一个类：设置映射请求的请求路径的初始信息</p><p>@RequestMapping标识一个方法：设置映射请求请求路径的具体信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestMappingController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此时请求映射所映射的请求的请求路径为：/test/testRequestMapping</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testRequestMapping&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、-RequestMapping注解的value属性"><a href="#3、-RequestMapping注解的value属性" class="headerlink" title="3、@RequestMapping注解的value属性"></a>3、@RequestMapping注解的value属性</h3><p>@RequestMapping注解的value属性通过请求的请求地址匹配请求映射</p><p>@RequestMapping注解的value属性是一个字符串类型的数组，表示该请求映射能够匹配多个请求地址所对应的请求</p><p>@RequestMapping注解的value属性必须设置，至少通过请求地址匹配请求映射</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testRequestMapping&#125;&quot;</span>&gt;</span>测试@RequestMapping的value属性--&gt;/testRequestMapping<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/test&#125;&quot;</span>&gt;</span>测试@RequestMapping的value属性--&gt;/test<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;/testRequestMapping&quot;, &quot;/test&quot;&#125;//满足一个就可以</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、-RequestMapping注解的method属性"><a href="#4、-RequestMapping注解的method属性" class="headerlink" title="4、@RequestMapping注解的method属性"></a>4、@RequestMapping注解的method属性</h3><p>@RequestMapping注解的method属性通过请求的请求方式（get或post）匹配请求映射</p><p>@RequestMapping注解的method属性是一个RequestMethod类型的数组，表示该请求映射能够匹配多种请求方式的请求</p><p>若当前请求的请求地址满足请求映射的value属性，但是请求方式不满足method属性，则浏览器报错405：Request method ‘POST’ not supported</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/test&#125;&quot;</span>&gt;</span>测试@RequestMapping的value属性--&gt;/test<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/test&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;/testRequestMapping&quot;, &quot;/test&quot;&#125;,</span></span><br><span class="line"><span class="meta">        method = &#123;RequestMethod.GET, RequestMethod.POST&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>1、对于处理指定请求方式的控制器方法，SpringMVC中提供了@RequestMapping的派生注解</p><p>处理get请求的映射—&gt;@GetMapping</p><p>处理post请求的映射—&gt;@PostMapping</p><p>处理put请求的映射—&gt;@PutMapping</p><p>处理delete请求的映射—&gt;@DeleteMapping</p><p>2、常用的请求方式有get，post，put，delete</p><p>但是目前浏览器只支持get和post，若在form表单提交时，为method设置了其他请求方式的字符串（put或delete），则按照默认的请求方式get处理</p><p>若要发送put和delete请求，则需要通过spring提供的过滤器HiddenHttpMethodFilter，在RESTful部分会讲到</p></blockquote><h3 id="5、-RequestMapping注解的params属性（了解）"><a href="#5、-RequestMapping注解的params属性（了解）" class="headerlink" title="5、@RequestMapping注解的params属性（了解）"></a>5、@RequestMapping注解的params属性（了解）</h3><p>@RequestMapping注解的params属性通过请求的请求参数匹配请求映射</p><p>@RequestMapping注解的params属性是一个字符串类型的数组，可以通过四种表达式设置请求参数和请求映射的匹配关系</p><p>“param”：要求请求映射所匹配的请求必须携带param请求参数</p><p>“!param”：要求请求映射所匹配的请求必须不能携带param请求参数</p><p>“param=value”：要求请求映射所匹配的请求必须携带param请求参数且param=value</p><p>“param!=value”：要求请求映射所匹配的请求必须携带param请求参数但是param!=value</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/test(username=&#x27;admin&#x27;,password=123456)&quot;</span>&gt;</span>测试@RequestMapping的params属性--&gt;/test<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;/testRequestMapping&quot;, &quot;/test&quot;&#125;</span></span><br><span class="line"><span class="meta">        ,method = &#123;RequestMethod.GET, RequestMethod.POST&#125;</span></span><br><span class="line"><span class="meta">        ,params = &#123;&quot;username&quot;,&quot;password!=123456&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>若当前请求满足@RequestMapping注解的value和method属性，但是不满足params属性，此时页面回报错400：Parameter conditions “username, password!=123456” not met for actual request parameters: username={admin}, password={123456}</p></blockquote><h3 id="6、-RequestMapping注解的headers属性（了解）"><a href="#6、-RequestMapping注解的headers属性（了解）" class="headerlink" title="6、@RequestMapping注解的headers属性（了解）"></a>6、@RequestMapping注解的headers属性（了解）</h3><p>@RequestMapping注解的headers属性通过请求的请求头信息匹配请求映射</p><p>@RequestMapping注解的headers属性是一个字符串类型的数组，可以通过四种表达式设置请求头信息和请求映射的匹配关系</p><p>“header”：要求请求映射所匹配的请求必须携带header请求头信息</p><p>“!header”：要求请求映射所匹配的请求必须不能携带header请求头信息</p><p>“header=value”：要求请求映射所匹配的请求必须携带header请求头信息且header=value</p><p>“header!=value”：要求请求映射所匹配的请求必须携带header请求头信息且header!=value</p><p>若当前请求满足@RequestMapping注解的value和method属性，但是不满足headers属性，此时页面显示404错误，即资源未找到</p><h3 id="7、SpringMVC支持ant风格的路径"><a href="#7、SpringMVC支持ant风格的路径" class="headerlink" title="7、SpringMVC支持ant风格的路径"></a>7、SpringMVC支持ant风格的路径</h3><p>？：表示任意的单个字符</p><p>*：表示任意的0个或多个字符</p><p>**：表示任意的一层或多层目录</p><blockquote><p>注意：在使用*<em>时，只能使用/*</em>/xxx的方式</p></blockquote><h3 id="8、SpringMVC支持路径中的占位符（重点）"><a href="#8、SpringMVC支持路径中的占位符（重点）" class="headerlink" title="8、SpringMVC支持路径中的占位符（重点）"></a>8、SpringMVC支持路径中的占位符（重点）</h3><p>原始方式：/deleteUser?id=1</p><p>rest方式：/deleteUser/1</p><p>SpringMVC路径中的占位符常用于RESTful风格中，当请求路径中将某些数据通过路径的方式传输到服务器中，就可以在相应的@RequestMapping注解的value属性中通过占位符{xxx}表示传输的数据，在通过@PathVariable注解，将占位符所表示的数据赋值给控制器方法的形参</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testRest/1/admin&#125;&quot;</span>&gt;</span>测试路径中的占位符--&gt;/testRest<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRest/&#123;id&#125;/&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRest</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id, <span class="meta">@PathVariable(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;id:&quot;</span>+id+<span class="string">&quot;,username:&quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最终输出的内容为--&gt;id:1,username:admin</span></span><br></pre></td></tr></table></figure><h1 id="四、SpringMVC获取请求参数"><a href="#四、SpringMVC获取请求参数" class="headerlink" title="四、SpringMVC获取请求参数"></a>四、SpringMVC获取请求参数</h1><h3 id="1、通过ServletAPI获取"><a href="#1、通过ServletAPI获取" class="headerlink" title="1、通过ServletAPI获取"></a>1、通过ServletAPI获取</h3><p>将HttpServletRequest作为控制器方法的形参，此时HttpServletRequest类型的参数表示封装了当前请求的请求报文的对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testParam</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;username:&quot;</span>+username+<span class="string">&quot;,password:&quot;</span>+password);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、通过控制器方法的形参获取请求参数"><a href="#2、通过控制器方法的形参获取请求参数" class="headerlink" title="2、通过控制器方法的形参获取请求参数"></a>2、通过控制器方法的形参获取请求参数</h3><p>在控制器方法的形参位置，设置和请求参数同名的形参，当浏览器发送请求，匹配到请求映射时，在DispatcherServlet中就会将请求参数赋值给相应的形参</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testParam(username=&#x27;admin&#x27;,password=123456)&#125;&quot;</span>&gt;</span>测试获取请求参数--&gt;/testParam<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testParam</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username:&quot;</span>+username+<span class="string">&quot;,password:&quot;</span>+password);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>若请求所传输的请求参数中有多个同名的请求参数，此时可以在控制器方法的形参中设置字符串数组或者字符串类型的形参接收此请求参数</p><p>若使用字符串数组类型的形参，此参数的数组中包含了每一个数据</p><p>若使用字符串类型的形参，此参数的值为每个数据中间使用逗号拼接的结果</p></blockquote><h3 id="3、-RequestParam"><a href="#3、-RequestParam" class="headerlink" title="3、@RequestParam"></a>3、@RequestParam</h3><p>@RequestParam是将请求参数和控制器方法的形参创建映射关系</p><p>@RequestParam注解一共有三个属性：</p><p>value：指定为形参赋值的请求参数的参数名</p><p>required：设置是否必须传输此请求参数，默认值为true</p><p>若设置为true时，则当前请求必须传输value所指定的请求参数，若没有传输该请求参数，且没有设置defaultValue属性，则页面报错400：Required String parameter ‘xxx’ is not present；若设置为false，则当前请求不是必须传输value所指定的请求参数，若没有传输，则注解所标识的形参的值为null</p><p>defaultValue：不管required属性值为true或false，当value所指定的请求参数没有传输或传输的值为””时，则使用默认值为形参赋值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testParam</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(value = &quot;username&quot;,required = false,defaultValue=&quot;hahaha&quot;)</span> String user_name,</span></span><br><span class="line"><span class="params">    String password)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>上面的代码说明：user_name是请求username的参数（实际上传过来的参数名是username），是不必要的参数（有就用该值，没有就是null），defaultValue给参数设置一个默认值为”hahaha”,如果传过来的参数没有，或者为””则使用这个默认值</p></blockquote><h3 id="4、-RequestHeader"><a href="#4、-RequestHeader" class="headerlink" title="4、@RequestHeader"></a>4、@RequestHeader</h3><p>@RequestHeader是将请求头信息和控制器方法的形参创建映射关系</p><p>@RequestHeader注解一共有三个属性：value、required、defaultValue，用法同@RequestParam</p><h3 id="5、-CookieValue"><a href="#5、-CookieValue" class="headerlink" title="5、@CookieValue"></a>5、@CookieValue</h3><p>@CookieValue是将cookie数据和控制器方法的形参创建映射关系</p><p>@CookieValue注解一共有三个属性：value、required、defaultValue，用法同@RequestParam</p><h3 id="6、通过POJO获取请求参数"><a href="#6、通过POJO获取请求参数" class="headerlink" title="6、通过POJO获取请求参数"></a>6、通过POJO获取请求参数</h3><p>可以在控制器方法的形参位置设置一个实体类类型的形参，此时<span style="color:blue;font-family:楷体">若浏览器传输的请求参数的参数名和实体类中的属性名一致</span>，那么请求参数就会为此属性赋值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/testpojo&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    性别：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span>&gt;</span>男<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;女&quot;</span>&gt;</span>女<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    邮箱：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testpojo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testPOJO</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最终结果--&gt;User&#123;id=null, username=&#x27;张三&#x27;, password=&#x27;123&#x27;, age=23, sex=&#x27;男&#x27;, email=&#x27;123@qq.com&#x27;&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>User实体类中一定要有对应参数的set方法，否则无法初始化值</p></blockquote><h3 id="7、解决获取请求参数的乱码问题"><a href="#7、解决获取请求参数的乱码问题" class="headerlink" title="7、解决获取请求参数的乱码问题"></a>7、解决获取请求参数的乱码问题</h3><p>解决获取请求参数的乱码问题，可以使用SpringMVC提供的编码过滤器CharacterEncodingFilter，但是必须在web.xml中进行注册</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置springMVC的编码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>SpringMVC中处理编码的过滤器一定要配置到其他过滤器之前，否则无效</p></blockquote><h1 id="五、域对象共享数据"><a href="#五、域对象共享数据" class="headerlink" title="五、域对象共享数据"></a>五、域对象共享数据</h1><h3 id="1、使用ServletAPI向request域对象共享数据"><a href="#1、使用ServletAPI向request域对象共享数据" class="headerlink" title="1、使用ServletAPI向request域对象共享数据"></a>1、使用ServletAPI向request域对象共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testServletAPI&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testServletAPI</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    request.setAttribute(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,servletAPI&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、使用ModelAndView向request域对象共享数据"><a href="#2、使用ModelAndView向request域对象共享数据" class="headerlink" title="2、使用ModelAndView向request域对象共享数据"></a>2、使用ModelAndView向request域对象共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModelAndView&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">testModelAndView</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ModelAndView有Model和View的功能</span></span><br><span class="line"><span class="comment">     * Model主要用于向请求域共享数据</span></span><br><span class="line"><span class="comment">     * View主要用于设置视图，实现页面跳转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    <span class="comment">//向请求域共享数据</span></span><br><span class="line">    mav.addObject(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,ModelAndView&quot;</span>);</span><br><span class="line">    <span class="comment">//设置视图，实现页面跳转</span></span><br><span class="line">    mav.setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、使用Model向request域对象共享数据"><a href="#3、使用Model向request域对象共享数据" class="headerlink" title="3、使用Model向request域对象共享数据"></a>3、使用Model向request域对象共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testModel</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,Model&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、使用map向request域对象共享数据"><a href="#4、使用map向request域对象共享数据" class="headerlink" title="4、使用map向request域对象共享数据"></a>4、使用map向request域对象共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>&#123;</span><br><span class="line">    map.put(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,Map&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5、使用ModelMap向request域对象共享数据"><a href="#5、使用ModelMap向request域对象共享数据" class="headerlink" title="5、使用ModelMap向request域对象共享数据"></a>5、使用ModelMap向request域对象共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModelMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testModelMap</span><span class="params">(ModelMap modelMap)</span>&#123;</span><br><span class="line">    modelMap.addAttribute(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,ModelMap&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6、Model、ModelMap、Map的关系"><a href="#6、Model、ModelMap、Map的关系" class="headerlink" title="6、Model、ModelMap、Map的关系"></a>6、Model、ModelMap、Map的关系</h3><p>Model、ModelMap、Map类型的参数其实本质上都是 BindingAwareModelMap 类型的(本质上是一个类)</p><p><span style="color:brown;font-family:宋体;font-size:18px">Model和ModelMap的语法几乎一样，Map储存数据使用原本Map的语法使用put()</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Model</span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModelMap</span> <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>&lt;String, Object&gt; &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtendedModelMap</span> <span class="keyword">extends</span> <span class="title class_">ModelMap</span> <span class="keyword">implements</span> <span class="title class_">Model</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BindingAwareModelMap</span> <span class="keyword">extends</span> <span class="title class_">ExtendedModelMap</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="7、向session域共享数据"><a href="#7、向session域共享数据" class="headerlink" title="7、向session域共享数据"></a>7、向session域共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testSession&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testSession</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;testSessionScope&quot;</span>, <span class="string">&quot;hello,session&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8、向application域共享数据"><a href="#8、向application域共享数据" class="headerlink" title="8、向application域共享数据"></a>8、向application域共享数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testApplication&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testApplication</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line"><span class="type">ServletContext</span> <span class="variable">application</span> <span class="operator">=</span> session.getServletContext();</span><br><span class="line">    application.setAttribute(<span class="string">&quot;testApplicationScope&quot;</span>, <span class="string">&quot;hello,application&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="六、SpringMVC的视图"><a href="#六、SpringMVC的视图" class="headerlink" title="六、SpringMVC的视图"></a>六、SpringMVC的视图</h1><p>SpringMVC中的视图是View接口，视图的作用渲染数据，将模型Model中的数据展示给用户</p><p>SpringMVC视图的种类很多，默认有转发视图和重定向视图</p><p>当工程引入jstl的依赖，转发视图会自动转换为JstlView</p><p>若使用的视图技术为Thymeleaf，在SpringMVC的配置文件中配置了Thymeleaf的视图解析器，由此视图解析器解析之后所得到的是ThymeleafView</p><h3 id="1、ThymeleafView"><a href="#1、ThymeleafView" class="headerlink" title="1、ThymeleafView"></a>1、ThymeleafView</h3><p>当控制器方法中所<span style="color:blue">设置的视图名称没有任何前缀时</span>，此时的视图名称会被SpringMVC配置文件中所配置的视图解析器解析，视图名称拼接视图前缀和视图后缀所得到的最终路径，会通过转发的方式实现跳转</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testHello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testHello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img002.png" alt=""></p><h3 id="2、转发视图"><a href="#2、转发视图" class="headerlink" title="2、转发视图"></a>2、转发视图</h3><p>SpringMVC中默认的转发视图是InternalResourceView</p><p>SpringMVC中创建转发视图的情况：</p><p>当控制器方法中所设置的视图名称以”forward:”为前缀时，创建InternalResourceView视图，此时的视图名称不会被SpringMVC配置文件中所配置的视图解析器解析，而是会将前缀”forward:”去掉，剩余部分作为最终路径通过转发的方式实现跳转</p><p>例如”forward:/“，”forward:/employee”</p><p><span style="color:blue">当前缀有<code>forward：</code>作为前缀</span>才会调用InternalResourceView</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testForward&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testForward</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/testHello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img003.png" alt="image-20210706201316593"></p><h3 id="3、重定向视图"><a href="#3、重定向视图" class="headerlink" title="3、重定向视图"></a>3、重定向视图</h3><p>SpringMVC中默认的重定向视图是RedirectView</p><p>当控制器方法中所<span style="color:blue">设置的视图名称以”redirect:”为前缀时</span>，创建RedirectView视图，此时的视图名称不会被SpringMVC配置文件中所配置的视图解析器解析，而是会将前缀”redirect:”去掉，剩余部分作为最终路径通过重定向的方式实现跳转</p><p>例如”redirect:/“，”redirect:/employee”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRedirect&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRedirect</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/testHello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img004.png" alt="image-20210706201602267"></p><blockquote><p>注：</p><p>重定向视图在解析时，会先将redirect:前缀去掉，然后会判断剩余部分是否以/开头，若是则会自动拼接上下文路径</p></blockquote><h3 id="4、视图控制器view-controller"><a href="#4、视图控制器view-controller" class="headerlink" title="4、视图控制器view-controller"></a>4、视图控制器view-controller</h3><p>当控制器方法中，仅仅用来实现页面跳转，即只需要设置视图名称时，可以将处理器方法使用view-controller标签进行表示</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">path：设置处理的请求地址</span></span><br><span class="line"><span class="comment">view-name：设置请求地址所对应的视图名称</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/testView&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;success&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:view-controller</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>当SpringMVC中设置任何一个view-controller时，其他控制器中的请求映射将全部失效，此时需要在SpringMVC的核心配置文件中设置开启mvc注解驱动的标签：</p><p><code>&lt;mvc:annotation-driven /&gt;</code></p></blockquote><h1 id="七、RESTful"><a href="#七、RESTful" class="headerlink" title="七、RESTful"></a>七、RESTful</h1><h3 id="1、RESTful简介"><a href="#1、RESTful简介" class="headerlink" title="1、RESTful简介"></a>1、RESTful简介</h3><p>REST：<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer，表现层资源状态转移。</p><h5 id="a-gt-资源"><a href="#a-gt-资源" class="headerlink" title="a&gt;资源"></a>a&gt;资源</h5><p>资源是一种看待服务器的方式，即，将服务器看作是由很多离散的资源组成。每个资源是服务器上一个可命名的抽象概念。因为资源是一个抽象的概念，所以它不仅仅能代表服务器文件系统中的一个文件、数据库中的一张表等等具体的东西，可以将资源设计的要多抽象有多抽象，只要想象力允许而且客户端应用开发者能够理解。与面向对象设计类似，资源是==以名词为核心来组织的==，首先关注的是名词。一个资源可以由一个或多个URI来标识。URI既是资源的名称，也是资源在Web上的地址。对某个资源感兴趣的客户端应用，可以通过资源的URI与其进行交互。</p><h5 id="b-gt-资源的表述"><a href="#b-gt-资源的表述" class="headerlink" title="b&gt;资源的表述"></a>b&gt;资源的表述</h5><p>资源的表述是一段对于资源在某个特定时刻的状态的描述。可以在客户端-服务器端之间转移（交换）。资源的表述可以有多种格式，例如HTML/XML/JSON/纯文本/图片/视频/音频等等。资源的表述格式可以通过协商机制来确定。请求-响应方向的表述通常使用不同的格式。</p><h5 id="c-gt-状态转移"><a href="#c-gt-状态转移" class="headerlink" title="c&gt;状态转移"></a>c&gt;状态转移</h5><p>状态转移说的是：在客户端和服务器端之间转移（transfer）代表资源状态的表述。通过转移和操作资源的表述，来间接实现操作资源的目的。</p><h3 id="2、RESTful的实现"><a href="#2、RESTful的实现" class="headerlink" title="2、RESTful的实现"></a>2、RESTful的实现</h3><p>具体说，就是 HTTP 协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。</p><p>它们分别对应四种基本操作：GET 用来获取资源，POST 用来新建资源，PUT 用来更新资源，DELETE 用来删除资源。</p><p>==REST 风格提倡 URL 地址使用统一的风格设计，从前到后各个单词使用斜杠分开，不使用问号键值对方式携带请求参数，而是将要发送给服务器的数据作为 URL 地址的一部分==，以保证整体风格的一致性。</p><div class="table-container"><table><thead><tr><th>操作</th><th>传统方式</th><th>REST风格</th></tr></thead><tbody><tr><td>查询操作</td><td>getUserById?id=1</td><td>user/1—&gt;get请求方式</td></tr><tr><td>保存操作</td><td>saveUser</td><td>user—&gt;post请求方式</td></tr><tr><td>删除操作</td><td>deleteUser?id=1</td><td>user/1—&gt;delete请求方式</td></tr><tr><td>更新操作</td><td>updateUser</td><td>user—&gt;put请求方式</td></tr></tbody></table></div><h3 id="3、HiddenHttpMethodFilter"><a href="#3、HiddenHttpMethodFilter" class="headerlink" title="3、HiddenHttpMethodFilter"></a>3、HiddenHttpMethodFilter</h3><p>由于浏览器只支持发送get和post方式的请求，那么该如何发送put和delete请求呢？</p><p>==SpringMVC 提供了 <strong>HiddenHttpMethodFilter</strong> 帮助我们<strong>将 POST 请求转换为 DELETE 或 PUT 请求</strong>==</p><p><strong>HiddenHttpMethodFilter</strong> 处理put和delete请求的条件：</p><p>a&gt;当前请求的请求方式必须为post</p><p>b&gt;当前请求必须传输请求参数_method</p><p>满足以上条件，<strong>HiddenHttpMethodFilter</strong> 过滤器就会将当前请求的请求方式转换为请求参数_method的值，因此请求参数_method的值才是最终的请求方式</p><p>使用时要在web.xml中注册<strong>HiddenHttpMethodFilter</strong> </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注：</p><p>目前为止，SpringMVC中提供了两个过滤器：CharacterEncodingFilter和HiddenHttpMethodFilter</p><p>在web.xml中注册时，必须先注册CharacterEncodingFilter，再注册HiddenHttpMethodFilter（写在web.xml的上面的配置先执行，这个先注册指的是注册的代码位置要在上面一点）</p><p>原因：</p><ul><li><p>在 CharacterEncodingFilter 中通过 request.setCharacterEncoding(encoding) 方法设置字符集的</p></li><li><p>request.setCharacterEncoding(encoding) 方法要求前面不能有任何获取请求参数的操作</p></li><li><p>而 HiddenHttpMethodFilter 恰恰有一个获取请求方式的操作：</p></li><li><p>```java<br>String paramValue = request.getParameter(this.methodParam);</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HTML页面中提交PUT方法的写法 (后端的代码不用改)</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;form th:action=&quot;@&#123;/user&#125;&quot; method=&quot;post&quot;&gt;&lt;!-- 满足条件a，请求方式为post --&gt;</span><br><span class="line">   &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;put&quot;&gt;&lt;!--写个隐藏域，不让用户看见，传的请求参数一定要是_method --&gt;</span><br><span class="line">   用户名：&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br/&gt;</span><br><span class="line">   密码：&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br/&gt;</span><br><span class="line">   &lt;input type=&quot;submit&quot; value=&quot;修改&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></li></ul></blockquote><h1 id="八、RESTful案例"><a href="#八、RESTful案例" class="headerlink" title="八、RESTful案例"></a>八、RESTful案例</h1><h3 id="1、准备工作"><a href="#1、准备工作" class="headerlink" title="1、准备工作"></a>1、准备工作</h3><p>和传统 CRUD 一样，实现对员工信息的增删改查。</p><ul><li><p>搭建环境</p></li><li><p>准备实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mvc.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Integer id;</span><br><span class="line">   <span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String email;</span><br><span class="line">   <span class="comment">//1 male, 0 female</span></span><br><span class="line">   <span class="keyword">private</span> Integer gender;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getLastName</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> lastName;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLastName</span><span class="params">(String lastName)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> email;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.email = email;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> gender;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(Integer gender)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.gender = gender;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(Integer id, String lastName, String email, Integer gender)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>();</span><br><span class="line">      <span class="built_in">this</span>.id = id;</span><br><span class="line">      <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">      <span class="built_in">this</span>.email = email;</span><br><span class="line">      <span class="built_in">this</span>.gender = gender;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>准备dao模拟数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mvc.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.mvc.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDao</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Employee&gt; employees = <span class="literal">null</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">static</span>&#123;</span><br><span class="line">      employees = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Employee&gt;();</span><br><span class="line"></span><br><span class="line">      employees.put(<span class="number">1001</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1001</span>, <span class="string">&quot;E-AA&quot;</span>, <span class="string">&quot;aa@163.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">      employees.put(<span class="number">1002</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1002</span>, <span class="string">&quot;E-BB&quot;</span>, <span class="string">&quot;bb@163.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">      employees.put(<span class="number">1003</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1003</span>, <span class="string">&quot;E-CC&quot;</span>, <span class="string">&quot;cc@163.com&quot;</span>, <span class="number">0</span>));</span><br><span class="line">      employees.put(<span class="number">1004</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1004</span>, <span class="string">&quot;E-DD&quot;</span>, <span class="string">&quot;dd@163.com&quot;</span>, <span class="number">0</span>));</span><br><span class="line">      employees.put(<span class="number">1005</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1005</span>, <span class="string">&quot;E-EE&quot;</span>, <span class="string">&quot;ee@163.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">initId</span> <span class="operator">=</span> <span class="number">1006</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(employee.getId() == <span class="literal">null</span>)&#123;</span><br><span class="line">         employee.setId(initId++);</span><br><span class="line">      &#125;</span><br><span class="line">      employees.put(employee.getId(), employee);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> employees.values();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> Employee <span class="title function_">get</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> employees.get(id);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">      employees.remove(id);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2、功能清单"><a href="#2、功能清单" class="headerlink" title="2、功能清单"></a>2、功能清单</h3><div class="table-container"><table><thead><tr><th>功能</th><th>URL 地址</th><th>请求方式</th></tr></thead><tbody><tr><td>访问首页√</td><td>/</td><td>GET</td></tr><tr><td>查询全部数据√</td><td>/employee</td><td>GET</td></tr><tr><td>删除√</td><td>/employee/2</td><td>DELETE</td></tr><tr><td>跳转到添加数据页面√</td><td>/toAdd</td><td>GET</td></tr><tr><td>执行保存√</td><td>/employee</td><td>POST</td></tr><tr><td>跳转到更新数据页面√</td><td>/employee/2</td><td>GET</td></tr><tr><td>执行更新√</td><td>/employee</td><td>PUT</td></tr></tbody></table></div><h3 id="3、具体功能：访问首页"><a href="#3、具体功能：访问首页" class="headerlink" title="3、具体功能：访问首页"></a>3、具体功能：访问首页</h3><h5 id="a-gt-配置view-controller"><a href="#a-gt-配置view-controller" class="headerlink" title="a&gt;配置view-controller"></a>a&gt;配置view-controller</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;index&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-gt-创建页面"><a href="#b-gt-创建页面" class="headerlink" title="b&gt;创建页面"></a>b&gt;创建页面</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span>&gt;</span>访问员工信息<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4、具体功能：查询所有员工数据"><a href="#4、具体功能：查询所有员工数据" class="headerlink" title="4、具体功能：查询所有员工数据"></a>4、具体功能：查询所有员工数据</h3><h5 id="a-gt-控制器方法"><a href="#a-gt-控制器方法" class="headerlink" title="a&gt;控制器方法"></a>a&gt;控制器方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeeList</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    Collection&lt;Employee&gt; employeeList = employeeDao.getAll();</span><br><span class="line">    model.addAttribute(<span class="string">&quot;employeeList&quot;</span>, employeeList);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;employee_list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-gt-创建employee-list-html"><a href="#b-gt-创建employee-list-html" class="headerlink" title="b&gt;创建employee_list.html"></a>b&gt;创建employee_list.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Employee Info<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/vue.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataTable&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;5&quot;</span>&gt;</span>Employee Info<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>lastName<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>email<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>options(<span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toAdd&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span>)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;employee : $&#123;employeeList&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.lastName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;deleteA&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteEmployee&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- th:href的写法二：th:href=&quot;@&#123;/employee/&#125;+$&#123;employee.id&#125;&quot; --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5、具体功能：删除"><a href="#5、具体功能：删除" class="headerlink" title="5、具体功能：删除"></a>5、具体功能：删除</h3><h5 id="a-gt-创建处理delete请求方式的表单"><a href="#a-gt-创建处理delete请求方式的表单" class="headerlink" title="a&gt;创建处理delete请求方式的表单"></a>a&gt;创建处理delete请求方式的表单</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 作用：通过超链接控制表单的提交，将post请求转换为delete请求 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;delete_form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HiddenHttpMethodFilter要求：必须传输_method请求参数，并且值为最终的请求方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-gt-删除超链接绑定点击事件"><a href="#b-gt-删除超链接绑定点击事件" class="headerlink" title="b&gt;删除超链接绑定点击事件"></a>b&gt;删除超链接绑定点击事件</h5><p>引入vue.js</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/vue.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>删除超链接</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;deleteA&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteEmployee&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过vue处理点击事件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#dataTable&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//event表示当前事件</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">deleteEmployee</span>:<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//通过id获取表单标签</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> delete_form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;delete_form&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//将触发事件的超链接的href属性为表单的action属性赋值</span></span></span><br><span class="line"><span class="language-javascript">                delete_form.<span class="property">action</span> = event.<span class="property">target</span>.<span class="property">href</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//提交表单</span></span></span><br><span class="line"><span class="language-javascript">                delete_form.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//阻止超链接的默认跳转行为</span></span></span><br><span class="line"><span class="language-javascript">                event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="c-gt-控制器方法"><a href="#c-gt-控制器方法" class="headerlink" title="c&gt;控制器方法"></a>c&gt;控制器方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deleteEmployee</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    employeeDao.delete(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/employee&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6、具体功能：跳转到添加数据页面"><a href="#6、具体功能：跳转到添加数据页面" class="headerlink" title="6、具体功能：跳转到添加数据页面"></a>6、具体功能：跳转到添加数据页面</h3><h5 id="a-gt-配置view-controller-1"><a href="#a-gt-配置view-controller-1" class="headerlink" title="a&gt;配置view-controller"></a>a&gt;配置view-controller</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/toAdd&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;employee_add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:view-controller</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-gt-创建employee-add-html"><a href="#b-gt-创建employee-add-html" class="headerlink" title="b&gt;创建employee_add.html"></a>b&gt;创建employee_add.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Add Employee<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    lastName:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    email:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    gender:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>male</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>female<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;add&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="7、具体功能：执行保存"><a href="#7、具体功能：执行保存" class="headerlink" title="7、具体功能：执行保存"></a>7、具体功能：执行保存</h3><h5 id="a-gt-控制器方法-1"><a href="#a-gt-控制器方法-1" class="headerlink" title="a&gt;控制器方法"></a>a&gt;控制器方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addEmployee</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">    employeeDao.save(employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/employee&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8、具体功能：跳转到更新数据页面"><a href="#8、具体功能：跳转到更新数据页面" class="headerlink" title="8、具体功能：跳转到更新数据页面"></a>8、具体功能：跳转到更新数据页面</h3><h5 id="a-gt-修改超链接"><a href="#a-gt-修改超链接" class="headerlink" title="a&gt;修改超链接"></a>a&gt;修改超链接</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-gt-控制器方法"><a href="#b-gt-控制器方法" class="headerlink" title="b&gt;控制器方法"></a>b&gt;控制器方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeeById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id, Model model)</span>&#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeDao.get(id);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;employee&quot;</span>, employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;employee_update&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-gt-创建employee-update-html"><a href="#c-gt-创建employee-update-html" class="headerlink" title="c&gt;创建employee_update.html"></a>c&gt;创建employee_update.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Update Employee<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.id&#125;&quot;</span>&gt;</span></span><br><span class="line">    lastName:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.lastName&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    email:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        th:field=&quot;$&#123;employee.gender&#125;&quot;可用于单选框或复选框的回显</span></span><br><span class="line"><span class="comment">        若单选框的value和employee.gender的值一致，则添加checked=&quot;checked&quot;属性</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    gender:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span>male</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span>female<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;update&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="9、具体功能：执行更新"><a href="#9、具体功能：执行更新" class="headerlink" title="9、具体功能：执行更新"></a>9、具体功能：执行更新</h3><h5 id="a-gt-控制器方法-2"><a href="#a-gt-控制器方法-2" class="headerlink" title="a&gt;控制器方法"></a>a&gt;控制器方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee&quot;, method = RequestMethod.PUT)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">updateEmployee</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">    employeeDao.save(employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/employee&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="八、HttpMessageConverter"><a href="#八、HttpMessageConverter" class="headerlink" title="八、HttpMessageConverter"></a>八、HttpMessageConverter</h1><p>HttpMessageConverter，报文信息转换器，将请求报文转换为Java对象，或将Java对象转换为响应报文</p><p>HttpMessageConverter提供了两个注解和两个类型：@RequestBody，@ResponseBody，RequestEntity，</p><p>ResponseEntity</p><h3 id="1、-RequestBody"><a href="#1、-RequestBody" class="headerlink" title="1、@RequestBody"></a>1、@RequestBody</h3><p>@RequestBody可以获取请求体，需要在控制器方法设置一个形参，使用@RequestBody进行标识，当前请求的请求体就会为当前注解所标识的形参赋值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/testRequestBody&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRequestBody&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestBody</span><span class="params">(<span class="meta">@RequestBody</span> String requestBody)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;requestBody:&quot;</span>+requestBody);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><p>requestBody:username=admin&amp;password=123456</p><h3 id="2、RequestEntity"><a href="#2、RequestEntity" class="headerlink" title="2、RequestEntity"></a>2、RequestEntity</h3><p>RequestEntity封装请求报文的一种类型，需要在控制器方法的形参中设置该类型的形参，当前请求的请求报文就会赋值给该形参，可以通过getHeaders()获取请求头信息，通过getBody()获取请求体信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRequestEntity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestEntity</span><span class="params">(RequestEntity&lt;String&gt; requestEntity)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;requestHeader:&quot;</span>+requestEntity.getHeaders());</span><br><span class="line">    System.out.println(<span class="string">&quot;requestBody:&quot;</span>+requestEntity.getBody());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：<br>requestHeader:[host:”localhost:8080”, connection:”keep-alive”, content-length:”27”, cache-control:”max-age=0”, sec-ch-ua:”” Not A;Brand”;v=”99”, “Chromium”;v=”90”, “Google Chrome”;v=”90””, sec-ch-ua-mobile:”?0”, upgrade-insecure-requests:”1”, origin:”<a href="http://localhost:8080">http://localhost:8080</a>“, user-agent:”Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36”]<br>requestBody:username=admin&amp;password=123</p><h3 id="3、-ResponseBody"><a href="#3、-ResponseBody" class="headerlink" title="3、@ResponseBody"></a>3、@ResponseBody</h3><p>@ResponseBody用于标识一个控制器方法，可以将该方法的返回值直接作为响应报文的响应体响应到浏览器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testResponseBody&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testResponseBody</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：浏览器页面显示success</p><blockquote><p>不会是跳转到该页面了</p></blockquote><h3 id="4、SpringMVC处理json"><a href="#4、SpringMVC处理json" class="headerlink" title="4、SpringMVC处理json"></a>4、SpringMVC处理json</h3><p>@ResponseBody处理json的步骤：</p><p>a&gt;导入jackson的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b&gt;在SpringMVC的核心配置文件中开启mvc的注解驱动，此时在HandlerAdaptor中会自动装配一个消息转换器：MappingJackson2HttpMessageConverter，可以将响应到浏览器的Java对象转换为Json格式的字符串</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>c&gt;在处理器方法上使用@ResponseBody注解进行标识</p><p>d&gt;将Java对象直接作为控制器方法的返回值返回，就会自动转换为Json格式的字符串</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testResponseUser&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">testResponseUser</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="number">23</span>,<span class="string">&quot;男&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>浏览器的页面中展示的结果：</p><p>{“id”:1001,”username”:”admin”,”password”:”123456”,”age”:23,”sex”:”男”}</p><h3 id="5、SpringMVC处理ajax"><a href="#5、SpringMVC处理ajax" class="headerlink" title="5、SpringMVC处理ajax"></a>5、SpringMVC处理ajax</h3><p>a&gt;请求超链接：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testAjax&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;testAjax&quot;</span>&gt;</span>testAjax<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b&gt;通过vue和axios处理点击事件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/vue.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/axios.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">testAjax</span>:<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">axios</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">url</span>:event.<span class="property">target</span>.<span class="property">href</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">params</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">username</span>:<span class="string">&quot;admin&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">password</span>:<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>c&gt;控制器方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testAjax&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAjax</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username:&quot;</span>+username+<span class="string">&quot;,password:&quot;</span>+password);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello,ajax&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6、-RestController注解"><a href="#6、-RestController注解" class="headerlink" title="6、@RestController注解"></a>6、@RestController注解</h3><p>@RestController注解是springMVC提供的一个复合注解，标识在控制器的类上，就相当于为类添加了@Controller注解，并且为其中的每个方法添加了@ResponseBody注解</p><h3 id="7、ResponseEntity"><a href="#7、ResponseEntity" class="headerlink" title="7、ResponseEntity"></a>7、ResponseEntity</h3><p>ResponseEntity用于控制器方法的返回值类型，该控制器方法的返回值就是响应到浏览器的响应报文</p><h1 id="九、文件上传和下载"><a href="#九、文件上传和下载" class="headerlink" title="九、文件上传和下载"></a>九、文件上传和下载</h1><h3 id="1、文件下载"><a href="#1、文件下载" class="headerlink" title="1、文件下载"></a>1、文件下载</h3><p>使用ResponseEntity实现下载文件的功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testDown&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; testResponseEntity(HttpSession session) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//获取ServletContext对象</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> session.getServletContext();</span><br><span class="line">    <span class="comment">//获取服务器中文件的真实路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> servletContext.getRealPath(<span class="string">&quot;/static/img/1.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//创建输入流</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(realPath);</span><br><span class="line">    <span class="comment">//创建字节数组</span></span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[is.available()];</span><br><span class="line">    <span class="comment">//将流读到字节数组中</span></span><br><span class="line">    is.read(bytes);</span><br><span class="line">    <span class="comment">//创建HttpHeaders对象设置响应头信息</span></span><br><span class="line">    MultiValueMap&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">    <span class="comment">//设置要下载方式以及下载文件的名字</span></span><br><span class="line">    headers.add(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=1.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//设置响应状态码</span></span><br><span class="line">    <span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> HttpStatus.OK;</span><br><span class="line">    <span class="comment">//创建ResponseEntity对象</span></span><br><span class="line">    ResponseEntity&lt;<span class="type">byte</span>[]&gt; responseEntity = <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(bytes, headers, statusCode);</span><br><span class="line">    <span class="comment">//关闭输入流</span></span><br><span class="line">    is.close();</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、文件上传"><a href="#2、文件上传" class="headerlink" title="2、文件上传"></a>2、文件上传</h3><p>文件上传要求form表单的请求方式必须为post，并且添加属性enctype=”multipart/form-data”</p><p>SpringMVC中将上传的文件封装到MultipartFile对象中，通过此对象可以获取文件相关信息</p><p>上传步骤：</p><p>a&gt;添加依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b&gt;在SpringMVC的配置文件中添加配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--必须通过文件解析器的解析才能将文件转换为MultipartFile对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>c&gt;控制器方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testUp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testUp</span><span class="params">(MultipartFile photo, HttpSession session)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//获取上传的文件的文件名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> photo.getOriginalFilename();</span><br><span class="line">    <span class="comment">//处理文件重名问题</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">hzName</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    fileName = UUID.randomUUID().toString() + hzName;</span><br><span class="line">    <span class="comment">//获取服务器中photo目录的路径</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> session.getServletContext();</span><br><span class="line">    <span class="type">String</span> <span class="variable">photoPath</span> <span class="operator">=</span> servletContext.getRealPath(<span class="string">&quot;photo&quot;</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(photoPath);</span><br><span class="line">    <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">        file.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">finalPath</span> <span class="operator">=</span> photoPath + File.separator + fileName;<span class="comment">//File.separator路径分隔符</span></span><br><span class="line">    <span class="comment">//实现上传功能</span></span><br><span class="line">    photo.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(finalPath));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="十、拦截器"><a href="#十、拦截器" class="headerlink" title="十、拦截器"></a>十、拦截器</h1><h3 id="1、拦截器的配置"><a href="#1、拦截器的配置" class="headerlink" title="1、拦截器的配置"></a>1、拦截器的配置</h3><p>SpringMVC中的拦截器用于拦截控制器方法的执行</p><p>SpringMVC中的拦截器需要实现HandlerInterceptor</p><p>SpringMVC的拦截器必须在SpringMVC的配置文件中进行配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.interceptor.FirstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;firstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 以上两种配置方式都是对DispatcherServlet所处理的所有的请求进行拦截 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/testRequestEntity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;firstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">以上配置方式可以通过ref或bean标签设置拦截器，通过mvc:mapping设置需要拦截的请求，通过mvc:exclude-mapping设置需要排除的请求，即不需要拦截的请求</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2、拦截器的三个抽象方法"><a href="#2、拦截器的三个抽象方法" class="headerlink" title="2、拦截器的三个抽象方法"></a>2、拦截器的三个抽象方法</h3><p>SpringMVC中的拦截器有三个抽象方法：</p><p>preHandle：控制器方法执行之前执行preHandle()，其boolean类型的返回值表示是否拦截或放行，返回true为放行，即调用控制器方法；返回false表示拦截，即不调用控制器方法</p><p>postHandle：控制器方法执行之后执行postHandle()</p><p>afterComplation：处理完视图和模型数据，渲染视图完毕之后执行afterComplation()</p><h3 id="3、多个拦截器的执行顺序"><a href="#3、多个拦截器的执行顺序" class="headerlink" title="3、多个拦截器的执行顺序"></a>3、多个拦截器的执行顺序</h3><p>a&gt;若每个拦截器的preHandle()都返回true</p><p>此时多个拦截器的执行顺序和拦截器在SpringMVC的配置文件的配置顺序有关：</p><p>preHandle()会按照配置的顺序执行，而postHandle()和afterComplation()会按照配置的反序执行</p><p>b&gt;若某个拦截器的preHandle()返回了false</p><p>preHandle()返回false和它之前的拦截器的preHandle()都会执行，postHandle()都不执行，返回false的拦截器之前的拦截器的afterComplation()会执行</p><h1 id="十一、异常处理器"><a href="#十一、异常处理器" class="headerlink" title="十一、异常处理器"></a>十一、异常处理器</h1><h3 id="1、基于配置的异常处理"><a href="#1、基于配置的异常处理" class="headerlink" title="1、基于配置的异常处理"></a>1、基于配置的异常处理</h3><p>SpringMVC提供了一个处理控制器方法执行过程中所出现的异常的接口：HandlerExceptionResolver</p><p>HandlerExceptionResolver接口的实现类有：DefaultHandlerExceptionResolver和SimpleMappingExceptionResolver</p><p>SpringMVC提供了自定义的异常处理器SimpleMappingExceptionResolver，使用方式：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        properties的键表示处理器方法执行过程中出现的异常</span></span><br><span class="line"><span class="comment">        properties的值表示若出现指定异常时，设置一个新的视图名称，跳转到指定页面</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.lang.ArithmeticException&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    exceptionAttribute属性设置一个属性名，将出现的异常信息在请求域中进行共享</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionAttribute&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2、基于注解的异常处理"><a href="#2、基于注解的异常处理" class="headerlink" title="2、基于注解的异常处理"></a>2、基于注解的异常处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ControllerAdvice将当前类标识为异常处理的组件</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@ExceptionHandler用于设置所标识方法处理的异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line">    <span class="comment">//ex表示当前请求处理中出现的异常对象</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleArithmeticException</span><span class="params">(Exception ex, Model model)</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="十二、注解配置SpringMVC"><a href="#十二、注解配置SpringMVC" class="headerlink" title="十二、注解配置SpringMVC"></a>十二、注解配置SpringMVC</h1><p>使用配置类和注解代替web.xml和SpringMVC配置文件的功能</p><h3 id="1、创建初始化类，代替web-xml"><a href="#1、创建初始化类，代替web-xml" class="headerlink" title="1、创建初始化类，代替web.xml"></a>1、创建初始化类，代替web.xml</h3><p>在Servlet3.0环境中，容器会在类路径中查找实现javax.servlet.ServletContainerInitializer接口的类，如果找到的话就用它来配置Servlet容器。<br>Spring提供了这个接口的实现，名为SpringServletContainerInitializer，这个类反过来又会查找实现WebApplicationInitializer的类并将配置的任务交给它们来完成。Spring3.2引入了一个便利的WebApplicationInitializer基础实现，名为AbstractAnnotationConfigDispatcherServletInitializer，当我们的类扩展了AbstractAnnotationConfigDispatcherServletInitializer并将其部署到Servlet3.0容器的时候，容器会自动发现它，并用它来配置Servlet上下文。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebInit</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定spring的配置类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定SpringMVC的配置类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;WebConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定DispatcherServlet的映射规则，即url-pattern</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加过滤器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">encodingFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">        encodingFilter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        encodingFilter.setForceRequestEncoding(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">hiddenHttpMethodFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;encodingFilter, hiddenHttpMethodFilter&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2、创建SpringConfig配置类，代替spring的配置文件"><a href="#2、创建SpringConfig配置类，代替spring的配置文件" class="headerlink" title="2、创建SpringConfig配置类，代替spring的配置文件"></a>2、创建SpringConfig配置类，代替spring的配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"><span class="comment">//ssm整合之后，spring的配置信息写在此类中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、创建WebConfig配置类，代替SpringMVC的配置文件"><a href="#3、创建WebConfig配置类，代替SpringMVC的配置文件" class="headerlink" title="3、创建WebConfig配置类，代替SpringMVC的配置文件"></a>3、创建WebConfig配置类，代替SpringMVC的配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//扫描组件</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.atguigu.mvc.controller&quot;)</span></span><br><span class="line"><span class="comment">//开启MVC注解驱动</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用默认的servlet处理静态资源</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置文件上传解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CommonsMultipartResolver <span class="title function_">multipartResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonsMultipartResolver</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置拦截器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">FirstInterceptor</span> <span class="variable">firstInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FirstInterceptor</span>();</span><br><span class="line">        registry.addInterceptor(firstInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置视图控制</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*@Override</span></span><br><span class="line"><span class="comment">    public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line"><span class="comment">        registry.addViewController(&quot;/&quot;).setViewName(&quot;index&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置异常映射</span></span><br><span class="line">    <span class="comment">/*@Override</span></span><br><span class="line"><span class="comment">    public void configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) &#123;</span></span><br><span class="line"><span class="comment">        SimpleMappingExceptionResolver exceptionResolver = new SimpleMappingExceptionResolver();</span></span><br><span class="line"><span class="comment">        Properties prop = new Properties();</span></span><br><span class="line"><span class="comment">        prop.setProperty(&quot;java.lang.ArithmeticException&quot;, &quot;error&quot;);</span></span><br><span class="line"><span class="comment">        //设置异常映射</span></span><br><span class="line"><span class="comment">        exceptionResolver.setExceptionMappings(prop);</span></span><br><span class="line"><span class="comment">        //设置共享异常信息的键</span></span><br><span class="line"><span class="comment">        exceptionResolver.setExceptionAttribute(&quot;ex&quot;);</span></span><br><span class="line"><span class="comment">        resolvers.add(exceptionResolver);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置生成模板解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ITemplateResolver <span class="title function_">templateResolver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WebApplicationContext</span> <span class="variable">webApplicationContext</span> <span class="operator">=</span> ContextLoader.getCurrentWebApplicationContext();</span><br><span class="line">        <span class="comment">// ServletContextTemplateResolver需要一个ServletContext作为构造参数，可通过WebApplicationContext 的方法获得</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(</span><br><span class="line">                webApplicationContext.getServletContext());</span><br><span class="line">        templateResolver.setPrefix(<span class="string">&quot;/WEB-INF/templates/&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(<span class="string">&quot;.html&quot;</span>);</span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="keyword">return</span> templateResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生成模板引擎并为模板引擎注入模板解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringTemplateEngine <span class="title function_">templateEngine</span><span class="params">(ITemplateResolver templateResolver)</span> &#123;</span><br><span class="line">        <span class="type">SpringTemplateEngine</span> <span class="variable">templateEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTemplateEngine</span>();</span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line">        <span class="keyword">return</span> templateEngine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生成视图解析器并未解析器注入模板引擎</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ViewResolver <span class="title function_">viewResolver</span><span class="params">(SpringTemplateEngine templateEngine)</span> &#123;</span><br><span class="line">        <span class="type">ThymeleafViewResolver</span> <span class="variable">viewResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThymeleafViewResolver</span>();</span><br><span class="line">        viewResolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        viewResolver.setTemplateEngine(templateEngine);</span><br><span class="line">        <span class="keyword">return</span> viewResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、测试功能"><a href="#4、测试功能" class="headerlink" title="4、测试功能"></a>4、测试功能</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="十三、SpringMVC执行流程"><a href="#十三、SpringMVC执行流程" class="headerlink" title="十三、SpringMVC执行流程"></a>十三、SpringMVC执行流程</h1><h3 id="1、SpringMVC常用组件"><a href="#1、SpringMVC常用组件" class="headerlink" title="1、SpringMVC常用组件"></a>1、SpringMVC常用组件</h3><ul><li>DispatcherServlet：<strong>前端控制器</strong>，不需要工程师开发，由框架提供</li></ul><p>作用：统一处理请求和响应，整个流程控制的中心，由它调用其它组件处理用户的请求</p><ul><li>HandlerMapping：<strong>处理器映射器</strong>，不需要工程师开发，由框架提供</li></ul><p>作用：根据请求的url、method等信息查找Handler，即控制器方法</p><ul><li>Handler：<strong>处理器</strong>，<span style="color:blue">需要工程师开发</span></li></ul><p>作用：在DispatcherServlet的控制下Handler对具体的用户请求进行处理</p><ul><li>HandlerAdapter：<strong>处理器适配器</strong>，不需要工程师开发，由框架提供</li></ul><p>作用：通过HandlerAdapter对处理器（控制器方法）进行执行</p><ul><li>ViewResolver：<strong>视图解析器</strong>，不需要工程师开发，由框架提供</li></ul><p>作用：进行视图解析，得到相应的视图，例如：ThymeleafView、InternalResourceView、RedirectView</p><ul><li>View：<strong>视图</strong>，<span style="color:blue">需要工程师开发</span></li></ul><p>作用：将模型数据通过页面展示给用户</p><h3 id="2、DispatcherServlet初始化过程"><a href="#2、DispatcherServlet初始化过程" class="headerlink" title="2、DispatcherServlet初始化过程"></a>2、DispatcherServlet初始化过程</h3><p>DispatcherServlet 本质上是一个 Servlet，所以天然的遵循 Servlet 的生命周期。所以宏观上是 Servlet 生命周期来进行调度。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img005.png" alt="images"></p><h5 id="a-gt-初始化WebApplicationContext"><a href="#a-gt-初始化WebApplicationContext" class="headerlink" title="a&gt;初始化WebApplicationContext"></a>a&gt;初始化WebApplicationContext</h5><p>所在类：org.springframework.web.servlet.FrameworkServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">initWebApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">rootContext</span> <span class="operator">=</span></span><br><span class="line">        WebApplicationContextUtils.getWebApplicationContext(getServletContext());</span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.webApplicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// A context instance was injected at construction time -&gt; use it</span></span><br><span class="line">        wac = <span class="built_in">this</span>.webApplicationContext;</span><br><span class="line">        <span class="keyword">if</span> (wac <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</span><br><span class="line">            <span class="type">ConfigurableWebApplicationContext</span> <span class="variable">cwac</span> <span class="operator">=</span> (ConfigurableWebApplicationContext) wac;</span><br><span class="line">            <span class="keyword">if</span> (!cwac.isActive()) &#123;</span><br><span class="line">                <span class="comment">// The context has not yet been refreshed -&gt; provide services such as</span></span><br><span class="line">                <span class="comment">// setting the parent context, setting the application context id, etc</span></span><br><span class="line">                <span class="keyword">if</span> (cwac.getParent() == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// The context instance was injected without an explicit parent -&gt; set</span></span><br><span class="line">                    <span class="comment">// the root application context (if any; may be null) as the parent</span></span><br><span class="line">                    cwac.setParent(rootContext);</span><br><span class="line">                &#125;</span><br><span class="line">                configureAndRefreshWebApplicationContext(cwac);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No context instance was injected at construction time -&gt; see if one</span></span><br><span class="line">        <span class="comment">// has been registered in the servlet context. If one exists, it is assumed</span></span><br><span class="line">        <span class="comment">// that the parent context (if any) has already been set and that the</span></span><br><span class="line">        <span class="comment">// user has performed any initialization such as setting the context id</span></span><br><span class="line">        wac = findWebApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No context instance is defined for this servlet -&gt; create a local one</span></span><br><span class="line">        <span class="comment">// 创建WebApplicationContext</span></span><br><span class="line">        wac = createWebApplicationContext(rootContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.refreshEventReceived) &#123;</span><br><span class="line">        <span class="comment">// Either the context is not a ConfigurableApplicationContext with refresh</span></span><br><span class="line">        <span class="comment">// support or the context injected at construction time had already been</span></span><br><span class="line">        <span class="comment">// refreshed -&gt; trigger initial onRefresh manually here.</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>.onRefreshMonitor) &#123;</span><br><span class="line">            <span class="comment">// 刷新WebApplicationContext</span></span><br><span class="line">            onRefresh(wac);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.publishContext) &#123;</span><br><span class="line">        <span class="comment">// Publish the context as a servlet context attribute.</span></span><br><span class="line">        <span class="comment">// 将IOC容器在应用域共享</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> getServletContextAttributeName();</span><br><span class="line">        getServletContext().setAttribute(attrName, wac);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-gt-创建WebApplicationContext"><a href="#b-gt-创建WebApplicationContext" class="headerlink" title="b&gt;创建WebApplicationContext"></a>b&gt;创建WebApplicationContext</h5><p>所在类：org.springframework.web.servlet.FrameworkServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createWebApplicationContext</span><span class="params">(<span class="meta">@Nullable</span> ApplicationContext parent)</span> &#123;</span><br><span class="line">    Class&lt;?&gt; contextClass = getContextClass();</span><br><span class="line">    <span class="keyword">if</span> (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextException</span>(</span><br><span class="line">            <span class="string">&quot;Fatal initialization error in servlet with name &#x27;&quot;</span> + getServletName() +</span><br><span class="line">            <span class="string">&quot;&#x27;: custom WebApplicationContext class [&quot;</span> + contextClass.getName() +</span><br><span class="line">            <span class="string">&quot;] is not of type ConfigurableWebApplicationContext&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过反射创建 IOC 容器对象</span></span><br><span class="line">    <span class="type">ConfigurableWebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span></span><br><span class="line">        (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);</span><br><span class="line"></span><br><span class="line">    wac.setEnvironment(getEnvironment());</span><br><span class="line">    <span class="comment">// 设置父容器</span></span><br><span class="line">    wac.setParent(parent);</span><br><span class="line">    <span class="type">String</span> <span class="variable">configLocation</span> <span class="operator">=</span> getContextConfigLocation();</span><br><span class="line">    <span class="keyword">if</span> (configLocation != <span class="literal">null</span>) &#123;</span><br><span class="line">        wac.setConfigLocation(configLocation);</span><br><span class="line">    &#125;</span><br><span class="line">    configureAndRefreshWebApplicationContext(wac);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-gt-DispatcherServlet初始化策略"><a href="#c-gt-DispatcherServlet初始化策略" class="headerlink" title="c&gt;DispatcherServlet初始化策略"></a>c&gt;DispatcherServlet初始化策略</h5><p>FrameworkServlet创建WebApplicationContext后，刷新容器，调用onRefresh(wac)，此方法在DispatcherServlet中进行了重写，调用了initStrategies(context)方法，初始化策略，即初始化DispatcherServlet的各个组件</p><p>所在类：org.springframework.web.servlet.DispatcherServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initStrategies</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">   initMultipartResolver(context);</span><br><span class="line">   initLocaleResolver(context);</span><br><span class="line">   initThemeResolver(context);</span><br><span class="line">   initHandlerMappings(context);</span><br><span class="line">   initHandlerAdapters(context);</span><br><span class="line">   initHandlerExceptionResolvers(context);</span><br><span class="line">   initRequestToViewNameTranslator(context);</span><br><span class="line">   initViewResolvers(context);</span><br><span class="line">   initFlashMapManager(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、DispatcherServlet调用组件处理请求"><a href="#3、DispatcherServlet调用组件处理请求" class="headerlink" title="3、DispatcherServlet调用组件处理请求"></a>3、DispatcherServlet调用组件处理请求</h3><h5 id="a-gt-processRequest"><a href="#a-gt-processRequest" class="headerlink" title="a&gt;processRequest()"></a>a&gt;processRequest()</h5><p>FrameworkServlet重写HttpServlet中的service()和doXxx()，这些方法中调用了processRequest(request, response)</p><p>所在类：org.springframework.web.servlet.FrameworkServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">failureCause</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">LocaleContext</span> <span class="variable">previousLocaleContext</span> <span class="operator">=</span> LocaleContextHolder.getLocaleContext();</span><br><span class="line">    <span class="type">LocaleContext</span> <span class="variable">localeContext</span> <span class="operator">=</span> buildLocaleContext(request);</span><br><span class="line"></span><br><span class="line">    <span class="type">RequestAttributes</span> <span class="variable">previousAttributes</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">    <span class="type">ServletRequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> buildRequestAttributes(request, response, previousAttributes);</span><br><span class="line"></span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">    asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), <span class="keyword">new</span> <span class="title class_">RequestBindingInterceptor</span>());</span><br><span class="line"></span><br><span class="line">    initContextHolders(request, localeContext, requestAttributes);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// 执行服务，doService()是一个抽象方法，在DispatcherServlet中进行了重写</span></span><br><span class="line">        doService(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ServletException | IOException ex) &#123;</span><br><span class="line">        failureCause = ex;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        failureCause = ex;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Request processing failed&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        resetContextHolders(request, previousLocaleContext, previousAttributes);</span><br><span class="line">        <span class="keyword">if</span> (requestAttributes != <span class="literal">null</span>) &#123;</span><br><span class="line">            requestAttributes.requestCompleted();</span><br><span class="line">        &#125;</span><br><span class="line">        logResult(request, response, failureCause, asyncManager);</span><br><span class="line">        publishRequestHandledEvent(request, response, startTime, failureCause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-gt-doService"><a href="#b-gt-doService" class="headerlink" title="b&gt;doService()"></a>b&gt;doService()</h5><p>所在类：org.springframework.web.servlet.DispatcherServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    logRequest(request);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Keep a snapshot of the request attributes in case of an include,</span></span><br><span class="line">    <span class="comment">// to be able to restore the original attributes after the include.</span></span><br><span class="line">    Map&lt;String, Object&gt; attributesSnapshot = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (WebUtils.isIncludeRequest(request)) &#123;</span><br><span class="line">        attributesSnapshot = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</span><br><span class="line">        <span class="keyword">while</span> (attrNames.hasMoreElements()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> (String) attrNames.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) &#123;</span><br><span class="line">                attributesSnapshot.put(attrName, request.getAttribute(attrName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make framework objects available to handlers and view objects.</span></span><br><span class="line">    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span><br><span class="line">    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class="built_in">this</span>.localeResolver);</span><br><span class="line">    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class="built_in">this</span>.themeResolver);</span><br><span class="line">    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.flashMapManager != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">FlashMap</span> <span class="variable">inputFlashMap</span> <span class="operator">=</span> <span class="built_in">this</span>.flashMapManager.retrieveAndUpdate(request, response);</span><br><span class="line">        <span class="keyword">if</span> (inputFlashMap != <span class="literal">null</span>) &#123;</span><br><span class="line">            request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span><br><span class="line">        &#125;</span><br><span class="line">        request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class="keyword">new</span> <span class="title class_">FlashMap</span>());</span><br><span class="line">        request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class="built_in">this</span>.flashMapManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">RequestPath</span> <span class="variable">requestPath</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.parseRequestPath &amp;&amp; !ServletRequestPathUtils.hasParsedRequestPath(request)) &#123;</span><br><span class="line">        requestPath = ServletRequestPathUtils.parseAndCache(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 处理请求和响应</span></span><br><span class="line">        doDispatch(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="comment">// Restore the original attribute snapshot, in case of an include.</span></span><br><span class="line">            <span class="keyword">if</span> (attributesSnapshot != <span class="literal">null</span>) &#123;</span><br><span class="line">                restoreAttributesAfterInclude(request, attributesSnapshot);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (requestPath != <span class="literal">null</span>) &#123;</span><br><span class="line">            ServletRequestPathUtils.clearParsedRequestPath(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-gt-doDispatch"><a href="#c-gt-doDispatch" class="headerlink" title="c&gt;doDispatch()"></a>c&gt;doDispatch()</h5><p>所在类：org.springframework.web.servlet.DispatcherServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">dispatchException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            processedRequest = checkMultipart(request);</span><br><span class="line">            multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Determine handler for the current request.</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            mappedHandler：调用链</span></span><br><span class="line"><span class="comment">                包含handler、interceptorList、interceptorIndex</span></span><br><span class="line"><span class="comment">            handler：浏览器发送的请求所匹配的控制器方法</span></span><br><span class="line"><span class="comment">            interceptorList：处理控制器方法的所有拦截器集合</span></span><br><span class="line"><span class="comment">            interceptorIndex：拦截器索引，控制拦截器afterCompletion()的执行</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            mappedHandler = getHandler(processedRequest);</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">                noHandlerFound(processedRequest, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line">           <span class="comment">// 通过控制器方法创建相应的处理器适配器，调用所对应的控制器方法</span></span><br><span class="line">            <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isGet</span> <span class="operator">=</span> <span class="string">&quot;GET&quot;</span>.equals(method);</span><br><span class="line">            <span class="keyword">if</span> (isGet || <span class="string">&quot;HEAD&quot;</span>.equals(method)) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用拦截器的preHandle()</span></span><br><span class="line">            <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Actually invoke the handler.</span></span><br><span class="line">            <span class="comment">// 由处理器适配器调用具体的控制器方法，最终获得ModelAndView对象</span></span><br><span class="line">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            applyDefaultViewName(processedRequest, mv);</span><br><span class="line">            <span class="comment">// 调用拦截器的postHandle()</span></span><br><span class="line">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">            <span class="comment">// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span></span><br><span class="line">            <span class="comment">// making them available for @ExceptionHandler methods and other scenarios.</span></span><br><span class="line">            dispatchException = <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler dispatch failed&quot;</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 后续处理：处理模型数据和渲染视图</span></span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler,</span><br><span class="line">                               <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler processing failed&quot;</span>, err));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="comment">// Instead of postHandle and afterCompletion</span></span><br><span class="line">            <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Clean up any resources used by a multipart request.</span></span><br><span class="line">            <span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">                cleanupMultipart(processedRequest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="d-gt-processDispatchResult"><a href="#d-gt-processDispatchResult" class="headerlink" title="d&gt;processDispatchResult()"></a>d&gt;processDispatchResult()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> HandlerExecutionChain mappedHandler, <span class="meta">@Nullable</span> ModelAndView mv,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> Exception exception)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">errorView</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;ModelAndViewDefiningException encountered&quot;</span>, exception);</span><br><span class="line">            mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> (mappedHandler != <span class="literal">null</span> ? mappedHandler.getHandler() : <span class="literal">null</span>);</span><br><span class="line">            mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">            errorView = (mv != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the handler return a view to render?</span></span><br><span class="line">    <span class="keyword">if</span> (mv != <span class="literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">        <span class="comment">// 处理模型数据和渲染视图</span></span><br><span class="line">        render(mv, request, response);</span><br><span class="line">        <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">            WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;No view rendering, null ModelAndView returned.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">        <span class="comment">// Concurrent handling started during a forward</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Exception (if any) is already handled..</span></span><br><span class="line">        <span class="comment">// 调用拦截器的afterCompletion()</span></span><br><span class="line">        mappedHandler.triggerAfterCompletion(request, response, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4、SpringMVC的执行流程"><a href="#4、SpringMVC的执行流程" class="headerlink" title="4、SpringMVC的执行流程"></a>4、SpringMVC的执行流程</h3><p>1) 用户向服务器发送请求，请求被SpringMVC 前端控制器 DispatcherServlet捕获。</p><p>2) DispatcherServlet对请求URL进行解析，得到请求资源标识符（URI），判断请求URI对应的映射：</p><p>a) 不存在</p><p>i. 再判断是否配置了mvc:default-servlet-handler</p><p>ii. 如果没配置，则控制台报映射查找不到，客户端展示404错误</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img006.png" alt="image-20210709214911404"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img007.png" alt="image-20210709214947432"></p><p>iii. 如果有配置，则访问目标资源（一般为静态资源，如：JS,CSS,HTML），找不到客户端也会展示404错误</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img008.png" alt="image-20210709215255693"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/img009.png" alt="image-20210709215336097"></p><p>b) 存在则执行下面的流程</p><p>3) 根据该URI，调用HandlerMapping获得该Handler配置的所有相关的对象（包括Handler对象以及Handler对象对应的拦截器），最后以HandlerExecutionChain执行链对象的形式返回。</p><p>4) DispatcherServlet 根据获得的Handler，选择一个合适的HandlerAdapter。</p><p>5) 如果成功获得HandlerAdapter，此时将开始执行拦截器的preHandler(…)方法【正向】</p><p>6) 提取Request中的模型数据，填充Handler入参，开始执行Handler（Controller)方法，处理请求。在填充Handler的入参过程中，根据你的配置，Spring将帮你做一些额外的工作：</p><p>a) HttpMessageConveter： 将请求消息（如Json、xml等数据）转换成一个对象，将对象转换为指定的响应信息</p><p>b) 数据转换：对请求消息进行数据转换。如String转换成Integer、Double等</p><p>c) 数据格式化：对请求消息进行数据格式化。 如将字符串转换成格式化数字或格式化日期等</p><p>d) 数据验证： 验证数据的有效性（长度、格式等），验证结果存储到BindingResult或Error中</p><p>7) Handler执行完成后，向DispatcherServlet 返回一个ModelAndView对象。</p><p>8) 此时将开始执行拦截器的postHandle(…)方法【逆向】。</p><p>9) 根据返回的ModelAndView（此时会判断是否存在异常：如果存在异常，则执行HandlerExceptionResolver进行异常处理）选择一个适合的ViewResolver进行视图解析，根据Model和View，来渲染视图。</p><p>10) 渲染视图完毕执行拦截器的afterCompletion(…)方法【逆向】。</p><p>11) 将渲染结果返回给客户端。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Kibana集群</title>
      <link href="/posts/1312847445.html"/>
      <url>/posts/1312847445.html</url>
      
        <content type="html"><![CDATA[<h1 id="下载Kibana"><a href="#下载Kibana" class="headerlink" title="下载Kibana"></a>下载Kibana</h1><p>下载前需要查看版本依赖。查看<a href="https://www.elastic.co/cn/support/matrix#matrix_compatibility">版本依赖网站</a>选择适合你的版本。</p><p>根据版本依赖选择7.8.0版本的kibana（因为我的ES是7.8.0的）</p><blockquote><p>我后面换了ElasticSearch-7.13.0，所以Kibana的版本用7.13.0</p></blockquote><p><a href="https://www.elastic.co/cn/downloads/past-releases#kibana">kibana 下载地址 官网</a></p><p><a href="https://mirrors.huaweicloud.com/kibana/">kibana 下载地址 国内华为镜像</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-15%2021.45.57.png" alt="下载界面" style="zoom: 33%;" /></p><p>选择<code>kibana-7.8.0-linux-x86_64.tar.gz</code></p><p>下载好后移动到LInux平台上。</p><h1 id="安装Kibana"><a href="#安装Kibana" class="headerlink" title="安装Kibana"></a>安装Kibana</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xf kibana-7.8.0-linux-x86_64.tar -C /usr/local/</span><br></pre></td></tr></table></figure><p>然后删除原本的压缩包，或者包含压缩包的文件夹：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -rf kibana</span><br></pre></td></tr></table></figure><p>之后可以给解压后的文件改个名（也可以不改，不改可以看到版本（改了之后简洁一点，也能看版本只是会麻烦一点））：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> kibana-7.8.0-linux-x86_64/ kibana</span><br></pre></td></tr></table></figure><p>使用 <code>ll</code> 命令查看权限，如果权限不属于用户，则需要修改权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R hadoop103 kibana/</span><br><span class="line">sudo <span class="built_in">chgrp</span> -R hadoop103 kibana/</span><br></pre></td></tr></table></figure><h1 id="单节点安装"><a href="#单节点安装" class="headerlink" title="单节点安装"></a>单节点安装</h1><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/kibana/config/</span><br><span class="line"></span><br><span class="line">vim kibana.yml</span><br></pre></td></tr></table></figure><p>干脆懒得一个一个找了，直接在最后添加吧：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span> <span class="comment"># 这个不一定需要配置</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">hadoop103</span> <span class="comment"># 配置IP</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://hadoop103:9200&quot;</span>] <span class="comment"># es的地址</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span> <span class="comment"># 默认是英文，这个是中文设置</span></span><br></pre></td></tr></table></figure><p>然后保存退出即可。</p><h2 id="单节点启动"><a href="#单节点启动" class="headerlink" title="单节点启动"></a>单节点启动</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kibana</span><br></pre></td></tr></table></figure><h1 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h1><p>修改配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/kibana/config/kibana.yml</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="number">192.168</span><span class="number">.70</span><span class="number">.103</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://192.168.70.103:9200&quot;</span>,<span class="string">&quot;http://192.168.70.104:9200&quot;</span>,<span class="string">&quot;http://192.168.70.105:9200&quot;</span>]</span><br><span class="line"><span class="attr">elasticsearch.requestTimeout:</span> <span class="number">99999</span></span><br><span class="line"><span class="attr">server.name:</span> <span class="string">&quot;es_kibana&quot;</span></span><br></pre></td></tr></table></figure><p>然后分发kibana，需要修改<code>server.host</code>对应的端口，其他的不变。</p><p>每台机器都启动就行了。</p><p>访问：192.168.70.103:5601</p><p>第一次打开效果如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-16%2021.33.27.png" style="zoom: 25%;" /></p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> ElasticSearch </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Linux </tag>
            
            <tag> 集群 </tag>
            
            <tag> Kibana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建ElasticSearch集群</title>
      <link href="/posts/386609427.html"/>
      <url>/posts/386609427.html</url>
      
        <content type="html"><![CDATA[<h1 id="前置要求"><a href="#前置要求" class="headerlink" title="前置要求"></a>前置要求</h1><p>在搭建ElasticSearch集群前你最好已经是有三台虚拟机了，并且配置过其他集群。至少需要有 分发脚本。</p><h1 id="下载ElasticSearch"><a href="#下载ElasticSearch" class="headerlink" title="下载ElasticSearch"></a>下载ElasticSearch</h1><p><a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">es下载地址</a> 外国网站，可以用科学上网下载。</p><p>也可以从镜像网站下载：</p><p><a href="https://mirrors.huaweicloud.com/elasticsearch/?C=N&amp;O=D">ElasticSearch</a>   <a href="https://mirrors.huaweicloud.com/logstash/?C=N&amp;O=D">logstash</a>   <a href="https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D">kibana</a></p><p>当然，这里主要是配置ElasticSearch。logstash的作用是收集数据，kibanna是展示数据。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-13%2019.54.30.png" alt="截屏2023-03-13 19.54.30" style="zoom: 25%;" /></p><p>我选择 7.8.0 版本。之后点击Download。会跳转到如下页面。如果是x86架构（绝大多数Windows电脑）则点击 Linux x86_64。如果是Arm架构（Mac M系列芯片和少数Windows电脑）则选择 Linux AARCH64。</p><blockquote><p><strong>更新</strong></p><p>Mac M系列应该选择7.13.0及以上。因为Kibana在7.13.0一下没有linux_arm版的。需要版本一致。</p><p>注意，更新一定要把原本的文件完全删除。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-13%2019.59.31.png" alt="截屏2023-03-13 19.59.31" style="zoom: 33%;" /></p><p>下载好后传到Linux虚拟机中（随便一台即可）。</p><p>如果是Windows电脑建议使用 <code>xftp</code> 传输（<code>xshell</code>也会自带这个，如果有<code>xshell</code>就直接用<code>xshell</code>传输）。</p><p>Mac电脑用<code>FileZilla</code>传输。</p><h1 id="安装ElasticSearch"><a href="#安装ElasticSearch" class="headerlink" title="安装ElasticSearch"></a>安装ElasticSearch</h1><p>解压压缩文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xf elasticsearch-7.8.0-linux-aarch64.tar -C /usr/local</span><br></pre></td></tr></table></figure><p>删除原目录（我这里是先将压缩包文件放到你叫<code>elasticsearch</code>的目录下，现在解压完之后真正的内容在<code>/usr/local</code>下了，所以这里删除包含压缩包的文件夹）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> -rf elasticsearch</span><br></pre></td></tr></table></figure><p>给解压后的文件改名（其实不改也可以，方便看到版本，也方便使用多版本，看<strong>个人习惯</strong>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> elasticsearch-7.8.0/  elasticsearch</span><br></pre></td></tr></table></figure><p>修改拥有权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R hadoop103 elasticsearch/</span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">chgrp</span> -R hadoop103 elasticsearch/</span><br></pre></td></tr></table></figure><h1 id="配置ElasticSearch"><a href="#配置ElasticSearch" class="headerlink" title="配置ElasticSearch"></a>配置ElasticSearch</h1><blockquote><p><strong>更新：</strong></p><p>注意 ElasticSearch 对 jdk 有要求，需要先下载对应版本的jdk。</p><p>我这个版本的ElasticSearch是7.13.0。jdk理论上安装jdk11 - jdk17都可。jdk18和jdk19都不行。</p><p>安装jdk11:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openjdk-11-jdk</span><br></pre></td></tr></table></figure><p>之后配置jdk环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p>写入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ES_JAVA_HOME=/usr/lib/jvm/java-1.11.0-openjdk-arm64</span><br></pre></td></tr></table></figure><blockquote><p>如果是Windows或者x86架构的具体具体：<code>ls /usr/lib/jvm</code> 查看一下，大概率是写入：</p><p><code>export ES_JAVA_HOME=/usr/lib/jvm/java-1.11.0-openjdk-amd64</code></p></blockquote><p>注意：对每个节点都要执行相同操作</p></blockquote><h2 id="修改-config下的-elasticsearch-yml"><a href="#修改-config下的-elasticsearch-yml" class="headerlink" title="修改 /config下的 elasticsearch.yml"></a>修改 /config下的 elasticsearch.yml</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/elasticsearch/config</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim elasticsearch.yml</span><br></pre></td></tr></table></figure><p>进入之后主要是解开注释：</p><ul><li><p>在 Cluster 下，将<code>cluster.name: my-application</code>的注释解开，可以给集群修改一个名字。</p><p>  我修改后：<code>cluster.name: my-elasticsearch-cluster</code></p></li><li><p>在 Node 下，将<code>node.name: node-1</code>的注释解开，也可以改名，但是我没改。</p></li><li><p>在 Network 下，将<code>network.host: 192.168.70.103</code>的注释解开，这后面是虚拟机的IP，我这里已经是修改后的</p><p>  再将端口的注释打开（<code>http.port: 9200</code>）这个的值最好不要修改。</p></li><li><p>在 Discovery 下，将<code>cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</code>的注释解开</p></li></ul><p><strong>或者（这种是不想自己找，或者怕出错的，就直接在后面添加）：</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">my-elasticsearch-cluster</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span> </span><br><span class="line"><span class="attr">network.host:</span> <span class="number">192.168</span><span class="number">.70</span><span class="number">.103</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="修改-config下的-jvm-options"><a href="#修改-config下的-jvm-options" class="headerlink" title="修改 /config下的 jvm.options"></a>修改 /config下的 jvm.options</h2><p>这一步主要是修改运行时的内存分配。将原来的<code>1G ~ 1G</code>修改为：<code>2G ～ 2G</code>。如果虚拟机内存比较小可以不修改。</p><p>将原本的：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms1g</span><br><span class="line">-Xmx1g</span><br></pre></td></tr></table></figure><p>改成：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms2g</span><br><span class="line">-Xmx2g</span><br></pre></td></tr></table></figure><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/elasticsearch_jvm_options.png" alt="修改jvm.options" style="zoom:33%;" /></p><p>再将下面的<code>8-13:-XX:+UseConcMarkSweepGC</code>改为：<code>8-13:-XX:+UseG1GC</code></p><p>保存退出。</p><h2 id="修改-etc-security-limits-conf"><a href="#修改-etc-security-limits-conf" class="headerlink" title="修改/etc/security/limits.conf"></a>修改/etc/security/limits.conf</h2><p>这个是配置系统的配置文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/security/limits.conf </span><br></pre></td></tr></table></figure><p>在最末尾添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop103 soft nofile 65536</span><br><span class="line">hadoop103 hard nofile 65536</span><br></pre></td></tr></table></figure><h2 id="修改-etc-security-limits-d-20-nproc-conf"><a href="#修改-etc-security-limits-d-20-nproc-conf" class="headerlink" title="修改/etc/security/limits.d/20-nproc.conf"></a>修改/etc/security/limits.d/20-nproc.conf</h2><p>这个也是系统的配置文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/security/limits.d/20-nproc.conf</span><br></pre></td></tr></table></figure><p>在最末尾添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop103 soft nofile 65536</span><br><span class="line">hadoop103 hard nofile 65536</span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure><h2 id="修改-etc-sysctl-conf"><a href="#修改-etc-sysctl-conf" class="headerlink" title="修改/etc/sysctl.conf"></a>修改/etc/sysctl.conf</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>在最后添加内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=262144</span><br></pre></td></tr></table></figure><p>重新加载（如果无法重新加载就：<code>su root</code>先切换为管理员身份，因为用的系统配置，比较底层，所以需要管理员身份）:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h2 id="测试单机配置"><a href="#测试单机配置" class="headerlink" title="测试单机配置"></a>测试单机配置</h2><p>在 <code>/usr/local/elasticsearch/bin</code>下输入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch</span><br></pre></td></tr></table></figure><p>启动。</p><p>访问：<a href="http://192.168.70.103:9200/">http://192.168.70.103:9200/</a></p><p>如果即为访问效果（在浏览器中现实类似JSON串的东西，有集群名字，节点名，elasticsearch的版本的信息）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-14%2023.22.44.png" alt="访问效果" style="zoom:50%;" /></p><p>之后按 <kbd>Ctrl</kbd> + <kbd>C</kbd> 退出。</p><p>但是这样启动就不能输入命令了，要输入命令就要退出，退出就关了。想要后台启动要加 <code>-d</code> 选项。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch -d</span><br></pre></td></tr></table></figure><p>查看是否启动，可以去访问网站，也可以访问线程：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux|grep elasticsearch</span><br></pre></td></tr></table></figure><p>也可以直接<code>jps</code>查看进程.</p><p>关闭就是：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 线程号</span><br></pre></td></tr></table></figure><p>例如，jsp查看进程号：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-16%2012.52.15.png" alt=""></p><p>进程号是：20374。所以：<code>kill -9 20374</code></p><h1 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h1><p>重新修改ES的配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/elasticsearch/config/elasticsearch.yml</span><br></pre></td></tr></table></figure><p>修改内容为：</p><blockquote><p>如果原本是注释，打开注释修改即可。</p><p>也可以直接在末尾添加这部分内容（把之前打开的注释重新注释上）。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">my-elasticsearch-cluster</span>  <span class="comment">#集群名称</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span>         <span class="comment">#节点名称，每个节点的名称不能重复</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="string">hadoop103</span>   <span class="comment">#ip地址，每个节点的地址不能重复</span></span><br><span class="line"><span class="comment">#是不是有资格主节点</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># head 插件需要这打开这两个配置</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.max_content_length:</span> <span class="string">200mb</span></span><br><span class="line"><span class="comment">#es7.x 之后新增的配置，初始化一个新的集群时需要此配置来选举 master</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>,<span class="string">&quot;node-2&quot;</span>,<span class="string">&quot;node-3&quot;</span>]</span><br><span class="line"><span class="comment">#es7.x 之后新增的配置，节点发现</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> [<span class="string">&quot;192.168.70.103:9300&quot;</span>,<span class="string">&quot;192.168.70.104:9300&quot;</span>,<span class="string">&quot;192.168.70.105:9300&quot;</span>]</span><br><span class="line"><span class="attr">gateway.recover_after_nodes:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">network.tcp.keep_alive:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">network.tcp.no_delay:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">transport.tcp.compress:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">discovery.zen.minimum_master_nodes:</span> <span class="number">3</span></span><br><span class="line"><span class="comment">#集群内同时启动的数据任务个数，默认是 2个</span></span><br><span class="line"><span class="attr">cluster.routing.allocation.cluster_concurrent_rebalance:</span> <span class="number">16</span></span><br><span class="line"><span class="comment">#添加或删除节点及负载均衡时并发恢复的线程个数，默认 4个</span></span><br><span class="line"><span class="attr">cluster.routing.allocation.node_concurrent_recoveries:</span> <span class="number">16</span></span><br><span class="line"><span class="comment">#初始化数据恢复时，并发恢复线程的个数，默认 4个</span></span><br><span class="line"><span class="attr">cluster.routing.allocation.node_initial_primaries_recoveries:</span> <span class="number">16</span></span><br></pre></td></tr></table></figure><p>修改后如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-16%2020.49.40.png" alt="修改后文件"></p><h2 id="分发文件"><a href="#分发文件" class="headerlink" title="分发文件"></a>分发文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /usr/local/elasticsearch/</span><br></pre></td></tr></table></figure><p>分发完之后，去查看，如果有data目录则进入data中，删除其中的nodes。<strong>三台机器都要删除</strong>。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-15%2012.52.26.png" alt="rm" style="zoom:50%;" /></p><p>如果没有就不用删除，如果有没太机器执行命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/elasticsearch/data/</span><br><span class="line"><span class="built_in">rm</span> -rf nodes/</span><br></pre></td></tr></table></figure><p>之后修改每个节点都配置文件（其他内容不用修改）：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network.host:</span> <span class="string">hadoop103</span>   <span class="comment">#ip地址，每个节点的地址不能重复</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span>         <span class="comment">#节点名称，每个节点的名称不能重复</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-15%2016.02.28.png" style="zoom:33%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-15%2016.01.27.png" style="zoom: 33%;" /></p><p>分发其他几个系统配置文件（前两个文件都要修改，所以不如直接去写一遍，不用分发了）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xsync /etc/security/limits.conf</span><br><span class="line">xsync /etc/security/limits.d/20-nproc.conf</span><br><span class="line">xsync /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>分发过去记得修改部分内容：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-15%2012.59.44.png" style="zoom: 50%;" /></p><p>然后重新加载：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h2 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h2><p>每台集群分别输入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/elasticsearch</span><br></pre></td></tr></table></figure><p>查看集群的节点：<a href="http://hadoop103:9200/_cat/nodes">http://hadoop103:9200/_cat/nodes</a></p><p>查看集群的健康状态：<a href="http://hadoop103:9200/_cat/health?v">http://hadoop103:9200/_cat/health?v</a></p><p>查看集群的索引数：<a href="http://hadoop103:9200/_cat/indices?v">http://hadoop103:9200/_cat/indices?v</a></p><p>查看集群所在磁盘的分配状况：<a href="http://hadoop103:9200/_cat/allocation?v">http://hadoop103:9200/_cat/allocation?v</a></p><p>查看集群的其它信息<a href="http://hadoop103:9200/_cat/">http://hadoop103:9200/_cat/</a></p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> ElasticSearch </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Linux </tag>
            
            <tag> ElasticSearch </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分割数组以得到最大和</title>
      <link href="/posts/3498516849.html"/>
      <url>/posts/3498516849.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给你一个整数数组 arr，请你将该数组分隔为长度最多为 k 的一些（连续）子数组。分隔完成后，每个子数组的中的所有值都会变为该子数组中的最大值。</p><p>返回将数组分隔变换后能够得到的元素最大和。</p><p><strong>注意，原数组和分隔后的数组对应顺序应当一致，也就是说，你只能选择分隔数组的位置而不能调整数组中的顺序。</strong></p><p>示例 1：</p><blockquote><p>输入：arr = [1,15,7,9,2,5,10], k = 3<br>输出：84</p><p>解释：<br>因为 k=3 可以分隔成 [1,15,7] [9] [2,5,10]，结果为 [15,15,15,9,10,10,10]，和为 84，是该数组所有分隔变换后元素总和最大的。<br>若是分隔成 [1] [15,7,9] [2,5,10]，结果就是 [1, 15, 15, 15, 10, 10, 10] 但这种分隔方式的元素总和（76）小于上一种。 </p></blockquote><p>示例 2：</p><blockquote><p>输入：arr = [1,4,1,5,7,3,6,1,9,9,3], k = 4<br>输出：83</p></blockquote><p>示例 3：</p><blockquote><p>输入：arr = [1], k = 1<br>输出：1</p></blockquote><p>提示：</p><ul><li><code>1 &lt;= arr.length &lt;= 500</code></li><li><code>0 &lt;= arr[i] &lt;= 109</code></li><li><code>1 &lt;= k &lt;= arr.length</code></li></ul><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/partition-array-for-maximum-sum/">1043. 分隔数组以得到最大和</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示第 i 个位置时的最大和</p></li><li><p>状态转移方程</p><p>  <code>dp[i] = max(dp[i], dp[j-1] + cnt*maxv)</code></p><p>  注意：</p><ul><li><p><code>cnt</code> 表示当前块中元素个数（提前判断是否小于 k）；<code>maxv</code> 表示当前块中的最大元素；<code>dp[j-1]</code> 表示当前块的前一个元素位置的最大和。</p></li><li><p>如果当好是第 0 个元素到当前元素可以分成一个块，这种情况没有 <code>dp[j-1]</code> ，此时的状态转移方程：</p><p>  <code>dp[i] = max(dp[i], cnt*maxv)</code></p></li></ul></li><li><p>初始条件</p><p>  没有固定的头部初始条件，但是为了比较大小，需要先给每个 <code>dp[i] = 0</code> ，赋值为 0 </p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> maxn 510</span></span><br><span class="line">    <span class="type">int</span> dp[maxn];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxSumAfterPartitioning</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = arr.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> maxv = <span class="number">0</span>,cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; ++i) &#123;</span><br><span class="line">            dp[i] = <span class="number">0</span>; cnt = <span class="number">0</span>; maxv = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line">                <span class="comment">// 得到最大元素</span></span><br><span class="line">                <span class="keyword">if</span> (arr[j] &gt; maxv) &#123;</span><br><span class="line">                    maxv = arr[j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 块中添加一个元素</span></span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="comment">// 如果不能添加了当前这次循环就结束</span></span><br><span class="line">                <span class="keyword">if</span>(cnt &gt; k) <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// 如果j != 0，说明有 j-1 ，就是用第一个状态转移方程，否则用第二个</span></span><br><span class="line">                <span class="keyword">if</span>(j) &#123;</span><br><span class="line">                    dp[i] = <span class="built_in">max</span>(dp[i], dp[j<span class="number">-1</span>] + cnt*maxv);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i] = <span class="built_in">max</span>(dp[i], cnt*maxv);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 线性dp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>打家劫舍II</title>
      <link href="/posts/2742438348.html"/>
      <url>/posts/2742438348.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>你是一个专业的小偷，计划偷窃沿街的房屋，每间房内都藏有一定的现金。这个地方所有的房屋都<strong>围成一圈</strong> ，这意味着第一个房屋和最后一个房屋是紧挨着的。同时，相邻的房屋装有相互连通的防盗系统，如果两间相邻的房屋在同一晚上被小偷闯入，系统会自动报警 。</p><p>给定一个代表每个房屋存放金额的非负整数数组，计算你 在不触动警报装置的情况下 ，今晚能够偷窃到的最高金额。</p><p>示例 1：</p><blockquote><p>输入：nums = [2,3,2]<br>输出：3<br>解释：你不能先偷窃 1 号房屋（金额 = 2），然后偷窃 3 号房屋（金额 = 2）, 因为他们是相邻的。</p></blockquote><p>示例 2：</p><blockquote><p>输入：nums = [1,2,3,1]<br>输出：4<br>解释：你可以先偷窃 1 号房屋（金额 = 1），然后偷窃 3 号房屋（金额 = 3）。<br>  偷窃到的最高金额 = 1 + 3 = 4 。</p></blockquote><p>示例 3：</p><blockquote><p>输入：nums = [1,2,3]<br>输出：3</p></blockquote><p>提示：</p><p><code>1 &lt;= nums.length &lt;= 100</code><br><code>0 &lt;= nums[i] &lt;= 1000</code></p><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/house-robber-ii/">213. 打家劫舍 II</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i][0]</code>表示抢过第一家的情况下 抢第 i 家后的金额</p><p>  <code>dp[i][1]</code>表示   抢第 i 家</p></li><li><p>确定状态转移方程</p><p>  <code>dp[i][j] = max(dp[i-1][j], dp[i-2][j] + nums[i])</code></p><p>  起始就是：<code>dp[i] = max(dp[i-1], dp[i-2] + nums[i])</code></p></li><li><p>确定初始状态</p><p>  <code>dp[0][0] = 0;</code></p><p>  <code>dp[0][1] = nums[0];</code></p><p>  <code>dp[1][0] = nums[1];</code></p><p>  <code>dp[1][1] = nums[0];</code></p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> maxn 110</span></span><br><span class="line">    <span class="type">int</span> dp[maxn][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">rob</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">max</span>(nums[<span class="number">0</span>], nums[<span class="number">1</span>]);</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>; dp[<span class="number">0</span>][<span class="number">1</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">1</span>][<span class="number">0</span>] = nums[<span class="number">1</span>]; dp[<span class="number">1</span>][<span class="number">1</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n - <span class="number">1</span> ; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">2</span> ; ++j)&#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i - <span class="number">2</span>][j] + nums[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[n - <span class="number">1</span>][<span class="number">0</span>] = <span class="built_in">max</span>(dp[n - <span class="number">2</span>][<span class="number">0</span>], dp[n - <span class="number">3</span>][<span class="number">0</span>] + nums[n - <span class="number">1</span>]);</span><br><span class="line">        dp[n - <span class="number">1</span>][<span class="number">1</span>] = dp[n - <span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(dp[n - <span class="number">1</span>][<span class="number">0</span>], dp[n - <span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 线性dp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>打家劫舍</title>
      <link href="/posts/2526659543.html"/>
      <url>/posts/2526659543.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>你是一个专业的小偷，计划偷窃沿街的房屋。每间房内都藏有一定的现金，影响你偷窃的唯一制约因素就是相邻的房屋装有相互连通的防盗系统，如果两间相邻的房屋在同一晚上被小偷闯入，系统会自动报警。</p><p>给定一个代表每个房屋存放金额的非负整数数组，计算你不触动警报装置的情况下 ，一夜之内能够偷窃到的最高金额。</p><p>示例 1：</p><blockquote><p>输入：[1,2,3,1]<br>输出：4</p><p>解释：偷窃 1 号房屋 (金额 = 1) ，然后偷窃 3 号房屋 (金额 = 3)。<br>  偷窃到的最高金额 = 1 + 3 = 4 。</p></blockquote><p>示例 2：</p><blockquote><p>输入：[2,7,9,3,1]<br>输出：12</p><p>解释：偷窃 1 号房屋 (金额 = 2), 偷窃 3 号房屋 (金额 = 9)，接着偷窃 5 号房屋 (金额 = 1)。<br>  偷窃到的最高金额 = 2 + 9 + 1 = 12 。</p></blockquote><p>提示：</p><p><code>1 &lt;= nums.length &lt;= 100</code><br><code>0 &lt;= nums[i] &lt;= 400</code></p><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/house-robber/">198. 打家劫舍</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示 抢了第 i 家后的金额</p></li><li><p>确定状态转移方程</p><p>  <code>dp[i] = max(dp[i - 1], dp[i - 2] + nums[i])</code></p><p>  相当于就是从 抢上一家不抢这一家的金额 和 抢这一家不抢上一家的金额 进行比较，得到一个最优结果。</p></li><li><p>确定初始条件或边界条件</p><p>  <code>dp[0] = nums[0]</code></p><p>  <code>dp[1] = max(nums[0], nums[1])</code></p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> maxn 110</span></span><br><span class="line">    <span class="type">int</span> dp[maxn];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">rob</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = nums[<span class="number">0</span>]; dp[<span class="number">1</span>] = <span class="built_in">max</span>(nums[<span class="number">0</span>] , nums[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            dp[i] = <span class="built_in">max</span>(dp[i <span class="number">-1</span>], dp[i - <span class="number">2</span>] + nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 线性dp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解码方法</title>
      <link href="/posts/1776114197.html"/>
      <url>/posts/1776114197.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>一条包含字母 A-Z 的消息通过以下映射进行了 编码 ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x27;A&#x27; -&gt; &quot;1&quot;</span><br><span class="line">&#x27;B&#x27; -&gt; &quot;2&quot;</span><br><span class="line">...</span><br><span class="line">&#x27;Z&#x27; -&gt; &quot;26&quot;</span><br></pre></td></tr></table></figure><p>要解码已编码的消息，所有数字必须基于上述映射的方法，反向映射回字母（可能有多种方法）。例如，<code>&quot;11106&quot;</code> 可以映射为：</p><ul><li><code>&quot;AAJF&quot;</code> ，将消息分组为 (1 1 10 6)</li><li><code>&quot;KJF&quot;</code> ，将消息分组为 (11 10 6)<br>  注意，消息不能分组为  (1 11 06) ，因为 “06” 不能映射为 “F” ，这是由于 “6” 和 “06” 在映射中并不等价。</li></ul><p>给你一个只含数字的 非空 字符串 s ，请计算并返回 解码 方法的 总数 。</p><p>题目数据保证答案肯定是一个 32 位 的整数。</p><p>示例 1：</p><blockquote><p>输入：s = “12”<br>输出：2<br>解释：它可以解码为 “AB”（1 2）或者 “L”（12）。</p></blockquote><p>示例 2：</p><blockquote><p>输入：s = “226”<br>输出：3<br>解释：它可以解码为 “BZ” (2 26), “VF” (22 6), 或者 “BBF” (2 2 6) 。</p></blockquote><p>示例 3：</p><blockquote><p>输入：s = “0”<br>输出：0<br>解释：没有字符映射到以 0 开头的数字。<br>含有 0 的有效映射是 ‘J’ -&gt; “10” 和 ‘T’-&gt; “20” 。<br>由于没有字符，因此没有有效的方法对此进行解码，因为所有数字都需要映射。</p></blockquote><p>提示：</p><p><code>1 &lt;= s.length &lt;= 100</code><br>s 只包含数字，并且可能包含前导零。</p><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/decode-ways/">91. 解码方法</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示第 i 个位置的最多排序数</p></li><li><p>状态转移方程</p><ul><li><p>当前字符 不为 0 ，则一定可以独立编码</p><p>  初始 <code>dp[i] = dp[i-1]</code></p></li><li><p>当前字符    为 0，不可以独立编码</p><p>  初始 <code>dp[i] = 0</code></p></li><li><p>如果前一个字符为 1 或 2。即有可能表示为两位数的字母。可能可以与前一个位置共同编码</p><p>  在初始的基础上增加。</p><ul><li><p>有    i-2 （i-2不越界）</p><p>  <code>dp[i] += dp[i-2]</code></p></li><li><p>没有 i-2（i-2越界）</p><p>  <code>dp[i]++</code></p></li></ul></li></ul></li><li><p>确定初始化条件</p><p>  <code>dp[0] = (s[0] == &#39;0&#39;) ? 0 : 1;</code></p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> maxn 105</span></span><br><span class="line">    <span class="type">int</span> dp[maxn];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numDecodings</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">        dp[<span class="number">0</span>] = (s[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            dp[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(s[i] != <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">                dp[i] += dp[i - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s[i<span class="number">-1</span>] == <span class="string">&#x27;1&#x27;</span> || s[i<span class="number">-1</span>] == <span class="string">&#x27;2&#x27;</span>) &#123; <span class="comment">// 上一位数为 1 或 2 则可能可以与上一位组成一个字母</span></span><br><span class="line">                <span class="type">int</span> val = (s[i<span class="number">-1</span>] - <span class="string">&#x27;0&#x27;</span>) * <span class="number">10</span> + s[i] - <span class="string">&#x27;0&#x27;</span>;<span class="comment">// 与前一个位置的数组成的两位数数</span></span><br><span class="line">                <span class="keyword">if</span>(val &lt;= <span class="number">26</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(i == <span class="number">1</span>) dp[i]++;</span><br><span class="line">                    <span class="keyword">else</span> dp[i] += dp[i<span class="number">-2</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 线性dp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将数字变成 0 的操作次数</title>
      <link href="/posts/2482902029.html"/>
      <url>/posts/2482902029.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给你一个非负整数 num ，请你返回将它变成 0 所需要的步数。 如果当前数字是偶数，你需要把它除以 2 ；否则，减去 1 。</p><blockquote><p>示例 1：</p><p>输入：num = 14<br>输出：6</p><p>解释：<br>步骤 1) 14 是偶数，除以 2 得到 7 。<br>步骤 2） 7 是奇数，减 1 得到 6 。<br>步骤 3） 6 是偶数，除以 2 得到 3 。<br>步骤 4） 3 是奇数，减 1 得到 2 。<br>步骤 5） 2 是偶数，除以 2 得到 1 。<br>步骤 6） 1 是奇数，减 1 得到 0 。</p></blockquote><p>示例 2：</p><blockquote><p>输入：num = 8<br>输出：4</p><p>解释：<br>步骤 1） 8 是偶数，除以 2 得到 4 。<br>步骤 2） 4 是偶数，除以 2 得到 2 。<br>步骤 3） 2 是偶数，除以 2 得到 1 。<br>步骤 4） 1 是奇数，减 1 得到 0 。</p></blockquote><p>示例 3：</p><blockquote><p>输入：num = 123<br>输出：12</p></blockquote><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/number-of-steps-to-reduce-a-number-to-zero/">1342. 将数字变成 0 的操作次数</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="模拟"><a href="#模拟" class="headerlink" title="模拟"></a>模拟</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numberOfSteps</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ( num != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(num % <span class="number">2</span>) num--;</span><br><span class="line">            <span class="keyword">else</span> num /= <span class="number">2</span>;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示 把 i 变成零所需要的操作次数</p></li><li><p>确定状态转移方程</p><p>  若 i 为偶数：</p><p>  <code>dp[i] = dp[i / 2] + 1</code></p><p>  若 i 为奇数：</p><p>  <code>dp[i] = dp[i - 1] + 1</code></p></li><li><p>确定初始状态</p><p>  <code>dp[0] = 0</code></p></li><li><p>确定计算顺序</p><p>  递推类问题都是从前向后</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numberOfSteps</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> dp[num + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= num ; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">2</span>) dp[i] = dp[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> dp[i] = dp[i / <span class="number">2</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[num];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>这样做时空间复杂度都很高。这道题其实是不建议用动态规划做的。（模拟效率很高）</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 递推类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>青蛙跳台阶问题</title>
      <link href="/posts/1999788039.html"/>
      <url>/posts/1999788039.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>一只青蛙一次可以跳上1级台阶，也可以跳上2级台阶。求该青蛙跳上一个 n 级的台阶总共有多少种跳法。</p><p>答案需要取模 1e9+7（1000000007），如计算初始结果为：1000000008，请返回 1。</p><blockquote><p>示例 1：</p><p>输入：n = 2<br>输出：2</p></blockquote><p>示例 2：</p><blockquote><p>输入：n = 7<br>输出：21</p></blockquote><p>示例 3：</p><blockquote><p>输入：n = 0<br>输出：1</p></blockquote><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/qing-wa-tiao-tai-jie-wen-ti-lcof/">剑指 Offer 10- II. 青蛙跳台阶问题</a></p><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>这是一道DP问题。</p><ul><li><p>确定状态</p><p>  <code>dp[i]</code>表示跳到第 i 级台阶的跳法数</p></li><li><p>确定状态转移方程</p><p>  <code>dp[i] = dp[i - 1] + dp[i - 2]</code></p></li><li><p>确定初始状态或边界条件</p><p>  <code>dp[0] = 1,dp[1] = 1</code></p></li><li><p>确定计算顺序</p><p>  从小计算到大。级数大的状态需要级数小的状态</p></li></ul><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">//#define maxn 10000</span></span><br><span class="line">    <span class="comment">//int dp[maxn];</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numWays</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span> || n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> dp[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++i) &#123;</span><br><span class="line">            dp[i] = (dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>]) % <span class="number">1000000007</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="动态规划（空间优化）"><a href="#动态规划（空间优化）" class="headerlink" title="动态规划（空间优化）"></a>动态规划（空间优化）</h2><blockquote><p>由于每次需要的状态只与前两次有关，所以其实只需要三个变量（当前状态，上一个状态，上上个状态）</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numWays</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span> || n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>, a = <span class="number">1</span>, b = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++i) &#123;</span><br><span class="line">            sum = (a + b) % <span class="number">1000000007</span>;</span><br><span class="line">            a = b;</span><br><span class="line">            b = sum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><blockquote><p>动态规划其实就是一种递推的思想，这道题用递归也可以做。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numWays</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">0</span> || n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">numWays</span>(n - <span class="number">1</span>) + <span class="built_in">numWays</span>(n - <span class="number">2</span>)) % <span class="number">1000000007</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 递推类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬楼梯的最小成本</title>
      <link href="/posts/2265610284.html"/>
      <url>/posts/2265610284.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>数组的每个下标作为一个阶梯，第 <code>i</code> 个阶梯对应着一个非负数的体力花费值 <code>cost[i]</code>（下标从 0 开始）。</p><p>每当爬上一个阶梯都要花费对应的体力值，一旦支付了相应的体力值，就可以选择向上爬一个阶梯或者爬两个阶梯。</p><p>请找出达到楼层顶部的最低花费。在开始时，你可以选择从下标为 0 或 1 的元素作为初始阶梯。</p><p>示例 1：</p><blockquote><p>输入：cost = [10, 15, 20]<br>输出：15 </p><p>解释：最低花费是从 cost[1] 开始，然后走两步即可到阶梯顶，一共花费 15 。</p></blockquote><p>示例 2：</p><blockquote><p>输入：cost = [1, 100, 1, 1, 1, 100, 1, 1, 100, 1]<br>输出：6</p><p>解释：最低花费方式是从 cost[0] 开始，逐个经过那些 1 ，跳过 cost[3] ，一共花费 6 。</p></blockquote><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/GzCJIP/">剑指 Offer II 088. 爬楼梯的最少成本</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><blockquote><p>因为这道题到达的不是数组最后一个位置，而是数组的最后一个位置的后一个位置，所以添加一个占位0，表示到最后一个位置不需要花费</p></blockquote><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示到 i 位置需要的花费</p></li><li><p>确定状态转移方程</p><p>  <code>dp[i] = min(dp[i - 1], dp[i -2]) + cost[i]</code></p><p>  因为可以选择跳两次或跳一次，所以可以选择上一次和上上一次中花费最低的一次，然后加上这一层的花费，表示到这一层的需要的花费</p></li><li><p>确定边界条件或初始化条件</p><p>  多说一句，一般递推的题就是确实确定初始化条件。即从左往右算的题是需要确定初始化条件，从右往左算的题需要确定边界条件。</p><p>  <code>dp[0] = cost[0], dp[1] = cost[1]</code> 也就是初始就在第一个位置或第二个位置（站在该位置就需要花钱）</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minCostClimbingStairs</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">        cost.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> n = cost.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> dp[n];</span><br><span class="line">        dp[<span class="number">0</span>] = cost[<span class="number">0</span>],dp[<span class="number">1</span>] = cost[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span> ; i &lt; n ; i++) &#123;</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i - <span class="number">1</span>], dp[i - <span class="number">2</span>]) + cost[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="另外一种确定状态情况"><a href="#另外一种确定状态情况" class="headerlink" title="另外一种确定状态情况"></a>另外一种确定状态情况</h2><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示到 i 位置需要的花费（不加本身这一层）</p></li><li><p>确定状态转移方程</p><p>  <code>dp[i] = min(dp[i - 1] + cost[i - 1], dp[i - 2] + cost[i - 2])</code></p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minCostClimbingStairs</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = cost.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> dp[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = dp[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i - <span class="number">1</span>] + cost[i - <span class="number">1</span>], dp[i - <span class="number">2</span>] + cost[i - <span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>由于状态数组的大小不太方便确定，为了简化思维可以直接宏定义一个最大的值（最好比题给的值再大一点，不需要卡住某一个值）。例如：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> maxn 1024</span></span><br><span class="line">    <span class="type">int</span> dp[maxn];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minCostClimbingStairs</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = cost.<span class="built_in">size</span>();</span><br><span class="line">        dp[<span class="number">0</span>] = dp[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            dp[i] = <span class="built_in">min</span>(dp[i - <span class="number">1</span>] + cost[i - <span class="number">1</span>], dp[i - <span class="number">2</span>] + cost[i - <span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 递推类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最少的硬币数目</title>
      <link href="/posts/4044235327.html"/>
      <url>/posts/4044235327.html</url>
      
        <content type="html"><![CDATA[<p>其实这道题也算是 <a href="/posts/1557866301.html" title="完全背包问题">完全背包问题</a></p><h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给定不同面额的硬币 coins 和一个总金额 amount。编写一个函数来计算可以凑成总金额所需的最少的硬币个数。如果没有任何一种硬币组合能组成总金额，返回 -1。</p><p>你可以认为每种硬币的数量是无限的。</p><p>示例 1：</p><blockquote><p>输入：coins = [1, 2, 5], amount = 11<br>输出：3<br>解释：11 = 5 + 5 + 1</p></blockquote><p>示例 2：</p><blockquote><p>输入：coins = [2], amount = 3<br>输出：-1</p></blockquote><p>示例 3：</p><blockquote><p>输入：coins = [1], amount = 0<br>输出：0</p></blockquote><p>示例 4：</p><blockquote><p>输入：coins = [1], amount = 1<br>输出：1</p></blockquote><p>示例 5：</p><blockquote><p>输入：coins = [1], amount = 2<br>输出：2</p></blockquote><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/gaM7Ch/">剑指 Offer II 103. 最少的硬币数目</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i]</code> 表示余额为 i 时需要的最少硬币数</p></li><li><p>状态转移方程</p><p>  在 <code>i - coins[j]</code> 不会下标越界的前提下：</p><p>  <code>dp[i] = min(dp[i],dp[i - coins[j]] + 1)</code></p><p>  解释一下：</p><p>  这样的比较实际上时，在当前情况遍历三次硬币选取的情况的硬币最少值（默认<code>dp[i]</code>为int型的最大值，当取过值之后<code>dp[i]</code> 就表示上一种硬币取值的情况了）</p></li><li><p>确定边界条件或初始化条件</p><p>  初始化 <code>dp[0] = 0</code></p></li><li><p>确定计算顺序</p><p>  递推类型的题需要从左向右计算</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> INF INT_MAX</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> maxn 10001</span></span><br><span class="line">    <span class="type">int</span> dp[maxn];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">coinChange</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; coins, <span class="type">int</span> amount)</span> </span>&#123;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = coins.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= amount ; ++i) &#123;</span><br><span class="line">            dp[i] = INF;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span> ; j &lt; n ; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i &gt;= coins[j] &amp;&amp; dp[i - coins[j]] != INF)</span><br><span class="line">                    dp[i] = <span class="built_in">min</span>(dp[i] , dp[i - coins[j]] + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[amount] == INF ? <span class="number">-1</span> : dp[amount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 递推类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最小路径和</title>
      <link href="/posts/1633036852.html"/>
      <url>/posts/1633036852.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给定一个包含非负整数的 m x n 网格 grid ，请找出一条从左上角到右下角的路径，使得路径上的数字总和为最小。</p><p>说明：每次只能向下或者向右移动一步。</p><p>示例 1：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/minpath.jpg" alt="img"></p><blockquote><p>输入：grid = [[1,3,1],[1,5,1],[4,2,1]]<br>输出：7</p><p>解释：因为路径 1→3→1→1→1 的总和最小。</p></blockquote><p>示例 2：</p><blockquote><p>输入：grid = [[1,2,3],[4,5,6]]<br>输出：12</p></blockquote><p>提示：</p><ul><li><code>m == grid.length</code></li><li><code>n == grid[i].length</code></li><li><code>1 &lt;= m, n &lt;= 200</code></li><li><code>0 &lt;= grid[i][j] &lt;= 100</code></li></ul><hr><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><p><a href="https://leetcode.cn/problems/minimum-path-sum/">64. 最小路径和</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul><li><p>确定状态</p><p>  <code>dp[i][j]</code> 表示走到第 <code>i</code> , <code>j</code> 个位置时的最小花费</p></li><li><p>确定状态转移方程</p><p>  <code>dp[i][j] = min(d[i-1][j], dp[i][j-1]) + grid[i][j]</code></p></li><li><p>确定初始状态</p><p>  <code>dp[0][0] = grid[0][0]</code></p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> dp[<span class="number">210</span>][<span class="number">210</span>];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minPathSum</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; grid)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> m = grid.<span class="built_in">size</span>(), n = grid[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>] = grid[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; n ; ++i)&#123;</span><br><span class="line">            dp[<span class="number">0</span>][i] = dp[<span class="number">0</span>][i<span class="number">-1</span>] + grid[<span class="number">0</span>][i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span> ; i &lt; m ; ++i) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = dp[i<span class="number">-1</span>][<span class="number">0</span>] + grid[i][<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt; n ;++j) &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">min</span>(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]) + grid[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m<span class="number">-1</span>][n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 动态规划 </category>
          
          <category> 路径类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态规划基础</title>
      <link href="/posts/3405577485.html"/>
      <url>/posts/3405577485.html</url>
      
        <content type="html"><![CDATA[<h1 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1><h2 id="动态规划题的特点"><a href="#动态规划题的特点" class="headerlink" title="动态规划题的特点"></a>动态规划题的特点</h2><p>最明显的特点：求最优解<br>动态规划题一般只需要求步数之类的，不需要求具体方案（如果需要具体方案还是要用BFS或者递归来做）</p><p>动态规划一般都可分解为子问题<br>动态规划需要无后效性，即后面的结果可以利用前面的结果，但是不会改变前面的结果</p><h2 id="动态规划一般步骤"><a href="#动态规划一般步骤" class="headerlink" title="动态规划一般步骤"></a>动态规划一般步骤</h2><h3 id="1-确定状态"><a href="#1-确定状态" class="headerlink" title="1.确定状态"></a>1.确定状态</h3><p>主要是思考最后一步，然后将最后一步去掉就转换成立规模更小的的n-1步的子问题</p><p>状态也可认为是某个情况下的最优。例如背包问题：<code>dp[i][j]</code>可认为是有 i 件物品 背包容量还剩 j 时的最优。</p><h3 id="2-确定转移方程"><a href="#2-确定转移方程" class="headerlink" title="2.确定转移方程"></a>2.确定转移方程</h3><p>就是将第$n$步与$n-1$步等前面的几步建立联系，得一个推导公式，也就是转移公式，确定需要的储存数组</p><p>存储数组就是用来存储前面的状态。</p><h3 id="3-考虑初始条件和边界情况"><a href="#3-考虑初始条件和边界情况" class="headerlink" title="3.考虑初始条件和边界情况"></a>3.考虑初始条件和边界情况</h3><p>一般的初始条件都是$f[0] = 0$或$f[0][0] = 0$,具体分析<br>边界情况主要就是考虑数组是否会越界，什么时候停止循环，将不可能的状态设置成了无穷大，要避免计算超过范围也需要避免</p><h3 id="4-明白计算顺序"><a href="#4-明白计算顺序" class="headerlink" title="4.明白计算顺序"></a>4.明白计算顺序</h3><p>一般的计算顺序就是从左到右计算即从1开始来计算到n，因为第n步需要第1步的状态</p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><blockquote><p>主页还有很多例题，这里是最典型的几种题目，看不懂也没关系，多看，多练，自然而然就会了。主要是要理解上面的特点和一般步骤，知道如何确定状态和状态转移方程。</p></blockquote><h3 id="爬楼梯问题"><a href="#爬楼梯问题" class="headerlink" title="爬楼梯问题"></a>爬楼梯问题</h3><p>假设你正在爬楼梯。需要 <code>n</code> 阶你才能到达楼顶。</p><p>每次你可以爬 <code>1</code> 或 <code>2</code> 个台阶。你有多少种不同的方法可以爬到楼顶呢？</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入：n = 2</span><br><span class="line">输出：2</span><br><span class="line">解释：有两种方法可以爬到楼顶。</span><br><span class="line">1. 1 阶 + 1 阶</span><br><span class="line">2. 2 阶</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入：n = 3</span><br><span class="line">输出：3</span><br><span class="line">解释：有三种方法可以爬到楼顶。</span><br><span class="line">1. 1 阶 + 1 阶 + 1 阶</span><br><span class="line">2. 1 阶 + 2 阶</span><br><span class="line">3. 2 阶 + 1 阶</span><br></pre></td></tr></table></figure><p>数据范围：<code>1 &lt;= n &lt;= 45</code></p><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>很容易想到状态就是到达第 <code>i</code> 个楼梯的走法数量</p><p>这个时候到达第 <code>i</code> 个楼梯有几种可能？</p><p>—— 两种，从上一级台阶，走一步；从上上级台阶走两步</p><p>那么走到当前台阶有多少种走法？<code>dp[i] = dp[i-1] + dp[i-2]</code></p><p>状态和状态转移方程都有了，写代码</p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostrem&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">50</span>;</span><br><span class="line"><span class="type">int</span> n, dp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>, dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        dp[i] = dp[i<span class="number">-1</span>] + dp[i<span class="number">-2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; dp[n] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="硬币问题"><a href="#硬币问题" class="headerlink" title="硬币问题"></a>硬币问题</h3><p>给定一个数组，表示硬币的面值，比如数组A = {2,5,7}，表示有2元面值的硬币，5元面值的硬币，7元面值的硬币；然后给定一个价格例如27。要求计算用最少数量的硬币得到面值之和为27的组合，只需要得到硬币个数。</p><h4 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h4><p>问题要求求最少硬币的个数，但是没有要求求具体是那几个硬币，而且看到最少，一般就可以用动态规划来解题</p><ol><li>确定状态<br> 这道题的状态就是面值为$M-A[j]$的结果，也就是最后一步呀让n-1步加上一个面值等于27，之后看子问题就是求n-1步的最少硬币数，有和求n步的问题一样了</li><li>转移方程<br> 以示例数据为例，用一个数组f[]来储存面值为i时的最少硬币数量，即可以推到出转移公式为：<br> $f[27] = min{f[27-2]+1,f[27-5]+1,f[27-7]+1};$</li><li>考虑初始条件和边界情况<br> 这道题的初始条件应该时f[0] = 0,然后从f[1]开始计算<br> 边界情况应该考虑M-A[j]会不会小于零导致数组下标越界的问题,并且这道题会在如果f[i-A[j]]没有解的情况下设置为最大数,所以要判断f[i-A[j]]是否为最大数,是也不能有其计算</li><li>计算顺序<br> 就先计算面值为1,2,3…..M就好</li></ol><h4 id="具体代码实现"><a href="#具体代码实现" class="headerlink" title="具体代码实现"></a>具体代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Java.algorithm_study;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coinnum</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] A = &#123; <span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span> &#125;;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">M</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明一个储存数组，用来记录不同状态的结果</span></span><br><span class="line">        <span class="type">int</span>[] F = <span class="keyword">new</span> <span class="title class_">int</span>[M + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">//确定成员数组大小</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> A.length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始条件</span></span><br><span class="line">        F[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= M; i++) &#123;<span class="comment">//拼成银币为i元</span></span><br><span class="line">            F[i] = Integer.MAX_VALUE;<span class="comment">//先让i为无穷大</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i &gt;= A[j] &amp;&amp; F[i - A[j]] != Integer.MAX_VALUE) &#123;</span><br><span class="line">                    F[i] = Math.min(F[i],F[i-A[j]]+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(F[M] == Integer.MAX_VALUE)&#123;</span><br><span class="line">            System.out.println(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(F[M]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        scanner.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="机器人走方格"><a href="#机器人走方格" class="headerlink" title="机器人走方格"></a>机器人走方格</h3><p>让机器人从矩阵方格的第一个位置开始出发,走到矩阵方格的右下角位置,矩阵方格为m*n,要求求从左上角走到右下角有多少种走法(只能向下移动或向右移动)<br>题目链接:<br><a href="https://leetcode-cn.com/problems/unique-paths/">机器人走方格</a></p><h4 id="问题分析-1"><a href="#问题分析-1" class="headerlink" title="问题分析"></a>问题分析</h4><ol><li>确定状态<br> 最后一步是走到(m-1,n-1)的位置,走到这个格子有两种可能即从(m-2,n-1)走过来,或者从(m-1,n-2)走过来,那么计算的子问题就是要求走到(m-2,n-1)和(m-1,n-2)的走法<br> 因为右两个状态,所以需要一个二维的数组用来储存状态</li><li>转移方程<br> 因为(m-1)(n-1)的可以从(m-2,n-1)和(m-1,n-2)两个位置走来,那么就是(m-2,n-1)和(m-1,n-2)的走法之和就可以得到转移方程为:<br> $f[i][j] = f[i-1][j] + f[i][j-1]$;</li><li>初始条件和边界情况<br> 初始条件应该是$f[0][0] = 1$<br> 边界情况是i = 0时走法为1,因为只能一直向右走才能走到(不能向上走)<br> 同样j = 0时的一列的走法也为1<br> 即发$f[0][i] = f[j][0] = 1;$<br> 为了简化时间,直接在循环中初始化</li><li>计算顺序<br> 从左到右求出一行后再求下一行,这样$f[i][i]$的上一行已经求过了,即$f[i-1][j]$可以直接用了,在这一步的前面一步也已经求了$f[i][j-1]$了,转移方程需要的条件就都有了</li></ol><h4 id="具体代码实现-1"><a href="#具体代码实现-1" class="headerlink" title="具体代码实现"></a>具体代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Java.algorithm_study;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Unique_paths</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> <span class="number">3</span>, n = <span class="number">7</span>;<span class="comment">//题目条件,假设是3*7的矩阵</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建储存矩阵</span></span><br><span class="line">        <span class="type">int</span>[][] f = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用转移方程求解</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="comment">//初始化边界情况</span></span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span> || j == <span class="number">0</span>) &#123;</span><br><span class="line">                    f[i][j] = <span class="number">1</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    f[i][j] = f[i - <span class="number">1</span>][j] + f[i][j - <span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(f[m-<span class="number">1</span>][n-<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 动态规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>完全背包问题</title>
      <link href="/posts/1557866301.html"/>
      <url>/posts/1557866301.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>有 N 种物品和一个容量是 V 的背包，<strong>每种物品都有无限件可用。</strong>(<span style="background: pink">这个是完全背包类问题的主要特点</span>)</p><p>第 i 种物品的体积是 vi，价值是 wi。</p><p>求解将哪些物品装入背包，可使这些物品的总体积不超过背包容量，且总价值最大。<br>输出最大价值。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行两个整数，N，V，用空格隔开，分别表示物品种数和背包容积。</p><p>接下来有 N 行，每行两个整数 vi,wi，用空格隔开，分别表示第 i 种物品的体积和价值。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一个整数，表示最大价值。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>0&lt;N,V≤1000<br>0&lt;vi,wi≤1000</p><h4 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 5</span><br><span class="line">1 2</span><br><span class="line">2 4</span><br><span class="line">3 4</span><br><span class="line">4 5</span><br></pre></td></tr></table></figure><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="最直白代码"><a href="#最直白代码" class="headerlink" title="最直白代码"></a>最直白代码</h2><p>这个代码在提交时会超时，但是对于理解很直观：</p><p>它的主要思想就是对于 <code>i,j</code> 位置遍历所有拿 <code>i</code> 的个数 <code>k</code> （<code>0 &lt;= k &lt;= j/v[i]</code>）的情况得到最优的价值。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> v[N], w[N], dp[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 输入数据</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n ; ++i) cin &gt;&gt; v[i] &gt;&gt; w[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n ; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k * v[i] &lt;= j; ++k)  <span class="comment">// 判断拿k个时的大小，选择最大的</span></span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i][j], dp[i<span class="number">-1</span>][j - v[i]*k] + w[i]*k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; dp[n][m] &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="优化为两重循环"><a href="#优化为两重循环" class="headerlink" title="优化为两重循环"></a>优化为两重循环</h2><p>因为我们是按照读入的顺序，进行DP的，所以其实可以在读入数据时，就进行DP。例如读入第 <code>i</code> 个物品的体积和价值，那么我们就去把对于第 <code>i</code> 个物品的所有价值的情况遍历一次，这个时候就不需要<code>v</code>数组，<code>w</code>数组了，只需要两个变量即可。</p><p>真正实现状态转移方程：<code>dp[i][j] = max(dp[i-1][j], dp[i][j-v] + w)</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> dp[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> v, w;</span><br><span class="line">        cin &gt;&gt; v &gt;&gt; w;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; ++j)&#123;</span><br><span class="line">            dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">            <span class="keyword">if</span>(j &gt;= v)</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i][j - v] + w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; dp[n][m] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="再优化空间复杂度"><a href="#再优化空间复杂度" class="headerlink" title="再优化空间复杂度"></a>再优化空间复杂度</h2><p>很多时候的DP问题其实都可以优化空间，因为一般状态转移方程都只和几个状态有关，例如最基础的爬楼梯问题，就只是需要前面两个状态，最终可由数组变成三个变量，即 O(n) =&gt; O(1)。</p><p>同理这里也可以降低纬度：我们发现当前状态只与上一个状态有关，这里的上一个状态泛指还没有这个物品时的各种容量的状态。那么很容易想到：用两个数组来滚动存储状态，A数组存有n-1个物体时的各种容量的状态，B数组就是当前n个物体的状态。</p><p>但是这样不好写代码，所以用到奇偶的思想。i 为奇数时有 A 数组，i 为偶数时用 B 数组。</p><p>看代码理解：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> dp[<span class="number">2</span>][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)&#123;</span><br><span class="line">        <span class="type">int</span> v, w;</span><br><span class="line">        cin &gt;&gt; v &gt;&gt; w;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; ++j)&#123;</span><br><span class="line">            dp[i &amp; <span class="number">1</span>][j] = dp[(i - <span class="number">1</span>) &amp; <span class="number">1</span>][j];</span><br><span class="line">            <span class="keyword">if</span>(j &gt;= v)</span><br><span class="line">                dp[i &amp; <span class="number">1</span>][j] = <span class="built_in">max</span>(dp[i &amp; <span class="number">1</span>][j], dp[i &amp; <span class="number">1</span>][j - v] + w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; dp[n &amp; <span class="number">1</span>][m] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以空间复杂度从O(n^2) 变成了 O(n)</p><h2 id="优化最终版代码"><a href="#优化最终版代码" class="headerlink" title="优化最终版代码"></a>优化最终版代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> dp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> v, w;</span><br><span class="line">        cin &gt;&gt; v &gt;&gt; w;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = v; j &lt;= m; ++j)</span><br><span class="line">            dp[j] = <span class="built_in">max</span>(dp[j], dp[j - v] + w);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; dp[m] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里注意先看下标，逐步理解：</p><p>我们在01背包时没有做优化，那就用最直观的未优化版本来对比：</p><p><code>dp[i][j] = max(dp[i][j], dp[i-1][j-v[i]]+w[i]);//01背包</code></p><p><code>dp[i][j] = max(dp[i][j], dp[i][j-v[i]]+w[i]);//完全背包问题</code></p><p>可以看出来唯一的区别就是在状态转移方程后面，如果要使用的状态变了，变成了<code>dp[i][j-v[i]] + w[i]</code></p><p>很简单，不用上个物品，容量为<code>j-v[i]</code>的状态了，就用前面算出来的当前物品，容量为<code>j-v[i]</code>的状态（容量是从小到大算出来的，所以<code>j-v[i]</code>容量时一定是计算了的）</p><p>这里理解之后就是套用上面的空间优化思路：然后发现状态转移方程既然已经和上一个物品状态无关了，那么也没有必要两个数组了，最终一个数组搞定。</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 动态规划 </category>
          
          <category> 背包类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>01背包问题</title>
      <link href="/posts/1765123828.html"/>
      <url>/posts/1765123828.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>如果你没有动态规划基础请先看 <a href="/posts/3405577485.html" title="动态规划基础">动态规划基础</a></p></blockquote><h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>有 N 件物品和一个容量是 V 的背包。<strong>每件物品只能使用一次。最多一次 </strong>(<span style="background: pink">这个就是01背包问题的主要特点了</span>)</p><p>第 i 件物品的体积是 vi，价值是 wi。</p><p>求解将哪些物品装入背包，可使这些物品的总体积不超过背包容量，且总价值最大。<br>输出最大价值。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行两个整数，N，V，用空格隔开，分别表示物品数量和背包容积。</p><p>接下来有 N 行，每行两个整数 vi,wi，用空格隔开，分别表示第 i 件物品的体积和价值。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一个整数，表示最大价值。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>0&lt;N,V≤1000<br>0&lt;vi,wi≤1000</p><h4 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 5</span><br><span class="line">1 2</span><br><span class="line">2 4</span><br><span class="line">3 4</span><br><span class="line">4 5</span><br></pre></td></tr></table></figure><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8</span><br></pre></td></tr></table></figure><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>其实思路很简单，就是构造一个网格，举个例子：</p><p>就用样例数据，构建好的dp数组为：</p><div class="table-container"><table><thead><tr><th></th><th>容量为0</th><th>容量为1</th><th>容量为2</th><th>容量为3</th><th>容量为4</th><th>容量为5</th></tr></thead><tbody><tr><td>可选物品0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>可选物品1（1，2）</td><td>0</td><td>2</td><td>2</td><td>2</td><td>2</td><td>2</td></tr><tr><td>可选物品2（2，4）</td><td>0</td><td>2</td><td>4</td><td>6</td><td>6</td><td>6</td></tr><tr><td>可选物品3（3，4）</td><td>0</td><td>2</td><td>4</td><td>6</td><td>6</td><td>8</td></tr><tr><td>可选物品4（4，5）</td><td>0</td><td>2</td><td>4</td><td>6</td><td>6</td><td>8</td></tr></tbody></table></div><p>构造的状态就是<code>dp[i][j]</code>，在可选 <code>i</code> 件物品，且有 <code>j</code> 的容量的情况下的最大价值。</p><p>我们先维护 <code>i</code> 也就是将有 <code>i</code> 件物品的所有容量情况计算出来。当新添加一个物品是，有如下两种操作：</p><ul><li><p>不拿</p><p> 不拿就相当于是没有新添加这件物品，它就是等于没有这个物品在这个容量时的价值。</p><p> 即 <code>dp[i][j] = dp[i-1][j]</code></p></li><li><p>拿</p><p>  拿了的话容量就会减少，我们要先判断是否可以拿，所以需要先判断容量 <code>j &gt;= vi</code> 时才可拿</p><p>  如果可以拿就要判断拿了之后价值是否会有提升，拿了之后容量变成了 <code>j - vi</code> ，所以就相当于当前物品的价值 加上 没有这个物品且容量为<code>j - vi</code>时的最优价值。即<code>dp[i][j] = dp[i-1][j-vi] + wi</code></p></li></ul><p>最终还要判断到底拿不拿，就是一个比较就行啦，所以维护状态，或者说状态转移方程就是：</p><p><code>dp[i][j] = max(dp[i-1][j], dp[i-1][j-vi] + wi)</code></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n, v;   <span class="comment">// n 个点， v的最大体积</span></span><br><span class="line"><span class="type">int</span> w[N][<span class="number">2</span>],dp[N][N]; <span class="comment">// 读入的权重数组，动态规划数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 读入数据</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; w[i][<span class="number">0</span>] &gt;&gt; w[i][<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化dp数组</span></span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="built_in">sizeof</span>(dp));</span><br><span class="line">    <span class="comment">// 执行dp操作</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= v; ++j) &#123;</span><br><span class="line">            dp[i][j] = dp[i<span class="number">-1</span>][j]; <span class="comment">// 先不拿</span></span><br><span class="line">            <span class="comment">// 如果要第 i 件物品，需要先判断空间够不够</span></span><br><span class="line">            <span class="keyword">if</span> (j &gt;= w[i][<span class="number">0</span>]) &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i][j], dp[i<span class="number">-1</span>][j-w[i][<span class="number">0</span>]] + w[i][<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; dp[n][v] &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其实还可以做优化，可自行思考。或者借鉴在 <a href="/posts/1557866301.html" title="完全背包问题">完全背包问题</a>中的优化思路</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 动态规划 </category>
          
          <category> 背包类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UTM安装Windows虚拟机</title>
      <link href="/posts/2888309600.html"/>
      <url>/posts/2888309600.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>这里是安装arm版的Windows，可能有部分的x86软件无法使用。</p></blockquote><h1 id="资源准备"><a href="#资源准备" class="headerlink" title="资源准备"></a>资源准备</h1><ul><li>UTM：<a href="https://mac.getutm.app" title="https://mac.getutm.app">UTM | Virtual machines for Mac</a></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2008.46.29.png" alt="截屏2023-01-18 08.46.29" style="zoom: 20%;" /></p><p>​    直接点击Download是免费下载的。</p><p>​    点击Mac App Store会跳转到苹果应用商店，收费¥50。</p><ul><li><p>UTM显示优化软件：spice- guest-tools镜像（自行搜索下载，后续如果没有这个驱动则会没有网络）</p></li><li><p>Windows镜像</p><p>  <a href="https://next.itellyou.cn/Original/#">NEXT,IELLYOU</a>,打开效果（选择对应版本下载即可）：</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-02%2009.13.28.png" alt="NEXT,ITELLYOU" style="zoom:25%;" /></p><p>  这边建议选择ed2k下载。点击复制ed2k，然后迅雷打开，下载速度较快（如果速度不快就重启迅雷再下载，普通用户2-3Mb/s是正常的）。我选择的版本：</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-02%2009.13.28.png" style="zoom: 25%;" /></p></li></ul><h1 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h1><ul><li><p>选择新建一个虚拟机</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2d9de73ffdfa42c787b5c64ad90e2a0f.png" style="zoom: 33%;" /></p></li><li><p>选择虚拟化</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/beca8946b6a4453088942156ee61c735.png" style="zoom:33%;" /></p></li><li><p>选择Windows</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/0c100daa6f1f4243ab036d8e43db635c.png" style="zoom:33%;" /></p></li><li><p>选择Windows镜像</p><p>  就是刚才下载的Windows镜像文件，如果是iso文件就直接点击浏览选择即可。如果是VHDX后缀文件，需要选择倒入VHDX磁盘镜像</p><p>  注意路径最好不要有中文。</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/5dee532eef4246f2877e34dc343ea25c.png" style="zoom:33%;" /></p></li><li><p>其他设置</p><p>  后续操作我是直接点下一步，全部都是默认的。</p><p>  其中硬件中的内存选项，内存大小最好不要超过物理机的一半。如果是8Gb的机器最好选2048MB的内存。</p><p>  最后名字可以随便取。不用勾选打开VM设置（或者打开虚拟机设置）</p></li></ul><h1 id="安装Windows"><a href="#安装Windows" class="headerlink" title="安装Windows"></a>安装Windows</h1><p>在左侧打开刚才创建的虚拟机。</p><h2 id="有Shell的问题"><a href="#有Shell的问题" class="headerlink" title="有Shell的问题"></a>有Shell的问题</h2><p>如果出现以下情况（没出现说明你运气好），则关闭再重新进入：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/90fbbfd7db4542d7be5a3ae17e298360.png" style="zoom:38%;" /></p><p>如果关闭重进还是有这个，最好换个版本的Windows镜像。或者将两个CD/DVD都换成这个镜像再试试：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/ae1c1c499faf42b89fd8e1042a151244.png" style="zoom:34%;" /></p><h2 id="Windows安装设置"><a href="#Windows安装设置" class="headerlink" title="Windows安装设置"></a>Windows安装设置</h2><p>正常情况是不会有Shell那个见面的，直接就到了如下界面：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/b858b63e3bcd471d9f4966ac7b7c1d37.png" style="zoom:38%;" /></p><p>这样就是正常的。选择好对应选项（这里默认即可），点击下一页。</p><p>选择 现在安装：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/7d047e62beba4c92a99e2a7eae057045.png" style="zoom:38%;" /></p><p>选择 专业版，然后点击下一页：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/a1e01c13ca8f4f808f1b3a57fcd4bb50.png" style="zoom:38%;" /></p><h3 id="这台电脑无法运行Windows11报错"><a href="#这台电脑无法运行Windows11报错" class="headerlink" title="这台电脑无法运行Windows11报错"></a>这台电脑无法运行Windows11报错</h3><p>大多数情况都会出现这个问题，很正常。如果没有出现跳过这一步的操作即可，直接看：<a href="#接着安装">接着安装</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/4fea1763730c43ac87e13437a5087ea1.png" style="zoom:38%;" /></p><p>这里就需要修改注册表：</p><p>按快捷键：<kbd>Shift</kbd> + <kbd>F10</kbd> 如果是静音则按快捷键：<kbd>Shift</kbd> + <kbd>fn</kbd> + <kbd>F10</kbd></p><p>按下快捷键打开命令行面板，然后输入regedit：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/0af198c0970b4304b89f56e4067d94ef.png" style="zoom:38%;" /></p><p>按下回车即可打开注册表编辑器。找到路径 <code>HKEY_LOCAL_MACHINE</code>-&gt;<code>SYSTEM</code>-&gt;<code>Setup</code>，</p><p>然后 <code>新建</code>-&gt;<code>项</code> 名字叫 <code>LabConfig</code> (名字不能输出)：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/4f64a7159c2449e78537dede5cede612.png" style="zoom:38%;" /></p><p>在 <code>LabConfig</code> 中点击 <code>新建</code> -&gt; <code>DWORD(32 位)值(D)</code>（不要选择64 位，我试过了，没用）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/d4f2e69079df4fcbb50909228071ee12.png" style="zoom:38%;" /></p><p>新建两个，名字分别为：<code>BypassTPMCheck</code>和<code>BypassSecureBootCheck</code>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/15180b4acc144a39886154d69e2f1cff.png" style="zoom:38%;" /></p><p>修改两个文件的值。双击名称即可修改。两个都修改为1：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/0825a06c475b4427b79547107a6f1164.png" style="zoom:38%;" /></p><p>这样就好了。把前面的框关掉，然后点击上一步，再点击下一步。就没有无法安装的提示了，接着进行后续操作：</p><h3 id="接着安装"><a href="#接着安装" class="headerlink" title="接着安装"></a>接着安装</h3><p>勾选接受条款，然后下一页：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/745aec26052348b3893a8682674095a2.png" style="zoom:38%;" /></p><p>选择第二个（自定义安装）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/3ae66ca7314f4fa08923ab40cd39e097.png" style="zoom:38%;" /></p><p>直接点击下一页：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/043d21bf9d044dadbb5744f5579895cd.png" style="zoom:38%;" /></p><p>接下来就是等待安装了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/66a5d28914064295b5848a6e838be7f3.png" style="zoom:38%;" /></p><h1 id="清除镜像挂载"><a href="#清除镜像挂载" class="headerlink" title="清除镜像挂载"></a>清除镜像挂载</h1><p>安装好后如果没有关机，则点击虚拟机右三角倒数（从右往左数）第三个按钮（圆的像磁盘的按钮），选择刚才挂载的镜像，点击弹出。（最好先关机，然后执行下面的操作）</p><blockquote><p>说明：</p><p>如果不弹出有一定可能会在下一次打开时重新安装。即使没有重新安装，它的打开也是需要依赖镜像文件的，也就是说你的镜像文件不能移动和删除。</p><p>如果弹出了，你的镜像文件也可以删除，不会影响使用。</p></blockquote><p>如果是关机状态，则在下面点击CD/DVD然后点击清除：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/c1eebe067a7c412a8fb3be5345a7a5bc.png" style="zoom:38%;" /></p><h1 id="Windows设置"><a href="#Windows设置" class="headerlink" title="Windows设置"></a>Windows设置</h1><p>再次双击启动虚拟机，就会进入熟悉的Windows配置界面了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/863ee2547d874b0ba2f5958e17215aca.png" style="zoom:42%;" /></p><p>默认字体比较大，可以用<kbd>command</kbd> + <kbd>-</kbd>进行缩小（加就是放大）。接下来几步自己就能配置了。</p><h2 id="无法连接网络"><a href="#无法连接网络" class="headerlink" title="无法连接网络"></a>无法连接网络</h2><p>在连接到网络这一步大概率会出现问题（没有网络，也没法点击下一步）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/765a3bd047ce441f87f37cdc64d512aa.png" style="zoom:42%;" /></p><p>按快捷键：<kbd>Shift</kbd> + <kbd>F10</kbd> 如果是静音则按快捷键：<kbd>Shift</kbd> + <kbd>fn</kbd> + <kbd>F10</kbd></p><p>按下快捷键打开命令行面板，然后输入 <code>OOBE\BYPASSNRO</code> ，再按回车：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/85a9900a49e94488a709c3c0e7bb2975.png" style="zoom:42%;" /></p><p>这样是跳过网络连接，虚拟机应该会自动重新启动，前面的步骤一样，到了网络连接，选择<code>我没有Internet连接</code>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/6aa5b1a814fa4c8398fce049b2a6f650.png" style="zoom:42%;" /></p><p>接下来的操作应该就不会出现问题了，和初始化Windows一样的，根据文字提示选择即可。</p><p>最后就进入Windows虚拟机了。这个时候是没有网络的。</p><h1 id="挂载spice-guest-tools镜像"><a href="#挂载spice-guest-tools镜像" class="headerlink" title="挂载spice-guest-tools镜像"></a>挂载spice-guest-tools镜像</h1><p>和上面弹出挂载镜像类似，这里将下载好的spice-guest-tools镜像挂载上去即可。</p><ul><li><p>关机状态</p><p>  就在虚拟机设置的下面点 CD/DVD 然后浏览，选中镜像。再开机</p></li><li><p>开机状态</p><p>  点击右上角倒数（从右往左数）第三个按钮，挂载即可。</p></li></ul><p>挂载好后，D盘可以看到就是137MB的大小，如果不是这样则表示没有挂载好；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/7d88673cfa1c462580e7cfca85ffb929.png" style="zoom:42%;" /></p><p>点击进入D盘，然后双击 <code>spice-guest-tools-0.164</code>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/c1d3c2d6790043eb9bf7d2e933b0f864.png" style="zoom:42%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/940dcf1b2c48459bba80308a263771e6.png" style="zoom:42%;" /></p><p>点击是，然后依次点击<code>Next</code>和 <code>I Agree</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/d37f6c65b065481d96ad5d21e293b20a.png" style="zoom:42%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/0d244e5ffa144001be8c19f874b8c035.png" style="zoom:42%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/e749adf9c1e8409a9111e3d0dd063720.png" style="zoom:42%;" /></p><p>最后选择 <code>Finish</code> 即可：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/5438a52a03074ed69cd521c584e1a346.png" style="zoom:42%;" /></p><p>其实在这一步就已经有网了，选择第二个选项，稍后重启也可以用机器了，但是为了后续操作，所以说好现在就重启。</p><p>重启后，再弹出镜像，将 spice-guest-tools-0.164 镜像弹出（不弹出不耽误使用，但是镜像文件的位置不能变，也不能删除，干嘛不弹出）。这里建议最好是先关机再在虚拟机设置中，选择清除。</p><h1 id="虚拟机设置"><a href="#虚拟机设置" class="headerlink" title="虚拟机设置"></a>虚拟机设置</h1><h2 id="高分辨率模式"><a href="#高分辨率模式" class="headerlink" title="高分辨率模式"></a>高分辨率模式</h2><p>在关机状态</p><ol><li><p>点击右上角，选择 显示</p></li><li><p>右键虚拟机，点击编辑，进入设置：</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/be2e6eb0ade2406b9f24d61aec5e70c1.png" style="zoom:38%;" /></p><p>选择显示，然后勾选 “高分辨率模式”：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/4e32660835ff4a4aa733b0c7e12f1b2a.png" style="zoom:38%;" /></p><p>只勾选即可，虚拟显卡不一样也不要改，这个是根据机型和UTM版本自动选择的，总之不要其他操作。</p><p>如果你还想改内存之类的东西，就点击 <code>系统</code> 进行修改。</p><p>再开启虚拟机之后文字可能会很小，去Windows的设置里修改，显示比例和分辨率设置为适合你机器的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-03-02%2013.08.45.png" style="zoom:36%;" /></p><blockquote><p>到这里你就得到了一个几乎原版的Windows。</p><p>注意，这个Windows上最好不要弄太多软件，Mac上有，就用Mac的，因为你给Windows虚拟机的内存和磁盘并不大。</p><p>虽然是arm版的Windows，但是大多数的Windows的软件都是适配，尤其是比较新的版本的软件。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> 操作系统 </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最短路算法</title>
      <link href="/posts/1452790229.html"/>
      <url>/posts/1452790229.html</url>
      
        <content type="html"><![CDATA[<h1 id="最短路算法选择"><a href="#最短路算法选择" class="headerlink" title="最短路算法选择"></a>最短路算法选择</h1><p>n：点数</p><p>m：边数</p><ul><li><p>单源最短路</p><p>  求<strong>一个点</strong>到<strong>其他所有点</strong>到最短距离。求一个点到另一个点到距离。</p><ul><li><p>所有边权<strong>都是正数</strong></p><ul><li>朴素Dijkstra算法 $O(n^2)$<ul><li>和边数无关，适用于稠密图</li><li>代码更简洁</li></ul></li><li>堆优化版Dijkstra算法 $O(mlog_2n)$<ul><li>边数少，稀疏图才用</li><li>代码稍复杂</li></ul></li><li>SPFA算法也可以用<ul><li>SPFA的时间复杂度介于上面两者之间，有可能会被卡时间</li></ul></li></ul></li><li><p>存在<strong>负权边</strong></p><ul><li>Bellman-Ford $O(nm)$</li><li><p>SPFA  相当于市Bellman-Ford的优化，一般是 $O(m)$ ，最坏是 $O(nm)$</p><p>如果规定最多经过多少条边的话，就只能用Bellman-Ford算法</p></li></ul></li></ul></li><li><p>多源汇最短路</p><ul><li>源点：起点</li><li><p>汇点：终点</p><p>起点和终点不确定的最短路问题</p><p>Floyd算法 $O(n^3)$</p></li></ul></li></ul><h1 id="Dijkstra算法"><a href="#Dijkstra算法" class="headerlink" title="Dijkstra算法"></a>Dijkstra算法</h1><h2 id="朴素版"><a href="#朴素版" class="headerlink" title="朴素版"></a>朴素版</h2><h3 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h3><p>S：当前已经确定最短距离的点。</p><ol><li><p>初始化距离</p><p> <code>dist[1]=0, dist[i] = +INF</code></p><p> 即，只有起点的距离是确定的，遍历到了的</p></li><li><p>遍历找到不在S中的距离最近的点</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i: <span class="number">1</span> ~ n:</span><br><span class="line">t = 不在 S 中的距离最近的点</span><br><span class="line">    s = t</span><br><span class="line">    用 t 更新其他点的距离</span><br></pre></td></tr></table></figure><p> 这样遍历之后就可以确定每一个点的距离</p></li></ol><h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>给定一个 n 个点 m 个边的有向图，图中可能存在重边和自环，所有边权均为正值。</p><p>请你求出 1 号点到 n 号点到最短距离，如果无法从 1 号点走到 n 好点，则输出 -1.</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含整数 n 和 m</p><p>接下来 m 行，每行包含三个整数 x ， y， z，表示点 x 和 y 之间存在一条有向边，边长为 z。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一个整数，表示 1 号点到 n 号点到最短距离</p><p>如果路径不存在，则输出 -1.</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><script type="math/tex; mode=display">1 \le n \le 500 \\1 \le m \le 10^5 \\</script><h4 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2 2</span><br><span class="line">2 3 1</span><br><span class="line">1 3 4</span><br></pre></td></tr></table></figure><h4 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><h4 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h4><h5 id="流程图讲解"><a href="#流程图讲解" class="headerlink" title="流程图讲解"></a>流程图讲解</h5><p>为了直观理解，画图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../../../../Library/Application Support/typora-user-images/截屏2023-02-26 07.56.39.png" alt="截屏2023-02-26 07.56.39" style="zoom:50%;" /></p><p>第一步：初始化距离：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../../../../Library/Application Support/typora-user-images/截屏2023-02-26 07.57.53.png" alt="截屏2023-02-26 07.57.53" style="zoom:50%;" /></p><p>这个时候把 1 号点加入集合 S 中，表示已经确定的点。</p><p>第二步，迭代距离：</p><ol><li><p>现在迭代的是 1 号点到其他点到距离。用 1 号点更新其他点点距离。</p><ul><li>2 号点： 原来的值（正无穷） &gt; 距离（2）。更新距离为 2</li><li><p>3 号点： 原来的值（正无穷） &gt; 距离（4）。更新距离为 4</p><p>备注：如果无法到达就还是无穷，不更新</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../../../../Library/Application Support/typora-user-images/截屏2023-02-26 08.01.31.png" alt="截屏2023-02-26 08.01.31" style="zoom:50%;" /></p></li></ul></li><li><p>现在1号点是确定的点，之后遍历，不确定的点中到确定点距离最近点点。也就是这里距离为 2 点 2 号点。</p><ul><li><p>1 号点是已经确定的点了，距离不用变</p></li><li><p>3 号点</p><p>  更新后的距离：2号点的距离+2号点到3号点点权重 = 2 + 1 = 3</p><p>  原来的值（4） &gt; 更新后的距离（3）。更新距离为 3.</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../../../../Library/Application Support/typora-user-images/截屏2023-02-26 08.08.26.png" alt="截屏2023-02-26 08.08.26" style="zoom:50%;" /></p></li></ul></li><li><p>继续迭代剩下的未确定点中距离最小的点。这里是 3 号点。</p><p> 1 号点和 2 号点都已经确定了，所以没有更新。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../../../../Library/Application Support/typora-user-images/截屏2023-02-26 08.10.37.png" alt="截屏2023-02-26 08.10.37" style="zoom:50%;" /></p></li></ol><blockquote><p>最终，迭代了 3 次（3个点），结果是每个点到起点 1 号点点距离都确定了。</p><p>因为要遍历查找 n 个点，每次找n个点更新距离和找下一个不在S中的点都是n次，最终就是$O(n^2)$</p></blockquote><p>因为朴素Dijkstra更适用于稠密图，稠密图使用邻接矩阵点方式存储。</p><p>注意，题目中说到有重边和自环。</p><ul><li>重边：A 点到 B 点有两条路可以走</li><li>自环：自己可以到自己这个点</li></ul><p>在最短路问题中，重边只保留距离最短的就行了，自环不要。</p><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;    <span class="comment">// n 个点， m 条边</span></span><br><span class="line"><span class="type">int</span> g[N][N]; <span class="comment">// 邻接矩阵</span></span><br><span class="line"><span class="type">int</span> dist[N]; <span class="comment">// 每个点到起点的距离</span></span><br><span class="line"><span class="type">bool</span> st[N];  <span class="comment">// 已确定的点的集合</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化距离</span></span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 迭代 n 次</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="comment">// 先找没有确定距离的点中，距离最短的点（找点）</span></span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>; <span class="comment">// 此次遍历确定的点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; (t == <span class="number">-1</span> || dist[t] &gt; dist[j])) t = j;</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">true</span>; <span class="comment">// 加入到已确定的点</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用 t 更新其他点点距离</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) </span><br><span class="line">            dist[j] = <span class="built_in">min</span>(dist[j], dist[t] + g[t][j]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 输入</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="built_in">memset</span>(g, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(g));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读入 m 条边</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        g[a][b] = <span class="built_in">min</span>(g[a][b], c); <span class="comment">// 注意这里这道题会出现重边，只需要选择最小的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t =  <span class="built_in">dijkstra</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="堆优化版"><a href="#堆优化版" class="headerlink" title="堆优化版"></a>堆优化版</h2><p>分析朴素Dijkstra的运行过程，发现导致算法速度慢的主要问题是在找点上（找不在集合中的，距离最近的点）</p><p>刚好可以利用堆进行优化，使得找最近点点点复杂度为$O(1)$</p><p>堆一般是两种写法：</p><ul><li>手写。可以自己控制细节。手写复杂。</li><li>优先队列。不支持修改任意元素。</li></ul><p>堆优化算法一般用于稀疏图，稀疏图一般使用邻接表存储。</p><p>题目如上，相同。</p><h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> se second</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII; <span class="comment">// 堆中存储的实际是pair</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;                          <span class="comment">// n 个点， m 条边</span></span><br><span class="line"><span class="type">int</span> h[N], e[N], w[N], ne[N], idx;  <span class="comment">// 邻接表存储图</span></span><br><span class="line"><span class="type">int</span> dist[N];                       <span class="comment">// 每个点到起点的最短距离</span></span><br><span class="line"><span class="type">bool</span> st[N];                        <span class="comment">// 是否确定的集合</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 邻接表加边操作</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b, w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化各点距离</span></span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    priority_queue&lt;PII, vector&lt;PII&gt;, greater&lt;PII&gt;&gt; heap; <span class="comment">//  小根堆</span></span><br><span class="line">    heap.<span class="built_in">push</span>(&#123;<span class="number">0</span>, <span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (heap.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = heap.<span class="built_in">top</span>(); <span class="comment">// 类似于 &#123;0,  1&#125; 0表示距离，1表示点的编号</span></span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ver = t.se, distance = t.fi;</span><br><span class="line">        <span class="keyword">if</span> (st[ver]) <span class="keyword">continue</span>; <span class="comment">// 如果该点已经确定就继续</span></span><br><span class="line">        st[ver] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[ver]; i != <span class="number">-1</span>; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; distance + w[i]) &#123;</span><br><span class="line">                dist[j] = distance + w[i];</span><br><span class="line">                heap.<span class="built_in">push</span>(&#123;dist[j], j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 输入</span></span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读入 m 条边</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t =  <span class="built_in">dijkstra</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Bellman-Ford"><a href="#Bellman-Ford" class="headerlink" title="Bellman-Ford"></a>Bellman-Ford</h1><blockquote><p>对于有负权边的图，一定要知道，当经过负权回路时是没有最短路径的（负无穷）。</p><p>Bellman-Ford算法可以求出是否有负权回路。但是使用SPFA算法的要求是不存在负环。</p><p><strong>最多经过k条边</strong>是Bellman-Ford的特点，这种问题只能用Bellman-Ford算法来做。</p></blockquote><h2 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">初始化</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n次</span><br><span class="line">    备份</span><br><span class="line">    <span class="keyword">for</span> 所有边 a，b, w （从a到b，边权为w）</span><br><span class="line">       dist[b] = <span class="built_in">min</span>(dist[b], dist[a] + w)</span><br></pre></td></tr></table></figure><h2 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h2><h3 id="题目（注意根据题目分析算法的受用情况）"><a href="#题目（注意根据题目分析算法的受用情况）" class="headerlink" title="题目（注意根据题目分析算法的受用情况）"></a>题目（注意根据题目分析算法的受用情况）</h3><p>给定一个n个点，m条边的有向图，图中可能存在重边和自环，<strong>边权可能为负数</strong>。</p><p>请你求出从 1 号点到 n 号点的<strong>最多经过 k 条边</strong>的最短距离，如果无法从 1 号走到 n 点，输出 impossible</p><h4 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含三个整数n，m，k。</p><p>接下来m行，每行包含三个整数x，y，z，表示点x和点y之间存在一条有向边，边长为z。</p><h4 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一个整数，表示从 1 号到 n 号点的最多经过 k 条边的最短距离。</p><p>如果不存在满足条件的路径，则输出 impossible。</p><h4 id="数据范围-1"><a href="#数据范围-1" class="headerlink" title="数据范围"></a>数据范围</h4><script type="math/tex; mode=display">1 \le n,k \le 500 \\1 \le m \le 10^5</script><h4 id="输入样例-1"><a href="#输入样例-1" class="headerlink" title="输入样例"></a>输入样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3 3 1</span><br><span class="line">1 2 1</span><br><span class="line">2 3 1</span><br><span class="line">1 3 3</span><br></pre></td></tr></table></figure><h4 id="输出样例-1"><a href="#输出样例-1" class="headerlink" title="输出样例"></a>输出样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>, M = <span class="number">10010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, k;            <span class="comment">// n 个点，m 条边，最多经过k条边</span></span><br><span class="line"><span class="type">int</span> dist[N], backup[N]; <span class="comment">// dist表示到每个点最近的距离,backup是备份数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> a, b, w;</span><br><span class="line">&#125;edges[M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bellman_ford</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(backup, dist, <span class="built_in">sizeof</span>(dist)); <span class="comment">// 备份</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123; <span class="comment">// 最多找到 k 个边</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; ++j) &#123; <span class="comment">// 遍历 m 条边</span></span><br><span class="line">            <span class="type">int</span> a = edges[j].a, b = edges[j].b, w = edges[j].w;</span><br><span class="line">            dist[b] = <span class="built_in">min</span>(dist[b], backup[a] + w); <span class="comment">// 更新值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dist[n] &gt; <span class="number">0x3f3f3f3f</span> / <span class="number">2</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, w;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; w;</span><br><span class="line">        edges[i] = &#123;a, b, w&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">bellman_ford</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="number">-1</span>) <span class="built_in">puts</span>(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="SPFA"><a href="#SPFA" class="headerlink" title="SPFA"></a>SPFA</h1><blockquote><p>实际上是Bellman-Ford算法的优化，唯一缺点是在存在<strong>负权环</strong>的情况下不能用。但是很少有存在负权环的图。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">初始化一个队列 （queue &lt;- 1号点）</span><br><span class="line"><span class="keyword">while</span> 队列不为空</span><br><span class="line">取出队首元素 t</span><br><span class="line">    更新 t 的所有出边 t -&gt; <span class="built_in">b</span> (权重为w)</span><br><span class="line">    如果 b 变小了</span><br><span class="line">    queue &lt;- b</span><br></pre></td></tr></table></figure><p>队列里存的是变小的点（如果没有变小那么后继的点就不会变）。点变小之后，后继的点可能就会变小，所以需要对它的出边遍历。</p><h2 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h2><h3 id="题目（基础）"><a href="#题目（基础）" class="headerlink" title="题目（基础）"></a>题目（基础）</h3><p>给定一个n个点，m条边的有向图，图中可能存在重边和自环，<strong>边权可能为负数</strong>。</p><p>请你求出从 1 号点到 n 号点的最短距离，如果无法从 1 号走到 n 点，输出 impossible</p><h4 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含三个整数n，m。</p><p>接下来m行，每行包含三个整数x，y，z，表示点x和点y之间存在一条有向边，边长为z。</p><h4 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一个整数，表示从 1 号到 n 号点的最短距离。</p><p>如果不存在满足条件的路径，则输出 impossible。</p><h4 id="数据范围-2"><a href="#数据范围-2" class="headerlink" title="数据范围"></a>数据范围</h4><script type="math/tex; mode=display">1 \le n,k \le 500 \\1 \le m \le 10^5</script><h4 id="输入样例-2"><a href="#输入样例-2" class="headerlink" title="输入样例"></a>输入样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2 5</span><br><span class="line">2 3 -3</span><br><span class="line">1 3 4</span><br></pre></td></tr></table></figure><h4 id="输出样例-2"><a href="#输出样例-2" class="headerlink" title="输出样例"></a>输出样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure><h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;   <span class="comment">// n个点，m条边</span></span><br><span class="line"><span class="type">int</span> dist[N];    <span class="comment">// 最短距离</span></span><br><span class="line"><span class="type">int</span> h[N], e[N], w[N], ne[N], idx; <span class="comment">// 邻接表存图</span></span><br><span class="line"><span class="type">bool</span> st[N]; <span class="comment">// 判断点是否在队列里，而不是代表是否被遍历</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加边操作</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b, w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    dist[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    st[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; dist[t] + w[i]) &#123;</span><br><span class="line">                dist[j] = dist[t] + w[i];</span><br><span class="line">                <span class="keyword">if</span> (!st[j]) &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dist[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> dist[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">SPFA</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="number">-1</span>) <span class="built_in">puts</span>(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="题目2（判断负环）"><a href="#题目2（判断负环）" class="headerlink" title="题目2（判断负环）"></a>题目2（判断负环）</h3><p>给定一个n个点m条边的有向图，图中可能存在重边和自环，<strong>边权可能为负数。</strong></p><p>请你判断图中是否存在负权回路。</p><blockquote><p>注意不是判断从1开始的负环</p></blockquote><h4 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含整数n和m。</p><p>接下来m行每行包含三个整数x，y，z表示点x和点y之间存在一条有向边，边长为z。</p><h4 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h4><p>如果图中存在负权回路则输出“Yes”</p><p>否则输出“No”</p><h4 id="数据范围-3"><a href="#数据范围-3" class="headerlink" title="数据范围"></a>数据范围</h4><script type="math/tex; mode=display">1 \le n \le 2000, \\1 \le m \le 10000.</script><h4 id="输入样例-3"><a href="#输入样例-3" class="headerlink" title="输入样例"></a>输入样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2 -1</span><br><span class="line">2 3 4</span><br><span class="line">3 1 -4</span><br></pre></td></tr></table></figure><h4 id="输出样例-3"><a href="#输出样例-3" class="headerlink" title="输出样例"></a>输出样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes</span><br></pre></td></tr></table></figure><h3 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;   <span class="comment">// n个点，m条边</span></span><br><span class="line"><span class="type">int</span> dist[N], cnt[N];    <span class="comment">// dist表示最短距离，cnt表示到该点经过点边数</span></span><br><span class="line"><span class="type">int</span> h[N], e[N], w[N], ne[N], idx; <span class="comment">// 邻接表存图</span></span><br><span class="line"><span class="type">bool</span> st[N]; <span class="comment">// 判断点是否在队列里，而不是代表是否被遍历</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加边操作</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    e[idx] = b, w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这种不需要初始化</span></span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="comment">// 不是从 1 开始，所有不能直接加第一个点进队列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        st[i] = <span class="literal">true</span>;</span><br><span class="line">        q.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i]) &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (dist[j] &gt; dist[t] + w[i]) &#123;</span><br><span class="line">                dist[j] = dist[t] + w[i];</span><br><span class="line">                cnt[j] = cnt[t] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (cnt[j] &gt;= n) <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 存在负环</span></span><br><span class="line">                <span class="keyword">if</span> (!st[j]) &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 不存在负环</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">SPFA</span>()) <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Floyd"><a href="#Floyd" class="headerlink" title="Floyd"></a>Floyd</h1><p>Floyd是适用于多源汇最短路问题，所以它的存储方式也和一般情况不同，用<code>d[i,j]</code>表示从 <code>i</code> 到 <code>j</code> 的最短路径。</p><p>在算法中这个<code>d[i][j]</code>其实也就是邻接矩阵存图的<code>i</code>到<code>j</code>的边。</p><p>大概思路</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">初始化 d[i][j]</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; ++k) </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            d[i][j] = <span class="built_in">min</span>(d[i][j], d[i][k] + d[k][j])</span><br></pre></td></tr></table></figure><p>原理其实是基于<strong>动态规划</strong>。</p><h2 id="例题-3"><a href="#例题-3" class="headerlink" title="例题"></a>例题</h2><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>给定一个 n 个点 m 条边点有向图，图中可能存在重边和自环，<strong>边权可能为负数</strong>。</p><p>再给定 k 个询问，每个询问包含两个整数 x 和 y，表示查询从点 x 到点 y 点最短距离，如果路径不存在，则输出“impossible”。</p><p>数据保证不存在负权回路。</p><h4 id="输入格式-4"><a href="#输入格式-4" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含三个整数n，m，k</p><p>接下来m行，每行包含三个整数x，y，z，表示点x和点y之间存在一条有向边，边长为z。</p><p>接下来k行，每行包含两个整数x，y，表示询问点x到点y的最短距离。</p><h4 id="输出格式-4"><a href="#输出格式-4" class="headerlink" title="输出格式"></a>输出格式</h4><p>共 k 行，每行输出一个整数，表示询问的结果，若询问两点间不存在路径，则输出“impossible”。</p><h4 id="数据范围-4"><a href="#数据范围-4" class="headerlink" title="数据范围"></a>数据范围</h4><script type="math/tex; mode=display">1 \le n \le 200, \\1 \le k \le n^2, \\1 \le m \le 20000</script><h4 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3 3 2</span><br><span class="line">1 2 1</span><br><span class="line">2 3 2</span><br><span class="line">1 3 1</span><br><span class="line">2 1</span><br><span class="line">1 3</span><br></pre></td></tr></table></figure><h4 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">impossible</span><br><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">210</span>, INF = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, Q;    <span class="comment">// n个点m条边Q次询问</span></span><br><span class="line"><span class="type">int</span> d[N][N];    <span class="comment">// 直接用邻接矩阵来存距离了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">floyd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; ++k)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">                d[i][j] = <span class="built_in">min</span>(d[i][j],d[i][k] + d[k][j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; Q;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化邻接矩阵</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (i == j) d[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> d[i][j] = INF;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b, w;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; w;</span><br><span class="line">        d[a][b] = <span class="built_in">min</span>(d[a][b], w); <span class="comment">// 如果有重边，则保留权重最小的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">floyd</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Q; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="keyword">if</span> (d[a][b] &gt; INF / <span class="number">2</span>) <span class="built_in">puts</span>(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> cout &lt;&lt; d[a][b] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 图论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R语言环境</title>
      <link href="/posts/830372185.html"/>
      <url>/posts/830372185.html</url>
      
        <content type="html"><![CDATA[<h1 id="R语言环境安装"><a href="#R语言环境安装" class="headerlink" title="R语言环境安装"></a>R语言环境安装</h1><blockquote><p>必须先安装 R 语言的环境再安装RStudio</p></blockquote><p><a href="https://cran.r-project.org">安装链接</a></p><p>打开如图（选择<strong>macOS</strong>版）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-28%2018.47.42.png" style="zoom:50%;" /></p><p>接下来滑倒下面，选择 <strong>base</strong>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-28%2018.48.53.png" style="zoom:50%;" /></p><p>再任意选择一个版本即可：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-28%2018.49.37.png" style="zoom:50%;" /></p><p>下载到本地之后安装过程和其他软件一样。根据提示下一步和同意即可。</p><h1 id="安装RStudio"><a href="#安装RStudio" class="headerlink" title="安装RStudio"></a>安装RStudio</h1><p><a href="https://posit.co/download/rstudio-desktop/#download">安装链接</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-28%2018.53.47.png" style="zoom:50%;" /></p><p>点击第二个点按钮（DOWNLOAD RESTUDIO DESKTOP FOR MAC）。</p><p>或者滑到网页下面再选择对应版本的下载：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-28%2018.55.55.png" style="zoom:50%;" /></p>]]></content>
      
      
      <categories>
          
          <category> R语言 </category>
          
          <category> 编程环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> 环境 </tag>
            
            <tag> R语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>集群时间同步</title>
      <link href="/posts/4115971639.html"/>
      <url>/posts/4115971639.html</url>
      
        <content type="html"><![CDATA[<p>我这里列举了两种方法。第一种是网上常见的，但是我总是配置失败，报各种错。第二种是我结合思考根据第一种改编了，目前没有出现问题。您自行选择使用哪种。</p><blockquote><p>这些操作必须使用root权限（命令前加sudo）</p><p>如果没有特别说明，全部机器都要该操作。</p></blockquote><h1 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h1><ol><li><p>安装ntp服务和ntpdate服务</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ntp</span><br><span class="line">sudo apt-get install ntpdate</span><br></pre></td></tr></table></figure></li><li><p>查看所有节点 ntpd 服务状态和开机自启动状态</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status ntp# 查看服务状态</span><br><span class="line">sudo systemctl start ntp# 开启服务</span><br><span class="line">sudo systemctl is-enabled ntp# 开机自启动状态</span><br></pre></td></tr></table></figure><p> 如果第二步报错：<code>Failed to start ntp.service: Unit ntp.service is masked.</code></p><p> 就先输入：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl unmask ntp.service</span><br></pre></td></tr></table></figure><p> 先解除mask，然后在执行开启服务命令。</p></li><li><p>修改时区：d</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> <span class="comment"># 查看时间</span></span><br></pre></td></tr></table></figure><p> 发现时间和系统时间不同，修改时区。</p><p> 先查看一下当前时区：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br></pre></td></tr></table></figure><p> 我查了之后是：Etc/UTC (UTC, +0000)</p><p> 罗列一下可用时区：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones</span><br></pre></td></tr></table></figure><p> 浏览一下选择一个最近的，然后：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo timedatectl set-timezone Asia/Chongqing</span><br></pre></td></tr></table></figure><p> 我选的是重庆，一般可以选Asia/Shanghai。</p></li><li><p>设置时间为24小时（默认是12小时的，我不喜欢）</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/locale</span><br></pre></td></tr></table></figure><p> 添加：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LC_TIME=en_DK.UTF-8</span><br></pre></td></tr></table></figure><p> 修改后重启服务器即可（<code>reboot</code>）。</p></li><li><p>如果有如下情况：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/cluster_time2.png" alt="System clock synchronized: no"></p><p> 即：<code>System clock synchronized: no</code>。表示同步服务没有启动：</p><p> 需要：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install systemd-timesyncd</span><br></pre></td></tr></table></figure><p> 完了之后它会说重启服务（如下图），不用选，按下Tab就到了OK，回车即可。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/cluster_time3.png" alt="重启服务"></p><p> 再输入<code>timedatectl</code>查看，如果是yes就OK了。</p></li></ol><h1 id="第一种方法"><a href="#第一种方法" class="headerlink" title="第一种方法"></a>第一种方法</h1><ol><li><p>修改hadoop103的ntp.conf配置文件</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s</span><br></pre></td></tr></table></figure><p> 修改内容为：</p><ul><li><p>修改授权 192.168.64.0-192.168.64.255 网段上的所有机器可以从这台机器上查询和同步时间</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restrict 192.168.64.0 mask 255.255.255.0 nomodify notrap</span><br></pre></td></tr></table></figure><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/ntp_modify2.png" alt="修改后"></p></li><li><p>注释掉使用外部网络</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pool 0.ubuntu.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pool 1.ubuntu.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pool 2.ubuntu.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pool 3.ubuntu.pool.ntp.org iburst</span></span><br></pre></td></tr></table></figure></li><li><p>当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中 的其他节点提供时间同步</p><p>  在<code>pool ntp.ubuntu.com</code>下添加（这一行也要注释掉）：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server 127.127.1.0</span><br><span class="line">fudge 127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure><p>修改后如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/ntp_modify.png" alt="修改后"></p></li></ul></li><li><p>关闭其他机器上的ntp服务和自启动</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop ntp</span><br><span class="line">sudo systemctl disable ntp</span><br></pre></td></tr></table></figure></li><li><p>其他机器每十分钟来向主机（hadoop103）同步一次时间</p><p> 注意，hadoop103不写，只有其他机器才写。</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br></pre></td></tr></table></figure><p> 如果出现如下情况：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/cluster_time1.png" alt="情形"></p><p> 则选择2（/usr/bin/vim.basic）.</p><p> 编写定时任务：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * /usr/sbin/ntpdate hadoop103</span><br></pre></td></tr></table></figure><h1 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h1></li></ol><p>这个根据第一种方法得到的灵感。第一种方法是关闭其他两台服务器的ntp服务，然后编写定时任务，每十分钟向主节点hadoop103申请时间同步。我就在想，干脆三台节点都编写定时任务，每十分钟向Windows或Mac主机请求同步时间，不也是准确的吗。</p><p>如果你执行了第一种方法请先还原相关配置（按第一种方法逆向操作、关闭的东西该开就打开）。因为我是逆向操作了的，如果不还原我也不知道会不会出其他错。</p><p>只要时间都是可主机大差不差，就直接编写定时任务即可：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br></pre></td></tr></table></figure><p>编写：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * /usr/sbin/ntpdate cn.pool.ntp.org</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> 操作系统 </category>
          
          <category> HBase </category>
          
          <category> Hadoop </category>
          
          <category> Linux </category>
          
          <category> 环境搭建 </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Linux </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建HBase集群</title>
      <link href="/posts/1817748743.html"/>
      <url>/posts/1817748743.html</url>
      
        <content type="html"><![CDATA[<h1 id="下载Hbase"><a href="#下载Hbase" class="headerlink" title="下载Hbase"></a>下载Hbase</h1><p>这里下载2.4.11版本的Hbase。下载网址：<a href="https://archive.apache.org/dist/hbase/2.4.11/">https://archive.apache.org/dist/hbase/2.4.11/</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/download_hbase.png" alt="下载列表" style="zoom:50%;" /></p><p>下载 hbase-2.4.11-bin.tar.gz。点击即可下载。</p><p>弄到<code>/usr/local</code>目录下，可以借鉴zookeeper和hadoop的方法。接下来都是在<code>/usr/local</code>目录下操作。</p><p>然后解压：</p><p>.tar后缀：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xf hbase-2.4.11-bin.tar</span><br></pre></td></tr></table></figure><p>.tar.gz后缀:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxf hbase-2.4.11-bin.tar</span><br></pre></td></tr></table></figure><p>然后改名：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> hbase-2.4.11 hbase</span><br></pre></td></tr></table></figure><p>更改拥有者和所属用户组：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> hadoop103 hbase</span><br><span class="line">sudo <span class="built_in">chgrp</span> hadoop103 hbase</span><br></pre></td></tr></table></figure><p>删除压缩包（看你想不想删除，都行）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> hbase-2.4.11-bin.tar</span><br></pre></td></tr></table></figure><h1 id="配置Hbase"><a href="#配置Hbase" class="headerlink" title="配置Hbase"></a>配置Hbase</h1><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p>编写内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HBASE_HOME </span></span><br><span class="line"><span class="built_in">export</span> HBASE_HOME=/usr/local/hbase</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HBASE_HOME</span>/bin</span><br></pre></td></tr></table></figure><p>刷新：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>测试是否有效：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HBASE_HOME</span></span><br></pre></td></tr></table></figure><p>如果从原本的<code>/usr/local</code>目录跳转到你<code>/usr/local/hbase</code>目录就正确了。</p><p>其他两台节点同样配置。</p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>配置文件目录：<code>$HBASE/conf</code></p><p>主要配置<code>hbase-env.sh</code>、<code>hbase-site.xml</code>和<code>regionservers</code>文件。</p><ul><li><p>hbase-env.sh</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$HBASE_HOME</span>/conf/hbase-env.sh</span><br></pre></td></tr></table></figure><ul><li><p>找到 <code># export JAVA_HOME=/usr/java/jdk1.8.0/</code></p><p>  放开注释，并修改为<code>export JAVA_HOME=$JAVA_HOME</code></p></li><li><p>下面三行 <code># export HBASE_CLASSPATH=</code></p><p>  放开注释，并修改为：<code>export HBASE_CLASSPATH=/usr/local/hadoop/etc/hadoop</code></p><p>  如图：</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hbase_env2.png" alt="修改hbase-nev.sh" style="zoom:50%;" /></p></li><li><p>找到<code># export HBASE_MANAGES_ZK=true</code> 这个在倒数几行。</p><p>  放开注释，并改为false。</p><p>  如图：</p><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hbase_env.png" alt="修改hbase-env.sh" style="zoom:50%;" /></p><p>  其实这里用true的话就可以用它内置的zookeeper了，但是我们部署好了zookeeper了，就不需要了，而且直接部署的zookeeper的稳定性更好。</p><p>这里应该需要强制保存退出，输入<code>:wq!</code></p></li></ul></li><li><p>hbase-site.xml</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$HBASE_HOME</span>/conf/hbase-site.xml</span><br></pre></td></tr></table></figure><p>  修改配置最终为（需要删除两个原本的property，原本有三个，只保留第一个并且value改为true）：</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt; </span><br><span class="line">&lt;?xml-stylesheet <span class="built_in">type</span>=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt; </span><br><span class="line"> </span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;hadoop103,hadoop104,hadoop105&lt;/value&gt;</span><br><span class="line">    &lt;description&gt;The directory sharedvi by RegionServers.&lt;/description&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;hdfs://hadoop103:8020/hbase&lt;/value&gt;</span><br><span class="line">    &lt;description&gt;The directory shared by RegionServers.&lt;/description&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.unsafe.stream.capability.enforce&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;<span class="literal">false</span>&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.replication&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;3&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;hbase.wal.provider&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;filesystem&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></li><li><p>regionservers</p><p>  这个和hadoop的workers类似</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$HBASE_HOME</span>/conf/regionservers</span><br></pre></td></tr></table></figure><p>  编写：</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br><span class="line">hadoop105</span><br></pre></td></tr></table></figure></li><li><p>解决HBase和Hadoop的log4j兼容性问题，修改HBase的jar包，使用Hadoop的jar包：</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> <span class="variable">$HBASE_HOME</span>/lib/client-facing-thirdparty/slf4j-reload4j-1.7.33.jar <span class="variable">$HBASE_HOME</span>/lib/client-facing-thirdparty/slf4j-reload4j-1.7.33.jar.bak</span><br></pre></td></tr></table></figure></li><li><p>高可用</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> <span class="variable">$HBASE_HOME</span>/conf/backup-masters</span><br><span class="line"><span class="built_in">echo</span> hadoop104 &gt; <span class="variable">$HBASE_HOME</span>/conf/backup-mastersv</span><br></pre></td></tr></table></figure></li></ul><p>分发hbase：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync <span class="variable">$HBASE_HOME</span></span><br></pre></td></tr></table></figure><h1 id="启动HBase服务"><a href="#启动HBase服务" class="headerlink" title="启动HBase服务"></a>启动HBase服务</h1><blockquote><p>要提前确保HDFS和zookeeper是已经启动状态。即启动hadoop集群和zookeeper集群。</p></blockquote><h2 id="Zookeeper正常部署"><a href="#Zookeeper正常部署" class="headerlink" title="Zookeeper正常部署"></a>Zookeeper正常部署</h2><p>想要部署Hbase集群需要先部署运行Zookeeper集群，如果您还没有Zookeeper集群，请参看：<a href="/posts/983786067.html" title="搭建Zookeeper集群">搭建Zookeeper集群</a></p><p>启动Zookeeper集群，你如果是跟着我的步骤搭建的Zookeeper集群，那么你可以直接用启停脚本启动。</p><p>启动：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk start</span><br></pre></td></tr></table></figure><p>查看是否启动成功，查看状态。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk status</span><br></pre></td></tr></table></figure><p>如果你没有编写启停脚本，就每台节点都去执行一次启动命令也行。</p><h2 id="Hadoop正常部署"><a href="#Hadoop正常部署" class="headerlink" title="Hadoop正常部署"></a>Hadoop正常部署</h2><p>Hbase也是基于Hadoop集群的，如果您没有搭建，请参看：<a href="/posts/4177218757.html" title="hadoop集群搭建指南">hadoop集群搭建指南</a></p><p>启动hadoop集群，如果你是跟着我的指南搭建的hadoop集群，那么你可以直接使用启停脚本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myhadoop start</span><br></pre></td></tr></table></figure><p>如果你没有脚本，那么你就单独启动每台节点。</p><hr><p>上两步效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/Hbase_start_hadoop_zookeeper.png" alt="启动效果" style="zoom:50%;" /></p><h2 id="启动HBase"><a href="#启动HBase" class="headerlink" title="启动HBase"></a>启动HBase</h2><ol><li><p>单点启动</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$HBASE_HOME</span>/bin/hbase-daemon.sh start master</span><br><span class="line"><span class="variable">$HBASE_HOME</span>/bin/hbase-daemon.sh start regionserver</span><br></pre></td></tr></table></figure></li><li><p>群起</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$HBASE_HOME</span>/bin/start-hbase.sh</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hbase_run.png" alt="群起"></p></li><li><p>停止</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$HBASE_HOME</span>/bin/stop-hbase.sh</span><br></pre></td></tr></table></figure><p> 有时候停会一直出现省略号，等很久都停不掉。分别输入（每台节点都要去关，不能自动全关了）：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase-daemon.sh stop master</span><br><span class="line"></span><br><span class="line">hbase-daemon.sh stop regionserver</span><br></pre></td></tr></table></figure><p> 还不行就直接kiil -9 进程号。</p><p> 进程号用<code>jps</code>查看,前面的数字就是进程号。</p></li></ol><h2 id="查看Hbase页面"><a href="#查看Hbase页面" class="headerlink" title="查看Hbase页面"></a>查看Hbase页面</h2><p>HBase的管理页面，打开链接：<a href="http://hadoop103:16010">http://hadoop103:16010</a></p><p>单点启动效果如图（只启动了hadoop103）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-25%2022.17.34.png" alt="截屏2023-02-25 22.17.34" style="zoom: 50%;" /></p><p>集群启动效果如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-25%2022.23.02.png" alt="截屏2023-02-25 22.23.02" style="zoom:50%;" /></p><h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><p>总的来说hbase安装时需要考虑的东西是不多的。主要配置文件也就是<code>hbase-env.sh</code>和<code>hbase-site.xml</code>两个文件。主要问题应该是在版本上。我目前的版本：</p><ul><li>hadoop：3.3.1</li><li>zookeeper：3.7.1</li><li>hbase：2.4.11</li></ul><p>版本不一定稳定，后续有问题会更新说明。</p><p>如果和我相同版本，出了问题，大概率就是您配置文件和我的不同。</p><hr><p>可以正常jpsall，但是无法访问web端。</p><p>原因：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop103:8020/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The directory shared by RegionServers.<span class="tag">&lt;/<span class="name">description</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的端口和hadoop的core-site.xml的内容不对应。</p><p>如果是jpsall之后成功启动了，但是过个十多二十秒，就自动关闭了，那就是没有配置集群时间同步（Ubuntu22.04自带有集群时间同步，大概率排出这个问题）。要配置集群时间同步请参看文章：<a href="/posts/4115971639.html" title="集群时间同步">集群时间同步</a></p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> HBase </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HBase </tag>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
            <tag> ZooKeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中序和后序重构二叉树</title>
      <link href="/posts/716459272.html"/>
      <url>/posts/716459272.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>一个二叉树，树中每个节点的权值互不相同。</p><p>现在给出它的后序遍历和中序遍历，请你输出它的<strong>层序遍历</strong>。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含整数 N，表示二叉树的节点数。</p><p>第二行包含 N 个整数，表示二叉树的后序遍历。</p><p>第三行包含 N 个整数，表示二叉树的中序遍历。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一行 N 个整数，表示二叉树的层序遍历。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>$1 \le N \le 30$</p><h4 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">2 3 1 5 7 6 4</span><br><span class="line">1 2 3 4 5 6 7</span><br></pre></td></tr></table></figure><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4 1 6 3 5 7 2</span><br></pre></td></tr></table></figure><p>有思路后可在如下网站中提交（题目有一点不同）：</p><p><a href="https://leetcode.cn/problems/construct-binary-tree-from-inorder-and-postorder-traversal/">https://leetcode.cn/problems/construct-binary-tree-from-inorder-and-postorder-traversal/</a></p><h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>首先先要明确前序遍历、中序遍历、后序遍历和层序遍历的基础。并且了解它们的性质。如果不懂，请看文章：<a href="/posts/2225903441.html" title="二叉树基础">二叉树基础</a></p><p>这里简单说一下性质：</p><ul><li>后序遍历：遍历结果为“左-右-根”。所以当前结果序列的最后一个元素必定是子树的根节点。并且结果集一定是：<strong>左子树-右子树-根节点</strong>。左子树的所有节点都排在前面。</li><li>中序遍历：遍历结果为“左-根-右”。所以中序遍历可以根据根节点切分左右子树</li></ul><p>这种还原树的思路：</p><p>还原树都是中序+前序，或者中序+后序。原理是：在前序和后序中，很容易得到子树的根节点。得到了根节点就可以在中序比哪里结果集中得到左右子树。再分割左右子树，递归操作。</p><p>并且有一个重要的特性：<strong>不会有重复元素</strong>。</p><h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">35</span>;</span><br><span class="line"><span class="type">int</span> in[N], post[N], n; <span class="comment">// in, post 记录中序遍历和后续遍历的值</span></span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; l, r, pos; <span class="comment">// l, r记录左右节点的值, pos记录在中序遍历中的值</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l1, <span class="type">int</span> r1, <span class="type">int</span> l2, <span class="type">int</span> r2)</span> </span>&#123; <span class="comment">// l1,r1是in[]的左右界，l2,r2是post[]的左右界</span></span><br><span class="line">    <span class="type">int</span> root = post[r2];</span><br><span class="line">    <span class="type">int</span> k = pos[root]; <span class="comment">// k-1-l1 代表左子树有多少个节点</span></span><br><span class="line">    <span class="keyword">if</span> (l1 &lt; k) &#123; <span class="comment">// 存在左子树,递归操作左子树</span></span><br><span class="line">        l[root] = <span class="built_in">build</span>(l1, k<span class="number">-1</span>, l2, l2 + k<span class="number">-1</span>-l1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r1 &gt; k) &#123; <span class="comment">// 存在右子树，递归操作右子树</span></span><br><span class="line">        r[root] = <span class="built_in">build</span>(k+<span class="number">1</span>, r1, l2 + k-l1, r2<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> root)</span> </span>&#123; <span class="comment">// 层序遍历</span></span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(root);</span><br><span class="line">    <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            cout &lt;&lt; t;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> cout &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; t;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(l.<span class="built_in">count</span>(t)) q.<span class="built_in">push</span>(l[t]);</span><br><span class="line">        <span class="keyword">if</span>(r.<span class="built_in">count</span>(t)) q.<span class="built_in">push</span>(r[t]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; post[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; in[i];</span><br><span class="line">        pos[in[i]] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> root = <span class="built_in">build</span>(<span class="number">0</span>, n<span class="number">-1</span>, <span class="number">0</span>, n<span class="number">-1</span>); <span class="comment">// 构建原树</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">bfs</span>(root); <span class="comment">// 层序遍历树</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码解释"><a href="#代码解释" class="headerlink" title="代码解释"></a>代码解释</h2><p>这里的输入就不用说了。因为考虑到中序遍历可以划分左右子树。但是它后序遍历的左右子树怎么得到。</p><p>我们清楚后序遍历的结果性质：<strong>左子树-右子树-根节点</strong></p><p>所以我们只要知道左子树有多少个节点，就可以划分出左子树了。刚好中序遍历就可以获取到节点个数。</p><p>个数为：<code>pos_root - in_l - 1</code>。即，根节点位置（我们在读入中序遍历时就用哈希表存起来了）减去当前集合到左集合，在减去自己这个节点。</p><p>所以划分后：</p><ul><li><p>左子树集合：</p><ul><li><p>中序遍历：<code>in_l, pos_root - 1</code></p></li><li><p>后序遍历：<code>post_l, post_l + pos_root - in_l - 1</code></p></li></ul></li><li><p>右子树集合：</p><ul><li>中序遍历：<code>k+1, in_r</code></li><li>后序遍历：<code>post_l + pos_root _ in_l, post_r - 1</code></li></ul></li></ul><p>根据划分继续递归操作就行了。</p><p>解释构造函数：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l1, <span class="type">int</span> r1, <span class="type">int</span> l2, <span class="type">int</span> r2)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>返回值是当前构造的子树的根节点</li><li><code>l1,r1</code>是当前操作的子树在中序遍历中的左右区间</li><li><code>l2,r2</code>是当前操作的子树在后序遍历中的左右区间</li></ul><p>由于这类题的性质，不可能会有重复元素，所以我们用哈希表存储父节点和左右孩子节点。</p><p><code>l</code>存左节点的关系，<code>r</code>存右节点的关系。<code>l[root]</code>表示值为<code>root</code>的节点的左孩子节点的值。</p><p>最后再层序遍历即可（这里是要求最后不能有空格，所以复杂一点）。</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 树论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 树论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二叉树基础</title>
      <link href="/posts/2225903441.html"/>
      <url>/posts/2225903441.html</url>
      
        <content type="html"><![CDATA[<h1 id="树"><a href="#树" class="headerlink" title="树"></a>树</h1><p>前面已经了解了线性的数据结构(数组,链表,栈,队列,散列表)<br>现在来了解一下非线性的数据结构<br>树和图就是典型的非线性数据结构</p><h2 id="树的定义"><a href="#树的定义" class="headerlink" title="树的定义"></a>树的定义</h2><p>树是n(n&gt;=0)个结点的有限集.当n = 0时,称为空树</p><h2 id="非空树的特定"><a href="#非空树的特定" class="headerlink" title="非空树的特定"></a>非空树的特定</h2><ol><li>有且仅有一个特定的称为根的结点</li><li>当n&gt;1时,其余的结点可以分为m(m&gt;0)个互不相交的有限集,每一个集合本身又是一个树,并成为根的子树</li></ol><h2 id="树的成分"><a href="#树的成分" class="headerlink" title="树的成分"></a>树的成分</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-09%20201631.png" alt="屏幕截图 2022-03-09 201631" style="zoom: 50%;" /><br>图中深红色的点就是<strong>根节点（root)</strong>;结点5，6，7，8都是树的末端，没有”孩子”结点,就被称为<strong>叶子节点</strong>;虚线内的结点就是根结点的一个<strong>子树</strong>。<br>结点2是4的<strong>父节点</strong> ; 结点4的是结点7,8的<strong>父节点</strong>,因为结点7,8是节点4衍生出来的节点,所以节点7,8也称为节点4的<strong>孩子节点</strong> ; 节点5与节点4同级,并且由同一个父节点衍生出来,所以是节点4的<strong>兄弟节点</strong>。</p><h2 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h2><p>二叉树是树的一种特殊但又很常见的形式,故名思意,二叉树的每个节点<strong>最多有2个孩子节点</strong> ( 0 &lt;= 孩子节点个数 &lt;= 2 )<br>二叉树的两个节点一个被称为<strong>左孩子</strong>,一个被称为<strong>右孩子</strong><br>二叉树还有两种情形:</p><ol><li>满二叉树<br> 一个二叉树的所有非叶子节点又有左右孩子节点(两个都有),并且,所有叶子节点都在同一层级,就叫满二叉树。简单来说就是满二叉树的每一个分支都是满的</li><li>完全二叉树<br> 对于一个有n个节点的二叉树,按照层级顺序编号,则所有节点的编号为从1到n。如果这个树所有节点和同样深度的满二叉树的编号为从1到n的节点位置相同,则这个二叉树为完全二叉树.</li></ol><h2 id="二叉树在内存中的存储"><a href="#二叉树在内存中的存储" class="headerlink" title="二叉树在内存中的存储"></a>二叉树在内存中的存储</h2><p>二叉树属于逻辑结构,可以通过多种物理结构来表达<br>例如:</p><ol><li>链式存储结构</li><li>数组</li></ol><h3 id="链式储存结构"><a href="#链式储存结构" class="headerlink" title="链式储存结构"></a>链式储存结构</h3><p>也就是用数组来储存,这种储存结构是最直观的结构,与原始的数组相比,这种链表会多一个指针,因为原本的链表节点只需要指向下一个节点,但是对于二叉树来说需要指向两个节点,所以一般建立Node的数据结构属性为:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> Date;</span><br><span class="line">    <span class="keyword">private</span> Node left;<span class="comment">//左孩子节点</span></span><br><span class="line">    <span class="keyword">private</span> Node right;<span class="comment">//右孩子节点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数组存储结构"><a href="#数组存储结构" class="headerlink" title="数组存储结构"></a>数组存储结构</h3><p>二叉树对应的节点的位置是规定好了的,对应到数组中的下标位置,如果在二叉树中该位置的节点被空出来了,那么在数组中该位置的节点也会被空出来.<br>==对应的下标位置的规律:假设一个父节点的下标是parent,那么它的左孩子节点下标就是2<em>parent+1 ; 右孩子节点的下标就是2</em>parent+2==。==反过来,假设一个左孩子节点的下标是leftChild,那么它的父节点的下标就是(leftChild-1)/2==<br>但是在枝叶很稀疏的情况下,用数组结构来储存是很浪费空间的,所有就需要二叉堆</p><h2 id="二叉树的应用"><a href="#二叉树的应用" class="headerlink" title="二叉树的应用"></a>二叉树的应用</h2><p>主要应用于<strong>查找操作</strong>和<strong>维持相对顺序</strong>这两方面</p><h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><p><strong>二叉查找树</strong>：</p><ul><li>如果左子树不为空，则左子树上所有节点的值均小于根节点的值</li><li>如果右子树不为空，则右子树上所有节点的值均大于根节点的值</li><li>左、右子树也都是二叉查找树</li><li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-10%20200024.png" alt="屏幕截图 2022-03-10 200024" style="zoom:50%;" /><br>  如图，这就是一个二叉查找树。<br>  假设要找4，那么4先于根节点相比，4 &lt; 6,那么就访问左孩子节点即3,发现4&gt;3,就接着访问右孩子节点,即4,发现4 = 4就找到了</li></ul><p>==对于一个节点分布相对均衡的二叉查找树来说，如果节点总数是n，那么搜索节点的时间复杂度就是O(logn)，和树的深度是一样的==<br>这种通过比较大小就可以“淘汰”“一半”元素的方法和二分查找算法非常相似</p><h3 id="维持相对顺序"><a href="#维持相对顺序" class="headerlink" title="维持相对顺序"></a>维持相对顺序</h3><p>二叉查找树还有一个名字叫<strong>二叉排序树</strong><br>相当于是创建一个二叉查找树,为了形成二叉查找树,就必须要求新插入的节点遵循二叉查找树的原则</p><h2 id="二叉树的遍历"><a href="#二叉树的遍历" class="headerlink" title="二叉树的遍历"></a>二叉树的遍历</h2><p>从节点之间位置关系的角度来看,二叉树的遍历分为4种:</p><ol><li>前序遍历</li><li>中序遍历</li><li>后序遍历</li><li>层序遍历</li></ol><p>从更宏观的角度来看,二叉树的遍历归结为两大类</p><ol><li>深度优先遍历(前序遍历,中序遍历,后序遍历，层序遍历)</li><li>广度优先遍历(层序遍历)</li></ol><h1 id="二叉树的遍历-1"><a href="#二叉树的遍历-1" class="headerlink" title="二叉树的遍历"></a>二叉树的遍历</h1><p>二叉树的遍历一定是先左后右的，所谓的前序，中序，后序遍历其实的是根节点的前中后位置</p><h2 id="前序遍历"><a href="#前序遍历" class="headerlink" title="前序遍历"></a>前序遍历</h2><blockquote><p>他的访问顺序是：根节点→左子树→右子树</p><p>所以上图前序遍历的结果是：A→B→D→E→C→F</p><p>访问顺序如下</p></blockquote><p>数据访问顺序：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220726213242529.png" alt="image-20220726213242529" style="zoom:67%;" /></p><h3 id="递归方式"><a href="#递归方式" class="headerlink" title="递归方式"></a>递归方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        preOrder(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        list.add(root.val);</span><br><span class="line">        preOrder(root.left,list);</span><br><span class="line">        preOrder(root.right,list);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>说明</p><p>题目已经生成好了二叉树，给定的参数是树的根节点，要求前序遍历二叉树，讲值按前序遍历的顺序存进一个<code>List&lt;Integer&gt;</code>中返回</p></blockquote><h4 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h4><ul><li><p>递归的方式就是一层一层的调用函数，一般都是先考虑走到最里面，也就是考虑什么情况是最里面，也即是边界条件了。</p></li><li><p>考虑到的边界条件就是当二叉树的节点是空的时候表示不能再继续往下走了，这个时候就是最里面了就该返回了</p></li><li><p>这里的返回条件就是，如果数据是不想要的（空节点肯定不要）就返回，也就是说目前这一层返回到的层就是最后一个满足需求想要的数据层了，这个时候就可以开始收集数据了</p></li><li>因为是二叉树的前序遍历，所以是要先第一次遍历到的就是根节点的值，就先接收根节点的值，之后再往下走</li><li>需要先去走左节点再走右节点，因为树的遍历只是和根节点有关，和左右节点关系不大，永远都是先左后右</li></ul><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>对于二叉树的遍历来说，其实大体都一样，就是说取值的位置，前序遍历是先取值再左再右。<a href="#中序遍历">中序遍历</a>就是先左再取值再右。<a href="#后序遍历">后序遍历</a>就是先左再右再取值。</p><h3 id="迭代方式"><a href="#迭代方式" class="headerlink" title="迭代方式"></a>迭代方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> list;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tempNode</span> <span class="operator">=</span>  stack.pop();</span><br><span class="line">            list.add(tempNode.val);</span><br><span class="line">            <span class="keyword">if</span>(tempNode.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(tempNode.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(tempNode.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(tempNode.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>说明</p><p>题目已经生成好了二叉树，给定的参数是树的根节点，要求前序遍历二叉树，讲值按前序遍历的顺序存进一个<code>List&lt;Integer&gt;</code>中返回</p></blockquote><h4 id="解析-1"><a href="#解析-1" class="headerlink" title="解析"></a>解析</h4><ul><li>实际上用和用递归的方式的思想是差不多的，用栈实现了非递归，但是栈本身就是前进后出的数据结构，本身和函数就有很大的相似之处，所以思路也差不多</li><li>但是和递归有不同的是，递归接收空值，而迭代需要提前判断，要避免空值，所以需要提前判断数据是否为空，需要先存进一个数据才能开始函数</li><li>这里要解释一下数据和程序进行浅层的关系<ul><li>对于递归来说，是函数式，如果有数据就可以执行函数，就会一层一层调用，所以对于空值这种数据来说也能继续运行</li><li>对于迭代来说，使用的是栈这种数据类型，并且使用的是当栈中数据不为空才继续执行，所以栈一空循环就结束了，所以要一直保持栈中的数据不为空。</li></ul></li><li>并且在这里，如果将空的值放进来就是垃圾数据，会将空值存入结果列表中，并且之后的判断也是无用判断</li><li>和递归方式不同的注意点：<ul><li>这里还是想要先到左取数据再到右取数据，对于递归来说，就是先调用函数，将左节点传进去。但是对于迭代，就需要先将右节点存入栈中，因为先存入的东西后执行。</li></ul></li></ul><h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>整体思路和递归一致，有一些小细节不同，需要注意。</p><h2 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h2><blockquote><p>他的访问顺序是：左子树→根节点→右子树</p><p>所以上图前序遍历的结果是：D→B→E→A→F→C</p><p>访问顺序如下</p></blockquote><p>数据访问顺序：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220726213100422.png" alt="image-20220726213100422" style="zoom: 67%;" /></p><h3 id="递归方式-1"><a href="#递归方式-1" class="headerlink" title="递归方式"></a>递归方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        inOrder(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        inOrder(root.left,list);</span><br><span class="line">        list.add(root.val);</span><br><span class="line">        inOrder(root.right,list);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>说明</p><p>题目已经生成好了二叉树，给定的参数是树的根节点，要求中序遍历二叉树，讲值按前序遍历的顺序存进一个<code>List&lt;Integer&gt;</code>中返回</p></blockquote><p>具体解析和总结看<a href="#前序遍历">前序遍历</a>就OK，大致思路是一样的。</p><h3 id="迭代方式-1"><a href="#迭代方式-1" class="headerlink" title="迭代方式"></a>迭代方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> list;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(root != <span class="literal">null</span> || !stack.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span>(root != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(root);</span><br><span class="line">                root = root.left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!stack.isEmpty())&#123;</span><br><span class="line">                root = stack.pop();</span><br><span class="line">                list.add(root.val);</span><br><span class="line">                root = root.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整体思路和递归一致，就是想要疯狂向左走，直到左边为空了，然后再存储，实际上存储到的就是左节点了。</p><h2 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h2><blockquote><p>他的访问顺序是：左子树→右子树→根节点</p><p>所以上图前序遍历的结果是：D→E→B→F→C→A</p><p>访问顺序如下</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20220726214240876.png" alt=""></p><h3 id="递归方式-2"><a href="#递归方式-2" class="headerlink" title="递归方式"></a>递归方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        postOrder(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        postOrder(root.left,list);</span><br><span class="line">        postOrder(root.right,list);</span><br><span class="line">        list.add(root.val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>说明</p><p>题目已经生成好了二叉树，给定的参数是树的根节点，要求后序遍历二叉树，讲值按前序遍历的顺序存进一个<code>List&lt;Integer&gt;</code>中返回</p></blockquote><p>具体解析和总结看<a href="#前序遍历">前序遍历</a>就OK，大致思路是一样的。</p><h3 id="迭代方式-2"><a href="#迭代方式-2" class="headerlink" title="迭代方式"></a>迭代方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> list;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">tempNode</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            list.add(tempNode.val);</span><br><span class="line">            <span class="keyword">if</span>(tempNode.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(tempNode.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(tempNode.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(tempNode.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.reverse(list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后序遍历的递归需要先“假前序”然后再倒序一下。</p><p>前序是先让根节点入栈，再让右节点入栈，左节点最后入栈。而数据形式是：根节点-左节点-右节点。</p><p>分析得：想要的数据形式是：左节点-右节点-根节点。</p><p>如果和前序遍历的迭代方法类似代码，但是入栈顺序为：根节点-左节点-右节点。这样的数据形式就是：根节点-右节点-左节点。如果倒序一下数据形式就是：左节点-右节点-根节点了。</p><p>根据这样的规律写出了程序——先“假倒序”再倒叙。</p><h2 id="层序遍历"><a href="#层序遍历" class="headerlink" title="层序遍历"></a>层序遍历</h2><h3 id="深度优先搜索"><a href="#深度优先搜索" class="headerlink" title="深度优先搜索"></a>深度优先搜索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        dfs(list,root,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; list,TreeNode root,<span class="type">int</span> level)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(list.size() &lt;= level)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        list.get(level).add(root.val);</span><br><span class="line">        dfs(list,root.left,level+<span class="number">1</span>);</span><br><span class="line">        dfs(list,root.right,level+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>深度优先搜索就是使用递归的一种方式，在参数中做出改变。</p><p>这里就是访问左右节点，访问了左右节点，那么左右节点肯定是下一层，所以参数中<code>level+1</code>，表示层数增加</p><p>list表示的是最外层，内部的元素就是一个子list，通过<code>get(level)</code>指定对应层数的子list,就可将元素添加岛对应层。如果level已经大于等于list的size了就需要新建一层子list。</p><h3 id="广度优先搜索"><a href="#广度优先搜索" class="headerlink" title="广度优先搜索"></a>广度优先搜索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> list;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            List&lt;Integer&gt; tempList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; size ; i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                tempList.add(node.val);</span><br><span class="line">                <span class="keyword">if</span>(node.left != <span class="literal">null</span>) queue.add(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right != <span class="literal">null</span>) queue.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(tempList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>记得使用BFS需要使用队列这种数据结构就好了，每一次添加到临时列表中前先判断队列中有几个元素（每一批队列中的的数据都是同一层的）</p><h2 id="Morris遍历"><a href="#Morris遍历" class="headerlink" title="Morris遍历"></a>Morris遍历</h2><blockquote><p>前面讲的二叉树的几种遍历方式，如果使用的是非递归方式，我们要么需要一个栈，要么需要一个队列来维护节点之间的关系。如果使用Morris遍历就不需要了，他的实现过程其实就是把叶子节点的指针给利用起来，因为一般情况下，二叉树的叶子节点是没有子节点的，也就是说他们是指向空，这样总感觉有点浪费，Morris的实现原理其实就是把叶子节点的指针给利用了起来。</p><p>对于Morris的中序遍历可以把它看做是把二叉树拉直变成了链表。</p></blockquote><h3 id="前序遍历和中序遍历"><a href="#前序遍历和中序遍历" class="headerlink" title="前序遍历和中序遍历"></a>前序遍历和中序遍历</h3><p>前序遍历和中序遍历逻辑是一样的，这里以中序遍历为例。中序遍历的数据冯雯顺序是：左子树-根节点-右子树。</p><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ol><li><p>判断cur是否为空，如果为空就停止遍历。</p></li><li><p>如果cur不为空</p><ul><li>如果cur没有左子节点，打印cur的值，然后让root指向他的右子节点，即<code>cur=cur.right</code></li><li>如果cur有左子节点，则从左子节点中<strong>找到最右边</strong>的节点pre（用循环的方式）。<ul><li>如果pre的右节点不为空，且不等于cur即<code>while(pre.right != null &amp;&amp; pre.light != cur)</code>，就让pre指向pre的右节点，即<code>pre = pre.right</code>。这样的最右实际上不一定是为空才是最右边，下一个节点是cur也被认为是最右边，所以要具体再判断是那种情况。</li></ul></li><li>如果pre的右子节点为空，就让pre的右子节点指向cur，即<code>pre.right=cur</code>，然后cur指向他的左子节点，即<code>cur=cur.left</code>。</li><li>如果pre的右子节点不为空，就让他指向空，即<code>pre.right=null</code>，然后输出cur节点的值，并将节点cur指向其右子节点，即<code>cur=cur.right</code>。</li></ul></li><li><p>重复步骤2，直到节点cur为空为止。</p></li></ol><h4 id="中序遍历代码"><a href="#中序遍历代码" class="headerlink" title="中序遍历代码"></a>中序遍历代码</h4><p>光看上面的实现步骤还有点抽象，看看代码再分析是怎么样的过程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//首先把根节点赋值给cur</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="comment">//如果cur不为空就继续遍历</span></span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//如果当前节点cur的左子节点为空，就访问当前节点cur，</span></span><br><span class="line">                <span class="comment">//接着让当前节点cur指向他的右子节点</span></span><br><span class="line">                list.add(cur.val);</span><br><span class="line">                cur = cur.right;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">pre</span> <span class="operator">=</span> cur.left;</span><br><span class="line">                <span class="comment">//查找pre节点，注意这里有个判断就是pre的右子节点不能等于cur</span></span><br><span class="line">                <span class="keyword">while</span> (pre.right != <span class="literal">null</span> &amp;&amp; pre.right != cur)</span><br><span class="line">                    pre = pre.right;</span><br><span class="line">                <span class="comment">//如果pre节点的右指针指向空，我们就让他指向当前节点cur，</span></span><br><span class="line">                <span class="comment">//然后当前节点cur指向他的左子节点</span></span><br><span class="line">                <span class="keyword">if</span> (pre.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                    pre.right = cur;</span><br><span class="line">                    cur = cur.left;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//如果pre节点的右指针不为空，那么他肯定是指向cur的,</span></span><br><span class="line">                    <span class="comment">//表示cur的左子节点都遍历完了，我们需要让pre的右</span></span><br><span class="line">                    <span class="comment">//指针指向null，目的是把树给还原，然后再访问当前节点</span></span><br><span class="line">                    <span class="comment">//cur，最后再让当前节点cur指向他的右子节点。</span></span><br><span class="line">                    pre.right = <span class="literal">null</span>;</span><br><span class="line">                    list.add(cur.val);</span><br><span class="line">                    cur = cur.right;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="演示图"><a href="#演示图" class="headerlink" title="演示图"></a>演示图</h4><p>看了代码还不直观就看图理解吧</p><h5 id="动态图："><a href="#动态图：" class="headerlink" title="动态图："></a>动态图：</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/c1b589b5fc7facd1a847c9f5bab407765222ee2d9e1a887a9e5d61cc9e94dfc6-3.gif"></p><h5 id="连续图："><a href="#连续图：" class="headerlink" title="连续图："></a>连续图：</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/640.png" alt="img" style="zoom: 67%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/640-16588889233325.png" alt="img" style="zoom:67%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/640-16588889352188.png" alt="img" style="zoom:67%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/640-165888894664411-165888894918814.png" alt="img" style="zoom:67%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/640-165888896646616.png" alt="img" style="zoom:67%;" /></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/640-165888898108519.png" alt="img" style="zoom:67%;" /></p><h4 id="前序遍历代码"><a href="#前序遍历代码" class="headerlink" title="前序遍历代码"></a>前序遍历代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//首先把根节点赋值给cur</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="comment">//如果cur不为空就继续遍历</span></span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//如果当前节点cur的左子节点为空，就访问当前节点cur，</span></span><br><span class="line">                <span class="comment">//接着让当前节点cur指向他的右子节点</span></span><br><span class="line">                res.add(cur.val);</span><br><span class="line">                cur = cur.right;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">pre</span> <span class="operator">=</span> cur.left;</span><br><span class="line">                <span class="comment">//查找pre节点，注意这里有个判断就是pre的右子节点不能等于cur</span></span><br><span class="line">                <span class="keyword">while</span> (pre.right != <span class="literal">null</span> &amp;&amp; pre.right != cur)</span><br><span class="line">                    pre = pre.right;</span><br><span class="line">                <span class="comment">//如果pre节点的右指针指向空，我们就让他指向当前节点cur，</span></span><br><span class="line">                <span class="comment">//然后打印当前节点cur的值，最后再让当前节点cur指向他的左子节点</span></span><br><span class="line">                <span class="keyword">if</span> (pre.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                    pre.right = cur;</span><br><span class="line">                    res.add(cur.val);</span><br><span class="line">                    cur = cur.left;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//如果pre节点的右指针不为空，那么他肯定是指向cur的,</span></span><br><span class="line">                    <span class="comment">//表示当前节点cur和他的的左子节点都遍历完了，直接</span></span><br><span class="line">                    <span class="comment">//让他指向他的右子节点即可。</span></span><br><span class="line">                    pre.right = <span class="literal">null</span>;</span><br><span class="line">                    cur = cur.right;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>前序遍历和中序遍历很类似，只是添加节点（访问数据）的时机不同而已。</p><p>前序遍历是：如果左边没有被遍历，那么在移动cur前就访问cur。</p><p>中序遍历是：如果左边已经被遍历了，或者无法遍历了（已经是最左边的叶子节点了），才访问cur</p></blockquote><h3 id="后序遍历-1"><a href="#后序遍历-1" class="headerlink" title="后序遍历"></a>后序遍历</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">p1</span> <span class="operator">=</span> root, p2 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (p1 != <span class="literal">null</span>) &#123;</span><br><span class="line">            p2 = p1.left;</span><br><span class="line">            <span class="keyword">if</span> (p2 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (p2.right != <span class="literal">null</span> &amp;&amp; p2.right != p1) &#123;</span><br><span class="line">                    p2 = p2.right;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (p2.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p2.right = p1;</span><br><span class="line">                    p1 = p1.left;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    p2.right = <span class="literal">null</span>;</span><br><span class="line">                    addPath(res, p1.left);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            p1 = p1.right;</span><br><span class="line">        &#125;</span><br><span class="line">        addPath(res, root);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPath</span><span class="params">(List&lt;Integer&gt; res, TreeNode node)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            ++count;</span><br><span class="line">            res.add(node.val);</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> res.size() - count, right = res.size() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> res.get(left);</span><br><span class="line">            res.set(left, res.get(right));</span><br><span class="line">            res.set(right, temp);</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h4><p>其实Morris算法就是要利用大量的叶子节点形成链表形式的数，所以大致思路和前面也差不多，但是实现步骤有一点点不同。</p><ol><li><p>新建临时节点，令该节点为 root；</p></li><li><p>如果当前节点的左子节点为空，则遍历当前节点的右子节点；</p></li><li><p>如果当前节点的左子节点不为空，在当前节点的左子树中找到当前节点在中序遍历下的前驱节点；</p><ul><li>如果前驱节点的右子节点为空，将前驱节点的右子节点设置为当前节点，当前节点更新为当前节点的左子节点。</li><li>如果前驱节点的右子节点为当前节点，将它的右子节点重新设为空。倒序输出从当前节点的左子节点到该前驱节点这条路径上的所有节点。当前节点更新为当前节点的右子节点。</li></ul></li><li><p>重复步骤 2 和步骤 3，直到遍历结束。</p></li></ol><h2 id="遍历结果的数据特点"><a href="#遍历结果的数据特点" class="headerlink" title="遍历结果的数据特点"></a>遍历结果的数据特点</h2><h3 id="前序遍历-1"><a href="#前序遍历-1" class="headerlink" title="前序遍历"></a>前序遍历</h3><p>前序遍历的第一个元素是根节点</p><h3 id="中序遍历-1"><a href="#中序遍历-1" class="headerlink" title="中序遍历"></a>中序遍历</h3><p>根节点分左右子树</p><h3 id="后续遍历"><a href="#后续遍历" class="headerlink" title="后续遍历"></a>后续遍历</h3><p>根节点是最后一个元素</p><h3 id="作用与应用"><a href="#作用与应用" class="headerlink" title="作用与应用"></a>作用与应用</h3><p>由于中序遍历的分左右的特殊性，只要能找出中序遍历的结果中的根节点就能区分处左右子树了，而对于前序遍历的结果和后序遍历的结果都很好得到根节点，所以可以利用前序遍历的结果和中序遍历的结果重新构建出原本的二叉树，也可以利用后序遍历的结果和中序遍历的结果构造出原本的二叉树。</p><h4 id="从中序与后序遍历序列构造二叉树"><a href="#从中序与后序遍历序列构造二叉树" class="headerlink" title="从中序与后序遍历序列构造二叉树"></a>从中序与后序遍历序列构造二叉树</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span>[] postorder)</span> &#123;</span><br><span class="line">        <span class="type">int</span> len=inorder.length;</span><br><span class="line">        <span class="keyword">if</span>(len==<span class="number">0</span>)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> dfs(inorder,postorder,<span class="number">0</span>,len-<span class="number">1</span>,<span class="number">0</span>,len-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TreeNode <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[] inorder, <span class="type">int</span>[] postorder,<span class="type">int</span> head1,<span class="type">int</span> tail1, <span class="type">int</span> head2,<span class="type">int</span> tail2)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head2&gt;tail2)<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> val=postorder[tail2];</span><br><span class="line">        TreeNode root=<span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">        <span class="keyword">if</span>(head2==tail2)<span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> mid=<span class="number">0</span>;  <span class="comment">//拆分点mid的位置是相对的，因为h1!=h2</span></span><br><span class="line">        <span class="keyword">while</span>(inorder[head1+mid]!=val)mid++;</span><br><span class="line"></span><br><span class="line">        root.left=dfs(inorder, postorder, head1, head1+mid-<span class="number">1</span>, head2, head2+mid-<span class="number">1</span>);</span><br><span class="line">        root.right=dfs(inorder, postorder, head1+mid+<span class="number">1</span>, tail1, head2+mid, tail2-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="从前序与中序遍历序列构造二叉树"><a href="#从前序与中序遍历序列构造二叉树" class="headerlink" title="从前序与中序遍历序列构造二叉树"></a>从前序与中序遍历序列构造二叉树</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">    <span class="comment">//把前序遍历的值和中序遍历的值放到list中</span></span><br><span class="line">    List&lt;Integer&gt; preorderList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; inorderList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; preorder.length; i++) &#123;</span><br><span class="line">        preorderList.add(preorder[i]);</span><br><span class="line">        inorderList.add(inorder[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> helper(preorderList, inorderList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> TreeNode <span class="title function_">helper</span><span class="params">(List&lt;Integer&gt; preorderList, List&lt;Integer&gt; inorderList)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (inorderList.size() == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//前序遍历的第一个值就是根节点</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">rootVal</span> <span class="operator">=</span> preorderList.remove(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//创建跟结点</span></span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(rootVal);</span><br><span class="line">    <span class="comment">//查看根节点在中序遍历中的位置，然后再把中序遍历的数组劈两半，前面部分是</span></span><br><span class="line">    <span class="comment">//根节点左子树的所有值，后面部分是根节点右子树的所有值</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> inorderList.indexOf(rootVal);</span><br><span class="line">    <span class="comment">//[0，mid)是左子树的所有值，inorderList.subList(0, mid)表示截取inorderList</span></span><br><span class="line">    <span class="comment">//的值，截取的范围是[0，mid)，包含0不包含mid。</span></span><br><span class="line">    root.left = helper(preorderList, inorderList.subList(<span class="number">0</span>, mid));</span><br><span class="line">    <span class="comment">//[mid+1，inorderList.size())是右子树的所有值，</span></span><br><span class="line">    <span class="comment">// inorderList.subList(mid + 1, inorderList.size())表示截取inorderList</span></span><br><span class="line">    <span class="comment">//的值，截取的范围是[mid+1，inorderList.size())，包含mid+1不包含inorderList.size()。</span></span><br><span class="line">    root.right = helper(preorderList, inorderList.subList(mid + <span class="number">1</span>, inorderList.size()));</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="构建二叉树"><a href="#构建二叉树" class="headerlink" title="构建二叉树"></a>构建二叉树</h1><h2 id="由数组构成二叉树"><a href="#由数组构成二叉树" class="headerlink" title="由数组构成二叉树"></a>由数组构成二叉树</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testHashMap</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line">        Integer[] elements = &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="literal">null</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="literal">null</span>,<span class="number">9</span>&#125;;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        createTree(cur,elements);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createTree</span><span class="params">(TreeNode root,Integer[] elements)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &gt;= elements.length)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(elements[index] != <span class="literal">null</span>)&#123;</span><br><span class="line">            root.val = elements[index++];</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line">            root.left = node;</span><br><span class="line">            createTree(node,elements);</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>();</span><br><span class="line">            root.right = node2;</span><br><span class="line">            createTree(node2,elements);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">    TreeNode() &#123;&#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val) &#123; <span class="built_in">this</span>.val = val; &#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 树论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> Java </tag>
            
            <tag> 树论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>132模式</title>
      <link href="/posts/71180092.html"/>
      <url>/posts/71180092.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><a href="https://leetcode.cn/problems/132-pattern/description/">力扣原题链接</a></p><p>给你一个整数数组 <code>nums</code> ，数组中共有 <code>n</code> 个整数。<strong>132 模式的子序列</strong> 由三个整数 <code>nums[i]</code>、<code>nums[j]</code> 和 <code>nums[k]</code> 组成，并同时满足：<code>i &lt; j &lt; k</code> 和 <code>nums[i] &lt; nums[k] &lt; nums[j]</code> 。</p><p>如果 <code>nums</code> 中存在 <strong>132 模式的子序列</strong> ，返回 <code>true</code> ；否则，返回 <code>false</code> 。</p><p><strong>示例 1：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [1,2,3,4]</span><br><span class="line">输出：false</span><br><span class="line">解释：序列中不存在 132 模式的子序列。</span><br></pre></td></tr></table></figure><p><strong>示例 2：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [3,1,4,2]</span><br><span class="line">输出：true</span><br><span class="line">解释：序列中有 1 个 132 模式的子序列： [1, 4, 2] 。</span><br></pre></td></tr></table></figure><p><strong>示例 3：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [-1,3,2,0]</span><br><span class="line">输出：true</span><br><span class="line">解释：序列中有 3 个 132 模式的的子序列：[-1, 3, 2]、[-1, 3, 0] 和 [-1, 2, 0] 。</span><br></pre></td></tr></table></figure><p><strong>提示：</strong></p><ul><li><code>n == nums.length</code></li><li><code>1 &lt;= n &lt;= 2 * 10^5</code></li><li><code>-10^9 &lt;= nums[i] &lt;= 10^9</code></li></ul><p>进阶：请使用时间复杂度为$O(n)$的方法。</p><h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><p>朴素的做法是分别对三个数进行枚举，这样的做法是 $O(n^3)$的，数据范围是$10^4$ ，稳稳超时。</p><p>事实上，这样的数据范围甚至不足以我们枚举其中两个数，然后优化找第三个数的$O(n^2)$做法。</p><p>这时候根据数据范围会联想到树状数组，使用树状数组的复杂度是$O(nlog_2n)$的，可以过。但是代码量会较多一点，还需要理解离散化等前置知识。</p><p>因此，我们可以从 132 的大小特性去分析，如果在确定一个数之后，如何快速找到另外两个数（我们使用 <code>ijk</code> 来代指 132 结构）：</p><ul><li><p>枚举 <code>i</code>：由于 <code>i</code> 是 132 结构中最小的数，那么相当于我们要从 <code>i</code> 后面，找到一个对数 <code>(j,k)</code>，使得 <code>(j,k)</code> 都满足比 <code>i</code> 大，同时 <code>j</code> 和 <code>k</code> 之间存在 <code>j &gt; k</code> 的关系。由于我们的遍历是单向的，因此我们可以将问题转化为找 <code>k</code>，首先 <code>k</code> 需要比 <code>i</code> 大，同时在 <code>[i, k]</code> 之间存在比 <code>k</code> 大的数即可。</p></li><li><p>枚举 <code>j</code>：由于 <code>j</code> 是 132 结构里最大的数，因此我们需要在 <code>j</code> 的右边中比 <code>j</code> 小的「最大」的数，在 j 的左边找比 j 小的「最小」的数。这很容易联想到单调栈，但是朴素的单调栈是帮助我们找到左边或者右边「最近」的数，无法直接满足我们「最大」和「最小」的要求，需要引入额外逻辑。</p></li><li><p>枚举 <code>k</code>：由于 <code>k</code> 是 132 结构中的中间值，这里的分析逻辑和「枚举 <code>i</code>」类似，因为遍历是单向的，我们需要找到 <code>k</code> 左边的 <code>i</code>，同时确保 <code>[i,k]</code> 之间存在比 <code>i</code> 和 <code>k</code> 大的数字。</p></li></ul><p>以上三种分析方法都是可行的，但「枚举 <code>i</code>」的做法是最简单的。</p><p>因为如果存在 <code>(j,k)</code> 满足要求的话，我们只需要找到一个最大的满足条件的 <code>k</code>，通过与 <code>i</code> 的比较即可。</p><p>举例：</p><p>对于样例数据 [3, 1, 4, 2]，我们知道满足 132 结构的子序列是 [1, 4, 2]，其处理逻辑是（遍历从后往前）：</p><ul><li>枚举到 2：栈内元素为 [2]，<code>k</code> = INF</li><li>枚举到 4：不满足「单调递减」，2 出栈更新 <code>k</code>，4 入栈。栈内元素为 [4]，<code>k</code> = 2</li><li>枚举到 1：满足 <code>nums[i] &lt; k</code>，说明对于 <code>i</code> 而言，后面有一个比其大的元素（满足 <code>i &lt; k</code> 的条件），同时这个 <code>k</code> 的来源又是因为维护「单调递减」而弹出导致被更新的（满足 <code>i</code> 和 <code>k</code> 之间，有比 <code>k</code> 要大的元素）。因此我们找到了满足 132 结构的组合。</li></ul><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="tabs" id="solution"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#solution-1">C++</button></li><li class="tab"><button type="button" data-href="#solution-2">Java</button></li><li class="tab"><button type="button" data-href="#solution-3">Python3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="solution-1"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">find132pattern</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; st;</span><br><span class="line">        <span class="type">int</span> k = INT_MIN, sz = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = sz - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt; k) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">while</span> (!st.<span class="built_in">empty</span>() &amp;&amp; nums[i] &gt; st.<span class="built_in">top</span>()) &#123;</span><br><span class="line">                k = st.<span class="built_in">top</span>(); st.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            st.<span class="built_in">push</span>(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="solution-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">find132pattern</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        Deque&lt;Integer&gt; d = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt; k) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">while</span> (!d.isEmpty() &amp;&amp; nums[i] &gt; d.peekLast()) &#123;</span><br><span class="line">                k = d.pollLast();</span><br><span class="line">            &#125;</span><br><span class="line">            d.addLast(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="solution-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find132pattern</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        stack = []</span><br><span class="line">        k = -(<span class="number">10</span> ** <span class="number">9</span> + <span class="number">7</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i] &lt; k:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">while</span> stack <span class="keyword">and</span> nums[i] &lt; stack[-<span class="number">1</span>]:</span><br><span class="line">                k = stack.pop()</span><br><span class="line">            stack.append(nums[i])</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 栈和队列 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> Java </tag>
            
            <tag> Python </tag>
            
            <tag> 栈和队列 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>离散化区间和</title>
      <link href="/posts/3005926051.html"/>
      <url>/posts/3005926051.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>假定有一个无限长的数轴，数轴上每个坐标上的数都是0。</p><p>现在，我们首先进行 n 次操作，每次操作将某一位置 x 上的数加 c。</p><p>近下来，进行 m 次询问，每个询问包含两个整数 l 和 r ，你需要求出在区间 [l, r] 之间的所有数的和。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行包含两个整数n和m。</p><p>接下来 n 行，每行包含两个整数x和c。</p><p>再接下里 m 行，每行包含两个整数l和r。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>共m行，每行输出一个询问中所求的区间内数字和。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>−10^9 ≤x≤ 10^9,<br>1 ≤n,m≤ 10^5,<br>−10^9 ≤ l ≤ r ≤ 10^9,<br>−10000 ≤ c ≤ 10000</p><h4 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2</span><br><span class="line">3 6</span><br><span class="line">7 5</span><br><span class="line">1 3</span><br><span class="line">4 6</span><br><span class="line">7 8</span><br></pre></td></tr></table></figure><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">0</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><p>这道题看起来就感觉好像是赤裸裸的前缀和与差分。但是仔细看会发现，执行的操作不是对区间执行的，也就是说和差分没有关系，就是简单的前缀和。<strong>但是</strong> 看 x 的取值范围，到了10^9^了，一般数组可是存不下的，会报错。所以这里就要介绍离散化的思想了。</p><h2 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h2><p>这道题操作的次数为 n 次，查询次数为 m 次，也就是说实际上被操作的数字，或者说我们需要讨论的数字，最多不超过 n+2<em>m个。这个数组相当于是  3 </em>10^5，相比于x的10^9小得多。所以我们现在就是需要进行离散化操作。</p><p>其实实现离散化也很简单，直接先输入时就存x，之后再去除重复的，剩下的数字就是待操作的。之后再遍历一次操作数组，执行操作，最后求前缀和的时候也只是求这个去重数组就行了。查询就是查询前缀和数组。</p><p>这相当于是一种映射。举个例子：我们只用：-10000，0，10000， 20000 。四个数字，但是分散得很开，直接存很浪费空间（开-10000～20000个位置来存），我们离散化之后就变成了4个位置。</p><p>离散化的方式有两种：</p><ol><li><p>一种就是和哈希差不多的方式：先排序，然后指定映射下标。</p><p> 例如上面的数组，排序后就变成了[0,1,2,3]（因为我给出来的时候就是排好序了的）</p><p> 这种处理的伪代码：</p><p> 假设是对A数组离散化，C为待排序数组，L为最终映射结果。</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> C[MaxN], L[MaxN];</span><br><span class="line">... <span class="comment">// 函数中</span></span><br><span class="line">    <span class="built_in">memcpy</span>(C, A, <span class="built_in">sizeof</span>(A));  <span class="comment">// 复制 A 数组</span></span><br><span class="line">    <span class="built_in">sort</span>(C, C + n); <span class="comment">// 排序</span></span><br><span class="line">    <span class="type">int</span> l = <span class="built_in">unique</span>(C, C + n) - C; <span class="comment">// 去重</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        L[i] = <span class="built_in">lower_bond</span>(C, C+l, A[i]) - C + <span class="number">1</span>; <span class="comment">//查找</span></span><br></pre></td></tr></table></figure></li><li><p>直接去重。（相同元素没必要存两遍）</p><p> 像上面的例子，结果就应该为[-10000,0,10000,20000]</p><p> 这种处理的伪代码（因为要用到STL函数，所以最好用vector，而不是普通数组）：</p><p> 对A数组离散化。</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>()); <span class="comment">// n 为A的长度</span></span><br><span class="line">A.<span class="built_in">erase</span>(<span class="built_in">unique</span>(A,<span class="built_in">begin</span>(), A.<span class="built_in">end</span>()), A.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure></li></ol><h2 id="相关函数解释"><a href="#相关函数解释" class="headerlink" title="相关函数解释"></a>相关函数解释</h2><p>后续为可能会发文章专门讲常用的STL函数，这里主要讲<code>unique()</code>和<code>erase()</code></p><h3 id="unique"><a href="#unique" class="headerlink" title="unique()"></a>unique()</h3><p>它的功能是元素去重。即”删除”序列中所有相邻的重复元素(只保留一个)。<strong>此处的删除，并不是真的删除</strong>，而是指重复元素的位置被不重复的元素给占领了。<strong>由于它”删除”的是相邻的重复元素，所以在使用unique函数之前，一般都会将目标序列进行排序</strong>。</p><p>unique函数的去重过程实际上就是<strong>不停的把后面不重复的元素移到前面来，也可以说是用不重复的元素占领重复元素的位置</strong>。</p><p>函数原型：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">iterator <span class="title">unique</span><span class="params">(iterator it_1,iterator it_2)</span></span>;</span><br></pre></td></tr></table></figure><p>参数和返回值都是<code>iterator</code>迭代器，可以理解为位置。参数就是带去重的初始位置和结束位置。返回值就是去重后，最后一个不重复元素的位置。</p><p>举例：</p><p>初始数组：[1，2，3，3，3，4，5，5，6，7，7，8] 注意，使用前一定要先排序好。</p><p>去重后数组：[1，2，3，4，5，6，7，8，3，3，5，7]</p><p>最终返回的就是 数字8的位置。</p><h3 id="erase"><a href="#erase" class="headerlink" title="erase()"></a>erase()</h3><p>这个函数就是一个删除函数，有一点类似于<code>remove()</code></p><p>它有三种函数原型：</p><ol><li><p>处理字符串</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string&amp; <span class="title">erase</span><span class="params">(<span class="type">size_t</span> pos = <span class="number">0</span>, <span class="type">size_t</span> n)</span></span>;</span><br></pre></td></tr></table></figure><p> 例如：<code>str.erase(0,1)</code>删除字符串第一个字符；<code>str.erase(0,3)</code>删除字符串前三个字符。</p></li><li><p>处理任意集合</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">iterator <span class="title">erase</span><span class="params">(iterator pos)</span></span>;</span><br></pre></td></tr></table></figure><p> 删除pos位置的元素。注意，但传入参数为字符串的时候，它的参数是find(str)。也就是说先查找字符串在远串中的位置，然后再删除。</p><p> 例如：<code>str.erase(&quot;c&quot;)</code>就是把原字符串中的字母c全删除掉；<code>str.erase(str.first()+2)</code>就是把把第三个元素删除掉。</p><p> 注意不能直接写数字。</p></li><li><p>区间处理任意集合</p> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">iterator <span class="title">erase</span><span class="params">(iterator it_1, iterator it_2)</span></span>;</span><br></pre></td></tr></table></figure><p> 这个很好理解，就是将<code>it_1</code>到<code>it_2</code>之间的元素删除掉。</p></li></ol><p>上述的离散化中就是利用的第3个函数原型，将重复内容删除掉的。</p><h2 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII; <span class="comment">// 处理区间问题一般都要用pair</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">3</span>*<span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n, m, x, c, mid;</span><br><span class="line"><span class="type">int</span> a[N], s[N]; <span class="comment">// a数组存放x位置的值，s是前缀和数组</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; all; <span class="comment">// 离散化后数组，存放的是需要操作或者查询的x的位置</span></span><br><span class="line">vector&lt;PII&gt; add, query; <span class="comment">// add存放操作的一对，query存放查询的一对</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">binary_search</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    x = <span class="number">0</span>; c = n; <span class="comment">// [ )</span></span><br><span class="line">    <span class="keyword">while</span> (x &lt; c) &#123;</span><br><span class="line">        mid = x + ((c - x) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (all[mid] == num) <span class="keyword">return</span> mid;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (all[mid] &gt; num) c = mid;</span><br><span class="line">        <span class="keyword">else</span> x = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// 没有找到,返回-1(不可能找不到)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; c;</span><br><span class="line">        add.<span class="built_in">push_back</span>(&#123;x, c&#125;);</span><br><span class="line">        all.<span class="built_in">push_back</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; c; <span class="comment">// 节约变量，其实该是 l 和 r，左右区间</span></span><br><span class="line">        query.<span class="built_in">push_back</span>(&#123;x, c&#125;);</span><br><span class="line">        all.<span class="built_in">push_back</span>(x);</span><br><span class="line">        all.<span class="built_in">push_back</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 离散化去重</span></span><br><span class="line">    <span class="built_in">sort</span>(all.<span class="built_in">begin</span>(), all.<span class="built_in">end</span>()); <span class="comment">// 排序</span></span><br><span class="line">    all.<span class="built_in">erase</span>(<span class="built_in">unique</span>(all.<span class="built_in">begin</span>(), all.<span class="built_in">end</span>()), all.<span class="built_in">end</span>()); <span class="comment">// 去重</span></span><br><span class="line">    n = all.<span class="built_in">size</span>(); <span class="comment">//后面不用n了,节约变量</span></span><br><span class="line">    <span class="comment">// 处理操作</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> item: add) &#123; <span class="comment">// 遍历处理 add</span></span><br><span class="line">        <span class="comment">// 注意这里不能随便直接对item.first插入，因为元素位置改变了，需要去查找离散化后的位置。</span></span><br><span class="line">        <span class="comment">// 离散化后数组是排好序的，所以可以用二分查找来加快查找的速度</span></span><br><span class="line">        x = <span class="built_in">binary_search</span>(item.first);</span><br><span class="line">        a[x] += item.second;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 处理前缀和</span></span><br><span class="line">    <span class="comment">// for (int i = 1; i &lt;= n; ++i) s[i+1] = s[i] + a[i+1]; // 大家的前缀和都是从下标 1 开始的，我还是习惯 0 开始</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) </span><br><span class="line">        <span class="keyword">if</span> (i) s[i] = s[i<span class="number">-1</span>] + a[i];</span><br><span class="line">        <span class="keyword">else</span> s[i] = a[i];</span><br><span class="line">    <span class="comment">// 处理询问</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> item: query) &#123;</span><br><span class="line">        x = <span class="built_in">binary_search</span>(item.first);</span><br><span class="line">        c = <span class="built_in">binary_search</span>(item.second);</span><br><span class="line">        cout &lt;&lt; s[c] - s[x<span class="number">-1</span>] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 数组和字符串 </category>
          
          <category> 前缀和与差分 </category>
          
          <category> 二分查找 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 数组和字符串 </tag>
            
            <tag> 二分查找 </tag>
            
            <tag> 前缀和与差分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我在哪里</title>
      <link href="/posts/2281352001.html"/>
      <url>/posts/2281352001.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>农夫约翰出门沿着马路散步，但是他现在发现自己可能迷路了！</p><p>沿路有一排共 N 个农场。</p><p>不幸的是农场并没有编号，这使得约翰难以分辨他在这条路上所处的位置。</p><p>然而，每个农场都沿路设有一个彩色的邮箱，所以约翰希望能够通过查看最近的几个邮箱的颜色来唯一确定他所在的位置。</p><p>每个邮箱的颜色用 A..Z 之间的一个字母来指定，所以沿着道路的 N 个邮箱的序列可以用一个长为 N 的由字母 A..Z 组成的字符串来表示。</p><p>某些邮箱可能会有相同的颜色。</p><p>约翰想要知道最小的 K 的值，使得他查看任意连续 K 个邮箱序列，他都可以唯一确定这一序列在道路上的位置。</p><p>例如，假设沿路的邮箱序列为 <code>ABCDABC</code> 。</p><p>约翰不能令 <code>K=3</code>，因为如果他看到了 <code>ABC</code>，则沿路有两个这一连续颜色序列可能所在的位置。</p><p>最小可行的 <code>K</code> 的值为 <code>K=4</code>，因为如果他查看<strong>任意连续</strong> <code>4</code> 个邮箱，那么可得到的连续颜色序列可以唯一确定他在道路上的位置。</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>输入的第一行包含 N，第二行包含一个由 N 个字符组成的字符串，每个字符均在 A..Z 之内。</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>输出一行，包含一个整数，为可以解决农夫约翰的问题的最小 K 值。</p><h4 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h4><p>1≤N≤100</p><h4 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7</span><br><span class="line">ABCDABC</span><br></pre></td></tr></table></figure><h4 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4</span><br></pre></td></tr></table></figure><h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><h2 id="暴力枚举"><a href="#暴力枚举" class="headerlink" title="暴力枚举"></a>暴力枚举</h2><p>可以看到，这道题的数据范围比较小，可以暴力枚举过关。根据题目意思，翻译过来就是从原字符串任意位置开始的长度为 <code>i</code> 的子字符串，在原字符串中都也找不到同样长度为 <code>i</code> 的子字符串了。</p><p>所以用一个哈希集合存储已经出现过的子字符串。如果对于相同长度的子字符串，已经在哈希集合中存在过了，说明此时的 <code>i</code> 不是正确答案。直接看代码理解吧：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">string str;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; str;</span><br><span class="line">    unordered_set&lt;string&gt; st;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123; <span class="comment">// 子串长度</span></span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">for</span> (j; j + i &lt;= n; ++j) &#123; <span class="comment">// 子串开头位置</span></span><br><span class="line">            string sub = str.<span class="built_in">substr</span>(j, i);</span><br><span class="line">            <span class="keyword">if</span> (st.<span class="built_in">count</span>(sub) != <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            st.<span class="built_in">emplace</span>(sub);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j + i == n + <span class="number">1</span>) &#123; <span class="comment">// 数组正常遍历结束，没有重复的</span></span><br><span class="line">            cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h2><p>二分查找相当于是一种优化，但是其实也没有太优。</p><p>这里的二分查找思路是二分查找最小的子串长度，代码和上面的都是大差不差的。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, l, r, mid;</span><br><span class="line">string str;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; str;</span><br><span class="line">    unordered_set&lt;string&gt; st;</span><br><span class="line">    l = <span class="number">1</span>, r = n; <span class="comment">// [ )</span></span><br><span class="line">    <span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line">        mid = l + (r - l) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> j = <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">for</span> (j; j + mid &lt;= n; ++j) &#123; <span class="comment">// 子串开头位置</span></span><br><span class="line">            string sub = str.<span class="built_in">substr</span>(j, mid);</span><br><span class="line">            <span class="keyword">if</span> (st.<span class="built_in">count</span>(sub) != <span class="number">0</span>) l = mid + <span class="number">1</span>;</span><br><span class="line">            st.<span class="built_in">emplace</span>(sub);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j + mid == n + <span class="number">1</span>) &#123; <span class="comment">// 数组正常遍历结束，没有重复的</span></span><br><span class="line">            r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; mid &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 数组和字符串 </category>
          
          <category> 二分查找 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 数组和字符串 </tag>
            
            <tag> 二分查找 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>改变数组元素</title>
      <link href="/posts/939963535.html"/>
      <url>/posts/939963535.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给定一个空数组 $V$ 和一个整数数组 $a_1,a_2,…,a_n$。</p><p>现在要对数组 $V$ 进行 $n$ 次操作。</p><p>第 $i$ 次操作的具体流程如下：</p><ol><li>从数组 $V$ 尾部插入整数 0。</li><li>将位于数组 $V$ 末尾的 $a_i$ 个元素都变为 1（已经是 1 的不予理会）。</li></ol><p>注意：</p><ul><li>$a_i$ 可能为 0，即不做任何改变。</li><li>$a_i$ 可能大于目前数组 $V$ 所包含的元素个数，此时视为将数组内所有元素变为 1。</li></ul><p>请你输出所有操作完成后的数组 $V$。</p><hr><p>输入格式</p><p>第一行包含整数 T，表示共有 T 组测试数据。</p><p>每组数据第一行包含整数 n。</p><p>第二行包含 n 个整数 a1,a2,…,an。</p><hr><p>输出格式</p><p>每组数据输出一行结果，表示所有操作完成后的数组 V，数组内元素之间用空格隔开。</p><hr><p>数据范围</p><p>1≤T≤20000,<br>1≤n≤2×105,<br>0≤$a_i$≤n,<br>保证一个测试点内所有 n 的和不超过 2×105。</p><hr><p>输入样例：</p><blockquote><p>3<br>6<br>0 3 0 0 1 3<br>10<br>0 0 0 1 0 5 0 0 0 2<br>3<br>0 0 0</p></blockquote><hr><p>输出样例：</p><blockquote><p>1 1 0 1 1 1<br>0 1 1 1 1 1 0 0 1 1<br>0 0 0</p></blockquote><h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><h2 id="区间合并"><a href="#区间合并" class="headerlink" title="区间合并"></a>区间合并</h2><p>这道题本来标签是 <strong>差分</strong> 的，但是观察样例，结合题目思考，可以发现，数据只会变成1，不会变成0。也就是说一个数如果成了1之后就一直是1了。</p><p>那怎么判断会不会成1？</p><p>从题目理解：第<code>i</code>次操作，会改变<code>(i-a[i],i]</code>范围内的数字为1。注意左开右闭区间。那么写代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> T, n, a[i];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i]) &#123;</span><br><span class="line">                <span class="type">int</span> j = <span class="built_in">max</span>(<span class="number">0</span>, i - a[i] + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">for</span> (j; j &lt;= i; ++j) &#123;</span><br><span class="line">                    a[i] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个是最直观的，但是时间复杂度比较高，因为每次遍历到了一个非0的<code>a[i]</code>就要去遍历一次<code>(i-a[i],i]</code>。如果想要不再去遍历一次，就需要在外层循环遍历到<code>i</code>时就知道是否需要将<code>a[i]</code>改为1。然后发现它每一个<code>a[i]</code>都是决定包括自己在内的前面<code>a[i]</code>个数据是否变成1。所以有了思路：干脆从后往前遍历，记录一个左边界，左边界表示<strong>当前</strong>应该变成1的最左边的范围，其实就是<code>i-a[i]</code>。写出代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> T, n, a[i];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) cin &gt;&gt; a[i];</span><br><span class="line">        <span class="type">int</span> l = n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            l = <span class="built_in">min</span>(l, i - a[i]);</span><br><span class="line">            <span class="keyword">if</span> (l &lt; i) a[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有了这个思路，可以改变一下题目</p><blockquote><p>将位于数组 $V$ 末尾的 $a_i$ 个元素都变为 1（已经是 1 的不予理会）。        ==&gt;</p><p>将位于数组 $V$ 末尾的 $a_i$ 个元素都变为 1（已经是 1 的改成 0 ）。</p></blockquote><p>思考一下代码。思考完之后再点开结果。</p><details><summary>点击查看结果</summary><p>    if (l < i) a[i] = 1; <br/>    改成： <br/>    if (l < i) a[i] ^= a[i];</p></details><p>时间复杂度：$O(n)$</p><h2 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2</span>*<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> T, n, a[N], d[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) cin &gt;&gt; a[i];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">memset</span>(d, <span class="number">0</span>, n*<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i-a[i]+<span class="number">1</span> &lt; <span class="number">0</span>) a[i] = i+<span class="number">1</span>;</span><br><span class="line">                ++d[i-a[i]+<span class="number">1</span>];</span><br><span class="line">                --d[i+<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">if</span> (i) d[i] += d[i<span class="number">-1</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (d[i]) cout &lt;&lt; <span class="string">&quot;1 &quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;0 &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这道题的差分的思想和常规的不一样。常规的可能是要记录操作的次数吗，然后直接输出这个值。但是这里实际上是根据被操作的次数，来判断是0还是1.如果被操作的次数不为0，则输出1，为0输出0。</p><p>时间复杂度是$O(n)$和上一种一样（但多了一次计算前缀和的遍历，所以其实时间应该也是比不过的）。但是空间复杂度明显要多一个差分数组<code>d</code>。所以没有上一种方法好。</p><p>同样，改变一下题目：</p><p>用差分怎么解决。</p><p>提示：考虑操作次数。</p><blockquote><p>将位于数组 $V$ 末尾的 $a_i$ 个元素都变为 1（已经是 1 的不予理会）。        ==&gt;</p><p>将位于数组 $V$ 末尾的 $a_i$ 个元素都变为 1（已经是 1 的改成 0 ）。</p></blockquote><hr><p>答案：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (d[i]) cout &lt;&lt; <span class="string">&quot;1 &quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;0 &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (d[i] &amp; <span class="number">1</span>) cout &lt;&lt; <span class="string">&quot;1 &quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;0 &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 数组和字符串 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 数组和字符串 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>区间合并</title>
      <link href="/posts/795397410.html"/>
      <url>/posts/795397410.html</url>
      
        <content type="html"><![CDATA[<h1 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h1><p>区间合并，就是把有交集的两个集合进行合并，合并成更大的区间，即取两个区间的并集。其实会判断是否有交集自己就会了。</p><p><strong>算法步骤：</strong></p><ol><li><p>用<code>pair</code>存左右区间，最好养成习惯左闭右闭，即第 <code>i</code> 个区间：     $[l_i, r_i]$</p></li><li><p>对每个区间进行排序</p><p> <code>sort</code> 对 <code>pair</code> 排序时，优先以左端点排序，再以右端点排序。默认就是</p></li><li><p>假设我们从前往后扫描到了第 <code>i</code> 个区间，那么第 <code>i</code> 个区间和当前维护的区间的关系有三种：</p><p> 假设当前维护区间：$[l, r]$</p><p> 第 <code>i</code> 个区间：$[l_i, r_i]$</p><p> 因为已经排过序了，所以 $l_i &lt; l$</p><ol><li><p>第 <code>i</code> 个区间在当前维护的区间的内部</p><p> 即： $l_i &lt; r \ r_i &lt; r$</p></li><li><p>第 <code>i</code> 个区间和当前维护的区间有交集，但不完全在维护的区间的内部</p><p> 即：$l_i &lt; r \ r_i &gt; r$</p></li><li><p>第 <code>i</code> 个区间和当前维护的区间没有交集</p><p> 即：$l_i &gt; r$</p></li></ol></li></ol><h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定 n 个区间 $[l_i,r_i]$，要求合并所有有交集的区间。</p><p>注意如果在端点处相交，也算有交集。</p><p>输出合并完成后的区间个数。</p><p>例如：[1,3] 和 [2,6] 可以合并为一个区间 [1,6]。</p><hr><p>输入格式<br>第一行包含整数 n。</p><p>接下来 n 行，每行包含两个整数 l 和 r。</p><hr><p>输出格式<br>共一行，包含一个整数，表示合并区间完成后的区间个数。</p><hr><p>数据范围<br>1≤n≤100000,<br>−109≤li≤ri≤109</p><hr><p>输入样例：</p><blockquote><p>5<br>1 2<br>2 4<br>5 6<br>7 8<br>7 9</p></blockquote><hr><p>输出样例：</p><blockquote><p>3</p></blockquote><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100005</span>;</span><br><span class="line"><span class="type">int</span> n, l, r, ans = <span class="number">1</span>;</span><br><span class="line">PII a[N]; <span class="comment">// a 存区间</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; a[i].first &gt;&gt; a[i].second;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(a, a+n);</span><br><span class="line">    l = a[<span class="number">0</span>].first;</span><br><span class="line">    r = a[<span class="number">0</span>].second;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i].first &gt; r) &#123; <span class="comment">// 没有交集(情况3)</span></span><br><span class="line">            ++ans;</span><br><span class="line">            l = a[i].first;</span><br><span class="line">            r = a[i].second;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(a[i].second &gt; r) &#123; <span class="comment">// 有交集但不包含(情况2)</span></span><br><span class="line">            r = a[i].second;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里不需要讨论情况1，情况1对结果没有贡献。</p><p>遇到情况3代表遇到了一个新的区间。遇到了情况2代表合并（右边界更新）。</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 数组和字符串 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 数组和字符串 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>folium地图</title>
      <link href="/posts/336911618.html"/>
      <url>/posts/336911618.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>建议使用Jupyter notebook</p><p>这里的效果展示的地图都是可以放大缩小的。在放大缩小的过程中图像会发生变化，尤其是热力图和气泡图。</p><p>所以最好自己运行一下，看看效果。</p></blockquote><h1 id="folium绘制地图"><a href="#folium绘制地图" class="headerlink" title="folium绘制地图"></a>folium绘制地图</h1><p>先随便调用一下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> folium</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">world_map = folium.Map()</span><br><span class="line"></span><br><span class="line">world_map</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-15%2011.00.51.jpg" style="zoom: 30%;"></p><hr><p>绘制基础图，添加标签，图形：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 位置地图，带标签</span></span><br><span class="line">latitude = <span class="number">42.941335</span></span><br><span class="line">longitude = -<span class="number">76.735501</span></span><br><span class="line"></span><br><span class="line">map1 = folium.Map(location=[latitude, longitude], zoom_start=<span class="number">12</span>, tiles=<span class="string">&quot;Stamen Terrain&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加标签</span></span><br><span class="line">folium.Marker(location=[latitude, longitude], popup=<span class="string">&#x27;&lt;p style=&quot;width: 100px； font-family: Times New Roma&quot;&gt;this is north area&#x27;</span>).add_to(map1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画个圆形</span></span><br><span class="line">folium.Circle(location=[latitude, longitude], radius=<span class="number">1000</span>, color=<span class="string">&quot;green&quot;</span>, fill=<span class="literal">True</span>, fill_color=<span class="string">&quot;orange&quot;</span>).add_to(map1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画线</span></span><br><span class="line">trail_coordinates = [</span><br><span class="line">    (<span class="number">42.931934</span>, -<span class="number">76.735210</span>),</span><br><span class="line">    (<span class="number">42.873589</span>, -<span class="number">76.719417</span>),</span><br><span class="line">    (<span class="number">42.807633</span>, -<span class="number">76.728343</span>),</span><br><span class="line">    (<span class="number">42.785464</span>, -<span class="number">76.740016</span>),</span><br><span class="line">    (<span class="number">42.739589</span>, -<span class="number">76.732463</span>)</span><br><span class="line">]</span><br><span class="line">folium.PolyLine(trail_coordinates, tooltip=<span class="string">&quot;Coast&quot;</span>).add_to(map1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画面</span></span><br><span class="line">folium.Polygon([</span><br><span class="line">    [<span class="number">42.929101</span>, -<span class="number">76.745247</span>],</span><br><span class="line">    [<span class="number">42.926355</span>, -<span class="number">76.748130</span>],</span><br><span class="line">    [<span class="number">42.915337</span>, -<span class="number">76.729174</span>],</span><br><span class="line">    [<span class="number">42.917822</span>, -<span class="number">76.731963</span>],</span><br><span class="line">    [<span class="number">42.921067</span>, -<span class="number">76.733081</span>],</span><br><span class="line">],color=<span class="string">&#x27;red&#x27;</span>, weight=<span class="number">1</span>, fill=<span class="literal">True</span>, fill_color=<span class="string">&#x27;red&#x27;</span>, fill_opacity=<span class="number">0.3</span>).add_to(map1)</span><br><span class="line"></span><br><span class="line">map1.save(<span class="string">&#x27;map.html&#x27;</span>)</span><br><span class="line">map1</span><br></pre></td></tr></table></figure><p>效果：</p><p>地点标记、绿边圆圈（橙色填圆圈）、红色面（浅红色填色）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map1.jpg" style="zoom: 30%;"/></p><p>展示蓝色线：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map2.jpg" style="zoom:30%;" /></p><hr><p>数据（point）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map3.jpg" alt="数据图片" style="zoom:45%;" /></p><p>画热力图：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 热力图</span></span><br><span class="line"><span class="keyword">from</span> folium.plugins <span class="keyword">import</span> HeatMap</span><br><span class="line"></span><br><span class="line">map1 = folium.Map(location=[latitude, longitude], zoom_start= <span class="number">12</span>, tiles=<span class="string">&quot;Stamen Terrain&quot;</span>)</span><br><span class="line"></span><br><span class="line">HeatMap(point[[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>]].values.tolist()).add_to(map1)</span><br><span class="line"></span><br><span class="line">map1.save(<span class="string">&#x27;map2.html&#x27;</span>)</span><br><span class="line">map1</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map4.jpg" style="zoom: 30%" /></p><p>选择一个区域放大：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map5.jpg" style="zoom:30%;" /></p><hr><p>绘制气泡图：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 气泡图</span></span><br><span class="line"></span><br><span class="line">incidents = folium.<span class="built_in">map</span>.FeatureGroup()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1516</span>):</span><br><span class="line">    incidents.add_child(</span><br><span class="line">        folium.CircleMarker(</span><br><span class="line">            (point[<span class="string">&#x27;x&#x27;</span>][i], point[<span class="string">&#x27;y&#x27;</span>][i]),</span><br><span class="line">            radius=<span class="number">7</span>, <span class="comment"># define how big you want the circle markers to be</span></span><br><span class="line">            color=<span class="string">&#x27;yellow&#x27;</span>,</span><br><span class="line">            fill=<span class="literal">True</span>,</span><br><span class="line">            fill_color=<span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">            fill_opacity=<span class="number">0.4</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">map1 = folium.Map(location=[latitude, longitude], zoom_start=<span class="number">12</span>)</span><br><span class="line">map1.add_child(incidents)</span><br><span class="line"></span><br><span class="line">map1.save(<span class="string">&quot;map3.html&quot;</span>)</span><br><span class="line">map1</span><br></pre></td></tr></table></figure><p>效果(数据越多，颜色越深)：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map6.jpg" style="zoom:30%;" /></p><p>放大北区，放大后一些点就会分开，更详细展示：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map7.jpg" style="zoom:30%;" /></p><hr><p>统计展示区域数量：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计区域数量</span></span><br><span class="line"><span class="keyword">from</span> folium <span class="keyword">import</span> plugins</span><br><span class="line"></span><br><span class="line">map1 = folium.Map(location = [latitude, longitude], zoom_start = <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">incidents = plugins.MarkerCluster().add_to(map1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> lat, lng, label, <span class="keyword">in</span> <span class="built_in">zip</span>(point.x, point.y, point.m):</span><br><span class="line">    folium.Marker(</span><br><span class="line">        location=[lat, lng],</span><br><span class="line">        icon=<span class="literal">None</span>,</span><br><span class="line">        popup=label,</span><br><span class="line">    ).add_to(incidents)</span><br><span class="line"></span><br><span class="line">map1.add_child(incidents)</span><br><span class="line"></span><br><span class="line">map1.save(<span class="string">&#x27;map4.html&#x27;</span>)</span><br><span class="line">map1</span><br></pre></td></tr></table></figure><p>效果(放大会分开，缩小会合并。数字代表这小块区域的点数量)：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map8.jpg" style="zoom:30%;" /></p><hr><p>利用GeoJson产生地理分块(自己去网上找 url ，我这里是成都市的)：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取 geojson文件产生区块</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">latitude = <span class="number">30.652154</span></span><br><span class="line">longitude = <span class="number">104.067411</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://geo.datav.aliyun.com/areas_v3/bound/510100_full.json&quot;</span></span><br><span class="line">cd_geo = <span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">cd_map = folium.Map(location = [latitude, longitude], zoom_start = <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">folium.GeoJson(</span><br><span class="line">    cd_geo,</span><br><span class="line">    style_function=<span class="keyword">lambda</span> feature: &#123;</span><br><span class="line">        <span class="string">&#x27;fillColor&#x27;</span>: <span class="string">&#x27;#ffff00&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;color&#x27;</span>: <span class="string">&#x27;black&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;weight&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&#x27;dashArray&#x27;</span>: <span class="string">&#x27;5, 5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;fillOpacity&#x27;</span>: <span class="number">0.6</span></span><br><span class="line">    &#125;</span><br><span class="line">).add_to(cd_map)</span><br><span class="line"></span><br><span class="line">cd_map.save(<span class="string">&quot;map5.html&quot;</span>)</span><br><span class="line">cd_map</span><br></pre></td></tr></table></figure><p>效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/folium_map9.jpg" style="zoom:30%;" /></p><p>我这里是没有具体数据，如果有数据，可以做分块的数据热力图。</p><p>但是这样做其实效率不高。可以用PPT做，修改更加自由，效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%9B%9B%E5%B7%9D%E5%9C%B0%E5%9B%BE.png" style="zoom: 55%;" /></p>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> 绘图 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 绘图 </tag>
            
            <tag> folium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>截断数组</title>
      <link href="/posts/2891591958.html"/>
      <url>/posts/2891591958.html</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>给定一个长度为 n 的数组 a1,a2,…,an。</p><p>现在，要将该数组从中间截断，得到三个<strong>非空</strong>子数组。</p><p>要求，三个子数组内各元素之和都相等。</p><p>请问，共有多少种不同的截断方法？</p><h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行包含整数 n。</p><p>第二行包含 n 个整数 a1,a2,…,an。</p><h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一个整数，表示截断方法数量。</p><h2 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h2><p>前六个测试点满足 1≤n≤10。<br>所有测试点满足 1≤n≤105，−10000≤ai≤10000。</p><h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><p>输入样例1：</p><blockquote><p>4<br>1 2 3 3</p></blockquote><p>输出样例1：</p><blockquote><p>1</p></blockquote><p>输入样例2：</p><blockquote><p>5<br>1 2 3 4 5</p></blockquote><p>输出样例2：</p><blockquote><p>0</p></blockquote><p>输入样例3：</p><blockquote><p>2<br>0 0</p></blockquote><p>输出样例3：</p><blockquote><p>0</p></blockquote><h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><p>一开始就想着单纯的前缀和，求出来前缀和之后在暴力枚举<code>i</code>和<code>j</code>，结果不负众望，超时了。<strong>超时代码</strong>如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> i64;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n, ans = <span class="number">0</span>;</span><br><span class="line">i64 nums[N], sum[N];</span><br><span class="line">i64 sum1, sum2, sum3;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">   </span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; nums[i];</span><br><span class="line">        <span class="keyword">if</span> (i != <span class="number">0</span>) sum[i] = sum[i<span class="number">-1</span>] + nums[i];</span><br><span class="line">        <span class="keyword">else</span> sum[i] = nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">per</span> (i, <span class="number">0</span>, n) cout &lt;&lt; sum[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; ++j) &#123;</span><br><span class="line">            sum1 = sum[i];</span><br><span class="line">            sum2 = sum[j] - sum[i];</span><br><span class="line">            sum3 = sum[n<span class="number">-1</span>] - sum[j];</span><br><span class="line">            <span class="keyword">if</span> (sum1 == sum2 &amp;&amp; sum2 == sum3) ans++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后考虑三等分，那也就是说第一段就是和的三分之一。第二段也是。就没必要这么比了。</p><p>首先先判断和除以三能否除尽。不能除尽输出0结束。</p><p>除以三得到num，然后遍历得到<code>i</code>的列表。列表内容是满足<code>sum[i] == num</code>的<code>i</code>值。这样第一部分就找好了。注意，要至少留两个数。</p><p>理论上，可以如此找第二部分，再把第二部分的也存上，要至少留一个数。假设这么做的话就得到<code>vj</code>，上面得到的是<code>vi</code>.结果就是：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; vi.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; vj.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vi[i] &lt; vj[j]) ++ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是这样还是要枚举，且复杂度可能不低。怎么优化呢。</p><p>优化办法就是再存一个数组，大小和<code>nums</code>一样大，然后在得到第一部分的列表时，顺便就得到了<code>sumi</code>的中每个<code>i</code>的值。要求其实就是如果<code>sum[i] == 2*num</code>也就是可以从<code>i</code>位置截取为第二下，就让<code>sumi[i] = 1</code>或者直接<code>++</code>。</p><p>最后再求一下<code>sumi</code>的前缀和。</p><p>用一个例子来举例吧：</p><p><code>nums = [1, 9, -9, 2, 2, 0, 2, 3, 4, -1, 2]</code></p><p><code>sum = [1, 10, 1, 3, 5, 5, 7, 10, 14, 13, 15]</code>  nums的前缀和</p><p><code>vi = [4, 5]</code>    这里就是满足sum = 5的索引</p><p><code>sumi = [0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0]</code>   如果 <code>sum[i] == 10</code> 那么<code>sumi[i] = 1</code></p><p><code>sumi = [0, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2]</code>   sumi的前缀和</p><p>答案比较明显，就是2.即（4， 7）和（5，7）。</p><p>接下来解的个数为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; vi.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    ans += sumi[n<span class="number">-1</span>] - sumi[vi[i]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解释：</p><p>总共遍历两次，因为<code>vi.size() == 2</code>, <code>sumi[n-1] = 2</code></p><ol><li><p><code>vi[i] = 4</code></p><p> <code>sumi[4] = 1</code></p><p> <code>ans += 2 - 1</code></p></li><li><p><code>vi[i] = 5</code></p><p> <code>sumi[5] = 1</code></p><p> <code>ans += 2 - 1</code></p></li></ol><p>最终结果为2.</p><p>整体代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> i64;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">i64 nums[N], sum[N], sumi[N], num, ans = <span class="number">0</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; nums[i];</span><br><span class="line">        <span class="keyword">if</span> (i != <span class="number">0</span>) sum[i] = sum[i<span class="number">-1</span>] + nums[i];</span><br><span class="line">        <span class="keyword">else</span> sum[i] = nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum[n<span class="number">-1</span>] % <span class="number">3</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    num = sum[n<span class="number">-1</span>] / <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum[i] == num) vi.<span class="built_in">push_back</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (sum[i] == <span class="number">2</span> * num) ++sumi[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i)</span><br><span class="line">        sumi[i] += sumi[i<span class="number">-1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; vi.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        ans += sumi[n<span class="number">-1</span>] - sumi[vi[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>上面这样做就已经可以AC了，但是这个复杂度还是比较高。下面继续优化。</p></blockquote><p>分析内涵。还是从这段代码说起：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; vi.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; vj.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vi[i] &lt; vj[j]) ++ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其实即使要求每一段的<code>i</code>后面有多少个<code>j</code>。</p><p>换个想法，如果切到了第二刀，我们记录它前面有多少个第一刀不就好了。</p><p>那么就有这种想法：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i) &#123; <span class="comment">// 注意：要留个第三段</span></span><br><span class="line">    <span class="keyword">if</span> (sum[i] == <span class="number">2</span> * num) ans += cnt;</span><br><span class="line">    <span class="keyword">if</span> (sum[i] == num) cnt++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即<code>cnt</code>记录到是遍历到当前位置，有多少个第一刀。如果遍历到了第二刀，就直接累计它前面的第一刀即可。</p><p>写出完整代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> i64;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">i64 nums[N], sum[N], num, ans = <span class="number">0</span>, cnt;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; nums[i];</span><br><span class="line">        <span class="keyword">if</span> (i != <span class="number">0</span>) sum[i] = sum[i<span class="number">-1</span>] + nums[i];</span><br><span class="line">        <span class="keyword">else</span> sum[i] = nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum[n<span class="number">-1</span>] % <span class="number">3</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    num = sum[n<span class="number">-1</span>] / <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum[i] == <span class="number">2</span>*num) ans += cnt;</span><br><span class="line">        <span class="keyword">if</span> (sum[i] == num) ++cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后还可以优化一下空间。</p><p>因为发现前缀和数组和传统用法不一样。所以用一个变量记录<code>sum[i]</code>即可，不需要完整的前缀和数组。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">include &lt;bits/stdc++.h&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> i64;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">i64 nums[N], sum, num, ans = <span class="number">0</span>, cnt, tot;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; nums[i];</span><br><span class="line">        sum += nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sum % <span class="number">3</span>) cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        num = sum / <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            tot += nums[i];</span><br><span class="line">            <span class="keyword">if</span> (tot == <span class="number">2</span>*num) ans += cnt;</span><br><span class="line">            <span class="keyword">if</span> (tot == num) ++cnt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 算法题 </category>
          
          <category> 前缀和与差分 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 前缀和与差分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>模拟退火算法基本原理</title>
      <link href="/posts/3402121571.html"/>
      <url>/posts/3402121571.html</url>
      
        <content type="html"><![CDATA[<h1 id="爬山算法的缺点"><a href="#爬山算法的缺点" class="headerlink" title="爬山算法的缺点"></a>爬山算法的缺点</h1><p>爬山算法是一种简单的贪心搜索算法，它的原理是，只向高出走，如果发现移动后的高度变小了，那么就不移动，如果高度变高了就移动。该算法每次从当前解的临近解空间中选择一个最优解作为当前解，直到达到一个局部最优解。</p><p>爬山算法实现很简单，其主要缺点是<strong>会陷入局部最优解</strong>，而不一定能搜索到全局最优解。假设<code>B</code>点为当前解，爬山算法搜索到<code>A</code>点这个<strong>局部最优解</strong>就可能会停止搜索，因为在<code>A</code>点无论向那个方向小幅度移动都不能得到更优的解。</p><h1 id="模拟退火算法实现"><a href="#模拟退火算法实现" class="headerlink" title="模拟退火算法实现"></a>模拟退火算法实现</h1><p>模拟退火算法从某一较高初温出发，伴随温度参数的不断下降，结合 <strong>一定的概率</strong> <strong>突跳特性</strong> 在解空间中随机寻找目标函数的全局最优解，即在局部最优解能概率性地跳出并最终趋于全局最优。</p><p>核心思想：服从目标就一定接受目标，如果不服从目标就按概率接受。关键点就是这个概率，模拟每一步走的步长也是关键点。</p><h1 id="爬山算法和模拟退火的比喻"><a href="#爬山算法和模拟退火的比喻" class="headerlink" title="爬山算法和模拟退火的比喻"></a>爬山算法和模拟退火的比喻</h1><ul><li>爬山算法：兔子朝着比现在高的地方跳去。它找到了不远处的最高山峰。但是这座山不一定是珠穆朗玛峰。这就是爬山算法，它不能保证局部最优值就是全局最优值。</li><li>模拟退火：兔子喝醉了（它本来知道自己要去哪里）。它随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，它渐渐清醒了并朝最高方向跳去。这就是模拟退火。</li></ul><h1 id="模拟退火算法的数学原理"><a href="#模拟退火算法的数学原理" class="headerlink" title="模拟退火算法的数学原理"></a>模拟退火算法的数学原理</h1><p>核心算法：</p><script type="math/tex; mode=display">P(\Delta E) = e ^ {-\frac{\Delta E}{k * t}}</script><p>背后的原理和物理上的一模一样。能量越低越有秩序，越靠近最优解。</p><ul><li>温度越高接受错误解的概率越高</li><li>温度越低接受错误解的概率越低</li></ul><p>错误解：目标是求最小值，正确解是解变小的方向，错误解就是变大的方向。在爬山算法中接受错误解的概率就是0。</p><h1 id="问题案例"><a href="#问题案例" class="headerlink" title="问题案例"></a>问题案例</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>求 <script type="math/tex">min \quad f(x,y) = 4x^2 - 2.1 x^4 + \frac{x^6}{3} + x y -4y^2 + 4y^4, \left | x \right| \le 5,\left | y \right | \le 5</script></p><h2 id="Python代码"><a href="#Python代码" class="headerlink" title="Python代码"></a>Python代码</h2><h3 id="研究函数"><a href="#研究函数" class="headerlink" title="研究函数"></a>研究函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self, x, y</span>):</span><br><span class="line">    res = <span class="number">4</span>*x**<span class="number">2</span> - <span class="number">2.1</span>*x**<span class="number">4</span> + x**<span class="number">6</span>/<span class="number">3</span> + <span class="number">4</span>*y**<span class="number">2</span> + <span class="number">4</span>*y**<span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SA</span>:  <span class="comment"># 接下来的方法都是这个对象的</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func, N=<span class="number">100</span>, T0=<span class="number">100</span>, Tf=<span class="number">0.01</span>, alpha=<span class="number">0.99</span></span>):</span><br><span class="line">        self.func = func</span><br><span class="line">        self.N = N        <span class="comment"># 每一代点的个数</span></span><br><span class="line">        self.alpha = alpha<span class="comment"># 降温系数</span></span><br><span class="line">        self.T0 = T0<span class="comment"># 初始温度</span></span><br><span class="line">        self.Tf = Tf<span class="comment"># 温度终值</span></span><br><span class="line">        self.T = T0<span class="comment"># 当前温度</span></span><br><span class="line">        self.x = [random()*<span class="number">11</span>-<span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)]   <span class="comment"># 随机生成iter个x的值</span></span><br><span class="line">        self.y = [random()*<span class="number">11</span>-<span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)]<span class="comment"># 随机生成iter个y的值</span></span><br><span class="line">        self.most_best = []</span><br><span class="line">        self.history = &#123;<span class="string">&#x27;f&#x27;</span>: [], <span class="string">&#x27;T&#x27;</span>: []&#125;</span><br></pre></td></tr></table></figure><p>生成点，由于 $x$ 的范围已经规定了，所以随机生成的点就是<code>random()*11-5</code> </p><p>参数解释：</p><ul><li>self不解释</li><li>func：待研究函数</li><li>iter：迭代次数</li><li>T0：初始温度    一般是100左右，如果解的范围比较大，可以设置大一点</li><li>Tf：温度终值     一般接近于0，但不等于0（看下一个函数，就知道等于0时就没有意义了，不扰动了）</li><li>alpha：降温系数  一般取0.85～0.99</li></ul><p>温度变化公式：$T = \alpha T$</p><p>画个温度曲线图演示一下，0.99不太明显，用0.9演示：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/SA_1.jpg)" alt="温度下降曲线" style="zoom:50%;" /></p><h3 id="随机扰动产生新解"><a href="#随机扰动产生新解" class="headerlink" title="随机扰动产生新解"></a>随机扰动产生新解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_new</span>(<span class="params">self, x, y</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x_new = x + self.T*(random() - random())</span><br><span class="line">        y_new = y + self.T*(random() - random())</span><br><span class="line">        <span class="keyword">if</span> (-<span class="number">5</span> &lt;= x_new &lt;= <span class="number">5</span>) &amp; (-<span class="number">5</span> &lt;= y_new &lt;= <span class="number">5</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> x_new, y_new</span><br></pre></td></tr></table></figure><p><code>random() - random()</code>理解为就是一个随机数就可以了。</p><p>所以 $\Delta x$ 与当前温度和随机值有关。所以在温度比较高的时候 $\Delta x$ 比较大，寻找新解的步长比较大。也就是突跳特性。</p><ul><li>前期找到更多新区域</li><li>后期找到局部最优解</li><li>局部最优解的出全局最优解 </li></ul><h3 id="Metroplis准则"><a href="#Metroplis准则" class="headerlink" title="Metroplis准则"></a>Metroplis准则</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Metropolis</span>(<span class="params">self, f, f_new</span>):</span><br><span class="line">    <span class="keyword">if</span> f_new &lt;= f:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = math.exp((f - f_new) / self.T)</span><br><span class="line">        <span class="keyword">if</span> random() &lt; p:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>这个函数就是判断是否选取新解。</p><p>上面提到了如果是正确解就一定选择，如果是错误解就按概率选择。</p><p>2-3行体现了正确解一定选择。</p><p>第5行是计算当前温度下的选择概率。</p><p>第6行生成一个随机数，来模拟是否选择。</p><p>代码很简单。重点是概率的计算。这里是：<script type="math/tex">p_T = e^{\frac{f_T - f_{T+1}}{T}}</script></p><p>更规范的描述这一步的公式：</p><script type="math/tex; mode=display">p = \begin{cases}1 \qquad\qquad, if\qquad E(x_{new}) < E(x_{old}) \\e^{-\dfrac{E(x_{new}) - E(x_{old})}{T}} \quad ,if \qquad E(x_{new}) \ge E(x_{old})\end{cases}</script><p>当然，要根据题目分析正确解的情况。</p><h3 id="获取最优目标函数值"><a href="#获取最优目标函数值" class="headerlink" title="获取最优目标函数值"></a>获取最优目标函数值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">best</span>(<span class="params">self</span>):</span><br><span class="line">    f_list = []  <span class="comment"># 保存每个点通过函数计算后的值</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.N): <span class="comment"># 每一代有 N 个点</span></span><br><span class="line">        f = self.func(self.x[i], self.y[i])</span><br><span class="line">        f_list.append(f)</span><br><span class="line">    f_best = <span class="built_in">min</span>(f_list) <span class="comment"># 求这一代中的最优解</span></span><br><span class="line">    idx = f_list.index(f_best) <span class="comment"># 得到最优解的索引</span></span><br><span class="line">    <span class="keyword">return</span> f_best, idx</span><br></pre></td></tr></table></figure><h3 id="主体函数"><a href="#主体函数" class="headerlink" title="主体函数"></a>主体函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">while</span> self.T &gt; self.Tf: <span class="comment"># 外循环，降温过程，判断温度是否降到期望温度</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.N): <span class="comment"># 内循环遍历每一个解</span></span><br><span class="line">            f = self.func(self.x[i], self.y[i]) <span class="comment"># 计算初始解</span></span><br><span class="line">            x_new, y_new = self.generate_new(self.x[i], self.y[i]) <span class="comment"># 随机扰动，产生新解</span></span><br><span class="line">            f_new = self.func(self.x[i], self.y[i]) <span class="comment"># 计算扰动后的新解</span></span><br><span class="line">            <span class="keyword">if</span> self.Metropolis(f, f_new):</span><br><span class="line">                self.x[i] = x_new</span><br><span class="line">                self.y[i] = y_new</span><br><span class="line">        ft, idx = self.best()</span><br><span class="line">        self.history[<span class="string">&#x27;f&#x27;</span>].append(ft)</span><br><span class="line">        self.history[<span class="string">&#x27;T&#x27;</span>].append(self.T)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 降温，别写成死循环了</span></span><br><span class="line">        self.T = self.T*self.alpha</span><br><span class="line">    <span class="comment"># 输出最优解</span></span><br><span class="line">    f_best, idx = self.best()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;F=<span class="subst">&#123;f_best&#125;</span>, x=<span class="subst">&#123;self.x[idx]&#125;</span>, y=<span class="subst">&#123;self.y[idx]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="整体代码"><a href="#整体代码" class="headerlink" title="整体代码"></a>整体代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">x, y</span>):</span><br><span class="line">    res = <span class="number">4</span> * x ** <span class="number">2</span> - <span class="number">2.1</span> * x ** <span class="number">4</span> + x ** <span class="number">6</span> / <span class="number">3</span> + <span class="number">4</span> * y ** <span class="number">2</span> + <span class="number">4</span> * y ** <span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SA</span>:  <span class="comment"># 接下来的方法都是这个对象的</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func, N=<span class="number">100</span>, T0=<span class="number">100</span>, Tf=<span class="number">0.01</span>, alpha=<span class="number">0.99</span></span>):</span><br><span class="line">        self.func = func</span><br><span class="line">        self.N = N  <span class="comment"># 每一代点的个数</span></span><br><span class="line">        self.alpha = alpha  <span class="comment"># 降温系数</span></span><br><span class="line">        self.T0 = T0  <span class="comment"># 初始温度</span></span><br><span class="line">        self.Tf = Tf  <span class="comment"># 温度终值</span></span><br><span class="line">        self.T = T0  <span class="comment"># 当前温度</span></span><br><span class="line">        self.x = [random() * <span class="number">11</span> - <span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)]  <span class="comment"># 随机生成iter个x的值</span></span><br><span class="line">        self.y = [random() * <span class="number">11</span> - <span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)]  <span class="comment"># 随机生成iter个y的值</span></span><br><span class="line">        self.history = &#123;<span class="string">&#x27;f&#x27;</span>: [], <span class="string">&#x27;T&#x27;</span>: []&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_new</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            x_new = x + self.T * (random() - random())</span><br><span class="line">            y_new = y + self.T * (random() - random())</span><br><span class="line">            <span class="keyword">if</span> (-<span class="number">5</span> &lt;= x_new &lt;= <span class="number">5</span>) &amp; (-<span class="number">5</span> &lt;= y_new &lt;= <span class="number">5</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> x_new, y_new</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Metropolis</span>(<span class="params">self, f, f_new</span>):</span><br><span class="line">        <span class="keyword">if</span> f_new &lt;= f:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p = math.exp((f - f_new) / self.T)</span><br><span class="line">            <span class="keyword">if</span> random() &lt; p:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">best</span>(<span class="params">self</span>):</span><br><span class="line">        f_list = []  <span class="comment"># 保存每个点通过函数计算后的值</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.N):  <span class="comment"># 每一代有 N 个点</span></span><br><span class="line">            f = self.func(self.x[i], self.y[i])</span><br><span class="line">            f_list.append(f)</span><br><span class="line">        f_best = <span class="built_in">min</span>(f_list)  <span class="comment"># 求这一代中的最优解</span></span><br><span class="line">        idx = f_list.index(f_best)  <span class="comment"># 得到最优解的索引</span></span><br><span class="line">        <span class="keyword">return</span> f_best, idx</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> self.T &gt; self.Tf:  <span class="comment"># 外循环，降温过程，判断温度是否降到期望温度</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.N):  <span class="comment"># 内循环遍历每一个解</span></span><br><span class="line">                f = self.func(self.x[i], self.y[i])  <span class="comment"># 计算初始解</span></span><br><span class="line">                x_new, y_new = self.generate_new(self.x[i], self.y[i])  <span class="comment"># 随机扰动，产生新解</span></span><br><span class="line">                f_new = self.func(self.x[i], self.y[i])  <span class="comment"># 计算扰动后的新解</span></span><br><span class="line">                <span class="keyword">if</span> self.Metropolis(f, f_new):</span><br><span class="line">                    self.x[i] = x_new</span><br><span class="line">                    self.y[i] = y_new</span><br><span class="line">            ft, idx = self.best()</span><br><span class="line">            self.history[<span class="string">&#x27;f&#x27;</span>].append(ft)</span><br><span class="line">            self.history[<span class="string">&#x27;T&#x27;</span>].append(self.T)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 降温，别写成死循环了</span></span><br><span class="line">            self.T = self.T * self.alpha</span><br><span class="line">        <span class="comment"># 输出最优解</span></span><br><span class="line">        f_best, idx = self.best()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;F=<span class="subst">&#123;f_best&#125;</span>, x=<span class="subst">&#123;self.x[idx]&#125;</span>, y=<span class="subst">&#123;self.y[idx]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sa = SA(func)</span><br><span class="line">sa.run()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画图</span></span><br><span class="line">plt.plot(sa.history[<span class="string">&#x27;T&#x27;</span>], sa.history[<span class="string">&#x27;f&#x27;</span>])</span><br><span class="line">plt.title(<span class="string">&#x27;SA&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;f&#x27;</span>)</span><br><span class="line">plt.gca().invert_xaxis()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>最终结果：</p><p>F=1.4410512133214726, x=-0.2964965160195926, y=0.4748706225379135</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20230214115435954.png" alt="image-20230214115435954"></p><h2 id="Matlab-代码"><a href="#Matlab-代码" class="headerlink" title="Matlab 代码"></a>Matlab 代码</h2><blockquote><p>这里的Matlab代码实际上是根据上面的python代码改编的，写得不太严谨。</p><p>Matlab中有模拟退火算法的工具箱，所以也不用自己写模拟退火算法。</p></blockquote><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">clc, clear;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 研究函数</span></span><br><span class="line">fun = @(x, y) <span class="number">4</span>*x^<span class="number">2</span> - <span class="number">2.1</span>*x^<span class="number">4</span> + x^<span class="number">6</span>/<span class="number">3</span> + <span class="number">4</span>*y^<span class="number">2</span> + <span class="number">4</span>*y^<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 相关参数</span></span><br><span class="line">N = <span class="number">100</span>;</span><br><span class="line">T0 = <span class="number">100</span>;</span><br><span class="line">Tf = <span class="number">0.01</span>;</span><br><span class="line">alpha = <span class="number">0.99</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 产生初始解</span></span><br><span class="line">x = <span class="built_in">rand</span>(<span class="number">2</span>, <span class="number">100</span>)*<span class="number">10</span><span class="number">-5</span>;</span><br><span class="line">T = T0;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 存储最优解</span></span><br><span class="line">history = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> Tf &lt; T</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">        f = fun(x(<span class="number">1</span>, <span class="built_in">i</span>), x(<span class="number">2</span>, <span class="built_in">i</span>));</span><br><span class="line">        x_new = generate_new(x, <span class="built_in">i</span>, T);</span><br><span class="line">        f_new = fun(x_new(<span class="number">1</span>, <span class="built_in">i</span>), x_new(<span class="number">2</span>, <span class="built_in">i</span>));</span><br><span class="line">        flag = Metropolis(f, f_new, T);</span><br><span class="line">        <span class="keyword">if</span> flag</span><br><span class="line">            x(<span class="number">1</span>, <span class="built_in">i</span>) = x_new(<span class="number">1</span>, <span class="built_in">i</span>);</span><br><span class="line">            x(<span class="number">2</span>, <span class="built_in">i</span>) = x_new(<span class="number">2</span>, <span class="built_in">i</span>);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    [ft, idx] = best(fun, x, N);</span><br><span class="line">    history = [history, ft];</span><br><span class="line">    T = T*alpha;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">hs = <span class="built_in">size</span>(history);</span><br><span class="line"><span class="built_in">plot</span>(<span class="number">1</span>:hs(<span class="number">2</span>), history);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x_new</span> = <span class="title">generate_new</span><span class="params">(x, i, T)</span></span></span><br><span class="line">    x_new = x;</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">true</span></span><br><span class="line">        x_new(<span class="number">1</span>, <span class="built_in">i</span>) = x(<span class="number">1</span>, <span class="built_in">i</span>) + T * (<span class="built_in">rand</span> - <span class="built_in">rand</span>);</span><br><span class="line">        x_new(<span class="number">2</span>, <span class="built_in">i</span>) = x(<span class="number">2</span>, <span class="built_in">i</span>) + T * (<span class="built_in">rand</span> - <span class="built_in">rand</span>);</span><br><span class="line">        <span class="keyword">if</span> <span class="number">-5</span> &lt;= x_new(<span class="number">1</span>, <span class="built_in">i</span>) &lt;= <span class="number">5</span> &amp;&amp; <span class="number">-5</span> &lt;= x_new(<span class="number">2</span>, <span class="built_in">i</span>) &lt;= <span class="number">5</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flag</span> = <span class="title">Metropolis</span><span class="params">(f, f_new, T)</span></span></span><br><span class="line">    <span class="keyword">if</span> f &gt;= f_new</span><br><span class="line">        flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        p = <span class="built_in">exp</span>((f - f_new) / T);</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">rand</span>() &lt; p</span><br><span class="line">                flag = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                flag = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[f_best, idx]</span> = <span class="title">best</span><span class="params">(fun, x, N)</span></span></span><br><span class="line">    f_list = [];</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">        fb = fun(x(<span class="number">1</span>, <span class="built_in">i</span>), x(<span class="number">2</span>, <span class="built_in">i</span>));</span><br><span class="line">        f_list = [f_list, fb];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    [f_best, idx] = <span class="built_in">min</span>(f_list);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><p>优化类问题</p><ul><li>图论中的最短路径问题</li><li>线性、非线性规划问题</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> 优化类 </category>
          
          <category> 现代优化算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 优化类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>粒子群算法优化方法</title>
      <link href="/posts/3266130344.html"/>
      <url>/posts/3266130344.html</url>
      
        <content type="html"><![CDATA[<h1 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h1><p>因为很有可能会在局部最优，很难到达全局最优。所以需要优化：</p><p>最简单的就是将粒子个数设置大一点。但对于一些问题来说不够有效。</p><h2 id="惯性权重"><a href="#惯性权重" class="headerlink" title="惯性权重"></a>惯性权重</h2><p>惯性权重取值一般是0.8-1.2之间</p><ul><li>惯性权重越大越有利于全局搜索</li><li>惯性权重越小越有利于局部搜索</li></ul><p>一般有以下几种优化方式：</p><h3 id="参数解释"><a href="#参数解释" class="headerlink" title="参数解释"></a>参数解释</h3><p>$w_{start}$：最开始的惯性权重，一般是0.9</p><p>$w_{end}$：最终的惯性权重，一般是0.4</p><p>$G$：最终迭代次数</p><p>$t$：当前代数</p><p>$N$：粒子群个体数</p><h3 id="线性递减惯性权重"><a href="#线性递减惯性权重" class="headerlink" title="线性递减惯性权重"></a>线性递减惯性权重</h3><script type="math/tex; mode=display">w_t = w_{start} - (w_{start} - w_{end}) \times \dfrac{t}{G}</script><p>每次迭代过程中加上这个公式的代码变换惯性权重。</p><h3 id="非线性递减惯性权重"><a href="#非线性递减惯性权重" class="headerlink" title="非线性递减惯性权重"></a>非线性递减惯性权重</h3><p>两种方式：</p><script type="math/tex; mode=display">w_t = w_{start} - (w_{start} - w_{end}) \times (\dfrac{t}{G})^2</script><script type="math/tex; mode=display">w_t = w_{start} - (w_{start} - w_{end}) \times [\dfrac{2t}{G} - (\dfrac{t}{G})^2]</script><h3 id="自适应惯性权重"><a href="#自适应惯性权重" class="headerlink" title="自适应惯性权重"></a>自适应惯性权重</h3><p>$f_{average}^t$ 表示第 t 次迭代时，所有粒子的平均适应度。</p><p>$f_{max}^t = max {f(x_1^t) , f(x_2^t) , \cdots , f(x_N^t) }$ </p><p>$f_{min}^t = min {f(x_1^t) , f(x_2^t) , \cdots , f(x_N^t) }$ </p><h4 id="最小值问题"><a href="#最小值问题" class="headerlink" title="最小值问题"></a>最小值问题</h4><script type="math/tex; mode=display">w_i^t = \begin{cases}w_{start} + (w_{start} - w_{end}) \dfrac{f(x_i^t) - f_{min}^t}{f_{average}^t - f_{min}^t}, f(x_i^t) \le f_{average}^t \\w_{start} \qquad\qquad\qquad\qquad\qquad\qquad\qquad ,f(x_i^t) \gt f_{average}^t\end{cases}</script><h4 id="最大值问题"><a href="#最大值问题" class="headerlink" title="最大值问题"></a>最大值问题</h4><script type="math/tex; mode=display">w_i^t = \begin{cases}w_{start} + (w_{start} - w_{end}) \dfrac{f_{max}^t - f(x_i^t)}{f_{max}^t  - f_{average}^t}, f(x_i^t) \ge f_{average}^t \\w_{start} \qquad\qquad\qquad\qquad\qquad\qquad\qquad ,f(x_i^t) \lt f_{average}^t\end{cases}</script><h3 id="随机惯性权重"><a href="#随机惯性权重" class="headerlink" title="随机惯性权重"></a>随机惯性权重</h3><script type="math/tex; mode=display">w = w_{end} + (w_{start} - w_{end}) \times rand + \sigma \times randn</script><p>其中rand是<script type="math/tex">[0, 1]</script>之间的均匀分布随机数。randn为正态分布的随机数。<script type="math/tex">\sigma</script> 为标准差，用来度量随机变量权重<script type="math/tex">w</script>与其数学期望（均值）之间的偏离程度。</p><p>$\sigma \times randn$ 的目的是控制取值中的权重误差，使权重 $w$ 有利于向期望权重方向进化。</p><h2 id="因子"><a href="#因子" class="headerlink" title="因子"></a>因子</h2><p>很明显$c_1$和$c_2$对于速度的影响也比较大。</p><p>$c_1$较大会使粒子过多地在局部搜索。</p><p>$c_2$较大会使粒子过早收敛到局部最优解。</p><h3 id="压缩因子法"><a href="#压缩因子法" class="headerlink" title="压缩因子法"></a>压缩因子法</h3><p>引进新参数：收缩因子 $\Phi$</p><p>一般要求：$c_1 = c_2 = 2.05, C = c_1 + c_2 = 4.10$，收缩因子为</p><script type="math/tex; mode=display">\Phi = \dfrac{2}{\left | 2 - C - \sqrt{C^2 - 4C} \right | }</script><p>其中，<script type="math/tex">c_1、c_2</script>的值可以不等于2.05，但是$C$要满足大于4。</p><p>引入收缩因子后，速度更新公式改为：</p><script type="math/tex; mode=display">v_{ij}(t+1) = \Phi \times [wv_{ij}(t) + c_1r_1(p_{ij}(t) - x_{ij}(t)) + c_2r_2(g_{ij}(t) - x_{ij})(t)]</script><h3 id="非对称学习因子"><a href="#非对称学习因子" class="headerlink" title="非对称学习因子"></a>非对称学习因子</h3><p>其实就是和权重类似，根据不同的迭代代数产生变化。</p><ul><li><p>目的</p><p>  在迭代初期采用较大的<script type="math/tex">c_1</script>，较小的<script type="math/tex">c_2</script>，即个体意识优先于集体意识。使得各个粒子可以快速寻找最优解。</p><p>  在迭代后期采用较大的<script type="math/tex">c_2</script>，较小的<script type="math/tex">c_1</script>，即群体意识优先于个体意识。使得收敛到全局最优。</p></li><li><p>做法</p><p>  <script type="math/tex">c_1</script>随着迭代次数的提升，递减</p><p>  <script type="math/tex">c_2</script>随着迭代次数的提升，递增</p></li></ul><p>公式：</p><p>参数的值是假设的</p><script type="math/tex; mode=display">c_1^{strat} = 2.5，c_1^{end} = 0.5, c_2^{start} = 1, c_2^{end} = 2.25</script><script type="math/tex; mode=display">c_1^t = c_1^{start} + (c_1^{end} - c_1^{start}) \times \dfrac{t}{G}; \\c_2^t = c_2^{start} + (c_2^{end} - c_2^{start}) \times \dfrac{t}{G}</script>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> 优化类 </category>
          
          <category> 现代优化算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 优化类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>粒子群算法基本原理</title>
      <link href="/posts/1966191251.html"/>
      <url>/posts/1966191251.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>浅说一下思路：</p><p>一群鸟找吃的，假设有几只鸟同时都找到了好吃的，就判断谁找到的更好，相当于就是当前的全局最优，全体的鸟都考虑想这边靠拢。但是其他几只找到的鸟，也会把自己找到的好吃的作为考虑，选择最近的吃的，这个属于是局部最优。总之，就是一群鸟互相合作，使得利益最大化，找到全局最优</p></blockquote><h1 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h1><h2 id="先列公式"><a href="#先列公式" class="headerlink" title="先列公式"></a>先列公式</h2><p>假设在一个<code>D</code>维的目标搜索空间中，有<code>N</code>个粒子组成一个群落，其中第<code>i</code>个例子表示为一个<code>D</code>维的向量：</p><script type="math/tex; mode=display">X_i = (x_{i1} , x_{i2}, \cdots , x_{iD}), i = 1, 2, \cdots ,N</script><p>第<code>i</code>个粒子的“飞行”速度也是一个<code>D</code>维第向量，记为：</p><script type="math/tex; mode=display">V_i = (v_{i1} , v_{i2} , \cdots ,v_{iD}) , i = 1, 2, \cdots , N</script><p>在第 <code>t</code> 代的第 <code>i</code> 个粒子向第 <code>t+1</code> 代进化时，根据如下式子更新：</p><script type="math/tex; mode=display">v_{ij}(t+1) = wv_{ij}(t) + c_1r_1(t)[p_{ij}(t)-x_{ij}(t)] + c_2r_2(t)[p_{gj}(t)-x_{ij}(t)]</script><script type="math/tex; mode=display">x_{ij}(t+1) = x_{ij}(t) + v_{ij}(t+1)</script><h2 id="公式解释"><a href="#公式解释" class="headerlink" title="公式解释"></a>公式解释</h2><p>第一个公式其实就是和坐标一样。假设是2维平面空间，<script type="math/tex">x_i = (1,2)</script>就是在平面直角坐标系的<script type="math/tex">x=1, y = 2</script>的点上嘛。多加几维也就是表示各个维度的点的位置了。所以就是N个粒子组成的群体，每个粒子都有自己的一个坐标位置。</p><p>第二个公式也就是利用向量表示速度。速度有大小和方向，这个其实也就是物理知识。同样的放到二维来理解，之后再提升维度。</p><p>第三个公式是迭代下一代的方向。公式主要是三部分：<script type="math/tex">wv_{ij}(t)</script> 、 <script type="math/tex">c_1r_1(t)[p_{ij}(t)-x_{ij}(t)]</script> 、 <script type="math/tex">c_2r_2(t)[p_{gj}(t)-x_{ij}(t)]</script></p><ul><li><script type="math/tex">wv_{ij}(t)</script> ：表示自身的一个惯性，也就是保持原有运动的趋势。 <script type="math/tex">v_{ij}(t)</script> 就是上一代第 <script type="math/tex">i</script> 个粒子的方向向量的第 <script type="math/tex">j</script> 列。其实就是上一代的方向。<script type="math/tex">w</script>是惯性权重。最终理解就是，每个粒子对于保持原有运动方向的执着程度。其中 <script type="math/tex">w</script> 是全局参数。</li><li><script type="math/tex">c_1r_1(t)[p_{ij}(t)-x_{ij}(t)]</script> ：表示自己发现的食物对自己的吸引，也就是有向局部最优解靠拢的趋势。 <script type="math/tex">c_i</script> 是全局参数，是自我学习因子，或者理解为自我发现最优解的权重，权重越大表示我越相信这个粒子可以独立找到最优解。 <script type="math/tex">r_i(t)</script> 是一个随机数，用来模拟食物的好坏。 <script type="math/tex">p_{ij}(t)</script> 表示局部最优所在的坐标位置。 <script type="math/tex">x_{ij}(t)</script> 就是自己当前的位置。 <script type="math/tex">[p_{ij}(t)-x_{ij}(t)]</script> 是局部最优和自己当前位置之差，也就决定了靠近局部最优的方向和速度。</li><li><script type="math/tex">c_2r_2(t)[p_{gj}(t)-x_{ij}(t)]</script> ：这个和上一个式子很接近。 <script type="math/tex">c_2</script> 也是全局参数，表示群体学习因子，权重越大表示我越相信这个群体当前找到的全局最优就是最终真正的最优解。 <script type="math/tex">p_{gj}(t)</script> 就是当前这一代群体找到的全局最优解的坐标。</li></ul><p>三个部分讲解完毕。合起来就是考虑三个向量矢量相加为最终方向即可。这里基本也就可以理解各个权重的作用了。主要就是 <script type="math/tex">w</script> 、 <script type="math/tex">c_1</script> 、 <script type="math/tex">c_2</script> 三个权重。</p><p>第四个公式就是位置迭代的公式了。就是当前位置和下一代移动的方向矢量相加，结果就是该粒子下一代的位置。</p><h1 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h1><h2 id="全局参数"><a href="#全局参数" class="headerlink" title="全局参数"></a>全局参数</h2><p>全局参数的选取取决于优化函数。</p><ul><li>N：群体粒子个数</li><li><p>D：可行解的维数</p></li><li><p><script type="math/tex">w</script>：惯性权重</p></li><li><script type="math/tex">c_1</script>：自我学习因子</li><li><script type="math/tex">c_2</script>：群体学习因子</li><li>limit：位置的限制，别跑出地图了</li><li>vlimit：速度的限制，别飞得太猛，直接闪现到另一个点，错过最优解</li></ul><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><ul><li><p>Step1：初始化种群的位置 <script type="math/tex">X</script></p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = limit(<span class="number">1</span>) + (limit(<span class="number">2</span>) -  limit(<span class="number">1</span>)) .* <span class="built_in">rand</span>(N, d);</span><br></pre></td></tr></table></figure></li><li><p>Step2：计算个体适应度</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = @(x) 函数表达式</span><br><span class="line">f(x)</span><br></pre></td></tr></table></figure></li><li><p>Step3：更新粒子速度和位置</p><p>  要记得检查边界。</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v = w*v + c1*<span class="built_in">rand</span>*(xm-x) + c2*<span class="built_in">rand</span>*(<span class="built_in">repmat</span>(ym, N, <span class="number">1</span>)-x);  <span class="comment">% 更新速度</span></span><br><span class="line"><span class="comment">% 边界速度处理</span></span><br><span class="line">v(v &gt; vlimit(<span class="number">2</span>)) = vlimit(<span class="number">2</span>);                             <span class="comment">% 大于最大速度时取最大速度</span></span><br><span class="line">v(v &lt; vlimit(<span class="number">1</span>)) = vlimit(<span class="number">1</span>);                             <span class="comment">% 小于最大速度时取最小速度</span></span><br><span class="line">x = x + v;                                                <span class="comment">% 位置更新</span></span><br><span class="line"><span class="comment">% 边界位置处理  </span></span><br><span class="line">x(x &gt; limit(<span class="number">2</span>)) = limit(<span class="number">2</span>);</span><br><span class="line">x(x &lt; limit(<span class="number">1</span>)) = limit(<span class="number">1</span>);</span><br></pre></td></tr></table></figure></li><li><p>Step4：计算新位置的适应度，新位置适应度更高才移动向该点移动，否则不移动。（属于是固守当前的最优解，不贪便宜，比较稳）</p>  <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">    <span class="keyword">if</span> fx(<span class="built_in">i</span>)  &lt; fxm(<span class="built_in">i</span>)</span><br><span class="line">        fxm(<span class="built_in">i</span>) = fx(<span class="built_in">i</span>);     <span class="comment">% 更新个体历史最佳适应度  </span></span><br><span class="line">        xm(<span class="built_in">i</span>,:) = x(<span class="built_in">i</span>,:);   <span class="comment">% 更新个体历史最佳位置(取值)  </span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li><li><p>Step5：继续执行Step2 - Step4直到满足终止条件，也就是满足迭代次数。或者有 k 代都没让适应度变化。</p></li></ul><h1 id="算法评价"><a href="#算法评价" class="headerlink" title="算法评价"></a>算法评价</h1><ul><li><p>优点</p><p>  原理简单，实现容易，参数较少，需要条件少</p></li><li><p>缺点</p><p>  很容易过早收敛到局部最优，而无法达到全局最优</p></li></ul><h1 id="问题案例"><a href="#问题案例" class="headerlink" title="问题案例"></a>问题案例</h1><h2 id="一维案例"><a href="#一维案例" class="headerlink" title="一维案例"></a>一维案例</h2><p>这里的可行解就是x的取值。绘制的图像是二维图像。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/PSO_1.png" alt="函数图像" style="zoom:50%;" /></p><p>求解<script type="math/tex">f = x \sin x \cos(2x) - 2x\sin(3x) + 3x*\sin(4x)</script>的最大值和最小值</p><h3 id="最大值"><a href="#最大值" class="headerlink" title="最大值"></a>最大值</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 初始化种群  </span></span><br><span class="line">clc, clear, close all;</span><br><span class="line">f= @(x) x .* <span class="built_in">sin</span>(x) .* <span class="built_in">cos</span>(<span class="number">2</span> * x) - <span class="number">2</span> * x .* <span class="built_in">sin</span>(<span class="number">3</span> * x) +<span class="number">3</span> * x .* <span class="built_in">sin</span>(<span class="number">4</span> * x); <span class="comment">% 求这个函数的最大值</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">20</span>;                         <span class="comment">% 初始种群个数  </span></span><br><span class="line">d = <span class="number">1</span>;                          <span class="comment">% 可行解维数  </span></span><br><span class="line">G = <span class="number">100</span>;                        <span class="comment">% 迭代次数       </span></span><br><span class="line">limit = [<span class="number">0</span>, <span class="number">50</span>];                <span class="comment">% 设置位置参数限制  </span></span><br><span class="line">vlimit = [<span class="number">-10</span>, <span class="number">10</span>];             <span class="comment">% 设置速度限制  </span></span><br><span class="line">w = <span class="number">0.8</span>;                        <span class="comment">% 惯性权重  </span></span><br><span class="line">c1 = <span class="number">0.5</span>;                       <span class="comment">% 自我学习因子  </span></span><br><span class="line">c2 = <span class="number">0.5</span>;                       <span class="comment">% 群体学习因子 </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>); ezplot(f, [<span class="number">0</span>, <span class="number">0.01</span>, limit(<span class="number">2</span>)]);   <span class="comment">% 曲线</span></span><br><span class="line"></span><br><span class="line">x = limit(<span class="number">1</span>) + (limit(<span class="number">2</span>)-limit(<span class="number">1</span>)) .* <span class="built_in">rand</span>(N, d); <span class="comment">% 初始种群的位置  </span></span><br><span class="line"></span><br><span class="line">v = <span class="built_in">rand</span>(N, d);                  <span class="comment">% 初始种群的速度</span></span><br><span class="line">xm = x;                          <span class="comment">% 每个个体的历史最佳位置</span></span><br><span class="line">ym = <span class="built_in">zeros</span>(<span class="number">1</span>, d);                <span class="comment">% 种群的历史最佳位置</span></span><br><span class="line">fxm = <span class="built_in">ones</span>(N, <span class="number">1</span>);                <span class="comment">% 每个个体的历史最佳适应度</span></span><br><span class="line">fym = <span class="number">0</span>;                         <span class="comment">% 种群历史最佳适应度</span></span><br><span class="line"><span class="built_in">hold</span> on;</span><br><span class="line"><span class="built_in">plot</span>(xm, f(xm), <span class="string">&#x27;ro&#x27;</span>); title(<span class="string">&#x27;初始状态图&#x27;</span>);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">2</span>)</span><br><span class="line">record = <span class="built_in">zeros</span>(G, <span class="number">1</span>);            <span class="comment">% 记录器</span></span><br><span class="line"><span class="keyword">for</span> t = <span class="number">1</span> : G</span><br><span class="line">    fx = f(x);                   <span class="comment">% 个体当前适应度</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">        <span class="keyword">if</span> fx(<span class="built_in">i</span>) &gt; fxm(<span class="built_in">i</span>)</span><br><span class="line">            fxm(<span class="built_in">i</span>) = fx(<span class="built_in">i</span>);      <span class="comment">% 更新个体历史最佳适应度</span></span><br><span class="line">            xm(<span class="built_in">i</span>,:) = x(<span class="built_in">i</span>,:);    <span class="comment">% 更新个体历史最佳位置(取值)</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span>  <span class="built_in">min</span>(fxm) &gt; fym </span><br><span class="line">        [fym, nmin] = <span class="built_in">max</span>(fxm);  <span class="comment">% 更新群体历史最佳适应度</span></span><br><span class="line">        ym = xm(nmin, :);        <span class="comment">% 更新群体历史最佳位置</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    v = w*v + c1*<span class="built_in">rand</span>*(xm-x) + c2*<span class="built_in">rand</span>*(<span class="built_in">repmat</span>(ym, N, <span class="number">1</span>)-x);<span class="comment">% 速度更新</span></span><br><span class="line">    <span class="comment">% 边界速度处理</span></span><br><span class="line">    v(v &gt; vlimit(<span class="number">2</span>)) = vlimit(<span class="number">2</span>);</span><br><span class="line">    v(v &lt; vlimit(<span class="number">1</span>)) = vlimit(<span class="number">1</span>);</span><br><span class="line">    x = x + v; <span class="comment">% 位置更新</span></span><br><span class="line">    <span class="comment">% 边界位置处理</span></span><br><span class="line">    x(x &gt; limit(<span class="number">2</span>)) = limit(<span class="number">2</span>);</span><br><span class="line">    x(x &lt; limit(<span class="number">1</span>)) = limit(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    record(t) = fym; <span class="comment">% 最大值记录</span></span><br><span class="line">    x0 = <span class="number">0</span> : <span class="number">0.01</span> : limit(<span class="number">2</span>);</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>); <span class="built_in">plot</span>(x0, f(x0), <span class="string">&#x27;b-&#x27;</span>, x, f(x), <span class="string">&#x27;ro&#x27;</span>); title(<span class="string">&#x27;状态位置变化&#x27;</span>)</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>); <span class="built_in">plot</span>(record(<span class="number">1</span>:t)); title(<span class="string">&#x27;最优适应度进化过程&#x27;</span>)</span><br><span class="line">    pause(<span class="number">0.01</span>) </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">x0 = <span class="number">0</span> : <span class="number">0.01</span> : limit(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">4</span>); <span class="built_in">plot</span>(x0, f(x0), <span class="string">&#x27;b-&#x27;</span>, x, f(x), <span class="string">&#x27;ro&#x27;</span>); title(<span class="string">&#x27;最终状态位置&#x27;</span>)</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;最优值：&#x27;</span>,num2str(fym)]);</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;变量取值：&#x27;</span>,num2str(ym)]);</span><br></pre></td></tr></table></figure><h3 id="最小值"><a href="#最小值" class="headerlink" title="最小值"></a>最小值</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 初始化种群  </span></span><br><span class="line">clc, clear, close all;</span><br><span class="line">f= @(x) x .* <span class="built_in">sin</span>(x) .* <span class="built_in">cos</span>(<span class="number">2</span> * x) - <span class="number">2</span> * x .* <span class="built_in">sin</span>(<span class="number">3</span> * x) +<span class="number">3</span> * x .* <span class="built_in">sin</span>(<span class="number">4</span> * x); <span class="comment">% 求这个函数的最小值</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">20</span>;                         <span class="comment">% 初始种群个数</span></span><br><span class="line">d = <span class="number">1</span>;                          <span class="comment">% 可行解维数</span></span><br><span class="line">G = <span class="number">100</span>;                        <span class="comment">% 迭代次数</span></span><br><span class="line">limit = [<span class="number">0</span>, <span class="number">50</span>];                <span class="comment">% 设置位置参数限制</span></span><br><span class="line">vlimit = [<span class="number">-10</span>, <span class="number">10</span>];             <span class="comment">% 设置速度限制</span></span><br><span class="line">w = <span class="number">0.8</span>;                        <span class="comment">% 惯性权重</span></span><br><span class="line">c1 = <span class="number">0.5</span>;                       <span class="comment">% 自我学习因子</span></span><br><span class="line">c2 = <span class="number">0.5</span>;                       <span class="comment">% 群体学习因</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>);ezplot(f,[<span class="number">0</span>,<span class="number">0.01</span>,limit(<span class="number">2</span>)]);   <span class="comment">% 曲线</span></span><br><span class="line"></span><br><span class="line">x = limit(<span class="number">1</span>) + (limit(<span class="number">2</span>) -  limit(<span class="number">1</span>)) .* <span class="built_in">rand</span>(N, d); <span class="comment">% 初始种群的位置</span></span><br><span class="line"></span><br><span class="line">v = <span class="built_in">rand</span>(N, d);                  <span class="comment">% 初始种群的速度</span></span><br><span class="line">xm = x;                          <span class="comment">% 每个个体的历史最佳位置</span></span><br><span class="line">ym = <span class="built_in">zeros</span>(<span class="number">1</span>, d);                <span class="comment">% 种群的历史最佳位置</span></span><br><span class="line">fxm = <span class="built_in">ones</span>(N, <span class="number">1</span>)*<span class="built_in">inf</span>;            <span class="comment">% 每个个体的历史最佳适应度</span></span><br><span class="line">fym = <span class="built_in">inf</span>;                       <span class="comment">% 种群历史最佳适应度</span></span><br><span class="line"><span class="built_in">hold</span> on;</span><br><span class="line"><span class="built_in">plot</span>(xm, f(xm), <span class="string">&#x27;ro&#x27;</span>);title(<span class="string">&#x27;初始状态图&#x27;</span>);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">2</span>)</span><br><span class="line">record = <span class="built_in">zeros</span>(G, <span class="number">1</span>);          <span class="comment">% 记录器</span></span><br><span class="line"><span class="keyword">for</span> t = <span class="number">1</span> : G</span><br><span class="line">    fx = f(x) ;                <span class="comment">% 个体当前适应度</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">        <span class="keyword">if</span> fx(<span class="built_in">i</span>) &lt; fxm(<span class="built_in">i</span>)</span><br><span class="line">            fxm(<span class="built_in">i</span>) = fx(<span class="built_in">i</span>);     <span class="comment">% 更新个体历史最佳适应度</span></span><br><span class="line">            xm(<span class="built_in">i</span>,:) = x(<span class="built_in">i</span>,:);   <span class="comment">% 更新个体历史最佳位置(取值)</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span>  <span class="built_in">min</span>(fxm) &lt; fym</span><br><span class="line">        [fym, nmin] = <span class="built_in">min</span>(fxm);   <span class="comment">% 更新群体历史最佳适应度</span></span><br><span class="line">        ym = xm(nmin, :);      <span class="comment">% 更新群体历史最佳位置</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    v = w*v + c1*<span class="built_in">rand</span>*(xm-x) + c2*<span class="built_in">rand</span>*(<span class="built_in">repmat</span>(ym, N, <span class="number">1</span>)-x);<span class="comment">% 速度更新</span></span><br><span class="line">    <span class="comment">% 边界速度处理</span></span><br><span class="line">    v(v &gt; vlimit(<span class="number">2</span>)) = vlimit(<span class="number">2</span>);</span><br><span class="line">    v(v &lt; vlimit(<span class="number">1</span>)) = vlimit(<span class="number">1</span>);</span><br><span class="line">    x = x + v; <span class="comment">% 位置更新</span></span><br><span class="line">    <span class="comment">% 边界位置处理</span></span><br><span class="line">    x(x &gt; limit(<span class="number">2</span>)) = limit(<span class="number">2</span>);  </span><br><span class="line">    x(x &lt; limit(<span class="number">1</span>)) = limit(<span class="number">1</span>);  </span><br><span class="line">    </span><br><span class="line">    record(t) = fym; <span class="comment">% 最大值记录</span></span><br><span class="line">    x0 = <span class="number">0</span> : <span class="number">0.01</span> : limit(<span class="number">2</span>);</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>) <span class="built_in">plot</span>(x0, f(x0), <span class="string">&#x27;b-&#x27;</span>, x, f(x), <span class="string">&#x27;ro&#x27;</span>); title(<span class="string">&#x27;状态位置变化&#x27;</span>)</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>); <span class="built_in">plot</span>(record(<span class="number">1</span>:t)); title(<span class="string">&#x27;最优适应度进化过程&#x27;</span>)</span><br><span class="line">    pause(<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">x0 = <span class="number">0</span> : <span class="number">0.01</span> : limit(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">4</span>); <span class="built_in">plot</span>(x0, f(x0), <span class="string">&#x27;b-&#x27;</span>, x, f(x), <span class="string">&#x27;ro&#x27;</span>); title(<span class="string">&#x27;最终状态位置&#x27;</span>)</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;最优值：&#x27;</span>,num2str(fym)]);</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;变量取值：&#x27;</span>,num2str(ym)]);</span><br></pre></td></tr></table></figure><p>可以发现其他地方都没有改，主要就是改变了两个符号，这个在实际问题中可以讨论。就是下面代码都大于符号换成小于符号</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">    <span class="keyword">if</span> fx(<span class="built_in">i</span>) &lt; fxm(<span class="built_in">i</span>)</span><br><span class="line">        fxm(<span class="built_in">i</span>) = fx(<span class="built_in">i</span>);     <span class="comment">% 更新个体历史最佳适应度</span></span><br><span class="line">        xm(<span class="built_in">i</span>,:) = x(<span class="built_in">i</span>,:);   <span class="comment">% 更新个体历史最佳位置(取值)</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">if</span>  <span class="built_in">min</span>(fxm) &lt; fym</span><br><span class="line">    [fym, nmin] = <span class="built_in">min</span>(fxm);   <span class="comment">% 更新群体历史最佳适应度</span></span><br><span class="line">    ym = xm(nmin, :);      <span class="comment">% 更新群体历史最佳位置</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：如果值不是理想值，即道理局部最优解，可以设置粒子个数更大，达到全局最优解。</p></blockquote><h2 id="二维案例"><a href="#二维案例" class="headerlink" title="二维案例"></a>二维案例</h2><p>可行解是平面坐标<script type="math/tex">(x, y)</script> 的取值。绘制的图像是三维图像，图像比较向鸡蛋托盘。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/PSO_2.jpg" alt="函数图像" style="zoom:50%;" /></p><p>求解：<script type="math/tex">f = 20 + x^2 + y^2 - 10 \cos(2 \pi x) - 10\cos(2\pi y)， x, y \in [-5.12, 5.12]</script>的最小值</p><h3 id="最小值-1"><a href="#最小值-1" class="headerlink" title="最小值"></a>最小值</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%% 初始化种群  </span></span><br><span class="line">clc, clear, close all;</span><br><span class="line">f = @(x,y) <span class="number">20</span> +  x.^<span class="number">2</span> + y.^<span class="number">2</span> - <span class="number">10</span>*<span class="built_in">cos</span>(<span class="number">2</span>*<span class="built_in">pi</span>.*x) - <span class="number">10</span>*<span class="built_in">cos</span>(<span class="number">2</span>*<span class="built_in">pi</span>.*y);</span><br><span class="line"> </span><br><span class="line">x0 = <span class="number">-5.12</span> : <span class="number">0.05</span> : <span class="number">5.12</span>; <span class="comment">% x的边界</span></span><br><span class="line">y0 = x0;                  <span class="comment">% y的边界</span></span><br><span class="line">[X,Y] = <span class="built_in">meshgrid</span>(x0, y0); <span class="comment">% 绘制边界图</span></span><br><span class="line">Z = f(X,Y);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">1</span>); mesh(X,Y,Z);</span><br><span class="line">colormap(parula(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">N = <span class="number">50</span>;                         <span class="comment">% 初始种群个数  </span></span><br><span class="line">d = <span class="number">2</span>;                          <span class="comment">% 可行解维数  </span></span><br><span class="line">G = <span class="number">100</span>;                        <span class="comment">% 迭代次数</span></span><br><span class="line">limit = [<span class="number">-5.12</span>,<span class="number">5.12</span>];           <span class="comment">% 设置位置参数限制</span></span><br><span class="line">vlimit = [<span class="number">-.5</span>, <span class="number">.5</span>];             <span class="comment">% 设置速度限制</span></span><br><span class="line">w = <span class="number">0.8</span>;                        <span class="comment">% 惯性权重</span></span><br><span class="line">c1 = <span class="number">0.5</span>;                       <span class="comment">% 自我学习因子</span></span><br><span class="line">c2 = <span class="number">0.5</span>;                       <span class="comment">% 群体学习因子</span></span><br><span class="line"></span><br><span class="line">x = limit(<span class="number">1</span>) + (limit(<span class="number">2</span>) -  limit(<span class="number">1</span>)) .* <span class="built_in">rand</span>(N, d);<span class="comment">%初始种群的位置  </span></span><br><span class="line"></span><br><span class="line">v = <span class="built_in">rand</span>(N, d);                  <span class="comment">% 初始种群的速度</span></span><br><span class="line">xm = x;                          <span class="comment">% 每个个体的历史最佳位置</span></span><br><span class="line">ym = <span class="built_in">zeros</span>(<span class="number">1</span>, d);                <span class="comment">% 种群的历史最佳位置</span></span><br><span class="line">fxm = <span class="built_in">ones</span>(N, <span class="number">1</span>)*<span class="built_in">inf</span>;            <span class="comment">% 每个个体的历史最佳适应度</span></span><br><span class="line">fym = <span class="built_in">inf</span>;                       <span class="comment">% 种群历史最佳适应度</span></span><br><span class="line"><span class="built_in">hold</span> on </span><br><span class="line"><span class="built_in">scatter3</span>(x(:,<span class="number">1</span>), x(:,<span class="number">2</span>), f(x(:,<span class="number">1</span>),x(:,<span class="number">2</span>)), <span class="string">&#x27;r*&#x27;</span>);</span><br><span class="line"><span class="built_in">figure</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">% 群体更新  </span></span><br><span class="line">record = <span class="built_in">zeros</span>(G,<span class="number">1</span>);            <span class="comment">% 记录器</span></span><br><span class="line"><span class="keyword">for</span> t = <span class="number">1</span> : G</span><br><span class="line">     fx = f(x(:,<span class="number">1</span>), x(:,<span class="number">2</span>));    <span class="comment">% 个体当前适应度</span></span><br><span class="line">     <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">        <span class="keyword">if</span>  fx(<span class="built_in">i</span>) &lt; fxm(<span class="built_in">i</span>)</span><br><span class="line">            fxm(<span class="built_in">i</span>) = fx(<span class="built_in">i</span>);     <span class="comment">% 更新个体历史最佳适应度</span></span><br><span class="line">            xm(<span class="built_in">i</span>,:) = x(<span class="built_in">i</span>,:);   <span class="comment">% 更新个体历史最佳位置(取值)</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">min</span>(fxm) &lt; fym</span><br><span class="line">        [fym, nmin] = <span class="built_in">min</span>(fxm); <span class="comment">% 更新群体历史最佳适应度</span></span><br><span class="line">        ym = xm(nmin, :);       <span class="comment">% 更新群体历史最佳位置</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    v = v * w + c1 * <span class="built_in">rand</span> * (xm - x) + c2 * <span class="built_in">rand</span> * (<span class="built_in">repmat</span>(ym, N, <span class="number">1</span>) - x); <span class="comment">% 速度更新</span></span><br><span class="line">    <span class="comment">% 边界速度处理</span></span><br><span class="line">    v(v &gt; vlimit(<span class="number">2</span>)) = vlimit(<span class="number">2</span>);</span><br><span class="line">    v(v &lt; vlimit(<span class="number">1</span>)) = vlimit(<span class="number">1</span>);</span><br><span class="line">    x = x + v; <span class="comment">% 位置更新</span></span><br><span class="line">    <span class="comment">% 边界位置处理</span></span><br><span class="line">    x(x &gt; limit(<span class="number">2</span>)) = limit(<span class="number">2</span>);</span><br><span class="line">    x(x &lt; limit(<span class="number">1</span>)) = limit(<span class="number">1</span>);</span><br><span class="line">    record(t) = fym; <span class="comment">% 最优值记录</span></span><br><span class="line">    subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    mesh(X, Y, Z);</span><br><span class="line">    <span class="built_in">hold</span> on;</span><br><span class="line">    <span class="built_in">scatter3</span>(x(:,<span class="number">1</span>), x(:,<span class="number">2</span>), f(x(:,<span class="number">1</span>),x(:,<span class="number">2</span>)), <span class="string">&#x27;r*&#x27;</span>); title([<span class="string">&#x27;状态位置变化&#x27;</span>, <span class="string">&#x27;-迭代次数：&#x27;</span>, num2str(t)])</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>); <span class="built_in">plot</span>(record); title(<span class="string">&#x27;最优适应度进化过程&#x27;</span>)</span><br><span class="line">    pause(<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span>(<span class="number">4</span>);mesh(X,Y,Z); <span class="built_in">hold</span> on</span><br><span class="line"><span class="built_in">scatter3</span>(x(:,<span class="number">1</span>), x(:,<span class="number">2</span>), f(x(:,<span class="number">1</span>), x(:,<span class="number">2</span>)), <span class="string">&#x27;r*&#x27;</span>); title(<span class="string">&#x27;最终状态位置&#x27;</span>)</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;最优值：&#x27;</span>, num2str(fym)]);</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;变量取值：&#x27;</span>, num2str(ym)]);</span><br></pre></td></tr></table></figure><p>想要改为最大值其实就是改是否移动部分的代码</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : N</span><br><span class="line">    <span class="keyword">if</span>  fx(<span class="built_in">i</span>) &lt; fxm(<span class="built_in">i</span>)</span><br><span class="line">        fxm(<span class="built_in">i</span>) = fx(<span class="built_in">i</span>);     <span class="comment">% 更新个体历史最佳适应度</span></span><br><span class="line">        xm(<span class="built_in">i</span>,:) = x(<span class="built_in">i</span>,:);   <span class="comment">% 更新个体历史最佳位置(取值)</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">min</span>(fxm) &lt; fym</span><br><span class="line">    [fym, nmin] = <span class="built_in">min</span>(fxm); <span class="comment">% 更新群体历史最佳适应度</span></span><br><span class="line">    ym = xm(nmin, :);       <span class="comment">% 更新群体历史最佳位置</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><blockquote><p>优化求解的精确度：<a href="/posts/3266130344.html" title="粒子群算法优化方法">粒子群算法优化方法</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> 优化类 </category>
          
          <category> 现代优化算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 优化类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>遗传算法基本原理</title>
      <link href="/posts/488247922.html"/>
      <url>/posts/488247922.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文从非专业角度解析遗传算法。</p><p>可以先复制下面的<a href="#整体代码">整体代码</a>，直接尝试运行调试一下，会更有助于理解。</p></blockquote><h1 id="主要涉及知识点"><a href="#主要涉及知识点" class="headerlink" title="主要涉及知识点"></a>主要涉及知识点</h1><blockquote><p>下面三点直接代码中体现</p></blockquote><ul><li><p><a href="#选择操作">自然选择（复制）</a></p></li><li><p><a href="#交叉操作">遗传（交叉）</a></p></li><li><p><a href="#变异操作">变异（基因突变）</a></p></li></ul><h2 id="遗传算法的编码"><a href="#遗传算法的编码" class="headerlink" title="遗传算法的编码"></a>遗传算法的编码</h2><p>编码方式比较多，最常见的就是二进制编码。其实也可以用四进制，用四进制刚好对应了组成DNA的四种碱基：<strong>腺嘌呤（A）、胞嘧啶（C）、鸟嘌呤（G）和胸腺嘧啶（T）</strong>。不过都是模拟，不碍事。</p><p>一般遗传学中直接将一个个体简化到了一行矩阵，即1 * n的矩阵，每一列或几列组成一种基因形状（一般也就是理解一列代表一个基因）。使用二进制就是简化到了0 1两种取值。本文也就是二进制的编码方式。</p><h3 id="编码长度的选取"><a href="#编码长度的选取" class="headerlink" title="编码长度的选取"></a>编码长度的选取</h3><p>那么二进制编码的作用清楚了。现在就涉及到了有多少个基因，即这个n的取值问题了。</p><p>一般需要从两个方面考虑：<code>自变量的范围（更准确点应该是决策变量的范围）</code><script type="math/tex">[L_x, U_x]</script>和<code>搜索精度</code><script type="math/tex">SearchAccuracy</script></p><ul><li><p>自变量的范围</p><p>  一般自变量的取值范围是估计出来的（<del>能直接算出来还用啥遗传算法</del>）比如说<script type="math/tex">x^2 - 4x + 4 = 0</script>。x的取值很明显是 2 嘛，那我们就可以合理假设值是在范围<script type="math/tex">[0,10]</script>之间，不用太精确，但是肯定是越精确越好。范围越大 n 越大。</p></li><li><p>搜索精度</p><p>  其实就相当于是<script type="math/tex">\varepsilon</script>,即结果的误差精度，一般就是假设，精确度高就是1e-5（<script type="math/tex">10^{-5}</script>），要求不高就是0.01的样子（这里就用0.01距离了）。精度越精细 n 越大。</p></li></ul><p>好了距离的范围（<script type="math/tex">[0, 10]</script>）和精度（0.01）都确定了。那么也就是我们的答案是是在<script type="math/tex">[0.00, 10.00]</script>之间，但是二进制数没办法表示小数。这里的转化思路就是乘100，就<strong>相当于</strong>自变量范围为<script type="math/tex">[0, 1000]</script>，精度为1，这下就可以表示了。所以我们需要用二进制表示至少1000个数字，也就是<script type="math/tex">2^n >= 1000</script>。这个时候可以很轻易得到<script type="math/tex">n = 10</script>。</p><p>其实这个n可以用公式计算：</p><script type="math/tex; mode=display">n = \log_2[\dfrac{U_x - L_x}{SearchAccuracy}]</script><p>所以这里就是：</p><script type="math/tex; mode=display">n = log_2[\dfrac{10-0}{0.01}] = log_2 \,1000 \approx 10</script><p>这个用计算器算一下就可以了。注意要完全能够容纳这么多数字，所以需要将结果向上取整。</p><p>表示形式就是：</p><script type="math/tex; mode=display">A_9A_8A_7A_6A_5A_4A_3A_2A_1A_0</script><h3 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h3><p>在上面的例子中，n取10，即可以表示1024个数字，即0 ～ 1023。</p><p>这里要先说明一个概念，刚才的“放大”是直接乘100，即用0 ～ 1000 表示区间，那么9.99就是表示为999，10.00就是10.00。但实际上我们是用1023表示的10.00。这样就不会是简单的对应关系了。</p><p>也就是说解码过程要将二进制数先表示为十进制数，然后再缩小1023倍。</p><p>公式表示：</p><script type="math/tex; mode=display">\delta = \dfrac{U_x - L_x}{2^n - 1}</script><p>即：</p><script type="math/tex; mode=display">\delta = \dfrac{10.00}{1023} \approx 0.009775</script><p>所以之后把每一个解码后的十进制数乘以0.009775就行了。</p><p>于是：</p><script type="math/tex; mode=display">x = L_x + \delta \cdot \sum\limits_{i=0}^n A_i 2^i</script><h1 id="代码讲解"><a href="#代码讲解" class="headerlink" title="代码讲解"></a>代码讲解</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>这里从如下问题展开来讨论代码。也是解决该问题的代码。这可以类似归结为单目标规划问题的求解，因为约束条件只有：<script type="math/tex">0 \le x \le 50</script>，所以是最简单的规划问题。</p><p>求解<script type="math/tex">f(x) = \left | (x\sin(x)\cos(2x) - 2x\sin(3x) + 3x\sin(4x)) \right |</script>在<script type="math/tex">[0, 50]</script>的最大值和取到最大值时的自变量<script type="math/tex">x</script>。</p><p>这里先简单画个图看一下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/GA_test_1_1.png" alt="f(x)的图像" style="zoom:50%;" /></p><h2 id="全局参数"><a href="#全局参数" class="headerlink" title="全局参数"></a>全局参数</h2><ul><li><p>popsize=20;           群体大小。这里相当于一个个体就是代表一个解</p></li><li><p>chromlength=20;    串的长度，每一列相当于是一个基因，个体基因序列个数</p><p>  自变量取值范围：<script type="math/tex">[0, 50]</script>，搜索精度：<script type="math/tex">10-5</script></p><script type="math/tex; mode=display">chromlength = \log_2 \, 50*10^5 \approx 20</script></li><li><p>pc=0.6;                 发生交叉的概率</p></li><li><p>pm=0.1;                发生变异的概率</p></li><li><p>xlim = [0,50];          解的范围（题目中规定了在这个区间的最大值）</p></li><li><p>G = 100 ;               迭代次数</p></li><li><p>x = zeros(1, G);       每一代的适应度的 x 坐标</p></li><li><p>y = zeros(1, G);       每一代的适应度的 y 坐标</p></li><li><p>pop                       每个个体对应的基因序列，初始值的<strong>形式</strong>可提前看下<a href="#主函数">主函数</a>中的pop初始数据图。</p></li></ul><h2 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h2><h3 id="Matlab自带函数"><a href="#Matlab自带函数" class="headerlink" title="Matlab自带函数"></a>Matlab自带函数</h3><p>如下的函数中如果有不清楚的，可以去查一下文档。</p><ul><li>rand()</li><li>round()</li><li>zeros()</li><li>min()</li><li>max()</li><li>plot()</li><li>subplot()</li><li>title()</li><li>disp()</li><li>sum()</li><li>cumsum()</li><li>sort()</li><li>randperm()</li><li>abs()</li><li>cos()</li><li>sin()</li><li>pause()</li></ul><h3 id="自定义二进制转十进制函数（解码）"><a href="#自定义二进制转十进制函数（解码）" class="headerlink" title="自定义二进制转十进制函数（解码）"></a>自定义二进制转十进制函数（解码）</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dec</span> = <span class="title">bintodec</span><span class="params">(pop, popsize, chromlength, xlim)</span></span></span><br><span class="line">    dec = <span class="built_in">zeros</span>(<span class="number">1</span>, chromlength);  <span class="comment">% 初始化解存在的矩阵</span></span><br><span class="line">    index = chromlength<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span>;   <span class="comment">% 初始化索引方便 2^i</span></span><br><span class="line">    <span class="comment">% 对每个个体求十进制数</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : popsize</span><br><span class="line">        dec(<span class="built_in">i</span>) = sum(pop(<span class="built_in">i</span>, :).*(<span class="number">2.</span>^index));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">% 转化为区间上的数</span></span><br><span class="line">    dec = xlim(<span class="number">1</span>) + dec*(xlim(<span class="number">2</span>) -  xlim(<span class="number">1</span>)) / (<span class="number">2</span>^chromlength<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li><p>参数解释：</p><ul><li>pop：是初始的二进制群体，也就是主要待转换的东西</li><li>popsize：是群体的个数，这里是20</li><li>chromellength：就是基因的个数   即<script type="math/tex">n</script></li><li>xlim：自变量范围    <code>xlim(1)</code>就是<script type="math/tex">L_x</script>； <code>xlim(2)-xlim(1) / (2^chromlength-1)</code>就是<script type="math/tex">\delta</script></li></ul></li><li><p>主要公式：<script type="math/tex">x = L_x + \delta \cdot \sum \limits_{i=0}^n A_i 2^i</script></p></li><li><p>返回结果：一个1 * popsize的矩阵。每一列表示一个个体对象的解码后的值。</p></li></ul><h3 id="计算目标函数"><a href="#计算目标函数" class="headerlink" title="计算目标函数"></a>计算目标函数</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fx</span> = <span class="title">calobjvalue</span><span class="params">(decpop)</span> % 参数为十进制解</span></span><br><span class="line">    f = @(x) <span class="built_in">abs</span>(x .* <span class="built_in">sin</span>(x) .* <span class="built_in">cos</span>(<span class="number">2</span> * x) - <span class="number">2</span> * x .* <span class="built_in">sin</span>(<span class="number">3</span> * x) +<span class="number">3</span> * x .* <span class="built_in">sin</span>(<span class="number">4</span> * x)); <span class="comment">% 研究函数 </span></span><br><span class="line">    fx = f(decpop);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>参数解释：这里的参数是十进制解，也就是上一步得到的十进制序列。是一个 1 * popsize的矩阵，每一列表示一个可能的解</li><li>返回结果：将解代入研究函数中，求得一组解，返回一个1 * popsize的矩阵，每一列表示该位置的x经过fx求解之后的十进制结果。</li></ul><h3 id="绘制图像"><a href="#绘制图像" class="headerlink" title="绘制图像"></a>绘制图像</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plotfig</span><span class="params">(decpop , fx ,xlim, k)</span> </span></span><br><span class="line">    f = @(x) <span class="built_in">abs</span>(x .* <span class="built_in">sin</span>(x) .* <span class="built_in">cos</span>(<span class="number">2</span> * x) - <span class="number">2</span> * x .* <span class="built_in">sin</span>(<span class="number">3</span> * x) +<span class="number">3</span> * x .* <span class="built_in">sin</span>(<span class="number">4</span> * x)); <span class="comment">% 研究函数</span></span><br><span class="line">    x = xlim(<span class="number">1</span>):<span class="number">0.05</span>:xlim(<span class="number">2</span>);</span><br><span class="line">    y = f(x) ;</span><br><span class="line">    subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">plot</span>(x, y, decpop, fx, <span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">    title([<span class="string">&#x27;第&#x27;</span>, num2str(k), <span class="string">&#x27;次迭代进化&#x27;</span>])</span><br><span class="line">    pause(<span class="number">0.2</span>) <span class="comment">% 停顿两秒</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>就是一个画图，然后停顿一下给个过程，不过多解释。</p><h3 id="计算适应度"><a href="#计算适应度" class="headerlink" title="计算适应度"></a>计算适应度</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fitvalue</span> = <span class="title">calfitvalue</span><span class="params">(fx)</span></span></span><br><span class="line">    fitvalue = fx; </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>返回结果：1 * popsize的矩阵：每一列表示对应的x解得得fx对于本问题的适应度（合适或者不合适的程度）</li></ul><p>这里求最大值，并且函数值又都大于0，所以直接使用函数值本身作为适应度值。</p><p>一般来说，不同的问题适应度函数构造方法是不一样的。打个比方，如果是求最小值：那么可能是适应度就是<code>10-fx</code>之类的。</p><h3 id="选择操作"><a href="#选择操作" class="headerlink" title="选择操作"></a>选择操作</h3><p>这里其实可以类比自然界的选择，有很多策略，例如根据某个个体的适应度选择复制某个个体的基因可以保留下去（自然界中其实就是这样）。这里选择的轮盘赌的策略，其实就是根据个体的适应度，来给它分配被遗传的概率（也就是下面说的复制概率），适应度高的，被复制（也就是基因被保留）的概率更大。</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newx</span> = <span class="title">copyx</span><span class="params">(pop, fitvalue, popsize)</span></span></span><br><span class="line">    <span class="comment">% 按照轮盘赌策略对个体复制</span></span><br><span class="line">    newx = pop; <span class="comment">% 先全部遗传</span></span><br><span class="line">    <span class="built_in">i</span> = <span class="number">1</span>;  <span class="built_in">j</span> = <span class="number">1</span>;</span><br><span class="line">    p = fitvalue / sum(fitvalue); <span class="comment">% 分配占据轮盘的面积</span></span><br><span class="line">    Cs = cumsum(p);<span class="comment">% 计算占据的区间的右边界 </span></span><br><span class="line">    R = <span class="built_in">sort</span>(<span class="built_in">rand</span>(popsize,<span class="number">1</span>)); <span class="comment">% 生成每个个体的复制概率，并且排序</span></span><br><span class="line">    <span class="comment">% 复制</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">j</span> &lt;= popsize </span><br><span class="line">        <span class="keyword">if</span> R(<span class="built_in">j</span>) &lt; Cs(<span class="built_in">i</span>)</span><br><span class="line">            newx(<span class="built_in">j</span>,:) = pop(<span class="built_in">i</span>,:) ;</span><br><span class="line">            <span class="built_in">j</span> = <span class="built_in">j</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">i</span> = <span class="built_in">i</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li><p>参数描述：</p><ul><li>pop：这一代个体的二进制序列 popsize * chormlength的矩阵</li><li>fitvalue：每一个个体的适应度  1 * popsize 的矩阵</li><li>popsize：个体数量</li></ul></li><li><p>轮盘赌策略：</p><p>  假设有一张饼图，将一根飞针扎上去，每部分都有一个概率。</p><p>  最简单的情况：假设一张饼图被分成三份：第一份A占0.2，第二份B占0.3，第三份C占0.5。（不必按大小排序）。实际的区间个数就是popsize个。每个区间所占的比例与每一个个体的适应度有关。这里的转化公式就是：<script type="math/tex">p_i = \dfrac{fitvalue_i}{ \sum \limits_{j=0}^{popsize} fitvalue_j}</script></p><p>  那么对应的概率就是占的份数，放在一个区间上表示：0～0.2表示A，0.2～0.5表示B，0.5～1表示C。这里的转化公式就是：<script type="math/tex">C_i = \sum \limits_{j=0}^i p_j</script> 。在Matlab中有对应的函数可以执行类似的累加操作，就是<code>cumsum()</code>。</p><p>  现在随机扎针：<code>rand(popsize, 1)</code>即popsize针同时一起扎完。</p><p>  假设是四针，顺序为：0.78，0.12，0.55，0.33。这里就是要判断：分别多少针再ABC区域。传统方法就是遍历这四个值，即先找0.78所在区间，先比较是否大于0又小于0.2，再判断是否大于0.2又小于0.5，再判断是否大于0.5又小于1。之后再找0.12，0.55，0.33对应的区间。这样且不说写代码的难度（每一代的区间分配不一样），光是区间数量就很难人，如果有一万个区间呢。</p><p>  所以直接记录每个区间的右边界。即a = [0.2，0.5，1]。然后将扎的针排序，即b = [0.12，0.33，0.55，0.78]。接下来遍历排序后的针。用 <code>a(i)</code> 表示第 <code>i</code> 个区间的右边界，用<code>j</code>表示当前随机数，即<code>b(j)</code>表示当前随机数。</p><ul><li>如果<code>b(j) &lt; a(i)</code>就说明<code>b(j)</code>就是第<code>i</code>个区间的。</li><li>如果<code>b(j) &gt; a(i)</code>就说明该到下一个区间了，并且可以知道<code>b</code>数组中的剩下数都是属于后面的区间的。所以<code>i = i + 1</code></li></ul></li><li><p>函数解释：</p><p>  解释了轮盘赌策略之后，主要就是解释为什么用这个，这里其实就是模拟自然选择，适者生存。正常情况，如果合理就是随机扎针，每个区间一针，就不会有遗传其他个体的可能，但是如果有一个个体的适应度很高，占据轮盘的面积很大，那么就很有可能下一代会有好几个遗传到它的基因，同时也就抛弃了原始基因。</p></li><li><p>返回结果：新的一代的popsize个个体的新基因序列 popsize * chromlength的矩阵</p></li></ul><blockquote><p>说明：这里的策略可以选择很多种，并不一定是轮盘赌策略。对于不同的问题需要思考用何种策略更好。</p><p>这里提供一些选择方案：</p><p><strong>轮盘赌选择（Roulette Wheel Selection）</strong>：是一种回放式随机采样方法。每个个体进入下一代的概率等于它的适应度值与整个种群中个体适应度值和的比例。选择误差较大。</p><p><strong>随机竞争选择（Stochastic Tournament）</strong>：每次按轮盘赌选择一对个体，然后让这两个个体进行竞争，适应度高的被选中，如此反复，直到选满为止。</p><p><strong>最佳保留选择</strong>：首先按轮盘赌选择方法执行遗传算法的选择操作，然后将当前群体中适应度最高的个体结构完整地复制到下一代群体中。</p><p><strong>无回放随机选择（也叫期望值选择Excepted Value Selection）</strong>：根据每个个体在下一代群体中的生存期望来进行随机选择运算。方法如下:<br>（1） 计算群体中每个个体在下一代群体中的生存期望数目N。<br>（2） 若某一个体被选中参与交叉运算，则它在下一代中的生存期望数目减去0.5，若某一个体未 被选中参与交叉运算，则它在下一代中的生存期望数目减去1.0。<br>（3） 随着选择过程的进行，若某一个体的生存期望数目小于0时，则该个体就不再有机会被选中。</p><p><strong>确定式选择</strong>：按照一种确定的方式来进行选择操作。具体操作过程如下：<br>（1） 计算群体中各个个体在下一代群体中的期望生存数目N。<br>（2） 用N的整数部分确定各个对应个体在下一代群体中的生存数目。<br>（3） 用N的小数部分对个体进行降序排列，顺序取前M个个体加入到下一代群体中。至此可完全确定出下一代群体中Ｍ个个体。</p><p><strong>无回放余数随机选择</strong>：可确保适应度比平均适应度大的一些个体能够被遗传到下一代群体中，因而选择误差比较小。</p><p><strong>均匀排序</strong>：对群体中的所有个体按期适应度大小进行排序，基于这个排序来分配各个个体被选中的概率。</p><p><strong>最佳保存策略</strong>：当前群体中适应度最高的个体不参与交叉运算和变异运算，而是用它来代替掉本代群体中经过交叉、变异等操作后所产生的适应度最低的个体。</p><p><strong>随机联赛选择</strong>：每次选取几个个体中适应度最高的一个个体遗传到下一代群体中。</p><p><strong>排挤选择</strong>：新生成的子代将代替或排挤相似的旧父代个体，提高群体的多样性。</p></blockquote><h2 id="交叉操作"><a href="#交叉操作" class="headerlink" title="交叉操作"></a>交叉操作</h2><p>这里选择的两点交叉，同样根据不同的问题，选择不同的合适的方案。</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newx</span> = <span class="title">crossover</span><span class="params">(pop, pc, popsize, chromlength)</span></span></span><br><span class="line">    <span class="comment">% 注意个体数为奇数偶数的区别</span></span><br><span class="line">    <span class="built_in">i</span> = <span class="number">2</span> ; <span class="comment">% 两个为一对</span></span><br><span class="line">    newx = pop ; <span class="comment">% 先全部遗传</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">i</span> + <span class="number">2</span> &lt;= popsize <span class="comment">% 遍历每一对</span></span><br><span class="line">        <span class="comment">%将第i 与 第 i -1 进行随机位点交叉</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">rand</span> &lt; pc <span class="comment">% 生成一个随机数，如果小于交叉率就变易</span></span><br><span class="line">            x1 = pop(<span class="built_in">i</span><span class="number">-1</span>, :); <span class="comment">% 此次交叉的两个个体的第一个</span></span><br><span class="line">            x2 = pop(<span class="built_in">i</span>, :);   <span class="comment">% 此次交叉的两个个体的第二个</span></span><br><span class="line">            r = randperm(chromlength, <span class="number">2</span>); <span class="comment">% 返回范围内两个整数，这里是选择交叉序列的左右区间</span></span><br><span class="line">            r1 = <span class="built_in">min</span>(r); r2 = <span class="built_in">max</span>(r);     <span class="comment">% 交叉复制的位点，即左右区间，r1为左区间，r2为右区间</span></span><br><span class="line">            <span class="comment">% 个体交叉，其余部分和原始相同，交叉位点区间内直接用另一个个体的序列</span></span><br><span class="line">            newx(<span class="built_in">i</span><span class="number">-1</span>, :) = [x1(<span class="number">1</span>:r1<span class="number">-1</span>), x2(r1:r2), x1(r2+<span class="number">1</span>:<span class="keyword">end</span>)];</span><br><span class="line">            newx(<span class="built_in">i</span>, :) = [x2(<span class="number">1</span>:r1<span class="number">-1</span>), x1(r1:r2), x2(r2+<span class="number">1</span>:<span class="keyword">end</span>)];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">i</span> = <span class="built_in">i</span> + <span class="number">2</span>; <span class="comment">% 更新i，交叉下一对</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>参数解释：<ul><li>pop：每个个体对应的基因序列</li><li>pc：发生交叉的概率</li><li>popsize：个体数量</li><li>chromlength：串的长度，每一列相当于是一个基因，个体基因序列个数</li></ul></li><li>返回结果：<ul><li>newx：即新一代的结果，会覆盖上一代，和pop的size一样 popsize * chromlength的矩阵</li></ul></li></ul><p>函数说明：</p><blockquote><p>使用上述方式时需要着重注意个体数是偶数和奇数的区别。</p><p>一般常见的交叉方案：</p><p><strong>单点交叉（One-point Crossover）</strong>：指在个体编码串中只随机设置一个交叉点，然后再该点相互交换两个配对个体的部分染色体。</p><p><strong>两点交叉与多点交叉</strong>：<br>(1) 两点交叉（Two-point Crossover）：在个体编码串中随机设置了两个交叉点，然后再进行部分基因交换。<br>(2) 多点交叉（Multi-point Crossover）</p><p><strong>均匀交叉（也称一致交叉，Uniform Crossover）</strong>：两个配对个体的每个基因座上的基因都以相同的交叉概率进行交换，从而形成两个新个体。</p><p><strong>算术交叉（Arithmetic Crossover）</strong>：由两个个体的线性组合而产生出两个新的个体。该操作对象一般是由浮点数编码表示的个体。</p></blockquote><h3 id="变异操作"><a href="#变异操作" class="headerlink" title="变异操作"></a>变异操作</h3><p>这里选择的基本位变异的方案，同样有很多方案可选，根据题目选择合适的。</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newx</span> = <span class="title">mutation</span><span class="params">(pop, pm, popsize, chromlength)</span></span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : popsize<span class="comment">% 对每个个体判断</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">rand</span> &lt; pm<span class="comment">% 产生随机数判断该个体是否变异</span></span><br><span class="line">            r = randperm(chromlength, <span class="number">1</span>);   <span class="comment">% 随机选择一个整数表示要变异的基因位</span></span><br><span class="line">            pop(<span class="built_in">i</span>, r) = ~pop(<span class="built_in">i</span>, r);<span class="comment">% 变异，这里因为是选择的二进制编码方式所以直接取反</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    newx = pop; <span class="comment">% 将变异后的结果返回。</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li><p>参数解释：</p><ul><li><p>pop：每个个体对应的基因序列</p></li><li><p>pm：发生变异的概率</p></li><li><p>popsize：个体数量</p></li><li><p>chromlength：串的长度，每一列相当于是一个基因，个体基因序列个数</p></li></ul></li><li><p>返回结果：</p><ul><li>newx：即新一代的结果，会覆盖上一代，和pop的size一样 popsize * chromlength的矩阵</li></ul></li></ul><blockquote><p>一般常见的变异操作方案：</p><p><strong>基本位变异（Simple Mutation）</strong>：对个体编码串中以变异概率、随机指定的某一位或某几位仅因座上的值做变异运算。</p><p><strong>均匀变异（Uniform Mutation）</strong>：分别用符合某一范围内均匀分布的随机数，以某一较小的概率来替换个体编码串中各个基因座上的原有基因值。（特别适用于在算法的初级运行阶段）</p><p><strong>边界变异（Boundary Mutation）</strong>：随机的取基因座上的两个对应边界基因值之一去替代原有基因值。特别适用于最优点位于或接近于可行解的边界时的一类问题。</p><p><strong>非均匀变异</strong>：对原有的基因值做一随机扰动，以扰动后的结果作为变异后的新基因值。对每个基因座都以相同的概率进行变异运算之后，相当于整个解向量在解空间中作了一次轻微的变动。</p><p><strong>高斯近似变异</strong>：进行变异操作时用符号均值为Ｐ的平均值，方差为P**2的正态分布的一个随机数来替换原有的基因值。</p></blockquote><h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><p>初始的pop变量数据如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-12%2018.14.02.jpg" alt="初始时pop的值"></p><p>主函数代码：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">clc, clear;</span><br><span class="line">close all;</span><br><span class="line"><span class="comment">% 相关参数</span></span><br><span class="line">popsize=<span class="number">20</span>;     <span class="comment">% 群体大小</span></span><br><span class="line">chromlength=<span class="number">20</span>; <span class="comment">% 串的长度 每一列相当于是一个基因 个体基因序列个数</span></span><br><span class="line">pc=<span class="number">0.6</span>;        <span class="comment">% 交叉概率</span></span><br><span class="line">pm=<span class="number">0.1</span>;         <span class="comment">% 变异概率</span></span><br><span class="line">xlim = [<span class="number">0</span>,<span class="number">50</span>];  <span class="comment">% 解大概在的范围（提前就知道大概是在47-50之间了）</span></span><br><span class="line">G = <span class="number">100</span> ;       <span class="comment">% 迭代次数</span></span><br><span class="line">x = <span class="built_in">zeros</span>(<span class="number">1</span>, G);<span class="comment">% 用来绘制适应度曲线的x取值</span></span><br><span class="line">y = <span class="built_in">zeros</span>(<span class="number">1</span>, G);<span class="comment">% 同来绘制适应度曲线的y取值</span></span><br><span class="line"></span><br><span class="line">pop= <span class="built_in">round</span>(<span class="built_in">rand</span>(popsize,chromlength));  <span class="comment">% 随机产生初始群体(popsize行chromlength列的值为0或1的矩阵)</span></span><br><span class="line">decpop = bintodec(pop, popsize, chromlength, xlim); <span class="comment">% 计算初代解对应十进制序列</span></span><br><span class="line">fx = calobjvalue(decpop);               <span class="comment">% 计算初代解的函数值</span></span><br><span class="line">plotfig(decpop, fx, xlim, <span class="number">1</span>);           <span class="comment">% 绘制图像</span></span><br><span class="line">[y(<span class="number">1</span>) , l ]  = <span class="built_in">min</span>(fx);                 <span class="comment">% 给第一代的适应度赋值为第一代中适应度矩阵中最小的值</span></span><br><span class="line">x(<span class="number">1</span>) = decpop(l);                       <span class="comment">% 记录第一代适应度最小的值在矩阵中的索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 迭代 G - 1次（因为上面其实已经迭代了一次了）</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">2</span>  : G </span><br><span class="line"><span class="comment">% 上一代信息的计算</span></span><br><span class="line">    decpop =  bintodec( pop , popsize, chromlength,xlim ); <span class="comment">% 计算上一代解对应十进制</span></span><br><span class="line">    fx = calobjvalue(decpop);   <span class="comment">% 计算上一代解的函数值ֵ</span></span><br><span class="line">    fitvalue = calfitvalue(fx); <span class="comment">% 计算适应度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">% 产生新一代</span></span><br><span class="line">    newpop = copyx(pop,fitvalue,popsize);                 <span class="comment">% 选择</span></span><br><span class="line">    newpop = crossover(newpop, pc, popsize,chromlength ); <span class="comment">% 交叉</span></span><br><span class="line">    newpop = mutation(newpop,pm, popsize,chromlength);    <span class="comment">% 变异</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">% 这时的newpop是经过选择交叉变异产生的新一代了</span></span><br><span class="line">    <span class="comment">% 下边进行选择 择优保留（即实现保底机制）</span></span><br><span class="line">    newdecpop =  bintodec(newpop, popsize, chromlength, xlim); <span class="comment">% 计算新解对应十进制</span></span><br><span class="line">    new_fx = calobjvalue(newdecpop); <span class="comment">% 计算新解目标函数</span></span><br><span class="line">    new_fitvalue = calfitvalue(new_fx); <span class="comment">% 计算新群体中每个个体的适应度</span></span><br><span class="line">    index = <span class="built_in">find</span>(new_fitvalue &gt; fitvalue); <span class="comment">% 得到适应度变大的解的索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 更新新解</span></span><br><span class="line">    pop(index, :) = newpop(index,:); <span class="comment">% 更新得到最新解</span></span><br><span class="line">    decpop = bintodec(pop, popsize, chromlength,xlim); <span class="comment">% 计算新解的十进制</span></span><br><span class="line">    fx = calobjvalue(decpop); <span class="comment">% 计算结果</span></span><br><span class="line">    plotfig(decpop , fx, xlim, <span class="built_in">i</span>); <span class="comment">% 绘制新解的图</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">% 绘制适应度进化曲线</span></span><br><span class="line">    [bestindividual,bestindex] = <span class="built_in">max</span>(fx); <span class="comment">% 找出新解的最大适应度作为新解的适应度</span></span><br><span class="line">    y(<span class="built_in">i</span>) = bestindividual; <span class="comment">% 记录每一代的最优函数值，即最佳个体ֵ</span></span><br><span class="line">    x(<span class="built_in">i</span>) = decpop(bestindex); <span class="comment">% 十进制解</span></span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">plot</span>(<span class="number">1</span>:<span class="built_in">i</span>,y(<span class="number">1</span>:<span class="built_in">i</span>)); </span><br><span class="line">    title(<span class="string">&#x27;适应度进化曲线&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">% 得到迭代后最终的答案，然后在命令行中输出</span></span><br><span class="line">[ymax, max_index] = <span class="built_in">max</span>(y);</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;找的最优解位置为：&#x27;</span>, num2str(x(max_index))])</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">&#x27;对应最优解为：&#x27;</span>, num2str(ymax)])</span><br></pre></td></tr></table></figure><h2 id="整体代码"><a href="#整体代码" class="headerlink" title="整体代码"></a>整体代码</h2><p>可直接复制下面的代码，自己运行调试，更加有助于理解。</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%%主程序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GA_test_1</span><span class="params">()</span> </span></span><br><span class="line">    clc, clear;</span><br><span class="line">    close all;</span><br><span class="line">    <span class="comment">% 相关参数</span></span><br><span class="line">    popsize=<span class="number">20</span>;     <span class="comment">% 群体大小</span></span><br><span class="line">    chromlength=<span class="number">20</span>; <span class="comment">% 串的长度 每一列相当于是一个基因 个体基因序列个数</span></span><br><span class="line">    pc=<span class="number">0.6</span>;         <span class="comment">% 交叉概率</span></span><br><span class="line">    pm=<span class="number">0.1</span>;         <span class="comment">% 变异概率</span></span><br><span class="line">    xlim = [<span class="number">0</span>,<span class="number">50</span>];  <span class="comment">% 解大概在的范围（提前就知道大概是在47-50之间了）</span></span><br><span class="line">    G = <span class="number">100</span> ;       <span class="comment">% 迭代次数</span></span><br><span class="line">    x = <span class="built_in">zeros</span>(<span class="number">1</span>, G);</span><br><span class="line">    y = <span class="built_in">zeros</span>(<span class="number">1</span>, G);</span><br><span class="line">    </span><br><span class="line">    pop= <span class="built_in">round</span>(<span class="built_in">rand</span>(popsize,chromlength));  <span class="comment">% 随机产生初始群体(popsize行chromlength列的值为0或1的矩阵)</span></span><br><span class="line">    decpop = bintodec(pop, popsize, chromlength, xlim); <span class="comment">% 计算初代解对应十进制序列</span></span><br><span class="line">    fx = calobjvalue(decpop);               <span class="comment">% 计算初代解的函数值</span></span><br><span class="line">    plotfig(decpop, fx, xlim, <span class="number">1</span>);           <span class="comment">% 绘制图像</span></span><br><span class="line">    [y(<span class="number">1</span>) , l ]  = <span class="built_in">min</span>(fx);</span><br><span class="line">    x(<span class="number">1</span>) = decpop(l);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">2</span>  : G </span><br><span class="line">        decpop =  bintodec( pop , popsize, chromlength,xlim ) ; <span class="comment">% 计算上一代解对应十进制</span></span><br><span class="line">        fx = calobjvalue(decpop  ) ; <span class="comment">% 计算上一代解的函数值ֵ</span></span><br><span class="line">        fitvalue = calfitvalue(fx) ; <span class="comment">% 适应度映射</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">% 产生新一代</span></span><br><span class="line">        newpop = copyx(pop,fitvalue,popsize);                 <span class="comment">% 选择</span></span><br><span class="line">        newpop = crossover(newpop, pc, popsize,chromlength ); <span class="comment">% 交叉</span></span><br><span class="line">        newpop = mutation(newpop,pm, popsize,chromlength);    <span class="comment">% 变异</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">% 这时的newpop是经过复制交叉变异产生的新一代群体</span></span><br><span class="line">        <span class="comment">% 下边进行选择择优保留（即实现保底机制）</span></span><br><span class="line">        newdecpop =  bintodec(newpop ,popsize, chromlength,xlim ) ;</span><br><span class="line">        new_fx = calobjvalue(newdecpop) ; <span class="comment">%计算新解目标函数</span></span><br><span class="line">        new_fitvalue = calfitvalue(new_fx); <span class="comment">%计算新群体中每个个体的适应度</span></span><br><span class="line">        index = <span class="built_in">find</span>(new_fitvalue &gt; fitvalue) ; </span><br><span class="line">        </span><br><span class="line">        pop(index, :) = newpop(index,:) ; <span class="comment">% 更新得到最新解</span></span><br><span class="line">        decpop = bintodec( pop ,popsize, chromlength,xlim ) ; <span class="comment">%计算新解的十进制</span></span><br><span class="line">        fx = calobjvalue(decpop) ; <span class="comment">%计算结果</span></span><br><span class="line">        plotfig(decpop , fx, xlim, <span class="built_in">i</span>) <span class="comment">% 绘制新解的图</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">% 找出更新后的个体最优函数值ֵ</span></span><br><span class="line">        [bestindividual,bestindex] = <span class="built_in">max</span>(fx);</span><br><span class="line">        y(<span class="built_in">i</span>)=bestindividual;        <span class="comment">% 记录每一代的最优函数值ֵ</span></span><br><span class="line">        x(<span class="built_in">i</span>)= decpop(bestindex) ;   <span class="comment">% 十进制解</span></span><br><span class="line">        subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">plot</span>(<span class="number">1</span>:<span class="built_in">i</span>,y(<span class="number">1</span>:<span class="built_in">i</span>)); </span><br><span class="line">        title(<span class="string">&#x27;适应度进化曲线&#x27;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    [ymax, max_index] = <span class="built_in">max</span>(y);</span><br><span class="line">    <span class="built_in">disp</span>([<span class="string">&#x27;找的最优解位置为：&#x27;</span>, num2str(x(max_index))])</span><br><span class="line">    <span class="built_in">disp</span>([<span class="string">&#x27;对应最优解为：&#x27;</span>, num2str(ymax)])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 计算适应度</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fitvalue</span> = <span class="title">calfitvalue</span><span class="params">(fx)</span></span></span><br><span class="line">    fitvalue = fx ; </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 选择操作</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newx</span> = <span class="title">copyx</span><span class="params">(pop, fitvalue,popsize )</span> %传进来二进制串和对应适应度</span></span><br><span class="line">    newx = pop; <span class="comment">%只是起到申请一个size为pop大小空间的作用，newx之后要更新的</span></span><br><span class="line">    <span class="built_in">i</span> = <span class="number">1</span>;  <span class="built_in">j</span> = <span class="number">1</span>;</span><br><span class="line">    p = fitvalue / sum(fitvalue) ; </span><br><span class="line">    Cs = cumsum(p) ; </span><br><span class="line">    R = <span class="built_in">sort</span>(<span class="built_in">rand</span>(popsize,<span class="number">1</span>)) ; <span class="comment">%每个个体的复制概率</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">j</span> &lt;= popsize </span><br><span class="line">        <span class="keyword">if</span> R(<span class="built_in">j</span>) &lt; Cs(<span class="built_in">i</span>)</span><br><span class="line">            newx(<span class="built_in">j</span>,:) = pop(<span class="built_in">i</span>,:) ;</span><br><span class="line">            <span class="built_in">j</span> = <span class="built_in">j</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">i</span> = <span class="built_in">i</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 交叉操作</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newx</span> = <span class="title">crossover</span><span class="params">(pop, pc, popsize,chromlength )</span></span></span><br><span class="line">    <span class="comment">% 12 34 56交叉方式，随机选择交叉位点</span></span><br><span class="line">    <span class="comment">% 注意个体数为奇数偶数的区别</span></span><br><span class="line">    <span class="built_in">i</span> = <span class="number">2</span> ;</span><br><span class="line">    newx = pop ; <span class="comment">%申请空间</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">i</span> + <span class="number">2</span> &lt;= popsize</span><br><span class="line">        <span class="comment">%将第i 与 第 i -1 进行随机位点交叉</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">rand</span> &lt; pc</span><br><span class="line">            x1 = pop(<span class="built_in">i</span><span class="number">-1</span>, :);</span><br><span class="line">            x2 = pop(<span class="built_in">i</span>, :); </span><br><span class="line">            r = randperm(chromlength, <span class="number">2</span>); <span class="comment">%返回范围内两个整数</span></span><br><span class="line">            r1 = <span class="built_in">min</span>(r); r2 = <span class="built_in">max</span>(r); <span class="comment">% 交叉复制的位点</span></span><br><span class="line">            newx(<span class="built_in">i</span><span class="number">-1</span>, :) = [x1(<span class="number">1</span>:r1<span class="number">-1</span>), x2(r1:r2), x1(r2+<span class="number">1</span>:<span class="keyword">end</span>)];</span><br><span class="line">            newx(<span class="built_in">i</span>, :) = [x2(<span class="number">1</span>:r1<span class="number">-1</span>), x1(r1:r2), x2(r2+<span class="number">1</span>:<span class="keyword">end</span>)];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">i</span> = <span class="built_in">i</span> + <span class="number">2</span>; <span class="comment">%更新i</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 变异</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newx</span> = <span class="title">mutation</span><span class="params">(pop, pm, popsize, chromlength)</span></span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : popsize</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">rand</span> &lt; pm</span><br><span class="line">            r = randperm(chromlength, <span class="number">1</span>); </span><br><span class="line">            pop(<span class="built_in">i</span>, r) = ~pop(<span class="built_in">i</span>, r);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    newx = pop; <span class="comment">%将变异后的结果返回。</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%  二进制转十进制函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dec</span> = <span class="title">bintodec</span><span class="params">(pop, popsize, chromlength, xlim)</span></span></span><br><span class="line">    dec = <span class="built_in">zeros</span>(<span class="number">1</span>, chromlength); <span class="comment">% 生成 1 行 chromlength列的全零矩阵</span></span><br><span class="line">    index = chromlength<span class="number">-1</span>:<span class="number">-1</span>:<span class="number">0</span>;  <span class="comment">% 生成一个一行20列的矩阵，数据是19 18 17 ... 3 2 1</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : popsize          <span class="comment">% 对所有个体解码</span></span><br><span class="line">        dec(<span class="built_in">i</span>) = sum(pop(<span class="built_in">i</span>, :).*(<span class="number">2.</span>^index));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    dec = xlim(<span class="number">1</span>) + dec*(xlim(<span class="number">2</span>) -  xlim(<span class="number">1</span>)) / (<span class="number">2</span>^chromlength<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%  绘制图像</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">plotfig</span><span class="params">(decpop , fx ,xlim,k)</span> </span></span><br><span class="line">    f = @(x) <span class="built_in">abs</span>(x .* <span class="built_in">sin</span>(x) .* <span class="built_in">cos</span>(<span class="number">2</span> * x) - <span class="number">2</span> * x .* <span class="built_in">sin</span>(<span class="number">3</span> * x) +<span class="number">3</span> * x .* <span class="built_in">sin</span>(<span class="number">4</span> * x)); <span class="comment">% 问题函数</span></span><br><span class="line">    x = xlim(<span class="number">1</span>):<span class="number">0.05</span>:xlim(<span class="number">2</span>);</span><br><span class="line">    y = f(x) ; </span><br><span class="line">    subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">plot</span>(x, y, decpop, fx, <span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">    title([<span class="string">&#x27;第&#x27;</span>, num2str(k), <span class="string">&#x27;次迭代进化&#x27;</span>])</span><br><span class="line">    pause(<span class="number">0.2</span>) <span class="comment">% 停顿两秒</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">%% 目标函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fx</span> = <span class="title">calobjvalue</span><span class="params">(decpop)</span> %参数为十进制解</span></span><br><span class="line">    f = @(x) <span class="built_in">abs</span>(x .* <span class="built_in">sin</span>(x) .* <span class="built_in">cos</span>(<span class="number">2</span> * x) - <span class="number">2</span> * x .* <span class="built_in">sin</span>(<span class="number">3</span> * x) +<span class="number">3</span> * x .* <span class="built_in">sin</span>(<span class="number">4</span> * x)); <span class="comment">% 问题函数 </span></span><br><span class="line">    fx = f(decpop);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> 优化类 </category>
          
          <category> 现代优化算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 优化类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动词语气</title>
      <link href="/posts/2529807823.html"/>
      <url>/posts/2529807823.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>Day 2 啦，今天学算法学久啦，语法只能少学一会儿啦</p><p>首先先复习昨天的英语语法。</p><ol><li>谓语动词的分类（五类）</li><li>五种基本句型</li><li>十大词性（词类）</li><li>谓语动词三大本领</li><li>八种句子成分</li><li>复杂句</li><li>助动词</li><li>非谓语动词</li><li>十六种动词时态</li></ol></blockquote><h1 id="动词语气"><a href="#动词语气" class="headerlink" title="动词语气"></a>动词语气</h1><p>动词语气 $\neq$ 说话语气 </p><p>疑问语气、感叹语气、条件语气暂时不讨论。</p><h2 id="陈述语气"><a href="#陈述语气" class="headerlink" title="陈述语气"></a>陈述语气</h2><p>描述现实的语气。</p><p>一般构成其实就是一般状态的语句。</p><h2 id="祁使语气"><a href="#祁使语气" class="headerlink" title="祁使语气"></a>祁使语气</h2><p>描述命令或请求的语气。</p><p>Rabbit, eat the carrot!</p><p>构成方式：</p><pre><code> 技巧：将命令/请求 用第二人称(&quot;你&quot;)用一般现在时态表达；然后去掉“你”，并保证动词原形。</code></pre><p>举例：</p><p>You eat the carrot!   ==&gt;  Eat the carrot!</p><p>You don’t eat it!       ==&gt;  Don’t eat it!</p><p>You are quiet!          ==&gt;  Be quiet!</p><h2 id="虚拟语气"><a href="#虚拟语气" class="headerlink" title="虚拟语气"></a>虚拟语气</h2><p>基本都用在从句中，且基本都是条件句中。</p><p>描述</p><ul><li><p>第一大用法：对不可能或概率很小事件的假设</p><ol><li><p>和<strong>现在</strong>现实相反的情况，自己脑子希望的情况。这种基本就是没有实现的可能性的事情。</p><p> 构成方式：将谓语动词改成过去式。</p><p> 举例：If I saw the rabbit now, I would bite him.</p></li><li><p>和<strong>将来</strong>事实相反且可能性很小的事情，表示万一怎么样，就怎么样的意思。</p><p> 一般是条件语句</p><p> 举例：If I should see the rabbit tomorrow, I would bite him.</p></li><li><p>和过去事实相反。表示后悔的意思。</p><p> 构成方式：将谓语动词改成过去完成时态（第一种中和现在现实相反的情况是将谓语动词改成过去式）</p><p> 举例：If I had seen the rabbit a few days ago, I would have bitten him.</p><p>总结：</p></li></ol><ul><li><p>与现在相反：</p><p>  条件句：过去式</p><p>  主句：would + 动词原形</p></li><li><p>与将来相反：真的不可能或可能性很小。</p><p>  条件句：should + 动词原形</p><p>  主句：would + 动词原形</p><p>  举例：If I should meet thee after long years, how should I greet thee?</p></li><li><p>与过去相反：通常有一点后悔的意思在里面</p><p>  条件句：had + 动词过去分词</p><p>  主句：would have + 动词过去分词</p><p>  举例：If I had watched this video before, I would have aced my test.</p></li></ul></li><li><p>第二大用法：表达愿望，请求，建议，命令等。希望某个动作/事件发生</p><p>  这里其实就是上面一种的前面加wish。wish表示希望不太可能实现，和hope不一样，hope比较中性，能实现又不能实现的感觉，不极端。</p><p>  当然，除了wish这个词也可以用其他词来代替，例如：</p><p>  would rather宁愿：I would rather that you hadn’t eaten the carrot.我宁愿你没有吃掉那根胡萝卜（意思是过去就已经吃掉了）</p><p>  deman, suggest, insist, order… + should + 动词原形：I demand that you should give me a carrot.</p><ol><li><p>对<strong>现在</strong>的愿望：wish + 动词过去式</p><p> I wish (that) I were a rabbit. 我希望我是只兔子。</p></li><li><p>对<strong>过去</strong>的愿望：wish + had/would have + 动词过去分词</p><p> I wish (that) I had eaten the carrot. 我希望我吃了那只胡萝卜。（后悔过去没有吃）</p></li><li><p>对<strong>将来</strong>的愿望：但是是那种可能性比较小的希望。</p><p> wish + would/might/could/should + 动词原形</p><p> I wish (that) I could eat the carrot.</p></li></ol></li></ul><h1 id="总结和复习"><a href="#总结和复习" class="headerlink" title="总结和复习"></a>总结和复习</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-08%2011.18.30.jpg" alt="语气总结"></p><p>复习内容：</p><ol><li>陈述语句，祁使语句的作用和基本构成</li><li>虚拟语句的作用，<strong>怎么用</strong>（两大用法），一般描述什么样的事情</li><li>虚拟语气在两大用法下的现在，过去，将来的表达的<strong>构成方式</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> 英语学习 </category>
          
          <category> 英语语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 英语语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成树</title>
      <link href="/posts/1925125395.html"/>
      <url>/posts/1925125395.html</url>
      
        <content type="html"><![CDATA[<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>一个连通图的<strong>生成树</strong>是一个极小连通子图，其含有<strong>图中的全部顶点</strong>，和<strong>构成一颗树</strong>的（n-1）条边。</p><p>所以生成树的要求是：</p><ol><li><p>连通图的连通子图</p></li><li><p>n个顶点</p></li><li><p>n-1个边</p></li></ol><hr><p>==图的所有生成树中具有边上的权值之和最小的树称为图的<strong>最小生成树</strong>==</p><p>所以构造最小生成树的准则：</p><ol><li>必须只使用该图中的边来构造最小生成树</li><li>必须使用且仅只使用（n-1）条边来连接图中的n个顶点</li><li>不能使用产生回路的边</li></ol><p>城市之间的交通工程造价最优问题，就是典型的最小生成树应用。</p><p>求图的最小生成树的两个算法：</p><ul><li><p>普利姆（Prim）算法</p><ul><li>朴素版Prim算法——适用于稠密图 $O(n^2)$——适合用邻接矩阵实现，用链式向前星很麻烦</li><li>堆优化版Prim算法 ——一般不常用$O(mlogn)$</li></ul></li><li><p>克鲁斯卡尔（Kruskal）算法——使用与稀疏图 $O(mlogm)$</p></li></ul><blockquote><p>普利姆算法重点是选点；克鲁斯卡尔算法重点是选边。</p></blockquote><h2 id="普利姆（Prim）算法"><a href="#普利姆（Prim）算法" class="headerlink" title="普利姆（Prim）算法"></a>普利姆（Prim）算法</h2><p>假设<code>G=(V,E)</code>是一个具有<code>n</code>个顶点的带权连通图，<code>T=(U,TE)</code>是<code>G</code>的最小生成树，其中<code>U</code>是<code>T</code>的顶点集，<code>TE</code>是<code>T</code>的边集，则由<code>G</code>构造从起始点<code>v</code>出发的最小生成树<code>T</code>的步骤如下：</p><ol><li>初始化<code>U=&#123;v&#125;</code>，以<code>v</code>到其他顶点的所有边为候选边。</li><li>重复一下两步骤（n-1）次，使得其他（n-1）个顶点被加入到<code>U</code>中。<ol><li>从候选边中挑选权值最小的的边加入<code>TE</code>，设该边在<code>V-U</code>中的顶点是<code>k</code>，讲<code>k</code>加入<code>U</code>中；</li><li>考察当前<code>V-U</code>中的所有顶点<code>j</code>，修改候选边，若<code>(k, j)</code>的权值小于原来和顶点<code>j</code>关联的候选边，则用<code>(k ,j)</code>取代后者作为侯选边。</li></ol></li></ol><p>Prim是一种增量算法，一步步地选择最小边，并在<code>U</code>集合中添加相应的顶点。</p><blockquote><p>注意，不一定是链式的。要计算非生成树的结点倒生成树结点中的最小距离（有边就都要遍历维护最小值）。书中的例子是特例。</p></blockquote><h3 id="普通邻接表实现"><a href="#普通邻接表实现" class="headerlink" title="普通邻接表实现"></a>普通邻接表实现</h3><p>这里是利用类似于dfs套bfs的感觉。通过遍历每一个节点的链表，链表上的点就可能是将要走的点。寻找没有走过，且边权最小的点为下一个个节点。</p><h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> st[MaxV];<span class="comment">// 判断点是否被遍历过</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prim</span><span class="params">(AdjGraph* G)</span> </span>&#123;<span class="comment">// 遍历图</span></span><br><span class="line"><span class="type">int</span> MIN = INF;</span><br><span class="line">ArcNode *p, *min;<span class="comment">// p为当前结点，min为边权最小的结点</span></span><br><span class="line"><span class="type">int</span> father;<span class="comment">// 下一个结点的父结点</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;<span class="comment">// 遍历图每一个结点</span></span><br><span class="line"><span class="keyword">if</span> (st[i]) &#123;<span class="comment">// 只要在生成树（遍历过且需要）的结点</span></span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;<span class="comment">// 遍历这些结点的下一个结点，并维护最小值</span></span><br><span class="line"><span class="keyword">if</span> (!st[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;weight &lt; MIN) &#123;</span><br><span class="line">min = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line">MIN = p-&gt;weight;</span><br><span class="line">min = p;</span><br><span class="line">father = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (st[min-&gt;adjvex] || min -&gt;adjvex &gt; G-&gt;n) <span class="keyword">return</span>;<span class="comment">// 生成结束的条件</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot; -(&quot;</span> &lt;&lt; father &lt;&lt; <span class="string">&quot;)-&gt; &quot;</span> &lt;&lt; min-&gt;adjvex;</span><br><span class="line">st[min-&gt;adjvex] = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Prim</span>(G);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxV 1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF INT_MAX</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> string infoType; <span class="comment">// 存储信息的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">ANode</span> &#123;<span class="comment">// 边节点 </span></span><br><span class="line"><span class="type">int</span> adjvex;<span class="comment">// 该边的邻接点编号</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ANode</span>* nextarc;<span class="comment">// 指向下一条边的指针</span></span><br><span class="line"><span class="type">int</span> weight;<span class="comment">// 该边的权重 </span></span><br><span class="line">&#125; ArcNode;<span class="comment">// 边节点的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;<span class="comment">// 头节点 </span></span><br><span class="line">infoType info;<span class="comment">// 顶点的其他信息 </span></span><br><span class="line">ArcNode* firstarc;<span class="comment">// 指向第一个边的指针 </span></span><br><span class="line">&#125; VNode; <span class="comment">// 邻接表头节点类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">VNode adjlist[MaxV];<span class="comment">// 邻接表头结点数组</span></span><br><span class="line"><span class="type">int</span> n, e;<span class="comment">// 图中的顶点数n, 边数e </span></span><br><span class="line">&#125; AdjGraph;<span class="comment">// 完整的图邻接表类型 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的创建</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateAdj</span><span class="params">(AdjGraph*&amp; G,<span class="type">int</span> A[MaxV][MaxV], <span class="type">int</span> n, <span class="type">int</span> e)</span> </span>&#123;</span><br><span class="line">ArcNode *p;</span><br><span class="line">G = (AdjGraph*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(AdjGraph));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">G-&gt;adjlist[i].firstarc = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = n<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line"><span class="keyword">if</span> (A[i][j] != <span class="number">0</span> &amp;&amp; A[i][j] != INF) &#123;<span class="comment">// 存在一条边 </span></span><br><span class="line"><span class="comment">// 申请内存 </span></span><br><span class="line">p = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line"><span class="comment">// 存储信息 </span></span><br><span class="line">p-&gt;adjvex = j;</span><br><span class="line">p-&gt;weight = A[i][j];</span><br><span class="line"><span class="comment">// 头插法插入节点 </span></span><br><span class="line">p-&gt;nextarc = G-&gt;adjlist[i].firstarc;</span><br><span class="line">G-&gt;adjlist[i].firstarc = p;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">G-&gt;n = n;</span><br><span class="line">G-&gt;e = e; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的遍历输出</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispAdj</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; :&quot;</span>;</span><br><span class="line"><span class="comment">// 遍历链表 </span></span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">cout &lt;&lt; p-&gt;adjvex &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; p-&gt;weight &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">p = p-&gt;nextarc; </span><br><span class="line">&#125; </span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyAdj</span><span class="params">(AdjGraph*&amp; G)</span> </span>&#123;</span><br><span class="line">ArcNode* pre, *p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">pre = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">if</span> (pre != <span class="literal">NULL</span>) &#123;</span><br><span class="line">p = pre-&gt;nextarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">pre = p;</span><br><span class="line">p=p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(G);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> st[MaxV];<span class="comment">// 判断点是否被遍历过</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prim</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> MIN = INF;</span><br><span class="line">ArcNode *p, *min;</span><br><span class="line"><span class="type">int</span> m;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (st[i]) &#123;</span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;weight &lt; MIN) &#123;</span><br><span class="line">min = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line">MIN = p-&gt;weight;</span><br><span class="line">min = p;</span><br><span class="line">m = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (st[min-&gt;adjvex] || min -&gt;adjvex &gt; G-&gt;n) <span class="keyword">return</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot; -(&quot;</span> &lt;&lt; m &lt;&lt; <span class="string">&quot;)-&gt; &quot;</span> &lt;&lt; min-&gt;adjvex;</span><br><span class="line">st[min-&gt;adjvex] = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">Prim</span>(G);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 《数据结构教程》中的图 </span></span><br><span class="line"><span class="type">int</span> A[][MaxV] = &#123;</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">28</span>,INF,INF,INF,<span class="number">10</span>,INF&#125;,</span><br><span class="line">&#123;<span class="number">28</span>,<span class="number">0</span>,<span class="number">16</span>,INF,INF,INF,<span class="number">14</span>&#125;,</span><br><span class="line">&#123;INF,<span class="number">16</span>,<span class="number">0</span>,<span class="number">12</span>,INF,INF,INF&#125;,</span><br><span class="line">&#123;INF,INF,<span class="number">12</span>,<span class="number">0</span>,<span class="number">22</span>,INF,<span class="number">18</span>&#125;,</span><br><span class="line">&#123;INF,INF,INF,<span class="number">22</span>,<span class="number">0</span>,<span class="number">25</span>,<span class="number">24</span>&#125;,</span><br><span class="line">&#123;<span class="number">10</span>,INF,INF,INF,<span class="number">25</span>,<span class="number">0</span>,INF&#125;,</span><br><span class="line">&#123;INF,<span class="number">14</span>,INF,<span class="number">18</span>,<span class="number">24</span>,INF,<span class="number">0</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line">AdjGraph* G;</span><br><span class="line"><span class="built_in">CreateAdj</span>(G, A, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"><span class="built_in">DispAdj</span>(G);</span><br><span class="line">st[<span class="number">0</span>] = <span class="literal">true</span>; <span class="comment">// 以 0 为起点</span></span><br><span class="line">cout &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="built_in">Prim</span>(G);</span><br><span class="line"><span class="built_in">DestroyAdj</span>(G);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="邻接矩阵实现"><a href="#邻接矩阵实现" class="headerlink" title="邻接矩阵实现"></a>邻接矩阵实现</h3><h4 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n;      <span class="comment">// n表示图中的结点数</span></span><br><span class="line"><span class="type">int</span> g[N][N];        <span class="comment">// 邻接矩阵，存储所有边</span></span><br><span class="line"><span class="type">int</span> dist[N];        <span class="comment">// 存储其他点到当前最小生成树的距离</span></span><br><span class="line"><span class="type">bool</span> st[N];    <span class="comment">// 存储每个点是否已经在生成树中(即生成树集合)</span></span><br></pre></td></tr></table></figure><h4 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, INF, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        遍历找集合外，距离集合内的点最近的点(用t记录编号)</span><br><span class="line">        st[t] = <span class="literal">true</span>;<span class="comment">// 添加倒集合中</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="核心代码-1"><a href="#核心代码-1" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果图不连通，则返回INF, 否则返回最小生成树的树边权重之和</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prim</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, INF, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 先选择起点，并初始化</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) dist[j] = <span class="built_in">min</span>(dist[j], g[v][j]);</span><br><span class="line">    cout &lt;&lt; v &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line">    st[v] = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; (t == <span class="number">-1</span> || dist[t] &gt; dist[j]))</span><br><span class="line">                t = j;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; t &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line">        st[t] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) dist[j] = <span class="built_in">min</span>(dist[j], g[t][j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n = <span class="number">7</span>;      <span class="comment">// n表示点数     </span></span><br><span class="line"><span class="type">int</span> g[][N]=&#123; <span class="comment">// 邻接矩阵，存储所有边，和书中的图一样</span></span><br><span class="line">&#123;INF,<span class="number">28</span>,INF,INF,INF,<span class="number">10</span>,INF&#125;,</span><br><span class="line">&#123;<span class="number">28</span>,INF,<span class="number">16</span>,INF,INF,INF,<span class="number">14</span>&#125;,</span><br><span class="line">&#123;INF,<span class="number">16</span>,INF,<span class="number">12</span>,INF,INF,INF&#125;,</span><br><span class="line">&#123;INF,INF,<span class="number">12</span>,INF,<span class="number">22</span>,INF,<span class="number">18</span>&#125;,</span><br><span class="line">&#123;INF,INF,INF,<span class="number">22</span>,INF,<span class="number">25</span>,<span class="number">24</span>&#125;,</span><br><span class="line">&#123;<span class="number">10</span>,INF,INF,INF,<span class="number">25</span>,INF,INF&#125;,</span><br><span class="line">&#123;INF,<span class="number">14</span>,INF,<span class="number">18</span>,<span class="number">24</span>,INF,INF&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> dist[N];        <span class="comment">// 存储其他点到当前最小生成树的距离</span></span><br><span class="line"><span class="type">bool</span> st[N];    <span class="comment">// 存储每个点是否已经在生成树中(即生成树集合)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果图不连通，则返回INF, 否则返回最小生成树的树边权重之和</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prim</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dist, INF, <span class="built_in">sizeof</span>(dist));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 先选择起点，并初始化</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) dist[j] = <span class="built_in">min</span>(dist[j], g[v][j]);</span><br><span class="line">    cout &lt;&lt; v &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line">    st[v] = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j)</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; (t == <span class="number">-1</span> || dist[t] &gt; dist[j]))</span><br><span class="line">                t = j;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; t &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line">        st[t] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) dist[j] = <span class="built_in">min</span>(dist[j], g[t][j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">n = <span class="number">7</span>;</span><br><span class="line"><span class="built_in">prim</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="邻接矩阵实现——教材"><a href="#邻接矩阵实现——教材" class="headerlink" title="邻接矩阵实现——教材"></a>邻接矩阵实现——教材</h3><h4 id="核心代码-2"><a href="#核心代码-2" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prim</span><span class="params">(MatGraph g, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> lowcost[MAXV];<span class="comment">// U集合</span></span><br><span class="line"><span class="type">int</span> min;<span class="comment">// 当前的最小值 </span></span><br><span class="line"><span class="type">int</span> closest[MAXV];<span class="comment">// 对于非集合的点(点的编号就是下标)到集合中最近的点</span></span><br><span class="line"><span class="type">int</span> k; <span class="comment">// k 是最近的点（下一个点） </span></span><br><span class="line"><span class="comment">// 初始化 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i) &#123;</span><br><span class="line">lowcost[i] = g.edges[v][i];<span class="comment">// 距离都是图中v点到下一个点的边权 </span></span><br><span class="line">closest[i] = v;<span class="comment">// 最近的点都是自己 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; g.n; ++i) &#123;        <span class="comment">// 找出n-1个顶点，其实就是while (g.n-- &gt; 1)的感觉，i除了表示找了几个点以外没有用 </span></span><br><span class="line">min = INF;<span class="comment">// 每次都先将 min 置为最大 </span></span><br><span class="line"><span class="comment">// 在(V-U)中找出离 U 最近的顶点 k , 即寻找下一个结点 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j) </span><br><span class="line"><span class="comment">// lowcost == 0表示点为自己或边权已被使用（已经是集合中的点了）。如果边权比最小的小就改变 k </span></span><br><span class="line"><span class="keyword">if</span> (lowcost[j] != <span class="number">0</span> &amp;&amp; lowcost[j] &lt; min) &#123;</span><br><span class="line">min = lowcost[j];</span><br><span class="line">k = j; <span class="comment">// k 记录最近顶点的编号</span></span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot; -(&quot;</span> &lt;&lt; closest[k] &lt;&lt; <span class="string">&quot;)-&quot;</span> &lt;&lt; min &lt;&lt; <span class="string">&quot;&gt; &quot;</span> &lt;&lt; k;<span class="comment">// 格式为 ： -(从xx点)-边权-&gt; 到达的点 </span></span><br><span class="line">lowcost[k] = <span class="number">0</span>;         <span class="comment">//标记k已经加入U</span></span><br><span class="line"><span class="comment">//修改数组lowcost和closest,这里的代码思想和上面初始化一样，初始化是v点到下一个点，这里就是k点到下一个点 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line"><span class="keyword">if</span> (g.edges[k][j] != <span class="number">0</span> &amp;&amp; g.edges[k][j] &lt; lowcost[j]) &#123;</span><br><span class="line">lowcost[j] = g.edges[k][j];<span class="comment">// 将lowcost数组更新为k点到下一个点的边权</span></span><br><span class="line">closest[j] = k;<span class="comment">// 默认最近点为自己 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完整代码-2"><a href="#完整代码-2" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//图的两种存储结构</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f<span class="comment">//定义INF</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>MAXV 1000<span class="comment">//最大顶点个数</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> InfoType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></span><br><span class="line">&#123;<span class="type">int</span> no;<span class="comment">//顶点编号</span></span><br><span class="line">InfoType info;<span class="comment">//顶点其他信息</span></span><br><span class="line">&#125; VertexType;<span class="comment">//顶点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></span><br><span class="line">&#123;<span class="type">int</span> edges[MAXV][MAXV];<span class="comment">//邻接矩阵数组</span></span><br><span class="line"><span class="type">int</span> n,e;<span class="comment">//顶点数，边数</span></span><br><span class="line">VertexType vexs[MAXV];<span class="comment">//存放顶点信息</span></span><br><span class="line">&#125; MatGraph;<span class="comment">//完整的图邻接矩阵类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateMat</span><span class="params">(MatGraph &amp;g,<span class="type">int</span> A[MAXV][MAXV],<span class="type">int</span> n,<span class="type">int</span> e)</span> </span>&#123; <span class="comment">//创建图的邻接矩阵</span></span><br><span class="line">g.n=n; g.e=e;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line">g.edges[i][j] = A[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispMat</span><span class="params">(MatGraph g)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line"><span class="keyword">if</span> (g.edges[i][j]!=INF)</span><br><span class="line">cout &lt;&lt; g.edges[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;INF &quot;</span>;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prim</span><span class="params">(MatGraph g, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> lowcost[MAXV];<span class="comment">// U集合</span></span><br><span class="line"><span class="type">int</span> min;<span class="comment">// 当前的最小值 </span></span><br><span class="line"><span class="type">int</span> closest[MAXV];<span class="comment">// 对于非集合的点(点的编号就是下标)到集合中最近的点</span></span><br><span class="line"><span class="type">int</span> k; <span class="comment">// k 是最近的点（下一个点） </span></span><br><span class="line"><span class="comment">// 初始化 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i) &#123;</span><br><span class="line">lowcost[i] = g.edges[v][i];<span class="comment">// 距离都是图中v点到下一个点的边权 </span></span><br><span class="line">closest[i] = v;<span class="comment">// 最近的点都是自己 </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; g.n; ++i) &#123;        <span class="comment">// 找出n-1个顶点，其实就是while (g.n-- &gt; 1)的感觉，i除了表示找了几个点意外没有用 </span></span><br><span class="line">min = INF;<span class="comment">// 每次都先将 min 置为最大 </span></span><br><span class="line"><span class="comment">// 在(V-U)中找出离 U 最近的顶点 k , 即寻找下一个结点 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j) </span><br><span class="line"><span class="comment">// lowcost == 0表示点为自己或边权已被使用（已经是集合中的点了）。如果边权比最小的小就改变 k </span></span><br><span class="line"><span class="keyword">if</span> (lowcost[j] != <span class="number">0</span> &amp;&amp; lowcost[j] &lt; min) &#123;</span><br><span class="line">min = lowcost[j];</span><br><span class="line">k = j; <span class="comment">// k 记录最近顶点的编号</span></span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot; -(&quot;</span> &lt;&lt; closest[k] &lt;&lt; <span class="string">&quot;)-&quot;</span> &lt;&lt; min &lt;&lt; <span class="string">&quot;&gt; &quot;</span> &lt;&lt; k;<span class="comment">// 格式为 ： -(从xx点)-边权-&gt; 到达的点 </span></span><br><span class="line">lowcost[k] = <span class="number">0</span>;         <span class="comment">//标记k已经加入U</span></span><br><span class="line"><span class="comment">//修改数组lowcost和closest,这里的代码思想和上面初始化一样，初始化是v点到下一个点，这里就是k点到下一个点 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line"><span class="keyword">if</span> (g.edges[k][j] != <span class="number">0</span> &amp;&amp; g.edges[k][j] &lt; lowcost[j]) &#123;</span><br><span class="line">lowcost[j] = g.edges[k][j];<span class="comment">// 将lowcost数组更新为k点到下一个点的边权</span></span><br><span class="line">closest[j] = k;<span class="comment">// 默认最近点为自己 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">MatGraph g;</span><br><span class="line"><span class="type">int</span> A[MAXV][MAXV]=&#123;</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">28</span>,INF,INF,INF,<span class="number">10</span>,INF&#125;,</span><br><span class="line">&#123;<span class="number">28</span>,<span class="number">0</span>,<span class="number">16</span>,INF,INF,INF,<span class="number">14</span>&#125;,</span><br><span class="line">&#123;INF,<span class="number">16</span>,<span class="number">0</span>,<span class="number">12</span>,INF,INF,INF&#125;,</span><br><span class="line">&#123;INF,INF,<span class="number">12</span>,<span class="number">0</span>,<span class="number">22</span>,INF,<span class="number">18</span>&#125;,</span><br><span class="line">&#123;INF,INF,INF,<span class="number">22</span>,<span class="number">0</span>,<span class="number">25</span>,<span class="number">24</span>&#125;,</span><br><span class="line">&#123;<span class="number">10</span>,INF,INF,INF,<span class="number">25</span>,<span class="number">0</span>,INF&#125;,</span><br><span class="line">&#123;INF,<span class="number">14</span>,INF,<span class="number">18</span>,<span class="number">24</span>,INF,<span class="number">0</span>&#125;&#125;;</span><br><span class="line"><span class="built_in">CreateMat</span>(g, A, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"><span class="built_in">DispMat</span>(g);</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;0&quot;</span>;</span><br><span class="line"><span class="built_in">Prim</span>(g,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="克鲁斯卡尔（Kruskal）算法"><a href="#克鲁斯卡尔（Kruskal）算法" class="headerlink" title="克鲁斯卡尔（Kruskal）算法"></a>克鲁斯卡尔（Kruskal）算法</h2><p>克鲁斯卡尔算法是一种<strong>按权值的递增次序选择</strong>合适的边来构造最小生成树的方法。</p><p>假设 <code>G = (V, E)</code> 是一个具有 <code>n</code> 个顶点的带权联通无向图， <code>T = (U, TE)</code> 是 <code>G</code> 的最小生成树，则钩爪最小生成树的步骤如下：</p><ol><li>置 <code>U</code> 的初始值为 <code>V</code> （即包含有 <code>G</code> 中的全部顶点），<code>TE</code> 的初始为空集（即图中的每一个顶点都构成一个分量）。</li><li>将图 <code>G</code> 中的边按权值从小到大的顺序依次选取，若选取的边未使生成树 <code>T</code> 形成回路，则加入 <code>TE</code> ，否则舍弃，直到 <code>TE</code> 中包含 <code>n-1</code> 边为止。</li></ol><h3 id="邻接矩阵实现——教材-1"><a href="#邻接矩阵实现——教材-1" class="headerlink" title="邻接矩阵实现——教材"></a>邻接矩阵实现——教材</h3><h4 id="核心代码-3"><a href="#核心代码-3" class="headerlink" title="核心代码"></a>核心代码</h4><blockquote><ol><li>定义一个表示边的结构体。这样方便统计边的前后结点。而且注意：<strong>Kruskal算法关注边</strong>。</li><li>定义一个排序函数（或者在构造结构体时，顺便实现排序方式，这样就可以使用<code>sort()</code>）</li><li>定义<code>Kruskal</code>函数。函数首先根据参数 <code>g</code> 创建边的集合，即 <code>E</code>。创建好集合后，排序。这样操作之后，E数组就是排好序的边了。现在只需要挨个从小到达遍历这些边是否符合条件就行。</li><li>定义一个辅助函数。这个函数的下标 <code>i</code> 记录结点 <code>i</code> 的种类。初始时赋值为 <code>i</code> 即所有结点的种类都是单独的。当两个或多个结点的种类为同一个时，则这些点被连接起来了，也就是在同一颗最小生成树上了。</li><li>判断符合条件——是否构成回路。如果两个端点在一个集合中，即已经渲染为同类了，就是一个回路，如果不是同类，就使用该边。并且需要将两个端点所在的子生成树的<strong>所有结点</strong>都改成同一个，表示渲染成同一类。</li></ol></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kruskal算法需要的结构体 </span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> u;<span class="comment">// 边的起始顶点</span></span><br><span class="line"><span class="type">int</span> v;<span class="comment">// 边的终止顶点</span></span><br><span class="line"><span class="type">int</span> w;<span class="comment">// 边的权值 </span></span><br><span class="line">&#125; Edge;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort</span><span class="params">(Edge E[],<span class="type">int</span> n)</span> </span>&#123; <span class="comment">//对E[0..n-1]按递增有序进行直接插入排序</span></span><br><span class="line">Edge temp;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i) </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; n; ++j) </span><br><span class="line"><span class="keyword">if</span> (E[i].w &gt; E[j].w) &#123;</span><br><span class="line">temp = E[i];</span><br><span class="line">E[i] = E[j];</span><br><span class="line">E[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Kruskal</span><span class="params">(MatGraph g)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> u1, v1, sn1, sn2;</span><br><span class="line"><span class="type">int</span> vset[MAXV];</span><br><span class="line">Edge E[MaxSize];    <span class="comment">// 存放所有边</span></span><br><span class="line"><span class="type">int</span> k=<span class="number">0</span>;<span class="comment">// E数组的下标从0开始计</span></span><br><span class="line"><span class="comment">// 初始化 E 数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i; ++j) &#123;</span><br><span class="line"><span class="keyword">if</span> (g.edges[i][j] != <span class="number">0</span> &amp;&amp; g.edges[i][j] != INF) &#123;</span><br><span class="line">E[k].u = i;</span><br><span class="line">E[k].v = j; </span><br><span class="line">E[k].w = g.edges[i][j];</span><br><span class="line">k++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对 E 数组按权值大小排序 </span></span><br><span class="line"><span class="built_in">BubbleSort</span>(E, g.e);</span><br><span class="line"><span class="comment">//初始化辅助数组（点的集合） </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i) vset[i] = i;</span><br><span class="line">k = <span class="number">1</span>;                 <span class="comment">// k表示当前构造生成树的第几条边,初值为1,因为最小生成树的边有且仅有n-1条 </span></span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;<span class="comment">// E中边的下标,记录当前可使用的权值最小的边</span></span><br><span class="line">    <span class="comment">// 找到 n - 1 条边</span></span><br><span class="line"><span class="keyword">while</span> (k &lt; g.n) &#123;</span><br><span class="line"><span class="comment">// 取一条边的头尾顶点</span></span><br><span class="line">u1 = E[j].u;</span><br><span class="line">v1 = E[j].v;</span><br><span class="line"><span class="comment">// 分别得到两个顶点所属的集合编号</span></span><br><span class="line">sn1 = vset[u1];</span><br><span class="line">sn2 = vset[v1]; </span><br><span class="line"><span class="keyword">if</span> (sn1 != sn2) &#123;      <span class="comment">// 若两顶点属于不同的集合,则该边是最小生成树的一条边</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;  (&quot;</span> &lt;&lt; u1 &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; v1 &lt;&lt; <span class="string">&quot;):&quot;</span> &lt;&lt; E[j].w &lt;&lt; endl;</span><br><span class="line">k++;                    <span class="comment">// 生成边数增1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)     <span class="comment">// 两个集合统一编号</span></span><br><span class="line"><span class="keyword">if</span> (vset[i] == sn2)  <span class="comment">// 集合编号为 sn2 的所有结点都改为 sn1</span></span><br><span class="line">    vset[i] = sn1;</span><br><span class="line">&#125;</span><br><span class="line">j++;   <span class="comment">// 扫描下一条边</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完整代码-3"><a href="#完整代码-3" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXV 100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> InfoType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> no;<span class="comment">//顶点编号</span></span><br><span class="line">InfoType info;<span class="comment">//顶点其他信息</span></span><br><span class="line">&#125; VertexType;<span class="comment">//顶点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> edges[MAXV][MAXV];<span class="comment">//邻接矩阵数组</span></span><br><span class="line"><span class="type">int</span> n,e;<span class="comment">//顶点数，边数</span></span><br><span class="line">VertexType vexs[MAXV];<span class="comment">//存放顶点信息</span></span><br><span class="line">&#125; MatGraph;<span class="comment">//完整的图邻接矩阵类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateMat</span><span class="params">(MatGraph &amp;g,<span class="type">int</span> A[MAXV][MAXV],<span class="type">int</span> n,<span class="type">int</span> e)</span> </span>&#123; <span class="comment">//创建图的邻接矩阵</span></span><br><span class="line">g.n=n; g.e=e;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line">g.edges[i][j] = A[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispMat</span><span class="params">(MatGraph g)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line"><span class="keyword">if</span> (g.edges[i][j]!=INF)</span><br><span class="line">cout &lt;&lt; g.edges[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;INF &quot;</span>;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Kruskal算法需要的结构体 </span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> u;<span class="comment">// 边的起始顶点</span></span><br><span class="line"><span class="type">int</span> v;<span class="comment">// 边的终止顶点</span></span><br><span class="line"><span class="type">int</span> w;<span class="comment">// 边的权值 </span></span><br><span class="line">&#125; Edge;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort</span><span class="params">(Edge E[],<span class="type">int</span> n)</span> </span>&#123; <span class="comment">//对E[0..n-1]按递增有序进行直接插入排序</span></span><br><span class="line">Edge temp;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; ++i) </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; n; ++j) </span><br><span class="line"><span class="keyword">if</span> (E[i].w &gt; E[j].w) &#123;</span><br><span class="line">temp = E[i];</span><br><span class="line">E[i] = E[j];</span><br><span class="line">E[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Kruskal</span><span class="params">(MatGraph g)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> u1, v1, sn1, sn2;</span><br><span class="line"><span class="type">int</span> vset[MAXV];</span><br><span class="line">Edge E[MaxSize];    <span class="comment">// 存放所有边</span></span><br><span class="line"><span class="type">int</span> k=<span class="number">0</span>;<span class="comment">// E数组的下标从0开始计</span></span><br><span class="line"><span class="comment">// 初始化 E 数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i; ++j) &#123;</span><br><span class="line"><span class="keyword">if</span> (g.edges[i][j] != <span class="number">0</span> &amp;&amp; g.edges[i][j] != INF) &#123;</span><br><span class="line">E[k].u = i;</span><br><span class="line">E[k].v = j; </span><br><span class="line">E[k].w = g.edges[i][j];</span><br><span class="line">k++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对 E 数组按权值大小排序 </span></span><br><span class="line"><span class="built_in">BubbleSort</span>(E, g.e);</span><br><span class="line"><span class="comment">//初始化辅助数组（点的集合） </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i) vset[i] = i;</span><br><span class="line">k = <span class="number">1</span>;                 <span class="comment">// k 表示当前构造生成树的第几条边,初值为1</span></span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;<span class="comment">// E 中边的下标,记录当前可使用的权值最小的边</span></span><br><span class="line">    <span class="comment">// 找到 n - 1 条边</span></span><br><span class="line"><span class="keyword">while</span> (k &lt; g.n) &#123;</span><br><span class="line"><span class="comment">// 取一条边的头尾顶点</span></span><br><span class="line">u1 = E[j].u;</span><br><span class="line">v1 = E[j].v;</span><br><span class="line"><span class="comment">// 分别得到两个顶点所属的集合编号</span></span><br><span class="line">sn1 = vset[u1];</span><br><span class="line">sn2 = vset[v1]; </span><br><span class="line"><span class="keyword">if</span> (sn1 != sn2) &#123;      <span class="comment">// 若两顶点属于不同的集合,则该边是最小生成树的一条边</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;  (&quot;</span> &lt;&lt; u1 &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; v1 &lt;&lt; <span class="string">&quot;):&quot;</span> &lt;&lt; E[j].w &lt;&lt; endl;</span><br><span class="line">k++;                    <span class="comment">// 生成边数增1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)     <span class="comment">// 两个集合统一编号</span></span><br><span class="line"><span class="keyword">if</span> (vset[i] == sn2)  <span class="comment">// 集合编号为sn2的改为sn1</span></span><br><span class="line">    vset[i] = sn1;</span><br><span class="line">&#125;</span><br><span class="line">j++;   <span class="comment">// 扫描下一条边</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">MatGraph g;</span><br><span class="line"><span class="type">int</span> A[MAXV][MAXV]=&#123;</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">28</span>,INF,INF,INF,<span class="number">10</span>,INF&#125;,</span><br><span class="line">&#123;<span class="number">28</span>,<span class="number">0</span>,<span class="number">16</span>,INF,INF,INF,<span class="number">14</span>&#125;,</span><br><span class="line">&#123;INF,<span class="number">16</span>,<span class="number">0</span>,<span class="number">12</span>,INF,INF,INF&#125;,</span><br><span class="line">&#123;INF,INF,<span class="number">12</span>,<span class="number">0</span>,<span class="number">22</span>,INF,<span class="number">18</span>&#125;,</span><br><span class="line">&#123;INF,INF,INF,<span class="number">22</span>,<span class="number">0</span>,<span class="number">25</span>,<span class="number">24</span>&#125;,</span><br><span class="line">&#123;<span class="number">10</span>,INF,INF,INF,<span class="number">25</span>,<span class="number">0</span>,INF&#125;,</span><br><span class="line">&#123;INF,<span class="number">14</span>,INF,<span class="number">18</span>,<span class="number">24</span>,INF,<span class="number">0</span>&#125;&#125;;</span><br><span class="line"><span class="built_in">CreateMat</span>(g, A, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"><span class="built_in">DispMat</span>(g);</span><br><span class="line"><span class="built_in">Kruskal</span>(g);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="改进克鲁斯卡尔算法"><a href="#改进克鲁斯卡尔算法" class="headerlink" title="改进克鲁斯卡尔算法"></a>改进克鲁斯卡尔算法</h3><p>改进克鲁斯卡尔算法需要<a href="/posts/3306641566.html" title="并查集">并查集</a>和堆排序的基础。</p><p>完整代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXV 100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> InfoType;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> sum = <span class="number">0</span>;<span class="comment">// 最终结果 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> no;<span class="comment">//顶点编号</span></span><br><span class="line">InfoType info;<span class="comment">//顶点其他信息</span></span><br><span class="line">&#125; VertexType;<span class="comment">//顶点类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> edges[MAXV][MAXV];<span class="comment">//邻接矩阵数组</span></span><br><span class="line"><span class="type">int</span> n, e;<span class="comment">//顶点数，边数</span></span><br><span class="line">VertexType vexs[MAXV];<span class="comment">//存放顶点信息</span></span><br><span class="line">&#125; MatGraph;<span class="comment">//完整的图邻接矩阵类型</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateMat</span><span class="params">(MatGraph &amp;g, <span class="type">int</span> A[MAXV][MAXV], <span class="type">int</span> n, <span class="type">int</span> e)</span> </span>&#123; <span class="comment">//创建图的邻接矩阵</span></span><br><span class="line">g.n = n; g.e = e;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; g.n; ++i)</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.n; ++j)</span><br><span class="line">g.edges[i][j] = A[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并查集相关代码 </span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> u;<span class="comment">//边的起始顶点</span></span><br><span class="line">    <span class="type">int</span> v;<span class="comment">//边的终止顶点</span></span><br><span class="line">    <span class="type">int</span> w;<span class="comment">//边的权值</span></span><br><span class="line">&#125; Edge;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="type">int</span> rank;<span class="comment">//结点对应秩</span></span><br><span class="line"><span class="type">int</span> parent;<span class="comment">//结点对应双亲下标</span></span><br><span class="line">&#125; UFSTree;<span class="comment">//并查集树结点类型</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">(UFSTree S[], <span class="type">int</span> n)</span> </span>&#123;<span class="comment">//初始化并查集树 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;<span class="comment">//顶点编号从0到n-1</span></span><br><span class="line">S[i].rank=<span class="number">0</span>;<span class="comment">//秩初始化为0</span></span><br><span class="line">S[i].parent=i;<span class="comment">//双亲初始化指向自已</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(UFSTree S[], <span class="type">int</span> x)</span></span>&#123;<span class="comment">//在x所在子树中查找集合编号</span></span><br><span class="line"><span class="keyword">if</span> (x != S[x].parent)<span class="comment">//双亲不是自已</span></span><br><span class="line">S[x].parent = <span class="built_in">Find</span>(S, S[x].parent);<span class="comment">//路径压缩</span></span><br><span class="line"><span class="keyword">return</span> S[x].parent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Union</span><span class="params">(UFSTree S[], <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;<span class="comment">//将x和y所在的子树合并</span></span><br><span class="line"><span class="type">int</span> rx = <span class="built_in">Find</span>(S,x);</span><br><span class="line"><span class="type">int</span> ry = <span class="built_in">Find</span>(S,y);</span><br><span class="line"><span class="keyword">if</span> (S[rx].rank &gt; S[ry].rank)</span><br><span class="line">S[ry].parent=rx;</span><br><span class="line"><span class="keyword">else</span> &#123; </span><br><span class="line">S[rx].parent = ry;</span><br><span class="line"><span class="keyword">if</span> (S[rx].rank == S[ry].rank)</span><br><span class="line">S[ry].rank++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 堆排序相关代码 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sift</span><span class="params">(Edge E[], <span class="type">int</span> low, <span class="type">int</span> high)</span> </span>&#123;<span class="comment">//筛选算法</span></span><br><span class="line"><span class="type">int</span> i = low, j = <span class="number">2</span>*i;     <span class="comment">//E[j]是E[i]的左孩子</span></span><br><span class="line">Edge temp = E[i];</span><br><span class="line"><span class="keyword">while</span> (j &lt;= high) &#123;</span><br><span class="line"><span class="keyword">if</span> (j&lt;high &amp;&amp; E[j].w&lt;E[j+<span class="number">1</span>].w)<span class="comment">//若右孩子较大,把j指向右孩子</span></span><br><span class="line">j++;    <span class="comment">//f变为2i+1</span></span><br><span class="line"><span class="keyword">if</span> (temp.w &lt; E[j].w) &#123;</span><br><span class="line">E[i] = E[j];              <span class="comment">//将E[j]调整到双亲结点位置上</span></span><br><span class="line">i = j;                    <span class="comment">//修改i和j值,以便继续向下筛选</span></span><br><span class="line">j = <span class="number">2</span>*i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">break</span>;                 <span class="comment">//筛选结束</span></span><br><span class="line">&#125;</span><br><span class="line">E[i] = temp;                      <span class="comment">//被筛选结点的值放入最终位置</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">HeapSort</span><span class="params">(Edge E[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">Edge temp;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = n/<span class="number">2</span>; i &gt;= <span class="number">1</span>; --i)  <span class="comment">//循环建立初始堆</span></span><br><span class="line"><span class="built_in">sift</span>(E, i, n); </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">2</span>; --i) &#123;  <span class="comment">//进行n-1次循环,完成推排序</span></span><br><span class="line">temp = E[<span class="number">1</span>];        <span class="comment">//将第一个元素同当前区间内R[1]对换</span></span><br><span class="line">E[<span class="number">1</span>] = E[i];</span><br><span class="line">E[i] = temp;</span><br><span class="line"><span class="built_in">sift</span>(E, <span class="number">1</span>, i<span class="number">-1</span>);     <span class="comment">//筛选R[1]结点,得到i-1个结点的堆</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改进Kruskal算法实现代码 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Kruskal</span><span class="params">(MatGraph g)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> i, j, k, u1, v1, sn1, sn2;</span><br><span class="line">UFSTree S[MaxSize];</span><br><span class="line">Edge E[MaxSize];</span><br><span class="line">k = <span class="number">1</span>;<span class="comment">// e数组的下标从1开始计</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g.n; ++i)</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt;= i; ++j)</span><br><span class="line"><span class="keyword">if</span> (g.edges[i][j] != <span class="number">0</span> &amp;&amp; g.edges[i][j] != INF) &#123;</span><br><span class="line">E[k].u = i; E[k].v = j; E[k].w = g.edges[i][j];</span><br><span class="line">k++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">HeapSort</span>(E, g.e);<span class="comment">// 采用堆排序对 E 数组按权值递增排序</span></span><br><span class="line"><span class="built_in">Init</span>(S, g.n);<span class="comment">// 初始化并查集树t</span></span><br><span class="line">k=<span class="number">1</span>;               <span class="comment">// k表示当前构造生成树的第几条边,初值为1</span></span><br><span class="line">j=<span class="number">1</span>;               <span class="comment">// E中边的下标,初值为1</span></span><br><span class="line"><span class="keyword">while</span> (k &lt; g.n) &#123;      <span class="comment">// 生成的边数小于n时循环</span></span><br><span class="line"><span class="comment">// 取一条边的头尾顶点分别编号为u1和v2</span></span><br><span class="line">u1 = E[j].u;</span><br><span class="line">v1 = E[j].v;</span><br><span class="line"><span class="comment">// 利用并查集分别得到两个顶点所属的集合编号</span></span><br><span class="line">sn1 = <span class="built_in">Find</span>(S,u1);</span><br><span class="line">sn2 = <span class="built_in">Find</span>(S,v1); </span><br><span class="line"><span class="keyword">if</span> (sn1!=sn2) &#123;    <span class="comment">// 两顶点属于不同的集合,该边是最小生成树的一条边</span></span><br><span class="line">sum += E[j].w; <span class="comment">// 更新答案 </span></span><br><span class="line">k++;<span class="comment">// 生成边数增1</span></span><br><span class="line"><span class="built_in">Union</span>(S,u1,v1);<span class="comment">// 利用并查集将u1和v1两个顶点合并</span></span><br><span class="line">&#125;</span><br><span class="line">j++;   <span class="comment">// 继续扫描下一条边</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">MatGraph g;</span><br><span class="line"><span class="type">int</span> A[MAXV][MAXV] = &#123;</span><br><span class="line">&#123;  <span class="number">0</span>,  <span class="number">3</span>,INF,INF,INF,  <span class="number">4</span>,INF,INF,INF&#125;,</span><br><span class="line">&#123;  <span class="number">3</span>,  <span class="number">0</span>,  <span class="number">8</span>,INF,INF,INF,  <span class="number">6</span>,INF,  <span class="number">5</span>&#125;,</span><br><span class="line">&#123;INF,  <span class="number">8</span>,  <span class="number">0</span>, <span class="number">12</span>,INF,INF,INF,INF,  <span class="number">2</span>&#125;,</span><br><span class="line">&#123;INF,INF, <span class="number">12</span>,  <span class="number">0</span>, <span class="number">10</span>,INF, <span class="number">14</span>,  <span class="number">6</span>, <span class="number">11</span>&#125;,</span><br><span class="line">&#123;INF,INF,INF, <span class="number">10</span>,  <span class="number">0</span>, <span class="number">18</span>,INF,  <span class="number">1</span>,INF&#125;,</span><br><span class="line">&#123;  <span class="number">4</span>,INF,INF,INF, <span class="number">18</span>,  <span class="number">0</span>,  <span class="number">7</span>,INF,INF&#125;,</span><br><span class="line">&#123;INF,  <span class="number">6</span>,INF, <span class="number">14</span>,INF,INF,  <span class="number">0</span>,  <span class="number">9</span>,INF&#125;,</span><br><span class="line">&#123;INF,INF,INF,  <span class="number">6</span>,  <span class="number">1</span>,INF,  <span class="number">9</span>,  <span class="number">0</span>,INF&#125;,</span><br><span class="line">&#123;INF,  <span class="number">5</span>,  <span class="number">2</span>, <span class="number">11</span>,INF,INF,INF,INF,  <span class="number">0</span>&#125;&#125;;</span><br><span class="line"><span class="built_in">CreateMat</span>(g, A, <span class="number">9</span>, <span class="number">15</span>);</span><br><span class="line"><span class="built_in">Kruskal</span>(g);</span><br><span class="line">cout &lt;&lt; sum; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果使用更快的排序，例如堆排序，快速排序使得排序的时间复杂度提升为 $O(mlog_2 m)$，当然选择排序方式应当选择更快速，且更稳定的算法，所有这里选择使用堆排序。并且Kruskal算法是加边操作，很容易造成：多个边提前并在一个集合中，并且产生多个这个集合，在原本的Kruskal算法中合并集合占用的时间复杂度很高，但是思考这一性质，可以想出利用并查集来优化，使用并查集合并集合的时间复杂度为<script type="math/tex">O(log_2n)</script>，所以while循环整体的时间复杂度变为<script type="math/tex">O(mlog_2n)</script>。对于连通无向图来说,<script type="math/tex">m \ge n -1</script>，所以最终算法时间复杂度为<script type="math/tex">O(mlog_2 m)</script>。</p><h3 id="适用于竞赛的简化版Kruskal"><a href="#适用于竞赛的简化版Kruskal" class="headerlink" title="适用于竞赛的简化版Kruskal"></a>适用于竞赛的简化版Kruskal</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;       <span class="comment">// n是点数，m是边数</span></span><br><span class="line"><span class="type">int</span> p[N];       <span class="comment">// 并查集的父节点数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;   <span class="comment">// 存储边</span></span><br><span class="line">    <span class="type">int</span> a, b, w;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt; (<span class="type">const</span> Edge &amp;W)<span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> w &lt; W.w;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; edges[M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;   <span class="comment">// 并查集核心操作</span></span><br><span class="line">    <span class="keyword">if</span> (p[x] != x) p[x] = <span class="built_in">find</span>(p[x]);</span><br><span class="line">    <span class="keyword">return</span> p[x];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(edges, edges + m);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) p[i] = i;    <span class="comment">// 初始化并查集</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ ) &#123;</span><br><span class="line">        <span class="type">int</span> a = edges[i].a, b = edges[i].b, w = edges[i].w;</span><br><span class="line"></span><br><span class="line">        a = <span class="built_in">find</span>(a), b = <span class="built_in">find</span>(b);</span><br><span class="line">        <span class="keyword">if</span> (a != b) &#123;   <span class="comment">// 如果两个连通块不连通，则将这两个连通块合并</span></span><br><span class="line">            p[a] = b;</span><br><span class="line">            res += w;</span><br><span class="line">            cnt ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cnt &lt; n - <span class="number">1</span>) <span class="keyword">return</span> INF;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 图论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>并查集</title>
      <link href="/posts/3306641566.html"/>
      <url>/posts/3306641566.html</url>
      
        <content type="html"><![CDATA[<h1 id="支持运算"><a href="#支持运算" class="headerlink" title="支持运算"></a>支持运算</h1><ul><li><code>MAKE_SET(S, n)</code>：初始化并查集 <code>S</code> ，即 $S = {S_1, S_2,\cdots,S_n}$。每个动态集合 $S_i(1 &lt;= i &lt;= n)$ 仅仅包含一个编号为 <code>i</code> 的元素，该元素作为集合 $s_i$ 的“代表”。</li><li><code>FIND_SET(S, x)</code>：返回并查集 <code>S</code>  中 <code>x</code> 元素所在集合的“代表”。</li><li><code>UNION(S, x, y)</code> ：在并查集 <code>S</code> 中将 <code>x</code> 和 <code>y</code> 两个元素所在的动态集合合并为一个新的集合。并假设在此运算前这两个动态集合是分离的，通常以 $S_x$ 或者 $S_y$ 的“代表”作为新集合的“代表”。</li></ul><h1 id="树实现并查集"><a href="#树实现并查集" class="headerlink" title="树实现并查集"></a>树实现并查集</h1><blockquote><ul><li><p>用有根树标识集合，树种的每个结点包含集合的一个元素，每颗树表示一个集合。每一个分离集合又叫分离集合树。</p></li><li><p>多个集合形成一个森林，以每颗树的树根作为集合的“代表”。整个并查集也就是一个分离集合森林。</p></li><li><p>树中每个结点有一个指向双亲结点的指针，根节点的双亲结点指针指向其自身。</p></li></ul></blockquote><p>合并树时为了使树比较平衡有如下规定：</p><p>假设合并树A、B，有：$h_A &gt; h_B$ ，则应将 B 树作为 A 树的子树；否则应将 A 树作为 B 树的子树。总之，总是将高度较小的分离集合树作为子树。得到了新的分离集合树 C 的高度为 $h_C$ ，如以 B 树作为 A 树的子树，$h_C = MAX{h_A, h_B+1}$。</p><p>这样得到的分离集合树的高度不会超过 $log_2n$，对应的查找与合并的时间复查度也就稳定在 $O(log_2n)$了。</p><p><strong>为此给每一个结点增加一个秩（rank）域，它是近似子树高度的正常数，同时它也是该结点高度的一个上界</strong></p><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">node</span>&#123;</span><br><span class="line"><span class="type">int</span> data;<span class="comment">// 结点对应的编号 </span></span><br><span class="line"><span class="type">int</span> rank;<span class="comment">// 结点对应的秩 </span></span><br><span class="line"><span class="type">int</span> parent;<span class="comment">// 结点对应的双亲下标 </span></span><br><span class="line">&#125; UFSTree;<span class="comment">// 并查集树的结点类型 </span></span><br></pre></td></tr></table></figure><h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><blockquote><p>建立一个存放并查集的数组 <code>t</code> ，每个结点对应的人，结点的 <code>data</code> 值设置为该人的编号，<code>rank</code> 值设置为0，<code>parent</code> 值设置为自己。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MAKE_SET</span><span class="params">(UFSTree t[], <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">t[i].data = i;<span class="comment">// 数据为该人的编号 </span></span><br><span class="line">t[i].rank = <span class="number">0</span>;<span class="comment">// 秩初始化为 0 </span></span><br><span class="line">t[i].parent = i;<span class="comment">// 双亲初始化指向自己 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="查找一个元素所属的集合"><a href="#查找一个元素所属的集合" class="headerlink" title="查找一个元素所属的集合"></a>查找一个元素所属的集合</h3><blockquote><p>在分离集合森林中，每一颗分离集合树对应一个集合。如果要查找某一元素所属的集合，就是要找这个元素对应的结点所在的分离集合树。</p><p><strong>用分离集合树的根节点的编号来标识这颗分离集合树，这样查找一个结点所在的分离集合树也就是查找该节点所在分离集合树的根节点。</strong></p><p>寻找根节点的方法：任取树中的一个结点（一般是要查找的结点），<strong>沿双亲结点方向一直往树根上走</strong>；初始时，取一个结点，走到它的双亲结点，然后以双亲结点为基点，走到双亲结点的双亲结点，….， 直至走到一个没有双亲结点的结点（<strong>双亲结点就是自己</strong>）位置，这个结点就是树的根节点。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查找元素 x 所在集合的编号 </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">FIND_SET</span><span class="params">(UFSTree t[], <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x != t[x].parent)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">FIND_SET</span>(t, t[x].parent);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> x;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>对于 <code>n</code> 个人而言，构成的分离集合树的高度最高位 $log_2n$，所以本算法的时间复杂度位 $O(log_2n)$。</p><h3 id="两个元素各自所属的集合的合并"><a href="#两个元素各自所属的集合的合并" class="headerlink" title="两个元素各自所属的集合的合并"></a>两个元素各自所属的集合的合并</h3><blockquote><p>在进行合并的时候，需要让秩较小的根指向具有较大秩的根。如果两根的秩相等，随便让一个指向另一个，同时秩增加1.</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合并两个元素所属的集合</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UNION</span><span class="params">(UFSTree t[], <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先找到两颗分离集合树的编号 </span></span><br><span class="line">x = <span class="built_in">FIND_SET</span>(t, x);</span><br><span class="line">y = <span class="built_in">FIND_SET</span>(t, y);</span><br><span class="line"><span class="keyword">if</span> (t[x].rank &gt; t[y].rank)</span><br><span class="line">t[y].parent = x;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">t[x].parent = y;</span><br><span class="line"><span class="keyword">if</span> (t[x].rank == t[y].rank)</span><br><span class="line">t[y].rank++;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>对于 <code>n</code> 个人而言，本算法的时间复杂度位 $O(log_2 n)$。</p><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>判断两个人是否是亲戚。</p><h3 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h3><p>先输入两个数：N , M。N代表人数，M表示关系个数。</p><p>再输入M行，每行两个数字为人的编号，表示这两个人是亲戚。</p><p>之后再输入一个数Q，表示想要询问的问题的个数</p><p>再输入Q行，表示问题。每行是两个数字，表示两个人的编号。</p><blockquote><p>样例输入：</p><p>10 7<br>2 4<br>5 7<br>1 3<br>8 9<br>1 2<br>5 6<br>2 3<br>3<br>3 4<br>7 10<br>8 9 </p></blockquote><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>输出两者是否是亲戚，是则输出 YES；否则输出NO。</p><blockquote><p>样例输出：</p><p>YES</p><p>NO</p><p>YES</p></blockquote><h1 id="数组实现并查集"><a href="#数组实现并查集" class="headerlink" title="数组实现并查集"></a>数组实现并查集</h1><h2 id="朴素并查集"><a href="#朴素并查集" class="headerlink" title="朴素并查集"></a>朴素并查集</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> p[N];<span class="comment">// 存储每个结点的双亲结点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) p[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找元素</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p[x] != x) p[x] = <span class="built_in">find</span>(p[x])</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并 a 和 b所在的两个集合</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Union</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="维护size的并查集"><a href="#维护size的并查集" class="headerlink" title="维护size的并查集"></a>维护size的并查集</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> p[N], size[N];<span class="comment">// p 存储每个结点的双亲结点， size只有是根结点时才有意义，表示分离集合数种的点的数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        p[i] = i;</span><br><span class="line">        size[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x != p[x]) <span class="keyword">return</span> <span class="built_in">find</span>(p[x]);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Union</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    size[<span class="built_in">find</span>(b)] += size[<span class="built_in">find</span>(a)];</span><br><span class="line">    p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="维护到根节点距离的并查集"><a href="#维护到根节点距离的并查集" class="headerlink" title="维护到根节点距离的并查集"></a>维护到根节点距离的并查集</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> p[N], d[N];<span class="comment">// p 存储每个点的双亲结点，d[x] 存储 x 到 p[x]的距离</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        p[i] = i;</span><br><span class="line">        d[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p[x] != x) &#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="built_in">find</span>(p[x]);</span><br><span class="line">        d[x] += d[p[x]];</span><br><span class="line">        p[x] = u;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Union</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    p[<span class="built_in">find</span>(a)] = <span class="built_in">find</span>(b);</span><br><span class="line">    d[<span class="built_in">find</span>(a)] = distance;<span class="comment">// 根据具体问题，初始化时 find(a) 的偏移量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
          <category> 数论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 树论 </tag>
            
            <tag> 图论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>链式向前星 + bfs遍历</title>
      <link href="/posts/3731385230.html"/>
      <url>/posts/3731385230.html</url>
      
        <content type="html"><![CDATA[<h1 id="复习队列"><a href="#复习队列" class="headerlink" title="复习队列"></a>复习队列</h1><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> queue[MaxV]</span><br><span class="line"><span class="type">int</span> rear = <span class="number">-1</span>, front = <span class="number">-1</span>;</span><br></pre></td></tr></table></figure><h2 id="运算操作"><a href="#运算操作" class="headerlink" title="运算操作"></a>运算操作</h2><ul><li>队空的条件：<code>front = rear</code></li><li>队满的条件：<code>rear = MaxSize - 1</code>（data数组的最大下标）</li><li>元素 e 入队：<ul><li><code>rear++;</code></li><li><code>data[rear] = e;</code></li></ul></li><li>出队操作：<ul><li><code>front++;</code></li><li>取出data数组中front位置的元素（一般不用管，要管时可以赋特别值）</li></ul></li></ul><p>所以一般使用：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (front != rear) &#123;  <span class="comment">// 不队空</span></span><br><span class="line">    <span class="keyword">if</span> (rear &lt; MaxSize - <span class="number">1</span>) <span class="comment">//判断是否队满，（一般竞赛中，空间提前开够，不需要判断这步）</span></span><br><span class="line">    qu[++rear] = e;<span class="comment">// 入队</span></span><br><span class="line">    ......</span><br><span class="line">    ElemType t = qu[++front]; <span class="comment">// 出队并取得队首元素</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="普通链表实现"><a href="#普通链表实现" class="headerlink" title="普通链表实现"></a>普通链表实现</h1><h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> qu[MaxV]; <span class="comment">// 队列 </span></span><br><span class="line"><span class="type">bool</span> visted[MaxV];<span class="comment">// 判断是否遍历过 </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(AdjGraph* G, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="built_in">memset</span>(qu, <span class="number">-1</span>, <span class="built_in">sizeof</span>(qu)); </span><br><span class="line"><span class="type">int</span> rear = <span class="number">-1</span>, front = <span class="number">-1</span>;</span><br><span class="line"><span class="comment">// 当前节点入队 </span></span><br><span class="line">rear++;</span><br><span class="line">qu[rear] = v;</span><br><span class="line">    <span class="comment">// 当前节点访问过</span></span><br><span class="line">visted[v] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (front != rear) &#123;</span><br><span class="line"><span class="comment">// 先将元素出队</span></span><br><span class="line"><span class="type">int</span> i = qu[front+<span class="number">1</span>]; <span class="comment">// 获取队首元素</span></span><br><span class="line">front++;<span class="comment">// 移除队首元素</span></span><br><span class="line"><span class="comment">// 输出元素</span></span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>; </span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!visted[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="comment">// 入队，之后准备遍历</span></span><br><span class="line">rear++;</span><br><span class="line">qu[rear] = p-&gt;adjvex;</span><br><span class="line">visted[p-&gt;adjvex] = <span class="literal">true</span>; </span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxV 10010 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF INT_MAX</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> string infoType; <span class="comment">// 存储信息的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">ANode</span> &#123;<span class="comment">// 边节点 </span></span><br><span class="line"><span class="type">int</span> adjvex;<span class="comment">// 该边的邻接点编号</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ANode</span>* nextarc;<span class="comment">// 指向下一条边的指针</span></span><br><span class="line"><span class="type">int</span> weight;<span class="comment">// 该边的权重 </span></span><br><span class="line">&#125; ArcNode;<span class="comment">// 边节点的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;<span class="comment">// 头节点 </span></span><br><span class="line">infoType info;<span class="comment">// 顶点的其他信息 </span></span><br><span class="line">ArcNode* firstarc;<span class="comment">// 指向第一个边的指针 </span></span><br><span class="line">&#125; VNode; <span class="comment">// 邻接表头节点类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">VNode adjlist[MaxV];<span class="comment">// 邻接表头结点数组</span></span><br><span class="line"><span class="type">int</span> n, e;<span class="comment">// 图中的顶点数n, 边数e </span></span><br><span class="line">&#125; AdjGraph;<span class="comment">// 完整的图邻接表类型 </span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> qu[MaxV];         <span class="comment">// 队列 </span></span><br><span class="line"><span class="type">bool</span> visted[MaxV];<span class="comment">// 判断是否遍历过 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的创建</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateAdj</span><span class="params">(AdjGraph*&amp; G,<span class="type">int</span> A[MaxV][MaxV], <span class="type">int</span> n, <span class="type">int</span> e)</span> </span>&#123;</span><br><span class="line">ArcNode *p;</span><br><span class="line">G = (AdjGraph*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(AdjGraph));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">G-&gt;adjlist[i].firstarc = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = n<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line"><span class="keyword">if</span> (A[i][j] != <span class="number">0</span> &amp;&amp; A[i][j] != INF) &#123;<span class="comment">// 存在一条边 </span></span><br><span class="line"><span class="comment">// 申请内存 </span></span><br><span class="line">p = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line"><span class="comment">// 存储信息 </span></span><br><span class="line">p-&gt;adjvex = j;</span><br><span class="line">p-&gt;weight = A[i][j];</span><br><span class="line"><span class="comment">// 头插法插入节点 </span></span><br><span class="line">p-&gt;nextarc = G-&gt;adjlist[i].firstarc;</span><br><span class="line">G-&gt;adjlist[i].firstarc = p;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">G-&gt;n = n;</span><br><span class="line">G-&gt;e = e; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的遍历输出</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispAdj</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; :&quot;</span>;</span><br><span class="line"><span class="comment">// 遍历链表 </span></span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">cout &lt;&lt; p-&gt;adjvex &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; p-&gt;weight &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">p = p-&gt;nextarc; </span><br><span class="line">&#125; </span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyAdj</span><span class="params">(AdjGraph*&amp; G)</span> </span>&#123;</span><br><span class="line">ArcNode* pre, *p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">pre = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">if</span> (pre != <span class="literal">NULL</span>) &#123;</span><br><span class="line">p = pre-&gt;nextarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">pre = p;</span><br><span class="line">p=p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(G);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(AdjGraph* G, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="built_in">memset</span>(qu, <span class="number">-1</span>, <span class="built_in">sizeof</span>(qu)); </span><br><span class="line"><span class="type">int</span> rear = <span class="number">-1</span>, front = <span class="number">-1</span>;</span><br><span class="line"><span class="comment">// 当前节点入队 </span></span><br><span class="line">rear++;</span><br><span class="line">qu[rear] = v;</span><br><span class="line">visted[v] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (front != rear) &#123;</span><br><span class="line"><span class="comment">// 先将元素出队</span></span><br><span class="line"><span class="type">int</span> i = qu[front+<span class="number">1</span>];</span><br><span class="line">front++;</span><br><span class="line"><span class="comment">// 输出元素</span></span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>; </span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!visted[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="comment">// 入队，之后准备遍历</span></span><br><span class="line">rear++;</span><br><span class="line">qu[rear] = p-&gt;adjvex;</span><br><span class="line">visted[p-&gt;adjvex] = <span class="literal">true</span>; </span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> A[][MaxV] = &#123;</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>&#125;,<span class="comment">// &lt;0,1&gt;[2]  &lt;0,2&gt;[1]</span></span><br><span class="line">&#123;<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>&#125;,<span class="comment">// &lt;1,0&gt;[2]  &lt;1,2&gt;[3]</span></span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>&#125;<span class="comment">// &lt;2,0&gt;[1]  &lt;2,1&gt;[3]</span></span><br><span class="line">&#125;;</span><br><span class="line">AdjGraph* G;</span><br><span class="line"><span class="built_in">CreateAdj</span>(G, A, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">DispAdj</span>(G);</span><br><span class="line"><span class="built_in">bfs</span>(G, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">DestroyAdj</span>(G);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h1 id="链式向前星"><a href="#链式向前星" class="headerlink" title="链式向前星"></a>链式向前星</h1><h2 id="核心代码-1"><a href="#核心代码-1" class="headerlink" title="核心代码"></a>核心代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> qu[N], rear = <span class="number">-1</span>, front = <span class="number">-1</span>;<span class="comment">// 队列相关 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bfs遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 入队</span></span><br><span class="line">qu[++rear] = i;</span><br><span class="line">st[i] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (front != rear) &#123;</span><br><span class="line"><span class="type">int</span> t = qu[++front];</span><br><span class="line">cout &lt;&lt; t &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[t]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123;</span><br><span class="line">qu[++rear] = e[j];</span><br><span class="line">st[e[j]] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="整体代码"><a href="#整体代码" class="headerlink" title="整体代码"></a>整体代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000</span>, M = N * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M], idx;<span class="comment">// 图 </span></span><br><span class="line"><span class="type">bool</span> st[N];   <span class="comment">// 判断是否遍历过 </span></span><br><span class="line"><span class="type">int</span> qu[N], rear = <span class="number">-1</span>, front = <span class="number">-1</span>; <span class="comment">// 队列相关 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加边 ： a -&gt; b </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 就是对 h[a] 的链表添加一个节点，新节点值为 b </span></span><br><span class="line">e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (h[i] != <span class="number">-1</span>)&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot;：&quot;</span>;<span class="comment">// 输出当前节点的编号 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j])<span class="comment">// 遍历顶点指向的边 </span></span><br><span class="line">cout &lt;&lt; e[j] &lt;&lt; <span class="string">&quot; idx:(&quot;</span> &lt;&lt; j &lt;&lt; <span class="string">&quot;)-&gt; &quot;</span>;<span class="comment">// 输出对应顶点的编号，和下标索引 </span></span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs遍历 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">st[i] = <span class="literal">true</span>;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123;</span><br><span class="line"><span class="built_in">dfs</span>(e[j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// bfs遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 入队</span></span><br><span class="line">qu[++rear] = i;</span><br><span class="line">st[i] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (front != rear) &#123;</span><br><span class="line"><span class="type">int</span> t = qu[++front];</span><br><span class="line">cout &lt;&lt; t &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[t]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123;</span><br><span class="line">qu[++rear] = e[j];</span><br><span class="line">st[e[j]] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">init</span>();</span><br><span class="line"><span class="built_in">add</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">4</span>,<span class="number">6</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">6</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">disp</span>(); </span><br><span class="line"><span class="built_in">dfs</span>(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">memset</span>(st, <span class="literal">false</span>, <span class="built_in">sizeof</span>(st));</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"><span class="built_in">bfs</span>(<span class="number">2</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
          <category> bfs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 图论 </tag>
            
            <tag> bfs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>链式向前星 + dfs遍历</title>
      <link href="/posts/2909934084.html"/>
      <url>/posts/2909934084.html</url>
      
        <content type="html"><![CDATA[<h1 id="利用普通链表构建的邻接表"><a href="#利用普通链表构建的邻接表" class="headerlink" title="利用普通链表构建的邻接表"></a>利用普通链表构建的邻接表</h1><h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> visted[MaxV];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(AdjGraph* G, <span class="type">int</span> v)</span> </span>&#123; <span class="comment">// v 为起点 </span></span><br><span class="line">ArcNode* p;</span><br><span class="line">visted[v] = <span class="literal">true</span>;<span class="comment">// 标记为已遍历</span></span><br><span class="line">cout &lt;&lt; v &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line">p = G-&gt;adjlist[v].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!visted[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="built_in">dfs</span>(G, p-&gt;adjvex);</span><br><span class="line">&#125; </span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxV 100010 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF INT_MAX</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> string infoType;  <span class="comment">// 存储信息的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">ANode</span> &#123; <span class="comment">// 边节点 </span></span><br><span class="line"><span class="type">int</span> adjvex;<span class="comment">// 该边的邻接点编号</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ANode</span>* nextarc; <span class="comment">// 指向下一条边的指针</span></span><br><span class="line"><span class="type">int</span> weight;<span class="comment">// 该边的权重 </span></span><br><span class="line">&#125; ArcNode;<span class="comment">// 边节点的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;<span class="comment">// 头节点 </span></span><br><span class="line">infoType info;<span class="comment">// 顶点的其他信息 </span></span><br><span class="line">ArcNode* firstarc;<span class="comment">// 指向第一个边的指针 </span></span><br><span class="line">&#125; VNode;    <span class="comment">// 邻接表头节点类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">VNode adjlist[MaxV];    <span class="comment">// 邻接表头结点数组</span></span><br><span class="line"><span class="type">int</span> n, e;   <span class="comment">// 图中的顶点数n, 边数e </span></span><br><span class="line">&#125; AdjGraph;   <span class="comment">// 完整的图邻接表类型 </span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> visted[MaxV];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的创建</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateAdj</span><span class="params">(AdjGraph*&amp; G,<span class="type">int</span> A[MaxV][MaxV], <span class="type">int</span> n, <span class="type">int</span> e)</span> </span>&#123;</span><br><span class="line">ArcNode *p;</span><br><span class="line">G = (AdjGraph*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(AdjGraph));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">G-&gt;adjlist[i].firstarc = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = n<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line"><span class="keyword">if</span> (A[i][j] != <span class="number">0</span> &amp;&amp; A[i][j] != INF) &#123;<span class="comment">// 存在一条边 </span></span><br><span class="line"><span class="comment">// 申请内存 </span></span><br><span class="line">p = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line"><span class="comment">// 存储信息 </span></span><br><span class="line">p-&gt;adjvex = j;</span><br><span class="line">p-&gt;weight = A[i][j];</span><br><span class="line"><span class="comment">// 头插法插入节点 </span></span><br><span class="line">p-&gt;nextarc = G-&gt;adjlist[i].firstarc;</span><br><span class="line">G-&gt;adjlist[i].firstarc = p;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">G-&gt;n = n;</span><br><span class="line">G-&gt;e = e; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的遍历输出</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispAdj</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; :&quot;</span>;</span><br><span class="line"><span class="comment">// 遍历链表 </span></span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">cout &lt;&lt; p-&gt;adjvex &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; p-&gt;weight &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">p = p-&gt;nextarc; </span><br><span class="line">&#125; </span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyAdj</span><span class="params">(AdjGraph*&amp; G)</span> </span>&#123;</span><br><span class="line">ArcNode* pre, *p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">pre = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">if</span> (pre != <span class="literal">NULL</span>) &#123;</span><br><span class="line">p = pre-&gt;nextarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">pre = p;</span><br><span class="line">p=p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(G);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs遍历图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(AdjGraph* G, <span class="type">int</span> v)</span> </span>&#123; <span class="comment">// v 为起点 </span></span><br><span class="line">ArcNode* p;</span><br><span class="line">visted[v] = <span class="literal">true</span>;<span class="comment">// 标记为已遍历</span></span><br><span class="line">cout &lt;&lt; v &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line">p = G-&gt;adjlist[v].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!visted[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="built_in">dfs</span>(G, p-&gt;adjvex);</span><br><span class="line">&#125; </span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> A[][MaxV] = &#123;</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>&#125;,<span class="comment">// &lt;0,1&gt;[2]  &lt;0,2&gt;[1]</span></span><br><span class="line">&#123;<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>&#125;,<span class="comment">// &lt;1,0&gt;[2]  &lt;1,2&gt;[3]</span></span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>&#125;<span class="comment">// &lt;2,0&gt;[1]  &lt;2,1&gt;[3]</span></span><br><span class="line">&#125;;</span><br><span class="line">AdjGraph* G;</span><br><span class="line"><span class="built_in">CreateAdj</span>(G, A, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">DispAdj</span>(G);</span><br><span class="line"><span class="built_in">dfs</span>(G, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">DestroyAdj</span>(G);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h1 id="利用链式向前星"><a href="#利用链式向前星" class="headerlink" title="利用链式向前星"></a>利用链式向前星</h1><h2 id="核心代码-1"><a href="#核心代码-1" class="headerlink" title="核心代码"></a>核心代码</h2><p>链式向前星的代码没有普通链表实现简单。可利用普通链表实现作参考：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> visted[MaxV];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(AdjGraph* G, <span class="type">int</span> v)</span> </span>&#123; <span class="comment">// v 为起点 </span></span><br><span class="line">ArcNode* p;</span><br><span class="line">visted[v] = <span class="literal">true</span>;<span class="comment">// 标记为已遍历</span></span><br><span class="line">cout &lt;&lt; v &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line">p = G-&gt;adjlist[v].firstarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!visted[p-&gt;adjvex]) &#123;</span><br><span class="line"><span class="built_in">dfs</span>(G, p-&gt;adjvex);</span><br><span class="line">&#125; </span><br><span class="line">p = p-&gt;nextarc;</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以，得出链式向前星遍历代码为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> st[N];<span class="comment">// 对应上面 visted[MaxV]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;<span class="comment">// 竞赛里一般一个图,不需要参数 G ，i 表示遍历的节点的编号对应 v</span></span><br><span class="line">st[i] = <span class="literal">true</span>;<span class="comment">// 对应visted[v] = true</span></span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>; <span class="comment">// 对应 cout &lt;&lt; v &lt;&lt; &quot; -&gt; &quot; </span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j]) &#123;   <span class="comment">// 遍历链表的每一个节点，和while循环类似</span></span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123; <span class="comment">// 如果下一个节点没有没访问过</span></span><br><span class="line"><span class="built_in">dfs</span>(e[j]);<span class="comment">// 访问下一个节点</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="整体代码"><a href="#整体代码" class="headerlink" title="整体代码"></a>整体代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000</span>, M = N * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M], idx;</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="comment">// 添加边 ： a -&gt; b </span></span><br><span class="line"><span class="comment">// 就是对 h[a] 的链表添加一个节点，新节点值为 b </span></span><br><span class="line">e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (h[i] != <span class="number">-1</span>)&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot;：&quot;</span>;<span class="comment">// 输出当前节点的编号 </span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j])<span class="comment">// 遍历顶点指向的边 </span></span><br><span class="line">cout &lt;&lt; e[j] &lt;&lt; <span class="string">&quot; idx:(&quot;</span> &lt;&lt; j &lt;&lt; <span class="string">&quot;)-&gt; &quot;</span>;<span class="comment">// 输出对应顶点的编号，和下标索引 </span></span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs遍历图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">st[i] = <span class="literal">true</span>;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123;</span><br><span class="line"><span class="built_in">dfs</span>(e[j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">init</span>();</span><br><span class="line"><span class="built_in">add</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">4</span>,<span class="number">6</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">6</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">disp</span>(); </span><br><span class="line"><span class="built_in">dfs</span>(<span class="number">2</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
          <category> dfs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 图论 </tag>
            
            <tag> dfs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>链式向前星</title>
      <link href="/posts/2087796737.html"/>
      <url>/posts/2087796737.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>链式向前星，是<strong>图的一种存储结构，采用数组模拟链表实现前向星的功能</strong>，简单来讲，它按照边来存图，而邻接矩阵是按照点来存图。</p></blockquote><p>可以结合图的邻接表存储（链表实现）<a href="/posts/2516528882.html" title="图的存储">图的存储</a>和数组实现链表<a href="/posts/1120620192.html" title="数组实现链表">数组实现链表</a>的知识，自己实现链式向前星。</p><h1 id="链式向前星"><a href="#链式向前星" class="headerlink" title="链式向前星"></a>链式向前星</h1><h2 id="无边权图"><a href="#无边权图" class="headerlink" title="无边权图"></a>无边权图</h2><h3 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000</span>, M = N * <span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> h[N], e[M], ne[M], idx;</span><br></pre></td></tr></table></figure><blockquote><p><code>h[i]</code> 表示第 <code>i</code> 个结点的头节点</p><p><code>e[i]</code> 表示第 <code>i</code> 个节点在图中对应的编号</p><p><code>ne[i]</code> 表示第 <code>i</code> 个节点的下一个节点所在的下标，也就是边</p><p><code>idx</code> 表示下一个新添节点的下标</p></blockquote><p>注意头节点需要<code>N</code>个的话，那么，最多需要 <code>N*(N-1)</code> 个ne节点和e节点（完全图的性质）。但是一般都没有那么满，满图用邻接矩阵来存，所以一般<code>M = N * 2</code>就够了。</p><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在一般适合，直接全局写就行了，不用写成函数再调用。</p></blockquote><h3 id="加边操作"><a href="#加边操作" class="headerlink" title="加边操作"></a>加边操作</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="comment">// 添加边 ： a -&gt; b </span></span><br><span class="line"><span class="comment">// 就是对 h[a] 的链表添加一个节点，新节点值为 b </span></span><br><span class="line">e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>链表头插法添加节点：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">e[idx] = x;</span><br><span class="line">ne[idx] = head;</span><br><span class="line">head = idx++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>==注意调用一次是有向图，可以调用两次变成双向图或无向图==</p><p>即： </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">add</span>(a, b);</span><br><span class="line"><span class="built_in">add</span>(b, a);</span><br></pre></td></tr></table></figure><h3 id="遍历操作"><a href="#遍历操作" class="headerlink" title="遍历操作"></a>遍历操作</h3><h4 id="普通遍历"><a href="#普通遍历" class="headerlink" title="普通遍历"></a>普通遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (h[i] != <span class="number">-1</span>)&#123;</span><br><span class="line">cout &lt;&lt;  i &lt;&lt; <span class="string">&quot;：&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j])<span class="comment">//遍历顶点指向的边 </span></span><br><span class="line">cout &lt;&lt; e[j] &lt;&lt; <span class="string">&quot; idx(&quot;</span> &lt;&lt; j &lt;&lt; <span class="string">&quot;) -&gt; &quot;</span>;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="dfs遍历"><a href="#dfs遍历" class="headerlink" title="dfs遍历"></a>dfs遍历</h4><a href="/posts/2087796737.html" title="链式向前星">+ dfs遍历</a><h4 id="bfs遍历"><a href="#bfs遍历" class="headerlink" title="bfs遍历"></a>bfs遍历</h4><a href="/posts/2087796737.html" title="链式向前星">+ bfs遍历</a><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000</span>, M = N * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M], idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="comment">// 添加边 ： a -&gt; b </span></span><br><span class="line"><span class="comment">// 就是对 h[a] 的链表添加一个节点，新节点值为 b </span></span><br><span class="line">e[idx] = b, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (h[i] != <span class="number">-1</span>)&#123;</span><br><span class="line">cout &lt;&lt;  i &lt;&lt; <span class="string">&quot;：&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j])<span class="comment">//遍历顶点指向的边 </span></span><br><span class="line">cout &lt;&lt; e[j] &lt;&lt; <span class="string">&quot; idx(&quot;</span> &lt;&lt; j &lt;&lt; <span class="string">&quot;) -&gt; &quot;</span>;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">init</span>();</span><br><span class="line"><span class="built_in">add</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">5</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">5</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">disp</span>(); </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="有边权图"><a href="#有边权图" class="headerlink" title="有边权图"></a>有边权图</h2><h3 id="存储结构-1"><a href="#存储结构-1" class="headerlink" title="存储结构"></a>存储结构</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000</span>, M = N * <span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> h[N], e[M], w[M], ne[M], idx;</span><br></pre></td></tr></table></figure><blockquote><p><code>h[i]</code> 表示第 <code>i</code> 个结点的头节点</p><p><code>e[i]</code> 表示第 <code>i</code> 个节点在图中对应的编号</p><p><code>w[i]</code> 表示第 <code>i</code> 条边的边权</p><p><code>ne[i]</code> 表示第 <code>i</code> 个节点的下一个节点所在的下标，也就是边</p><p><code>idx</code> 表示下一个新添节点的下标</p></blockquote><h3 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="built_in">sizeof</span>(h));</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="加边操作-1"><a href="#加边操作-1" class="headerlink" title="加边操作"></a>加边操作</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加边， a-&gt;b ， 边权为 c</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">e[idx] = b, w[idx] = c, ne[idx] = h[a], h[a] = idx++;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="遍历操作-1"><a href="#遍历操作-1" class="headerlink" title="遍历操作"></a>遍历操作</h3><blockquote><p>有边权图的遍历其实就只是比无边权的多输出<code>w[j]</code>的值而已。</p></blockquote><h4 id="普通遍历-1"><a href="#普通遍历-1" class="headerlink" title="普通遍历"></a>普通遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通遍历 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (h[i] != <span class="number">-1</span>) &#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot;: &quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line">cout &lt;&lt; e[j] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; w[j] &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; j &lt;&lt; <span class="string">&quot;) -&gt; &quot;</span>; </span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="dfs遍历-1"><a href="#dfs遍历-1" class="headerlink" title="dfs遍历"></a>dfs遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// dfs遍历 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">st[i] = <span class="literal">true</span>;</span><br><span class="line">cout &lt;&lt; i;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[i]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot; -(&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; w[j] &lt;&lt; <span class="string">&quot;&gt; &quot;</span>;</span><br><span class="line"><span class="built_in">dfs</span>(e[j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="bfs遍历-1"><a href="#bfs遍历-1" class="headerlink" title="bfs遍历"></a>bfs遍历</h4><p>bfs遍历带权图很麻烦，带权图还是用dfs遍历算了。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">qu[++rear] = i;</span><br><span class="line">st[i] = <span class="literal">true</span>;</span><br><span class="line">n[i] = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> father = i;</span><br><span class="line"><span class="keyword">while</span> (front != rear) &#123;</span><br><span class="line"><span class="type">int</span> t = qu[++front];</span><br><span class="line"><span class="keyword">if</span> (n[father] == <span class="number">0</span>) &#123;</span><br><span class="line">father = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = h[t]; j != <span class="number">-1</span>; j = ne[j]) &#123;</span><br><span class="line"><span class="keyword">if</span> (!st[e[j]]) &#123;</span><br><span class="line">qu[++rear] = e[j];</span><br><span class="line">quw[++rearw] = w[j];</span><br><span class="line">st[e[j]] = <span class="literal">true</span>;</span><br><span class="line">n[t]++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (frontw == rearw) &#123;</span><br><span class="line">cout &lt;&lt; t;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; t &lt;&lt; <span class="string">&quot; -(&quot;</span> &lt;&lt; father &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; quw[++frontw] &lt;&lt; <span class="string">&quot;&gt; &quot;</span>;</span><br><span class="line">n[father]--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 图论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图的存储</title>
      <link href="/posts/2516528882.html"/>
      <url>/posts/2516528882.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>树是一种特殊的图。树是有向无环图。</p><p>无向图是一种特殊的有向图。相当于<code>a-&gt;b &amp;&amp; b-&gt;a</code>需要建立两个方向的联系。</p></blockquote><p><span style="background: pink">下面考虑如何存储有向图</span></p><ul><li><p>邻接矩阵</p><p>  <code>g[a][b]</code>存储<code>a-&gt;b</code>（一般用0，1表示。0表示<code>!a-&gt;b</code>，1表示<code>a-&gt;b</code>。或者也可以用bool来表示）。如果有权重的话<code>g[a][b]</code>就存储权重（还是0表示<code>!a-&gt;b</code>，只要不是0就是<code>a-&gt;b</code>）。</p><p>  空间复杂度 $O(n^2)$ 所以使用较少。比较适合存储稠密图，否则空间浪费大。</p></li><li><p>邻接表</p><p>  是一种特殊的单链表。每一个点都有一个单链表（这个单链表存这个点能够走到的点）。</p></li></ul><h1 id="邻接表存储"><a href="#邻接表存储" class="headerlink" title="邻接表存储"></a>邻接表存储</h1><p>V表示点，e表示边。</p><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">ANode</span> &#123;<span class="comment">// 边节点 </span></span><br><span class="line"><span class="type">int</span> adjvex;<span class="comment">// 该边的邻接点编号</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ANode</span>* nextarc;<span class="comment">// 指向下一条边的指针</span></span><br><span class="line"><span class="type">int</span> weight;<span class="comment">// 该边的权重 </span></span><br><span class="line">&#125; ArcNode;<span class="comment">// 边节点的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;<span class="comment">// 头节点 </span></span><br><span class="line">infoType info<span class="comment">// 顶点的其他信息 </span></span><br><span class="line">ArcNode* firstarc;<span class="comment">// 指向第一个边的指针 </span></span><br><span class="line">&#125; VNode; <span class="comment">// 邻接表头节点类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">VNode adjlist[MaxV];<span class="comment">// 邻接表头结点数组</span></span><br><span class="line"><span class="type">int</span> n, e;<span class="comment">// 图中的顶点数n, 边数e </span></span><br><span class="line">&#125; AdjGraph;<span class="comment">// 完整的图邻接表类型 </span></span><br></pre></td></tr></table></figure><h2 id="运算-利用邻接矩阵创建图"><a href="#运算-利用邻接矩阵创建图" class="headerlink" title="运算(利用邻接矩阵创建图)"></a>运算(利用邻接矩阵创建图)</h2><p>利用邻接矩阵A创建图。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateAdj</span><span class="params">(AdjGraph*&amp; G,<span class="type">int</span> A[MaxV][MaxV], <span class="type">int</span> n, <span class="type">int</span> e)</span> </span>&#123;</span><br><span class="line">    ArcNode *p;</span><br><span class="line">G = (AdjGraph*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(AdjGraph));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">G-&gt;adjlist[i].firstarc = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = n<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line"><span class="keyword">if</span> (A[i][j] != <span class="number">0</span> &amp;&amp; A[i][j] != INF) &#123;<span class="comment">// 存在一条边 </span></span><br><span class="line"><span class="comment">// 申请内存 </span></span><br><span class="line">p = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line"><span class="comment">// 存储信息 </span></span><br><span class="line">p-&gt;adjvex = j;</span><br><span class="line">p-&gt;weight = A[i][j];</span><br><span class="line"><span class="comment">// 头插法插入节点 </span></span><br><span class="line">p-&gt;nextarc = G-&gt;adjlist[i].firstarc;</span><br><span class="line">G-&gt;adjlist[i].firstarc = p;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">G-&gt;n = n;</span><br><span class="line">G-&gt;e = e; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图的遍历输出</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispAdj</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; :&quot;</span>;</span><br><span class="line"><span class="comment">// 遍历链表 </span></span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">cout &lt;&lt; p-&gt;adjvex &lt;&lt; <span class="string">&#x27;[&#x27;</span> &lt;&lt; p-&gt;weight &lt;&lt; <span class="string">&#x27;]-&gt;&#x27;</span>;</span><br><span class="line">p = p-&gt;nextarc; </span><br><span class="line">&#125; </span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 销毁图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyAdj</span><span class="params">(AdjGraph*&amp; G)</span> </span>&#123;</span><br><span class="line">ArcNode* pre, *p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">pre = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">if</span> (pre != <span class="literal">NULL</span>) &#123;</span><br><span class="line">p = pre-&gt;nextarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">pre = p;</span><br><span class="line">p=p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(G);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxV 100010 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF INT_MAX</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> string infoType; <span class="comment">// 存储信息的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">ANode</span> &#123;<span class="comment">// 边节点 </span></span><br><span class="line"><span class="type">int</span> adjvex;<span class="comment">// 该边的邻接点编号</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ANode</span>* nextarc;<span class="comment">// 指向下一条边的指针</span></span><br><span class="line"><span class="type">int</span> weight;<span class="comment">// 该边的权重 </span></span><br><span class="line">&#125; ArcNode;<span class="comment">// 边节点的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;<span class="comment">// 头节点 </span></span><br><span class="line">infoType info;<span class="comment">// 顶点的其他信息 </span></span><br><span class="line">ArcNode* firstarc;<span class="comment">// 指向第一个边的指针 </span></span><br><span class="line">&#125; VNode; <span class="comment">// 邻接表头节点类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">VNode adjlist[MaxV];<span class="comment">// 邻接表头结点数组</span></span><br><span class="line"><span class="type">int</span> n, e;<span class="comment">// 图中的顶点数n, 边数e </span></span><br><span class="line">&#125; AdjGraph;<span class="comment">// 完整的图邻接表类型 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的创建</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateAdj</span><span class="params">(AdjGraph*&amp; G,<span class="type">int</span> A[MaxV][MaxV], <span class="type">int</span> n, <span class="type">int</span> e)</span> </span>&#123;</span><br><span class="line">ArcNode *p;</span><br><span class="line">G = (AdjGraph*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(AdjGraph));</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">G-&gt;adjlist[i].firstarc = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = n<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line"><span class="keyword">if</span> (A[i][j] != <span class="number">0</span> &amp;&amp; A[i][j] != INF) &#123;<span class="comment">// 存在一条边 </span></span><br><span class="line"><span class="comment">// 申请内存 </span></span><br><span class="line">p = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line"><span class="comment">// 存储信息 </span></span><br><span class="line">p-&gt;adjvex = j;</span><br><span class="line">p-&gt;weight = A[i][j];</span><br><span class="line"><span class="comment">// 头插法插入节点 </span></span><br><span class="line">p-&gt;nextarc = G-&gt;adjlist[i].firstarc;</span><br><span class="line">G-&gt;adjlist[i].firstarc = p;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">G-&gt;n = n;</span><br><span class="line">G-&gt;e = e; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的遍历输出</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispAdj</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; :&quot;</span>;</span><br><span class="line"><span class="comment">// 遍历链表 </span></span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">cout &lt;&lt; p-&gt;adjvex &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; p-&gt;weight &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">p = p-&gt;nextarc; </span><br><span class="line">&#125; </span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁图</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyAdj</span><span class="params">(AdjGraph*&amp; G)</span> </span>&#123;</span><br><span class="line">ArcNode* pre, *p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G-&gt;n; ++i) &#123;</span><br><span class="line">pre = G-&gt;adjlist[i].firstarc;</span><br><span class="line"><span class="keyword">if</span> (pre != <span class="literal">NULL</span>) &#123;</span><br><span class="line">p = pre-&gt;nextarc;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">pre = p;</span><br><span class="line">p=p-&gt;nextarc;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(pre);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(G);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> A[][MaxV] = &#123;</span><br><span class="line">&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>&#125;,<span class="comment">// &lt;0,1&gt;[2]  &lt;0,2&gt;[1]</span></span><br><span class="line">&#123;<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>&#125;,<span class="comment">// &lt;1,0&gt;[2]  &lt;1,2&gt;[3]</span></span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>&#125;<span class="comment">// &lt;2,0&gt;[1]  &lt;2,1&gt;[3]</span></span><br><span class="line">&#125;;</span><br><span class="line">AdjGraph* G;</span><br><span class="line"><span class="built_in">CreateAdj</span>(G, A, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">DispAdj</span>(G);</span><br><span class="line"><span class="built_in">DestroyAdj</span>(G);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="利用边关系构建图-添加边"><a href="#利用边关系构建图-添加边" class="headerlink" title="利用边关系构建图(添加边)"></a>利用边关系构建图(添加边)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MaxV 100010 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF INT_MAX</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> string infoType; <span class="comment">// 存储信息的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">ANode</span> &#123;<span class="comment">// 边节点 </span></span><br><span class="line"><span class="type">int</span> adjvex;<span class="comment">// 该边的邻接点编号</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ANode</span>* nextarc;<span class="comment">// 指向下一条边的指针</span></span><br><span class="line"><span class="type">int</span> weight;<span class="comment">// 该边的权重 </span></span><br><span class="line">&#125; ArcNode;<span class="comment">// 边节点的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;<span class="comment">// 头节点 </span></span><br><span class="line">infoType info;<span class="comment">// 顶点的其他信息 </span></span><br><span class="line">ArcNode* firstarc;<span class="comment">// 指向第一个边的指针 </span></span><br><span class="line">&#125; VNode; <span class="comment">// 邻接表头节点类型 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">VNode adjlist[MaxV];<span class="comment">// 邻接表头结点数组</span></span><br><span class="line"><span class="type">int</span> n, e;<span class="comment">// 图中的顶点数n, 边数e </span></span><br><span class="line">&#125; AdjGraph;<span class="comment">// 完整的图邻接表类型 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加有向边 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddVnode</span> <span class="params">(AdjGraph*&amp; G, <span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> weight)</span> </span>&#123; <span class="comment">// 添加 (a, b) </span></span><br><span class="line"><span class="comment">// 声明并初始化点 </span></span><br><span class="line">ArcNode* p;</span><br><span class="line">p = (ArcNode*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(ArcNode));</span><br><span class="line"><span class="comment">// 存储新边的信息 </span></span><br><span class="line">p-&gt;adjvex = b;<span class="comment">// 另一个点的编号 </span></span><br><span class="line">p-&gt;weight = weight;<span class="comment">// 到该点的权重 （边的权重） </span></span><br><span class="line"><span class="comment">// 添加到图中 </span></span><br><span class="line">p-&gt;nextarc = G-&gt;adjlist[a].firstarc;</span><br><span class="line">G-&gt;adjlist[a].firstarc = p;</span><br><span class="line"><span class="comment">// 更新图中的最大节点的编号 </span></span><br><span class="line"><span class="keyword">if</span> (a &gt; G-&gt;n) &#123;</span><br><span class="line">G-&gt;n = a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加无向边 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddVnode2</span> <span class="params">(AdjGraph*&amp; G, <span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> weight)</span> </span>&#123; <span class="comment">// 添加 &lt;a, b&gt; </span></span><br><span class="line"><span class="built_in">AddVnode</span>(G, a, b, weight);</span><br><span class="line"><span class="built_in">AddVnode</span>(G, b, a, weight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图的遍历输出</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DispAdj</span><span class="params">(AdjGraph* G)</span> </span>&#123;</span><br><span class="line">ArcNode* p;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= G-&gt;n; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (G-&gt;adjlist[i].firstarc == <span class="literal">NULL</span>)</span><br><span class="line"><span class="keyword">continue</span>; </span><br><span class="line">p = G-&gt;adjlist[i].firstarc;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; :&quot;</span>;</span><br><span class="line"><span class="comment">// 遍历链表 </span></span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">cout &lt;&lt; p-&gt;adjvex &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; p-&gt;weight &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">p = p-&gt;nextarc; </span><br><span class="line">&#125; </span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 声明并初始化 </span></span><br><span class="line">AdjGraph* G;</span><br><span class="line">G = (AdjGraph*)<span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(AdjGraph));</span><br><span class="line">G-&gt;n = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 添加双向边 </span></span><br><span class="line"><span class="built_in">AddVnode2</span>(G, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">AddVnode2</span>(G, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">AddVnode2</span>(G, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">AddVnode2</span>(G, <span class="number">2</span>, <span class="number">17</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// 遍历图 </span></span><br><span class="line"><span class="built_in">DispAdj</span>(G);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="适用于竞赛的邻接表"><a href="#适用于竞赛的邻接表" class="headerlink" title="适用于竞赛的邻接表"></a>适用于竞赛的邻接表</h2><p>首先需要先会数组实现链表。<a href="/posts/1120620192.html" title="数组实现链表">数组实现链表</a></p><p>使用数组模拟实现链表，再用模拟的链表实现的邻接表就是<strong>链式向前星</strong>。</p><p>下面具体讲<a href="/posts/2087796737.html" title="链式向前星">链式向前星</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 图论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 图论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数组实现链表</title>
      <link href="/posts/1120620192.html"/>
      <url>/posts/1120620192.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>常见的链表是利用结构体的，但是利用结构体的链表往往写法复杂，不适合用于算法编程竞赛中。<br>而数组模拟实现的链表就可以保证代码简洁且高效。</p></blockquote><h1 id="单链表"><a href="#单链表" class="headerlink" title="单链表"></a>单链表</h1><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> head, e[N], ne[N], idx;</span><br></pre></td></tr></table></figure><blockquote><p>其中：</p><ul><li><p><code>head</code> 表示头结点的下标 == first指针</p></li><li><p><code>e[i]</code> 表示第 <code>i</code> 个节点的值</p></li><li><code>ne[i]</code> 表示下一个节点所在的下标</li><li><code>idx</code> 表示下一个新建节点的下标</li></ul></blockquote><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><blockquote><p>头节点指向 -1</p><p>下一个节点所在下标设置为0</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">head = <span class="number">-1</span>;</span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="头插法添加节点"><a href="#头插法添加节点" class="headerlink" title="头插法添加节点"></a>头插法添加节点</h2><p>常规链表头插法添加节点：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CreateHead</span><span class="params">(LinkNode *&amp;head,ElemType a[],<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    LinkNode *cur;</span><br><span class="line">    head = <span class="keyword">new</span> LinkNode;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i++) &#123;</span><br><span class="line">        cur = <span class="keyword">new</span> LinkNode;</span><br><span class="line">        cur-&gt;data = a[i];</span><br><span class="line">        cur-&gt;next = head-&gt;next;</span><br><span class="line">        head-&gt;next = cur;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数组模拟实现：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 头插法添加节点 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">e[idx] = x;<span class="comment">// 赋值 </span></span><br><span class="line">ne[idx] = head;<span class="comment">// 下一个节点指向头结点 </span></span><br><span class="line">head = idx;<span class="comment">// 头结点指向新节点 </span></span><br><span class="line">idx++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>初始：<code>head = -1, idx = 0</code></p><p>存一个 1 ：<code>e[0] = 1, ne[0] = -1, head = 0, idx = 1</code></p><p>存一个 2 ：<code>e[1] = 2, ne[1] = 0, head = 1, idx = 2</code></p><p>存一个 3 ：<code>e[2] = 3, ne[2] = 1, head = 2, idx = 3</code></p><p>现在：<code>head -&gt; 3 -&gt; 2 -&gt; 1</code></p><p><code>i = head = 2; e[i] = e[2] = 3; i = ne[head] = ne[2] = 1;</code></p></blockquote><p>==所以可以看出，<code>head</code>一般是比较大的，<code>i</code> 是在一个减小的过程，最后一个 <code>i = 0</code>==</p><h2 id="插入节点"><a href="#插入节点" class="headerlink" title="插入节点"></a>插入节点</h2><p>在<code>idx</code>为<code>pos</code>的元素后添加新节点：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入节点 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos, <span class="type">int</span> x)</span> </span>&#123;<span class="comment">// 在插入到下标为pos的后一位 </span></span><br><span class="line">e[idx] = x;<span class="comment">// 赋值 </span></span><br><span class="line">    ne[idx] = ne[pos];<span class="comment">// 下一个节点为原本pos位置节点的下一个 </span></span><br><span class="line">    ne[pos] = idx;<span class="comment">// 原本位置的节点的下一个节点为新节点 </span></span><br><span class="line">    idx++;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>在第 <code>k</code> 个元素后添加一个新节点（从0开始数）：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert2</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> i = head;</span><br><span class="line"><span class="keyword">if</span> (head &lt; i) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">i = ne[i];</span><br><span class="line">k--;</span><br><span class="line">&#125;</span><br><span class="line">e[idx] = x;</span><br><span class="line">ne[idx] = ne[i];</span><br><span class="line">ne[i] = idx;</span><br><span class="line">idx++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h2><p>删除<code>idx</code>为<code>pos</code>的节点：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除节点 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> pos)</span> </span>&#123; <span class="comment">// 删除pos后面的一个节点 </span></span><br><span class="line">ne[pos] = ne[ne[pos]];</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="遍历链表"><a href="#遍历链表" class="headerlink" title="遍历链表"></a>遍历链表</h2><p>while 循环：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历链表</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> i = head;</span><br><span class="line"><span class="keyword">while</span> (i != <span class="number">-1</span>) &#123;</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">i = ne[i];</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></p><p>for 循环：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = head; i != <span class="number">-1</span>; i = ne[i]) &#123;</span><br><span class="line">        cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="完整模拟代码"><a href="#完整模拟代码" class="headerlink" title="完整模拟代码"></a>完整模拟代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> head, e[N], ne[N], idx; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">head = <span class="number">-1</span>;</span><br><span class="line">idx = <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 头插法添加节点 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">e[idx] = x;</span><br><span class="line">ne[idx] = head;</span><br><span class="line">head = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入节点 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos, <span class="type">int</span> x)</span> </span>&#123;<span class="comment">// 在插入到下标为pos的后一位 </span></span><br><span class="line">e[idx] = x;</span><br><span class="line">    ne[idx] = ne[pos];</span><br><span class="line">    ne[pos] = idx++;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二插入节点</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert2</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> i = head;</span><br><span class="line"><span class="keyword">if</span> (head &lt; i) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">i = ne[i];</span><br><span class="line">k--;</span><br><span class="line">&#125;</span><br><span class="line">e[idx] = x;</span><br><span class="line">ne[idx] = ne[i];</span><br><span class="line">ne[i] = idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除节点 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> pos)</span> </span>&#123; <span class="comment">// 删除pos后面的一个节点 </span></span><br><span class="line">ne[pos] = ne[ne[pos]];</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历链表</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">disp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = head; i != <span class="number">-1</span>; i = ne[i]) &#123;</span><br><span class="line">        cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">init</span>();</span><br><span class="line"><span class="built_in">add</span>(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">5</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">17</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">8</span>);</span><br><span class="line"><span class="built_in">disp</span>();</span><br><span class="line"><span class="built_in">insert</span>(<span class="number">2</span>,<span class="number">18</span>);</span><br><span class="line"><span class="built_in">insert2</span>(<span class="number">3</span>,<span class="number">19</span>);</span><br><span class="line"><span class="built_in">remove</span>(<span class="number">1</span>);</span><br><span class="line"><span class="built_in">disp</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="循环双链表"><a href="#循环双链表" class="headerlink" title="循环双链表"></a>循环双链表</h1><h2 id="存储结构-1"><a href="#存储结构-1" class="headerlink" title="存储结构"></a>存储结构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> e[N], l[N], r[N], idx;</span><br></pre></td></tr></table></figure><blockquote><p>其中：</p><ul><li><code>e[i]</code> 表示第 <code>i</code> 个节点的值</li><li><code>l[i]</code> 表示第 <code>i</code> 个节点的前一个节点所在的下标</li><li><code>r[i]</code> 表示第 <code>i</code> 个节点的后一个节点所在的下标</li><li><code>idx</code> 表示下一个新建节点的下标</li></ul></blockquote><h2 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h2><blockquote><p>设置节点0为起始节点，节点1为为尾节点，下标从2开始。不设head指针</p></blockquote><p>==注意：下面这样是不循环双向链表==</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    r[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    l[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    idx = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样是循环双向链表：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">r[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">l[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">l[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">r[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">idx = <span class="number">2</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>插入到<code>idx</code>为<code>k</code>的节点的右边：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">e[idx] = x;<span class="comment">// 赋值 </span></span><br><span class="line">l[idx] = k;<span class="comment">// 新节点的左节点 </span></span><br><span class="line">r[idx] = r[k];<span class="comment">// 新节点的右节点 </span></span><br><span class="line">    <span class="comment">// 下面两步要注意顺序，如果先改变了r[k]此时的l[r[k]]就会受到影响</span></span><br><span class="line">    l[r[k]] = idx;<span class="comment">// 原节点的右节点的左节点 </span></span><br><span class="line">r[k] = idx;<span class="comment">// 原节点的右节点 </span></span><br><span class="line">    idx++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>特殊位置插入：</p><ol><li><p>插入到<code>idx</code>为<code>k</code>的节点的左边：</p><p> <code>insert(l[k], x)</code></p></li><li><p>插入到第一个节点前</p><p> <code>insert(0, x)</code></p><p> 因为初始化时，第一个节点是 0</p></li><li><p>插入到最后一个节点后</p><p> <code>insert(l[1], x)</code></p><p> 因为初始化时，最后一个节点是 1</p></li></ol><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 删除idx为k的节点的</span></span><br><span class="line">r[l[k]] = r[k];</span><br><span class="line">l[r[k]] = l[k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><blockquote><p>可以分为向左遍历和向右遍历两种。两者的差异就是代码中的 <code>r</code> 和 <code>l</code></p><p>注意一般来说，<code>i = 0</code> 和 <code>i = 1</code> 的节点是不用输出的。</p></blockquote><p>向左遍历：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dispL</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 从下标为k的位置遍历链表 ,向左遍历 </span></span><br><span class="line"><span class="type">int</span> i = k;</span><br><span class="line"><span class="keyword">while</span> (l[i] != k) &#123;</span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">i = l[i];</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>向右遍历：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dispR</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 从下标为k的位置遍历链表 ,向右遍历 </span></span><br><span class="line"><span class="type">int</span> i = k;</span><br><span class="line"><span class="keyword">while</span> (r[i] != k) &#123;</span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">i = r[i];</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完整模拟代码-1"><a href="#完整模拟代码-1" class="headerlink" title="完整模拟代码"></a>完整模拟代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> e[N], l[N], r[N], idx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">r[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">l[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">l[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">r[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">idx = <span class="number">2</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> x)</span> </span>&#123; <span class="comment">// 在idx为k的节点后面插入一个新节点 </span></span><br><span class="line">e[idx] = x;<span class="comment">// 赋值 </span></span><br><span class="line">l[idx] = k;<span class="comment">// 新节点的左节点 </span></span><br><span class="line">r[idx] = r[k];<span class="comment">// 新节点的右节点 </span></span><br><span class="line">l[r[k]] = idx;<span class="comment">// 原节点的右节点的左节点 </span></span><br><span class="line">r[k] = idx;<span class="comment">// 原节点的右节点 </span></span><br><span class="line">idx++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 删除idx为k的节点的</span></span><br><span class="line">r[l[k]] = r[k];</span><br><span class="line">l[r[k]] = l[k];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dispR</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 从下标为k的位置遍历链表 ,向右遍历 </span></span><br><span class="line"><span class="type">int</span> i = k;</span><br><span class="line"><span class="keyword">while</span> (r[i] != k) &#123;</span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">i = r[i];</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dispL</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; <span class="comment">// 从下标为k的位置遍历链表 ,向左遍历 </span></span><br><span class="line"><span class="type">int</span> i = k;</span><br><span class="line"><span class="keyword">while</span> (l[i] != k) &#123;</span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">i = l[i];</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (i != <span class="number">0</span> &amp;&amp; i != <span class="number">1</span>)</span><br><span class="line">cout &lt;&lt; e[i] &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]-&gt;&quot;</span> ;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">init</span>();</span><br><span class="line"><span class="built_in">insert</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">insert</span>(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">insert</span>(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">dispR</span>(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">dispL</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构和算法 </category>
          
          <category> 基本原理 </category>
          
          <category> 链表 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构和算法 </tag>
            
            <tag> C++ </tag>
            
            <tag> 链表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动词时态</title>
      <link href="/posts/135355774.html"/>
      <url>/posts/135355774.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>动词的时态其实就是就是 动词时间 + 动词状态 。</p></blockquote><h1 id="动词时间"><a href="#动词时间" class="headerlink" title="动词时间"></a>动词时间</h1><ul><li>过去</li><li>现在</li><li>将来</li><li>过去将来</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-06%2019.39.25.jpg" alt="时间轴"></p><p>过去将来和现实没有必然关系：</p><p>例如，昨天是前天的过去将来。明天也是前天的过去将来。</p><p>过去将来比较复杂，但是出现比较少，一般出现在从句中。</p><p>这里就不分析了。</p><h1 id="动词状态"><a href="#动词状态" class="headerlink" title="动词状态"></a>动词状态</h1><ul><li><p>进行状态</p><p>  正在发生的动作</p></li><li><p>完成状态</p><p>  已经完成的状态</p><p>  注意完成时态并不关注动作开始的时间。</p></li><li><p>完成进行状态</p><p>  完成了一部分，但是没有完全完成，至于什么时候完全完成就不关注了。</p></li><li><p>一般状态</p><p>  默认情况，没有具体说明动作的状态。一般就是描述一个事实。</p></li></ul><h1 id="排列组合成时态"><a href="#排列组合成时态" class="headerlink" title="排列组合成时态"></a>排列组合成时态</h1><p>时态就是四种动词时间和四种动词状态排列组合形成了。这里不分析时间中的过去将来了。</p><ul><li><p>现在</p><ul><li><p>进行</p><p>  我现在正在写笔记。</p></li><li><p>完成</p><p>  我现在已经写完笔记了。</p></li><li><p>完成进行</p><p>  我已经写完了一部分笔记了，并且我在继续写。</p></li><li><p>一般状态</p><p>  我写笔记。</p></li></ul></li><li><p>过去</p><ul><li><p>进行</p><p>  昨天下午四点，我正在写笔记。</p></li><li><p>完成</p><p>  昨天下午四点，我就写完笔记了。</p></li><li><p>完成进行</p><p>  昨天下午四点，我写完了一部分笔记，在继续写剩下的笔记。</p></li><li><p>一般状态</p><p>  我昨天写了笔记。</p></li></ul></li><li><p>将来</p><ul><li><p>进行</p><p>  我明天下午四点正在写笔记。</p></li><li><p>完成</p><p>  我明天下午四点就写完笔记了。</p></li><li><p>完成进行</p><p>  我明天下午四点写完部分笔记了，会继续写</p></li><li><p>一般状态</p><p>  我将来会写笔记。</p></li></ul></li></ul><blockquote><p> 现在完成时态和一般过去时态可能会混淆：</p><ul><li>一般过去时态：指过去发生的事实，有那种为没有撒谎的感觉</li><li>现在完成时态：一般指代过去完主动完成了的动作，或者对说话这会儿有点影响。</li></ul></blockquote><h1 id="时态分类解析"><a href="#时态分类解析" class="headerlink" title="时态分类解析"></a>时态分类解析</h1><h2 id="现在"><a href="#现在" class="headerlink" title="现在"></a>现在</h2><h3 id="一般现实时态"><a href="#一般现实时态" class="headerlink" title="一般现实时态"></a>一般现实时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+动词原形</span><br><span class="line"></span><br><span class="line">+动词原形+s    （第三人称单数）</span><br></pre></td></tr></table></figure><p>举例：</p><ul><li>I <strong>eat</strong> carrots.</li><li>You <strong>eat</strong> carrots.</li><li>We <strong>eat</strong> carrots.</li><li>She <strong>eats</strong>  carrots.</li><li>The rabbit <strong>eats</strong> carrots.</li></ul><p>作用：</p><ol><li><p>表达事实，陈述事实</p><p> The rabbit <strong>eats</strong> carrots.</p><p> carrot加了s表示是指代食物，胡萝卜这一类食物。</p><p> 所以这句子就是在陈述，这只兔子吃胡萝卜这种食物的事实。</p><ul><li>The sun <strong>rise</strong> in the east.</li><li>The earth <strong>revolves</strong> around the sun.</li></ul></li><li><p>表达习惯/重复的动作</p><p> I <strong>write</strong> notes. 我写笔记（我有写笔记的习惯）</p></li><li><p>表示预计发生的事</p><p> The bus <strong>leaves</strong> at 8 P.M. every day.</p></li></ol><h3 id="现在进行时态"><a href="#现在进行时态" class="headerlink" title="现在进行时态"></a>现在进行时态</h3><p>构成方式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">助动词be的变位 + 动词的现在分词</span><br></pre></td></tr></table></figure><p>be的身份：</p><ol><li><p>系动词</p></li><li><p>助动词，用来构成时态</p><p> 现在进行时态的变位：</p><p> I                   <strong>am</strong></p><p> She/He/It     <strong>is</strong></p><p> You/we/the  <strong>are</strong></p></li></ol><p>举例：</p><ul><li>I <strong>am eating</strong> carrots.</li><li>You <strong>are watching</strong> my notes.</li></ul><p>作用：</p><p>表达现在正在进行的动作。</p><h3 id="现在完成时态"><a href="#现在完成时态" class="headerlink" title="现在完成时态"></a>现在完成时态</h3><p>作用：表达“已经”完成了的动作。</p><p>例如：</p><ul><li><p>我写过笔记。 </p></li><li><p>我<strong>有</strong>写过笔记，你<strong>有</strong>写过吗？</p></li></ul><p>构成方式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">助动词have的变位 + 动词的过去分词</span><br></pre></td></tr></table></figure><p>have的身份：</p><ol><li><p>实义动词：有</p></li><li><p>助动词，构成时态</p><ul><li>I/you/we/they  <strong>have</strong></li><li>She/He/It        <strong>has</strong></li></ul></li></ol><p>举例：</p><p>I <strong>have eaten</strong> carrots.我吃过胡萝卜。（言下之意：我曾经吃过这种食物，是只见过世面的兔子）。</p><h3 id="现在完成进行时态"><a href="#现在完成进行时态" class="headerlink" title="现在完成进行时态"></a>现在完成进行时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">助动词have的变位 + been + 动词的现在分词</span><br></pre></td></tr></table></figure><p>现在完成时态是 助动词 have 的变位 + 动词的过去分词。</p><p>现在进行时态是 助动词 be 的变位 + 动词的现在分词。</p><p>两者结合就是have + be的过去分词 + 动词的现在分词。即 have + been + 动词的现在分词。</p><p>I <strong>have been eating</strong> carrots.我已经吃了一些胡萝卜了，并且会继续吃。</p><h2 id="过去"><a href="#过去" class="headerlink" title="过去"></a>过去</h2><h3 id="一般过去时"><a href="#一般过去时" class="headerlink" title="一般过去时"></a>一般过去时</h3><p>其实就是将一般现在时的动词改成过去式就完事了。</p><p><strong>注意，不要将动词的过去式和过去分词搞混淆了。</strong></p><p>作用：</p><p>​    单纯指出动作发生了。动作发生多久，何时开始，何时结束都不考虑。</p><p>​    The rabbit <strong>ate</strong> a carrot.兔子吃了胡萝卜。（只知道这兔子过去某个时刻在吃胡萝卜）</p><p>表示过去的习惯：</p><p>​    I <strong>used</strong> to write notes.</p><h3 id="过去进行时态"><a href="#过去进行时态" class="headerlink" title="过去进行时态"></a>过去进行时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">助动词be的变位 + 动词的现在分词</span><br></pre></td></tr></table></figure><p>注意，这里的助动词的变位和现在时态不一样哦。</p><p>这里的助动词be的变位为：</p><p>I/She/He/It        <strong>was</strong></p><p>You/We/They    <strong>were</strong></p><p>举例：</p><p>The rabbit <strong>is eating</strong> a carrot.  =&gt; The rabbit <strong>was eating</strong> a carrot.</p><h3 id="过去完成时态"><a href="#过去完成时态" class="headerlink" title="过去完成时态"></a>过去完成时态</h3><p>在过去有两个时间当，B，A，B在A发生前。</p><p>因为现在完成时主要为了表达对现在的影响。那么过去完成时态就是为了表达B对A的影响。</p><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">助动词have的变位 + 动词的现在分词</span><br></pre></td></tr></table></figure><p>这里的have的变位就是 had 了。</p><p>举例：<br>The rabbit has eaten a carrot.  ==&gt;  The rabbit had eaten a carrot.（这兔子在过去某个时间点已经吃过胡萝卜了）。</p><h3 id="过去完成进行时态"><a href="#过去完成进行时态" class="headerlink" title="过去完成进行时态"></a>过去完成进行时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">助动词have变位 + been + 动词的现在分词</span><br></pre></td></tr></table></figure><p>这里的have的变位就是 had 了。</p><p>举例：</p><p>The rabbit has been eating a carrot.  ==&gt;  The rabbit had been eating a carrot.（这兔子在过去某个时间点已经吃胡萝卜一段时间了，还要在过去那个时间点之后继续吃一段时间）。</p><h2 id="将来"><a href="#将来" class="headerlink" title="将来"></a>将来</h2><h3 id="一般将来时态"><a href="#一般将来时态" class="headerlink" title="一般将来时态"></a>一般将来时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">will + 动词原形</span><br><span class="line">助动词be的变位 + going to + 动词的原形</span><br></pre></td></tr></table></figure><p>作用：<br>描述将来某个时间点发生的动作。（说话者十分确定会发生的事）</p><p>如果是十分确定就要利用“语气”了，后面在说。</p><h3 id="将来进行时态"><a href="#将来进行时态" class="headerlink" title="将来进行时态"></a>将来进行时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">will + be + 动词的现在分词</span><br></pre></td></tr></table></figure><p>作用：</p><p>描述在将来某个时间，某个动作是在进行的过程中。（也需要特别确定）</p><p>举例：</p><p>I will be eating a carrot for lunch tomorrow.（我明天午饭会在吃胡萝卜这个动作过程中）。</p><h3 id="将来完成时态"><a href="#将来完成时态" class="headerlink" title="将来完成时态"></a>将来完成时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">will + have + 动词的过去分词</span><br></pre></td></tr></table></figure><p>现在完成时态主要为了表达对现在的影响。</p><p>将来完成时态是为了表达，将来某一点（A）的过去（B）和现在的前后不确定对将来的那一点（A）的影响。<strong>先需要更加笃定</strong></p><p>The rabbit has eaten a carrot.  ==&gt;  The rabbit will have eaten a carrot.（这兔子在将来某个时间点已经吃了个胡萝卜。）</p><h3 id="将来完成进行时态"><a href="#将来完成进行时态" class="headerlink" title="将来完成进行时态"></a>将来完成进行时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">will + have + been + 动词的现在分词</span><br></pre></td></tr></table></figure><p>You have been reading my blog.  ==&gt;  You will have been reading my blog.（你在将来某个时间点之前已经看了我的博客一段时间了，还要在那个时间点之后继续看一段时间。）</p><h2 id="过去将来"><a href="#过去将来" class="headerlink" title="过去将来"></a>过去将来</h2><h3 id="一般过去将来时态"><a href="#一般过去将来时态" class="headerlink" title="一般过去将来时态"></a>一般过去将来时态</h3><p>构成方式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">would + 动词原形</span><br><span class="line">助动词be的变位 + going to + 动词的原形</span><br></pre></td></tr></table></figure><p>这里助动词be的变位就是：</p><p>I/She/He/It        <strong>was</strong></p><p>You/We/They    <strong>were</strong></p><blockquote><p>其他三种状态和过去将来这个时间组合的构成方式就是把 will 换成 would</p></blockquote><h1 id="总结复习"><a href="#总结复习" class="headerlink" title="总结复习"></a>总结复习</h1><p>回忆16种时态的组合情况。</p><p>每种时态 尝试造句。</p><p>不可心急，每周攻下来4种就可以炉火纯青了。</p>]]></content>
      
      
      <categories>
          
          <category> 英语学习 </category>
          
          <category> 英语语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 英语语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动词的分类</title>
      <link href="/posts/1375344716.html"/>
      <url>/posts/1375344716.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>之前在英语语法综述中已经提到过了，如果没有概念的话可以去补补。下面其实也就是大概的分类</p></blockquote><p>前面提到五大类谓语动词对应了五大句型<a href="/posts/1388991698.html" title="英语语法综述">简单句</a></p><p>即粗分类：</p><ul><li><p>可作谓语动词</p><ul><li><p>实义动词/行为动词</p><ul><li><p>按动作承受者（有无）划分</p><ul><li><p>不及物动词</p></li><li><p>及物动词</p></li></ul></li><li><p>按状态动作划分</p><ul><li>动作动词 eat…</li><li>状态动词 have、feel、own、believe…</li></ul></li></ul></li><li><p>系动词</p><p>  有些时候是单独分类，有些时候可以将它认为是不及物动词和状态动词</p></li></ul></li><li><p>不能独立作谓语动词（可辅助构成谓语动词）</p><ul><li>助动词</li><li>情态动词</li></ul></li><li><p>不可作谓语动词</p><ul><li>不定式</li><li>过去分词</li><li>现在分词</li><li>动名词</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 英语学习 </category>
          
          <category> 英语语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 英语语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>英语语法综述</title>
      <link href="/posts/1388991698.html"/>
      <url>/posts/1388991698.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>英语一直以来都是我的噩梦，今天是2023年2月6日，因为六级延期了，目前到六级考试还有一个半月。我决心开始学习六级。所以之后一段时间可能就是我过去的一些笔记和英语学习笔记穿插发到博客上了。</p></blockquote><p><details>此文章是我看 B站 英语兔 时做的笔记</details></p><h1 id="英语语法综述"><a href="#英语语法综述" class="headerlink" title="英语语法综述"></a>英语语法综述</h1><p>这里是简述英语语法中的一些内容，主要是一些<strong>名词解释</strong>，对于理解更高深的知识有帮助。</p><p>注意，这篇文章的核心是动词。英语语法的核心也是动词，它能够讲语法中的所有概念串联起来。</p><h2 id="简单句"><a href="#简单句" class="headerlink" title="简单句"></a>简单句</h2><p>研究英语语法应当从<strong>简单句</strong>开始研究。因为长句基本就是简单句的排列组合，是简单句的拼接。 </p><p>在<strong>简单句</strong>中除去<del>感叹句、省略句、（向整句提问的）问句</del>可分为：<strong>什么</strong>+<strong>怎么样</strong></p><p><strong>什么</strong>和<strong>怎么样</strong>就对应了两个最基本的<strong>句子成分（Clause Elements）</strong>，<strong>什么</strong>对应<strong>主语（subject）</strong>、<strong>怎么样</strong>对应<strong>谓语（predicate）</strong></p><blockquote><p>所以几乎所以英语<strong>简单句</strong>都是 <strong>主语</strong> + <strong>谓语</strong> 的结构</p></blockquote><ul><li><p><strong>主语</strong> ： 就是很简单的研究对象——人或物</p></li><li><p><strong>谓语 </strong>： 广义上的 <strong>动作</strong>或<strong>发生了什么事</strong></p><ul><li><p><strong>动作</strong>：并不是狭义上的要动起来的动作。这个广义的动作就是指的是<strong>动词（Verbs）</strong> </p><ol><li><p>可以独立完成的动作，没有承受者</p><ul><li><p>Papa Rabbit <span style="background-color: orange">sleeps</span>. ——兔老爹<span style="background-color: orange">睡觉</span>。</p><p>  这样没有承受者的动词就叫做<strong>不及物动词（intransitive verbs）</strong></p><p>  即 <span style="background-color: cyan">主语</span> + <span style="background-color: orange"><strong>不及物动词</strong></span></p></li></ul></li><li><p>有 <strong>1</strong> 个动作的承受者</p><ul><li><p>Papa Rabbit <span style="background-color: orange">likes</span> <span style="background-color: yellow">you</span>.——兔老爹<span style="background-color: orange">喜欢</span><span style="background-color: yellow">你</span>。</p><p>  像<strong>喜欢</strong>这样的动词<strong>没有承受者就没有实际意义</strong>，一般表达什么“我喜欢”其实是“我喜欢（这个、这样）”的省略句。这样的动词属于<strong>及物动词（transitive verbs）</strong>；只有一个动作承受者的及物动词又属于及物动词中的<strong>单及物动词（monotransitive verbs）</strong>。</p><p>  这个例句的承受者就是<strong>宾语</strong>（you）。</p><p>  即 <span style="background-color: cyan">主语</span> + <span style="background-color: orange">单及物动词</span> + <span style="background-color: yellow">宾语</span></p></li><li><p>Papa Rabbit <span style="background-color: orange">considers</span> <span style="background-color: yellow">me</span> smart. ——兔老爹<span style="background-color: orange">认为</span><span style="background-color: yellow">我</span>聪明。</p><p>  这个句子也是只有一个动作的承受者，也就是宾语“我”。</p><p>  但是表达：“兔老爹认为我”这样的句子明显就是不完整的。但是宾语后面的“聪明“又不是另一个动词承受者。</p><p>  即 <strong>considers</strong> 这样的动词，后面跟一个承受者，但是必须要有个补充承受的的信息（聪明）才意义完整，这个补充信息叫做<strong>补语或补足语（complement）</strong>。这里的smart是补充宾语的信息，所以就是<strong>宾语补语（object complement）</strong>，即宾补。这样需要补语的动词称为<strong>复杂及物动词（complex- transitive verbs）</strong>。</p><p>  即 <span style="background-color: cyan">主语</span> + <span style="background-color: orange">复杂及物动词</span> + <span style="background-color: yellow">宾语</span> + <span style="background-color: lightgreen">（宾语）补足语</span></p></li></ul></li><li><p>有 <strong>2</strong> 个动作的承受者</p><ul><li><p>Papa Rabbit <span style="background-color: orange">teaches</span> <span style="background-color: yellow">my</span> <span style="background-color: pink">English</span>.——兔老爹<span style="background-color: orange">教</span><span style="background-color: yellow">我</span><span style="background-color: pink">英语</span>。</p><p>  像这个句子中有两个动作的承受者，一个是 “我”，另一个是“英语”。</p><p>  一个就是<strong>直接宾语（direct object）</strong>、另一个是<strong>间接宾语（indirect object）</strong></p><p>  分析句子：</p><ul><li>兔老爹教英语。单独理解也能感觉到句子是完整的，所以“英语”在这里就是直接宾语。</li><li><p>兔老爹教我。如果没有上下文的话，会感觉橘子是不完整的，所以“我”在这里是间接宾语。</p><p>像这样的动词，<strong>teach</strong>，其实也是及物动词，是及物动词分类中的<strong>双及物动词（ditransitive verbs）</strong></p><p>即 <span style="background-color: cyan">主语</span> +  <span style="background-color: orange">双及物动词</span>  + <span style="background-color: yellow">间接宾语</span> +  <span style="background-color: pink">直接宾语</span></p></li></ul></li></ul></li><li><p>非“动作”</p><ul><li><p>Papa Rabbit <span style="background-color: orange">is</span> tall. ——兔老爹是高的。</p><p>  is 这类词语在翻译时常被翻译为“是”，它的作用是把这个动词之后的信息赋予给前面的主语。</p><p>  即 ： <em>Papa Rabbit &lt;== tall.</em></p><p>  同理：Papa Rabbit looks tall.    ==    <em>Papa Rabbit &lt;== tall</em></p><p>  像这样的 赋予 <strong>主语</strong> <strong>某种性质状态</strong> 的可以“划等号”的动词，叫做<strong>连系动词或系动词（linking verbs）</strong></p><p>  而这样的<strong>某种性质状态</strong> 也是补足语，更准确来说是主语补足语。而在主语补足语又叫<strong>表语（predicative）</strong></p><p>  即 <span style="background-color: cyan">主语</span> +  <span style="background-color: orange">系动词</span>  + <span style="background-color: yellow">（主语）补语/表语</span></p></li></ul></li></ol></li></ul></li></ul><p>总结一下，上面看似在介绍谓语的类型，其实同时也引出的大部分英语句子的句子成分，和所有的基本句型。</p><h2 id="谓语动词"><a href="#谓语动词" class="headerlink" title="谓语动词"></a>谓语动词</h2><ol><li>不及物动词</li><li>单及物动词</li><li>双及物动词</li><li>复杂及物动词</li><li>连系动词</li></ol><p>中文动词中的三大本领：（时间Tense、状态Aspect、语气Mood）合称TAM。</p><ul><li><p>时态（因为中文的动词没有这个特性，所以是学习英语的难点）</p><p>  时间 + 状态</p><ol><li><p>表示动作时间，过去或将来</p><ol><li><p>现在</p></li><li><p>过去</p></li><li><p>将来</p></li><li><p>过去将来</p><p> 对于过去某个时间点来说算是它的将来</p></li></ol></li><li><p>表示动作的状态，已经完成或正在进行</p><ol><li><p>一般</p></li><li><p>完成</p></li><li><p>进行</p></li><li><p>完成进行</p><p> 已经完成并且会继续</p></li></ol><p>时间和状态排列组合理论上就由16中时态。</p></li></ol></li><li><p>语气</p><p>  表示动作的假设、情感…</p><ol><li>虚拟语气。用来表示意愿、和事实相反的假设等。</li><li>陈述语气。</li><li>祈使语气。</li></ol></li></ul><p><strong>说明：</strong></p><p>谓语动词单独一个词无法完成这些本领，也无法单独表示否定、可能、必须等意思。它需要<a href="#助动词">助动词（Auxiliary Verbs）</a>，帮助它完成这些表达</p><h2 id="基本句型"><a href="#基本句型" class="headerlink" title="基本句型"></a>基本句型</h2><ol><li><p>无需承受者（宾语）：主语 + 不及物动词</p></li><li><p>一个宾语，无须补充信息：主语 + 单及物动词 + 宾语</p></li><li><p>两个宾语：主语 + 双及物动词 + 间接宾语 + 直接宾语</p></li><li><p>一个宾语，需要补充信息：主语 + 复杂及物动词 + 宾语 + 宾语补语</p></li><li><p>赋予信息：主语 + 系动词 + 主语补语/表语 </p></li></ol><p>注意，谓语和谓语动词不一样。注意后面的内容就是谓语，而谓语动词只是谓语的一部分，即 谓语 <script type="math/tex">\supseteq</script> 谓语动词。但是有些分类标准将谓语等同于谓语动词，所以说常见句子句型是主谓宾（这里还是说主谓）。</p><h2 id="句子成分"><a href="#句子成分" class="headerlink" title="句子成分"></a>句子成分</h2><ol><li>主语</li><li>谓语动词</li><li>宾语</li><li>宾语补语</li><li>主语补语</li></ol><p>除了上面提到的还有：</p><ol><li><p>定语（Attributive）：主要用嘞修饰主语或宾语，如：</p><p> <span style="background-color: lightgreen">The little white</span> rabbit ate <span style="background: pink">a large</span> carrot.——这只小白兔吃了一根大胡萝卜。</p><ul><li><p>The little white 就是 主语（rabbit）的定语，用来修饰rabbit的</p></li><li><p>a large 就是 宾语（carrot）的定语。</p></li></ul></li><li><p>状语（Adverbial）：主要用来修饰谓语动词，如：</p><p> The rabbit ate <span style="background: pink">quickly</span>.——兔子快速地吃</p><ul><li>quickly 就是 谓语动词（ate）的状语</li></ul></li><li><p>同位语（Appositive）：主要用于把主语或宾语再说一遍，如：</p><p> Papa Rabbit,<span style="background: lightgreen">an English teacher</span>,eats carrots.——兔老爹，一个英语教师，吃胡萝卜。</p><ul><li>an English teacher 其实就是把 Papa Rabbit 用不同的方式，不同的形容再说了一遍。在这里是和主语同等地位。</li></ul></li></ol><p>注意：插入语是独立的，不作句子成分，这里不列举。</p><h2 id="复杂句"><a href="#复杂句" class="headerlink" title="复杂句"></a>复杂句</h2><p>复杂句分为两种：复合句/并列句Compound Sentence和 Complex Sentences</p><ul><li><p>Compound Sentence</p><p>  其实即使句子的简单叠加，是<strong>并列关系</strong>。</p></li><li><p>Complex Sentence</p><p>  其实就是像套娃一样，一个句子套一个句子，再套句子….一直套下去。是<strong>从属关系</strong>。</p><p>  外层的句子叫做主句（Main Clause），内层被套的句子叫做从句（Subordinate Clause）。</p><p>  <strong>从句</strong>其实就是把简单句修改了一下，来充当另一个句子（主句）的句子成分。</p><ul><li><p>名词性从句</p><p>  具有名词性子的从句，称为名词性从句</p><ul><li><p>修改后充当主句的主语：主语从句</p></li><li><p>修改后充当主句的宾语：宾语从句</p></li><li><p>修改后充当主句的表语：表语从句</p></li><li><p>修改后充当主句的同位语：同位语从句</p></li></ul></li><li><p>修改后充当主句的定语：定语从句</p></li><li><p>修改后充当主句的状语：状语从句</p></li></ul></li></ul><h2 id="词性（词类）"><a href="#词性（词类）" class="headerlink" title="词性（词类）"></a>词性（词类）</h2><p>对于相同的句子句型可能包含不同的词，例如：</p><p>主语 + 谓语动词 + 宾宾语</p><p>The rabbit   ate     a carrot.</p><p>He             saw    something over there.</p><p>所以这里需要引入词性（词类）的概念了。</p><ol><li>动词（verbs）：<a href="#谓语动词">谓语动词</a></li><li><p>名词（nouns）：表人和物</p><ul><li>Papa Rabbit is a <span style="background: lightgreen">rabbit</span></li></ul></li><li><p>冠词（articles）：说明人和事物</p><ul><li>Papa Rabbit is <span style="background: lightgreen">a</span> rabbit.</li></ul></li><li>代词（pronouns）：替代人和物<ul><li><span style="background: lightgreen">I</span> am a rabbit.</li></ul></li><li>形容词（adjectives）：形容人和物<ul><li>I am a <span style="background: lightgreen">smart</span> rabbit.</li></ul></li><li>数词（numerals）：表数量<ul><li>I ate <span style="background: lightgreen">two</span> carrots.</li></ul></li><li>副词（adverbs）：修饰 动作（不要狭义理解为动词） 或 形容词 <strong>等</strong>，如：<ul><li>I ate two carrots <span style="background: lightgreen">quickly</span>.</li></ul></li><li>介词（prepositions）：表示和其他词 <strong>关系</strong> 的词<ul><li>I ate two carrots <span style="background: lightgreen">with</span> chopsticks.</li></ul></li><li>叹词（interjections）：表示感叹<ul><li><span style="background: lightgreen">Ah</span>,the carrot is tasty!</li></ul></li><li>连词（conjunctions）：用来链接词语和句子<ul><li>I ate two carrots and a potato, <span style="background: lightgreen">because</span> I was hungry.</li></ul></li></ol><p><strong>注意：句子成分 <script type="math/tex">\neq</script> 词类。是完全不同的两个概念。</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-02-06%2016.57.50.png" alt="截屏2023-02-06 16.57.50" style="zoom: 33%;" /></p><p>这里面每一种句子成分，除了谓语动词是动词，其他都有可能包含不同的词类。</p><h2 id="助动词"><a href="#助动词" class="headerlink" title="助动词"></a>助动词</h2><p>这里是<a href="#谓语动词">谓语动词</a>的续讲。</p><p>助动词的职责就是协助谓语动词完成谓语动词的”本领”。</p><p>用谓语动词： eat 吃 来举例： </p><ul><li><p>（协助）表示“吃过了（完成）”</p><p>  助动词： have</p><p>  have eaten</p></li><li><p>（协助）表示“正在吃（进行）”</p><p>  助动词：be</p><p>  is eating</p></li><li><p>（协助）表示“被吃”</p><p>  助动词：be</p><p>  is eaten</p></li><li><p>（协助）表示“有能力吃”</p><p>  助动词：can</p><p>  can eat</p></li><li><p>（协助）表示“有可能吃”</p><p>  助动词：might</p><p>  might eat</p></li><li><p>（协助）表示“有义务吃”</p><p>  助动词：must</p><p>  must eat</p></li><li><p>（协助）表示“不吃（否定）”</p><p>  助动词：do</p><p>  do not eat</p></li></ul><p>注意，很多助动词都喜欢伪装，也就是除了可以当助动词意外，还有别的词性和意思。所以千万不要弄混淆了。</p><h2 id="非谓语动词"><a href="#非谓语动词" class="headerlink" title="非谓语动词"></a>非谓语动词</h2><p>非谓语动词也是动词，但是它不是谓语，而且很厉害的一点就是它可以充当句子的主语、宾语、宾语补语、主语补语、定语等。甚至它几乎可以取代所有的从句，从而简化句子，但是这样的动词就不再有表示动作的时间状态，语态，语气的功能了。</p><p>它们一般以这些形式出现在句中：</p><ol><li>动词不定式</li><li>现在分词</li><li>动名词</li><li>过去分词 </li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>英语大部分的句子的框架：</p><p>以动词为核心：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/grammer_1.jpg" alt="语法基本框架" style="zoom:50%;" /></p><p>首先在<a href="#简单句">简单句</a>部分引出了谓语动词的五种分类和五种基本句型，以及五种基本句子成分。</p><p>之后在<a href="#句子成分">句子成分</a>部分补充了剩下三种句子成分。</p><p>在简单句中引入了复杂句的概念，有复合句和复杂杂。复杂句有主句和从句。</p><p>再引出词类 用来完成句子的表达。</p><p>在<a href="#谓语动词">谓语动词</a>部分介绍了谓语动词的三大本领，引出了<a href="#助动词">助动词</a>。</p><p>最后补充介绍<a href="#非谓语动词">非谓语动词</a>，并且介绍非谓语动词可以充当句子的非谓语的其他的句子成分，基本可以替代从句。</p><h2 id="复习"><a href="#复习" class="headerlink" title="复习"></a>复习</h2><p>复习是实事求是才真正能够有大提升哦。</p><ol><li>谓语动词的五种基本分类（忘了就从<a href="#简单句">简单句</a>再看一遍）</li><li>谓语动词的三大本领（<a href="#谓语动词">谓语动词</a>）</li><li>五大基本句型（<a href="#基本句型">基本句型</a>）</li><li>八种句子成分（<a href="#句子成分">句子成分</a>）</li><li>复杂句的两类（<a href="#复杂句">复杂句</a>）</li><li>十种词性（词类）（<a href="#词性（词类）">词性</a>）</li><li>助动词的作用（<a href="#助动词">助动词</a>）</li><li>非谓语动词的基本作用（<a href="#非谓语动词">非谓语动词</a>）</li></ol>]]></content>
      
      
      <categories>
          
          <category> 英语学习 </category>
          
          <category> 英语语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 英语语法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet and JSP</title>
      <link href="/posts/1021360842.html"/>
      <url>/posts/1021360842.html</url>
      
        <content type="html"><![CDATA[<details>此笔记是我学习 B站 动力节点 老杜 老师 课程的学习笔记</details><blockquote><p>完成本文章的学习，你基本可以实现一个简易的网站了。不过建议你先提前了解一下前端三大件的基础知识。JSP部分现在基本被淘汰了，可以跳过。</p></blockquote><h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><h2 id="关于如何写地址"><a href="#关于如何写地址" class="headerlink" title="关于如何写地址"></a>关于如何写地址</h2><p>想要明白如何写地址要先明白层级关系<br>要明白的是:对于同一个webapp来说,是在同一个项目下的,所以两个Servlet之间相互调用是不需要在路径上加项目名的,但是冲浏览器端请求过来,就要加上项目名.<br>同时这个图也能理解Servlet之间的关系,Content的关系,request和response的关系,也能理解webapp与其他webapp的关系(一个项目(同一个项目名下的东西)其实就是一个webapp)</p><h2 id="关于系统架构"><a href="#关于系统架构" class="headerlink" title="关于系统架构"></a>关于系统架构</h2><ol><li>系统架构包括什么形式？<ul><li>C/S架构</li><li>B/S架构</li></ul></li><li>C/S架构？<ul><li>Client / Server（客户端 / 服务器）</li><li>C/S架构的软件或者说系统有哪些呢？<ul><li>QQ（先去腾讯官网下载一个QQ软件，几十MB，然后把这个客户端软件安装上去，然后输入QQ号以及密码，登录之后，就可以和你的朋友聊天了，就可以使用这个软件了。）</li></ul></li><li>C/S架构的特点：需要安装特定的客户端软件。</li><li>C/S架构的系统优点和缺点分别是什么？<ul><li>优点：<ul><li>速度快（软件中的数据大部分都是集成到客户端软件当中的，很少量的数据从服务器端传送过来，所以C/S结构的系统速度快）</li><li>体验好（速度又快，界面又酷炫，当然体验好了。）</li><li>界面酷炫（专门的语言去实现界面的，更加灵活。）</li><li>服务器压力小（因为大量的数据都是集成在客户端软件当中，所以服务器只需要传送很少的数据量，当然服务器压力小。）</li><li>安全（因为大量的数据是集成在客户端软件当中的，并且客户端有很多个，服务器虽然只有一个，就算服务器那边地震了，火灾了，服务器受损了，问题也不大，因为大量的数据在多个客户端上有缓存，有存储，所以从这个方面来说，C/S结构的系统比较安全。）</li><li>…..</li></ul></li><li>缺点：<ul><li>升级维护比较差劲。（升级维护比较麻烦。成本比较高。每一个客户端软件都需要升级。有一些软件不是那么容易安装的。）</li></ul></li></ul></li></ul></li><li>B/S架构？<ul><li>B/S（Browser / Server，浏览器 / 服务器）</li><li><a href="http://www.baidu.com">http://www.baidu.com</a></li><li><a href="http://www.jd.com">http://www.jd.com</a></li><li><a href="http://www.126.com">http://www.126.com</a></li><li>B/S结构的系统是不是一个特殊的C/S系统？<ul><li>实际上B/S结构的系统还是一个C/S，只不过这个C比较特殊，这个Client是一个固定不变浏览器软件。</li></ul></li><li>B/S结构的系统优点和缺点是：<ul><li>优点：<ul><li>升级维护方便，成本比较低。（只需要升级服务器端即可。）</li><li>不需要安装特定的客户端软件，用户操作极其方便。只需要打开浏览器，输入网址即可。</li></ul></li><li>缺点：<ul><li>速度慢（不是因为带宽低的问题，是因为所有的数据都是在服务器上，用户发送的每一个请求都是需要服务器全身心的响应数据，所以B/S结构的系统在网络中传送的数据量比较大。）</li><li>体验差（界面不是那么酷炫，因为浏览器只支持三个语言HTML CSS JavaScript。在加上速度慢。）</li><li>不安全（所有的数据都在服务器上，只要服务器发生火灾，地震等不可抗力，最终数据全部丢失。）</li><li>….</li></ul></li></ul></li></ul></li><li>C/S和B/S结构的系统，哪个好，哪个不好？<ul><li>这个问题问的没有水平。并不是哪个好，哪个不好。不同结构的系统在不同的业务场景下有不同的适用场景。</li><li>娱乐性软件建议使用？<ul><li>C/S 结构</li></ul></li><li>公司内部使用的一些业务软件建议使用？<ul><li>公司内部使用的系统，需要维护成本低。</li><li>公司内部使用的系统，不需要很酷炫。</li><li>公司内部使用的企业级系统主要是能够进行数据的维护即可。</li><li>B/S 结构。</li></ul></li></ul></li><li>注意了：开发B/S结构的系统，其实就是开发网站，其实就是开发一个WEB系统。<ul><li>开发一个WEB系统你需要会哪些技术？<ul><li>WEB前端（运行在浏览器上的程序。）<ul><li>HTML</li><li>CSS</li><li>JavaScript</li></ul></li><li>WEB后端（WEB服务器端的程序。）<ul><li>Java可以（Java做WEB开发我们称为JavaWEB开发。JavaWEB开发最核心的规范：Servlet【Server Applet服务器端的Java小程序。】）</li><li>C语言也可以</li><li>C++也可以</li><li>Python也行</li><li>PHP也可以</li><li>….</li></ul></li></ul></li></ul></li><li>JavaEE是什么？<ul><li>Java包括三大块：<ul><li>JavaSE<ul><li>Java标准版（一套类库：别人写好的一套类库，只不过这个类库是标准类库，走EE，或者走ME，这个SE一定是基础，先学。）</li></ul></li><li>JavaEE（WEB方向，WEB系统。）<ul><li>Java企业版（也是一套类库：也是别人写好的一套类库，只不过这套类库可以帮助我们完成企业级项目的开发，专门为企业内部提供解决方案的一套（多套）类库。）</li><li>别人写好的，你用就行了，用它可以开发企业级项目。</li><li>可以开发web系统。</li><li>Java比较火爆的就是这个JavaEE方向。</li></ul></li><li>JavaME<ul><li>Java微型版（还是一套类库，只不过这套类库帮助我们进行电子微型设备内核程序的开发）</li><li>机顶盒内核程序，吸尘器内核程序，电冰箱内核程序，电饭煲内核程序。。。。。</li></ul></li></ul></li><li>JavaEE实际上包括很多种规范，13种规范，其中Servlet就是JavaEE规范之一。学Servlet还是Java语言。</li></ul></li></ol><h2 id="B-S结构的系统通信原理（没有涉及到Java小程序）"><a href="#B-S结构的系统通信原理（没有涉及到Java小程序）" class="headerlink" title="B/S结构的系统通信原理（没有涉及到Java小程序）"></a>B/S结构的系统通信原理（没有涉及到Java小程序）</h2><ul><li>WEB系统的访问过程<ul><li>第一步：打开浏览器</li><li>第二步：找到地址栏</li><li>第三步：输入一个合法的网址</li><li>第四步：回车</li><li>第五步：在浏览器上会展示响应的结果。</li></ul></li><li>关于域名：<ul><li><a href="https://www.baidu.com/">https://www.baidu.com/</a> （网址）</li><li>www.baidu.com 是一个域名</li><li>在浏览器地址栏上输入域名，回车之后，域名解析器会将域名解析出来一个具体的IP地址和端口号等。</li><li>解析结果也许是：<a href="http://110.242.68.3:80/index.html">http://110.242.68.3:80/index.html</a></li></ul></li><li>IP地址是啥？<ul><li>计算机在网络当中的一个身份证号。在同一个网络当中，IP地址是唯一的。</li><li>A计算机要想和B计算机通信，首先你需要知道B计算机的IP地址，有了IP地址才能建立连接。</li></ul></li><li>端口号是啥？<ul><li>一个端口代表一个软件（一个端口代表一个应用，一个端口仅代表一个服务）。</li><li>一个计算机当中有很多软件，每一个软件启动之后都有一个端口号。</li><li>在同一个计算机上，端口号具有唯一性。</li></ul></li><li>一个WEB系统的通信原理？通信步骤：<ul><li>第一步：用户输入网址（URL）</li><li>第二步：域名解析器进行域名解析：<a href="http://110.242.68.3:80/index.html">http://110.242.68.3:80/index.html</a></li><li>第三步：浏览器软件在网络中搜索110.242.68.3这一台主机，直到找到这台主机。</li><li>第四步：定位110.242.68.3这台主机上的服务器软件，因为是80端口，可以很轻松的定位到80端口对应的服务器软件。</li><li>第五步：80端口对应的服务器软件得知浏览器想要的资源名是：index.html</li><li>第六步：服务器软件找到index.html文件，并且将index.html文件中的内容直接输出响应到浏览器上。</li><li>第七步：浏览器接收到来自服务器的代码（HTML CSS JS）</li><li>第八步：浏览器渲染，执行HTML CSS JS代码，展示效果。</li></ul></li><li>什么是URL？<ul><li>统一资源定位符（<a href="http://www.baidu.com）">http://www.baidu.com）</a></li></ul></li><li>什么是请求，什么是响应？<ul><li>请求和响应实际上说的是数据的流向不同。</li><li>从Browser端发送数据到Server端，我们称为请求。英语单词：request</li><li>从Server端向浏览器Browser端发送数据，我们称为响应。英语单词：response</li><li>B —&gt; S （请求request）</li><li>S —&gt; B （响应response）</li></ul></li></ul><h2 id="关于WEB服务器软件"><a href="#关于WEB服务器软件" class="headerlink" title="关于WEB服务器软件"></a>关于WEB服务器软件</h2><ul><li>WEB服务器软件都有哪些呢？（这些软件都是提前开发好的。）<ul><li>Tomcat（WEB服务器）</li><li>jetty（WEB服务器）</li><li>JBOSS（应用服务器）</li><li>WebLogic（应用服务器）</li><li>WebSphere（应用服务器）</li></ul></li><li>应用服务器和WEB服务器的关系？<ul><li>应用服务器实现了JavaEE的所有规范。(JavaEE有13个不同的规范。)</li><li>WEB服务器只实现了JavaEE中的Servlet + JSP两个核心的规范。</li><li>通过这个讲解说明了：应用服务器是包含WEB服务器的。</li><li>用过JBOSS服务器的同学应该很清楚，JBOSS中内嵌了一个Tomcat服务器。</li></ul></li><li>Tomcat下载<ul><li>apache官网地址：<a href="https://www.apache.org/">https://www.apache.org/</a></li><li>tomcat官网地址：<a href="https://tomcat.apache.org">https://tomcat.apache.org</a></li><li>tomcat开源免费的轻量级WEB服务器。</li><li>tomcat还有另外一个名字：catalina（catalina是美国的一个岛屿，风景秀丽，据说作者是在这个风景秀丽的小岛上开发了一个轻量级的WEB服务器，体积小，运行速度快，因此tomcat又被称为catalina）</li><li>tomcat的logo是一只公猫（寓意表示Tomcat服务器是轻巧的，小巧的，果然，体积小，运行速度快，只实现了Servlet+JSP规范）</li><li>tomcat是java语言写的。</li><li>tomcat服务器要想运行，必须先又jre（Java的运行时环境）</li></ul></li><li>Tomcat服务器要想运行，需要先有jre，所以要先安装JDK，配置java运行环境。<ul><li>JAVA_HOME=C:\Program Files\Java\jdk-17.0.1</li><li>PATH=%JAVA_HOME%\bin</li><li>目前JAVA_HOME没有配置，思考一个问题，这样行不行呢？目前只运行java程序是没问题的。真的没问题吗？</li></ul></li><li>Tomcat服务器的安装：<ul><li>绿色版本的安装很简单，直接zip包解压即可。解压就是安装。</li><li>我有一个好习惯，在C盘的根目录下新建一个dev目录，java开发所有相关的工具都安装到dev目录下，这样比较方便管理。（你随意）</li><li>启动Tomcat<ul><li>bin目录下有一个文件：startup.bat,通过它可以启动Tomcat服务器。<ul><li>xxx.bat文件是个什么文件？bat文件是windows操作系统专用的，bat文件是批处理文件，这种文件中可以编写大量的windows的dos命令，然后执行bat文件就相当于批量的执行dos命令。</li><li>startup.sh，这个文件在windows当中无法执行，在Linux环境当中可以使用。在Linux环境下能够执行的是shell命令，大量的shell命令编写在shell文件当中，然后执行这个shell文件可以批量的执行shell命令。</li><li>tomcat服务器提供了bat和sh文件，说明了这个tomcat服务器的通用性。</li><li>分析startup.bat文件得出，执行这个命令，实际上最后是执行：catalina.bat文件。</li><li>catalina.bat文件中有这样一行配置：MAINCLASS=org.apache.catalina.startup.Bootstrap （这个类就是main方法所在的类。）</li><li>tomcat服务器就是Java语言写的，既然是java语言写的，那么启动Tomcat服务器就是执行main方法。</li></ul></li><li>我们尝试打开dos命令窗口，在dos命令窗口中输入startup.bat来启动tomcat服务器。</li><li>启动Tomcat服务器只配置path对应的bin目录是不行的。有两个环境变量需要配置：<ul><li>JAVA_HOME=JDK的根</li><li>CATALINA_HOME=Tomcat服务器的根</li></ul></li></ul></li></ul></li><li><p>关于Tomcat服务器的目录</p><ul><li>bin ： 这个目录是Tomcat服务器的命令文件存放的目录，比如：启动Tomcat，关闭Tomcat等。</li><li>conf： 这个目录是Tomcat服务器的配置文件存放目录。（server.xml文件中可以配置端口号，默认Tomcat端口是8080）</li><li>lib ：这个目录是Tomcat服务器的核心程序目录，因为Tomcat服务器是Java语言编写的，这里的jar包里面都是class文件。</li><li>logs: Tomcat服务器的日志目录，Tomcat服务器启动等信息都会在这个目录下生成日志文件。</li><li>temp：Tomcat服务器的临时目录。存储临时文件。</li><li>webapps：这个目录当中就是用来存放大量的webapp（web application：web应用）</li><li>work：这个目录是用来存放JSP文件翻译之后的java文件以及编译之后的class文件。</li></ul></li><li><p>配置Tomcat服务器需要哪些环境变量？</p><ul><li>JAVA_HOME=JDK的根</li><li>CATALINA_HOME=Tomcat服务器的根</li><li>PATH=%JAVA_HOME%\bin;%CATALINA_HOME%\bin</li></ul></li><li>启动Tomcat： startup</li><li><p>关闭Tomcat：stop （shutdown.bat文件重命名为stop.bat，为什么？原因是shutdown命令和windows中的关机命令冲突。所以修改一下。）</p></li><li><p>怎么测试Tomcat服务器有没有启动成功呢？</p><ul><li>打开浏览器，在浏览器的地址栏上输入URL即可：<ul><li><a href="http://ip地址:端口号">http://ip地址:端口号</a></li><li>ip地址是什么？端口号我知道，是8080</li><li>本机的IP地址是：127.0.0.1，或者是localhost，都行。</li></ul></li></ul></li></ul><h2 id="实现一个最基本的web应用（这个web应用中没有java小程序）"><a href="#实现一个最基本的web应用（这个web应用中没有java小程序）" class="headerlink" title="实现一个最基本的web应用（这个web应用中没有java小程序）"></a>实现一个最基本的web应用（这个web应用中没有java小程序）</h2><ul><li><p>第一步：找到CATALINA_HOME\webapps目录</p><ul><li>因为所有的webapp要放到webapps目录下。（没有为什么，这是Tomcat服务器的要求。如果不放到这里，Tomcat服务器找不到你的应用。）</li></ul></li><li><p>第二步：在CATALINA_HOME\webapps目录下新建一个子目录，起名：oa</p><ul><li>这个目录名oa就是你这个webapp的名字。</li></ul></li><li><p>第三步：在oa目录下新建资源文件，例如：index.html</p><ul><li>编写index.html文件的内容。</li></ul></li><li><p>第四步：启动Tomcat服务器</p></li><li><p>第五步：打开浏览器，在浏览器地址栏上输入这样的URL：</p></li><li><p><a href="http://127.0.0.1:8080/oa/index.html">http://127.0.0.1:8080/oa/index.html</a></p></li><li><p>思考一个问题：</p><ul><li><p>我们在浏览器上直接输入一个URL，然后回车。这个动作和超链接一样吗？既然是一样的，我们完全可以使用超链接。</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注意以下的路径，以/开始，带项目名，是一个绝对路径。不需要添加：http://127.0.0.1:8080--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/oa/login.html&quot;</span>&gt;</span>user login2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--多个层级也没有关系，正常访问即可。--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意：我们目前前端上的路径都以“/”开始的，都是加项目名的。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/oa/test/debug/d.html&quot;</span>&gt;</span>d page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><a href="http://127.0.0.1:8080/oa/userList.html">http://127.0.0.1:8080/oa/userList.html</a> <ul><li>访问这个地址，可以展示一个用户列表页面。但是这个用户列表页面是写死在HTML文件当中的。这种资源我们称为静态资源。怎么能变成动态资源。显然需要连接数据库。</li><li>连接数据库需要JDBC程序，也就是说需要编写Java程序连接数据库，数据库中有多少条记录，页面上就显示多少条记录，这种技术被称为动态网页技术。（动态网页技术并不是说页面中有flash动画。动态网页技术是说页面中的数据是动态的，根据数据库中数据的变化而变化。）</li></ul></li></ul><h2 id="对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议"><a href="#对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议" class="headerlink" title="对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议"></a>对于一个动态的web应用来说，一个请求和响应的过程有多少个角色参与，角色和角色之间有多少个协议</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="D:\course\01-Servlet\文档\BS结构系统的通信原理2.png" alt="BS结构系统的通信原理2"></p><ul><li>有哪些角色（在整个BS结构的系统当中，有哪些人参与进去了）<ul><li>浏览器软件的开发团队（浏览器软件太多了：谷歌浏览器、火狐浏览器、IE浏览器….）</li><li>WEB Server的开发团队（WEB Server这个软件也是太多了：Tomcat、Jetty、WebLogic、JBOSS、WebSphere….）</li><li>DB Server的开发团队（DB Server这个软件也是太多了：Oracle、MySQL…..）</li><li>webapp的开发团队（WEB应用是我们做为JavaWEB程序员开发的）</li></ul></li><li>角色和角色之间需要遵守哪些规范，哪些协议<ul><li>webapp的开发团队   和    WEB Server的开发团队  之间有一套规范: JavaEE规范之一Servlet规范。<ul><li>Servlet规范的作用是什么？<ul><li>WEB Server   和   webapp解耦合。</li></ul></li></ul></li><li>Browser  和   WebServer之间有一套传输协议：HTTP协议。（超文本传输协议。）</li><li>webapp开发团队  和  DB Server的开发团队之间有一套规范：JDBC规范。</li></ul></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="D:\course\01-Servlet\文档\BS结构系统的角色和协议.png" alt="BS结构系统的角色和协议"></p><ul><li>Servlet规范是一个什么规范？<ul><li>遵循Servlet规范的webapp，这个webapp就可以放在不同的WEB服务器中运行。（因为这个webapp是遵循Servlet规范的。）</li><li>Servlet规范包括什么呢？<ul><li>规范了哪些接口</li><li>规范了哪些类</li><li>规范了一个web应用中应该有哪些配置文件</li><li>规范了一个web应用中配置文件的名字</li><li>规范了一个web应用中配置文件存放的路径</li><li>规范了一个web应用中配置文件的内容</li><li>规范了一个合法有效的web应用它的目录结构应该是怎样的。</li><li>…..</li></ul></li></ul></li></ul><h2 id="开发一个带有Servlet（Java小程序）的webapp（重点）"><a href="#开发一个带有Servlet（Java小程序）的webapp（重点）" class="headerlink" title="开发一个带有Servlet（Java小程序）的webapp（重点）"></a>开发一个带有Servlet（Java小程序）的webapp（重点）</h2><ul><li><p>开发步骤是怎样的？</p><ul><li><p>第一步：在webapps目录下新建一个目录，起名crm（这个crm就是webapp的名字）。当然，也可以是其它项目，比如银行项目，可以创建一个目录bank，办公系统可以创建一个oa。</p><ul><li>注意：crm就是这个webapp的根</li></ul></li><li><p>第二步：在webapp的根下新建一个目录：WEB-INF</p><ul><li>注意：这个目录的名字是Servlet规范中规定的，必须全部大写，必须一模一样。必须的必须。</li></ul></li><li><p>第三步：在WEB-INF目录下新建一个目录：classes</p><ul><li>注意：这个目录的名字必须是全部小写的classes。这也是Servlet规范中规定的。另外这个目录下一定存放的是Java程序编译之后的class文件（这里存放的是字节码文件）。</li></ul></li><li><p>第四步：在WEB-INF目录下新建一个目录：lib</p><ul><li>注意：这个目录不是必须的。但如果一个webapp需要第三方的jar包的话，这个jar包要放到这个lib目录下，这个目录的名字也不能随意编写，必须是全部小写的lib。例如java语言连接数据库需要数据库的驱动jar包。那么这个jar包就一定要放到lib目录下。这Servlet规范中规定的。</li></ul></li><li><p>第五步：在WEB-INF目录下新建一个文件：web.xml</p><ul><li><p>注意：这个文件是必须的，这个文件名必须叫做web.xml。这个文件必须放在这里。一个合法的webapp，web.xml文件是必须的，这个web.xml文件就是一个配置文件，在这个配置文件中描述了请求路径和Servlet类之间的对照关系。</p></li><li><p>这个文件最好从其他的webapp中拷贝，最好别手写。没必要。复制粘贴</p></li><li><p>```xml<br>  &lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p>  <web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"    xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee                        https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd"    version="5.0"    metadata-complete="true"></li></ul></li></ul></li></ul><pre><code>        &lt;/web-app&gt;        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第六步：编写一个Java程序，这个小Java程序也不能随意开发，这个小java程序必须实现Servlet接口。</span><br><span class="line"></span><br><span class="line">    - 这个Servlet接口不在JDK当中。（因为Servlet不是JavaSE了。Servlet属于JavaEE，是另外的一套类库。）</span><br><span class="line">    - Servlet接口（Servlet.class文件）是Oracle提供的。（最原始的是sun公司提供的。）</span><br><span class="line">    - Servlet接口是JavaEE的规范中的一员。</span><br><span class="line">    - Tomcat服务器实现了Servlet规范，所以Tomcat服务器也需要使用Servlet接口。Tomcat服务器中应该有这个接口，Tomcat服务器的CATALINA_HOME\lib目录下有一个servlet-api.jar，解压这个servlet-api.jar之后，你会看到里面有一个Servlet.class文件。</span><br><span class="line">    - 重点：从JakartaEE9开始，Servlet接口的全名变了：jakarta.servlet.Servlet</span><br><span class="line">    - 注意：编写这个Java小程序的时候，java源代码你愿意在哪里就在哪里，位置无所谓，你只需要将java源代码编译之后的class文件放到classes目录下即可。</span><br><span class="line"></span><br><span class="line">- 第七步：编译我们编写的HelloServlet</span><br><span class="line"></span><br><span class="line">    - 重点：你怎么能让你的HelloServlet编译通过呢？配置环境变量CLASSPATH</span><br><span class="line"></span><br><span class="line">        CLASSPATH=.;C:\dev\apache-tomcat-10.0.12\lib\servlet-api.jar</span><br><span class="line"></span><br><span class="line">    - 思考问题：以上配置的CLASSPATH和Tomcat服务器运行有没有关系？</span><br><span class="line"></span><br><span class="line">        - 没有任何关系，以上配置这个环境变量只是为了让你的HelloServlet能够正常编译生成class文件。</span><br><span class="line"></span><br><span class="line">- 第八步：将以上编译之后的HelloServlet.class文件拷贝到WEB-INF\classes目录下。</span><br><span class="line"></span><br><span class="line">- 第九步：在web.xml文件中编写配置信息，让“请求路径”和“Servlet类名”关联在一起。</span><br><span class="line"></span><br><span class="line">    - 这一步用专业术语描述：在web.xml文件中注册Servlet类。</span><br><span class="line"></span><br><span class="line">    - ```xml</span><br><span class="line">        &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;web-app xmlns=&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span><br><span class="line">          xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">          xsi:schemaLocation=&quot;https://jakarta.ee/xml/ns/jakartaee</span><br><span class="line">                              https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span><br><span class="line">          version=&quot;5.0&quot;</span><br><span class="line">          metadata-complete=&quot;true&quot;&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!--servlet描述信息--&gt;</span><br><span class="line">        &lt;!--任何一个servlet都对应一个servlet-mapping --&gt;</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;fdsafdsagfdsafdsa&lt;/servlet-name&gt;</span><br><span class="line">        &lt;!--这个位置必须是带有包名的全限定类名--&gt;</span><br><span class="line">        &lt;servlet-class&gt;com.bjpowernode.servlet.HelloServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!--servlet映射信息--&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;!--这个也是随便的，不过这里写的内容要和上面的一样。--&gt;</span><br><span class="line">        &lt;servlet-name&gt;fdsafdsagfdsafdsa&lt;/servlet-name&gt;</span><br><span class="line">        &lt;!--这里需要一个路径--&gt;</span><br><span class="line">        &lt;!--这个路径唯一的要求是必须以 / 开始--&gt;</span><br><span class="line">        &lt;!--当前这个路径可以随便写--&gt;</span><br><span class="line">        &lt;url-pattern&gt;/fdsa/fd/saf/d/sa/fd/sa/fd&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;/web-app&gt;</span><br><span class="line">        </span><br></pre></td></tr></table></figure>- 第十步：启动Tomcat服务器- 第十一步：打开浏览器，在浏览器地址栏上输入一个url，这个URL必须是：    - http://127.0.0.1:8080/crm/fdsa/fd/saf/d/sa/fd/sa/fd       - 非常重要的一件事：浏览器上的请求路径不能随便写，这个请求路径必须和web.xml文件中的url-pattern一致。    - 注意：浏览器上的请求路径和web.xml文件中的url-pattern的唯一区别就是：浏览器上的请求路径带项目名：/crm- 浏览器上编写的路径太复杂，可以使用超链接。（**非常重要：html页面只能放到WEB-INF目录外面。**）- 以后不需要我们编写main方法了。tomcat服务器负责调用main方法，Tomcat服务器启动的时候执行的就是main方法。我们javaweb程序员只需要编写Servlet接口的实现类，然后将其注册到web.xml文件中，即可。- 总结一下：一个合法的webapp目录结构应该是怎样的？    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">webapproot</span><br><span class="line">     |------WEB-INF</span><br><span class="line">       |------classes(存放字节码)</span><br><span class="line">       |------lib(第三方jar包)</span><br><span class="line">       |------web.xml(注册Servlet)</span><br><span class="line">     |------html</span><br><span class="line">     |------css</span><br><span class="line">     |------javascript</span><br><span class="line">     |------image</span><br><span class="line">     ....</span><br></pre></td></tr></table></figure>- 浏览器发送请求，到最终服务器调用Servlet中的方法，是怎样的一个过程？（以下这个过程描述的很粗糙。其中还有很多步骤我省略了。）    - 用户输入URL，或者直接点击超链接：http://127.0.0.1:8080/crm/fdsa/fd/saf/d/sa/fd/sa/fd      - 然后Tomcat服务器接收到请求，截取路径：/crm/fdsa/fd/saf/d/sa/fd/sa/fd      - Tomcat服务器找到crm项目    - Tomcat服务器在web.xml文件中查找/fdsa/fd/saf/d/sa/fd/sa/fd  对应的Servlet是：com.bjpowernode.servlet.HelloServlet    - Tomcat服务器通过反射机制，创建com.bjpowernode.servlet.HelloServlet的对象。    - Tomcat服务器调用com.bjpowernode.servlet.HelloServlet对象的service方法。</code></pre><h2 id="关于JavaEE的版本"><a href="#关于JavaEE的版本" class="headerlink" title="关于JavaEE的版本"></a>关于JavaEE的版本</h2><ul><li>JavaEE目前最高版本是 JavaEE8</li><li>JavaEE被Oracle捐献了，Oracle将JavaEE规范捐献给Apache了。</li><li>Apache把JavaEE换名了，以后不叫JavaEE了，以后叫做 jakarta EE。</li><li>以后没有JavaEE了。以后都叫做Jakarta EE。</li><li>JavaEE8版本升级之后的”JavaEE 9”，不再是”JavaEE9”这个名字了，叫做JakartaEE9</li><li>JavaEE8的时候对应的Servlet类名是：javax.servlet.Servlet</li><li>JakartaEE9的时候对应的Servlet类名是：jakarta.servlet.Servlet （包名都换了）</li><li>如果你之前的项目还是在使用javax.servlet.Servlet，那么你的项目无法直接部署到Tomcat10+版本上。你只能部署到Tomcat9-版本上。在Tomcat9以及Tomcat9之前的版本中还是能够识别javax.servlet这个包。</li></ul><h2 id="解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）"><a href="#解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）" class="headerlink" title="解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）"></a>解决Tomcat服务器在DOS命令窗口中的乱码问题（控制台乱码）</h2><p>将CATALINA_HOME/conf/logging.properties文件中的内容修改如下：</p><p>java.util.logging.ConsoleHandler.encoding = GBK</p><h2 id="向浏览器响应一段HTML代码"><a href="#向浏览器响应一段HTML代码" class="headerlink" title="向浏览器响应一段HTML代码"></a>向浏览器响应一段HTML代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest request, ServletResponse response)</span>&#123;</span><br><span class="line">    response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">    out.print(<span class="string">&quot;&lt;h1&gt;hello servlet!&lt;/h1&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在Servlet中连接数据库，怎么做？"><a href="#在Servlet中连接数据库，怎么做？" class="headerlink" title="在Servlet中连接数据库，怎么做？"></a>在Servlet中连接数据库，怎么做？</h2><ul><li>Servlet是Java程序，所以在Servlet中完全可以编写JDBC代码连接数据库。</li><li>在一个webapp中去连接数据库，需要将驱动jar包放到WEB-INF/lib目录下。（com.mysql.cj.jdbc.Driver 这个类就在驱动jar包当中。）</li></ul><h2 id="在集成开发环境当中开发Servlet程序"><a href="#在集成开发环境当中开发Servlet程序" class="headerlink" title="在集成开发环境当中开发Servlet程序"></a>在集成开发环境当中开发Servlet程序</h2><ul><li><p>集成开发工具很多，其中目前使用比较多的是：</p><ul><li>IntelliJ IDEA（这个居多，IDEA在提示功能方面要强于Eclipse，也就是说IDEA使用起来比Eclipse更加智能，更好用。JetBrain公司开发的。收费的。）</li><li>Eclipse（这个少一些），Eclipse目前还是有团队使用，只不过处于减少的趋势，自己从事工作之后，可能会遇到。Eclipse是IBM团队开发的。Eclipse寓意是“日食”。“日食”表示将太阳吃掉。太阳是SUN。IBM团队开发Eclipse的寓意是吞并SUN公司，但是2009年的时候SUN公司被Oracle公司并购了。IBM并没有成功并购SUN公司。</li></ul></li><li><p>使用IDEA集成开发工具开发Servlet</p><ul><li>第一步：New Project（我比较习惯先创建一个Empty Project【空工程】，然后在空工程下新建Module【模块】，这不是必须的，只是一种习惯，你可以直接新建非空的Project），这个Empty Project起名为：javaweb（不是必须的，只是一个名字而已。一般情况下新建的Project的名字最好和目录的名字一致。）</li><li>第二步：新建模块（File —&gt; new —&gt; Module…）<ul><li>这里新建的是一个普通的JavaSE模块（这里先不要新建Java Enterprise模块）</li><li>这个Module自动会被放在javaweb的project下面。</li><li>这个Module起名：servlet01</li></ul></li><li>第三步：让Module变成JavaEE的模块。（让Module变成webapp的模块。符合webapp规范。符合Servlet规范的Module）<ul><li>在Module上点击右键：Add Framework Support…（添加框架支持）</li><li>在弹出的窗口中，选择Web Application（选择的是webapp的支持）</li><li>选择了这个webapp的支持之后，IDEA会自动给你生成一个符合Servlet规范的webpp目录结构。</li><li><strong>重点，需要注意的：在IDEA工具中根据Web Application模板生成的目录中有一个web目录，这个目录就代表webapp的根</strong></li></ul></li><li>第四步（非必须）：根据Web Application生成的资源中有index.jsp文件，这里我选择删除这个index.jsp文件。</li><li>第五步：编写Servlet（StudentServlet）<ul><li>class StudentServlet implements Servlet</li><li>这个时候发现Servlet.class文件没有。怎么办？将CATALINA_HOME/lib/servlet-api.jar和jsp-api.jar添加到classpath当中（这里的classpath说的是IDEA的classpath）<ul><li>File —&gt; Project Structrue —&gt; Modules —&gt; + 加号 —&gt; Add JARS….</li></ul></li><li>实现jakarta.servlet.Servlet接口中的5个方法。</li></ul></li><li>第六步：在Servlet当中的service方法中编写业务代码（我们这里连接数据库了。）</li><li>第七步：在WEB-INF目录下新建了一个子目录：lib（这个目录名可不能随意，必须是全部小写的lib），并且将连接数据库的驱动jar包放到lib目录下。</li><li><p>第八步：在web.xml文件中完成StudentServlet类的注册。（请求路径和Servlet之间对应起来）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;4.0&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;studentServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;com.bjpowernode.javaweb.servlet.StudentServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;studentServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/servlet/student&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul><pre><code>- 第九步：给一个html页面，在HTML页面中编写一个超链接，用户点击这个超链接，发送请求，Tomcat执行后台的StudentServlet。    - student.html    - 这个文件不能放到WEB-INF目录里面，只能放到WEB-INF目录外面。    - student.html文件的内容    - ```html        &lt;!DOCTYPE html&gt;        &lt;html lang=&quot;en&quot;&gt;        &lt;head&gt;            &lt;meta charset=&quot;UTF-8&quot;&gt;            &lt;title&gt;student page&lt;/title&gt;        &lt;/head&gt;        &lt;body&gt;            &lt;!--这里的项目名是 /xmm ，无法动态获取，先写死--&gt;            &lt;a href=&quot;/xmm/servlet/student&quot;&gt;student list&lt;/a&gt;        &lt;/body&gt;        &lt;/html&gt;        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">    - 第十步：让IDEA工具去关联Tomcat服务器。关联的过程当中将webapp部署到Tomcat服务器当中。</span><br><span class="line"></span><br><span class="line">        - IDEA工具右上角，绿色小锤子右边有一个：Add Configuration</span><br><span class="line">        - 左上角加号，点击Tomcat Server --&gt; local</span><br><span class="line">        - 在弹出的界面中设置服务器Server的参数（基本上不用动）</span><br><span class="line">        - 在当前窗口中有一个Deployment（点击这个用来部署webapp），继续点击加号，部署即可。</span><br><span class="line">        - 修改 Application context为：/xmm</span><br><span class="line"></span><br><span class="line">    - 第十一步：启动Tomcat服务器</span><br><span class="line"></span><br><span class="line">        - 在右上角有绿色的箭头，或者绿色的小虫子，点击这个绿色的小虫子，可以采用debug的模式启动Tomcat服务器。</span><br><span class="line">        - 我们开发中建议适用debug模式启动Tomcat</span><br><span class="line"></span><br><span class="line">    - 第十二步：打开浏览器，在浏览器地址栏上输入：http://localhost:8080/xmm/student.html</span><br><span class="line"></span><br><span class="line">## Servlet对象的生命周期</span><br><span class="line"></span><br><span class="line">- 什么是Servlet对象生命周期？</span><br><span class="line"></span><br><span class="line">    - Servlet对象什么时候被创建。</span><br><span class="line">    - Servlet对象什么时候被销毁。</span><br><span class="line">    - Servlet对象创建了几个？</span><br><span class="line">    - Servlet对象的生命周期表示：一个Servlet对象从出生在最后的死亡，整个过程是怎样的。</span><br><span class="line"></span><br><span class="line">- Servlet对象是由谁来维护的？</span><br><span class="line"></span><br><span class="line">    - Servlet对象的创建，对象上方法的调用，对象最终的销毁，Javaweb程序员是无权干预的。</span><br><span class="line">    - Servlet对象的生命周期是由Tomcat服务器（WEB Server）全权负责的。</span><br><span class="line">    - Tomcat服务器通常我们又称为：WEB容器。（这个叫法你要知道【WEB Container】）</span><br><span class="line">    - WEB容器来管理Servlet对象的死活。</span><br><span class="line"></span><br><span class="line">- 思考：我们自己new的Servlet对象受WEB容器的管理吗？</span><br><span class="line"></span><br><span class="line">    - 我们自己new的Servlet对象是不受WEB容器管理的。</span><br><span class="line">    - WEB容器创建的Servlet对象，这些Servlet对象都会被放到一个集合当中（HashMap），只有放到这个HashMap集合中的Servlet才能够被WEB容器管理，自己new的Servlet对象不会被WEB容器管理。（自己new的Servlet对象不在容器当中）</span><br><span class="line">    - web容器底层应该有一个HashMap这样的集合，在这个集合当中存储了Servlet对象和请求路径之间的关系</span><br><span class="line">    - ![WEB容器中的Map集合](D:\course\01-Servlet\文档\WEB容器中的Map集合.png)</span><br><span class="line"></span><br><span class="line">- 研究：服务器在启动的Servlet对象有没有被创建出来（默认情况下）？</span><br><span class="line"></span><br><span class="line">    - 在Servlet中提供一个无参数的构造方法，启动服务器的时候看看构造方法是否执行。</span><br><span class="line">    - 经过测试得出结论：默认情况下，服务器在启动的时候Servlet对象并不会被实例化。</span><br><span class="line">    - 这个设计是合理的。用户没有发送请求之前，如果提前创建出来所有的Servlet对象，必然是耗费内存的，并且创建出来的Servlet如果一直没有用户访问，显然这个Servlet对象是一个废物，没必要先创建。</span><br><span class="line"></span><br><span class="line">- 怎么让服务器启动的时候创建Servlet对象呢？</span><br><span class="line"></span><br><span class="line">    - 在servlet标签中添加&lt;load-on-startup&gt;子标签，在该子标签中填写整数，越小的整数优先级越高。</span><br><span class="line"></span><br><span class="line">    - ```xml</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">            &lt;servlet-name&gt;aservlet&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;com.bjpowernode.javaweb.servlet.AServlet&lt;/servlet-class&gt;</span><br><span class="line">            &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;aservlet&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/a&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></code></pre><ul><li><p>Servlet对象生命周期</p><ul><li><p>默认情况下服务器启动的时候AServlet对象并没有被实例化</p></li><li><p>用户发送第一次请求的时候，控制台输出了以下内容：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AServlet无参数构造方法执行了</span><br><span class="line">AServlet&#x27;s init method execute!</span><br><span class="line">AServlet&#x27;s service method execute!</span><br></pre></td></tr></table></figure></li><li><p>根据以上输出内容得出结论：</p><ul><li>用户在发送第一次请求的时候Servlet对象被实例化（AServlet的构造方法被执行了。并且执行的是无参数构造方法。）</li><li>AServlet对象被创建出来之后，Tomcat服务器马上调用了AServlet对象的init方法。（init方法在执行的时候，AServlet对象已经存在了。已经被创建出来了。）</li><li>用户发送第一次请求的时候，init方法执行之后，Tomcat服务器马上调用AServlet对象的service方法。</li></ul></li><li><p>用户继续发送第二次请求，控制台输出了以下内容：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AServlet&#x27;s service method execute!</span><br></pre></td></tr></table></figure></li><li><p>根据以上输出结果得知，用户在发送第二次，或者第三次，或者第四次请求的时候，Servlet对象并没有新建，还是使用之前创建好的Servlet对象，直接调用该Servlet对象的service方法，这说明：</p><ul><li>第一：Servlet对象是单例的（单实例的。但是要注意：Servlet对象是单实例的，但是Servlet类并不符合单例模式。我们称之为假单例。之所以单例是因为Servlet对象的创建我们javaweb程序员管不着，这个对象的创建只能是Tomcat来说了算，Tomcat只创建了一个，所以导致了单例，但是属于假单例。真单例模式，构造方法是私有化的。）</li><li>第二：无参数构造方法、init方法只在第一次用户发送请求的时候执行。也就是说无参数构造方法只执行一次。init方法也只被Tomcat服务器调用一次。</li><li>第三：只要用户发送一次请求：service方法必然会被Tomcat服务器调用一次。发送100次请求，service方法会被调用100次。</li></ul></li><li><p>关闭服务器的时候，控制台输出了以下内容：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AServlet&#x27;s destroy method execute!</span><br></pre></td></tr></table></figure></li><li><p>通过以上输出内容，可以得出以下结论：</p><ul><li>Servlet的destroy方法只被Tomcat服务器调用一次。</li><li>destroy方法是在什么时候被调用的？<ul><li>在服务器关闭的时候。</li><li>因为服务器关闭的时候要销毁AServlet对象的内存。</li><li>服务器在销毁AServlet对象内存之前，Tomcat服务器会自动调用AServlet对象的destroy方法。</li></ul></li></ul></li><li><p>请问：destroy方法调用的时候，对象销毁了还是没有销毁呢？</p><ul><li>destroy方法执行的时候AServlet对象还在，没有被销毁。destroy方法执行结束之后，AServlet对象的内存才会被Tomcat释放。</li></ul></li><li><p>Servlet对象更像一个人的一生：</p><ul><li>Servlet的无参数构造方法执行：标志着你出生了。</li><li>Servlet对象的init方法的执行：标志着你正在接受教育。</li><li>Servlet对象的service方法的执行：标志着你已经开始工作了，已经开始为人类提供服务了。</li><li>Servlet对象的destroy方法的执行：标志着临终。有什么遗言，抓紧的。要不然，来不及了。</li></ul></li><li><p>关于Servlet类中方法的调用次数？</p><ul><li>构造方法只执行一次。</li><li>init方法只执行一次。</li><li>service方法：用户发送一次请求则执行一次，发送N次请求则执行N次。</li><li>destroy方法只执行一次。</li></ul></li><li><p>当我们Servlet类中编写一个有参数的构造方法，如果没有手动编写无参数构造方法会出现什么问题？</p><ul><li>报错了：500错误。</li><li>注意：500是一个HTTP协议的错误状态码。</li><li>500一般情况下是因为服务器端的Java程序出现了异常。（服务器端的错误都是500错误：服务器内部错误。）</li><li>如果没有无参数的构造方法，会导致出现500错误，无法实例化Servlet对象。</li><li>所以，一定要注意：在Servlet开发当中，不建议程序员来定义构造方法，因为定义不当，一不小心就会导致无法实例化Servlet对象。</li></ul></li><li><p>思考：Servlet的无参数构造方法是在对象第一次创建的时候执行，并且只执行一次。init方法也是在对象第一次创建的时候执行，并且只执行一次。那么这个无参数构造方法可以代替掉init方法吗？</p><ul><li>不能。</li><li>Servlet规范中有要求，作为javaweb程序员，编写Servlet类的时候，不建议手动编写构造方法，因为编写构造方法，很容易让无参数构造方法消失，这个操作可能会导致Servlet对象无法实例化。所以init方法是有存在的必要的。</li></ul></li><li><p>init、service、destroy方法中使用最多的是哪个方法？</p><ul><li>使用最多就是service方法，service方法是一定要实现的，因为service方法是处理用户请求的核心方法。</li><li>什么时候使用init方法呢？<ul><li>init方法很少用。</li><li>通常在init方法当中做初始化操作，并且这个初始化操作只需要执行一次。例如：初始化数据库连接池，初始化线程池….</li></ul></li><li>什么时候使用destroy方法呢？<ul><li>destroy方法也很少用。</li><li>通常在destroy方法当中，进行资源的关闭。马上对象要被销毁了，还有什么没有关闭的，抓紧时间关闭资源。还有什么资源没保存的，抓紧时间保存一下。</li></ul></li></ul></li></ul></li></ul><h2 id="GenericServlet"><a href="#GenericServlet" class="headerlink" title="GenericServlet"></a>GenericServlet</h2><ul><li><p>我们编写一个Servlet类直接实现Servlet接口有什么缺点？</p><ul><li>我们只需要service方法，其他方法大部分情况下是不需要使用的。代码很丑陋。</li></ul></li><li><p>适配器设计模式Adapter</p><ul><li>手机直接插到220V的电压上，手机直接就报废了。怎么办？可以找一个充电器。这个充电器就是一个适配器。手机连接适配器。适配器连接220V的电压。这样问题就解决了。</li></ul></li><li><p>编写一个GenericServlet类，这个类是一个抽象类，其中有一个抽象方法service。</p><ul><li>GenericServlet实现Servlet接口。</li><li>GenericServlet是一个适配器。</li><li>以后编写的所有Servlet类继承GenericServlet，重写service方法即可。</li></ul></li><li><p>思考：GenericServlet类是否需要改造一下？怎么改造？更利于子类程序的编写？</p><ul><li><p>思考第一个问题：我提供了一个GenericServlet之后，init方法还会执行吗？</p><ul><li>还会执行。会执行GenericServlet类中的init方法。</li></ul></li><li><p>思考第二个问题：init方法是谁调用的？</p><ul><li>Tomcat服务器调用的。</li></ul></li><li><p>思考第三个问题：init方法中的ServletConfig对象是谁创建的？是谁传过来的？</p><ul><li>都是Tomcat干的。</li><li>Tomcat服务器先创建了ServletConfig对象，然后调用init方法，将ServletConfig对象传给了init方法。</li></ul></li><li><p>思考一下Tomcat服务器伪代码：</p><ul><li><p>```java<br>  public class Tomcat {</p><pre><code>  public static void main(String[] args)&#123;      // .....      // Tomcat服务器伪代码      // 创建LoginServlet对象（通过反射机制，调用无参数构造方法来实例化LoginServlet对象）      Class clazz = Class.forName(&quot;com.bjpowernode.javaweb.servlet.LoginServlet&quot;);      Object obj = clazz.newInstance();      // 向下转型      Servlet servlet = (Servlet)obj;      // 创建ServletConfig对象      // Tomcat服务器负责将ServletConfig对象实例化出来。      // 多态（Tomcat服务器完全实现了Servlet规范）      ServletConfig servletConfig = new org.apache.catalina.core.StandardWrapperFacade();      // 调用Servlet的init方法      servlet.init(servletConfig);      // 调用Servlet的service方法      // ....  &#125;</code></pre><p>  }</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## ServletConfig</span><br><span class="line"></span><br><span class="line">- 什么是ServletConfig？</span><br><span class="line"></span><br><span class="line">    - Servlet对象的配置信息对象。</span><br><span class="line">    - ServletConfig对象中封装了&lt;servlet&gt;&lt;/servlet&gt;标签中的配置信息。（web.xml文件中servlet的配置信息）</span><br><span class="line"></span><br><span class="line">- 一个Servlet对应一个ServletConfig对象。</span><br><span class="line"></span><br><span class="line">- Servlet对象是Tomcat服务器创建，并且ServletConfig对象也是Tomcat服务器创建。并且默认情况下，他们都是在用户发送第一次请求的时候创建。</span><br><span class="line"></span><br><span class="line">- Tomcat服务器调用Servlet对象的init方法的时候需要传一个ServletConfig对象的参数给init方法。</span><br><span class="line"></span><br><span class="line">- ServletConfig接口的实现类是Tomcat服务器给实现的。（Tomcat服务器说的就是WEB服务器。）</span><br><span class="line"></span><br><span class="line">- ServletConfig接口有哪些常用的方法？</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">        public String getInitParameter(String name); // 通过初始化参数的name获取value</span><br><span class="line">        public Enumeration&lt;String&gt; getInitParameterNames(); // 获取所有的初始化参数的name</span><br><span class="line">        public ServletContext getServletContext(); // 获取ServletContext对象</span><br><span class="line">        public String getServletName(); // 获取Servlet的name</span><br></pre></td></tr></table></figure></li></ul></li><li><p>以上方法在Servlet类当中，都可以使用this去调用。因为GenericServlet实现了ServletConfig接口。</p></li></ul></li></ul><h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><ul><li><p>一个Servlet对象对应一个ServletConfig。100个Servlet对象则对应100个ServletConfig对象。</p></li><li><p>只要在同一个webapp当中，只要在同一个应用当中，所有的Servlet对象都是共享同一个ServletContext对象的。</p></li><li><p>ServletContext对象在服务器启动阶段创建，在服务器关闭的时候销毁。这就是ServletContext对象的生命周期。ServletContext对象是应用级对象。</p></li><li><p>Tomcat服务器中有一个webapps，这个webapps下可以存放webapp，可以存放多个webapp，假设有100个webapp，那么就有100个ServletContext对象。但是，总之，一个应用，一个webapp肯定是只有一个ServletContext对象。</p></li><li><p>ServletContext被称为Servlet上下文对象。（Servlet对象的四周环境对象。）</p></li><li><p>一个ServletContext对象通常对应的是一个web.xml文件。</p></li><li><p>ServletContext对应显示生活中的什么例子呢？</p><ul><li>一个教室里有多个学生，那么每一个学生就是一个Servlet，这些学生都在同一个教室当中，那么我们可以把这个教室叫做ServletContext对象。那么也就是说放在这个ServletContext对象（环境）当中的数据，在同一个教室当中，物品都是共享的。比如：教室中有一个空调，所有的学生都可以操作。可见，空调是共享的。因为空调放在教室当中。教室就是ServletContext对象。</li></ul></li><li><p>ServletContext是一个接口，Tomcat服务器对ServletContext接口进行了实现。</p><ul><li>ServletContext对象的创建也是Tomcat服务器来完成的。启动webapp的时候创建的。</li></ul></li><li><p>ServletContext接口中有哪些常用的方法？</p><ul><li><p>```java<br>  public String getInitParameter(String name); // 通过初始化参数的name获取value<br>  public Enumeration<String> getInitParameterNames(); // 获取所有的初始化参数的name</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```xml</span><br><span class="line">    &lt;!--以上两个方法是ServletContext对象的方法，这个方法获取的是什么信息？是以下的配置信息--&gt;</span><br><span class="line">    &lt;context-param&gt;</span><br><span class="line">        &lt;param-name&gt;pageSize&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;10&lt;/param-value&gt;</span><br><span class="line">    &lt;/context-param&gt;</span><br><span class="line">    &lt;context-param&gt;</span><br><span class="line">        &lt;param-name&gt;startIndex&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;0&lt;/param-value&gt;</span><br><span class="line">    &lt;/context-param&gt;</span><br><span class="line">    &lt;!--注意：以上的配置信息属于应用级的配置信息，一般一个项目中共享的配置信息会放到以上的标签当中。--&gt;</span><br><span class="line">    &lt;!--如果你的配置信息只是想给某一个servlet作为参考，那么你配置到servlet标签当中即可，使用ServletConfig对象来获取。--&gt;</span><br></pre></td></tr></table></figure></li><li><p>```java<br>  // 获取应用的根路径（非常重要），因为在java源代码当中有一些地方可能会需要应用的根路径，这个方法可以动态获取应用的根路径<br>  // 在java源码当中，不要将应用的根路径写死，因为你永远都不知道这个应用在最终部署的时候，起一个什么名字。<br>  public String getContextPath();<br>  //String contextPath = application.getContextPath();</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">    // 获取文件的绝对路径（真实路径）</span><br><span class="line">    public String getRealPath(String path);</span><br></pre></td></tr></table></figure></li><li><p>```java<br>  // 通过ServletContext对象也是可以记录日志的<br>  public void log(String message);<br>  public void log(String message, Throwable t);<br>  // 这些日志信息记录到哪里了？<br>  // localhost.2021-11-05.log</p><p>  // Tomcat服务器的logs目录下都有哪些日志文件？<br>  //catalina.2021-11-05.log 服务器端的java程序运行的控制台信息。<br>  //localhost.2021-11-05.log ServletContext对象的log方法记录的日志信息存储到这个文件中。<br>  //localhost_access_log.2021-11-05.txt 访问日志</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">    // ServletContext对象还有另一个名字：应用域（后面还有其他域，例如：请求域、会话域）</span><br><span class="line">    </span><br><span class="line">    // 如果所有的用户共享一份数据，并且这个数据很少的被修改，并且这个数据量很少，可以将这些数据放到ServletContext这个应用域中</span><br><span class="line">    </span><br><span class="line">    // 为什么是所有用户共享的数据？ 不是共享的没有意义。因为ServletContext这个对象只有一个。只有共享的数据放进去才有意义。</span><br><span class="line">    </span><br><span class="line">    // 为什么数据量要小？ 因为数据量比较大的话，太占用堆内存，并且这个对象的生命周期比较长，服务器关闭的时候，这个对象才会被销毁。大数据量会影响服务器的性能。占用内存较小的数据量可以考虑放进去。</span><br><span class="line">    </span><br><span class="line">    // 为什么这些共享数据很少的修改，或者说几乎不修改？</span><br><span class="line">    // 所有用户共享的数据，如果涉及到修改操作，必然会存在线程并发所带来的安全问题。所以放在ServletContext对象中的数据一般都是只读的。</span><br><span class="line">    </span><br><span class="line">    // 数据量小、所有用户共享、又不修改，这样的数据放到ServletContext这个应用域当中，会大大提升效率。因为应用域相当于一个缓存，放到缓存中的数据，下次在用的时候，不需要从数据库中再次获取，大大提升执行效率。</span><br><span class="line">    </span><br><span class="line">    // 存（怎么向ServletContext应用域中存数据）</span><br><span class="line">    public void setAttribute(String name, Object value); // map.put(k, v)</span><br><span class="line">    // 取（怎么从ServletContext应用域中取数据）</span><br><span class="line">    public Object getAttribute(String name); // Object v = map.get(k)</span><br><span class="line">    // 删（怎么删除ServletContext应用域中的数据）</span><br><span class="line">    public void removeAttribute(String name); // map.remove(k)</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure></li></ul></li><li><p>注意：以后我们编写Servlet类的时候，实际上是不会去直接继承GenericServlet类的，因为我们是B/S结构的系统，这种系统是基于HTTP超文本传输协议的，在Servlet规范当中，提供了一个类叫做HttpServlet，它是专门为HTTP协议准备的一个Servlet类。我们编写的Servlet类要继承HttpServlet。（HttpServlet是HTTP协议专用的。）使用HttpServlet处理HTTP协议更便捷。但是你需要直到它的继承结构：</p><ul><li><p>```<br>  jakarta.servlet.Servlet（接口）【爷爷】<br>  jakarta.servlet.GenericServlet implements Servlet（抽象类）【儿子】<br>  jakarta.servlet.http.HttpServlet extends GenericServlet（抽象类）【孙子】</p><p>  我们以后编写的Servlet要继承HttpServlet类。</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 大家到目前为止都接触过哪些缓存机制了？</span><br><span class="line"></span><br><span class="line">    - 堆内存当中的字符串常量池。</span><br><span class="line">        - &quot;abc&quot; 先在字符串常量池中查找，如果有，直接拿来用。如果没有则新建，然后再放入字符串常量池。</span><br><span class="line">    - 堆内存当中的整数型常量池。</span><br><span class="line">        - [-128 ~ 127] 一共256个Integer类型的引用，放在整数型常量池中。没有超出这个范围的话，直接从常量池中取。</span><br><span class="line">    - 连接池(Connection Cache)</span><br><span class="line">        - 这里所说的连接池中的连接是java语言连接数据库的连接对象：java.sql.Connection对象。</span><br><span class="line">        - JVM是一个进程。MySQL数据库是一个进程。进程和进程之间建立连接，打开通道是很费劲的。是很耗费资源的。怎么办？可以提前先创建好N个Connection连接对象，将连接对象放到一个集合当中，我们把这个放有Connection对象的集合称为连接池。每一次用户连接的时候不需要再新建连接对象，省去了新建的环节，直接从连接池中获取连接对象，大大提升访问效率。</span><br><span class="line">        - 连接池</span><br><span class="line">            - 最小连接数</span><br><span class="line">            - 最大连接数</span><br><span class="line">            - 连接池可以提高用户的访问效率。当然也可以保证数据库的安全性。</span><br><span class="line">    - 线程池</span><br><span class="line">        - Tomcat服务器本身就是支持多线程的。</span><br><span class="line">        - Tomcat服务器是在用户发送一次请求，就新建一个Thread线程对象吗？</span><br><span class="line">            - 当然不是，实际上是在Tomcat服务器启动的时候，会先创建好N多个线程Thread对象，然后将线程对象放到集合当中，称为线程池。用户发送请求过来之后，需要有一个对应的线程来处理这个请求，这个时候线程对象就会直接从线程池中拿，效率比较高。</span><br><span class="line">            - 所有的WEB服务器，或者应用服务器，都是支持多线程的，都有线程池机制。</span><br><span class="line">    - redis</span><br><span class="line">        - NoSQL数据库。非关系型数据库。缓存数据库。</span><br><span class="line">    - 向ServletContext应用域中存储数据，也等于是将数据存放到缓存cache当中了。</span><br><span class="line"></span><br><span class="line">## HTTP协议</span><br><span class="line"></span><br><span class="line">- 什么是协议？</span><br><span class="line"></span><br><span class="line">    - 协议实际上是某些人，或者某些组织提前制定好的一套规范，大家都按照这个规范来，这样可以做到沟通无障碍。</span><br><span class="line">    - 协议就是一套规范，就是一套标准。由其他人或其他组织来负责制定的。</span><br><span class="line">    - 我说的话你能听懂，你说的话，我也能听懂，这说明我们之间是有一套规范的，一套协议的，这套协议就是：中国普通话协议。我们都遵守这套协议，我们之间就可以沟通无障碍。</span><br><span class="line"></span><br><span class="line">- 什么是HTTP协议？</span><br><span class="line"></span><br><span class="line">    - HTTP协议：是W3C制定的一种超文本传输协议。（通信协议：发送消息的模板提前被制定好。）</span><br><span class="line">    - W3C：</span><br><span class="line">        - 万维网联盟组织</span><br><span class="line">        - 负责制定标准的：HTTP HTML4.0 HTML5 XML DOM等规范都是W3C制定的。</span><br><span class="line">        - 万维网之父：蒂姆·伯纳斯·李</span><br><span class="line">    - 什么是超文本？</span><br><span class="line">        - 超文本说的就是：不是普通文本，比如流媒体：声音、视频、图片等。</span><br><span class="line">        - HTTP协议支持：不但可以传送普通字符串，同样支持传递声音、视频、图片等流媒体信息。</span><br><span class="line">    - 这种协议游走在B和S之间。B向S发数据要遵循HTTP协议。S向B发数据同样需要遵循HTTP协议。这样B和S才能解耦合。</span><br><span class="line">    - 什么是解耦合？</span><br><span class="line">        - B不依赖S。</span><br><span class="line">        - S也不依赖B。</span><br><span class="line">    - B/S表示：B/S结构的系统（浏览器访问WEB服务器的系统）</span><br><span class="line">    - 浏览器   向   WEB服务器发送数据，叫做：请求（request)</span><br><span class="line">    - WEB服务器   向   浏览器发送数据，叫做：响应（response）</span><br><span class="line">    - HTTP协议包括：</span><br><span class="line">        - 请求协议</span><br><span class="line">            - 浏览器  向   WEB服务器发送数据的时候，这个发送的数据需要遵循一套标准，这套标准中规定了发送的数据具体格式。</span><br><span class="line">        - 响应协议</span><br><span class="line">            - WEB服务器  向  浏览器发送数据的时候，这个发送的数据需要遵循一套标准，这套标准中规定了发送的数据具体格式。</span><br><span class="line">    - HTTP协议就是提前制定好的一种消息模板。</span><br><span class="line">        - 不管你是哪个品牌的浏览器，都是这么发。</span><br><span class="line">        - 不管你是哪个品牌的WEB服务器，都是这么发。</span><br><span class="line">        - FF浏览器  可以向 Tomcat发送请求，也可以向Jetty服务器发送请求。浏览器不依赖具体的服务器品牌。</span><br><span class="line">        - WEB服务器也不依赖具体的浏览器品牌。可以是FF浏览器，也可以是Chrome浏览器，可以是IE，都行。</span><br><span class="line"></span><br><span class="line">- HTTP的请求协议（B --&gt; S）</span><br><span class="line"></span><br><span class="line">    - HTTP的请求协议包括：4部分</span><br><span class="line"></span><br><span class="line">        - 请求行</span><br><span class="line">        - 请求头</span><br><span class="line">        - 空白行</span><br><span class="line">        - 请求体</span><br><span class="line"></span><br><span class="line">    - HTTP请求协议的具体报文：GET请求</span><br><span class="line"></span><br><span class="line">        - ```http</span><br><span class="line">            GET /servlet05/getServlet?username=lucy&amp;userpwd=1111 HTTP/1.1                           请求行</span><br><span class="line">            Host: localhost:8080                                                                    请求头</span><br><span class="line">            Connection: keep-alive</span><br><span class="line">            sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;95&quot;, &quot;Chromium&quot;;v=&quot;95&quot;, &quot;;Not A Brand&quot;;v=&quot;99&quot;</span><br><span class="line">            sec-ch-ua-mobile: ?0</span><br><span class="line">            sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">            Upgrade-Insecure-Requests: 1</span><br><span class="line">            User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36</span><br><span class="line">            Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">            Sec-Fetch-Site: same-origin</span><br><span class="line">            Sec-Fetch-Mode: navigate</span><br><span class="line">            Sec-Fetch-User: ?1</span><br><span class="line">            Sec-Fetch-Dest: document</span><br><span class="line">            Referer: http://localhost:8080/servlet05/index.html</span><br><span class="line">            Accept-Encoding: gzip, deflate, br</span><br><span class="line">            Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">                                                                                                    空白行</span><br><span class="line">                                                                                                    请求体</span><br></pre></td></tr></table></figure></li><li><p>HTTP请求协议的具体报文：POST请求</p><ul><li>```http<br>  POST /servlet05/postServlet HTTP/1.1                                                  请求行<br>  Host: localhost:8080                                                                  请求头<br>  Connection: keep-alive<br>  Content-Length: 25<br>  Cache-Control: max-age=0<br>  sec-ch-ua: “Google Chrome”;v=”95”, “Chromium”;v=”95”, “;Not A Brand”;v=”99”<br>  sec-ch-ua-mobile: ?0<br>  sec-ch-ua-platform: “Windows”<br>  Upgrade-Insecure-Requests: 1<br>  Origin: <a href="http://localhost:8080">http://localhost:8080</a><br>  Content-Type: application/x-www-form-urlencoded<br>  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36<br>  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,<em>/</em>;q=0.8,application/signed-exchange;v=b3;q=0.9<br>  Sec-Fetch-Site: same-origin<br>  Sec-Fetch-Mode: navigate<br>  Sec-Fetch-User: ?1<br>  Sec-Fetch-Dest: document<br>  Referer: <a href="http://localhost:8080/servlet05/index.html">http://localhost:8080/servlet05/index.html</a><br>  Accept-Encoding: gzip, deflate, br<br>  Accept-Language: zh-CN,zh;q=0.9<pre><code>                                                                                    空白行</code></pre>  username=lisi&amp;userpwd=123                                                             请求体  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 请求行</span><br><span class="line"></span><br><span class="line">        - 包括三部分：</span><br><span class="line">            - 第一部分：请求方式（7种）</span><br><span class="line">                - get（常用的）</span><br><span class="line">                - post（常用的）</span><br><span class="line">                - delete</span><br><span class="line">                - put</span><br><span class="line">                - head</span><br><span class="line">                - options</span><br><span class="line">                - trace</span><br><span class="line">            - 第二部分：URI</span><br><span class="line">                - 什么是URI？ 统一资源标识符。代表网络中某个资源的名字。但是通过URI是无法定位资源的。</span><br><span class="line">                - 什么是URL？统一资源定位符。代表网络中某个资源，同时，通过URL是可以定位到该资源的。</span><br><span class="line">                - URI和URL什么关系，有什么区别？</span><br><span class="line">                    - URL包括URI</span><br><span class="line">                    - http://localhost:8080/servlet05/index.html 这是URL。</span><br><span class="line">                    - /servlet05/index.html 这是URI。</span><br><span class="line">            - 第三部分：HTTP协议版本号</span><br><span class="line"></span><br><span class="line">    - 请求头</span><br><span class="line"></span><br><span class="line">        - 请求的主机</span><br><span class="line">        - 主机的端口</span><br><span class="line">        - 浏览器信息</span><br><span class="line">        - 平台信息</span><br><span class="line">        - cookie等信息</span><br><span class="line">        - ....</span><br><span class="line"></span><br><span class="line">    - 空白行</span><br><span class="line"></span><br><span class="line">        - 空白行是用来区分“请求头”和“请求体”</span><br><span class="line"></span><br><span class="line">    - 请求体</span><br><span class="line"></span><br><span class="line">        - 向服务器发送的具体数据。</span><br><span class="line"></span><br><span class="line">- HTTP的响应协议（S --&gt; B）</span><br><span class="line"></span><br><span class="line">    - HTTP的响应协议包括：4部分</span><br><span class="line"></span><br><span class="line">        - 状态行</span><br><span class="line">        - 响应头</span><br><span class="line">        - 空白行</span><br><span class="line">        - 响应体</span><br><span class="line"></span><br><span class="line">    - HTTP响应协议的具体报文：</span><br><span class="line"></span><br><span class="line">        - ```http</span><br><span class="line">            HTTP/1.1 200 ok                                     状态行</span><br><span class="line">            Content-Type: text/html;charset=UTF-8               响应头</span><br><span class="line">            Content-Length: 160</span><br><span class="line">            Date: Mon, 08 Nov 2021 13:19:32 GMT</span><br><span class="line">            Keep-Alive: timeout=20</span><br><span class="line">            Connection: keep-alive</span><br><span class="line">                                                                空白行</span><br><span class="line">            &lt;!doctype html&gt;                                     响应体</span><br><span class="line">            &lt;html&gt;</span><br><span class="line">                &lt;head&gt;</span><br><span class="line">                    &lt;title&gt;from get servlet&lt;/title&gt;</span><br><span class="line">                &lt;/head&gt;</span><br><span class="line">                &lt;body&gt;</span><br><span class="line">                    &lt;h1&gt;from get servlet&lt;/h1&gt;</span><br><span class="line">                &lt;/body&gt;</span><br><span class="line">            &lt;/html&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>状态行</p><ul><li>三部分组成<ul><li>第一部分：协议版本号（HTTP/1.1）</li><li>第二部分：状态码（HTTP协议中规定的响应状态号。不同的响应结果对应不同的号码。）<ul><li>200 表示请求响应成功，正常结束。</li><li>404表示访问的资源不存在，通常是因为要么是你路径写错了，要么是路径写对了，但是服务器中对应的资源并没有启动成功。总之404错误是前端错误。</li><li>405表示前端发送的请求方式与后端请求的处理方式不一致时发生：<ul><li>比如：前端是POST请求，后端的处理方式按照get方式进行处理时，发生405</li><li>比如：前端是GET请求，后端的处理方式按照post方式进行处理时，发生405</li></ul></li><li>500表示服务器端的程序出现了异常。一般会认为是服务器端的错误导致的。</li><li>以4开始的，一般是浏览器端的错误导致的。</li><li>以5开始的，一般是服务器端的错误导致的。</li></ul></li><li>第三部分：状态的描述信息<ul><li>ok 表示正常成功结束。</li><li>not found 表示资源找不到。</li></ul></li></ul></li></ul></li><li><p>响应头：</p><ul><li>响应的内容类型</li><li>响应的内容长度</li><li>响应的时间</li><li>….</li></ul></li><li><p>空白行：</p><ul><li>用来分隔“响应头”和“响应体”的。</li></ul></li><li><p>响应体：</p><ul><li>响应体就是响应的正文，这些内容是一个长的字符串，这个字符串被浏览器渲染，解释并执行，最终展示出效果。</li></ul></li></ul></li><li><p>怎么查看的协议内容？</p><ul><li>使用chrome浏览器：F12。然后找到network，通过这个面板可以查看协议的具体内容。</li></ul></li><li><p>怎么向服务器发送GET请求，怎么向服务器发送POST请求？</p><ul><li>到目前为止，只有一种情况可以发送POST请求：使用form表单，并且form标签中的method属性值为：method=”post”。</li><li>其他所有情况一律都是get请求：<ul><li>在浏览器地址栏上直接输入URL，敲回车，属于get请求。</li><li>在浏览器上直接点击超链接，属于get请求。</li><li>使用form表单提交数据时，form标签中没有写method属性，默认就是get</li><li>或者使用form的时候，form标签中method属性值为：method=”get”</li><li>….</li></ul></li></ul></li><li><p>GET请求和POST请求有什么区别？</p><ul><li>get请求发送数据的时候，数据会挂在URI的后面，并且在URI后面添加一个“?”，”?”后面是数据。这样会导致发送的数据回显在浏览器的地址栏上。（get请求在“请求行”上发送数据）<ul><li><a href="http://localhost:8080/servlet05/getServlet?username=zhangsan&amp;userpwd=1111">http://localhost:8080/servlet05/getServlet?username=zhangsan&amp;userpwd=1111</a></li></ul></li><li>post请求发送数据的时候，在请求体当中发送。不会回显到浏览器的地址栏上。也就是说post发送的数据，在浏览器地址栏上看不到。（post在“请求体”当中发送数据）</li><li>get请求只能发送普通的字符串。并且发送的字符串长度有限制，不同的浏览器限制不同。这个没有明确的规范。</li><li>get请求无法发送大数据量。</li><li>post请求可以发送任何类型的数据，包括普通字符串，流媒体等信息：视频、声音、图片。</li><li>post请求可以发送大数据量，理论上没有长度限制。</li><li>get请求在W3C中是这样说的：get请求比较适合从服务器端获取数据。</li><li>post请求在W3C中是这样说的：post请求比较适合向服务器端传送数据。</li><li>get请求是安全的。get请求是绝对安全的。为什么？因为get请求只是为了从服务器上获取数据。不会对服务器造成威胁。（get本身是安全的，你不要用错了。用错了之后又冤枉人家get不安全，你这样不好（太坏了），那是你自己的问题，不是get请求的问题。）</li><li>post请求是危险的。为什么？因为post请求是向服务器提交数据，如果这些数据通过后门的方式进入到服务器当中，服务器是很危险的。另外post是为了提交数据，所以一般情况下拦截请求的时候，大部分会选择拦截（监听）post请求。</li><li>get请求支持缓存。<ul><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/b40c-b425eb67cabc342ff5b9dc018b4b00cc.jpg">https://n.sinaimg.cn/finance/590/w240h350/20211101/b40c-b425eb67cabc342ff5b9dc018b4b00cc.jpg</a></li><li>任何一个get请求最终的“响应结果”都会被浏览器缓存起来。在浏览器缓存当中：<ul><li>一个get请求的路径a  对应  一个资源。</li><li>一个get请求的路径b  对应  一个资源。</li><li>一个get请求的路径c  对应  一个资源。</li><li>……</li></ul></li><li>实际上，你只要发送get请求，浏览器做的第一件事都是先从本地浏览器缓存中找，找不到的时候才会去服务器上获取。这种缓存机制目的是为了提高用户的体验。</li><li>有没有这样一个需求：我们不希望get请求走缓存，怎么办？怎么避免走缓存？我希望每一次这个get请求都去服务器上找资源，我不想从本地浏览器的缓存中取。<ul><li>只要每一次get请求的请求路径不同即可。</li><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897898">https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897898</a></li><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897899">https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=789789787897899</a></li><li><a href="https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=系统毫秒数">https://n.sinaimg.cn/finance/590/w240h350/20211101/7cabc342ff5b9dc018b4b00cc.jpg?t=系统毫秒数</a></li><li>怎么解决？可以在路径的后面添加一个每时每刻都在变化的“时间戳”，这样，每一次的请求路径都不一样，浏览器就不走缓存了。</li></ul></li></ul></li><li>post请求不支持缓存。（POST是用来修改服务器端的资源的。）<ul><li>post请求之后，服务器“响应的结果”不会被浏览器缓存起来。因为这个缓存没有意义。</li></ul></li></ul></li><li><p>GET请求和POST请求如何选择，什么时候使用GET请求，什么时候使用POST请求？</p><ul><li>怎么选择GET请求和POST请求呢？衡量标准是什么呢？你这个请求是想获取服务器端的数据，还是想向服务器发送数据。如果你是想从服务器上获取资源，建议使用GET请求，如果你这个请求是为了向服务器提交数据，建议使用POST请求。</li><li>大部分的form表单提交，都是post方式，因为form表单中要填写大量的数据，这些数据是收集用户的信息，一般是需要传给服务器，服务器将这些数据保存/修改等。</li><li>如果表单中有敏感信息，还是建议适用post请求，因为get请求会回显敏感信息到浏览器地址栏上。（例如：密码信息）</li><li>做文件上传，一定是post请求。要传的数据不是普通文本。</li><li>其他情况都可以使用get请求。</li></ul></li><li><p>不管你是get请求还是post请求，发送的请求数据格式是完全相同的，只不过位置不同，格式都是统一的：</p><ul><li>name=value&amp;name=value&amp;name=value&amp;name=value</li><li>name是什么？<ul><li>以form表单为例：form表单中input标签的name。</li></ul></li><li>value是什么？<ul><li>以form表单为例：form表单中input标签的value。</li></ul></li></ul></li></ul><h2 id="模板方法设计模式"><a href="#模板方法设计模式" class="headerlink" title="模板方法设计模式"></a>模板方法设计模式</h2><ul><li>什么是设计模式？<ul><li>某个问题的固定的解决方案。(可以被重复使用。)</li></ul></li><li>你知道哪些设计模式？<ul><li>GoF设计模式：<ul><li>通常我们所说的23种设计模式。（Gang of Four：4人组提出的设计模式）</li><li>单例模式</li><li>工厂模式</li><li>代理模式</li><li>门面模式</li><li>责任链设计模式</li><li>观察者模式</li><li>模板方法设计模式</li><li>…..</li></ul></li><li>JavaEE设计模式：<ul><li>DAO</li><li>DTO</li><li>VO</li><li>PO</li><li>pojo</li><li>….</li></ul></li><li>….</li></ul></li><li>什么是模板方法设计模式？<ul><li>在模板类的模板方法当中定义核心算法骨架，具体的实现步骤可以延迟到子类当中完成。</li></ul></li><li>模板类通常是一个抽象类，模板类当中的模板方法定义核心算法，这个方法通常是final的（但也可以不是final的）</li><li>模板类当中的抽象方法就是不确定实现的方法，这个不确定怎么实现的事儿交给子类去做。</li></ul><h2 id="HttpServlet源码分析"><a href="#HttpServlet源码分析" class="headerlink" title="HttpServlet源码分析"></a>HttpServlet源码分析</h2><ul><li>HttpServlet类是专门为HTTP协议准备的。比GenericServlet更加适合HTTP协议下的开发。</li><li>HttpServlet在哪个包下？<ul><li>jakarta.servlet.http.HttpServlet</li></ul></li><li>到目前为止我们接触了servlet规范中哪些接口？<ul><li>jakarta.servlet.Servlet  核心接口（接口）</li><li>jakarta.servlet.ServletConfig Servlet配置信息接口（接口）</li><li>jakarta.servlet.ServletContext Servlet上下文接口（接口）</li><li>jakarta.servlet.ServletRequest Servlet请求接口（接口）</li><li>jakarta.servlet.ServletResponse Servlet响应接口（接口）</li><li>jakarta.servlet.ServletException Servlet异常（类）</li><li>jakarta.servlet.GenericServlet 标准通用的Servlet类（抽象类）</li></ul></li><li>http包下都有哪些类和接口呢？jakarta.servlet.http.*;<ul><li>jakarta.servlet.http.HttpServlet （HTTP协议专用的Servlet类，抽象类）</li><li>jakarta.servlet.http.HttpServletRequest （HTTP协议专用的请求对象）</li><li>jakarta.servlet.http.HttpServletResponse （HTTP协议专用的响应对象）</li></ul></li><li>HttpServletRequest对象中封装了什么信息？<ul><li>HttpServletRequest，简称request对象。</li><li>HttpServletRequest中封装了请求协议的全部内容。</li><li>Tomcat服务器（WEB服务器）将“请求协议”中的数据全部解析出来，然后将这些数据全部封装到request对象当中了。</li><li>也就是说，我们只要面向HttpServletRequest，就可以获取请求协议中的数据。</li></ul></li><li>HttpServletResponse对象是专门用来响应HTTP协议到浏览器的。</li><li>回忆Servlet生命周期？<ul><li>用户第一次请求<ul><li>Tomcat服务器通过反射机制，调用无参数构造方法。创建Servlet对象。(web.xml文件中配置的Servlet类对应的对象。)</li><li>Tomcat服务器调用Servlet对象的init方法完成初始化。</li><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>用户第二次请求<ul><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>用户第三次请求<ul><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>….<ul><li>Tomcat服务器调用Servlet对象的service方法处理请求。</li></ul></li><li>服务器关闭<ul><li>Tomcat服务器调用Servlet对象的destroy方法，做销毁之前的准备工作。</li><li>Tomcat服务器销毁Servlet对象。</li></ul></li></ul></li><li>HttpServlet源码分析：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"><span class="comment">// 用户第一次请求，创建HelloServlet对象的时候，会执行这个无参数构造方法。</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HelloServlet</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//override 重写 doGet方法</span></span><br><span class="line">    <span class="comment">//override 重写 doPost方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">GenericServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span>, ServletConfig,</span><br><span class="line">        java.io.Serializable &#123;</span><br><span class="line">           </span><br><span class="line"><span class="comment">// 用户第一次请求的时候，HelloServlet对象第一次被创建之后，这个init方法会执行。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">        <span class="built_in">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 用户第一次请求的时候，带有参数的init(ServletConfig config)执行之后，会执行这个没有参数的init()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// NOOP by default</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HttpServlet模板类。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">HttpServlet</span> <span class="keyword">extends</span> <span class="title class_">GenericServlet</span> &#123;</span><br><span class="line">    <span class="comment">// 用户发送第一次请求的时候这个service会执行</span></span><br><span class="line">    <span class="comment">// 用户发送第N次请求的时候，这个service方法还是会执行。</span></span><br><span class="line">    <span class="comment">// 用户只要发送一次请求，这个service方法就会执行一次。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        HttpServletRequest  request;</span><br><span class="line">        HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 将ServletRequest和ServletResponse向下转型为带有Http的HttpServletRequest和HttpServletResponse</span></span><br><span class="line">            request = (HttpServletRequest) req;</span><br><span class="line">            response = (HttpServletResponse) res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(lStrings.getString(<span class="string">&quot;http.non_http&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调用重载的service方法。</span></span><br><span class="line">        service(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这个service方法的两个参数都是带有Http的。</span></span><br><span class="line">    <span class="comment">// 这个service是一个模板方法。</span></span><br><span class="line">    <span class="comment">// 在该方法中定义核心算法骨架，具体的实现步骤延迟到子类中去完成。</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取请求方式</span></span><br><span class="line">        <span class="comment">// 这个请求方式最终可能是：&quot;&quot;</span></span><br><span class="line">        <span class="comment">// 注意：request.getMethod()方法获取的是请求方式，可能是七种之一：</span></span><br><span class="line">        <span class="comment">// GET POST PUT DELETE HEAD OPTIONS TRACE</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果请求方式是GET请求，则执行doGet方法。</span></span><br><span class="line">        <span class="keyword">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">            <span class="keyword">if</span> (lastModified == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// servlet doesn&#x27;t support if-modified-since, no reason</span></span><br><span class="line">                <span class="comment">// to go through further expensive logic</span></span><br><span class="line">                doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">long</span> ifModifiedSince;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalArgumentException iae) &#123;</span><br><span class="line">                    <span class="comment">// Invalid date header - proceed as if none was set</span></span><br><span class="line">                    ifModifiedSince = -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ifModifiedSince &lt; (lastModified / <span class="number">1000</span> * <span class="number">1000</span>)) &#123;</span><br><span class="line">                    <span class="comment">// If the servlet mod time is later, call doGet()</span></span><br><span class="line">                    <span class="comment">// Round down to the nearest second for a proper compare</span></span><br><span class="line">                    <span class="comment">// A ifModifiedSince of -1 will always be less</span></span><br><span class="line">                    maybeSetLastModified(resp, lastModified);</span><br><span class="line">                    doGet(req, resp);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> getLastModified(req);</span><br><span class="line">            maybeSetLastModified(resp, lastModified);</span><br><span class="line">            doHead(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class="line">            <span class="comment">// 如果请求方式是POST请求，则执行doPost方法。</span></span><br><span class="line">            doPost(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class="line">            doPut(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class="line">            doDelete(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class="line">            doOptions(req,resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class="line">            doTrace(req,resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// Note that this means NO servlet supports whatever</span></span><br><span class="line">            <span class="comment">// method was requested, anywhere on this server.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">errMsg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_not_implemented&quot;</span>);</span><br><span class="line">            Object[] errArgs = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">1</span>];</span><br><span class="line">            errArgs[<span class="number">0</span>] = method;</span><br><span class="line">            errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line"></span><br><span class="line">            resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException&#123;</span><br><span class="line">        <span class="comment">// 报405错误</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_get_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 报405错误</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> lStrings.getString(<span class="string">&quot;http.method_post_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">通过以上源代码分析：</span></span><br><span class="line"><span class="comment">假设前端发送的请求是get请求，后端程序员重写的方法是doPost</span></span><br><span class="line"><span class="comment">假设前端发送的请求是post请求，后端程序员重写的方法是doGet</span></span><br><span class="line"><span class="comment">会发生什么呢？</span></span><br><span class="line"><span class="comment">发生405这样的一个错误。</span></span><br><span class="line"><span class="comment">405表示前端的错误，发送的请求方式不对。和服务器不一致。不是服务器需要的请求方式。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通过以上源代码可以知道：只要HttpServlet类中的doGet方法或doPost方法执行了，必然405.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">怎么避免405的错误呢？</span></span><br><span class="line"><span class="comment">后端重写了doGet方法，前端一定要发get请求。</span></span><br><span class="line"><span class="comment">后端重写了doPost方法，前端一定要发post请求。</span></span><br><span class="line"><span class="comment">这样可以避免405错误。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">这种前端到底需要发什么样的请求，其实应该后端说了算。后端让发什么方式，前端就得发什么方式。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">有的人，你会看到为了避免405错误，在Servlet类当中，将doGet和doPost方法都进行了重写。</span></span><br><span class="line"><span class="comment">这样，确实可以避免405的发生，但是不建议，405错误还是有用的。该报错的时候就应该让他报错。</span></span><br><span class="line"><span class="comment">如果你要是同时重写了doGet和doPost，那还不如你直接重写service方法好了。这样代码还能</span></span><br><span class="line"><span class="comment">少写一点。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>我们编写的HelloServlet直接继承HttpServlet，直接重写HttpServlet类中的service()方法行吗？</p><ul><li>可以，只不过你享受不到405错误。享受不到HTTP协议专属的东西。</li></ul></li><li><p>到今天我们终于得到了==最终==的一个Servlet类的开发步骤：</p><ul><li>第一步：编写一个Servlet类，直接继承HttpServlet</li><li>第二步：重写doGet方法或者重写doPost方法，到底重写谁，javaweb程序员说了算。</li><li>第三步：将Servlet类配置到web.xml文件当中。</li><li>第四步：准备前端的页面（form表单），form表单中指定请求路径即可。</li></ul></li></ul><h2 id="关于一个web站点的欢迎页面"><a href="#关于一个web站点的欢迎页面" class="headerlink" title="关于一个web站点的欢迎页面"></a>关于一个web站点的欢迎页面</h2><ul><li><p>什么是一个web站点的欢迎页面？</p><ul><li>对于一个webapp来说，我们是可以设置它的欢迎页面的。</li><li>设置了欢迎页面之后，当你访问这个webapp的时候，或者访问这个web站点的时候，没有指定任何“资源路径”，这个时候会默认访问你的欢迎页面。</li><li>我们一般的访问方式是：<ul><li><a href="http://localhost:8080/servlet06/login.html">http://localhost:8080/servlet06/login.html</a> 这种方式是指定了要访问的就是login.html资源。</li></ul></li><li>如果我们访问的方式是：<ul><li><a href="http://localhost:8080/servlet06">http://localhost:8080/servlet06</a> 如果我们访问的就是这个站点，没有指定具体的资源路径。它默认会访问谁呢？</li><li>默认会访问你设置的欢迎页面。</li></ul></li></ul></li><li><p>怎么设置欢迎页面呢？</p><ul><li><p>第一步：我在IDEA工具的web目录下新建了一个文件login.html</p></li><li><p>第二步：在web.xml文件中进行了以下的配置</p><ul><li><p>```xml<br>  <welcome-file-list></p><pre><code>      &lt;welcome-file&gt;login.html&lt;/welcome-file&gt;  &lt;/welcome-file-list&gt;</code></pre>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        - 注意：设置欢迎页面的时候，这个路径不需要以“/”开始。并且这个路径默认是从webapp的根下开始查找。</span><br><span class="line"></span><br><span class="line">    - 第三步：启动服务器，浏览器地址栏输入地址</span><br><span class="line"></span><br><span class="line">        - http://localhost:8080/servlet07</span><br><span class="line"></span><br><span class="line">- 如果在webapp的根下新建一个目录，目录中再给一个文件，那么这个欢迎页该如何设置呢？</span><br><span class="line"></span><br><span class="line">    - 在webapp根下新建page1</span><br><span class="line"></span><br><span class="line">    - 在page1下新建page2目录</span><br><span class="line"></span><br><span class="line">    - 在page2目录下新建page.html页面</span><br><span class="line"></span><br><span class="line">    - 在web.xml文件中应该这样配置</span><br><span class="line"></span><br><span class="line">        - ```</span><br><span class="line">            &lt;welcome-file-list&gt;</span><br><span class="line">                &lt;welcome-file&gt;page1/page2/page.html&lt;/welcome-file&gt;</span><br><span class="line">            &lt;/welcome-file-list&gt;</span><br></pre></td></tr></table></figure></li><li><p>注意：路径不需要以“/”开始，并且路径默认从webapp的根下开始找。</p></li></ul></li></ul></li><li><p>一个webapp是可以设置多个欢迎页面的</p><ul><li><p>```xml<br>  <welcome-file-list></p><pre><code>  &lt;welcome-file&gt;page1/page2/page.html&lt;/welcome-file&gt;  &lt;welcome-file&gt;login.html&lt;/welcome-file&gt;</code></pre><p>  &lt;/welcome-file-list&gt;</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 注意：越靠上的优先级越高。找不到的继续向下找。</span><br><span class="line"></span><br><span class="line">- 你有没有注意一件事：当我的文件名设置为index.html的时候，不需要在web.xml文件中进行配置欢迎页面。这是为什么？</span><br><span class="line"></span><br><span class="line">    - 这是因为小猫咪Tomcat服务器已经提前配置好了。</span><br><span class="line"></span><br><span class="line">    - 实际上配置欢迎页面有两个地方可以配置：</span><br><span class="line"></span><br><span class="line">        - 一个是在webapp内部的web.xml文件中。（在这个地方配置的属于局部配置）</span><br><span class="line"></span><br><span class="line">        - 一个是在CATALINA_HOME/conf/web.xml文件中进行配置。（在这个地方配置的属于全局配置）</span><br><span class="line"></span><br><span class="line">            - ```xml</span><br><span class="line">                &lt;welcome-file-list&gt;</span><br><span class="line">                    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;</span><br><span class="line">                    &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;</span><br><span class="line">                    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;</span><br><span class="line">                &lt;/welcome-file-list&gt;</span><br></pre></td></tr></table></figure><pre><code>  - Tomcat服务器的全局欢迎页面是：index.html index.htm index.jsp。如果你一个web站点没有设置局部的欢迎页面，Tomcat服务器就会以index.html index.htm index.jsp作为一个web站点的欢迎页面。</code></pre><ul><li>注意原则：局部优先原则。（就近原则）</li></ul></li></ul></li><li><p>欢迎页可以是一个Servlet吗？</p><ul><li><p>当然可以。</p></li><li><p>你不要多想，欢迎页就是一个资源，既然是一个资源，那么可以是静态资源，也可以是动态资源。</p></li><li><p>静态资源：index.html welcome.html …..</p></li><li><p>动态资源：Servlet类。</p></li><li><p>步骤：</p><ul><li><p>第一步：写一个Servlet</p><ul><li>```java<br>  public class WelcomeServlet extends HttpServlet {<pre><code>  @Override  protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;      response.setContentType(&quot;text/html&quot;);      PrintWriter out = response.getWriter();      out.print(&quot;&lt;h1&gt;welcome to bjpowernode!&lt;/h1&gt;&quot;);  &#125;</code></pre>  }  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">- 第二步：在web.xml文件中配置servlet</span><br><span class="line"></span><br><span class="line">    - ```xml</span><br><span class="line">            &lt;servlet&gt;</span><br><span class="line">                &lt;servlet-name&gt;welcomeServlet&lt;/servlet-name&gt;</span><br><span class="line">                &lt;servlet-class&gt;com.bjpowernode.javaweb.servlet.WelcomeServlet&lt;/servlet-class&gt;</span><br><span class="line">            &lt;/servlet&gt;</span><br><span class="line">            &lt;servlet-mapping&gt;</span><br><span class="line">                &lt;servlet-name&gt;welcomeServlet&lt;/servlet-name&gt;</span><br><span class="line">                &lt;url-pattern&gt;/fdsa/fds/a/fds/af/ds/af/dsafdsafdsa&lt;/url-pattern&gt;</span><br><span class="line">            &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>第三步：在web.xml文件中配置欢迎页</p><ul><li>```xml<pre><code>  &lt;welcome-file-list&gt;      &lt;welcome-file&gt;fdsa/fds/a/fds/af/ds/af/dsafdsafdsa&lt;/welcome-file&gt;  &lt;/welcome-file-list&gt;</code></pre>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">## 关于WEB-INF目录</span><br><span class="line"></span><br><span class="line">- 在WEB-INF目录下新建了一个文件：welcome.html</span><br><span class="line">- 打开浏览器访问：http://localhost:8080/servlet07/WEB-INF/welcome.html 出现了404错误。</span><br><span class="line">- 注意：放在WEB-INF目录下的资源是受保护的。在浏览器上不能够通过路径直接访问。所以像HTML、CSS、JS、image等静态资源一定要放到WEB-INF目录之外。</span><br><span class="line"></span><br><span class="line">## HttpServletRequest接口详解</span><br><span class="line"></span><br><span class="line">- HttpServletRequest是一个接口，全限定名称：jakarta.servlet.http.HttpServletRequest</span><br><span class="line"></span><br><span class="line">- HttpServletRequest接口是Servlet规范中的一员。</span><br><span class="line"></span><br><span class="line">- HttpServletRequest接口的父接口：ServletRequest</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">        public interface HttpServletRequest extends ServletRequest &#123;&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul></li><li><p>HttpServletRequest接口的实现类谁写的? HttpServletRequest对象是谁给创建的？</p><ul><li><p>通过测试：org.apache.catalina.connector.RequestFacade 实现了 HttpServletRequest接口</p><ul><li>```java<br>  public class RequestFacade implements HttpServletRequest {}  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 测试结果说明：Tomcat服务器（WEB服务器、WEB容器）实现了HttpServletRequest接口，还是说明了Tomcat服务器实现了Servlet规范。而对于我们javaweb程序员来说，实际上不需要关心这个，我们只需要面向接口编程即可。我们关心的是HttpServletRequest接口中有哪些方法，这些方法可以完成什么功能！！！！</span><br><span class="line"></span><br><span class="line">### HttpServletRequest对象中都有什么信息？都包装了什么信息？</span><br><span class="line"></span><br><span class="line">  - HttpServletRequest对象是Tomcat服务器负责创建的。这个对象中封装了什么信息？封装了HTTP的请求协议。</span><br><span class="line">  - 实际上是用户发送请求的时候，遵循了HTTP协议，发送的是HTTP的请求协议，Tomcat服务器将HTTP协议中的信息以及数据全部解析出来，然后Tomcat服务器把这些信息封装到HttpServletRequest对象当中，传给了我们javaweb程序员。</span><br><span class="line">  - javaweb程序员面向HttpServletRequest接口编程，调用方法就可以获取到请求的信息了。</span><br><span class="line"></span><br><span class="line">### request和response对象的生命周期？</span><br><span class="line"></span><br><span class="line">  - request对象和response对象，一个是请求对象，一个是响应对象。这两个对象只在当前请求中有效。</span><br><span class="line">  - 一次请求对应一个request。</span><br><span class="line">  - 两次请求则对应两个request。</span><br><span class="line">  - .....</span><br><span class="line"></span><br><span class="line">### HttpServletRequest接口中有哪些常用的方法？</span><br><span class="line"></span><br><span class="line">#### 怎么获取前端浏览器用户提交的数据？</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">Map&lt;String,String[]&gt; getParameterMap() 这个是获取Map</span><br><span class="line">Enumeration&lt;String&gt; getParameterNames() 这个是获取Map集合中所有的key</span><br><span class="line">String[] getParameterValues(String name) 根据key获取Map集合的value</span><br><span class="line">String getParameter(String name)  获取value这个一维数组当中的第一个元素。这个方法最常用。</span><br><span class="line">// 以上的4个方法，和获取用户提交的数据有关系。</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><p>思考：如果是你，前端的form表单提交了数据之后，你准备怎么存储这些数据，你准备采用什么样的数据结构去存储这些数据呢？</p><ul><li><p>前端提交的数据格式：username=abc&amp;userpwd=111&amp;aihao=s&amp;aihao=d&amp;aihao=tt</p></li><li><p>我会采用Map集合来存储：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt;</span><br><span class="line">    key存储String</span><br><span class="line">    value存储String</span><br><span class="line">    这种想法对吗？不对。</span><br><span class="line">    如果采用以上的数据结构存储会发现key重复的时候value覆盖。</span><br><span class="line">    key         value</span><br><span class="line">    ---------------------</span><br><span class="line">    username    abc</span><br><span class="line">    userpwd     <span class="number">111</span></span><br><span class="line">    aihao       s</span><br><span class="line">    aihao       d</span><br><span class="line">    aihao       tt</span><br><span class="line">    这样是不行的，因为map的key不能重复。</span><br><span class="line">    Map&lt;String, String[]&gt;</span><br><span class="line">    key存储String</span><br><span class="line">    value存储String[]</span><br><span class="line">    keyvalue</span><br><span class="line">    -------------------------------</span><br><span class="line">    username        &#123;<span class="string">&quot;abc&quot;</span>&#125;</span><br><span class="line">    userpwd&#123;<span class="string">&quot;111&quot;</span>&#125;</span><br><span class="line">    aihao&#123;<span class="string">&quot;s&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;tt&quot;</span>&#125;</span><br></pre></td></tr></table></figure><ul><li>注意：前端表单提交数据的时候，假设提交了120这样的“数字”，其实是以字符串”120”的方式提交的，所以服务器端获取到的一定是一个字符串的”120”，而不是一个数字。（前端永远提交的是字符串，后端获取的也永远是字符串。）</li></ul><h3 id="手工开发一个webapp。测试HttpServletRequest接口中的相关方法。"><a href="#手工开发一个webapp。测试HttpServletRequest接口中的相关方法。" class="headerlink" title="手工开发一个webapp。测试HttpServletRequest接口中的相关方法。"></a>手工开发一个webapp。测试HttpServletRequest接口中的相关方法。</h3><ul><li><p>先测试了4个常用的方法，获取请求参数的四个方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">Enumeration&lt;String&gt; names = request.getParameterNames();</span><br><span class="line">String[] values = request.getParameterValues(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h3 id="request对象实际上又称为“请求域”对象。"><a href="#request对象实际上又称为“请求域”对象。" class="headerlink" title="request对象实际上又称为“请求域”对象。"></a>request对象实际上又称为“请求域”对象。</h3><h4 id="应用域对象是什么？"><a href="#应用域对象是什么？" class="headerlink" title="应用域对象是什么？"></a>应用域对象是什么？</h4><p>ServletContext （Servlet上下文对象。）</p><ul><li><p>什么情况下会考虑向ServletContext这个应用域当中绑定数据呢？</p><ul><li>第一：所有用户共享的数据。</li><li>第二：这个共享的数据量很小。</li><li>第三：这个共享的数据很少的修改操作。</li><li>在以上三个条件都满足的情况下，使用这个应用域对象，可以大大提高我们程序执行效率。</li><li><p>实际上向应用域当中绑定数据，就相当于把数据放到了缓存（Cache）当中，然后用户访问的时候直接从缓存中取，减少IO的操作，大大提升系统的性能，所以缓存技术是提高系统性能的重要手段。</p></li><li><p>你见过哪些缓存技术呢？</p><ul><li>字符串常量池</li><li>整数型常量池 [-128~127]，但凡是在这个范围当中的Integer对象不再创建新对象，直接从这个整数型常量池中获取。大大提升系统性能。</li><li>数据库连接池（提前创建好N个连接对象，将连接对象放到集合当中，使用连接对象的时候，直接从缓存中拿。省去了连接对象的创建过程。效率提升。）</li><li>线程池（Tomcat服务器就是支持多线程的。所谓的线程池就是提前先创建好N个线程对象，将线程对象存储到集合中，然后用户请求过来之后，直接从线程池中获取线程对象，直接拿来用。提升系统性能）</li><li>后期你还会学习更多的缓存技术，例如：redis、mongoDB…..</li></ul></li></ul></li></ul><h4 id="ServletContext当中有三个操作域的方法："><a href="#ServletContext当中有三个操作域的方法：" class="headerlink" title="ServletContext当中有三个操作域的方法："></a>ServletContext当中有三个操作域的方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String name, Object obj)</span>; <span class="comment">// 向域当中绑定数据。</span></span><br><span class="line">Object <span class="title function_">getAttribute</span><span class="params">(String name)</span>; <span class="comment">// 从域当中根据name获取数据。</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeAttribute</span><span class="params">(String name)</span>; <span class="comment">// 将域当中绑定的数据移除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上的操作类似于Map集合的操作。</span></span><br><span class="line">Map&lt;String, Object&gt; map;</span><br><span class="line">map.put(<span class="string">&quot;name&quot;</span>, obj); <span class="comment">// 向map集合中放key和value</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> map.get(<span class="string">&quot;name&quot;</span>); <span class="comment">// 通过map集合的key获取value</span></span><br><span class="line">map.remove(<span class="string">&quot;name&quot;</span>); <span class="comment">// 通过Map集合的key删除key和value这个键值对。</span></span><br></pre></td></tr></table></figure><h4 id="“请求域”对象"><a href="#“请求域”对象" class="headerlink" title="“请求域”对象"></a>“请求域”对象</h4><p>“请求域”对象要比“应用域”对象范围小很多。生命周期短很多。请求域只在一次请求内有效。</p><p>一个请求对象request对应一个请求域对象。一次请求结束之后，这个请求域就销毁了。</p><p>请求域对象也有这三个方法：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String name, Object obj)</span>; <span class="comment">// 向域当中绑定数据。</span></span><br><span class="line">Object <span class="title function_">getAttribute</span><span class="params">(String name)</span>; <span class="comment">// 从域当中根据name获取数据。</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeAttribute</span><span class="params">(String name)</span>; <span class="comment">// 将域当中绑定的数据移除</span></span><br></pre></td></tr></table></figure><h5 id="请求域和应用域的选用原则？"><a href="#请求域和应用域的选用原则？" class="headerlink" title="请求域和应用域的选用原则？"></a>请求域和应用域的选用原则？</h5><p>尽量使用小的域对象，因为小的域对象占用的资源较少。</p><h4 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h4><h5 id="转发（一次请求）"><a href="#转发（一次请求）" class="headerlink" title="转发（一次请求）"></a>转发（一次请求）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一步：获取请求转发器对象</span></span><br><span class="line"><span class="type">RequestDispatcher</span> <span class="variable">dispatcher</span> <span class="operator">=</span> request.getRequestDispatcher(<span class="string">&quot;/b&quot;</span>);</span><br><span class="line"><span class="comment">// 第二步：调用转发器的forward方法完成跳转/转发</span></span><br><span class="line">dispatcher.forward(request,response);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一步和第二步代码可以联合在一起。</span></span><br><span class="line">request.getRequestDispatcher(<span class="string">&quot;/b&quot;</span>).forward(request,response);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="两个Servlet怎么共享数据？"><a href="#两个Servlet怎么共享数据？" class="headerlink" title="两个Servlet怎么共享数据？"></a>两个Servlet怎么共享数据？</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">  - 将数据放到ServletContext应用域当中，当然是可以的，但是应用域范围太大，占用资源太多。不建议使用。</span><br><span class="line">  - 可以将数据放到request域当中，然后AServlet转发到BServlet，保证AServlet和BServlet在同一次请求当中，这样就可以做到两个Servlet，或者多个Servlet共享同一份数据。</span><br><span class="line"></span><br><span class="line">- 转发的下一个资源必须是一个Servlet吗？</span><br><span class="line"></span><br><span class="line">  - 不一定，只要是Tomcat服务器当中的合法资源，都是可以转发的。例如：html....</span><br><span class="line">  - 注意：转发的时候，路径的写法要注意，转发的路径以“/”开始，不加项目名。</span><br><span class="line"></span><br><span class="line">- 关于request对象中两个非常容易混淆的方法：</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// uri?username=zhangsan&amp;userpwd=123&amp;sex=1</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 之前一定是执行过：request.setAttribute(&quot;name&quot;, new Object())</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> request.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 以上两个方法的区别是什么？</span></span><br><span class="line">    <span class="comment">// 第一个方法：获取的是用户在浏览器上提交的数据。</span></span><br><span class="line">    <span class="comment">// 第二个方法：获取的是请求域当中绑定的数据。</span></span><br><span class="line">    ```</span><br><span class="line"></span><br><span class="line">- HttpServletRequest接口的其他常用方法：</span><br><span class="line"></span><br><span class="line">  - ```java</span><br><span class="line">    <span class="comment">// 获取客户端的IP地址</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">remoteAddr</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// get请求在请求行上提交数据。</span></span><br><span class="line">    <span class="comment">// post请求在请求体中提交数据。</span></span><br><span class="line">    <span class="comment">// 设置请求体的字符集。（显然这个方法是处理POST请求的乱码问题。这种方式并不能解决get请求的乱码问题。）</span></span><br><span class="line">    <span class="comment">// Tomcat10之后，request请求体当中的字符集默认就是UTF-8，不需要设置字符集，不会出现乱码问题。</span></span><br><span class="line">    <span class="comment">// Tomcat9前（包括9在内），如果前端请求体提交的是中文，后端获取之后出现乱码，怎么解决这个乱码？执行以下代码。</span></span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在Tomcat9之前（包括9），响应中文也是有乱码的，怎么解决这个响应的乱码？</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">// 在Tomcat10之后，包括10在内，响应中文的时候就不在出现乱码问题了。以上代码就不需要设置UTF-8了。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意一个细节</span></span><br><span class="line">    <span class="comment">// 在Tomcat10包括10在内之后的版本，中文将不再出现乱码。（这也体现了中文地位的提升。）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// get请求乱码问题怎么解决？</span></span><br><span class="line">    <span class="comment">// get请求发送的时候，数据是在请求行上提交的，不是在请求体当中提交的。</span></span><br><span class="line">    <span class="comment">// get请求乱码怎么解决</span></span><br><span class="line">    <span class="comment">// 方案：修改CATALINA_HOME/conf/server.xml配置文件</span></span><br><span class="line">    &lt;Connector URIEncoding=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">    <span class="comment">// 注意：从Tomcat8之后，URIEncoding的默认值就是UTF-8，所以GET请求也没有乱码问题了。</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 获取应用的根路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取请求方式</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取请求的URI</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();  <span class="comment">// /aaa/testRequest</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取servlet path</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath(); <span class="comment">//   /testRequest</span></span><br><span class="line">    </span><br><span class="line">    ```</span><br></pre></td></tr></table></figure><h2 id="使用纯Servlet做一个单表的CRUD操作"><a href="#使用纯Servlet做一个单表的CRUD操作" class="headerlink" title="使用纯Servlet做一个单表的CRUD操作"></a>使用纯Servlet做一个单表的CRUD操作</h2><ul><li><p>使用纯粹的Servlet完成单表【对部门的】的增删改查操作。（B/S结构的。）</p></li><li><p>实现步骤</p><ul><li><p>第一步：准备一张数据库表。（sql脚本）</p><ul><li><p>```sql</p><h1 id="部门表"><a href="#部门表" class="headerlink" title="部门表"></a>部门表</h1><p>  drop table if exists dept;<br>  create table dept(</p><pre><code>  deptno int primary key,  dname varchar(255),  loc varchar(255)</code></pre><p>  );<br>  insert into dept(deptno, dname, loc) values(10, ‘XiaoShouBu’, ‘BEIJING’);<br>  insert into dept(deptno, dname, loc) values(20, ‘YanFaBu’, ‘SHANGHAI’);<br>  insert into dept(deptno, dname, loc) values(30, ‘JiShuBu’, ‘GUANGZHOU’);<br>  insert into dept(deptno, dname, loc) values(40, ‘MeiTiBu’, ‘SHENZHEN’);<br>  commit;<br>  select * from dept;</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第二步：准备一套HTML页面（项目原型）【前端开发工具使用HBuilder】</span><br><span class="line"></span><br><span class="line">    - 把HTML页面准备好</span><br><span class="line">    - 然后将HTML页面中的链接都能够跑通。（页面流转没问题。）</span><br><span class="line">    - 应该设计哪些页面呢？</span><br><span class="line">        - 欢迎页面：index.html</span><br><span class="line">        - 列表页面：list.html（以列表页面为核心，展开其他操作。）</span><br><span class="line">        - 新增页面：add.html</span><br><span class="line">        - 修改页面：edit.html</span><br><span class="line">        - 详情页面：detail.html</span><br><span class="line"></span><br><span class="line">- 第三步：分析我们这个系统包括哪些功能？</span><br><span class="line"></span><br><span class="line">    - 什么叫做一个功能呢？</span><br><span class="line">        - 只要 这个操作连接了数据库，就表示一个独立的功能。</span><br><span class="line">    - 包括哪些功能？</span><br><span class="line">        - 查看部门列表</span><br><span class="line">        - 新增部门</span><br><span class="line">        - 删除部门</span><br><span class="line">        - 查看部门详细信息</span><br><span class="line">        - 跳转到修改页面</span><br><span class="line">        - 修改部门</span><br><span class="line"></span><br><span class="line">- 第四步：在IDEA当中搭建开发环境</span><br><span class="line"></span><br><span class="line">    - 创建一个webapp（给这个webapp添加servlet-api.jar和jsp-api.jar到classpath当中。）</span><br><span class="line">    - 向webapp中添加连接数据库的jar包（mysql驱动）</span><br><span class="line">        - 必须在WEB-INF目录下新建lib目录，然后将mysql的驱动jar包拷贝到这个lib目录下。这个目录名必须叫做lib，全部小写的。</span><br><span class="line">    - JDBC的工具类</span><br><span class="line">    - 将所有HTML页面拷贝到web目录下。</span><br><span class="line"></span><br><span class="line">- 第五步：实现第一个功能：查看部门列表</span><br><span class="line"></span><br><span class="line">    - 我们应该怎么去实现一个功能呢？</span><br><span class="line"></span><br><span class="line">        - 建议：你可以从后端往前端一步一步写。也可以从前端一步一步往后端写。都可以。但是千万要记住不要想起来什么写什么。你写代码的过程最好是程序的执行过程。也就是说：程序执行到哪里，你就写哪里。这样一个顺序流下来之后，基本上不会出现什么错误、意外。</span><br><span class="line">        - 从哪里开始？</span><br><span class="line">            - 假设从前端开始，那么一定是从用户点击按钮那里开始的。</span><br><span class="line"></span><br><span class="line">    - 第一：先修改前端页面的超链接，因为用户先点击的就是这个超链接。</span><br><span class="line"></span><br><span class="line">        - ```html</span><br><span class="line">            &lt;a href=&quot;/oa/dept/list&quot;&gt;查看部门列表&lt;/a&gt;</span><br></pre></td></tr></table></figure></li><li><p>第二：编写web.xml文件</p><ul><li>```xml<br>  <servlet><pre><code>  &lt;servlet-name&gt;list&lt;/servlet-name&gt;  &lt;servlet-class&gt;com.bjpowernode.oa.web.action.DeptListServlet&lt;/servlet-class&gt;</code></pre>  &lt;/servlet&gt;<br>  <servlet-mapping><pre><code>  &lt;servlet-name&gt;list&lt;/servlet-name&gt;  &lt;!--web.xml文件中的这个路径也是以“/”开始的，但是不需要加项目名--&gt;  &lt;url-pattern&gt;/dept/list&lt;/url-pattern&gt;</code></pre>  &lt;/servlet-mapping&gt;  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第三：编写DeptListServlet类继承HttpServlet类。然后重写doGet方法。</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">        package com.bjpowernode.oa.web.action;</span><br><span class="line">        </span><br><span class="line">        import jakarta.servlet.ServletException;</span><br><span class="line">        import jakarta.servlet.http.HttpServlet;</span><br><span class="line">        import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line">        import jakarta.servlet.http.HttpServletResponse;</span><br><span class="line">        </span><br><span class="line">        import java.io.IOException;</span><br><span class="line">        </span><br><span class="line">        public class DeptListServlet extends HttpServlet &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">                    throws ServletException, IOException &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>第四：在DeptListServlet类的doGet方法中连接数据库，查询所有的部门，动态的展示部门列表页面.</p><ul><li><p>分析list.html页面中哪部分是固定死的，哪部分是需要动态展示的。</p></li><li><p>list.html页面中的内容所有的双引号要替换成单引号，因为out.print(“”)这里有一个双引号，容易冲突。</p></li><li><p>现在写完这个功能之后，你会有一种感觉，感觉开发很繁琐，只使用servlet写代码太繁琐了。</p></li><li><p>```java<br>  while(rs.next()){</p><pre><code>  String deptno = rs.getString(&quot;a&quot;);  String dname = rs.getString(&quot;dname&quot;);  String loc = rs.getString(&quot;loc&quot;);  out.print(&quot;            &lt;tr&gt;&quot;);  out.print(&quot;                &lt;td&gt;&quot;+(++i)+&quot;&lt;/td&gt;&quot;);  out.print(&quot;                &lt;td&gt;&quot;+deptno+&quot;&lt;/td&gt;&quot;);  out.print(&quot;                &lt;td&gt;&quot;+dname+&quot;&lt;/td&gt;&quot;);  out.print(&quot;                &lt;td&gt;&quot;);  out.print(&quot;                    &lt;a href=&#39;&#39;&gt;删除&lt;/a&gt;&quot;);  out.print(&quot;                    &lt;a href=&#39;edit.html&#39;&gt;修改&lt;/a&gt;&quot;);  out.print(&quot;                    &lt;a href=&#39;detail.html&#39;&gt;详情&lt;/a&gt;&quot;);  out.print(&quot;                &lt;/td&gt;&quot;);  out.print(&quot;            &lt;/tr&gt;&quot;);</code></pre><p>  }</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第六步：查看部门详情。</span><br><span class="line"></span><br><span class="line">    - 建议：从前端往后端一步一步实现。首先要考虑的是，用户点击的是什么？用户点击的东西在哪里？</span><br><span class="line"></span><br><span class="line">        - 一定要先找到用户点的“详情”在哪里。找了半天，终于在后端的java程序中找到了</span><br><span class="line"></span><br><span class="line">            - ```html</span><br><span class="line">                &lt;a href=&#x27;写一个路径&#x27;&gt;详情&lt;/a&gt;</span><br></pre></td></tr></table></figure><ul><li><p>详情  是需要连接数据库的，所以这个超链接点击之后也是需要执行一段java代码的。所以要将这个超链接的路径修改一下。</p></li><li><p>注意：修改路径之后，这个路径是需要加项目名的。”/oa/dept/detail”</p></li></ul></li><li><p>技巧：</p><ul><li>```java<br>  out.print(“<a href='"+contextPath+"/dept/detail?deptno="+deptno+"'>详情</a>“);  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        - 重点：向服务器提交数据的格式：uri?name=value&amp;name=value&amp;name=value&amp;name=value</span><br><span class="line"></span><br><span class="line">        - 这里的问号，必须是英文的问号。不能中文的问号。</span><br><span class="line"></span><br><span class="line">- 解决404的问题。写web.xml文件。</span><br><span class="line"></span><br><span class="line">    - ```xml</span><br><span class="line">        &lt;servlet&gt;</span><br><span class="line">            &lt;servlet-name&gt;detail&lt;/servlet-name&gt;</span><br><span class="line">            &lt;servlet-class&gt;com.bjpowernode.oa.web.action.DeptDetailServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;/servlet&gt;</span><br><span class="line">        &lt;servlet-mapping&gt;</span><br><span class="line">            &lt;servlet-name&gt;detail&lt;/servlet-name&gt;</span><br><span class="line">            &lt;url-pattern&gt;/dept/detail&lt;/url-pattern&gt;</span><br><span class="line">        &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>编写一个类：DeptDetailServlet继承HttpServlet，重写doGet方法。</p><ul><li><p>```java<br>  package com.bjpowernode.oa.web.action;</p><p>  import jakarta.servlet.ServletException;<br>  import jakarta.servlet.http.HttpServlet;<br>  import jakarta.servlet.http.HttpServletRequest;<br>  import jakarta.servlet.http.HttpServletResponse;</p><p>  import java.io.IOException;</p><p>  public class DeptDetailServlet extends HttpServlet {</p><pre><code>  @Override  protected void doGet(HttpServletRequest request, HttpServletResponse response)          throws ServletException, IOException &#123;      //中文思路（思路来源于：你要做什么？目标：查看部门详细信息。）      // 第一步：获取部门编号      // 第二步：根据部门编号查询数据库，获取该部门编号对应的部门信息。      // 第三步：将部门信息响应到浏览器上。（显示一个详情。）  &#125;</code></pre><p>  }</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 在doGet方法当中：连接数据库，根据部门编号查询该部门的信息。动态展示部门详情页。</span><br><span class="line"></span><br><span class="line">- 第七步：删除部门</span><br><span class="line"></span><br><span class="line">    - 怎么开始？从哪里开始？从前端页面开始，用户点击删除按钮的时候，应该提示用户是否删除。因为删除这个动作是比较危险的。任何系统在进行删除操作之前，是必须要提示用户的，因为这个删除的动作有可能是用户误操作。（在前端页面上写JS代码，来提示用户是否删除。）</span><br><span class="line"></span><br><span class="line">        - ```html</span><br><span class="line">            &lt;a href=&quot;javascript:void(0)&quot; onclick=&quot;del(30)&quot; &gt;删除&lt;/a&gt;</span><br><span class="line">            &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">            function del(dno)&#123;</span><br><span class="line">            if(window.confirm(&quot;亲，删了不可恢复哦！&quot;))&#123;</span><br><span class="line">            document.location.href = &quot;/oa/dept/delete?deptno=&quot; + dno;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>以上的前端程序要写到后端的java代码当中：</p><ul><li>DeptListServlet类的doGet方法当中，使用out.print()方法，将以上的前端代码输出到浏览器上。</li></ul></li><li><p>解决404的问题：</p><ul><li><p><a href="http://localhost:8080/oa/dept/delete?deptno=30">http://localhost:8080/oa/dept/delete?deptno=30</a> </p></li><li><p>web.xml文件</p><ul><li>```xml<br>  <servlet><pre><code>  &lt;servlet-name&gt;delete&lt;/servlet-name&gt;  &lt;servlet-class&gt;com.bjpowernode.oa.web.action.DeptDelServlet&lt;/servlet-class&gt;</code></pre>  &lt;/servlet&gt;<br>  <servlet-mapping><pre><code>  &lt;servlet-name&gt;delete&lt;/servlet-name&gt;  &lt;url-pattern&gt;/dept/delete&lt;/url-pattern&gt;</code></pre>  &lt;/servlet-mapping&gt;  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 编写DeptDelServlet继承HttpServlet，重写doGet方法。</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">    package com.bjpowernode.oa.web.action;</span><br><span class="line">    </span><br><span class="line">    import jakarta.servlet.ServletException;</span><br><span class="line">    import jakarta.servlet.http.HttpServlet;</span><br><span class="line">    import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line">    import jakarta.servlet.http.HttpServletResponse;</span><br><span class="line">    </span><br><span class="line">    import java.io.IOException;</span><br><span class="line">    </span><br><span class="line">    public class DeptDelServlet extends HttpServlet &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void doGet(HttpServletRequest request, HttpServletResponse response)</span><br><span class="line">                throws ServletException, IOException &#123;</span><br><span class="line">            // 根据部门编号，删除部门。</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>删除成功或者失败的时候的一个处理（这里我们选择了转发，并没有使用重定向机制。）</p><ul><li>```java<br>  // 判断删除成功了还是失败了。<br>  if (count == 1) {<pre><code>  //删除成功  //仍然跳转到部门列表页面  //部门列表页面的显示需要执行另一个Servlet。怎么办？转发。  request.getRequestDispatcher(&quot;/dept/list&quot;).forward(request, response);</code></pre>  }else{<pre><code>  // 删除失败  request.getRequestDispatcher(&quot;/error.html&quot;).forward(request, response);</code></pre>  }  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 第八步：新增部门</span><br><span class="line"></span><br><span class="line">        - 注意：最后保存成功之后，转发到 /dept/list 的时候，会出现405，为什么？</span><br><span class="line">            - 第一：保存用的是post请求。底层要执行doPost方法。</span><br><span class="line">            - 第二：转发是一次请求，之前是post，之后还是post，因为它是一次请求。</span><br><span class="line">            - 第三：/dept/list Servlet当中只有一个doGet方法。</span><br><span class="line">            - 怎么解决？两种方案</span><br><span class="line">                - 第一种：在/dept/list Servlet中添加doPost方法，然后在doPost方法中调用doGet。</span><br><span class="line">                - 第二种：重定向。</span><br><span class="line"></span><br><span class="line">    - 第九步：跳转到修改部门的页面</span><br><span class="line"></span><br><span class="line">    - 第十步：修改部门</span><br><span class="line"></span><br><span class="line">## 在一个web应用中应该如何完成资源的跳转</span><br><span class="line"></span><br><span class="line">- 在一个web应用中通过两种方式，可以完成资源的跳转：</span><br><span class="line"></span><br><span class="line">    - 第一种方式：转发</span><br><span class="line">    - 第二种方式：重定向</span><br><span class="line"></span><br><span class="line">- 转发和重定向有什么区别？</span><br><span class="line"></span><br><span class="line">    - 代码上有什么区别？</span><br><span class="line"></span><br><span class="line">        - 转发</span><br><span class="line"></span><br><span class="line">            - ```java</span><br><span class="line">                // 获取请求转发器对象</span><br><span class="line">                RequestDispatcher dispatcher = request.getRequestDispatcher(&quot;/dept/list&quot;);</span><br><span class="line">                // 调用请求转发器对象的forward方法完成转发</span><br><span class="line">                dispatcher.forward(request, response);</span><br><span class="line">                </span><br><span class="line">                // 合并一行代码</span><br><span class="line">                request.getRequestDispatcher(&quot;/dept/list&quot;).forward(request, response);</span><br><span class="line">                // 转发的时候是一次请求，不管你转发了多少次。都是一次请求。</span><br><span class="line">                // AServlet转发到BServlet，再转发到CServlet，再转发到DServlet，不管转发了多少次，都在同一个request当中。</span><br><span class="line">                // 这是因为调用forward方法的时候，会将当前的request和response对象传递给下一个Servlet。</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>重定向</p><ul><li>```java<br>  // 注意：路径上要加一个项目名。为什么？<br>  // 浏览器发送请求，请求路径上是需要添加项目名的。<br>  // 以下这一行代码会将请求路径“/oa/dept/list”发送给浏览器<br>  // 浏览器会自发的向服务器发送一次全新的请求：/oa/dept/list<br>  response.sendRedirect(“/oa/dept/list”);  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">    - 形式上有什么区别？</span><br><span class="line"></span><br><span class="line">        - 转发（一次请求）</span><br><span class="line">            - 在浏览器地址栏上发送的请求是：http://localhost:8080/servlet10/a ，最终请求结束之后，浏览器地址栏上的地址还是这个。没变。</span><br><span class="line">        - 重定向（两次请求）</span><br><span class="line">            - 在浏览器地址栏上发送的请求是：http://localhost:8080/servlet10/a ，最终在浏览器地址栏上显示的地址是：http://localhost:8080/servlet10/b</span><br><span class="line"></span><br><span class="line">    - 转发和重定向的本质区别？</span><br><span class="line"></span><br><span class="line">        - 转发：是由WEB服务器来控制的。A资源跳转到B资源，这个跳转动作是Tomcat服务器内部完成的。</span><br><span class="line">        - 重定向：是浏览器完成的。具体跳转到哪个资源，是浏览器说了算。</span><br><span class="line"></span><br><span class="line">    - 使用一个例子去描述这个转发和重定向</span><br><span class="line"></span><br><span class="line">        - 借钱（转发：发送了一次请求）</span><br><span class="line">            - 杜老师没钱了，找张三借钱，其实张三没有钱，但是张三够义气，张三自己找李四借了钱，然后张三把这个钱给了杜老师，杜老师不知道这个钱是李四的，杜老师只求了一个人。杜老师以为这个钱就是张三的。</span><br><span class="line">        - 借钱（重定向：发送了两次请求）</span><br><span class="line">            - 杜老师没钱了，找张三借钱，张三没有钱，张三有一个好哥们，叫李四，李四是个富二代，于是张三将李四的家庭住址告诉了杜老师，杜老师按照这个地址去找到李四，然后从李四那里借了钱。显然杜老师在这个过程中，求了两个人。并且杜老师知道最终这个钱是李四借给俺的。</span><br><span class="line"></span><br><span class="line">- 转发和重定向应该如何选择？什么时候使用转发，什么时候使用重定向？</span><br><span class="line"></span><br><span class="line">    - 如果在上一个Servlet当中向request域当中绑定了数据，希望从下一个Servlet当中把request域里面的数据取出来，使用转发机制。</span><br><span class="line">    - 剩下所有的请求均使用重定向。（重定向使用较多。）</span><br><span class="line"></span><br><span class="line">- 跳转的下一个资源有没有要求呢？必须是一个Servlet吗？</span><br><span class="line"></span><br><span class="line">    - 不一定，跳转的资源只要是服务器内部合法的资源即可。包括：Servlet、JSP、HTML.....</span><br><span class="line"></span><br><span class="line">- 转发会存在浏览器的刷新问题。</span><br><span class="line"></span><br><span class="line">## 将oa项目中的资源跳转修改为合适的跳转方式</span><br><span class="line"></span><br><span class="line">- 删除之后，重定向</span><br><span class="line">- 修改之后，重定向</span><br><span class="line">- 保存之后，重定向</span><br><span class="line">- 重定向：</span><br><span class="line">    - 成功</span><br><span class="line">    - 失败</span><br><span class="line"></span><br><span class="line">## Servlet注解，简化配置</span><br><span class="line"></span><br><span class="line">- 分析oa项目中的web.xml文件</span><br><span class="line"></span><br><span class="line">    - 现在只是一个单标的CRUD，没有复杂的业务逻辑，很简单的一丢丢功能。web.xml文件中就有如此多的配置信息。如果采用这种方式，对于一个大的项目来说，这样的话web.xml文件会非常庞大，有可能最终会达到几十兆。</span><br><span class="line">    - 在web.xml文件中进行servlet信息的配置，显然开发效率比较低，每一个都需要配置一下。</span><br><span class="line">    - 而且在web.xml文件中的配置是很少被修改的，所以这种配置信息能不能直接写到java类当中呢？可以的。</span><br><span class="line"></span><br><span class="line">- Servlet3.0版本之后，推出了各种Servlet基于注解式开发。优点是什么？</span><br><span class="line"></span><br><span class="line">    - 开发效率高，不需要编写大量的配置信息。直接在java类上使用注解进行标注。</span><br><span class="line">    - web.xml文件体积变小了。</span><br><span class="line"></span><br><span class="line">- 并不是说注解有了之后，web.xml文件就不需要了：</span><br><span class="line"></span><br><span class="line">    - 有一些需要变化的信息，还是要配置到web.xml文件中。一般都是 注解+配置文件 的开发模式。</span><br><span class="line">    - 一些不会经常变化修改的配置建议使用注解。一些可能会被修改的建议写到配置文件中。</span><br><span class="line"></span><br><span class="line">- 我们的第一个注解：</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">        jakarta.servlet.annotation.WebServlet</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>在Servlet类上使用：@WebServlet，WebServlet注解中有哪些属性呢？</p><ul><li>name属性：用来指定Servlet的名字。等同于：<servlet-name></li><li>urlPatterns属性：用来指定Servlet的映射路径。可以指定多个字符串。<url-pattern></li><li>loadOnStartUp属性：用来指定在服务器启动阶段是否加载该Servlet。等同于：<load-on-startup></li><li>value属性：当注解的属性名是value的时候，使用注解的时候，value属性名是可以省略的。</li><li>注意：不是必须将所有属性都写上，只需要提供需要的。（需要什么用什么。）</li><li>注意：属性是一个数组，如果数组中只有一个元素，使用该注解的时候，属性值的大括号可以省略。</li></ul></li></ul></li><li><p>注解对象的使用格式：</p><ul><li>@注解名称(属性名=属性值, 属性名=属性值, 属性名=属性值….)</li></ul></li></ul><h2 id="使用模板方法设计模式优化oa项目"><a href="#使用模板方法设计模式优化oa项目" class="headerlink" title="使用模板方法设计模式优化oa项目"></a>使用模板方法设计模式优化oa项目</h2><ul><li>上面的注解解决了配置文件的问题。但是现在的oa项目仍然存在一个比较臃肿的问题。<ul><li>一个单标的CRUD，就写了6个Servlet。如果一个复杂的业务系统，这种开发方式，显然会导致类爆炸。（类的数量太大。）</li><li>怎么解决这个类爆炸问题？可以使用模板方法设计模式。</li></ul></li><li>怎么解决类爆炸问题？<ul><li>以前的设计是一个请求一个Servlet类。1000个请求对应1000个Servlet类。导致类爆炸。</li><li>可以这样做：一个请求对应一个方法。一个业务对应一个Servlet类。</li><li>处理部门相关业务的对应一个DeptServlet。处理用户相关业务的对应一个UserServlet。处理银行卡卡片业务对应一个CardServlet。</li></ul></li></ul><h2 id="分析使用纯粹Servlet开发web应用的缺陷"><a href="#分析使用纯粹Servlet开发web应用的缺陷" class="headerlink" title="分析使用纯粹Servlet开发web应用的缺陷"></a>分析使用纯粹Servlet开发web应用的缺陷</h2><ul><li>在Servlet当中编写HTML/CSS/JavaScript等前端代码。存在什么问题？<ul><li>java程序中编写前端代码，编写难度大。麻烦。</li><li>java程序中编写前端代码，显然程序的耦合度非常高。</li><li>java程序中编写前端代码，代码非常不美观。</li><li>java程序中编写前端代码，维护成本太高。（非常难于维护）<ul><li>修改小小的一个前端代码，只要有改动，就需要重新编译java代码，生成新的class文件，打一个新的war包，重新发布。</li></ul></li></ul></li><li>思考一下，如果是你的话，你准备怎么解决这个问题？<ul><li>思路很重要。使用什么样的思路去做、去解决这个问题<ul><li>上面的那个Servlet（Java程序）能不能不写了，让机器自动生成。我们程序员只需要写这个Servlet程序中的“前端的那段代码”，然后让机器将我们写的“前端代码”自动翻译生成“Servlet这种java程序”。然后机器再自动将“java”程序编译生成”class”文件。然后再使用JVM调用这个class中的方法。</li></ul></li></ul></li></ul><h2 id="关于B-S结构系统的会话机制（session机制）"><a href="#关于B-S结构系统的会话机制（session机制）" class="headerlink" title="关于B/S结构系统的会话机制（session机制）"></a>关于B/S结构系统的会话机制（session机制）</h2><ul><li><p>什么是会话？</p><ul><li>会话对应的英语单词：session</li><li>用户打开浏览器，进行一系列操作，然后最终将浏览器关闭，这个整个过程叫做：一次会话。会话在服务器端也有一个对应的java对象，这个java对象叫做：session。</li><li>什么是一次请求：用户在浏览器上点击了一下，然后到页面停下来，可以粗略认为是一次请求。请求对应的服务器端的java对象是：request。</li><li>一个会话当中包含多次请求。（一次会话对应N次请求。）</li></ul></li><li><p>在java的servlet规范当中，session对应的类名：HttpSession（jarkata.servlet.http.HttpSession）</p></li><li><p>session机制属于B/S结构的一部分。如果使用php语言开发WEB项目，同样也是有session这种机制的。session机制实际上是一个规范。然后不同的语言对这种会话机制都有实现。</p></li><li><p>session对象最主要的作用是：保存会话状态。（用户登录成功了，这是一种登录成功的状态，你怎么把登录成功的状态一直保存下来呢？使用session对象可以保留会话状态。）</p></li><li><p>为什么需要session对象来保存会话状态呢？</p><ul><li>因为HTTP协议是一种无状态协议。</li><li>什么是无状态：请求的时候，B和S是连接的，但是请求结束之后，连接就断了。为什么要这么做？HTTP协议为什么要设计成这样？因为这样的无状态协议，可以降低服务器的压力。请求的瞬间是连接的，请求结束之后，连接断开，这样服务器压力小。</li><li>只要B和S断开了，那么关闭浏览器这个动作，服务器知道吗？<ul><li>不知道。服务器是不知道浏览器关闭的。</li></ul></li></ul></li><li><p>张三打开一个浏览器A，李四打开一个浏览器B，访问服务器之后，在服务器端会生成：</p><ul><li>张三专属的session对象</li><li>李四专属的session对象</li></ul></li><li><p>为什么不使用request对象保存会话状态？为什么不使用ServletContext对象保存会话状态？</p><ul><li>request.setAttribute()存，request.getAttribute()取，ServletContext也有这个方法。request是请求域。ServletContext是应用域。</li><li>request是一次请求一个对象。</li><li>ServletContext对象是服务器启动的时候创建，服务器关闭的时候销毁，这个ServletContext对象只有一个。</li><li>ServletContext对象的域太大。</li><li>request请求域（HttpServletRequest）、session会话域（HttpSession）、application域（ServletContext）</li><li>request &lt; session &lt; application</li></ul></li><li><p>思考一下：session对象的实现原理。</p><ul><li>HttpSession session = request.getSession();</li><li>这行代码很神奇。张三访问的时候获取的session对象就是张三的。李四访问的时候获取的session对象就是李四的。</li></ul></li><li><p>session的实现原理：</p><ul><li>JSESSIONID=xxxxxx  这个是以Cookie的形式保存在浏览器的内存中的。浏览器只要关闭。这个cookie就没有了。</li><li>session列表是一个Map，map的key是sessionid，map的value是session对象。</li><li>用户第一次请求，服务器生成session对象，同时生成id，将id发送给浏览器。</li><li>用户第二次请求，自动将浏览器内存中的id发送给服务器，服务器根据id查找session对象。</li><li>关闭浏览器，内存消失，cookie消失，sessionid消失，会话等同于结束。</li></ul></li><li><p>Cookie禁用了，session还能找到吗？</p><ul><li>cookie禁用是什么意思？服务器正常发送cookie给浏览器，但是浏览器不要了。拒收了。并不是服务器不发了。</li><li>找不到了。每一次请求都会获取到新的session对象。</li><li>cookie禁用了，session机制还能实现吗？<ul><li>可以。需要使用URL重写机制。</li><li><a href="http://localhost:8080/servlet12/test/session;jsessionid=19D1C99560DCBF84839FA43D58F56E16">http://localhost:8080/servlet12/test/session;jsessionid=19D1C99560DCBF84839FA43D58F56E16</a></li><li>URL重写机制会提高开发者的成本。开发人员在编写任何请求路径的时候，后面都要添加一个sessionid，给开发带来了很大的难度，很大的成本。所以大部分的网站都是这样设计的：你要是禁用cookie，你就别用了。</li></ul></li></ul></li><li><p>总结一下到目前位置我们所了解的域对象：</p><ul><li>request（对应的类名：HttpServletRequest）<ul><li>请求域（请求级别的）</li></ul></li><li>session（对应的类名：HttpSession）<ul><li>会话域（用户级别的）</li></ul></li><li>application（对应的类名：ServletContext）<ul><li>应用域（项目级别的，所有用户共享的。）</li></ul></li><li>这三个域对象的大小关系<ul><li>request &lt; session &lt; application</li></ul></li><li>他们三个域对象都有以下三个公共的方法：<ul><li>setAttribute（向域当中绑定数据）</li><li>getAttribute（从域当中获取数据）</li><li>removeAttribute（删除域当中的数据）</li></ul></li><li>使用原则：尽量使用小的域。</li></ul></li><li><p>session掌握之后，我们怎么解决oa项目中的登录问题，怎么能让登录起作用。</p><ul><li>登录成功之后，可以将用户的登录信息存储到session当中。也就是说session中如果有用户的信息就代表用户登录成功了。session中没有用户信息，表示用户没有登录过。则跳转到登录页面。</li></ul></li><li><p>销毁session对象：</p><ul><li>```java<br>  session.invalidate();  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## Cookie</span><br><span class="line"></span><br><span class="line">- session的实现原理中，每一个session对象都会关联一个sessionid，例如：</span><br><span class="line"></span><br><span class="line">    - JSESSIONID=41C481F0224664BDB28E95081D23D5B8</span><br><span class="line">    - 以上的这个键值对数据其实就是cookie对象。</span><br><span class="line">    - 对于session关联的cookie来说，这个cookie是被保存在浏览器的“运行内存”当中。</span><br><span class="line">    - 只要浏览器不关闭，用户再次发送请求的时候，会自动将运行内存中的cookie发送给服务器。</span><br><span class="line">    - 例如，这个Cookie: JSESSIONID=41C481F0224664BDB28E95081D23D5B8就会再次发送给服务器。</span><br><span class="line">    - 服务器就是根据41C481F0224664BDB28E95081D23D5B8这个值来找到对应的session对象的。</span><br><span class="line"></span><br><span class="line">- cookie怎么生成？cookie保存在什么地方？cookie有啥用？浏览器什么时候会发送cookie，发送哪些cookie给服务器？？？？？？？</span><br><span class="line"></span><br><span class="line">- cookie最终是保存在浏览器客户端上的。</span><br><span class="line"></span><br><span class="line">    - 可以保存在运行内存中。（浏览器只要关闭cookie就消失了。）</span><br><span class="line">    - 也可以保存在硬盘文件中。（永久保存。）</span><br><span class="line"></span><br><span class="line">- cookie有啥用呢？</span><br><span class="line"></span><br><span class="line">    - cookie和session机制其实都是为了保存会话的状态。</span><br><span class="line">    - cookie是将会话的状态保存在浏览器客户端上。（cookie数据存储在浏览器客户端上的。）</span><br><span class="line">    - session是将会话的状态保存在服务器端上。（session对象是存储在服务器上。）</span><br><span class="line">    - 为什么要有cookie和session机制呢？因为HTTP协议是无状态 无连接协议。</span><br><span class="line"></span><br><span class="line">- cookie的经典案例</span><br><span class="line"></span><br><span class="line">    - 京东商城，在未登录的情况下，向购物车中放几件商品。然后关闭商城，再次打开浏览器，访问京东商城的时候，购物车中的商品还在，这是怎么做的？我没有登录，为什么购物车中还有商品呢？</span><br><span class="line">        - 将购物车中的商品编号放到cookie当中，cookie保存在硬盘文件当中。这样即使关闭浏览器。硬盘上的cookie还在。下一次再打开京东商城的时候，查看购物车的时候，会自动读取本地硬盘中存储的cookie，拿到商品编号，动态展示购物车中的商品。</span><br><span class="line">            - 京东存储购物车中商品的cookie可能是这样的：productIds=xxxxx,yyyy,zzz,kkkk</span><br><span class="line">            - 注意：cookie如果清除掉，购物车中的商品就消失了。</span><br><span class="line">    - 126邮箱中有一个功能：十天内免登录</span><br><span class="line">        - 这个功能也是需要cookie来实现的。</span><br><span class="line">        - 怎么实现的呢？</span><br><span class="line">            - 用户输入正确的用户名和密码，并且同时选择十天内免登录。登录成功后。浏览器客户端会保存一个cookie，这个cookie中保存了用户名和密码等信息，这个cookie是保存在硬盘文件当中的，十天有效。在十天内用户再次访问126的时候，浏览器自动提交126的关联的cookie给服务器，服务器接收到cookie之后，获取用户名和密码，验证，通过之后，自动登录成功。</span><br><span class="line">            - 怎么让cookie失效？</span><br><span class="line">                - 十天过后自动失效。</span><br><span class="line">                - 或者改密码。</span><br><span class="line">                - 或者在客户端浏览器上清除cookie。</span><br><span class="line"></span><br><span class="line">- cookie机制和session机制其实都不属于java中的机制，实际上cookie机制和session机制都是HTTP协议的一部分。php开发中也有cookie和session机制，只要是你是做web开发，不管是什么编程语言，cookie和session机制都是需要的。</span><br><span class="line"></span><br><span class="line">- HTTP协议中规定：任何一个cookie都是由name和value组成的。name和value都是字符串类型的。</span><br><span class="line"></span><br><span class="line">- 在java的servlet中，对cookie提供了哪些支持呢？</span><br><span class="line"></span><br><span class="line">    - 提供了一个Cookie类来专门表示cookie数据。jakarta.servlet.http.Cookie;</span><br><span class="line">    - java程序怎么把cookie数据发送给浏览器呢？response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">- 在HTTP协议中是这样规定的：当浏览器发送请求的时候，会自动携带该path下的cookie数据给服务器。（URL。）</span><br><span class="line"></span><br><span class="line">- 关于cookie的有效时间</span><br><span class="line"></span><br><span class="line">    - 怎么用java设置cookie的有效时间</span><br><span class="line">        - cookie.setMaxAge(60 * 60); 设置cookie在一小时之后失效。</span><br><span class="line">    - 没有设置有效时间：默认保存在浏览器的运行内存中，浏览器关闭则cookie消失。</span><br><span class="line">    - 只要设置cookie的有效时间 &gt; 0，这个cookie一定会存储到硬盘文件当中。</span><br><span class="line">    - 设置cookie的有效时间 = 0 呢？</span><br><span class="line">        - cookie被删除，同名cookie被删除。</span><br><span class="line">    - 设置cookie的有效时间 &lt; 0 呢？</span><br><span class="line">        - 保存在运行内存中。和不设置一样。</span><br><span class="line"></span><br><span class="line">- 关于cookie的path，cookie关联的路径：</span><br><span class="line"></span><br><span class="line">    - 假设现在发送的请求路径是“http://localhost:8080/servlet13/cookie/generate”生成的cookie，如果cookie没有设置path，默认的path是什么？</span><br><span class="line">        - 默认的path是：http://localhost:8080/servlet13/cookie 以及它的子路径。</span><br><span class="line">        - 也就是说，以后只要浏览器的请求路径是http://localhost:8080/servlet13/cookie 这个路径以及这个路径下的子路径，cookie都会被发送到服务器。</span><br><span class="line">    - 手动设置cookie的path</span><br><span class="line">        - cookie.setPath(“/servlet13”); 表示只要是这个servlet13项目的请求路径，都会提交这个cookie给服务器。</span><br><span class="line"></span><br><span class="line">- 浏览器发送cookie给服务器了，服务器中的java程序怎么接收？</span><br><span class="line"></span><br><span class="line">    - ```java</span><br><span class="line">        Cookie[] cookies = request.getCookies(); // 这个方法可能返回null</span><br><span class="line">        if(cookies != null)&#123;</span><br><span class="line">            for(Cookie cookie : cookies)&#123;</span><br><span class="line">                // 获取cookie的name</span><br><span class="line">                String name = cookie.getName();</span><br><span class="line">                // 获取cookie的value</span><br><span class="line">                String value = cookie.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br></pre></td></tr></table></figure></li></ul></li><li><p>使用cookie实现一下十天内免登录功能。</p><ul><li>先实现登录功能<ul><li>登录成功<ul><li>跳转到部门列表页面</li></ul></li><li>登录失败<ul><li>跳转到登录失败页面</li></ul></li></ul></li><li>修改前端页面<ul><li>在登录页面给一个复选框，复选框后面给一句话：十天内免登录。</li><li>用户选择了复选框：表示要支持十天内免登录。</li><li>用户没有选择复选框：表示用户不想使用十天内免登录功能。</li></ul></li><li>修改Servlet中的login方法<ul><li>如果用户登录成功了，并且用户登录时选择了十天内免登录功能，这个时候应该在Servlet的login方法中创建cookie，用来存储用户名和密码，并且设置路径，设置有效期，将cookie响应给浏览器。（浏览器将其自动保存在硬盘文件当中10天）</li></ul></li><li>用户再次访问该网站的时候，访问这个网站的首页的时候，有两个走向:<ul><li>要么跳转到部门列表页面</li><li>要么跳转到登录页面</li><li>以上分别有两个走向，这显然是需要编写java程序进行控制的。</li></ul></li></ul></li></ul><h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><ul><li><p>我的第一个JSP程序：</p><ul><li>在WEB-INF目录之外创建一个index.jsp文件，然后这个文件中没有任何内容。</li></ul></li><li><p>将上面的项目部署之后，启动服务器，打开浏览器，访问以下地址：</p><ul><li><a href="http://localhost:8080/jsp/index.jsp">http://localhost:8080/jsp/index.jsp</a> 展现在大家面前的是一个空白。</li><li>实际上访问以上的这个：index.jsp，底层执行的是：index_jsp.class 这个java程序。</li><li>这个index.jsp会被tomcat翻译生成index_jsp.java文件，然后tomcat服务器又会将index_jsp.java编译生成index_jsp.class文件</li><li>访问index.jsp，实际上执行的是index_jsp.class中的方法。</li></ul></li><li><p>JSP实际上就是一个Servlet。</p><ul><li>index.jsp访问的时候，会自动翻译生成index_jsp.java，会自动编译生成index_jsp.class，那么index_jsp 这就是一个类。</li><li>index_jsp 类继承 HttpJspBase，而HttpJspBase类继承的是HttpServlet。所以index_jsp类就是一个Servlet类。</li><li>jsp的生命周期和Servlet的生命周期完全相同。完全就是一个东西。没有任何区别。</li><li>jsp和servlet一样，都是单例的。（假单例。）</li></ul></li><li><p>jsp文件第一次访问的时候是比较慢的，为什么？</p><ul><li>为什么大部分的运维人员在给客户演示项目的时候，为什么提前先把所有的jsp文件先访问一遍。</li><li>第一次比较麻烦：<ul><li>要把jsp文件翻译生成java源文件</li><li>java源文件要编译生成class字节码文件</li><li>然后通过class去创建servlet对象</li><li>然后调用servlet对象的init方法</li><li>最后调用servlet对象的service方法。</li></ul></li><li>第二次就比较快了，为什么？<ul><li>因为第二次直接调用单例servlet对象的service方法即可。</li></ul></li></ul></li><li><p>JSP是什么？</p><ul><li>JSP是java程序。（JSP本质还是一个Servlet）</li><li>JSP是：JavaServer Pages的缩写。（基于Java语言实现的服务器端的页面。）</li><li>Servlet是JavaEE的13个子规范之一，那么JSP也是JavaEE的13个子规范之一。</li><li>JSP是一套规范。所有的web容器/web服务器都是遵循这套规范的，都是按照这套规范进行的“翻译”</li><li>每一个web容器/web服务器都会内置一个JSP翻译引擎。</li></ul></li><li><p>对JSP进行错误调试的时候，还是要直接打开JSP文件对应的java文件，检查java代码。</p></li><li><p>开发JSP的最高境界：</p><ul><li>眼前是JSP代码，但是脑袋中呈现的是java代码。</li></ul></li><li><p>JSP既然本质上是一个Servlet，那么JSP和Servlet到底有什么区别呢？</p><ul><li>职责不同：<ul><li>Servlet的职责是什么：收集数据。（Servlet的强项是逻辑处理，业务处理，然后链接数据库，获取/收集数据。）</li><li>JSP的职责是什么：展示数据。（JSP的强项是做数据的展示）</li></ul></li></ul></li><li><p>JSP的基础语法</p><ul><li><p>在jsp文件中直接编写文字，都会自动被翻译到哪里？</p><ul><li>翻译到servlet类的service方法的out.write(“翻译到这里”)，直接翻译到双引号里，被java程序当做普通字符串打印输出到浏览器。</li><li>在JSP中编写的HTML CSS JS代码，这些代码对于JSP来说只是一个普通的字符串。但是JSP把这个普通的字符串一旦输出到浏览器，浏览器就会对HTML CSS JS进行解释执行。展现一个效果。</li></ul></li><li><p>JSP的page指令（这个指令后面再详细说，这里先解决一下中文乱码问题），解决响应时的中文乱码问题：</p><ul><li>通过page指令来设置响应的内容类型，在内容类型的最后面添加：charset=UTF-8<ul><li>&lt;%@page contentType=”text/html;charset=UTF-8”%&gt;，表示响应的内容类型是text/html，采用的字符集UTF-8</li><li>&lt;%@page import=”java.util.List,java.util.ArrayList”%&gt;</li></ul></li></ul></li><li><p>怎么在JSP中编写Java程序：</p><ul><li>&lt;% java语句; %&gt;<ul><li>在这个符号当中编写的被视为java程序，被翻译到Servlet类的service方法内部。</li><li>这里你要细心点，你要思考，在&lt;% %&gt;这个符号里面写java代码的时候，你要时时刻刻的记住你正在“方法体”当中写代码，方法体中可以写什么，不可以写什么，你心里是否明白呢？</li><li>在service方法当中编写的代码是有顺序的，方法体当中的代码要遵循自上而下的顺序依次逐行执行。</li><li>service方法当中不能写静态代码块，不能写方法，不能定义成员变量。。。。。。</li><li>在同一个JSP当中 &lt;%%&gt; 这个符号可以出现多个。</li></ul></li><li>&lt;%! %&gt;<ul><li>在这个符号当中编写的java程序会自动翻译到service方法之外。</li><li>这个语法很少用，为什么？不建议使用，因为在service方法外面写静态变量和实例变量，都会存在线程安全问题，因为JSP就是servlet，servlet是单例的，多线程并发的环境下，这个静态变量和实例变量一旦有修改操作，必然会存在线程安全问题。</li></ul></li><li>JSP的输出语句<ul><li>怎么向浏览器上输出一个java变量。</li><li>&lt;% String name = “jack”;  out.write(“name = “ + name); %&gt;</li><li>注意：以上代码中的out是JSP的九大内置对象之一。可以直接拿来用。当然，必须只能在service方法内部使用。</li><li>如果向浏览器上输出的内容中没有“java代码”，例如输出的字符串是一个固定的字符串，可以直接在jsp中编写，不需要写到&lt;%%&gt; 这里。</li><li>如果输出的内容中含有“java代码”，这个时候可以使用以下语法格式：<ul><li>&lt;%= %&gt; 注意：在=的后面编写要输出的内容。</li><li>&lt;%= %&gt; 这个符号会被翻译到哪里？最终翻译成什么？ <ul><li>翻译成了这个java代码：   out.print();</li><li>翻译到service方法当中了。</li></ul></li><li>什么时候使用&lt;%=%&gt; 输出呢？输出的内容中含有java的变量，输出的内容是一个动态的内容，不是一个死的字符串。如果输出的是一个固定的字符串，直接在JSP文件中编写即可。</li></ul></li></ul></li></ul></li><li><p>在JSP中如何编写JSP的专业注释</p><ul><li>&lt;%—JSP的专业注释，不会被翻译到java源代码当中。—%&gt;</li><li><!--这种注释属于HTML的注释，这个注释信息仍然会被翻译到java源代码当中，不建议。--></li></ul></li><li><p>JSP基础语法总结：</p><ul><li>JSP中直接编写普通字符串<ul><li>翻译到service方法的out.write(“这里”)</li></ul></li><li>&lt;%%&gt;<ul><li>翻译到service方法体内部，里面是一条一条的java语句。</li></ul></li><li>&lt;%! %&gt;<ul><li>翻译到service方法之外。</li></ul></li><li>&lt;%= %&gt;<ul><li>翻译到service方法体内部，翻译为：out.print();</li></ul></li><li>&lt;%@page  contentType=”text/html;charset=UTF-8”%&gt;<ul><li>page指令，通过contentType属性用来设置响应的内容类型。</li></ul></li></ul></li><li><p>使用Servlet + JSP完成oa项目的改造。</p><ul><li><p>使用Servlet处理业务，收集数据。 使用JSP展示数据。</p></li><li><p>将之前原型中的html文件，全部修改为jsp，然后在jsp文件头部添加page指令（指定contentType防止中文乱码），将所有的JSP直接拷贝到web目录下。</p></li><li><p>完成所有页面的正常流转。（页面仍然能够正常的跳转。修改超链接的请求路径。）</p><ul><li>&lt;%=request.getContextPath() %&gt;  在JSP中动态的获取应用的根路径。</li></ul></li><li><p>Servlet中连接数据库，查询所有的部门，遍历结果集。</p><ul><li>遍历结果集的过程中，取出部门编号、部门名、位置等信息，封装成java对象。</li><li>将java对象存放到List集合中。</li><li>将List集合存储到request域当中。</li><li>转发forward到jsp。</li></ul></li><li><p>在JSP中：</p><ul><li>从request域当中取出List集合。</li><li>遍历List集合，取出每个部门对象。动态生成tr。</li></ul></li><li><p>思考一个问题：如果我只用JSP这一个技术，能不能开发web应用？</p><ul><li>当然可以使用JSP来完成所有的功能。因为JSP就是Servlet，在JSP的&lt;%%&gt;里面写的代码就是在service方法当中的，所以在&lt;%%&gt;当中完全可以编写JDBC代码，连接数据库，查询数据，也可以在这个方法当中编写业务逻辑代码，处理业务，都是可以的，所以使用单独的JSP开发web应用完全没问题。</li><li>虽然JSP一个技术就可以完成web应用，但是不建议，还是建议采用servlet + jsp的方式进行开发。这样都能将各自的优点发挥出来。JSP就是做数据展示。Servlet就是做数据的收集。（JSP中编写的Java代码越少越好。）一定要职责分明。</li></ul></li><li><p>JSP文件的扩展名必须是xxx.jsp吗？</p><ul><li><p>jsp文件的扩展名是可以配置的。不是固定的。</p></li><li><p>在CATALINA_HOME/conf/web.xml，在这个文件当中配置jsp文件的扩展名。</p></li><li><p>```xml<br>  <servlet-mapping></p><pre><code>  &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;  &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;  &lt;url-pattern&gt;*.jspx&lt;/url-pattern&gt;</code></pre><p>  &lt;/servlet-mapping&gt;</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">            - xxx.jsp文件对于小猫咪来说，只是一个普通的文本文件，web容器会将xxx.jsp文件最终生成java程序，最终调用的是java对象相关的方法，真正执行的时候，和jsp文件就没有关系了。</span><br><span class="line"></span><br><span class="line">            - 小窍门：JSP如果看不懂，建议把jsp翻译成java代码，就能看懂了。</span><br><span class="line"></span><br><span class="line">        - 同学问：包名bean是什么意思？</span><br><span class="line"></span><br><span class="line">            - javabean（java的logo是一杯冒着热气的咖啡。javabean被翻译为：咖啡豆）</span><br><span class="line">            - java是一杯咖啡，咖啡又是由一粒一粒的咖啡豆研磨而成。</span><br><span class="line">            - 整个java程序中有很多bean的存在。由很多bean组成。</span><br><span class="line">            - 什么是javabean？实际上javabean你可以理解为符合某种规范的java类，比如：</span><br><span class="line">                - 有无参数构造方法</span><br><span class="line">                - 属性私有化</span><br><span class="line">                - 对外提供公开的set和get方法</span><br><span class="line">                - 实现java.io.Serializable接口</span><br><span class="line">                - 重写toString</span><br><span class="line">                - 重写hashCode+equals</span><br><span class="line">                - ....</span><br><span class="line">            - javabean其实就是java中的实体类。负责数据的封装。</span><br><span class="line">            - 由于javabean符合javabean规范，具有更强的通用性。</span><br><span class="line"></span><br><span class="line">        - 完成剩下所有功能的改造。</span><br><span class="line"></span><br><span class="line">- 当前的oa应用存在的问题：</span><br><span class="line"></span><br><span class="line">    - 任何一个用户都可以访问这个系统，都可以对这个系统当中的数据进行增删改这些危险的操作。我只想让合法的用户去使用这个系统，不合法的用户不能访问这个系统，怎么办？</span><br><span class="line">        - 加一个登录功能。登录成功的可以访问该系统，登录失败不能访问。</span><br><span class="line">    - 实现登录功能：</span><br><span class="line">        - 步骤1：数据库当中添加一个用户表：t_user</span><br><span class="line">            - t_user表当中存储的是用户的登录信息，最基本的也包括：登录的用户名和登录的密码。</span><br><span class="line">            - 密码一般在数据库表当中存储的是密文。一般不以明文的形式存储。（这里先使用明文方式。）</span><br><span class="line">            - 向t_user表中插入数据。</span><br><span class="line">        - 步骤2：再实现一个登录页面。</span><br><span class="line">            - 登录页面上应该有一个登录的表单。有用户名和密码输入的框。</span><br><span class="line">            - 用户点击登录，提交表单，提交用户名和密码。form是post方式提交。</span><br><span class="line">        - 步骤3：后台要有一个对应的Servlet来处理登录的请求。</span><br><span class="line">            - 登录成功：跳转到部门列表页面。</span><br><span class="line">            - 登录失败：跳转到失败的页面。</span><br><span class="line">        - 步骤4：再提供一个登录失败的页面。</span><br><span class="line"></span><br><span class="line">- 登录功能实现了，目前存在的最大的问题：</span><br><span class="line"></span><br><span class="line">    - 这个登录功能目前只是一个摆设，没有任何作用。只要用户知道后端的请求路径，照样可以在不登录的情况下访问。</span><br><span class="line">    - 这个登录没有真正起到拦截的作用。怎么解决？</span><br><span class="line"></span><br><span class="line">- JSP的指令</span><br><span class="line"></span><br><span class="line">    - 指令的作用：指导JSP的翻译引擎如何工作（指导当前的JSP翻译引擎如何翻译JSP文件。）</span><br><span class="line"></span><br><span class="line">    - 指令包括哪些呢？</span><br><span class="line"></span><br><span class="line">        - include指令：包含指令，在JSP中完成静态包含，很少用了。（这里不讲）</span><br><span class="line">        - taglib指令：引入标签库的指令。这个到JJSTL标签库的时候再学习。现在先不管。</span><br><span class="line">        - page指令：目前重点学习一个page指令。</span><br><span class="line"></span><br><span class="line">    - 指令的使用语法是什么？</span><br><span class="line"></span><br><span class="line">        - &lt;%@指令名  属性名=属性值  属性名=属性值  属性名=属性值....%&gt;</span><br><span class="line"></span><br><span class="line">    - 关于page指令当中都有哪些常用的属性呢？</span><br><span class="line"></span><br><span class="line">        - ```jsp</span><br><span class="line">            &lt;%@page session=&quot;true|false&quot; %&gt;</span><br><span class="line">            true表示启用JSP的内置对象session，表示一定启动session对象。没有session对象会创建。</span><br><span class="line">            如果没有设置，默认值就是session=&quot;true&quot;</span><br><span class="line">            session=&quot;false&quot; 表示不启动内置对象session。当前JSP页面中无法使用内置对象session。</span><br></pre></td></tr></table></figure></li></ul></li><li><p>```jsp<br>  &lt;%@page contentType=”text/json” %&gt;<br>  contentType属性用来设置响应的内容类型<br>  但同时也可以设置字符集。<br>  &lt;%@page contentType=”text/json;charset=UTF-8” %&gt;</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```jsp</span><br><span class="line">    &lt;%@page pageEncoding=&quot;UTF-8&quot; %&gt;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot; 表示设置响应时采用的字符集。</span><br></pre></td></tr></table></figure></li><li><p>```jsp<br>  &lt;%@page import=”java.util.List, java.util.Date, java.util.ArrayList” %&gt;<br>  &lt;%@page import=”java.util.*” %&gt;<br>  import语句，导包。</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```jsp</span><br><span class="line">    &lt;%@page errorPage=&quot;/error.jsp&quot; %&gt;</span><br><span class="line">    当前页面出现异常之后，跳转到error.jsp页面。</span><br><span class="line">    errorPage属性用来指定出错之后的跳转位置。</span><br></pre></td></tr></table></figure></li><li><p>```jsp<br>  &lt;%@page isErrorPage=”true” %&gt;<br>  表示启用JSP九大内置对象之一：exception<br>  默认值是false。</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- JSP的九大内置对象</span><br><span class="line"></span><br><span class="line">    - jakarta.servlet.jsp.PageContext pageContext       页面作用域</span><br><span class="line">    - jakarta.servlet.http.HttpServletRequest request 请求作用域</span><br><span class="line">    - jakarta.servlet.http.HttpSession session  会话作用域</span><br><span class="line">    - jakarta.servlet.ServletContext application 应用作用域</span><br><span class="line">        - pageContext &lt; request &lt; session &lt; application</span><br><span class="line">        - 以上四个作用域都有：setAttribute、getAttribute、removeAttribute方法。</span><br><span class="line">        - 以上作用域的使用原则：尽可能使用小的域。</span><br><span class="line"></span><br><span class="line">    - java.lang.Throwable exception   </span><br><span class="line"></span><br><span class="line">    - jakarta.servlet.ServletConfig config</span><br><span class="line"></span><br><span class="line">    - java.lang.Object page  （其实是this，当前的servlet对象）</span><br><span class="line"></span><br><span class="line">    - jakarta.servlet.jsp.JspWriter out  （负责输出）</span><br><span class="line">    - jakarta.servlet.http.HttpServletResponse response （负责响应）</span><br><span class="line"></span><br><span class="line"># EL表达式</span><br><span class="line"></span><br><span class="line">- EL表达式是干什么用的？</span><br><span class="line"></span><br><span class="line">    - Expression Language（表达式语言）</span><br><span class="line">    - EL表达式可以代替JSP中的java代码，让JSP文件中的程序看起来更加整洁，美观。</span><br><span class="line">    - JSP中夹杂着各种java代码，例如&lt;% java代码 %&gt;、&lt;%=%&gt;等，导致JSP文件很混乱，不好看，不好维护。所以才有了后期的EL表达式。</span><br><span class="line">    - EL表达式可以算是JSP语法的一部分。EL表达式归属于JSP。</span><br><span class="line"></span><br><span class="line">- EL表达式出现在JSP中主要是：</span><br><span class="line"></span><br><span class="line">    - 从某个作用域中取数据，然后将其转换成字符串，然后将其输出到浏览器。这就是EL表达式的功效。三大功效：</span><br><span class="line">        - 第一功效：从某个域中取数据。</span><br><span class="line">            - 四个域：</span><br><span class="line">                - pageContext</span><br><span class="line">                - request</span><br><span class="line">                - session</span><br><span class="line">                - application</span><br><span class="line">        - 第二功效：将取出的数据转成字符串。</span><br><span class="line">            - 如果是一个java对象，也会自动调用java对象的toString方法将其转换成字符串。</span><br><span class="line">        - 第三功效：将字符串输出到浏览器。</span><br><span class="line">            - 和这个一样：&lt;%= %&gt;，将其输出到浏览器。</span><br><span class="line"></span><br><span class="line">- EL表达式很好用，基本的语法格式：</span><br><span class="line"></span><br><span class="line">    - $&#123;表达式&#125;</span><br><span class="line"></span><br><span class="line">- EL表达式的使用：</span><br><span class="line"></span><br><span class="line">    - ```jsp</span><br><span class="line">        &lt;%</span><br><span class="line">        // 创建User对象</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(&quot;jackson&quot;);</span><br><span class="line">        user.setPassword(&quot;1234&quot;);</span><br><span class="line">        user.setAge(50);</span><br><span class="line">        </span><br><span class="line">        // 将User对象存储到某个域当中。一定要存，因为EL表达式只能从某个范围中取数据。</span><br><span class="line">        // 数据是必须存储到四大范围之一的。</span><br><span class="line">        request.setAttribute(&quot;userObj&quot;, user);</span><br><span class="line">        %&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;%--使用EL表达式取--%&gt;</span><br><span class="line">        $&#123;这个位置写什么？？？？这里写的一定是存储到域对象当中时的name&#125;</span><br><span class="line">        要这样写：</span><br><span class="line">        $&#123;userObj&#125;</span><br><span class="line">        等同于java代码：&lt;%=request.getAttribute(&quot;userObj&quot;)%&gt;</span><br><span class="line">        你不要这样写：$&#123;&quot;userObj&quot;&#125;</span><br><span class="line">        </span><br><span class="line">        面试题：</span><br><span class="line">        $&#123;abc&#125; 和 $&#123;&quot;abc&quot;&#125;的区别是什么？</span><br><span class="line">        $&#123;abc&#125;表示从某个域中取出数据，并且被取的这个数据的name是&quot;abc&quot;，之前一定有这样的代码: 域.setAttribute(&quot;abc&quot;, 对象);</span><br><span class="line">        $&#123;&quot;abc&quot;&#125; 表示直接将&quot;abc&quot;当做普通字符串输出到浏览器。不会从某个域中取数据了。</span><br><span class="line">        </span><br><span class="line">        $&#123;userObj&#125; 底层是怎么做的？从域中取数据，取出user对象，然后调用user对象的toString方法，转换成字符串，输出到浏览器。</span><br><span class="line">        </span><br><span class="line">        &lt;%--如果想输出对象的属性值，怎么办？--%&gt;</span><br><span class="line">        $&#123;userObj.username&#125; 使用这个语法的前提是：User对象有getUsername()方法。</span><br><span class="line">        $&#123;userObj.password&#125; 使用这个语法的前提是：User对象有getPassword()方法。</span><br><span class="line">        $&#123;userObj.age&#125; 使用这个语法的前提是：User对象有getAge()方法。</span><br><span class="line">        $&#123;userObj.email&#125; 使用这个语法的前提是：User对象有getEmail()方法。</span><br><span class="line">        EL表达式中的. 这个语法，实际上调用了底层的getXxx()方法。</span><br><span class="line">        注意：如果没有对应的get方法，则出现异常。报500错误。</span><br><span class="line">        </span><br><span class="line">        $&#123;userObj.addr222.zipcode&#125;</span><br><span class="line">        以上EL表达式对应的java代码：</span><br><span class="line">        user.getAddr222().getZipcode()</span><br></pre></td></tr></table></figure></li></ul></li><li><p>EL表达式优先从小范围中读取数据。</p><ul><li>pageContext &lt; request &lt; session &lt; application</li></ul></li><li><p>EL表达式中有四个隐含的隐式的范围：（可以指定读取哪个范围里的值，一般再存数据的名字一样时使用）</p><ul><li>pageScope 对应的是 pageContext范围。</li><li>requestScope 对应的是 request范围。</li><li>sessionScope 对应的是 session范围。</li><li>applicationScope 对应的是 application范围。</li></ul></li><li><p>EL表达式对null进行了预处理。如果是null，则向浏览器输出一个空字符串。</p></li><li><p>EL表达式取数据的时候有两种形式：</p><ul><li>第一种：.  （大部分使用这种方式）</li><li>第二种：[ ] （如果存储到域的时候，这个name中含有特殊字符，可以使用 [ ]）<ul><li>request.setAttribute(“abc.def”, “zhangsan”);</li><li>${requestScope.abc.def} 这样是无法取值的。</li><li>应该这样：${requestScope[“abc.def”]}</li></ul></li></ul></li><li><p>掌握使用EL表达式，怎么从Map集合中取数据：</p><ul><li>${map.key}</li></ul></li><li><p>掌握使用EL表达式，怎么从数组和List集合中取数据：</p><ul><li>${数组[0]}</li><li>${数组[1]}</li><li>${list[0]}</li></ul></li><li><p>page指令当中，有一个属性，可以忽略EL表达式</p><ul><li><p>```jsp<br>  &lt;%@page contentType=”text/html;charset=UTF-8” isELIgnored=”true” %&gt;<br>  isELIgnored=”true” 表示忽略EL表达式<br>  isELIgnored=”false” 表示不忽略EL表达式。（这是默认值）</p><p>  isELIgnored=”true” 这个是全局的控制。</p><p>  可以使用反斜杠进行局部控制：${username} 这样也可以忽略EL表达式。</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 通过EL表达式获取应用的根：</span><br><span class="line"></span><br><span class="line">        - $&#123;pageContext.request.contextPath&#125;</span><br><span class="line"></span><br><span class="line">    - EL表达式中其他的隐式对象：</span><br><span class="line"></span><br><span class="line">        - pageContext</span><br><span class="line">        - param</span><br><span class="line">        - paramValues</span><br><span class="line">        - initParam</span><br><span class="line"></span><br><span class="line">    - EL表达式的运算符</span><br><span class="line"></span><br><span class="line">        - 算术运算符(+只能用来求和不能连接字符串)</span><br><span class="line">            - +、-、*、/、%</span><br><span class="line">            - `$&#123;10 + &quot;abc&quot;&#125;` ==&gt; 直接报错（不是数字就转成数字，转不成数字就直接报错 ==&gt; 这组符号都这样）</span><br><span class="line">        - 关系运算符</span><br><span class="line">            - [ ] == eq != &gt; &gt;= &lt; &lt;=</span><br><span class="line">            - EL表达式中 &quot;\==&quot; 、&quot;!=&quot;实际上都是调用equals，所以eq和==一样 </span><br><span class="line">        - 逻辑运算符</span><br><span class="line">            - [ ] !  &amp;&amp; ||  not and or</span><br><span class="line">        - 条件运算符</span><br><span class="line">            - [ ] ? : </span><br><span class="line">        - 取值运算符</span><br><span class="line">            - [ ]和.</span><br><span class="line">        - empty运算符</span><br><span class="line">            - [ ] empty运算符的结果是boolean类型</span><br><span class="line">            - [ ] $&#123;empty param.username&#125;</span><br><span class="line">            - [ ] $&#123;not empty param.username&#125;</span><br><span class="line">            - [ ] $&#123;!empty param.password&#125;</span><br><span class="line"></span><br><span class="line"># JSTL标签库</span><br><span class="line"></span><br><span class="line">- 什么是JSTL标签库？</span><br><span class="line"></span><br><span class="line">    - Java Standard Tag Lib（Java标准的标签库）</span><br><span class="line">    - JSTL标签库通常结合EL表达式一起使用。目的是让JSP中的java代码消失。</span><br><span class="line">    - 标签是写在JSP当中的，但实际上最终还是要执行对应的java程序。（java程序在jar包当中。）</span><br><span class="line"></span><br><span class="line">- 使用JSTL标签库的步骤：</span><br><span class="line"></span><br><span class="line">    - 第一步：引入JSTL标签库对应的jar包。</span><br><span class="line"></span><br><span class="line">        - tomcat10之后引入的jar包是：</span><br><span class="line">            - jakarta.servlet.jsp.jstl-2.0.0.jar</span><br><span class="line">            - jakarta.servlet.jsp.jstl-api-2.0.0.jar</span><br><span class="line">        - 在IDEA当中怎么引入？</span><br><span class="line">            - 在WEB-INF下新建lib目录，然后将jar包拷贝到lib当中。然后将其“Add Lib...”</span><br><span class="line">            - 一定是要和mysql的数据库驱动一样，都是放在WEB-INF/lib目录下的。</span><br><span class="line">            - 什么时候需要将jar包放到WEB-INF/lib目录下？如果这个jar是tomcat服务器没有的。</span><br><span class="line"></span><br><span class="line">    - 第二步：在JSP中引入要使用标签库。（使用taglib指令引入标签库。）</span><br><span class="line"></span><br><span class="line">        - JSTL提供了很多种标签，你要引入哪个标签？？？？重点掌握核心标签库。</span><br><span class="line"></span><br><span class="line">        - ```jsp</span><br><span class="line">            &lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line">            这个就是核心标签库。</span><br><span class="line">            prefix=&quot;这里随便起一个名字就行了，核心标签库，大家默认的叫做c，你随意。&quot;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>第三步：在需要使用标签的位置使用即可。表面使用的是标签，底层实际上还是java程序。</p></li></ul></li><li><p>JSTL标签的原理</p><ul><li><p>```jsp<br>  &lt;%@taglib prefix=”c” uri=”<a href="http://java.sun.com/jsp/jstl/core">http://java.sun.com/jsp/jstl/core</a>“ %&gt;<br>  以上uri后面的路径实际上指向了一个xxx.tld文件。<br>  tld文件实际上是一个xml配置文件。<br>  在tld文件中描述了“标签”和“java类”之间的关系。<br>  以上核心标签库对应的tld文件是：c.tld文件。它在哪里。<br>  在jakarta.servlet.jsp.jstl-2.0.0.jar里面META-INF目录下，有一个c.tld文件。</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 源码解析：配置文件tld解析</span><br><span class="line"></span><br><span class="line">    - ```jsp</span><br><span class="line">        &lt;tag&gt;</span><br><span class="line">            &lt;description&gt;对该标签的描述&lt;/description&gt;</span><br><span class="line">            &lt;name&gt;catch&lt;/name&gt; 标签的名字</span><br><span class="line">            &lt;tag-class&gt;org.apache.taglibs.standard.tag.common.core.CatchTag&lt;/tag-class&gt; 标签对应的java类。</span><br><span class="line">            &lt;body-content&gt;JSP&lt;/body-content&gt; 标签体当中可以出现的内容，如果是JSP，就表示标签体中可以出现符合JSP所有语法的代码。例如EL表达式。</span><br><span class="line">            &lt;attribute&gt;</span><br><span class="line">                &lt;description&gt;</span><br><span class="line">                对这个属性的描述</span><br><span class="line">                &lt;/description&gt;</span><br><span class="line">                &lt;name&gt;var&lt;/name&gt; 属性名</span><br><span class="line">                &lt;required&gt;false&lt;/required&gt; false表示该属性不是必须的。true表示该属性是必须的。</span><br><span class="line">                &lt;rtexprvalue&gt;false&lt;/rtexprvalue&gt; 这个描述说明了该属性是否支持EL表达式。false表示不支持。true表示支持EL表达式。</span><br><span class="line">            &lt;/attribute&gt;</span><br><span class="line">          &lt;/tag&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;c:catch var=&quot;&quot;&gt;</span><br><span class="line">        JSP....</span><br><span class="line">        &lt;/c:catch&gt;</span><br></pre></td></tr></table></figure></li><li><p>jstl中的核心标签库core当中有哪些常用的标签呢？</p><ul><li><p>c:if</p><ul><li><c:if test="boolean类型，支持EL表达式">&lt;/c: if&gt;</li></ul></li><li><p>c:forEach</p><ul><li><c:forEach items="集合，支持EL表达式" var="集合中的元素" varStatus="元素状态对象"> ${元素状态对象.count} &lt;/c: forEach&gt;</li><li><c:forEach var="i" begin="1" end="10" step="2"> ${i} &lt;/c: forEach&gt;</li></ul></li><li><p>c:choose c:when c:otherwise</p><ul><li>```jsp<br>  <c:choose><pre><code>  &lt;c:when test=&quot;$&#123;param.age &lt; 18&#125;&quot;&gt;      青少年  &lt;/c:when&gt;  &lt;c:when test=&quot;$&#123;param.age &lt; 35&#125;&quot;&gt;      青年  &lt;/c:when&gt;  &lt;c:when test=&quot;$&#123;param.age &lt; 55&#125;&quot;&gt;      中年  &lt;/c:when&gt;  &lt;c:otherwise&gt;      老年  &lt;/c:otherwise&gt;</code></pre>  &lt;/c:choose&gt;  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 改造OA</span><br><span class="line"></span><br><span class="line">- 使用什么技术改造呢？</span><br><span class="line"></span><br><span class="line">    - Servlet + JSP + EL表达式 + JSTL标签。进行改造。</span><br><span class="line"></span><br><span class="line">- 在前端HTML代码中，有一个标签，叫做base标签，这个标签可以设置整个网页的基础路径。</span><br><span class="line"></span><br><span class="line">    - 这不是Java的语法，也不是JSP的语法。是HTML中的一个语法。HTML中的一个标签。通常出现在head标签中。</span><br><span class="line"></span><br><span class="line">    - &lt; base href=&quot;http://localhost:8080/oa/&quot;&gt;</span><br><span class="line"></span><br><span class="line">    - 在当前页面中，凡是路径没有以“/”开始的，都会自动将base中的路径添加到这些路径之前。</span><br><span class="line"></span><br><span class="line">        - &lt; a href=&quot;ab/def&quot;&gt;&lt;/ a&gt;</span><br><span class="line">        - 等同于：&lt; a href=&quot;http://localhost:8080/oa/ab/def&quot;&gt;&lt;/ a&gt;</span><br><span class="line"></span><br><span class="line">    - 需要注意：在JS代码中的路径，保险起见，最好不要依赖base标签。JS代码中的路径最好写上全路径。</span><br><span class="line"></span><br><span class="line">    - ```jsp</span><br><span class="line">        静态base（写死了不好）&lt;base href=&quot;http://localhost:8080/CRUD/&quot;&gt;</span><br><span class="line">        &lt;base href=&quot;协议://服务器IP:端口号/项目名/&quot;</span><br><span class="line">        用EL表达式动态获取：</span><br><span class="line">        协议:$&#123;pageContext.request.scheme&#125;</span><br><span class="line">        服务器IP:$&#123;pageContext.request.serverName&#125;</span><br><span class="line">        端口号:$&#123;pageContext.request.serverPort&#125;</span><br><span class="line">        项目名：$&#123;pageContext.request.contextPath&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>```jsp<br>  <base href="${pageContext.request.scheme}://${pageContext.request.serverName}:${pageContext.request.serverPort}${pageContext.request.contextPath}/"></p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Filter过滤器</span><br><span class="line"></span><br><span class="line">- 当前的OA项目存在什么缺陷？</span><br><span class="line"></span><br><span class="line">    - DeptServlet、EmpServlet、OrderServlet。每一个Servlet都是处理自己相关的业务。在这些Servlet执行之前都是需要判断用户是否登录了。如果用户登录了，可以继续操作，如果没有登录，需要用户登录。这段判断用户是否登录的代码是固定的，并且在每一个Servlet类当中都需要编写，显然代码没有得到重复利用。包括每一个Servlet都要解决中文乱码问题，也有公共的代码。这些代码目前都是重复编写，并没有达到复用。怎么解决这个问题?</span><br><span class="line">        - 可以使用Servlet规范中的Filter过滤器来解决这个问题。</span><br><span class="line"></span><br><span class="line">- Filter是什么，有什么用，执行原理是什么？</span><br><span class="line"></span><br><span class="line">    - Filter是过滤器。</span><br><span class="line">    - Filter可以在Servlet这个目标程序执行之前添加代码。也可以在目标Servlet执行之后添加代码。之前之后都可以添加过滤规则。</span><br><span class="line">    - 一般情况下，都是在过滤器当中编写公共代码。</span><br><span class="line"></span><br><span class="line">- 一个过滤器怎么写呢？</span><br><span class="line"></span><br><span class="line">    - 第一步：编写一个Java类实现一个接口：jarkata.servlet.Filter。并且实现这个接口当中所有的方法。</span><br><span class="line"></span><br><span class="line">        - init方法：在Filter对象第一次被创建之后调用，并且只调用一次。</span><br><span class="line">        - doFilter方法：只要用户发送一次请求，则执行一次。发送N次请求，则执行N次。在这个方法中编写过滤规则。</span><br><span class="line">        - destroy方法：在Filter对象被释放/销毁之前调用，并且只调用一次。</span><br><span class="line"></span><br><span class="line">    - 第二步：在web.xml文件中对Filter进行配置。这个配置和Servlet很像。</span><br><span class="line"></span><br><span class="line">        - ```xml</span><br><span class="line">            &lt;filter&gt;</span><br><span class="line">                &lt;filter-name&gt;filter2&lt;/filter-name&gt;</span><br><span class="line">                &lt;filter-class&gt;com.bjpowernode.javaweb.servlet.Filter2&lt;/filter-class&gt;</span><br><span class="line">            &lt;/filter&gt;</span><br><span class="line">            &lt;filter-mapping&gt;</span><br><span class="line">                &lt;filter-name&gt;filter2&lt;/filter-name&gt;</span><br><span class="line">                &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;</span><br><span class="line">            &lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure><ul><li>或者使用注解：@WebFilter({“*.do”})</li></ul></li></ul></li><li><p>注意：</p><ul><li>Servlet对象默认情况下，在服务器启动的时候是不会新建对象的。</li><li>Filter对象默认情况下，在服务器启动的时候会新建对象。</li><li>Servlet是单例的。Filter也是单例的。（单实例。）</li></ul></li><li><p>目标Servlet是否执行，取决于两个条件：</p><ul><li>第一：在过滤器当中是否编写了：chain.doFilter(request, response); 代码。</li><li>第二：用户发送的请求路径是否和Servlet的请求路径一致。</li></ul></li><li><p>chain.doFilter(request, response); 这行代码的作用：</p><ul><li>执行下一个过滤器，如果下面没有过滤器了，执行最终的Servlet。</li></ul></li><li><p>注意：Filter的优先级，天生的就比Servlet优先级高。</p><ul><li>/a.do 对应一个Filter，也对应一个Servlet。那么一定是先执行Filter，然后再执行Servlet。</li></ul></li><li><p>关于Filter的配置路径：</p><ul><li>/a.do、/b.do、/dept/save。这些配置方式都是精确匹配。</li><li>/* 匹配所有路径。</li><li>*.do 后缀匹配。不要以 / 开始</li><li>/dept/*  前缀匹配。</li></ul></li><li><p>在web.xml文件中进行配置的时候，Filter的执行顺序是什么？</p><ul><li>依靠filter-mapping标签的配置位置，越靠上优先级越高。</li></ul></li><li><p>过滤器的调用顺序，遵循栈数据结构。</p></li><li><p>使用@WebFilter的时候，Filter的执行顺序是怎样的呢？</p><ul><li>执行顺序是：比较Filter这个类名。</li><li>比如：FilterA和FilterB，则先执行FilterA。</li><li>比如：Filter1和Filter2，则先执行Filter1.</li></ul></li><li><p>Filter的生命周期？</p><ul><li>和Servlet对象生命周期一致。</li><li>唯一的区别：Filter默认情况下，在服务器启动阶段就实例化。Servlet不会。</li></ul></li><li><p>Filter过滤器这里有一个设计模式：</p><ul><li>责任链设计模式。</li><li>过滤器最大的优点：<ul><li>在程序编译阶段不会确定调用顺序。因为Filter的调用顺序是配置到web.xml文件中的，只要修改web.xml配置文件中filter-mapping的顺序就可以调整Filter的执行顺序。显然Filter的执行顺序是在程序运行阶段动态组合的。那么这种设计模式被称为责任链设计模式。</li></ul></li><li>责任链设计模式最大的核心思想：<ul><li>在程序运行阶段，动态的组合程序的调用顺序。</li></ul></li></ul></li><li><p>使用过滤器改造OA项目。</p></li></ul><h1 id="Listener监听器"><a href="#Listener监听器" class="headerlink" title="Listener监听器"></a>Listener监听器</h1><ul><li><p>什么是监听器？</p><ul><li>监听器是Servlet规范中的一员。就像Filter一样。Filter也是Servlet规范中的一员。</li><li>在Servlet中，所有的监听器接口都是以“Listener”结尾。</li></ul></li><li><p>监听器有什么用？</p><ul><li>监听器实际上是Servlet规范留给我们javaweb程序员的特殊时机。</li><li>特殊的时刻如果想执行这段代码，你需要想到使用对应的监听器。</li></ul></li><li><p>Servlet规范中提供了哪些监听器？</p><ul><li>jakarta.servlet包下：<ul><li>ServletContextListener</li><li>ServletContextAttributeListener</li><li>ServletRequestListener</li><li>ServletRequestAttributeListener</li></ul></li><li>jakarta.servlet.http包下：<ul><li>HttpSessionListener</li><li>HttpSessionAttributeListener<ul><li>该监听器需要使用@WebListener注解进行标注。</li><li>该监听器监听的是什么？是session域中数据的变化。只要数据变化，则执行相应的方法。主要监测点在session域对象上。</li></ul></li><li>HttpSessionBindingListener<ul><li>该监听器不需要使用@WebListener进行标注。</li><li>假设User类实现了该监听器，那么User对象在被放入session的时候触发bind事件，User对象从session中删除的时候，触发unbind事件。</li><li>假设Customer类没有实现该监听器，那么Customer对象放入session或者从session删除的时候，不会触发bind和unbind事件。</li></ul></li><li>HttpSessionIdListener<ul><li>session的id发生改变的时候，监听器中的唯一一个方法就会被调用。</li></ul></li><li>HttpSessionActivationListener<ul><li>监听session对象的钝化和活化的。</li><li>钝化：session对象从内存存储到硬盘文件。</li><li>活化：从硬盘文件把session恢复到内存。</li></ul></li></ul></li></ul></li><li><p>实现一个监听器的步骤：以ServletContextListener为例。</p><ul><li><p>第一步：编写一个类实现ServletContextListener接口。并且实现里面的方法。</p><ul><li><p>```java<br>  void contextInitialized(ServletContextEvent event)<br>  void contextDestroyed(ServletContextEvent event)</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 第二步：在web.xml文件中对ServletContextListener进行配置，如下：</span><br><span class="line"></span><br><span class="line">    - ```jsp</span><br><span class="line">        &lt;listener&gt;</span><br><span class="line">            &lt;listener-class&gt;com.bjpowernode.javaweb.listener.MyServletContextListener&lt;/listener-class&gt;</span><br><span class="line">        &lt;/listener&gt;</span><br></pre></td></tr></table></figure></li><li><p>当然，第二步也可以不使用配置文件，也可以用注解，例如：@WebListener</p></li></ul></li></ul></li><li><p>注意：所有监听器中的方法都是不需要javaweb程序员调用的，由服务器来负责调用？什么时候被调用呢？</p><ul><li>当某个特殊的事件发生（特殊的事件发生其实就是某个时机到了。）之后，被web服务器自动调用。</li></ul></li><li><p>思考一个业务场景：</p><ul><li>请编写一个功能，记录该网站实时的在线用户的个数。</li><li>我们可以通过服务器端有没有分配session对象，因为一个session代表了一个用户。有一个session就代表有一个用户。如果你采用这种逻辑去实现的话，session有多少个，在线用户就有多少个。这种方式的话：HttpSessionListener够用了。session对象只要新建，则count++，然后将count存储到ServletContext域当中，在页面展示在线人数即可。</li><li>业务发生改变了，只统计登录的用户的在线数量，这个该怎么办？<ul><li>session.setAttribute(“user”, userObj); </li><li>用户登录的标志是什么？session中曾经存储过User类型的对象。那么这个时候可以让User类型的对象实现HttpSessionBindingListener监听器，只要User类型对象存储到session域中，则count++，然后将count++存储到ServletContext对象中。页面展示在线人数即可。</li></ul></li></ul></li><li><p>实现oa项目中当前登录在线的人数。</p><ul><li>什么代表着用户登录了？<ul><li>session.setAttribute(“user”, userObj); User类型的对象只要往session中存储过，表示有新用户登录。</li></ul></li><li>什么代表着用户退出了？<ul><li>session.removeAttribute(“user”); User类型的对象从session域中移除了。</li><li>或者有可能是session销毁了。（session超时）</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>接口</title>
      <link href="/posts/1498536549.html"/>
      <url>/posts/1498536549.html</url>
      
        <content type="html"><![CDATA[ <details>我学习 B站 韩顺平 老师课程的学习笔记</details><h1 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h1><p>主要包含关键字：<br>interface<br>implements<br>default</p><h2 id="接口基本规则"><a href="#接口基本规则" class="headerlink" title="接口基本规则"></a>接口基本规则</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Ainterface</span> &#123;</span><br><span class="line">    <span class="comment">//可以有属性</span></span><br><span class="line">    <span class="comment">//1、属性只能用public修饰</span></span><br><span class="line">    <span class="comment">//2、属性定义时就要赋值，因为是final</span></span><br><span class="line">    <span class="comment">//3、可以使用static、final关键字修饰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span>  <span class="type">int</span> <span class="variable">n3</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">static</span> <span class="variable">n4</span> <span class="operator">=</span> <span class="number">15</span>;</span><br><span class="line">    <span class="comment">//实际上不论怎么定义在接口中的属性都是public static final修饰的</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//可以有方法（1）抽象方法 （2）默认实现方法（显示使用default关键字） （3）静态方法</span></span><br><span class="line">    <span class="comment">//在java8之前只能有抽象方法</span></span><br><span class="line">    <span class="comment">//这里的抽象方法不需要abstract关键字</span></span><br><span class="line">    <span class="comment">//只能用public修饰</span></span><br><span class="line">    <span class="comment">//抽象方法都不能使用final、static来修饰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//在Java8之后方法可以有方法体了</span></span><br><span class="line">    <span class="comment">//但是必须要有default关键字修饰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">hi3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hi3()....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//也可以用使用静态方法（不是抽象方法嘛）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hi4</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hi4()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AinterfaceTestDrive</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="comment">//使用接口方法</span></span><br><span class="line">        test.hi();</span><br><span class="line">        test.hi3();</span><br><span class="line">        Ainterface.hi4();<span class="comment">//hi4()是静态方法，对于接口来说只能通过接口名来调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">implements</span> <span class="title class_">Ainterface</span>&#123;</span><br><span class="line">    <span class="comment">//必须要重写抽象方法，可以不重写已经定义了的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hi()...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="接口使用细节"><a href="#接口使用细节" class="headerlink" title="接口使用细节"></a>接口使用细节</h2><ol><li><p>接口不能被实例化</p></li><li><p>接口中的方法是public方法，接口中的抽象方法，可以不用abstract修饰（实际上可以理解为abstract被隐藏了）（必须是public，但是如果在接口中省略public和平常的默认不一样，在接口中的默认相当于public）</p></li><li><p>一个普通类实现接口就必须将该接口的所有方法都实现（可以用alt+enter快速重写）</p></li><li><p>抽象类实现接口，可以不用实现接口的方法</p></li><li><p>一个类同时可以实现多个接口（变相的完成了多个继承）</p></li><li><p>接口中的属性都是final，而且是public static final修饰符（接口中的属性可以直接省略修饰符）</p></li><li><p>接口属性的访问形式：接口名.属性名（静态的）</p></li><li><p>接口不能继承其它类，但可以继承多个别的接口<br> 语法：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_">B</span>,C&#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>接口的修饰符只能是public和默认，这和类的修饰符一样</p></li><li><p>一个类实现一个接口，相当于继承一个接口，可以调用接口中的属性<br>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">23</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">implements</span> <span class="title class_">A</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">///main中：</span></span><br><span class="line"><span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line"><span class="comment">//下面三个语句都合法且结果都为23</span></span><br><span class="line">System.out.println(b.a);</span><br><span class="line">System.out.println(A.a);</span><br><span class="line">System.out.println(B.a);</span><br></pre></td></tr></table></figure></li></ol><h2 id="实现接口和继承类"><a href="#实现接口和继承类" class="headerlink" title="实现接口和继承类"></a>实现接口和继承类</h2><p>继承：当子类继承了父类，就自动拥有了父类的功能，如果子类需要扩展功能，就可以通过实现接口的方式扩展。可以理解实现接口时对java单继承机制的一种补充（但接口和继承还是有不一样的）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.abstract_.interface_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtendsVsInterface</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LittleMonkey1</span> <span class="variable">littleMonkey1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LittleMonkey1</span>(<span class="string">&quot;悟空&quot;</span>);</span><br><span class="line">        littleMonkey1.climbing();</span><br><span class="line">        <span class="type">LitterMonkey2</span> <span class="variable">litterMonkey2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LitterMonkey2</span>(<span class="string">&quot;六耳猕猴&quot;</span>);</span><br><span class="line">        litterMonkey2.climbing();</span><br><span class="line">        litterMonkey2.swimming();</span><br><span class="line">        litterMonkey2.flying();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monkey</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Monkey</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">climbing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; 会爬树...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LittleMonkey1</span> <span class="keyword">extends</span> <span class="title class_">Monkey</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LittleMonkey1</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小猴子继承大猴子，但是我想小猴子像鱼一样会游泳,像鸟一样会飞</span></span><br><span class="line"><span class="comment">// 定义一条鱼的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Fish_able</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fish_name</span> <span class="operator">=</span> <span class="string">&quot;金鱼&quot;</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">swimming</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义一只鸟的接口</span></span><br><span class="line"><span class="keyword">interface</span>  <span class="title class_">Bird_able</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">bird_name</span> <span class="operator">=</span> <span class="string">&quot;小鹰&quot;</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">flying</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//为了和前面的继承区别开，在弄一个小猴子类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LitterMonkey2</span> <span class="keyword">extends</span> <span class="title class_">Monkey</span> <span class="keyword">implements</span>  <span class="title class_">Fish_able</span>,Bird_able&#123;<span class="comment">//继承和实现接口同时使用的情况</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LitterMonkey2</span> <span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">swimming</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; 通过学习学会了像 &quot;</span> + Fish_able.fish_name + <span class="string">&quot; 一样游泳...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flying</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; 通过学习学会了像 &quot;</span> + Bird_able.bird_name + <span class="string">&quot; 一样飞翔...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="主要不同点"><a href="#主要不同点" class="headerlink" title="主要不同点"></a>主要不同点</h3><ul><li>接口和继承解决问题不同<br>  继承的价值主要在于：解决代码的复用性和可维护性<br>  接口的价值主要在于：设计，设计好各种规范（方法），让其他类去实现这些方法</li><li>接口比继承更灵活<br>  继承时满足is-a关系（即要按常理思考能想得通的，比如小猴子继承大猴子活动大猴子的技能，猴子会飞时不和常理的），但是接口是like-a的关系（就可以让猴子学会飞）</li><li>接口在一定程度上实现代码解耦<br>  即接口规范性+动态绑定就可以很好的解耦</li></ul><h2 id="接口的多态"><a href="#接口的多态" class="headerlink" title="接口的多态"></a>接口的多态</h2><ol><li><p>多态参数<br> 接口可以实现多态参数，以接口为参数类型的接口函数可以使用接收实现了这个接口的类的实例作为参数。接口类性的变量可以指向实现了接口的对象实例<br> 例如：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IF</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Master</span> <span class="keyword">implements</span> <span class="title class_">IF</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">IF</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//main中：</span></span><br><span class="line"><span class="type">IF</span> <span class="variable">if01</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Master</span>();</span><br><span class="line">if01 = <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br></pre></td></tr></table></figure><p>  也就是继承体现多态的向上转型<br>  同样也可以向下转型：同样的语法</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(if01 <span class="keyword">instanceof</span> Car)&#123;<span class="comment">//一定要先判断运行类型判断能不能转型</span></span><br><span class="line">    if01 = (Car)if01;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>多态数组<br> 既然可以实现多态参数，也就是可以实现向上转型那么当然可以实现多态参数。在继承的多态数组中是以父类为编译类型，那么在这里就是以接口为编译类型了</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">USB</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone_</span> <span class="keyword">implements</span> <span class="title class_">USB</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Camera_</span> <span class="keyword">implements</span> <span class="title class_">USB</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main中：</span></span><br><span class="line">USB[] usb = <span class="keyword">new</span> <span class="title class_">USB</span>[<span class="number">2</span>];<span class="comment">//第一两个大小的USB接口</span></span><br><span class="line">usb[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">Phone_</span>;<span class="comment">//实现多态数组</span></span><br><span class="line">usb[<span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Camera_</span>;<span class="comment">//实现多态数组</span></span><br></pre></td></tr></table></figure><ol><li>接口的多态传递</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterfacePolyPass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//接口类型可以指向实现接口的对象的实例</span></span><br><span class="line">        <span class="type">IG</span> <span class="variable">ig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Teacher</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果只是实现IG没有实现IH按理来说是不能指向IG的对象的实例的，所以下面语句是会报错的</span></span><br><span class="line">        <span class="comment">//但是如果使得IG继承IH，那么相当于Teacher也实现了IH，所以下面的语句又不会报错了</span></span><br><span class="line">        <span class="comment">//这里就是接口的多态传递现象</span></span><br><span class="line">        <span class="type">IH</span> <span class="variable">ih</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Teacher</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IH</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span>  <span class="title class_">IG</span> <span class="keyword">extends</span> <span class="title class_">IH</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">implements</span> <span class="title class_">IG</span> &#123;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>枚举类</title>
      <link href="/posts/2207806286.html"/>
      <url>/posts/2207806286.html</url>
      
        <content type="html"><![CDATA[<details>我学习 B站 韩顺平 老师课程的学习笔记</details><h1 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h1><h2 id="不用enum的实现"><a href="#不用enum的实现" class="headerlink" title="不用enum的实现"></a>不用enum的实现</h2><p>类似于单例设计模型<br>直接在类声明的内部建立几个静态的对象（访问权限除了是私有都可以），并且将构造器的访问权限设置为私有的<br>实际上定义的静态变量内部都是以<code>public static final</code>为修饰符的</p><h3 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.enum_.Enum01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em1</span> <span class="operator">=</span> EnumTestClass.SPRING;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em2</span> <span class="operator">=</span> EnumTestClass.SUMMER;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em3</span> <span class="operator">=</span> EnumTestClass.AUTUMN;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em4</span> <span class="operator">=</span> EnumTestClass.WINTER;</span><br><span class="line">        System.out.println(<span class="string">&quot;em1 name: &quot;</span> + em1.getName() + <span class="string">&quot; em1 description: &quot;</span> + em2.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;em2 name: &quot;</span> + em2.getName() + <span class="string">&quot; em2 description: &quot;</span> + em2.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;em3 name: &quot;</span> + em3.getName() + <span class="string">&quot; em3 description: &quot;</span> + em3.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;em4 name: &quot;</span> + em4.getName() + <span class="string">&quot; em4 description: &quot;</span> + em4.getDesc());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EnumTestClass</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EnumTestClass</span><span class="params">(String name, String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">EnumTestClass</span> <span class="variable">SPRING</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;春天&quot;</span>,<span class="string">&quot;温暖&quot;</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="type">EnumTestClass</span> <span class="variable">SUMMER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;夏天&quot;</span>,<span class="string">&quot;炎热&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">EnumTestClass</span> <span class="variable">AUTUMN</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;秋天&quot;</span>,<span class="string">&quot;凉爽&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EnumTestClass</span> <span class="variable">WINTER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;冬天&quot;</span>,<span class="string">&quot;寒冷&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用enum的实现"><a href="#使用enum的实现" class="headerlink" title="使用enum的实现"></a>使用enum的实现</h2><p>将<code>class</code>替换为<code>enum</code>基本就行了</p><h3 id="与class的区别："><a href="#与class的区别：" class="headerlink" title="与class的区别："></a>与class的区别：</h3><ul><li>常量不需要再用之前那样定义了，直接<code>SPRING(&quot;春天&quot;,&quot;温暖&quot;);</code>的格式就可以替换原本的<code>public static final EnumTestClass SPRING = new EnumTestClass(&quot;春天&quot;,&quot;温暖&quot;);</code></li><li>枚举类型的常量必须定义在enum的开头</li><li>多个枚举类型常量之间用逗号间隔，在最后一个枚举类型的后面加分号</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.enum_.Enum01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em1</span> <span class="operator">=</span> EnumTestClass.SPRING;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em2</span> <span class="operator">=</span> EnumTestClass.SUMMER;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em3</span> <span class="operator">=</span> EnumTestClass.AUTUMN;</span><br><span class="line">        <span class="type">EnumTestClass</span> <span class="variable">em4</span> <span class="operator">=</span> EnumTestClass.WINTER;</span><br><span class="line">        System.out.println(<span class="string">&quot;em1 name: &quot;</span> + em1.getName() + <span class="string">&quot; em1 description: &quot;</span> + em2.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;em2 name: &quot;</span> + em2.getName() + <span class="string">&quot; em2 description: &quot;</span> + em2.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;em3 name: &quot;</span> + em3.getName() + <span class="string">&quot; em3 description: &quot;</span> + em3.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;em4 name: &quot;</span> + em4.getName() + <span class="string">&quot; em4 description: &quot;</span> + em4.getDesc());</span><br><span class="line"></span><br><span class="line">        <span class="type">EnumTestClass2</span> <span class="variable">e1</span> <span class="operator">=</span> EnumTestClass2.SPRING;</span><br><span class="line">        <span class="type">EnumTestClass2</span> <span class="variable">e2</span> <span class="operator">=</span> EnumTestClass2.SUMMER;</span><br><span class="line">        <span class="type">EnumTestClass2</span> <span class="variable">e3</span> <span class="operator">=</span> EnumTestClass2.AUTUMN;</span><br><span class="line">        <span class="type">EnumTestClass2</span> <span class="variable">e4</span> <span class="operator">=</span> EnumTestClass2.WINTER;</span><br><span class="line">        System.out.println(<span class="string">&quot;e1 name: &quot;</span> + e1.getName() + <span class="string">&quot; e1 description: &quot;</span> + e1.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;e2 name: &quot;</span> + e2.getName() + <span class="string">&quot; e2 description: &quot;</span> + e2.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;e3 name: &quot;</span> + e3.getName() + <span class="string">&quot; e3 description: &quot;</span> + e3.getDesc());</span><br><span class="line">        System.out.println(<span class="string">&quot;e4 name: &quot;</span> + e4.getName() + <span class="string">&quot; e4 description: &quot;</span> + e4.getDesc());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用enum实现枚举变量</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumTestClass2</span>&#123;</span><br><span class="line">    SPRING(<span class="string">&quot;春天&quot;</span>,<span class="string">&quot;温暖&quot;</span>),SUMMER(<span class="string">&quot;夏天&quot;</span>,<span class="string">&quot;炎热&quot;</span>),AUTUMN(<span class="string">&quot;秋天&quot;</span>,<span class="string">&quot;凉爽&quot;</span>),WINTER(<span class="string">&quot;冬天&quot;</span>,<span class="string">&quot;寒冷&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    EnumTestClass2(String name, String desc) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不用enum实现枚举变量</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EnumTestClass</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">EnumTestClass</span><span class="params">(String name, String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="type">EnumTestClass</span> <span class="variable">SPRING</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;春天&quot;</span>,<span class="string">&quot;温暖&quot;</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="type">EnumTestClass</span> <span class="variable">SUMMER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;夏天&quot;</span>,<span class="string">&quot;炎热&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">EnumTestClass</span> <span class="variable">AUTUMN</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;秋天&quot;</span>,<span class="string">&quot;凉爽&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">EnumTestClass</span> <span class="variable">WINTER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnumTestClass</span>(<span class="string">&quot;冬天&quot;</span>,<span class="string">&quot;寒冷&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDesc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Enum类"><a href="#Enum类" class="headerlink" title="Enum类"></a>Enum类</h2><p>每个枚举类都要隐式的继承Enum类<br>Enum类有些类方法可供使用</p><h3 id="Enum类的方法"><a href="#Enum类的方法" class="headerlink" title="Enum类的方法"></a>Enum类的方法</h3><h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h4><p>返回调用这个方法的枚举类对象的对象名<br>所以我们使用enum关键字定义的枚举类没有特殊要求其实可以不用重写toString()方法<br>这个方法是一个非静态方法</p><h5 id="方法源码"><a href="#方法源码" class="headerlink" title="方法源码"></a>方法源码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="name"><a href="#name" class="headerlink" title="name()"></a>name()</h4><p>和toString()只有部分区别，toString()一般会将枚举类中的所有属性返回，但是name()只是返回枚举常量名</p><h4 id="values"><a href="#values" class="headerlink" title="values()"></a>values()</h4><p>通过枚举类直接调用此方法返回枚举类的对象数组, 也就是将枚举类的对象以一个一个数组元素合并成一个数组返回<br>这个方法是一个静态方法<br>该方法可以很方便地遍历所有枚举值</p><h5 id="格式示例"><a href="#格式示例" class="headerlink" title="格式示例"></a>格式示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">枚举类名[] 数组名 = 枚举类名.values();</span><br></pre></td></tr></table></figure><p>==注意==<br>不需要使用new，因为枚举对象在定义时其实已经被new了</p><h4 id="ordinal"><a href="#ordinal" class="headerlink" title="ordinal()"></a>ordinal()</h4><p>找到每个枚举常量的索引，就像数组索引一样也是从0开始为第一个。<br>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Weeks</span> <span class="variable">weeks1</span> <span class="operator">=</span> Weeks.FRIDAY;</span><br><span class="line">System.out.println(weeks1.ordinal());</span><br></pre></td></tr></table></figure><h5 id="方法源码-1"><a href="#方法源码-1" class="headerlink" title="方法源码"></a>方法源码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">ordinal</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.ordinal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="valueOf-NaN"><a href="#valueOf-NaN" class="headerlink" title="valueOf()"></a>valueOf()</h4><p>返回指定字符串值的枚举常量。<br>如果没有该枚举常量则会报错 报错原因：No enum constant<br>相当于是返回该常量的下标<br><code>枚举类名.valueOf(&quot;枚举常量名&quot;);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">valueOf</span><span class="params">(Object var0)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> var0 == <span class="literal">null</span> ? <span class="string">&quot;null&quot;</span> : var0.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==注意==通过valueOf()返回的对象和枚举常量指向的同一个对象</p><h4 id="compareTo"><a href="#compareTo" class="headerlink" title="compareTo()"></a>compareTo()</h4><p>比较两个枚举常量的索引大小，也就是ordinal()返回的值的差</p><h5 id="方法源码-2"><a href="#方法源码-2" class="headerlink" title="方法源码"></a>方法源码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(E var1)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.getClass() != var1.getClass() &amp;&amp; <span class="built_in">this</span>.getDeclaringClass() != var1.getDeclaringClass()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.ordinal - var1.ordinal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最主要的一句就是<code>return this.ordinal - var1.ordinal;</code>可以证实比较的是ordinal值，并且不只是比较大小，返回的是之间的差</p><h4 id="eauals"><a href="#eauals" class="headerlink" title="eauals()"></a>eauals()</h4><p>比较两个常量对象是否是同一个</p><h5 id="方法源码-3"><a href="#方法源码-3" class="headerlink" title="方法源码"></a>方法源码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object var1)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span> == var1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Enum类方法总结"><a href="#Enum类方法总结" class="headerlink" title="Enum类方法总结"></a>Enum类方法总结</h3><p>Enum类常用方法：</p><ol><li>toString()</li><li>name()</li><li>ordinal()</li><li>values()</li><li>valueOf()</li><li>compareTo()</li><li>equals()</li></ol><h3 id="总体测试代码"><a href="#总体测试代码" class="headerlink" title="总体测试代码"></a>总体测试代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.enum_.Enum01;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumTest02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//使用values()</span></span><br><span class="line">        Weeks[] weeks = Weeks.values();<span class="comment">//获取所以枚举对象，即数组</span></span><br><span class="line">        <span class="keyword">for</span>(Weeks week : weeks)&#123;</span><br><span class="line">            <span class="comment">//使用toString()</span></span><br><span class="line">            System.out.println(week);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//使用ordinal()</span></span><br><span class="line">        <span class="type">Weeks</span> <span class="variable">weeks1</span> <span class="operator">=</span> Weeks.FRIDAY;</span><br><span class="line">        System.out.println(weeks1.ordinal());<span class="comment">//输出4</span></span><br><span class="line">        <span class="comment">//使用valueOf</span></span><br><span class="line">        System.out.println(Weeks.valueOf(<span class="string">&quot;TUESDAY&quot;</span>));<span class="comment">//输出 星期二</span></span><br><span class="line">        <span class="type">Weeks</span> <span class="variable">weeks2</span> <span class="operator">=</span> Weeks.WEDNESDAY;</span><br><span class="line">        <span class="type">Weeks</span> <span class="variable">weeks3</span> <span class="operator">=</span> Weeks.valueOf(<span class="string">&quot;WEDNESDAY&quot;</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> weeks2 == weeks3;</span><br><span class="line">        System.out.println(b);<span class="comment">//输出true，说明指向的同一个对象</span></span><br><span class="line">        <span class="comment">//使用equals()再判断一次</span></span><br><span class="line">        System.out.println(weeks2.equals(weeks3));<span class="comment">//返回true</span></span><br><span class="line">        <span class="comment">//使用compareTo()</span></span><br><span class="line">        System.out.println(Weeks.SATURDAY.compareTo(Weeks.MONDAY));<span class="comment">//输出5</span></span><br><span class="line">        <span class="comment">//使用name()</span></span><br><span class="line">        System.out.println(weeks3.name());<span class="comment">//输出WEDNESDAY,因为没有重写name()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Weeks</span> &#123;</span><br><span class="line">    MONDAY(<span class="string">&quot;星期一&quot;</span>),TUESDAY(<span class="string">&quot;星期二&quot;</span>),WEDNESDAY(<span class="string">&quot;星期三&quot;</span>),THURSDAY(<span class="string">&quot;星期四&quot;</span>),FRIDAY(<span class="string">&quot;星期五&quot;</span>),</span><br><span class="line">    SATURDAY(<span class="string">&quot;星期六&quot;</span>),SUNDAY(<span class="string">&quot;星期天&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    Weeks(String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//注解</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 枚举类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java GUI</title>
      <link href="/posts/2495386210.html"/>
      <url>/posts/2495386210.html</url>
      
        <content type="html"><![CDATA[<details>这部分是我阅读 《Head first Java》 的GUI部分笔记 <br/> 个人认为GUI其实没有必要再学了 <br/> 这部分学完，可以结合多线程等设计实现坦克大战，飞机大战等游戏了</details><h1 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h1><h2 id="java坐标系"><a href="#java坐标系" class="headerlink" title="java坐标系"></a>java坐标系</h2><p>左上角为坐标原点,以像素为单位.在java坐标系中,第一个是x坐标,表示当前位置的水平方向,距离坐标原点x个像素;第二个坐标是y坐标,表示当前位置为垂直方向,距离坐标原点y个像素<br><strong>原点为窗口的左上角,如果参数设置为负,图形可能无法完全显示出来</strong><br><strong>像素是一个密度单位,不是长度单位,两者无法比较</strong></p><h2 id="使用到的类"><a href="#使用到的类" class="headerlink" title="使用到的类"></a>使用到的类</h2><p>JFrame可以理解为一个窗口,一个画框/画板<br>JPanel可以理解为一支画板/画纸<br>Graphics g ,把 g 理解成一支画笔<br>总之,展示图形的类要继承JFrame</p><h2 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤:"></a>基本步骤:</h2><ol><li>需要先有一张画纸（继承JPanel），在画板上画图形</li><li>有了画板就要有一支画笔，就要重写JPanel的paint方法（调用父类构造器完成初始化）</li><li>让要展示图形的类继承JFrame，JFrame相当于一个画板/画框（画纸放在它上边）</li><li>在展示图形的类中先定义一张画纸，之后初始化这张画纸</li><li>初始化好画纸后将画纸放到会画板上，用从JFrame哪里继承来的add方法</li><li>设置窗口大小</li><li>最后在main中创建一个画图对象实例</li></ol><h2 id="绘图原理"><a href="#绘图原理" class="headerlink" title="绘图原理"></a>绘图原理</h2><ol><li>paint(Graphics g)绘制组件的外观</li><li>repaint()刷新组件的外观</li></ol><h3 id="何时调用paint"><a href="#何时调用paint" class="headerlink" title="何时调用paint()"></a>何时调用paint()</h3><ol><li>当组件第一次显示在屏幕上时会调用paint()</li><li>窗口最大化或最小化时调用paint()</li><li>拖动窗口,使得窗口大小发生变化时调用paint()</li><li>repaint()方法会被调用</li></ol><h2 id="简单演示"><a href="#简单演示" class="headerlink" title="简单演示"></a>简单演示</h2><h3 id="先画一个圆"><a href="#先画一个圆" class="headerlink" title="先画一个圆"></a><strong><u>先画一个圆</u></strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 展示如何在面板上画一个圆</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.javafx.logging.JFRInputEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 步骤：</span></span><br><span class="line"><span class="comment"> * 1.需要先有一张画纸（继承JPanel），在画板上画图形</span></span><br><span class="line"><span class="comment"> * 2.有了画板就要有一支画笔，就要重写JPanel的paint方法（调用父类构造器完成初始化）</span></span><br><span class="line"><span class="comment"> * 3.让要展示图形的类继承JFrame，JFrame相当于一个画板/画框（画纸放在它上边）</span></span><br><span class="line"><span class="comment"> * 4.在展示图形的类中先定义一张画纸，之后初始化这张画纸</span></span><br><span class="line"><span class="comment"> * 5.初始化好画纸后将画纸放到会画板上，用从JFrame哪里继承来的add方法</span></span><br><span class="line"><span class="comment"> * 6.设置窗口大小</span></span><br><span class="line"><span class="comment"> * 7.最后在main中创建一个画图对象实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawCircle</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> &#123;<span class="comment">//Frame的意思是框架</span></span><br><span class="line">    <span class="comment">//定义一张画纸</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">MyPanel</span> <span class="variable">mp</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawCircle</span>();<span class="comment">//创建实例</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//要展示团案的类的构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DrawCircle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化画纸</span></span><br><span class="line">        mp = <span class="keyword">new</span> <span class="title class_">MyPanel</span>();</span><br><span class="line">        <span class="comment">//把画纸放到画板上</span></span><br><span class="line">        <span class="built_in">this</span>.add(mp);</span><br><span class="line">        <span class="comment">//设置窗口大小</span></span><br><span class="line">        <span class="built_in">this</span>.setSize(<span class="number">800</span>,<span class="number">500</span>);</span><br><span class="line">        <span class="built_in">this</span>.setVisible(<span class="literal">true</span>);<span class="comment">//可以显示</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第一步，先弄一张画纸，方法是继承JPanel，JPanel会自动import javax.swing.*; 之后就直接在MyPanel上画</span></span><br><span class="line"><span class="comment">//第二步，弄一支画笔，重写paint方法，其中参数一定要，这个参数就是画笔，Graphics提供了很多画图方法</span></span><br><span class="line"><span class="comment">//第三步，让调用类继承一个JFrame，相当于一个画板</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics g)</span> &#123;<span class="comment">//绘图的方法</span></span><br><span class="line">        <span class="built_in">super</span>.paint(g);<span class="comment">//调用父类的方法，完成初始化  一定要有</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//画圆，使用Graphics的drawOval()方法</span></span><br><span class="line">        <span class="comment">//原型：public abstract void drawOval(int x,int y,int width,int height)</span></span><br><span class="line">        <span class="comment">// 绘制椭圆的边框。得到一个圆或椭圆，它刚好能放入由 x、y、width 和 height 参数指定的矩形中。</span></span><br><span class="line">        <span class="comment">//椭圆覆盖区域的宽度为 width + 1 像素，高度为 height + 1 像素。</span></span><br><span class="line">        <span class="comment">//参数：</span></span><br><span class="line">        <span class="comment">//x - 要绘制椭圆的左上角的 x 坐标。</span></span><br><span class="line">        <span class="comment">//y - 要绘制椭圆的左上角的 y 坐标。</span></span><br><span class="line">        <span class="comment">//width - 要绘制椭圆的宽度。</span></span><br><span class="line">        <span class="comment">//height - 要绘制椭圆的高度。</span></span><br><span class="line">        <span class="comment">//宽和高不相等就是椭圆，相等就是圆</span></span><br><span class="line">        g.drawOval(<span class="number">15</span>,<span class="number">15</span>,<span class="number">200</span>,<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="画其他图形"><a href="#画其他图形" class="headerlink" title="画其他图形"></a>画其他图形</h3><p>解释都在注释中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 演示绘制其他常用图形</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawOther</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">MyPanel2</span> <span class="variable">mp2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        input();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DrawOther</span> <span class="variable">drawOther</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DrawOther</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;+---选择要画的图形---+&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      1.直线&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      2.矩形&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      3.填充矩形&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      4.填充椭圆&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      5.画图片&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      6.画字符串&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;      0.退出&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;+------------------+&quot;</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">choice</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        drawOther.Draw_(choice);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Draw_</span><span class="params">(<span class="type">int</span> choice)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (choice) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                mp2 = <span class="keyword">new</span> <span class="title class_">MyPanel2</span>();<span class="comment">//直线</span></span><br><span class="line">                <span class="built_in">this</span>.add(mp2);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="type">MyPanel3</span> <span class="variable">mp3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel3</span>();<span class="comment">//画矩形(可以直接声明和初始化放到同一个语句执行)</span></span><br><span class="line">                <span class="built_in">this</span>.add(mp3);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="type">MyPanel4</span> <span class="variable">mp4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel4</span>();<span class="comment">//画填充矩形</span></span><br><span class="line">                <span class="built_in">this</span>.add(mp4);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="type">MyPanel5</span> <span class="variable">mp5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel5</span>();</span><br><span class="line">                <span class="built_in">this</span>.add(mp5);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="type">MyPanel6</span> <span class="variable">mp6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel6</span>();</span><br><span class="line">                <span class="built_in">this</span>.add(mp6);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                <span class="type">MyPanel7</span> <span class="variable">mp7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel7</span>();</span><br><span class="line">                <span class="built_in">this</span>.add(mp7);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;输入错误&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.setSize(<span class="number">800</span>, <span class="number">500</span>);</span><br><span class="line">        <span class="built_in">this</span>.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画直线(演示了用三条直线围成的三角形)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel2</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(g);</span><br><span class="line">        <span class="comment">//演示画直线 用 drawLine(int x1,int y1,int x2,int y2)表示从起点(x1,y1)到终点(x2,y2)的直线</span></span><br><span class="line">        g.drawLine(<span class="number">25</span>, <span class="number">25</span>, <span class="number">90</span>, <span class="number">85</span>);</span><br><span class="line">        g.drawLine(<span class="number">90</span>, <span class="number">85</span>, <span class="number">40</span>, <span class="number">92</span>);</span><br><span class="line">        g.drawLine(<span class="number">40</span>, <span class="number">92</span>, <span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画矩形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel3</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        <span class="comment">//演示画矩形 用 drawRect(int x1,int y1,int x2,int y2)画一个以第一个坐标(x1,y1)与第二个左边(x2,y2)连成直线为对角线的矩形</span></span><br><span class="line">        graphics.drawRect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">        graphics.drawRect(<span class="number">45</span>, <span class="number">45</span>, <span class="number">145</span>, <span class="number">155</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画填充矩形,要先设置填充颜色</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel4</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        <span class="comment">//先用setColor来设置画笔颜色，颜色为：Color.颜色的英文</span></span><br><span class="line">        graphics.setColor(Color.blue);<span class="comment">//例如设置为蓝色</span></span><br><span class="line">        <span class="comment">//再填充矩形，用 fillRect(int x1,int y1,int x2,int y2)参数和drawRect()含义一样</span></span><br><span class="line">        graphics.fillRect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="comment">//再画一个用黄色填充的矩形,可以看出来，新的图形相当于是叠加再</span></span><br><span class="line">        graphics.setColor(Color.yellow);</span><br><span class="line">        graphics.fillRect(<span class="number">50</span>, <span class="number">50</span>, <span class="number">130</span>, <span class="number">150</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画填充椭圆</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel5</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        <span class="comment">//先设置画笔颜色</span></span><br><span class="line">        graphics.setColor(Color.black);</span><br><span class="line">        <span class="comment">//再使用fillOval(),参数和drawOval()含义一样</span></span><br><span class="line">        graphics.fillOval(<span class="number">25</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">160</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画图片，这个比较复杂</span></span><br><span class="line"><span class="comment">//1.要获取图片资源</span></span><br><span class="line"><span class="comment">//2.将图片放到out.项目名下面(注意是项目名下面（这个文件是battle_city01）)</span></span><br><span class="line"><span class="comment">//3.在函数中获取图片资源用getResource(&quot;/wb.png&quot;)表示在项目根目录下找名字为wb.png的图片资源</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel6</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        <span class="comment">//得到图片,要用到Toolkit</span></span><br><span class="line">        <span class="type">Image</span> <span class="variable">image</span> <span class="operator">=</span> Toolkit.getDefaultToolkit().getImage(Panel.class.getResource(<span class="string">&quot;/wb.png&quot;</span>));</span><br><span class="line">        <span class="comment">//画图片，前两个参数为图片在左上角的位置(x1,y1)，后面两个数字为图片的长和宽，最好一样，最后一个参数为浏览位置，一般为this</span></span><br><span class="line">        graphics.drawImage(image,<span class="number">10</span>,<span class="number">10</span>,<span class="number">221</span>,<span class="number">234</span>,<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画字符串，实际上就是写字</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel7</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        <span class="comment">//要先设置字体和颜色</span></span><br><span class="line">        graphics.setColor(Color.black);<span class="comment">//设置字体颜色</span></span><br><span class="line">        graphics.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;行楷&quot;</span>, Font.BOLD ,<span class="number">50</span>));<span class="comment">//设置字体，注意，setFont要求传入一个Font类型的对象</span></span><br><span class="line">        <span class="comment">//画字符串,用函数drawString(String s,int x1,int y1),第一个参数为要写的字，后面两个参数是字符串左下角的坐标</span></span><br><span class="line">        graphics.drawString(<span class="string">&quot;冯雯&quot;</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">        graphics.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;隶书&quot;</span>,Font.BOLD,<span class="number">50</span>));<span class="comment">//第一个参数为字体，第二个参数为形式，第三个参数为字体大小</span></span><br><span class="line">        graphics.drawString(<span class="string">&quot;张永锐&quot;</span>,<span class="number">100</span>,<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关于颜色"><a href="#关于颜色" class="headerlink" title="关于颜色"></a>关于颜色</h2><h3 id="得到随机颜色的处理"><a href="#得到随机颜色的处理" class="headerlink" title="得到随机颜色的处理"></a>得到随机颜色的处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomColor_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        <span class="type">MyPanel1</span> <span class="variable">mp1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel1</span>();</span><br><span class="line">        frame.add(mp1);</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.setSize(<span class="number">800</span>,<span class="number">800</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel1</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这下面才是处理颜色的部分</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Color</span> <span class="variable">randomColor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);<span class="comment">//传入3个参数来代表RGB值</span></span><br><span class="line">        graphics.setColor(randomColor);</span><br><span class="line">        graphics.fillOval(<span class="number">70</span>,<span class="number">70</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        randomColor = <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);<span class="comment">//传入3个参数来代表RGB值</span></span><br><span class="line">        graphics.setColor(randomColor);</span><br><span class="line">        graphics.fillOval(<span class="number">70</span>,<span class="number">180</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        randomColor = <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);<span class="comment">//传入3个参数来代表RGB值</span></span><br><span class="line">        graphics.setColor(randomColor);</span><br><span class="line">        graphics.fillOval(<span class="number">170</span>,<span class="number">125</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="渐变颜色"><a href="#渐变颜色" class="headerlink" title="渐变颜色"></a>渐变颜色</h3><p>Gradient(意思是梯度，渐变)<br>使用类GradientPaint，表示渐变画嘛</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> (Graphics2D) graphics;</span><br><span class="line"><span class="type">GradientPaint</span> <span class="variable">gradient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradientPaint</span>(<span class="number">170</span>,<span class="number">125</span>,Color.blue,<span class="number">270</span>,<span class="number">225</span>,Color.orange);</span><br><span class="line">g2d.setPaint(gradient);</span><br><span class="line">graphics.fillOval(<span class="number">170</span>,<span class="number">125</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>与随机颜色结合（可执行程序）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomColor_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        <span class="type">MyPanel1</span> <span class="variable">mp1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel1</span>();</span><br><span class="line">        frame.add(mp1);</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.setSize(<span class="number">800</span>,<span class="number">800</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel1</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Color</span> <span class="variable">randomColor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);<span class="comment">//传入3个参数来代表RGB值</span></span><br><span class="line">        graphics.setColor(randomColor);</span><br><span class="line">        graphics.fillOval(<span class="number">70</span>,<span class="number">70</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        randomColor = <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);<span class="comment">//传入3个参数来代表RGB值</span></span><br><span class="line">        graphics.setColor(randomColor);</span><br><span class="line">        graphics.fillOval(<span class="number">70</span>,<span class="number">180</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这里是使用随机改变渐变颜色</span></span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> (Graphics2D) graphics;</span><br><span class="line">        <span class="type">GradientPaint</span> <span class="variable">gradient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradientPaint</span>(<span class="number">170</span>,<span class="number">125</span>,randomColor,<span class="number">270</span>,<span class="number">225</span>,Color.orange);</span><br><span class="line">        g2d.setPaint(gradient);</span><br><span class="line">        graphics.fillOval(<span class="number">170</span>,<span class="number">125</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="得到一个按钮"><a href="#得到一个按钮" class="headerlink" title="得到一个按钮"></a>得到一个按钮</h2><p>使用按钮类JButton,注意，这里不是继承JFrame了，JFrame可以直接被使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GUI_first</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();<span class="comment">//一个画板</span></span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;我是一个按钮，点击我&quot;</span>);<span class="comment">//一个按钮</span></span><br><span class="line"></span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);<span class="comment">//在窗口关闭时把程序结束掉</span></span><br><span class="line"></span><br><span class="line">        frame.getContentPane().add(button);<span class="comment">//把button加到frame的pane上</span></span><br><span class="line"></span><br><span class="line">        frame.setSize(<span class="number">300</span>,<span class="number">300</span>);<span class="comment">//设置画板大小</span></span><br><span class="line"></span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);<span class="comment">//把frame显示出来</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="取得对象的事件"><a href="#取得对象的事件" class="headerlink" title="取得对象的事件"></a>取得对象的事件</h3><p>设置好了按钮就要对应按钮来执行事件，按钮按下后整么反应<br>接下来看文件<a href="b-取得用户的事件.md">取得用户的事件</a></p><h1 id="不要再放在中间"><a href="#不要再放在中间" class="headerlink" title="不要再放在中间"></a>不要再放在中间</h1><p><code>frame.getContentPane().add(button);//把button加到</code><br>向上面直接使用add不给它更多的参数，会直接将画好的图形放在中间位置<br>其实add是可以有参数的<br>使用一个类BorderLayout(意思是边境布局（就表示布局嘛）)</p><h2 id="可选择的布局"><a href="#可选择的布局" class="headerlink" title="可选择的布局"></a>可选择的布局</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-06%20175638.png" alt=""><br>根据英文其实已经能够看的懂了，也不多，合理选择即可<br>如下程序规定了图形放置添加位置：</p><h2 id="规定位置的代码演示"><a href="#规定位置的代码演示" class="headerlink" title="规定位置的代码演示"></a>规定位置的代码演示</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GUI_third</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        <span class="type">MyPanel2</span> <span class="variable">myPanel2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel2</span>();</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">jButton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Button1&quot;</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Button2&quot;</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Button3&quot;</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Button4&quot;</span>);</span><br><span class="line">        frame.getContentPane().add(BorderLayout.CENTER,myPanel2);<span class="comment">//将面板放在中间</span></span><br><span class="line">        frame.getContentPane().add(BorderLayout.AFTER_LAST_LINE,jButton);<span class="comment">//放置一个按钮再下面</span></span><br><span class="line">        frame.getContentPane().add(BorderLayout.AFTER_LINE_ENDS,button2);<span class="comment">//放置一个按钮再右边</span></span><br><span class="line">        frame.getContentPane().add(BorderLayout.BEFORE_LINE_BEGINS,button3);<span class="comment">//放置一个按钮再左边</span></span><br><span class="line">        frame.getContentPane().add(BorderLayout.NORTH,button4);<span class="comment">//放置一个按钮再上边</span></span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.setSize(<span class="number">500</span>,<span class="number">500</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel2</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        graphics.fillOval(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="规定位置的代码演示的图形展示"><a href="#规定位置的代码演示的图形展示" class="headerlink" title="规定位置的代码演示的图形展示"></a>规定位置的代码演示的图形展示</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-06%20175205.png" alt=""><br>注意，面板是在中间，只是圆形不在面板的中间而已，不是说面板不在中间</p><h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><p>接下来结合事件处理，做到点一下按钮将圆形的填充颜色换一下取得用户的事件</p><p>使用java.awt.event包中的事件对象，如：MouseEvent、KeyEvent、WindowEvent、ActionEvent等<br>每个事件类型都要有个接听窗口，例如想要接收MouseEvent就要实现MouseListener这个接口</p><h2 id="取得按钮的ActionEvent"><a href="#取得按钮的ActionEvent" class="headerlink" title="取得按钮的ActionEvent"></a>取得按钮的ActionEvent</h2><ol><li>实现ActionEvent这个接口</li><li>像按钮注册（告诉按钮要监听的事件）</li><li>定义事件处理的方法（实现接口的方法）</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleGui1B</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;<span class="comment">//实现此接口，表示发生事件会通知SimpleGui1B这个类（实现了的类）</span></span><br><span class="line">    JButton button;<span class="comment">//声明一个按钮</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SimpleGui1B</span> <span class="variable">gui</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleGui1B</span>();</span><br><span class="line">        gui.go();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();<span class="comment">//创建并实例化一个画框</span></span><br><span class="line">        button = <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;click me&quot;</span>);<span class="comment">//实例化button</span></span><br><span class="line"></span><br><span class="line">        button.addActionListener(<span class="built_in">this</span>);<span class="comment">//向按钮注册</span></span><br><span class="line"></span><br><span class="line">        frame.getContentPane().add(button);<span class="comment">//向窗口中添加这个按钮</span></span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.setSize(<span class="number">300</span>,<span class="number">300</span>);定义窗口大小</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);<span class="comment">//设置可视</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现接口中的方法，这个方法才是真正处理事件的方法</span></span><br><span class="line">    <span class="comment">//按钮以ActionEvent对象作为参数来调用此方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent event)</span>&#123;</span><br><span class="line">        button.setText(<span class="string">&quot;I&#x27;ve been clicked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结合事件处理转换填充颜色"><a href="#结合事件处理转换填充颜色" class="headerlink" title="结合事件处理转换填充颜色"></a>结合事件处理转换填充颜色</h2><p>编写一个程序，有按钮和一个面板，面板随机产生不同颜色的填充圆，通过点击按钮可以切换圆的颜色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GUI_fourth</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">    JFrame frame;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GUI_fourth</span>().go();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">()</span>&#123;</span><br><span class="line">        frame = <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Change Color&quot;</span>);</span><br><span class="line">        button1.addActionListener(<span class="built_in">this</span>);<span class="comment">//为button1注册一个监听器</span></span><br><span class="line"></span><br><span class="line">        <span class="type">MyPanel3</span> <span class="variable">myPanel3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel3</span>();</span><br><span class="line">        frame.getContentPane().add(BorderLayout.CENTER,myPanel3);</span><br><span class="line">        frame.getContentPane().add(BorderLayout.SOUTH,button1);</span><br><span class="line"></span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.setSize(<span class="number">500</span>,<span class="number">500</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent event)</span>&#123;</span><br><span class="line">        frame.repaint();<span class="comment">//当用户按下按钮时就会要求重画（调用paint()）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel3</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">Color</span> <span class="variable">color1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);</span><br><span class="line"></span><br><span class="line">        red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">Color</span> <span class="variable">color2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red,green,blue);</span><br><span class="line"></span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> (Graphics2D) graphics;</span><br><span class="line"></span><br><span class="line">        <span class="type">GradientPaint</span> <span class="variable">gradientPaint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradientPaint</span>(<span class="number">190</span>, <span class="number">180</span>, color1, <span class="number">300</span>, <span class="number">300</span>, color2);</span><br><span class="line">        g2d.setPaint(gradientPaint);</span><br><span class="line"></span><br><span class="line">        g2d.fillOval(<span class="number">190</span>,<span class="number">180</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现两个按钮分别处理事件"><a href="#实现两个按钮分别处理事件" class="headerlink" title="实现两个按钮分别处理事件"></a>实现两个按钮分别处理事件</h2><p><strong>通过内部类实现最好</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GUI_fifth</span> &#123;<span class="comment">//这下不用主类来实现ActionListener接口了</span></span><br><span class="line">    <span class="comment">//在外部定义，让实现ActionListener的实现类（这里就是内部类）能够用到</span></span><br><span class="line">    JFrame frame;</span><br><span class="line">    JLabel label;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GUI_fifth</span>().go();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">()</span>&#123;</span><br><span class="line">        frame = <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line"></span><br><span class="line">        <span class="type">JButton</span> <span class="variable">label_button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Change Label&quot;</span>);<span class="comment">//声明一个管理label的按钮</span></span><br><span class="line">        <span class="comment">//原本使用this，相当于传入主类作为参数，只能使用主类的一个监听器，现在使用内部类传入实例作为，可以将不同的实例传入</span></span><br><span class="line">        label_button.addActionListener(<span class="keyword">new</span> <span class="title class_">LabelListener</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">JButton</span> <span class="variable">color_button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Change Color&quot;</span>);<span class="comment">//声明一个管理color的按钮</span></span><br><span class="line">        color_button.addActionListener(<span class="keyword">new</span> <span class="title class_">ColorListener</span>());</span><br><span class="line"></span><br><span class="line">        label = <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;I&#x27;m a label&quot;</span>);</span><br><span class="line">        <span class="type">MyPanel4</span> <span class="variable">myPanel4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel4</span>();</span><br><span class="line"></span><br><span class="line">        frame.getContentPane().add(BorderLayout.WEST,label);</span><br><span class="line">        frame.getContentPane().add(BorderLayout.CENTER,myPanel4);</span><br><span class="line">        frame.getContentPane().add(BorderLayout.SOUTH,color_button);</span><br><span class="line">        frame.getContentPane().add(BorderLayout.EAST,label_button);</span><br><span class="line"></span><br><span class="line">        frame.setSize(<span class="number">500</span>,<span class="number">500</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//使用内部类分别单独实现ActionListener</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">LabelListener</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent event)</span> &#123;</span><br><span class="line">            label.setText(<span class="string">&quot;Changed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ColorListener</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent event)</span>&#123;</span><br><span class="line">            frame.repaint();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel4</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics g)</span>&#123;</span><br><span class="line">        g.setColor(Color.cyan);</span><br><span class="line">        g.fill3DRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">500</span>,<span class="literal">false</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">Color</span> <span class="variable">stare_color</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red, green, blue);</span><br><span class="line">        red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">Color</span> <span class="variable">end_color</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red, green, blue);</span><br><span class="line"></span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> (Graphics2D) g;</span><br><span class="line"></span><br><span class="line">        <span class="type">GradientPaint</span> <span class="variable">gradient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradientPaint</span>(<span class="number">110</span>,<span class="number">180</span>,stare_color,<span class="number">210</span>,<span class="number">180</span>,end_color);</span><br><span class="line">        g2d.setPaint(gradient);</span><br><span class="line"></span><br><span class="line">        g2d.fillOval(<span class="number">110</span>,<span class="number">180</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="让图形动起来"><a href="#让图形动起来" class="headerlink" title="让图形动起来"></a>让图形动起来</h2><h3 id="通过点击按钮使得图形按固定方向移动"><a href="#通过点击按钮使得图形按固定方向移动" class="headerlink" title="通过点击按钮使得图形按固定方向移动"></a>通过点击按钮使得图形按固定方向移动</h3><p>通过改变x和y（起始坐标）来每次重新画图，但是要注意抹去原本的痕迹<br>改变了x和y的值之后再直接调用继承了JPanel的类的方法:repaint()<br>下面的程序不仅实现了运动，还实现了事件处理（点一下按钮，动一下）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GUI_sixth</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">70</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">70</span>;</span><br><span class="line">    <span class="type">MyDrawPanel</span> <span class="variable">drawPanel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyDrawPanel</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">GUI_sixth</span>().go();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line"></span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Make the Circle Move&quot;</span>);</span><br><span class="line">        button.addActionListener(<span class="keyword">new</span> <span class="title class_">Color_Button</span>());</span><br><span class="line"></span><br><span class="line">        frame.getContentPane().add(BorderLayout.CENTER,drawPanel);</span><br><span class="line">        frame.getContentPane().add(BorderLayout.SOUTH,button);</span><br><span class="line"></span><br><span class="line">        frame.setSize(<span class="number">500</span>,<span class="number">500</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Color_Button</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent actionEvent)</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">3</span>;i++) &#123;</span><br><span class="line">                x++;</span><br><span class="line">                y++;</span><br><span class="line"></span><br><span class="line">                drawPanel.repaint();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">25</span>);<span class="comment">//使用线程的函数</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">MyDrawPanel</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paintComponent</span><span class="params">(Graphics g)</span>&#123;</span><br><span class="line">            g.setColor(Color.white);</span><br><span class="line">            g.fill3DRect(<span class="number">0</span>,<span class="number">0</span>,<span class="built_in">this</span>.getWidth(),<span class="built_in">this</span>.getHeight(),<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">            <span class="type">Color</span> <span class="variable">stare_color</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red, green, blue);</span><br><span class="line">            red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">            green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">            blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">            <span class="type">Color</span> <span class="variable">end_color</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red, green, blue);</span><br><span class="line"></span><br><span class="line">            <span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> (Graphics2D) g;</span><br><span class="line"></span><br><span class="line">            <span class="type">GradientPaint</span> <span class="variable">gradient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradientPaint</span>(<span class="number">110</span>,<span class="number">180</span>,stare_color,<span class="number">210</span>,<span class="number">180</span>,end_color);</span><br><span class="line">            g2d.setPaint(gradient);</span><br><span class="line"></span><br><span class="line">            g2d.fillOval(x,y,<span class="number">50</span>,<span class="number">50</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通过键盘控制移动"><a href="#通过键盘控制移动" class="headerlink" title="通过键盘控制移动"></a>通过键盘控制移动</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GUI_seventh</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        <span class="type">MyPanel</span> <span class="variable">myPanel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyPanel</span>();</span><br><span class="line">        frame.getContentPane().add(BorderLayout.CENTER,myPanel);</span><br><span class="line">        frame.addKeyListener(myPanel);</span><br><span class="line">        frame.setSize(<span class="number">500</span>,<span class="number">500</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPanel</span> <span class="keyword">extends</span> <span class="title class_">JPanel</span> <span class="keyword">implements</span> <span class="title class_">KeyListener</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        <span class="type">int</span> <span class="variable">red</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">green</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">blue</span> <span class="operator">=</span> (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">Color</span> <span class="variable">startColor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red, green, blue);<span class="comment">//传入3个参数来代表RGB值</span></span><br><span class="line">        red = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        green = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        blue = (<span class="type">int</span>) (Math.random() * <span class="number">255</span>);</span><br><span class="line">        <span class="type">Color</span> <span class="variable">endColor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Color</span>(red, green, blue);</span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2d</span> <span class="operator">=</span> (Graphics2D) graphics;</span><br><span class="line">        <span class="type">GradientPaint</span> <span class="variable">gradient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GradientPaint</span>(<span class="number">0</span>,<span class="number">0</span>,startColor,<span class="number">500</span>,<span class="number">500</span>,endColor);</span><br><span class="line">        g2d.setPaint(gradient);</span><br><span class="line">        graphics.fillOval(x, y, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyTyped</span><span class="params">(KeyEvent keyEvent)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyPressed</span><span class="params">(KeyEvent keyEvent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (keyEvent.getKeyCode() == KeyEvent.VK_UP) &#123;</span><br><span class="line">            y-=<span class="number">3</span>;</span><br><span class="line">            <span class="built_in">this</span>.repaint();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyEvent.getKeyCode() == KeyEvent.VK_DOWN) &#123;</span><br><span class="line">            y+=<span class="number">3</span>;</span><br><span class="line">            <span class="built_in">this</span>.repaint();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyEvent.getKeyCode() == KeyEvent.VK_RIGHT) &#123;</span><br><span class="line">            x+=<span class="number">3</span>;</span><br><span class="line">            <span class="built_in">this</span>.repaint();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyEvent.getKeyCode() == KeyEvent.VK_LEFT) &#123;</span><br><span class="line">            x-=<span class="number">3</span>;</span><br><span class="line">            <span class="built_in">this</span>.repaint();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">keyReleased</span><span class="params">(KeyEvent keyEvent)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> GUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络编程</title>
      <link href="/posts/4131986683.html"/>
      <url>/posts/4131986683.html</url>
      
        <content type="html"><![CDATA[<details>此博客是我看 B站 韩顺平 老师 的课程做的笔记</details><h1 id="InetAddress类-获取IP地址"><a href="#InetAddress类-获取IP地址" class="headerlink" title="InetAddress类(获取IP地址)"></a>InetAddress类(获取IP地址)</h1><h2 id="使用代码"><a href="#使用代码" class="headerlink" title="使用代码"></a>使用代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">API_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        <span class="comment">//获取本机的InetAddress对象</span></span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">localHost</span> <span class="operator">=</span> InetAddress.getLocalHost();</span><br><span class="line">        System.out.println(<span class="string">&quot;localHost = &quot;</span> + localHost);<span class="comment">//Zhangyr/192.168.57.1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据指定主机名 获取 InetAddress 对象</span></span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">host1</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;Zhangyr&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;host1 = &quot;</span> + host1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据域名返回 InetAddress 对象，比www.baidu.com</span></span><br><span class="line">       <span class="type">InetAddress</span> <span class="variable">host2</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;www.baidu.com&quot;</span>);<span class="comment">//!不联网就要报错</span></span><br><span class="line">       System.out.println(<span class="string">&quot;host2 = &quot;</span> + host2);<span class="comment">//host2 = www.baidu.com/14.215.177.38</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过 InetAddress 对象，获取对应的地址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">hostAddress</span> <span class="operator">=</span> host1.getHostAddress();</span><br><span class="line">        System.out.println(<span class="string">&quot;host1 对应的IP = &quot;</span> + hostAddress);<span class="comment">//host1 对应的IP = 192.168.57.1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//通过 InetAddress 对象，获取对应的主机名/域名</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">hostName</span> <span class="operator">=</span> host2.getHostName();</span><br><span class="line">       System.out.println(<span class="string">&quot;host2 对应的主机名/域名 = &quot;</span> + hostName);<span class="comment">//host2 对应的主机名/域名 = www.baidu.com</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Socket类-实现网络编程"><a href="#Socket类-实现网络编程" class="headerlink" title="Socket类(实现网络编程)"></a>Socket类(实现网络编程)</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><ol><li>套接字（Sock）开发网络引用程序被广泛采用，以至于称为事实上的标准</li><li>通信的两端都要右Socket，是两台机器间通信的端口</li><li>网络通信其实就是Socket间通信</li><li>Socket允许程序把网络连接当成一个流，数据在两个Socket间通过IO传输</li><li>一般主动发起通信的应用程序属客户端，等待通信请求的为服务端</li></ol><p>通讯时读写数据：<br>socket.getOutputStream()<br>socket.getInputStream()</p><h2 id="TCP编程和UDP编程"><a href="#TCP编程和UDP编程" class="headerlink" title="TCP编程和UDP编程"></a>TCP编程和UDP编程</h2><p>网络编程一般有TCP编程（稳定，可靠，速度慢）和UDP编程（不稳定、不可靠、速度快）两种</p><h3 id="TCP网络通信编程"><a href="#TCP网络通信编程" class="headerlink" title="TCP网络通信编程"></a>TCP网络通信编程</h3><ol><li>基于客户端——服务端的网络通信</li><li>底层使用的是TCP/IP协议</li><li>应用场景举例：客户端发送数据，服务端接收并显示</li></ol><p><strong>一定要关闭socket，否者后面可能会导致连接不上</strong></p><h4 id="TCP字节流编程"><a href="#TCP字节流编程" class="headerlink" title="TCP字节流编程"></a>TCP字节流编程</h4><h5 id="ServerSocket类："><a href="#ServerSocket类：" class="headerlink" title="ServerSocket类："></a>ServerSocket类：</h5><p>此类实现服务器套接字。服务器套接字等待请求通过网络传入。它基于该请求执行某些操作，然后可能向请求者返回结果。<br>服务器套接字的实际工作由 SocketImpl 类的实例执行。应用程序可以更改创建套接字实现的套接字工厂来配置它自身，从而创建适合本地防火墙的套接字。<br>ServerSocket与Socket的不同，ServerSocket的每一个accept()都可连接到一个方法，可以连接很多Socket也是<strong>多并发的一个体现</strong></p><h5 id="Socket类："><a href="#Socket类：" class="headerlink" title="Socket类："></a>Socket类：</h5><p>此类实现客户端套接字（也可以就叫“套接字”）。套接字是两台机器间通信的端点。<br>套接字的实际工作由 SocketImpl 类的实例执行。应用程序通过更改创建套接字实现的套接字工厂可以配置它自身，以创建适合本地防火墙的套接字。<br>编程练习1</p><ol><li>编写一个服务器端和一个客户端</li><li>服务器端在 9999 端口监听</li><li>客户端连接到服务器端，发送“hello,server”,然后退出</li><li>服务器端接收到 客户端发送的消息，输出，并退出</li></ol><h6 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h6><p>肯定要有两个程序</p><p><strong>服务端程序</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * todo 服务端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketTCP01Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// todo 在本机的9999端口监听，等待连接</span></span><br><span class="line">        <span class="comment">//? ServerSocket(int port) 创建绑定到特定端口的服务器套接字。</span></span><br><span class="line">        <span class="comment">//! 要求本机没有其他程序或者服务在监听9999</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端9999正在等待连接...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 没有客户端连接程序时，程序会堵塞，等待连接</span></span><br><span class="line">        <span class="comment">//? 如果有客户端连接，则会返回 Socket 对象，程序继续</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端成功连接&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 读取客户端数据</span></span><br><span class="line">        <span class="comment">//? 得到一个于socket相关的输入流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">iis</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="comment">//? 读入数据</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">data_read</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span>((data_read = iis.read(buf)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buf,<span class="number">0</span>,data_read));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 关闭流和socket</span></span><br><span class="line">        iis.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端退出...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>客户端程序</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * todo 客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketTCP01Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// todo 连接服务器</span></span><br><span class="line">        <span class="comment">//? Socket(InetAddress address, int port) 创建一个流套接字并将其连接到指定 IP 地址的指定端口号。</span></span><br><span class="line">        <span class="comment">//? 连接 9999 端口 如果连接成功 返回一个Socket对象</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getLocalHost(),<span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端 socket 返回 = &quot;</span> + socket.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 发送Hello,Server 到服务端</span></span><br><span class="line">        <span class="comment">//? 得到一个和socket想关联的输出流，一定时要和socket相关联的输出流</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">sos</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="comment">//? 通过得到的输出流 ，将要写的话写到数据通道</span></span><br><span class="line">        sos.write(<span class="string">&quot;Hello,server&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 关闭流对象和socket，必须关闭！！！</span></span><br><span class="line">        sos.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h6><p>因为是在同一台电脑上操作,所以客户端的IP地址是InetAddress.getLocalHost()也就是本地地址,如果要与别的电脑连接,就传入”xxx.xxx.xxx.xxx”</p><h5 id="编程练习2"><a href="#编程练习2" class="headerlink" title="编程练习2"></a>编程练习2</h5><p>用字节流</p><ol><li>编写一个服务端和一个客户端</li><li>服务端在9999端口监听</li><li>客户端连接到服务器端,发送”Hello,Server”,并接收服务器端回发的”Hello,Client”,再退出</li><li>服务器端接收到客户端发送的信息,输出,再发送”Hello,Client”,再退出</li></ol><p><strong>这道题的重点是发送完消息和接收完消息后都应该要有一个结束标记,即socket.shutdownOutput();socket.shutdownInput()</strong><br><strong>注意: 流要最后一起关闭,不是用完就关闭,否则会造成线程问题</strong></p><h6 id="代码展示-1"><a href="#代码展示-1" class="headerlink" title="代码展示"></a>代码展示</h6><p><strong>服务端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketTCP02Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端等待连接&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端已连接&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 接收数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">int</span> <span class="variable">read_length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span>((read_length = inputStream.read(buf)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buf,<span class="number">0</span>,read_length));</span><br><span class="line">        &#125;</span><br><span class="line">        socket.shutdownInput();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 获取socket相关联的OutputStream()</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        outputStream.write(<span class="string">&quot;Hello,Client&quot;</span>.getBytes());</span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//!最后一起把流关掉</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">        outputStream.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端退出&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>客户端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketTCP02Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 发送消息</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        outputStream.write(<span class="string">&quot;Hello,Server&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 接收消息</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">int</span> <span class="variable">read_length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span>((read_length = inputStream.read(buf)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(buf,<span class="number">0</span>,read_length));</span><br><span class="line">        &#125;</span><br><span class="line">        socket.shutdownInput();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//!最后一起把流关掉</span></span><br><span class="line">        outputStream.close();</span><br><span class="line">        inputStream.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="编程练习3"><a href="#编程练习3" class="headerlink" title="编程练习3"></a>编程练习3</h5><p><strong>实际上就是第二个题,但是要求用字符流</strong></p><ol><li>编写一个服务端和一个客户端</li><li>服务端在9999端口监听</li><li>客户端连接到服务端,发送”Hello,Server”,并接收服务端回发的”Hello,Client”,再退出</li><li>服务端接收接收到客户端发送的信息,输出,再发送”Hello,Client”,再退出</li></ol><p><strong>需要使用转换流,即OutputStream-&gt;Writer;InputStream-&gt;Reader。并且，可以使用Writer.newLine()来作为结束标记,但是,需要使用readLine()来读取[这就相当于是一种协议了]</strong></p><h6 id="代码展示-2"><a href="#代码展示-2" class="headerlink" title="代码展示"></a>代码展示</h6><p><strong>服务端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketTCP03Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// todo 连接</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 接收数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">InputStreamReader</span> <span class="variable">inputStreamReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream);</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(inputStreamReader);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 输出数据</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="type">OutputStreamWriter</span> <span class="variable">outputStreamWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(outputStream);</span><br><span class="line">        <span class="type">BufferedWriter</span> <span class="variable">bufferedWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(outputStreamWriter);</span><br><span class="line">        bufferedWriter.write(<span class="string">&quot;Hello,Client&quot;</span>);</span><br><span class="line">        bufferedWriter.newLine();</span><br><span class="line">        bufferedWriter.flush();<span class="comment">//!一定要刷新，否则读不进去</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//!关流</span></span><br><span class="line">        bufferedWriter.close();</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>客户端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketTCP03Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 输出数据</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="type">OutputStreamWriter</span> <span class="variable">outputStreamWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(outputStream);</span><br><span class="line">        <span class="type">BufferedWriter</span> <span class="variable">bufferedWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(outputStreamWriter);</span><br><span class="line">        bufferedWriter.write(<span class="string">&quot;Hello,Server&quot;</span>);</span><br><span class="line">        bufferedWriter.newLine();</span><br><span class="line">        bufferedWriter.flush();<span class="comment">//!一定要刷新，否则读不进去</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 接收数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">InputStreamReader</span> <span class="variable">inputStreamReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream);</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(inputStreamReader);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//!关流</span></span><br><span class="line">        bufferedWriter.close();</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="TCP文件编程"><a href="#TCP文件编程" class="headerlink" title="TCP文件编程"></a>TCP文件编程</h4><h5 id="编程练习1"><a href="#编程练习1" class="headerlink" title="编程练习1"></a>编程练习1</h5><ol><li>编写一个服务端和一个客户端</li><li>服务端在9999端口监听</li><li>客户端连接到服务端,发送一张图片,之后退出</li><li>服务器端接收到客户端发送的图片,保存到e盘下</li><li>该程序需要使用<code>StreamUtils.java;</code>、 <code>BufferedInputStream</code>和<code>BufferedOutputStream</code></li></ol><h6 id="代码展示-3"><a href="#代码展示-3" class="headerlink" title="代码展示"></a>代码展示</h6><p><strong>服务端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPFileUploadServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// todo 服务端再本地监听9999</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端在9999端口监听...&quot;</span>);</span><br><span class="line">        <span class="comment">// todo 等待连接</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;等待连接...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 读取客户端发送的数据</span></span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(socket.getInputStream());</span><br><span class="line">        <span class="comment">// todo 读取bis,拿到一个字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = StreamUtils.streamToByteArray(bis);</span><br><span class="line">        <span class="comment">// todo 得到 bytes 数组,存入文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;src\\鹅国小酒馆3.mp4&quot;</span>;</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filePath));</span><br><span class="line">        bos.write(bytes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//!关闭流</span></span><br><span class="line">        bos.close();</span><br><span class="line">        bis.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>客户端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPFileUploadClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// todo 客户端连接服务端</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line">        <span class="comment">// todo 创建读取文件的的输入流</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;e:\\鹅国小酒馆.mp4&quot;</span>;</span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath));</span><br><span class="line">        <span class="comment">// todo 把文件读到字节数组中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = StreamUtils.streamToByteArray(bis);<span class="comment">//bytes就是filePath对应的字节数组</span></span><br><span class="line">        <span class="comment">// todo 通过socket获取输出流,将bytes数据发给服务端</span></span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        bos.write(bytes);<span class="comment">//将文件对应的字节数组发送出去</span></span><br><span class="line">        bis.close();</span><br><span class="line">        socket.shutdownOutput();<span class="comment">//结束标记</span></span><br><span class="line"></span><br><span class="line">        bos.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="编程练习2-1"><a href="#编程练习2-1" class="headerlink" title="编程练习2"></a>编程练习2</h5><p><u>是编程练习1的进阶</u></p><ol><li>编写一个服务端和一个客户端</li><li>服务端在9999端口监听</li><li>客户端连接到服务端,发送一张图片</li><li>服务器端接收到客户端发送的图片,保存到e盘,发送”收到图片”再退出</li><li>客户端接收到服务器端发送的”收到图片”后再退出</li><li>该程序需要使用<code>StreamUtils.java;</code>、 <code>BufferedInputStream</code>和<code>BufferedOutputStream</code></li></ol><h6 id="代码展示-4"><a href="#代码展示-4" class="headerlink" title="代码展示"></a>代码展示</h6><p><strong>服务端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPFileUploadServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// todo 服务端再本地监听9999</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端在9999端口监听...&quot;</span>);</span><br><span class="line">        <span class="comment">// todo 等待连接</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;等待连接...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 读取客户端发送的数据</span></span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(socket.getInputStream());</span><br><span class="line">        <span class="comment">// todo 读取bis,拿到一个字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = StreamUtils.streamToByteArray(bis);</span><br><span class="line">        <span class="comment">// todo 得到 bytes 数组,存入文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;e:\\鹅国小酒馆3.mp4&quot;</span>;</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filePath));</span><br><span class="line">        bos.write(bytes);</span><br><span class="line">        bos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 向客户端回复&quot;收到文件&quot;</span></span><br><span class="line">        <span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(socket.getOutputStream()));</span><br><span class="line">        bw.write(<span class="string">&quot;收到图片&quot;</span>);</span><br><span class="line">        bw.flush();<span class="comment">//!刷新换行符</span></span><br><span class="line">        socket.shutdownOutput();<span class="comment">//结束标记</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//!关闭流</span></span><br><span class="line">        bw.close();</span><br><span class="line">        bis.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>客户端代码</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPFileUploadClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// todo 客户端连接服务端</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line">        <span class="comment">// todo 创建读取文件的的输入流</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;e:\\鹅国小酒馆.mp4&quot;</span>;</span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath));</span><br><span class="line">        <span class="comment">// todo 把文件读到字节数组中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = StreamUtils.streamToByteArray(bis);<span class="comment">//bytes就是filePath对应的字节数组</span></span><br><span class="line">        <span class="comment">// todo 通过socket获取输出流,将bytes数据发给服务端</span></span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        bos.write(bytes);<span class="comment">//将文件对应的字节数组发送出去</span></span><br><span class="line">        bis.close();</span><br><span class="line">        socket.shutdownOutput();<span class="comment">//结束标记</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo 接收服务端消息</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> StreamUtils.streamToString(inputStream);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//!关闭流</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">        bos.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="netstat指令"><a href="#netstat指令" class="headerlink" title="netstat指令"></a>netstat指令</h4><ol><li>netstat -an可以查看当前主机网络情况,包括<strong>端口监听情况</strong>和<strong>网络连接情况</strong></li><li>netstat -an|more 可以分页显示</li><li>netstat -anb|more 可以分页显示并且可以显示使用的程序</li><li>要求在dos控制台下执行</li></ol><p>其中本地地址冒号后面的数字代表端口(一般都是服务端),外部地址一般是客户端的IP地址(127.0.0.1还是表示本地地址),状态表示是否是在监听<br>运行服务端程序。</p><h5 id="TCP连接秘密"><a href="#TCP连接秘密" class="headerlink" title="TCP连接秘密"></a>TCP连接秘密</h5><p>当连接上后,客户端也会有一个端口(这个端口是随机的),假设使用客户端与服务端连接后,上图中能找到一个外部地址与本地地址为0.0.0.0:9999连接的地址,后面的冒号代表地址,并且状态为ESTABLISHED</p><h3 id="UDP网络编程"><a href="#UDP网络编程" class="headerlink" title="UDP网络编程"></a>UDP网络编程</h3><h4 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h4><ol><li>类<code>DatagramSocket</code> 和 <code>DatagramPacket</code>[数据包/数据报] 实现了基于UDP协议网络程序</li><li>UDP数据报通过数据报套接字 DatagramSocket发送和接收,系统不保证UDP数据报一定能够安全送到目的地,也不能确定什么时候可以送达</li><li>DatagramPacket对象封装了UDP数据报,在数据报中包含了发送端口的IP地址和的端口号以及接收端口的IP地址和端口号</li><li>UDP协议中每个数据报都给出了完整的地址信息,因此无需建立发送方和接收方的连接</li></ol><h4 id="编程练习"><a href="#编程练习" class="headerlink" title="编程练习"></a>编程练习</h4><ol><li>编写一个接收端A,和一个发送端B</li><li>接收端A在9999端口等待接收数据</li><li>发送端B向接收端A发送数据,发送”Hello,明天吃火锅”</li><li>接收端A接收到发送端B的数据后,回复”好的,明天见”,退出</li><li>发送端B接收到数据后再退出</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 网络编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDBC</title>
      <link href="/posts/2414116852.html"/>
      <url>/posts/2414116852.html</url>
      
        <content type="html"><![CDATA[<details>此笔记是 B站 动力结点 老杜 老师的课程笔记</details><blockquote><p>可能您学了MySQL数据库之后有疑问了，我操作数据库都是在命令行里，终端里控制的数据库，那我怎么讲数据库应用到网站上呢。这里就讲解释，数据库可以用Java程序控制，即JDBC，当然数据库也可以由python（模块包pymysql）等控制。这些编程语言本身就可以做游戏和网站，在登录或执行其他操作时就会调用数据库。</p></blockquote><h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><p><strong>Java DataBase Connectivity</strong>(Java语言连接数据库)</p><p>本质是:由SUN公司制定的 一套 接口(interface)(属于面向接口编程)<br>    <code>java.sql.*;</code></p><h2 id="可以在api参考文档中看的内容"><a href="#可以在api参考文档中看的内容" class="headerlink" title="可以在api参考文档中看的内容"></a>可以在api参考文档中看的内容</h2><p>Java.sql包</p><div class="table-container"><table><thead><tr><th>接口</th><th>用途</th></tr></thead><tbody><tr><td>Connection接口</td><td>获取连接 getConnection()</td></tr><tr><td>Driver接口</td><td>获取连接DriverManager()</td></tr><tr><td>ResultSet接口</td><td>执行DQL语句（select）</td></tr><tr><td>Statement接口</td><td>获取数据库操作对象 createStatement()</td></tr></tbody></table></div><h2 id="JDBC的六个步骤-背下来"><a href="#JDBC的六个步骤-背下来" class="headerlink" title="JDBC的六个步骤(背下来)"></a>JDBC的六个步骤(背下来)</h2><ul><li><p>注册驱动<br>  （作用：告诉Java程序，即将连接的是哪个品牌的数据库）</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Driver;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法一</span></span><br><span class="line"><span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mysql.jdbc.Driver;  <span class="comment">//多态，父类型引用指向子类型对象</span></span><br><span class="line">DriverManager.registerDriver(driver);</span><br><span class="line"><span class="comment">// 记得try catch受检异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方法二（类加载时会调用，使用反射机制）（常用）</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);  <span class="comment">//固定写法，加载驱动，反射机制</span></span><br></pre></td></tr></table></figure></li><li><p>建立连接<br>  （表示JVM的进程和数据库进程之间的通道打开了，属于进程间通信，使用完一定要关闭）</p><pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 写在try catch内</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// url：统一资源定位符（网络中某个资源的绝对路径）</span></span><br><span class="line"><span class="comment">// jdbc:mysql://表示协议，通信协议是通信之前就提前定好的数据传送格式</span></span><br><span class="line"><span class="comment">// localhost或者127.0.0.1表示IP地址</span></span><br><span class="line"><span class="comment">// 3306表示MySQL端口号</span></span><br><span class="line"><span class="comment">// useUnicode=true(支持中文编码)</span></span><br><span class="line"><span class="comment">// characterEncoding=utf8（设置中文字符集utf8）</span></span><br><span class="line"><span class="comment">// useSSL=true（使用安全的连接）</span></span><br><span class="line"><span class="comment">//jbdc:mysql:// 协议</span></span><br><span class="line"><span class="comment">//127.0.0.1   IP地址</span></span><br><span class="line"><span class="comment">//3306        端口</span></span><br><span class="line"><span class="comment">//具体数据库实例名</span></span><br><span class="line">String url=<span class="string">&quot;jdbc:mysql://localhost:3306/数据库名?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&quot;</span>;</span><br><span class="line">String user=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">String password=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,user,password);  <span class="comment">// 数据库连接对象</span></span><br></pre></td></tr></table></figure></code></pre></li><li><p>获得数据库操作对象<br>  （专门执行sql语句的对象）</p><pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="comment">// 写在try catch内</span></span><br><span class="line"><span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br></pre></td></tr></table></figure></code></pre></li><li><p>执行SQL语句<br>  statement.execteUpdate()执行DML语句（insert、delete、update）<br>  statement.excuteQuery()执行DQL语句（select）<br>  （主要执行DQL和DML等）</p><pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写在try catch内</span></span><br><span class="line">    </span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT TNTO 表名(字段名1,字段名2) VALUES(值1,值2)&quot;</span>;</span><br><span class="line"><span class="comment">// 专门执行DML语句的（INSERT、DELETE、UPDATE）</span></span><br><span class="line"><span class="comment">// 返回值count是影响数据库中的记录条数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> statement.executeUpdate(sql);</span><br></pre></td></tr></table></figure></code></pre></li><li><p>处理查询集<br>  （只有当第4步执行的是SELECT语句时，才有这第5步）<br>  select才是查询结果<br>  看<a href="#处理查询结果集">查询结果集</a></p></li><li><p>释放资源<br>  （使用完资源后一定要关闭，Java和数据库属于进程间通信，一定要关闭）</p><pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为了保证资源一定释放，在try...catch的finally中关闭资源，并且   遵循从小到大依次关闭。</span></span><br><span class="line"><span class="keyword">if</span>(statement!=<span class="literal">null</span>)&#123;</span><br><span class="line">  statement.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(connection!=<span class="literal">null</span>)&#123;</span><br><span class="line">connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul><h3 id="整体代码"><a href="#整体代码" class="headerlink" title="整体代码"></a>整体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*JDBC编程六步*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        Statement stmt=<span class="literal">null</span>;</span><br><span class="line">        Connection conn=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.注册驱动</span></span><br><span class="line">            DriverManager.registerDriver(<span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver());</span><br><span class="line">            <span class="comment">//2.获取连接</span></span><br><span class="line">            <span class="comment">/*url:统一资源定位符（网络中某个资源的绝对路径）</span></span><br><span class="line"><span class="comment">            URL包含哪几部分：协议、IP、PORT、资源名</span></span><br><span class="line"><span class="comment">            http://是通信协议   什么是协议？有什么用？</span></span><br><span class="line"><span class="comment">            通信协议是通信之前就提前定好的数据传送格式，数据包具体怎么传数据，提前定好了格式</span></span><br><span class="line"><span class="comment">            182.61.200.7是服务器IP地址</span></span><br><span class="line"><span class="comment">            80 是服务器上软件的端口</span></span><br><span class="line"><span class="comment">            index.html是服务器上某个资源名</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/MySql?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span><span class="string">&quot;root&quot;</span>;</span><br><span class="line">            String password=<span class="string">&quot;111111&quot;</span>;</span><br><span class="line">            conn=DriverManager.getConnection(url,user,password);</span><br><span class="line">            System.out.println(<span class="string">&quot;数据库连接的对象 =&quot;</span> +conn);</span><br><span class="line">            <span class="comment">//3.获取数据库操作对象(statement专门执行sql语句的)</span></span><br><span class="line">            stmt= conn.createStatement();</span><br><span class="line">            <span class="comment">//4.执行sql</span></span><br><span class="line">            String sql=<span class="string">&quot;insert into dept(deptno,dname,loc) values(50,&#x27;人事部&#x27;,&#x27;北京&#x27;)&quot;</span>;</span><br><span class="line">            <span class="comment">//专门执行DML语句（insert、delete、update）</span></span><br><span class="line">            <span class="comment">//返回值是‘影响数据库中的记录条数’</span></span><br><span class="line">            <span class="type">int</span> count=stmt.executeUpdate(sql);</span><br><span class="line">            System.out.println(count==<span class="number">1</span>?<span class="string">&quot;保存成功&quot;</span>:<span class="string">&quot;保存失败&quot;</span>);<span class="comment">//insert保存一条语句</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.处理查询结果集</span></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.释放资源(为了保证资源一定释放，在finally语句块中关闭资源)</span></span><br><span class="line">            <span class="comment">//并且要遵循从小到大依次关闭</span></span><br><span class="line">            <span class="comment">//分别对其try...catch</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (stmt!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    stmt.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (conn!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="将连接数据库的所有信息配置到配置文件中"><a href="#将连接数据库的所有信息配置到配置文件中" class="headerlink" title="将连接数据库的所有信息配置到配置文件中"></a>将连接数据库的所有信息配置到配置文件中</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 实际开发中不建议把连接数据库的信息写死到Java程序中。</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest4</span> &#123;</span><br><span class="line">    <span class="comment">//将连接数据库的所有信息配置到配置文件中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException&#123;</span><br><span class="line">        <span class="comment">//使用资源绑定器绑定属性配置文件</span></span><br><span class="line">        ResourceBundle bundle=ResourceBundle.getBundle(<span class="string">&quot;jdbc&quot;</span>);</span><br><span class="line">        String driver=bundle.getString(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        String url=bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        String user=bundle.getString(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        String password=bundle.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        Connection conn=<span class="literal">null</span>;</span><br><span class="line">        Statement stmt=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.注册驱动</span></span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            <span class="comment">//2.获取连接</span></span><br><span class="line">            conn=DriverManager.getConnection(url,user,password);</span><br><span class="line">            <span class="comment">//3.获取数据库操作对象</span></span><br><span class="line">            stmt=conn.createStatement();</span><br><span class="line">            <span class="comment">//4.执行SQL语句</span></span><br><span class="line">            String sql=<span class="string">&quot;delete from dept where deptno=40&quot;</span>;</span><br><span class="line">            <span class="type">int</span> count=stmt.executeUpdate(sql);</span><br><span class="line">            System.out.println(count==<span class="number">1</span> ?<span class="string">&quot;删除成功&quot;</span>:<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (SQLException | ClassNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (stmt!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stmt.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (conn!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="处理查询结果集"><a href="#处理查询结果集" class="headerlink" title="处理查询结果集"></a>处理查询结果集</h2><p>使用ResultSet的next()方法<br>如果该位置有数据就返回true，所以用while循环</p><p>取数据用getString()方法<br>注意，不论数据库中的数据类型是什么最好都以String的形式取出<br>但是可以用其他的类型double就用getDouble()….(需要取出结果计算的情况下)不过还是要和数据库中的类型一致</p><p>JDBC中所有下标都是从1开始。不是从0开始</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTest5</span> &#123;</span><br><span class="line">    <span class="comment">//处理查询结果集</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Connection conn=<span class="literal">null</span>;</span><br><span class="line">        Statement stmt=<span class="literal">null</span>;</span><br><span class="line">        ResultSet rs=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.注册驱动</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">            <span class="comment">//2.获取连接</span></span><br><span class="line">            conn=DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/MySql?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT&quot;</span></span><br><span class="line">                    ,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;111111&quot;</span>);</span><br><span class="line">            <span class="comment">//3.获取数据库操作对象</span></span><br><span class="line">            stmt=conn.createStatement();</span><br><span class="line">            <span class="comment">//4.执行sql</span></span><br><span class="line">            String sql=<span class="string">&quot;select empno,ename,sal from emp&quot;</span>;</span><br><span class="line">            <span class="comment">//int excuteUpdate(insert/delete/update)</span></span><br><span class="line">            <span class="comment">//ResultSet excuteQuery(select)</span></span><br><span class="line">            rs=stmt.executeQuery(sql);<span class="comment">//专门执行DQL语句的方法</span></span><br><span class="line">            <span class="comment">//5.处理查询结果集</span></span><br><span class="line">           <span class="comment">/* boolean flag1=rs.next();</span></span><br><span class="line"><span class="comment">//            System.out.println(flag1);  true</span></span><br><span class="line"><span class="comment">            if (flag1)&#123;</span></span><br><span class="line"><span class="comment">                //光标指向的行有数据</span></span><br><span class="line"><span class="comment">                //取数据</span></span><br><span class="line"><span class="comment">                //getString（）方法的特点是：不管数据库中的数据是什么类型的，都按string形式取出</span></span><br><span class="line"><span class="comment">                //1,2,3 说的是第几列</span></span><br><span class="line"><span class="comment">                String empno=rs.getString(1);//JDBC所有下标从1开始</span></span><br><span class="line"><span class="comment">                String ename=rs.getString(2);</span></span><br><span class="line"><span class="comment">                String sal=rs.getString(3);</span></span><br><span class="line"><span class="comment">                System.out.println(empno+&quot;,&quot;+ename+&quot;,&quot;+sal);</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">           <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">              <span class="comment">/* String empno=rs.getString(1);//JDBC所有下标从1开始</span></span><br><span class="line"><span class="comment">               String ename=rs.getString(2);</span></span><br><span class="line"><span class="comment">               String sal=rs.getString(3);</span></span><br><span class="line"><span class="comment">               System.out.println(empno+&quot;,&quot;+ename+&quot;,&quot;+sal);*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">              <span class="comment">//这个不是以列的下标获取，以列的名字获取，（健壮性）</span></span><br><span class="line">               <span class="comment">//除了可以以String类型取出之外，还可以以特定了类型取出</span></span><br><span class="line">               <span class="comment">//int  getInt...</span></span><br><span class="line">               String empno=rs.getString(<span class="string">&quot;empno&quot;</span>);</span><br><span class="line">               String ename=rs.getString(<span class="string">&quot;ename&quot;</span>); <span class="comment">//假如有 AS a  则以a查询，因为是rs是结果集，根据查询时是否重名来填入</span></span><br><span class="line">               String sal=rs.getString(<span class="string">&quot;sal&quot;</span>);</span><br><span class="line">               System.out.println(empno+<span class="string">&quot;,&quot;</span>+ename+<span class="string">&quot;,&quot;</span>+sal);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (rs!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (stmt!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stmt.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (conn!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="模拟用户登录，发现SQL注入现象"><a href="#模拟用户登录，发现SQL注入现象" class="headerlink" title="模拟用户登录，发现SQL注入现象"></a>模拟用户登录，发现SQL注入现象</h2><h3 id="导致SQL注入的根本原因："><a href="#导致SQL注入的根本原因：" class="headerlink" title="导致SQL注入的根本原因："></a>导致SQL注入的根本原因：</h3><p>用户输入的信息中含有sql语句的关键字，并且这些关<br>导致sql语句的原意被扭曲，进而达到sql注入<br>可能还会说删除等操作，会严重破坏数据库</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 模拟用户登录功能的实现</span></span><br><span class="line"><span class="comment"> * 业务描述：</span></span><br><span class="line"><span class="comment"> * 1.程序运行时，提供一个输入的入口，可以让用户输入用户名和密码</span></span><br><span class="line"><span class="comment"> * 2.用户输入后提交信息，Java程序收集到用户信息</span></span><br><span class="line"><span class="comment"> * 3.Java程序连接数据库验证用户名和密码是否合法</span></span><br><span class="line"><span class="comment"> * 4.演示结果</span></span><br><span class="line"><span class="comment"> * 数据准备;</span></span><br><span class="line"><span class="comment"> *      设计表，PowerDesigner</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * !程序问题：</span></span><br><span class="line"><span class="comment"> * 如此输入：</span></span><br><span class="line"><span class="comment"> * 用户名：ddd(表中没有)</span></span><br><span class="line"><span class="comment"> * ?密码：nuanqibazao&#x27; or&#x27;1&#x27;=&#x27;1     --&gt;    or &#x27;1&#x27; = &#x27;1&#x27;是恒成立的，所以会登录成功,导致注入的主要原因</span></span><br><span class="line"><span class="comment"> * 登录成功</span></span><br><span class="line"><span class="comment"> * SQL注入(安全隐患，要修改)（黑客常用）</span></span><br><span class="line"><span class="comment"> * !SQL注入的根本原因：</span></span><br><span class="line"><span class="comment"> * 用户输入的信息中含有SQL语句的关键字，并且这些关键字参与了sql语句中的编译过程，导致sql语句的原意被扭曲</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test07_login_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//初始化一个界面</span></span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo = initUI();</span><br><span class="line">        <span class="comment">//验证用户名和密码</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">loginSuccess</span>  <span class="operator">=</span> login(userLoginInfo);</span><br><span class="line">        <span class="comment">//显示结果</span></span><br><span class="line">        System.out.println(loginSuccess? <span class="string">&quot;登录成功&quot;</span> : <span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化一个用户姐界面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回用户输入的用户名和密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; <span class="title function_">initUI</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;用户名：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> s.nextLine();</span><br><span class="line">        System.out.print(<span class="string">&quot;密码：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loginPwd</span> <span class="operator">=</span> s.nextLine();</span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;loginName&quot;</span>,loginName);</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;loginPwd&quot;</span>,loginPwd);</span><br><span class="line">        <span class="keyword">return</span> userLoginInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录判断</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLoginInfo 用户登录信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(Map&lt;String,String&gt; userLoginInfo)</span>&#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">is_longin</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//JDBC代码</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">passwd</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url,user,passwd);</span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_user where loginName = &#x27;&quot;</span> + userLoginInfo.get(<span class="string">&quot;loginName&quot;</span>)</span><br><span class="line">                    + <span class="string">&quot;&#x27; and loginPwd = &#x27;&quot;</span> + userLoginInfo.get(<span class="string">&quot;loginPwd&quot;</span>) + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            rs = stmt.executeQuery(sql);</span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                is_longin  =<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(SQLException | ClassNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(stmt != <span class="literal">null</span>)&#123;</span><br><span class="line">                    stmt.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> is_longin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Statement和PreparedStatement对比"><a href="#Statement和PreparedStatement对比" class="headerlink" title="Statement和PreparedStatement对比"></a>Statement和PreparedStatement对比</h2><p>-Statement存在SQL注入问题；PreparedStatement解决了SQL注入问题<br>-Statement是编译一次执行一次；PreparedStatement是编译一次可执行N次；PreparedStatement执行效率较高一些<br>-PreparedStatement会在编译阶段做类型的安全检查</p><p>综上所述：PreparedStatement使用较多，极少数情况下使用Statement</p><p>什么情况下必须使用Statement？<br>    业务方面要求必须支持SQL注入时。（PreparedStatement无法支持SQL注入）<br>    Statement支持SQL注入，凡是业务方面需要进行sql语句拼接时，必须使用Statement<br>    只需要给sql语句传值时使用：PreparedStatement </p><h2 id="解决SQL注入问题"><a href="#解决SQL注入问题" class="headerlink" title="解决SQL注入问题"></a>解决SQL注入问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 再Test07的基础上解决SQL注入问题</span></span><br><span class="line"><span class="comment"> * 使用PreparedStatement类 --》99%都用这个类，因为可以提前编译（效率高），避免SQL租入现象</span></span><br><span class="line"><span class="comment"> * 1%是如果本身业务就需要SQL注入的情况，比如就是想升序或者降序查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test08_solve_SQL_in</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//初始化一个界面</span></span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo = initUI();</span><br><span class="line">        <span class="comment">//验证用户名和密码</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">loginSuccess</span>  <span class="operator">=</span> login(userLoginInfo);</span><br><span class="line">        <span class="comment">//显示结果</span></span><br><span class="line">        System.out.println(loginSuccess? <span class="string">&quot;登录成功&quot;</span> : <span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化一个用户姐界面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回用户输入的用户名和密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; <span class="title function_">initUI</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;用户名：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loginName</span> <span class="operator">=</span> s.nextLine();</span><br><span class="line">        System.out.print(<span class="string">&quot;密码：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">loginPwd</span> <span class="operator">=</span> s.nextLine();</span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;loginName&quot;</span>,loginName);</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;loginPwd&quot;</span>,loginPwd);</span><br><span class="line">        <span class="keyword">return</span> userLoginInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录判断</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLoginInfo 用户登录信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(Map&lt;String,String&gt; userLoginInfo)</span>&#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">is_longin</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//JDBC代码</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Statement stmt = null;</span></span><br><span class="line">        <span class="comment">//!使用PreparedStatement  (原本是Statement)</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">passwd</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url,user,passwd);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//!第三步的时候就要传入sql语句，预先编译，就是要留问号（占位符），之后会替换，很智能</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_user where loginName = ? and loginPwd = ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//!在JDBC中一切的下标都是从1开始</span></span><br><span class="line">            <span class="comment">//ps.setInt(下标（第几个问号）,值);可以灵活设置</span></span><br><span class="line">            <span class="comment">//!很智能的是，如果是setInt等值，在编译的sql语句中就不会加引号，如果是字符串类型就会加引号(把整体引起来，就不会执行注入语句了)</span></span><br><span class="line">            ps.setString(<span class="number">1</span>,userLoginInfo.get(<span class="string">&quot;loginName&quot;</span>));<span class="comment">//!修改占位符的值</span></span><br><span class="line">            ps.setString(<span class="number">2</span>,userLoginInfo.get(<span class="string">&quot;loginPwd&quot;</span>));</span><br><span class="line"></span><br><span class="line">            rs = ps.executeQuery();<span class="comment">//!因为前面已经传入了sql预处理语句，所以不需要参数了</span></span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                is_longin  =<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(SQLException | ClassNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(rs != <span class="literal">null</span>)&#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(ps != <span class="literal">null</span>)&#123;</span><br><span class="line">                    ps.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> is_longin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Statement-用处"><a href="#Statement-用处" class="headerlink" title="Statement 用处"></a>Statement 用处</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test09_desc_and_asc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//todo 用户输入选择</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;输入1升序，输入2降序&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">keyWord</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        keyWord = s.nextLine();</span><br><span class="line">        <span class="keyword">if</span>(Objects.equals(keyWord, <span class="string">&quot;1&quot;</span>))&#123;</span><br><span class="line">            keyWord = <span class="string">&quot;asc&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(Objects.equals(keyWord, <span class="string">&quot;2&quot;</span>))&#123;</span><br><span class="line">            keyWord = <span class="string">&quot;desc&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//todo jdbc</span></span><br><span class="line">        <span class="comment">//!在这里使用PreparedStatement不能实现功能</span></span><br><span class="line"><span class="comment">//        Connection conn = null;</span></span><br><span class="line"><span class="comment">//        PreparedStatement ps = null;</span></span><br><span class="line"><span class="comment">//        ResultSet rs = null;</span></span><br><span class="line"><span class="comment">//        try&#123;</span></span><br><span class="line"><span class="comment">//            Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span></span><br><span class="line"><span class="comment">//            conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&quot;,&quot;root&quot;,&quot;123456&quot;);</span></span><br><span class="line"><span class="comment">//            String sql = &quot;select name,english from student order by ?&quot;;</span></span><br><span class="line"><span class="comment">//            ps = conn.prepareStatement(sql);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            ps.setString(1,keyWord);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            rs = ps.executeQuery();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            while(rs.next())&#123;</span></span><br><span class="line"><span class="comment">//                System.out.println(rs.getString(&quot;name&quot;) + &quot; &quot; + rs.getString(&quot;english&quot;));</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125; catch(ClassNotFoundException | SQLException e)&#123;</span></span><br><span class="line"><span class="comment">//            e.printStackTrace();</span></span><br><span class="line"><span class="comment">//        &#125; finally &#123;</span></span><br><span class="line"><span class="comment">//            try&#123;</span></span><br><span class="line"><span class="comment">//                if(rs != null)&#123;</span></span><br><span class="line"><span class="comment">//                    rs.close();</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//                if(ps != null)&#123;</span></span><br><span class="line"><span class="comment">//                    ps.close();</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//                if(conn != null)&#123;</span></span><br><span class="line"><span class="comment">//                    conn.close();</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125; catch (SQLException e) &#123;</span></span><br><span class="line"><span class="comment">//                e.printStackTrace();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">            stmt = conn.createStatement();</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select name,english from student order by english &quot;</span> + keyWord;</span><br><span class="line"></span><br><span class="line">            rs = stmt.executeQuery(sql);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">                System.out.println(rs.getString(<span class="string">&quot;name&quot;</span>) + <span class="string">&quot; &quot;</span> + rs.getString(<span class="string">&quot;english&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException | SQLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(rs != <span class="literal">null</span>)&#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(stmt != <span class="literal">null</span>)&#123;</span><br><span class="line">                    stmt.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用PreparedStatement完成增删改"><a href="#使用PreparedStatement完成增删改" class="headerlink" title="使用PreparedStatement完成增删改"></a>使用PreparedStatement完成增删改</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test10_c_d_u</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.</span></span><br><span class="line">            conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.</span></span><br><span class="line"><span class="comment">//            增：</span></span><br><span class="line"><span class="comment">//            String sql_i = &quot;insert into t_vip2 values (?,?)&quot;;</span></span><br><span class="line"><span class="comment">//            ps = conn.prepareStatement(sql_i);</span></span><br><span class="line"><span class="comment">//            删：</span></span><br><span class="line"><span class="comment">//            String sql_d = &quot;delete from t_vip2 where id = ?&quot;;</span></span><br><span class="line"><span class="comment">//            ps = conn.prepareStatement(sql_d);</span></span><br><span class="line"><span class="comment">//            改：</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql_u</span> <span class="operator">=</span> <span class="string">&quot;update t_vip2 set name = ? where id = ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql_u);</span><br><span class="line">            <span class="comment">//4.</span></span><br><span class="line"><span class="comment">//            增：</span></span><br><span class="line"><span class="comment">//            ps.setInt(1,3);</span></span><br><span class="line"><span class="comment">//            ps.setString(2,&quot;smith&quot;);</span></span><br><span class="line"><span class="comment">//            删：</span></span><br><span class="line"><span class="comment">//            ps.setInt(1,3);</span></span><br><span class="line"><span class="comment">//            改：</span></span><br><span class="line">            ps.setString(<span class="number">1</span>,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">            ps.setInt(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">            ps.executeUpdate();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.</span></span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(ps != <span class="literal">null</span>)&#123;</span><br><span class="line">                    ps.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JDBC工具类的封装"><a href="#JDBC工具类的封装" class="headerlink" title="JDBC工具类的封装"></a>JDBC工具类的封装</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 自己写一个封装方法，将JDBC的功能封装成函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.使用静态代码块直接加载第一步注册驱动</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.获取数据库连接(传入3个参数)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">(String url,String user,String passwd)</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn =  DriverManager.getConnection(url, user, passwd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.无参类型,默认调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">passwd</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">            conn =  DriverManager.getConnection(url, user, passwd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.释放资源 3个</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Connection conn, Statement stmt, ResultSet rs)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(rs != <span class="literal">null</span>)&#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(stmt != <span class="literal">null</span>)&#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//没有使用结果查询集,只释放两个资源</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">(Connection conn, Statement stmt)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(stmt != <span class="literal">null</span>)&#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="事务机制"><a href="#事务机制" class="headerlink" title="事务机制"></a>事务机制</h2><h3 id="主要代码"><a href="#主要代码" class="headerlink" title="主要代码"></a>主要代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conn.setAutoCommit(<span class="literal">false</span>);<span class="comment">//关闭自动提交机制(打开事务提交机制)</span></span><br><span class="line">conn.commit();<span class="comment">//事务提交</span></span><br><span class="line">conn.rollback();<span class="comment">//事务回滚</span></span><br></pre></td></tr></table></figure><p>注意是连接对象的操作函数</p><h3 id="整体代码-1"><a href="#整体代码-1" class="headerlink" title="整体代码"></a>整体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 用事务机制完成银行转账</span></span><br><span class="line"><span class="comment"> * 任务：</span></span><br><span class="line"><span class="comment"> *      1.实现银行转账机制（账户111将钱转给222，转10000.0）</span></span><br><span class="line"><span class="comment"> *      2.使用自制的DBUtils工具类</span></span><br><span class="line"><span class="comment"> * 实现：</span></span><br><span class="line"><span class="comment"> *      1.先查询两个账户的价格</span></span><br><span class="line"><span class="comment"> *      2.将111中的钱（10000.0）转给222</span></span><br><span class="line"><span class="comment"> *          1.111中的钱少10000.0</span></span><br><span class="line"><span class="comment"> *          2.222中的钱增加10000.0</span></span><br><span class="line"><span class="comment"> *      3.再次查询结果</span></span><br><span class="line"><span class="comment"> *? 本代码的重点  conn.setAutoCommit(false);//关闭自动提交，相当于开启事务</span></span><br><span class="line"><span class="comment"> *?             conn.commit();//事务提交</span></span><br><span class="line"><span class="comment"> *?             conn.rollback();//事务回滚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test12_transaction</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DBUtils.getConnection();<span class="comment">//1,2</span></span><br><span class="line">        ResultSet rs;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_act where actno = ? or actno = ?&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">        <span class="comment">//todo 给ps赋值</span></span><br><span class="line">        ps.setInt(<span class="number">1</span>,<span class="number">111</span>);</span><br><span class="line">        ps.setInt(<span class="number">2</span>,<span class="number">222</span>);</span><br><span class="line">        rs = ps.executeQuery();</span><br><span class="line">        <span class="comment">//todo 处理查询结果集</span></span><br><span class="line">        System.out.println(<span class="string">&quot;操作前查询结果：&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;actno: &quot;</span> + rs.getString(<span class="string">&quot;actno&quot;</span>) +<span class="string">&quot; balance: &quot;</span> + rs.getString(<span class="string">&quot;balance&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//todo 转账操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql2</span> <span class="operator">=</span> <span class="string">&quot;update t_act set balance = balance + ? where actno = ? and balance &gt;= ?&quot;</span>;</span><br><span class="line">        ps = conn.prepareStatement(sql2);</span><br><span class="line">        <span class="comment">//!关闭JDBC的自动提交 ， 相当于开启事务(start transaction;)</span></span><br><span class="line">        conn.setAutoCommit(<span class="literal">false</span>);<span class="comment">//*关闭自动提交</span></span><br><span class="line">        <span class="comment">//todo 让111的钱减少</span></span><br><span class="line">        <span class="comment">//todo 给ps赋值</span></span><br><span class="line">        ps.setDouble(<span class="number">1</span>,-<span class="number">10000.0</span>);<span class="comment">//?减少就是加负的那么多嘛</span></span><br><span class="line">        ps.setInt(<span class="number">2</span>,<span class="number">111</span>);<span class="comment">//?操作的是111的账户</span></span><br><span class="line">        ps.setDouble(<span class="number">3</span>,<span class="number">10000.0</span>);<span class="comment">//?转账的用户的钱必须要大于转周的钱</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ps.executeUpdate();</span><br><span class="line">        <span class="comment">//todo 让222的钱增加</span></span><br><span class="line">        <span class="comment">//todo 再次给ps赋值</span></span><br><span class="line">        ps.setDouble(<span class="number">1</span>,<span class="number">10000.0</span>);</span><br><span class="line">        ps.setInt(<span class="number">2</span>,<span class="number">222</span>);</span><br><span class="line">        ps.setDouble(<span class="number">3</span>,-<span class="number">10000000.0</span>);<span class="comment">//?收钱的账户不对钱有要求</span></span><br><span class="line">        count += ps.executeUpdate();</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">2</span>)&#123;</span><br><span class="line">            conn.commit();<span class="comment">//!事务提交的方法</span></span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            conn.rollback();<span class="comment">//!事务回滚的方法</span></span><br><span class="line">            System.out.println(<span class="string">&quot;转账失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//todo 再次查询结果集</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql3</span> <span class="operator">=</span> <span class="string">&quot;select * from t_act where actno = ? or actno = ?&quot;</span>;</span><br><span class="line">        ps = conn.prepareStatement(sql3);</span><br><span class="line">        ps.setInt(<span class="number">1</span>,<span class="number">111</span>);</span><br><span class="line">        ps.setInt(<span class="number">2</span>,<span class="number">222</span>);</span><br><span class="line">        rs = ps.executeQuery();</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;actno: &quot;</span> + rs.getString(<span class="string">&quot;actno&quot;</span>) +<span class="string">&quot; balance: &quot;</span> + rs.getString(<span class="string">&quot;balance&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//todo 释放资源</span></span><br><span class="line">        DBUtils.close(conn,ps,rs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@aim</span> 实现模糊查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test13_like</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DBUtils.getConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from student where name like ?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>,<span class="string">&quot;z%&quot;</span>);<span class="comment">//查询以z开头的名字</span></span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                System.out.println(rs.getString(<span class="string">&quot;id&quot;</span>) + <span class="string">&quot; &quot;</span>  +rs.getString(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                        + <span class="string">&quot; &quot;</span> + rs.getString(<span class="string">&quot;chinese&quot;</span>) + <span class="string">&quot; &quot;</span> + rs.getString(<span class="string">&quot;english&quot;</span>)</span><br><span class="line">                        + <span class="string">&quot; &quot;</span> + rs.getString(<span class="string">&quot;math&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DBUtils.close(conn,ps,rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="悲观锁与乐观锁"><a href="#悲观锁与乐观锁" class="headerlink" title="悲观锁与乐观锁"></a>悲观锁与乐观锁</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">行级锁（又叫悲观锁）：</span><br><span class="line"><span class="keyword">select</span> ename,job,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> ename <span class="operator">|</span> job     <span class="operator">|</span> sal     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> JONES <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">3272.50</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BLAKE <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">3135.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CLARK <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">2695.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> ename,job,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line">在<span class="keyword">select</span>语句后加 <span class="keyword">for</span> <span class="keyword">update</span> 就是行级锁</span><br><span class="line">代表在当前事务结束之前，其他事务都无法修改这一行数据</span><br><span class="line">上面<span class="keyword">select</span>语句表示：那三行数据(其实是对应emp表中的三行数据)都无法修改</span><br><span class="line"></span><br><span class="line">乐观锁：</span><br><span class="line">多线程并发 都可以对这行数据修改</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 数据库 </category>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Java后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL基础</title>
      <link href="/posts/3169224211.html"/>
      <url>/posts/3169224211.html</url>
      
        <content type="html"><![CDATA[<details>B站 动力节点 老杜 老师 的课堂笔记<br/>狂赞老杜老师</details><blockquote><p>此笔记虽说是MySQL基础，但是学完基本可以用到工作。咱又不是专门搞数据库工作的～</p></blockquote><h1 id="DQL-查询"><a href="#DQL-查询" class="headerlink" title="DQL(查询)"></a>DQL(查询)</h1><h2 id="select的简单语法"><a href="#select的简单语法" class="headerlink" title="select的简单语法"></a>select的简单语法</h2><p>show databases;—&gt;显示已有数据库(注意后面的s)<br>create database test;—&gt;建立一个数据库,名叫test(注意没有s)<br>use test;—&gt;使用test数据库<br>source 链接;—&gt;导入数据(表等)<br>表是数据库最基本的单位(行 为字段)<br>desc test;—&gt;查看字段描述(describe)<br>理解相对路径和绝对路径,在MySql中尤其是绝对路径和其他的有很大区别<br/></p><h3 id="单表查询-DQL-数据查询语言"><a href="#单表查询-DQL-数据查询语言" class="headerlink" title="单表查询(DQL(数据查询语言))"></a>单表查询(DQL(数据查询语言))</h3><p>select … from … where … group by … having … order by …;<br><br/><b>在MySQL中一定要以分号结尾</b><br/><br>执行顺序：<br></p><ol>    <li>from(表单来源)</li>    <li>where(判断筛选)</li>    <li>group by(分组)</li>    <li>having(用于分组函数情况下的判断筛选)</li>    <li>order by(排序)</li></ol><h3 id="语法细节"><a href="#语法细节" class="headerlink" title="语法细节"></a>语法细节</h3><p>select * from student;—&gt;用来查询student表单中的所有字段对应的数据<br/><br>select math from student;—&gt;用来查询student表单中的math字段对应的数据<br/><br>select math,name from student;—&gt;用来查询student表单中的math字段和name对应的数据(多个字段用逗号隔开)<br/><br>select math as m from student;—&gt;用来查询student表单中的math字段对应的数据并且将math字段改名为m,因为这里时select(查询)所以不会修改数据库<br/><br>select math m from student;—&gt;上一句的简写<br/><br>select math from student where math &gt; 60;—&gt;判断语句,math字段对应数据大于60(即满足要求)才能显示出来<br/><br>判断语句:</p><ul>    <li>&lt;</li>    <li>&gt;</li>    <li>&gt;=</li>    <li>&lt;=</li>    <li>=</li>    <li>!=</li>    <li>&lt;&gt;(和!=效果一样)</li>    <li>and(和编程语言的&&一个效果)</li>    <li>or(和编程语言的||一个效果)</li>    <li>in(包含,其实也算是一个函数,其参数不是表示范围,而是具体的值)</li>    <li>between ... and...(between后面的数字需要比and后面的数字小,表示的能显示的数据的范围)</li>    <li>is null(为null才满足条件)</li>    <li>not(not可以取非,主要用在is和in中)</li>    <li>like(模糊查询,%代表多个字符,_代表单个字符)</li></ul><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p>select math from student order by math;—&gt;默认为升序排序<br/><br>select math from student order by math desc;—&gt;降序排序<br/><br>select math from student order by math asc;—&gt;升序排序<br/></p><h3 id="单行处理函数"><a href="#单行处理函数" class="headerlink" title="单行处理函数"></a>单行处理函数</h3><p>select lower(name) from student;—&gt;将name中的字母全部转换为小写字母<br/><br>select upper(name) from student;—&gt;将name中的字母全部转换为大写字母<br/><br>select substr(name,1,1) from student;—&gt;截取子字符串,第二个参数表示起始位置<b>在MySql中是从1开始的,不是从0开始</b>第三个参数是子字符串长度<br/><br>select concat(str1,str2) from student;—&gt;将str1,str2拼接成一个字符串<br/><br>select length(name) from student;—&gt;得到长度<br/><br>select name from student where name = trim(“    张飞”);—&gt;trim将空格去掉<br/><br>select round(123.1) from student;—&gt;可以字节显示字面量(直接就是值可以是数字也可以是字符串,行数和表的行数相同),这里的round()函数是四舍五入函数<br/><br>select round(123.45,1) form student;—&gt;默认第二个参数为0,为1表示保留一位小数…如果是-1的话结果就是:120<br/><br>select rand() from student;—&gt;只是借助字面量输出,输出的是0-1的随机数<br/></p><h3 id="分组处理函数"><a href="#分组处理函数" class="headerlink" title="分组处理函数"></a>分组处理函数</h3><p>select sum(math) from student;—&gt;显示student表中math字段对应数据的总和<br>select count(math) from student;—&gt;显示student表中math字段对应的不位null的数据的个数<br>select count(<em>) from student;—&gt;</em>表示所有字段显示student表中的行数,因为不可能有一行全部字段都为空,注意和上一行有个区分<br/><br>select max(math) from student;—&gt;显示student表中math字段对应数据中的最大值<br>select main(math) from student;—&gt;显示student表中math字段对应数据中的最小值<br>select avg(math) from student;—&gt;显示student表中math字段对应数据中的平均值<br>select math,avg(math) from student group by math;—&gt;按math字段来分组(math字段中数据相同的的行为一组),并且排序出其平均值<br>select math,avg(math) from student group by math order by desc;—&gt;分组使用显示,并且控制降序显示<br>select math,avg(math) from student group by math having avg(math) &gt; 60;—&gt;因为是会先执行where所有不能使用where这个时候就可以使用having来筛选结果了<br><b>分组函数可以单独使用,但是最好和group by一起连用</b></p><h3 id="去重命令"><a href="#去重命令" class="headerlink" title="去重命令"></a>去重命令</h3><p>dinstinct 命令（去重）<br>select count(dinstinct math) from student;</p><h2 id="乐观锁和悲观锁"><a href="#乐观锁和悲观锁" class="headerlink" title="乐观锁和悲观锁"></a>乐观锁和悲观锁</h2><p>乐观锁相当于没有synchronized<br>悲观锁相当于有synchronized</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">行级锁（又叫悲观锁）：</span><br><span class="line"><span class="keyword">select</span> ename,job,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> ename <span class="operator">|</span> job     <span class="operator">|</span> sal     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> JONES <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">3272.50</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BLAKE <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">3135.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CLARK <span class="operator">|</span> MANAGER <span class="operator">|</span> <span class="number">2695.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+---------+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> ename,job,sal <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line">在<span class="keyword">select</span>语句后加 <span class="keyword">for</span> <span class="keyword">update</span> 就是行级锁</span><br><span class="line">代表在当前事务结束之前，其他事务都无法修改这一行数据</span><br><span class="line">上面<span class="keyword">select</span>语句表示：那三行数据(其实是对应emp表中的三行数据)都无法修改</span><br><span class="line"></span><br><span class="line">乐观锁：</span><br><span class="line">多线程并发 都可以对这行数据修改</span><br></pre></td></tr></table></figure><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><p>连接查询？</p><h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><h4 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h4><p>92语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">emp.ename, dept.dname</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">emp, dept</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">emp.deptno <span class="operator">=</span> dept.deptno;<span class="operator">/</span><span class="operator">/</span>筛选条件，没有就会出现笛卡尔积现象（这样的等值筛选条件就是等值查询），像类一样调用（吧表看成对象）</span><br></pre></td></tr></table></figure><p><strong>没有查询限制-&gt;笛卡尔积现象</strong><br><strong>不是为了调高效率只是为了避免笛卡尔积现象,次数是不会少的</strong><br>上面语法的提高效率写法(给表起个别名)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,d.dname </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">emp e, dept d</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno; <span class="operator">/</span><span class="operator">/</span>SQL92语法</span><br></pre></td></tr></table></figure><p>SQL92的缺点：结构不清晰，表的连接条件和后期进一步筛选的条件，都放到了where后面。<br>SQL99语法:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><p>也可这样写:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span>  <span class="operator">/</span><span class="operator">/</span><span class="keyword">inner</span>可以省略（带着<span class="keyword">inner</span>可读性更好！！！一眼就能看出来是内连接）</span><br><span class="line">dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno;  <span class="operator">/</span><span class="operator">/</span> 条件是等量关系，所以被称为等值连接。</span><br></pre></td></tr></table></figure><p>SQL99的优点：表连接的条件是独立的，连接之后，如果还需要进一步筛选，再往后继续添加where,可如下操作:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">...</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">a</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">b</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">a和b的连接条件</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">筛选条件</span><br></pre></td></tr></table></figure><h4 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h4><p>非等值连接： 条件不是一个等量关系。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename, e.sal, s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;  <span class="operator">/</span><span class="operator">/</span> 条件不是一个等量关系，称为非等值连接。</span><br></pre></td></tr></table></figure><h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><p>（把自己看成两个表连接到一起）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">a.ename <span class="keyword">as</span> <span class="string">&#x27;员工名&#x27;</span>, b.ename <span class="keyword">as</span> <span class="string">&#x27;领导名&#x27;</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp a</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">emp b</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">a.mgr <span class="operator">=</span> b.empno;  <span class="operator">/</span><span class="operator">/</span>员工的领导编号 <span class="operator">=</span> 领导的员工编号</span><br></pre></td></tr></table></figure><h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>有不平等关系,内连接是两个表都是同等关系.<br>偏向谁(left左边的表或right右边的表)谁就是主,是扫描这个主表,顺便去扫描另外一个表</p><h4 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">dept d </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><h4 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e </span><br><span class="line"><span class="keyword">right</span> <span class="keyword">join</span> </span><br><span class="line">dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><p>outer 和 inner一样,也可省略</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> <span class="keyword">outer</span>是可以省略的，带着可读性强。</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e </span><br><span class="line"><span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> </span><br><span class="line">dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure><h3 id="全连接-不讲"><a href="#全连接-不讲" class="headerlink" title="全连接(不讲)"></a>全连接(不讲)</h3><h3 id="多张表查询"><a href="#多张表查询" class="headerlink" title="多张表查询"></a>多张表查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,e.sal,d.dname,s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">dept d</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">e.deptno <span class="operator">=</span> d.deptno  <span class="operator">/</span><span class="operator">/</span> e表和d表的连接条件：e表的员工部门编号要等于d表的部门编号</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;  <span class="operator">/</span><span class="operator">/</span> e表和s表的连接条件：e表的员工薪资要在s表的losal值和hisal值之间</span><br></pre></td></tr></table></figure><h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>子查询就是嵌套的 select 语句，可以理解为子查询是一张表。<br>select语句中嵌套select语句，被嵌套的select语句称为子查询。</p><h3 id="可出现位置"><a href="#可出现位置" class="headerlink" title="可出现位置"></a>可出现位置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">..(<span class="keyword">select</span>).</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">..(<span class="keyword">select</span>).</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">..(<span class="keyword">select</span>)</span><br></pre></td></tr></table></figure><h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p>找出比最低工资高的员工姓名和工资：<br><code>select ename,sal from emp where sal &gt; min(sal);</code>(报错)<br>上述语句报错的原因：where子句中不能直接使用分组函数。<br>实现思路：<br>第一步：查询最低工资是多少 <code>select min(sal) from emp;?</code><br>第二步：找出&gt;800的 <code>select ename,sal from emp where sal &gt; 800;</code><br>第三步：合并 <code>select ename,sal from emp where sal &gt; (select min(sal) from emp);</code></p><h3 id="from"><a href="#from" class="headerlink" title="from"></a>from</h3><p><strong>在 from 语句中使用子查询，可以将该子查询的查询结果看做一张表。</strong><br>找出每个岗位的平均工资的薪资等级<br>第一步：找出每个岗位的平均工资（按照岗位分组求平均值）。<br>????<code>select job,avg(sal) from emp group by job;</code><br>第二步：克服心理障碍，把以上的查询结果就当做一张真实存在的表 t。<br>????<code>select * from salgrade;</code>得到s表<br>第三步：t表和s表进行表连接，条件：t表的<code>avg(sal) between s.losal and s.hisal;</code><br>最后:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">t.<span class="operator">*</span>, s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> job,<span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job) t</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">e.ename,(<span class="keyword">select</span> d.dname <span class="keyword">from</span> dept d <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno) <span class="keyword">as</span> dname </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">emp e;</span><br></pre></td></tr></table></figure><p><strong>注意：对于select后面的子查询来说，这个子查询只能一次返回1条结果，多于1条，就报错了。</strong></p><h2 id="union"><a href="#union" class="headerlink" title="union"></a>union</h2><p>union合并查询结果集。<br>union 可以合并集合（相加）。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>union的效率要高一些。对于表连接来说，每连接一次新表，则匹配的次数满足笛卡尔积，成倍的翻。但是union可以减少匹配的次数。在减少匹配次数的情况下，还可以完成两个结果集的拼接。</strong><br>a 连接 b 连接 c<br>a 10条记录<br>b 10条记录<br>c 10条记录<br>匹配次数是：1000<br>a 连接 b 一个结果：10 <em> 10 —&gt; 100次<br>a 连接 c 一个结果：10 </em> 10 —&gt; 100次<br>使用union的话是：100次 + 100次 = 200次。（union把乘法变成了加法运算）</p><h3 id="union在使用的时候的注意事项："><a href="#union在使用的时候的注意事项：" class="headerlink" title="union在使用的时候的注意事项："></a>union在使用的时候的注意事项：</h3><ol><li>union在进行结果集合并的时候，要求两个结果集的列数相同。</li><li>MySQL可以，oracle语法严格 ，不可以，报错。要求：结果集合并时列和列的数据类型也要一致。</li></ol><h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><h3 id="imit-的作用"><a href="#imit-的作用" class="headerlink" title="imit 的作用"></a>imit 的作用</h3><p>MySQL 提供了 limit，主要用于提取前几条或者中间某几行数据。例如，select <em> from table limit m,n，其中 m 是指记录开始的 index，从 0 开始，表示第一条记录；n 是指从第 m+1 条开始，取 n 条。select </em> from tablename limit 2,4即取出第 3 条至第 6 条，4 条记录。<br>??limit 的作用：将查询结果集的一部分取出来，通常使用在分页查询当中。分页的作用是为了提高用户的体验，因为一次全部都查出来，用户体验差。</p><h3 id="limit-的用法"><a href="#limit-的用法" class="headerlink" title="limit 的用法"></a>limit 的用法</h3><p>完整用法：limit startIndex, length<br>    startIndex是起始下标，length是长度。<br>    起始下标从0开始。<br>缺省用法：limit 5; 这是取前5。</p><p><strong>注意：mysql当中limit在order by之后执行！</strong></p><p>每页显示3条记录<br>  第1页：limit 0,3 [0 1 2]<br>  第2页：limit 3,3 [3 4 5]<br>  第3页：limit 6,3 [6 7 8]<br>  第4页：limit 9,3 [9 10 11]</p><p>每页显示pageSize条记录<br>  第pageNo页：limit (pageNo - 1) * pageSize , pageSize</p><h3 id="执行顺序："><a href="#执行顺序：" class="headerlink" title="执行顺序："></a>执行顺序：</h3><ol><li>from</li><li>where</li><li>group by</li><li>having</li><li>select</li><li>order by</li><li>limit</li></ol><h1 id="表"><a href="#表" class="headerlink" title="表"></a>表</h1><p>建表的语法格式：(建表属于DDL语句，DDL包括：<code>create drop alter</code>)</p><h2 id="表的创建"><a href="#表的创建" class="headerlink" title="表的创建"></a>表的创建</h2><p>语法:<br><code>create table 表名(字段名1 数据类型, 字段名2 数据类型, 字段名3 数据类型);</code><br>或者:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">字段名<span class="number">1</span> 数据类型, </span><br><span class="line">字段名<span class="number">2</span> 数据类型, </span><br><span class="line">字段名<span class="number">3</span> 数据类型</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="varchar"><a href="#varchar" class="headerlink" title="varchar"></a>varchar</h3><p>varchar(最长255)：可变长度的字符串。<br>    比较智能，节省空间。<br>会根据实际的数据长度动态分配空间。<br>优点： 节省空间。<br>缺点： 需要动态分配空间，速度慢。</p><h3 id="char"><a href="#char" class="headerlink" title="char"></a>char</h3><p>char(最长255)：定长字符串。<br>不管实际的数据长度是多少，分配固定长度的空间去存储数据。<br>使用不恰当的时候，可能会导致空间的浪费。</p><p>优点： 不需要动态分配空间，速度快。<br>缺点： 使用不当可能会导致空间的浪费。</p><p>varchar和char应该怎么选择？<br>性别字段选什么？因为性别是固定长度的字符串，所以选择char。<br>姓名字段选什么？每一个人的名字长度不同，所以选择varchar。</p><h3 id="int"><a href="#int" class="headerlink" title="int"></a>int</h3><p>int(最长11)：数字中的整数型。等同于java的int。</p><h3 id="bigint"><a href="#bigint" class="headerlink" title="bigint"></a>bigint</h3><p>bigint：数字中的长整型。等同于java中的long。</p><h3 id="float"><a href="#float" class="headerlink" title="float"></a>float</h3><p>float：单精度浮点型数据。</p><h3 id="double"><a href="#double" class="headerlink" title="double"></a>double</h3><p>double：双精度浮点型数据。</p><h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p>date：短日期类型。</p><h3 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h3><p>datetime：长日期类型。</p><h3 id="clob"><a href="#clob" class="headerlink" title="clob"></a>clob</h3><p>clob：字符大对象（Character Large OBject）。<br> 最多可以存储4G的字符串。比如：存储一篇文章，存储一个说明。<br> 超过255个字符的都要采用CLOB字符大对象来存储。</p><h3 id="blob"><a href="#blob" class="headerlink" title="blob"></a>blob</h3><p>blob：二进制大对象（Binary Large OBject）。<br> 专门用来存储图片、声音、视频等流媒体数据。<br> 往BLOB类型的字段上插入数据的时候，例如插入一个图片、视频等，需要使用IO流才行。</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>创建一个学生表:<br>学号、姓名、年龄、性别、邮箱地址</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_student(</span><br><span class="line"><span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">sex <span class="type">char</span>(<span class="number">1</span>),</span><br><span class="line">age <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="表的删除"><a href="#表的删除" class="headerlink" title="表的删除"></a>表的删除</h2><p>删除表：<code>drop table t_student;</code>当这张表不存在的时候会报错！<br>??如果这张表存在的话，删除：<code>drop table if exists t_student;</code></p><h2 id="插入数据-insert-（DML）"><a href="#插入数据-insert-（DML）" class="headerlink" title="插入数据 insert （DML）"></a>插入数据 insert （DML）</h2><ul><li><p>语法格式： <code>insert into 表名(字段名1,字段名2,字段名3...) values(值1,值2,值3);</code></p><p>  注意：字段名和值要一一对应。什么是一一对应数量要对应，数据类型要对应。</p></li></ul><p>例如:<br>插入no为”1”、name为”zhangsan”、sex为”m”、age为”20”、email为”zhangsan@123.com”的数据：<code>insert into t_student(no,name,sex,age,email) values(1,&#39;zhangsan&#39;,&#39;m&#39;,20,&#39;zhangsan@123.com&#39;);</code></p><p>注意:</p><ol><li>insert语句但凡是执行成功了，那么必然会多一条记录。</li><li>没有给其它字段指定值的话，默认值是NULL。</li></ol><h3 id="创建新表，设置sex的默认值为”m”。"><a href="#创建新表，设置sex的默认值为”m”。" class="headerlink" title="创建新表，设置sex的默认值为”m”。"></a>创建新表，设置sex的默认值为”m”。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_student(</span><br><span class="line"><span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">sex <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;m&#x27;</span>,</span><br><span class="line">age <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="省略字段"><a href="#省略字段" class="headerlink" title="省略字段"></a>省略字段</h3><p>insert语句中的“字段名”可以省略吗？可以。<br>??但是insert into t_student values(2); 是错误的，因为前面的字段名省略的话，等于都写上了，所以值也要都写上</p><h3 id="insert-插入日期"><a href="#insert-插入日期" class="headerlink" title="insert 插入日期"></a>insert 插入日期</h3><p>数字格式化：<code>format</code><br>从员工信息表中查询员工名和工资：<code>select ename,sal from emp;</code><br>格式化数字：<code>format(数字, &#39;格式&#39;)</code><br><code>select ename,format(sal, &#39;$999,999&#39;) as sal from emp;</code></p><p><code>str_to_date()</code>：将字符串varchar类型转换成date类型。<br><code>date_format()</code>：将date类型转换成具有一定格式的varchar字符串类型。<br><strong>在MySQL当中怎么获取系统当前时间？</strong><br><code>now()</code>函数，并且获取的时间带有时分秒信息，是<strong>datetime</strong>类型的。例如，<code>insert into t_user(id,name,birth,create_time) values(2,&#39;lisi&#39;,&#39;1991-10-01&#39;,now());</code></p><p>可以使用<code>str_to_date</code>函数进行类型转换。<code>str_to_date</code>函数可以将字符串varchar转换成日期类型date，语法格式：<code>str_to_date(&#39;字符串日期&#39;, &#39;日期格式&#39;)</code><br><br><br>MySQL的日期格式：<br>%Y 年<br>%m 月<br>%d 日<br>%h 时<br>%i 分<br>%s 秒</p><p>示例:<br>插入id为1，name为”zhangsan”，birth为1990年10月1日的数据语句改为：<code>insert into t_user(id,name,birth) values(1, &#39;zhangsan&#39;, str_to_date(&#39;01-10-1990&#39;,&#39;%d-%m-%Y&#39;));</code></p><p><code>date_format</code>这个函数可以将日期类型转换成特定格式的字符串。<br><code>date_format</code>函数的用法：<code>date_format(日期类型数据, &#39;日期格式&#39;)</code>，这个函数通常使用在查询日期方面，设置展示的日期格式。例如，<code>select id,name,date_format(birth, &#39;%m/%d/%Y&#39;) as birth from t_user;</code></p><h3 id="date-和-datetime-两个类型的区别"><a href="#date-和-datetime-两个类型的区别" class="headerlink" title="date 和 datetime 两个类型的区别"></a>date 和 datetime 两个类型的区别</h3><p>date是短日期：只包括年月日信息。<br>datetime是长日期：包括年月日时分秒信息。</p><p>MySQL短日期默认格式：%Y-%m-%d。<br>MySQL长日期默认格式：%Y-%m-%d %h:%i:%s</p><h2 id="修改-update（DML）"><a href="#修改-update（DML）" class="headerlink" title="修改 update（DML）"></a>修改 update（DML）</h2><p>语法格式：<code>update 表名 set 字段名1=值1,字段名2=值2,字段名3=值3... where 条件;</code><br>注意 set<br>注意： 没有条件限制会导致所有数据全部更新。</p><p>更新id为2的name、birth信息：<br><code>update t_user set name = &#39;jack&#39;, birth = &#39;2000-10-11&#39; where id = 2;</code><br>更新id为2的create_time信息：<br><code>update t_user set name = &#39;jack&#39;, birth = &#39;2000-10-11&#39;, create_time = now() where id = 2;</code><br>更新所有：<br><code>update t_user set name = &#39;abc&#39;;</code></p><h2 id="删除数据-delete-（DML）"><a href="#删除数据-delete-（DML）" class="headerlink" title="删除数据 delete （DML）"></a>删除数据 delete （DML）</h2><p>语法格式：delete from 表名 where 条件;<br>注意： 没有条件，整张表的数据会全部删除！</p><p>删除表中id为2的信息：<br><code>delete from t_user where id = 2;</code><br>插入id为2的数据：<br><code>insert into t_user(id) values(2);</code><br>删除所有：<br><code>delete from t_user;</code></p><h2 id="表的一些比较高级的操作"><a href="#表的一些比较高级的操作" class="headerlink" title="表的一些比较高级的操作"></a>表的一些比较高级的操作</h2><h3 id="insert-语句一次插入多条记录"><a href="#insert-语句一次插入多条记录" class="headerlink" title="insert 语句一次插入多条记录"></a>insert 语句一次插入多条记录</h3><p>insert 语句一次插入多条记录的语法:<code>insert into t_user(字段名1,字段名2) values(),(),(),();</code><br>示例:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(id,name,birth,create_time) <span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="string">&#x27;1980-10-11&#x27;</span>,now()), </span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;1981-10-11&#x27;</span>,now()),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;1982-10-11&#x27;</span>,now());</span><br></pre></td></tr></table></figure><h3 id="快速创建表"><a href="#快速创建表" class="headerlink" title="快速创建表"></a>快速创建表</h3><p>快速创建表emp2：<code>create table emp2 as select * from emp;</code></p><h4 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h4><ol><li>将一个查询结果当做一张表新建！</li><li>这个可以完成表的快速复制！</li><li>表创建出来，同时表中的<strong>数据也存在了！</strong></li></ol><p>有条件的创建表mytable(只复制一部分新建)：<br><code>create table mytable as select empno,ename from emp where job = &#39;MANAGER&#39;;</code></p><h3 id="将查询结果插入到一张表当中"><a href="#将查询结果插入到一张表当中" class="headerlink" title="将查询结果插入到一张表当中"></a>将查询结果插入到一张表当中</h3><p>?快速创建表 dept_bak： <code>create table dept_bak as select * from dept;</code><br>将查询结果插入到表 dept_bak 当中：<code>insert into dept_bak select * from dept;</code>（很少用）</p><h3 id="快速删除表中的数据-较重要"><a href="#快速删除表中的数据-较重要" class="headerlink" title="快速删除表中的数据(较重要)"></a>快速删除表中的数据(较重要)</h3><p>删除 dept_bak 表中的数据：<code>delete from dept_bak;</code>，这种删除数据的方式比较慢。<br>delete语句删除数据的原理：（delete属于DML语句！）<br>表中的数据被删除了，但是这个数据在硬盘上的<strong>真实存储空间不会被释放！</strong><br>这种删除缺点是：删除效率比较低。<br>这种删除优点是：支持回滚，后悔了<u>可以再恢复数据！</u></p><p>truncate语句删除数据的原理：<br>这种删除效率比较高，表被一次截断，物理删除。<br>这种删除缺点：不支持回滚。<br>这种删除优点：快速。</p><p>truncate语句删除数据的用法：<code>truncate table dept_bak;</code>（这种操作属于DDL操作）</p><p>当大表非常大，例如上亿条记录，删除的时候，使用delete，也许需要执行1个小时才能删除完，效率较低。可以选择使用truncate删除表中的数据，只需要不到1秒钟的时间就删除结束，效率较高。但是使用truncate之前，必须仔细询问客户是否真的要删除，并警告删除之后不可恢复！</p><p>truncate是删除表中的数据，表还在！<br>删除表操作：<code>drop table 表名;</code>，<em>这不是删除表中的数据，这是把表删</em>除。</p><h3 id="对表结构的增删改-不太重要"><a href="#对表结构的增删改-不太重要" class="headerlink" title="对表结构的增删改(不太重要)"></a>对<strong>表</strong>结构的增删改(不太重要)</h3><p>什么是对表结构的修改？<br>??添加一个字段，删除一个字段，修改一个字段！</p><p>??对表结构的修改需要使用：alter（属于DDL语句，DDL包括：create 、drop 、alter。）</p><p>注意：</p><ol><li>在实际的开发中，需求一旦确定之后，表一旦设计好之后，很少的进行表结构的修改。因为开发进行中的时候，修改表结构，成本比较高。</li><li>由于修改表结构的操作很少，所以我们不需要掌握，如果有一天真的要修改表结构，可以使用工具！</li></ol><h2 id="创建表加入约束"><a href="#创建表加入约束" class="headerlink" title="创建表加入约束"></a>创建表加入约束</h2><h3 id="什么是约束"><a href="#什么是约束" class="headerlink" title="什么是约束"></a>什么是约束</h3><p>约束对应的英语单词：constraint。<br>在创建表的时候，我们可以给表中的字段加上一些约束，来保证这个表中数据的完整性、有效性！<br>约束的作用就是为了保证表中的数据有效！</p><h3 id="约束包括哪些"><a href="#约束包括哪些" class="headerlink" title="约束包括哪些"></a>约束包括哪些</h3><p>非空约束：<code>not null</code><br>唯一性约束：<code>unique</code><br>主键约束: <code>primary key</code> （简称PK）<br>外键约束：<code>foreign key</code>（简称FK）<br>检查约束：<code>check</code>（mysql不支持，oracle支持）</p><h3 id="非空约束-not-null"><a href="#非空约束-not-null" class="headerlink" title="非空约束 not null"></a>非空约束 not null</h3><p>非空约束<code>not null</code>：约束的字段不能为NULL。<br>示例:(创建一个表 t_vip)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>not null</code>只有列级约束，没有表级约束！<br>上面建表约束后:当只插入id信息，name信息为NULL时，会报错.</p><p>注意：</p><ol><li>xxxx.sql 这种文件被称为sql脚本文件。</li><li>sql 脚本文件中编写了大量的 sql 语句。我们执行sql脚本文件的时候，该文件中所有的 sql 语句会全部执行！</li><li>批量的执行 sql 语句，可以使用 sql 脚本文件。</li><li>在mysql当中执行sql脚本：source E:\工具+源码+资料\document\vip.sql</li></ol><h3 id="唯一性约束-unique"><a href="#唯一性约束-unique" class="headerlink" title="唯一性约束 unique"></a>唯一性约束 unique</h3><p>唯一性约束 unique ：约束的字段<strong>不能重复</strong>，但是<u>可以为NULL</u>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>,</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;lisi@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;wangwu@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip;</span><br></pre></td></tr></table></figure><p>当再插入的数据与之前的有重复时，会报错!<br>name字段虽然被unique约束了，但是可以为NULL。<br><code>name varchar(255) unique</code>，约束直接添加到列后面的，叫做<strong>列级约束</strong><br>不使用列级约束:<code>unique(name,email)</code>，约束没有添加在列的后面，这种约束被称为<strong>表级约束</strong>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">unique</span>(name,email) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@sina.com&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip;</span><br></pre></td></tr></table></figure><p><strong>注意,这样不是这两个有一个重复都会报错,而是当两个同时重复才会报错</strong><br><code>unique</code> 和<code>not null</code>可以联合:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">desc</span> t_vip;</span><br></pre></td></tr></table></figure><p>在mysql当中，如果一个字段同时被not null和unique约束的话，该字段自动变成主键字段</p><h3 id="主键约束（primary-key）-非常非常重要"><a href="#主键约束（primary-key）-非常非常重要" class="headerlink" title="主键约束（primary key）(非常非常重要)"></a>主键约束（primary key）(<strong>非常非常重要</strong>)</h3><p>主键约束： primary key，简称PK。</p><h4 id="主键约束的相关术语："><a href="#主键约束的相关术语：" class="headerlink" title="主键约束的相关术语："></a>主键约束的相关术语：</h4><p>主键约束： 就是一种约束。<br>主键字段： 该字段上添加了主键约束，这样的字段叫做主键字段<br>主键值： 主键字段中的每一个值都叫做主键值。</p><h5 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h5><p>??每个表应该具有主键，主键可以标识记录的唯一性，主键分为单一主键和复合（联合）主键，单一主键是由一个字段构成的，复合（联合）主键是由多个字段构成的。</p><p>?什么是主键？有什么作用？<br>??主键值是每一行记录的唯一标识。主键值是每一行记录的身份证号(如果其他字段的值都相同,要求要有一个字段的值能够来区分)！<br>??<strong><strong>任何一张表都应该有主键，没有主键，<u>表无效</u>！(相当于人没有身份证号)</strong></strong><br>??<strong>主键的特征</strong>：not null + unique（主键值不能是NULL，同时也不能重复！）</p><p>示例(创建一个有主键的表):</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>);</span><br></pre></td></tr></table></figure><p>上述语句中，<code>id int primary key</code>为<strong>列级约束</strong>。<code>id</code>做主键：<strong>单一主键</strong>！</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">primary</span> key(id) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>);</span><br></pre></td></tr></table></figure><p>其中，<code>primary key(id)</code>为<strong>表级约束</strong>。<code>id</code>和<code>name</code>联合起来做主键：<strong>复合主键</strong>！<br>(在实际开发中不建议使用复合主键，建议使用单一主键！因为主键值存在的意义就是这行记录的身份证号，只要意义达到即可，单一主键可以做到。而复合主键比较复杂，不建议使用。)</p><p><strong>一张表，主键约束只能添加1个（主键只能有1个）。</strong></p><h5 id="主键值"><a href="#主键值" class="headerlink" title="主键值"></a>主键值</h5><p>主键值建议使用int、bigint、char等类型，不建议使用varchar来做主键。主键值一般都是数字，一般都是定长的。</p><p>主键分类：<br>单一主键和复合主键<br>???单一主键：由一个字段构成。<br>???复合主键： 由多个字段构成。<br>自然主键和业务主键<br>???自然主键：主键值是一个自然数，和<u>业务没关系</u>。<br>???业务主键：主键值和业务紧密关联，例如拿银行卡账号做主键值。</p><p>??在实际开发中使用自然主键使用比较多，因为主键只要做到不重复就行，不需要有意义。业务主键不好，因为主键一旦和业务挂钩，那么当业务发生变动的时候，可能会影响到主键值，所以业务主键不建议使用，尽量使用自然主键。</p><p><strong>在mysql当中，有一种机制，可以帮助我们自动维护一个主键值。</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment, </span><br><span class="line">name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip;</span><br></pre></td></tr></table></figure><p>其中，<code>id int primary key auto_increment</code>语句中<code>auto_increment</code>表示自增，从1开始，以1递增。<strong>auto_increment</strong><br><strong>使用了auto_increment之后如果不给id赋值id会自增,但是任然还是可以赋值,只是不能和前面重复了</strong></p><h3 id="外键约束（foreign-key）-非常非常重要"><a href="#外键约束（foreign-key）-非常非常重要" class="headerlink" title="外键约束（foreign key）(非常非常重要)"></a>外键约束（foreign key）(<strong>非常非常重要</strong>)</h3><p>外键约束： foreign key，简称FK。</p><h4 id="外键约束的相关术语："><a href="#外键约束的相关术语：" class="headerlink" title="外键约束的相关术语："></a>外键约束的相关术语：</h4><p>???外键约束： 一种约束（foreign key）。<br>???外键字段： 该字段上添加了外键约束。<br>???外键值： 外键字段当中的每一个值。</p><p>??外键主要是维护表之间的关系的，主要是为了保证参照完整性，如果表中的某个字段为外键字段，那么该字段的值必<br>须来源于参照的表的主键，如：emp 中的 deptno 值必须来源于 dept 表中的 deptno 字段值。</p><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p>业务背景： 请设计数据库表，来描述“班级和学生”的信息。</p><h5 id="第一种方案：班级和学生存储在一张表中"><a href="#第一种方案：班级和学生存储在一张表中" class="headerlink" title="第一种方案：班级和学生存储在一张表中"></a>第一种方案：班级和学生存储在一张表中</h5><pre><code>t_student</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">no(pk)nameclassnoclassname</span><br><span class="line"> ----------------------------------------------------------------------------------</span><br><span class="line"> 1jack100      北京市大兴区亦庄镇第二中学高三1班</span><br><span class="line"> 2lucy100    北京市大兴区亦庄镇第二中学高三1班</span><br><span class="line"> 3lilei100    北京市大兴区亦庄镇第二中学高三1班</span><br><span class="line"> 4hanmeimei100    北京市大兴区亦庄镇第二中学高三1班</span><br><span class="line"> 5zhangsan101    北京市大兴区亦庄镇第二中学高三2班</span><br><span class="line"> 6lisi101    北京市大兴区亦庄镇第二中学高三2班</span><br><span class="line"> 7wangwu101    北京市大兴区亦庄镇第二中学高三2班</span><br><span class="line"> 8zhaoliu101    北京市大兴区亦庄镇第二中学高三2班</span><br></pre></td></tr></table></figure><p>以上方案的缺点：数据冗余，空间浪费！</p><h5 id="第二种方案：班级一张表、学生一张表"><a href="#第二种方案：班级一张表、学生一张表" class="headerlink" title="第二种方案：班级一张表、学生一张表"></a>第二种方案：班级一张表、学生一张表</h5><p>t_class 班级表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">classno(pk)classname</span><br><span class="line">------------------------------------------------------</span><br><span class="line">100    北京市大兴区亦庄镇第二中学高三1班</span><br><span class="line">101    北京市大兴区亦庄镇第二中学高三1班</span><br></pre></td></tr></table></figure><p>t_student 学生表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">no(pk)namecno(FK引用t_class这张表的classno)</span><br><span class="line">----------------------------------------------------------------</span><br><span class="line">1jack100</span><br><span class="line">2lucy100</span><br><span class="line">3lilei100</span><br><span class="line">4hanmeimei        100</span><br><span class="line">5zhangsan101</span><br><span class="line">6lisi101</span><br><span class="line">7wangwu            101</span><br><span class="line">8zhaoliu        101</span><br></pre></td></tr></table></figure><p>当cno字段没有任何约束的时候，可能会导致数据无效。可能出现一个102，但是102班级不存在。所以为了保证cno字段中的值都是100和101，需要给cno字段添加外键约束，那么cno字段就是外键字段，cno字段中的每一个值都是外键值。</p><h6 id="实现"><a href="#实现" class="headerlink" title="实现:"></a>实现:</h6><p>首先建立班级表 t_classes：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_classes;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_classes(</span><br><span class="line">    classes_id <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">    classes_name <span class="type">varchar</span>(<span class="number">40</span>),</span><br><span class="line">    <span class="keyword">constraint</span> pk_classes_id <span class="keyword">primary</span> key(classes_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>在 t_student <strong>中加入外键约束</strong>：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_student;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_student(</span><br><span class="line">    student_id <span class="type">int</span>(<span class="number">10</span>),</span><br><span class="line">    student_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    sex <span class="type">char</span>(<span class="number">2</span>),</span><br><span class="line">    birthday <span class="type">date</span>,</span><br><span class="line">    email <span class="type">varchar</span>(<span class="number">30</span>),</span><br><span class="line">    classes_id <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">    <span class="keyword">constraint</span> student_id_pk <span class="keyword">primary</span> key(student_id),<span class="operator">/</span><span class="operator">/</span>主键</span><br><span class="line">    <span class="keyword">constraint</span> fk_classes_id <span class="keyword">foreign</span> key(classes_id) <span class="keyword">references</span> t_classes(classes_id) <span class="operator">/</span><span class="operator">/</span>外键</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>constraint的意思是约束<br>references的意思是引用<br><code>constraint fk_classes_id foreign key(classes_id) references t_classes(classes_id)</code>的意思是:受约束的fk_classes_id受外键(t_classes_id(在t_classes表中))约束,引用t_classes表中的class_id字段意思是在t_student表中的fk_classes_id的值只能是t_classes中classes_id中的值</p><p>注意：<br>t_class 是父表<br>t_student是子表<br>删除表的顺序：先删子，再删父。<br>创建表的顺序：先创建父，再创建子。<br>删除数据的顺序：先删子，再删父。<br>插入数据的顺序：先插入父，再插入子。</p><p>外键不一定是父表的主键,单=但至少要有unique约束(外键可以为null)</p><h1 id="存储引擎-了解"><a href="#存储引擎-了解" class="headerlink" title="存储引擎(了解)"></a>存储引擎(了解)</h1><h1 id="事务-非常非常重要"><a href="#事务-非常非常重要" class="headerlink" title="事务(非常非常重要)"></a>事务(<strong>非常非常重要</strong>)</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h2><p>一个事务其实就是一个完整的业务逻辑，是<u>一个最小的工作单元</u>，不可再分。</p><p>什么是一个完整的业务逻辑：<br>假设转账，从A账户向B账户中转账10000，<br>将A账户的钱减去10000（update语句），<br>将B账户的钱加上10000（update语句），<br>这就是一个完整的业务逻辑。</p><p>以上的操作是一个最小的工作单元，要么同时成功，要么同时失败，不可再分。这两个update语句要求必须同时成功或者同时失败，这样才能保证钱是正确的。</p><h2 id="与事务相关的语句"><a href="#与事务相关的语句" class="headerlink" title="与事务相关的语句"></a>与事务相关的语句</h2><p>只有DML语句才会有事务这一说，其它语句和事务无关。因此，只有<code>insert</code>、<code>delete</code>、<code>update</code>这三个语句和事务有关系，其它都没有关系。因为只有以上的三个语句是数据库表中数据进行增、删、改的。<br>??只要操作一旦涉及到数据的增、删、改，那么就一定要考虑安全问题，数据安全第一位！</p><h2 id="事务机制的存在价值"><a href="#事务机制的存在价值" class="headerlink" title="事务机制的存在价值"></a>事务机制的存在价值</h2><p>??假设所有的业务，只要一条DML语句就能完成，还有必要存在事务机制吗？<br>??正是因为做某件事的时候，需要多条DML语句共同联合起来才能完成，所以需要事务的存在。如果任何一件复杂的事儿都能一条DML语句搞定，那么事务则没有存在的价值了。</p><p>到底什么是事务呢？<br>本质上，一个事务其实就是多条DML语句<u><strong>同时</strong>成功，或者<strong>同时</strong>失败</u>！<br>事务： 就是批量的DML语句同时成功，或者同时失败！</p><h2 id="事务的执行过程"><a href="#事务的执行过程" class="headerlink" title="事务的执行过程"></a>事务的执行过程</h2><p>事务是怎么做到多条DML语句同时成功和同时失败的呢？<br>InnoDB存储引擎提供一组用来记录事务性活动的日志文件。</p><p>在事务的执行过程中，每一条DML的操作都会记录到“事务性活动的日志文件”中。</p><p>在事务的执行过程中，我们可以提交事务，也可以回滚事务。<br><strong>提交事务</strong>：<br>清空事务性活动的日志文件，将数据全部彻底持久化到数据库表中。提交事务标志着事务的结束，<strong>并且是一种<u>全部成功</u>的结束</strong>。</p><p><strong>回滚事务</strong>：<br>将之前所有的DML操作全部撤销，并且清空事务性活动的日志文件。回滚事务标志着事务的结束，<strong>并且是一种<u>全部失败</u>的结束</strong>。</p><h2 id="提交事务和回滚事务"><a href="#提交事务和回滚事务" class="headerlink" title="提交事务和回滚事务"></a>提交事务和回滚事务</h2><p>提交事务：commit; 语句<br>回滚事务：rollback; 语句（<strong>回滚永远都是只能回滚到上一次的提交点</strong>）</p><p>事务对应的英语单词是：transaction</p><p>mysql默认情况下是支持自动提交事务的。（自动提交）<br><strong>自动提交</strong>:每执行一条DML语句，则提交一次！</p><h3 id="怎么将mysql的自动提交机制关闭掉呢？"><a href="#怎么将mysql的自动提交机制关闭掉呢？" class="headerlink" title="怎么将mysql的自动提交机制关闭掉呢？"></a>怎么将mysql的自动提交机制关闭掉呢？</h3><p>先执行这个命令：`start transaction;</p><h3 id="回滚事务"><a href="#回滚事务" class="headerlink" title="回滚事务"></a>回滚事务</h3><p>先执行命令<code>start transaction;</code>将自动提交机制关闭，往空表 dept_bak1 中添加三条数据后，并没有提交，所以执行回滚命令之后，dept_bak1 会退回到空表状态。</p><h3 id="提交事务"><a href="#提交事务" class="headerlink" title="提交事务"></a>提交事务</h3><p>先执行命令<code>start transaction;</code>将自动提交机制关闭，往表 dept_bak1 中再添加两条条数据后，执行commit命令进行提交，所以执行回滚命令之后，dept_bak1 中数据依然存在。</p><h2 id="事务的4个特性"><a href="#事务的4个特性" class="headerlink" title="事务的4个特性"></a>事务的4个特性</h2><ol><li>原子性(A): 说明事务是最小的工作单元，不可再分。</li><li>一致性(C): 所有事务要求，在同一个事务当中，所有操作必须同时成功，或者同时失败，以保证数据的一致性。</li><li>隔离性(I):看后面</li><li>持久性(D):事务最终结束的一个保障。事务提交，就相当于将没有保存到硬盘上的数据保存到硬盘上！</li></ol><h2 id="事务的隔离性"><a href="#事务的隔离性" class="headerlink" title="事务的隔离性"></a>事务的隔离性</h2><p>??A教室和B教室中间有一道墙，这道墙可以很厚，也可以很薄，这就是事务的隔离级别。这道墙越厚，表示隔离级别就越高。</p><p>事务和事务之间的隔离级别有4个级别：</p><ol><li>读未提交： read uncommitted（最低的隔离级别），即没有提交就读到。<br> 什么是读未提交？-&gt;事务A可以读取到事务B未提交的数据。<br> 这种隔离级别存在的问题就是：脏读现象(Dirty Read)！我们称读到了脏数据。<br> 这种隔离级别一般都是理论上的，大多数的数据库隔离级别都是二档起步！(比这个高)</li><li>读已提交： read committed，即提交之后才能读到。<br> 什么是读已提交？-&gt;事务A只能读取到事务B提交之后的数据。<br> 这种隔离级别解决了什么问题？-&gt;解决了脏读的现象。<br> 这种隔离级别存在什么问题？-&gt;不可重复读取数据。<br> 什么是不可重复读取数据呢？-&gt;在事务开启之后，第一次读到的数据是3条，当前事务还没有结束，可能第二次再读取的时候，读到的数据是4条，3不等于4称为不可重复读取。<br> 这种隔离级别是比较真实的数据，每一次读到的数据是<u>绝对的真实</u>。<br> <strong>oracle数据库默认的隔离级别是：read committed。</strong></li><li>可重复读： repeatable read，即提交之后也读不到，永远读取的都是刚开启事务时的数据。<br> 什么是可重复读取？-&gt;事务A开启之后，不管是多久，每一次在事务A中读取到的数据都是一致的。即使事务B将数据已经修改，并且提交了，事务A读取到的数据还是没有发生改变，这就是可重复读。<br> 可重复读解决了什么问题？解决了不可重复读取数据。<br> 可重复读存在的问题是什么？可能会出现幻影读。每一次读取到的数据都是幻象，不够真实！早晨9点开始开启了事务，只要事务不结束，到晚上9点，<u>读到的数据还是那样！</u>读到的是假象，不够绝对的真实。<br> <strong>mysql中默认的事务隔离级别就是这个！</strong></li><li>序列化/串行化： serializable（最高的隔离级别），这是最高隔离级别，效率最低。<br> 解决了所有的问题。<br> 这种隔离级别表示事务<strong>排队</strong>，不能并发！<br> synchronized，线程同步（事务同步）<br> 每一次读取到的数据都是最真实的，并且效率是最低的。</li></ol><h5 id="验证：read-uncommited"><a href="#验证：read-uncommited" class="headerlink" title="验证：read uncommited"></a>验证：read uncommited</h5><p><code>set global transaction isolation level read uncommitted;</code></p><h5 id="验证：read-commited"><a href="#验证：read-commited" class="headerlink" title="验证：read commited"></a>验证：read commited</h5><p><code>set global transaction isolation level read committed;</code></p><h5 id="验证：repeatable-read"><a href="#验证：repeatable-read" class="headerlink" title="验证：repeatable read"></a>验证：repeatable read</h5><p><code>set global transaction isolation level repeatable read;</code></p><h5 id="验证：serializable"><a href="#验证：serializable" class="headerlink" title="验证：serializable"></a>验证：serializable</h5><p><code>set global transaction isolation level serializable;</code></p><h1 id="索引-index"><a href="#索引-index" class="headerlink" title="索引(index)"></a>索引(index)</h1><h2 id="什么是索引"><a href="#什么是索引" class="headerlink" title="什么是索引"></a>什么是索引</h2><p>?索引（index）是在数据库表的<strong>字段</strong>上添加的，是为了提高查询效率存在的一种机制。一张表的一个字段可以添加一个索引，当然，多个字段联合起来也可以添加索引。索引相当于一本书的目录，是为了缩小扫描范围而存在的一种机制。</p><p>对于一本字典来说，查找某个汉字有两种方式：</p><ol><li>一页一页挨着找，直到找到为止，这种查找方式属于全字典扫描，效率比较低。</li><li>先通过目录（索引）去定位一个大概的位置，然后直接定位到这个位置，做局域性扫描，缩小扫描的范围，快速的查找。这种查找方式属于通过索引检索，效率较高。<br> MySQL在查询方面主要就是两种方式：<br> 第一种方式：全表扫描。<br>  第二种方式：根据索引检索。</li></ol><p>注意：<br>在实际中，汉语字典前面的目录是排序的，按照a b c d e f…排序。为什么排序呢？因为只有排序了才会有区间查找这一说！（缩小扫描范围，其实就是扫描某个区间！）<br>??在mysql数据库当中索引也是需要排序的，并且这个索引的排序和TreeSet数据结构相同。TreeSet（TreeMap）底层是一个自平衡的二叉树！<br>??在mysql当中，索引是一个B-Tree数据结构。遵循左小又大原则存放，采用中序遍历方式遍历取数据。</p><h2 id="索引的实现原理"><a href="#索引的实现原理" class="headerlink" title="索引的实现原理"></a>索引的实现原理</h2><p>注意：</p><ol><li>在任何数据库当中，主键上都会自动添加索引对象，id字段上自动有索引，因为id是PK。另外在mysql当中，一个字段上如果有unique约束的话，也会自动创建索引对象</li><li>在任何数据库当中，任何一张表的任何一条记录在硬盘存储上都有一个硬盘的物理存储编号</li><li>在mysql当中，索引是一个单独的对象，不同的存储引擎以不同的形式存在，在MyISAM存储引擎中，索引存储在一个.MYI文件中。在InnoDB存储引擎中，索引存储在一个逻辑名称叫做tablespace的当中。在MEMORY存储引擎当中，索引被存储在内存当中。不管索引存储在哪里，索引在mysql当中都是一个树的形式存在。（自平衡二叉树：B-Tree）</li></ol><p><strong>表中字段不会动,是对对象地址排序</strong></p><h2 id="添加索引的条件"><a href="#添加索引的条件" class="headerlink" title="添加索引的条件"></a>添加索引的条件</h2><p>在mysql当中，主键上以及unique字段上都会自动添加索引的。<br>什么条件下，我们会考虑给字段添加索引呢？<br>条件1：数据量庞大。（到底有多么庞大算庞大，这个需要测试，因为每一个硬件环境不同。）<br>条件2：该字段经常出现在where的后面，以条件的形式存在，也就是说这个字段总是被扫描。<br>条件3：该字段很少的DML(insert、delete、update)操作。（因为DML之后，索引需要重新排序。）</p><p>建议不要随意添加索引，因为索引也是需要维护的，太多的话反而会降低系统的性能。<br>建议通过主键查询，建议通过unique约束的字段进行查询，效率是比较高的。</p><h2 id="索引的创建和删除"><a href="#索引的创建和删除" class="headerlink" title="索引的创建和删除"></a>索引的创建和删除</h2><p>创建索引： <code>create index emp_ename_index on emp(ename);</code><br> 给emp表的ename字段添加索引，起名为emp_ename_index</p><p>删除索引： <code>drop index emp_ename_index on emp;</code><br> 将emp表上的emp_ename_index索引对象删除。</p><h2 id="如何查看SQL语句是否使用索引进行检索"><a href="#如何查看SQL语句是否使用索引进行检索" class="headerlink" title="如何查看SQL语句是否使用索引进行检索"></a>如何查看SQL语句是否使用索引进行检索</h2><p>在mysql当中，怎么查看一个SQL语句是否使用了索引进行检索？<br><code>explain select * from emp where ename = &#39;KING&#39;;</code><br>扫描14条记录：说明没有使用索引(type=ALL)。</p><h2 id="索引失效的情况"><a href="#索引失效的情况" class="headerlink" title="索引失效的情况"></a>索引失效的情况</h2><h3 id="失效的第1种情况：-使用模糊查询的时候，条件以“-”开始。"><a href="#失效的第1种情况：-使用模糊查询的时候，条件以“-”开始。" class="headerlink" title="失效的第1种情况： 使用模糊查询的时候，条件以“%”开始。"></a>失效的第1种情况： 使用模糊查询的时候，条件以“%”开始。</h3><p><code>select * from emp where ename like &#39;%T&#39;;</code><br>ename上即使添加了索引，也不会走索引，为什么？原因是因为模糊匹配当中以“%”开头了！ 尽量避免模糊查询的时候以“%”开始。这是一种优化的手段/策略。</p><h3 id="失效的第2种情况：-使用or的时候会失效"><a href="#失效的第2种情况：-使用or的时候会失效" class="headerlink" title="失效的第2种情况： 使用or的时候会失效"></a>失效的第2种情况： 使用or的时候会失效</h3><p>如果使用or，那么要求or两边的条件字段都要有索引，才会走索引。如果其中一边有一个字段没有索引，那么另一个字段上的索引也会失效，所以这就是为什么不建议使用or的原因</p><h3 id="失效的第3种情况：-使用复合索引的时候"><a href="#失效的第3种情况：-使用复合索引的时候" class="headerlink" title="失效的第3种情况： 使用复合索引的时候"></a>失效的第3种情况： 使用复合索引的时候</h3><p>没有使用左侧的列查找，则索引失效。什么是复合索引？<br>两个字段，或者更多的字段联合起来添加一个索引，叫做复合索引。<br>创建复合索引：<code>create index emp_job_sal_index on emp(job,sal);</code><br>使用左侧的列查找：<code>explain select * from emp where job = &#39;MANAGER&#39;;</code>，索引未失效。<br>没有使用左侧的列查找：<code>explain select * from emp where sal = 800;</code>，索引失效。</p><h3 id="失效的第4种情况：-在where当中索引列参加了运算的时候"><a href="#失效的第4种情况：-在where当中索引列参加了运算的时候" class="headerlink" title="失效的第4种情况： 在where当中索引列参加了运算的时候"></a>失效的第4种情况： 在where当中索引列参加了运算的时候</h3><p>创建索引：<code>create index emp_sal_index on emp(sal);</code><br>在where当中索引列为未进行运算：<code>explain select * from emp where sal = 800;</code>，索引未失效。<br>在where当中索引列进行了运算：<code>explain select * from emp where sal+1 = 800;</code>，索引失效。</p><h3 id="失效的第5种情况：-在where当中索引列使用了函数"><a href="#失效的第5种情况：-在where当中索引列使用了函数" class="headerlink" title="失效的第5种情况： 在where当中索引列使用了函数"></a>失效的第5种情况： 在where当中索引<u>列</u>使用了函数</h3><p>explain select * from emp where lower(ename) = ‘smith’;</p><h2 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h2><p>??索引是各种数据库进行优化的重要手段，优化的时候优先考虑的因素就是索引。</p><p>?索引在数据库当中的分类：</p><p>单一索引： 一个字段上添加索引。<br>复合索引： 两个字段或者更多的字段上添加索引。<br>主键索引： 主键上添加索引。<br>唯一性索引： 具有unique约束的字段上添加索引。</p><h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="什么是视图"><a href="#什么是视图" class="headerlink" title="什么是视图"></a>什么是视图</h2><p>视图(view)：站在不同的角度去看待同一份数据。</p><h2 id="创建和删除视图对象"><a href="#创建和删除视图对象" class="headerlink" title="创建和删除视图对象"></a>创建和删除视图对象</h2><p>创建视图对象：<code>create view dept2_view as select * from dept2;</code></p><p>删除视图对象：<code>drop view dept2_view;</code></p><p>注意：只有DQL语句才能以view的形式创建。<code>create view view_name as</code> 这里的语句必须是DQL语句</p><h2 id="视图的作用"><a href="#视图的作用" class="headerlink" title="视图的作用"></a>视图的作用</h2><p>我们可以面向视图对象进行增删改查，<strong>对视图对象的增删改查，会导致原表被操作！</strong>（视图的特点： 通过对视图的操作，会影响到原表数据。）</p><p>面向视图查询：<code>select * from dept2_view;</code><br>查询原表数据：<code>select * from dept2;</code><br>查询视图对象：<code>select * from emp_dept_view;</code></p><p>面向视图插入：<code>insert into dept2_view(deptno,dname,loc) values(60,&#39;SALES&#39;, &#39;BEIJING&#39;);</code></p><p>面向视图删除：<code>delete from dept2_view;</code></p><p>面向视图更新：<code>update emp_dept_view set sal = 1000 where dname = &#39;ACCOUNTING&#39;;</code><br>原表数据被更新：<code>select * from emp;</code></p><h2 id="视图对象的作用"><a href="#视图对象的作用" class="headerlink" title="视图对象的作用"></a>视图对象的作用</h2><p>视图对象在实际开发中到底有什么用？<br>??方便，简化开发，利于维护。</p><p>假设<strong>有一条非常复杂的SQL语句，而这条SQL语句需要在不同的位置上反复使用。每一次使用这个SQL语句的时候都需要重新编写，很长，很麻烦</strong>，怎么办？<br>??可以把这条复杂的SQL语句以视图对象的形式新建。在需要编写这条SQL语句的位置直接使用视图对象，可以大大简化开发。并且利于后期的维护，因为修改的时候也只需要修改一个位置就行，只需要修改视图对象所映射的SQL语句。</p><p>??以后面向视图开发的时候，使用视图的时候可以像使用table一样，可以对视图进行增删改查等操作。视图不是在内存当中，视图对象也是存储在硬盘上的，不会消失。<br>??注意：视图对应的语句只能是DQL语句，但是视图对象创建完成之后，可以对视图进行增删改查等操作。</p><p>??增删改查，又叫做：CRUD。CRUD是在公司中程序员之间沟通的术语，一般我们很少说增删改查，一般都说CRUD。</p><p>C：Create（增）<br>R：Retrive（查：检索）<br>U：Update（改）<br>D：Delete（删）</p><h1 id="DBA常用命令"><a href="#DBA常用命令" class="headerlink" title="DBA常用命令"></a>DBA常用命令</h1><p>只需要掌握:数据的导入和导出（数据的备份）。<br>其它命令了解一下即可。(使用其他用户之类的,到时候去查一查就好了)</p><h2 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出`"></a>数据导出`</h2><p><code>mysqldump bjpowernode emp&gt;D:\bjpowernode.sql -uroot -p123456</code></p><h2 id="数据导入："><a href="#数据导入：" class="headerlink" title="数据导入："></a>数据导入：</h2><p>注意：需要先登录到mysql数据库服务器上。<br>然后创建数据库：<code>create database bjpowernode;</code><br>使用数据库：<code>use bjpowernode</code><br>然后初始化数据库：<code>source D:\bjpowernode.sql</code></p><h1 id="数据库设计三范式"><a href="#数据库设计三范式" class="headerlink" title="数据库设计三范式"></a>数据库设计三范式</h1><p>数据库设计范式： 数据库表的设计依据，教我们怎么进行数据库表的设计。</p><p>第一范式： 要求任何一张表必须有主键，每一个字段原子性不可再分。<br>第二范式： 建立在第一范式的基础之上，要求所有非主键字段完全依赖主键，不要产生部分依赖。<br>第三范式： 建立在第二范式的基础之上，要求所有非主键字段直接依赖主键，不要产生传递依赖。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 数据库 </category>
          
          <category> 后端 </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Java后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>StringBuffer StringBuilder</title>
      <link href="/posts/2364755265.html"/>
      <url>/posts/2364755265.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="StringBuffer-and-StringBuilder"><a href="#StringBuffer-and-StringBuilder" class="headerlink" title="StringBuffer and StringBuilder"></a>StringBuffer and StringBuilder</h1><blockquote><p>这两个类在Java编程算法中比较常用</p></blockquote><p>当对字符串进行修改的时候，需要使用 StringBuffer 和 StringBuilder 类。<br>和 String 类不同的是，StringBuffer 和 StringBuilder 类的对象能够被多次的修改，并且不产生新的未使用对象。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-05-01%20224255.png" alt="图片"></p><p><strong>StringBuffer的主要方法和StringBuilder的几乎一样，注意考虑何时使用何方法即可</strong><br>在使用 StringBuffer 类时，每次都会对 StringBuffer 对象本身进行操作，而不是生成新的对象，所以如果需要对字符串进行修改推荐使用 StringBuffer。<br>StringBuilder 类在 Java 5 中被提出，它和 StringBuffer 之间的最大不同在于 StringBuilder 的方法不是线程安全的（不能同步访问）。<br>由于 StringBuilder 相较于 StringBuffer 有速度优势，所以多数情况下建议使用 StringBuilder 类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunoobTest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span>&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">10</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;Runoob..&quot;</span>);</span><br><span class="line">        System.out.println(sb);  </span><br><span class="line">        sb.append(<span class="string">&quot;!&quot;</span>);</span><br><span class="line">        System.out.println(sb); </span><br><span class="line">        sb.insert(<span class="number">8</span>, <span class="string">&quot;Java&quot;</span>);</span><br><span class="line">        System.out.println(sb); </span><br><span class="line">        sb.delete(<span class="number">5</span>,<span class="number">8</span>);</span><br><span class="line">        System.out.println(sb);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>然而在应用程序要求线程安全的情况下，则必须使用 StringBuffer 类。</strong></p><h2 id="StringBuilder的重要方法的代码尝试"><a href="#StringBuilder的重要方法的代码尝试" class="headerlink" title="StringBuilder的重要方法的代码尝试"></a>StringBuilder的重要方法的代码尝试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.String_Class;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 一个可变的字符序列。 此类提供与StringBuffer兼容的API，但不保证同步。</span></span><br><span class="line"><span class="comment"> *  此类设计用作StringBuffer替代品，用于单个线程使用字符串缓冲区的位置（通常情况下）。</span></span><br><span class="line"><span class="comment"> * 在可能的情况下，建议使用此类优先于StringBuffer因为在大多数实现中它会更快。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * StringBuilder上的主要操作是append和insert方法，它们被重载以便接受任何类型的数据。</span></span><br><span class="line"><span class="comment"> * 每个都有效地将给定的数据转换为字符串，然后将该字符串的字符追加或插入到字符串构建器中。</span></span><br><span class="line"><span class="comment"> *  append方法始终在构建器的末尾添加这些字符; insert方法在指定点添加字符。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringBuilderStudy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //todo 构造方法</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * StringBuilder()</span></span><br><span class="line"><span class="comment">         *                  构造一个字符串构建器，其中不包含任何字符，初始容量为16个字符。</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * StringBuilder(int capacity)</span></span><br><span class="line"><span class="comment">         *                  构造一个字符串构建器，其中没有字符，并且具有 capacity参数指定的初始容量。</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * StringBuilder(CharSequence seq)</span></span><br><span class="line"><span class="comment">         *                  构造一个字符串构建器，其中包含与指定的 CharSequence相同的字符。</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         *StringBuilder(String str)</span></span><br><span class="line"><span class="comment">         *                  构造一个初始化为指定字符串内容的字符串构建器。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        java.lang.<span class="type">StringBuilder</span> <span class="variable">sb1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        java.lang.<span class="type">StringBuilder</span> <span class="variable">sb2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * append为追加命令，可将东西（Boolean、long long等）转换为字符串</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        sb1.append(<span class="string">&quot;zhang&quot;</span>);</span><br><span class="line">        sb1.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        sb1.append(<span class="string">&quot;yon&quot;</span>);</span><br><span class="line">        sb1.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="type">char</span>[] chars = &#123;<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;i&#x27;</span>&#125;;</span><br><span class="line">        sb1.append(chars);</span><br><span class="line">        System.out.println(sb1);</span><br><span class="line">        System.out.println(sb1.capacity());<span class="comment">//*返回当前容量</span></span><br><span class="line">        System.out.println(sb1.charAt(<span class="number">0</span>));<span class="comment">//*返回下标为0的字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">testString1</span> <span class="operator">=</span> <span class="string">&quot;yon&quot;</span>;</span><br><span class="line">        System.out.println(sb1.indexOf(testString1));<span class="comment">//*返回指定子字符串第一次出现的字符串中的索引。</span></span><br><span class="line">        System.out.println(sb1.indexOf(testString1,<span class="number">5</span>));<span class="comment">//*从指定的索引处开始，返回指定子字符串第一次出现的字符串中的索引。</span></span><br><span class="line">        sb1.deleteCharAt(<span class="number">3</span>);<span class="comment">//*删除下标为3的元素</span></span><br><span class="line">        System.out.println(sb1);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * insert()是插入命令，第一个参数为插入位置，第二个参数为插入如元素，insert()必须要有第一个参数</span></span><br><span class="line"><span class="comment">         * 如果第一个参数为sb1.length()是和append()同样的效果</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        sb1.insert(<span class="number">3</span>,<span class="string">&#x27;n&#x27;</span>);<span class="comment">//*插入后，此插入字符在第三给下标的位置</span></span><br><span class="line">        System.out.println(sb1);</span><br><span class="line">        sb1.delete(<span class="number">8</span>,<span class="number">10</span>);<span class="comment">//*删除下标区间为[8,10]的元素</span></span><br><span class="line">        System.out.println(sb1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//*下面的比对可以看出 容量和长度不同，容量一般大于等于长度</span></span><br><span class="line">        System.out.println(sb1.capacity());</span><br><span class="line">        System.out.println(sb1.length());</span><br><span class="line">        sb1.trimToSize();<span class="comment">//*尝试减少用于字符序列的存储空间。</span></span><br><span class="line">        System.out.println(sb1.capacity());</span><br><span class="line">        System.out.println(sb1.length());</span><br><span class="line"></span><br><span class="line">        sb1.setCharAt(<span class="number">0</span>,<span class="string">&#x27;f&#x27;</span>);<span class="comment">//*将下标为0的位置的字符修改为f</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         todo 取子字符串</span></span><br><span class="line"><span class="comment">         * Stringsubstring(int start)</span></span><br><span class="line"><span class="comment">         *          返回一个新的 String ，其中包含此字符序列中当前包含的字符的子序列。</span></span><br><span class="line"><span class="comment">         * Stringsubstring(int start, int end)</span></span><br><span class="line"><span class="comment">         *          返回一个新的 String ，其中包含当前包含在此序列中的字符的子序列。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">testString2</span> <span class="operator">=</span> sb1.substring(<span class="number">4</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">testString3</span> <span class="operator">=</span> sb1.substring(<span class="number">4</span>,<span class="number">8</span>);</span><br><span class="line">        System.out.println(testString2);</span><br><span class="line">        System.out.println(testString3);</span><br><span class="line"></span><br><span class="line">        sb1.reverse();<span class="comment">//*导致此字符序列被序列的反向替换。</span></span><br><span class="line">        System.out.println(sb1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Set接口</title>
      <link href="/posts/3312011324.html"/>
      <url>/posts/3312011324.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="Set接口"><a href="#Set接口" class="headerlink" title="Set接口"></a>Set接口</h1><h2 id="基本介绍（实现Set接口的类的共性）"><a href="#基本介绍（实现Set接口的类的共性）" class="headerlink" title="基本介绍（实现Set接口的类的共性）"></a>基本介绍（实现Set接口的类的共性）</h2><ol><li>无序（添加和取出的顺序不一致，没有索引）</li><li>不允许有重复元素，所以最多包含一个null</li><li>实现接口的类很多，说明最常见的类</li><li>Set接口可List都是Collection的子接口，很多公有部分的方法都可以使用，建议先看一遍<a href="/posts/3546711884.html" title="集合">集合</a></li></ol><h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2><p><strong>以实现Set接口的类HashSet来演示Set接口的方法</strong><br>只有两种遍历方法，因为没有索引</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Set</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">    <span class="comment">//展示不能存放重复元素，顺序会变化(只是和添加进去的顺序不同，但是每次取出的顺序不会变)</span></span><br><span class="line">    set.add(<span class="string">&quot;john&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;lucy&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;john&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;mary&quot;</span>);</span><br><span class="line">    set.add(<span class="literal">null</span>);</span><br><span class="line">    set.add(<span class="literal">null</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;set: &quot;</span> + set);<span class="comment">//输出set: [null, mary, john, lucy, jack],看后面的输出会发现输出的顺序不会变</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历</span></span><br><span class="line">    <span class="comment">//方式1：使用迭代器</span></span><br><span class="line">    System.out.println(<span class="string">&quot;==使用迭代器遍历==&quot;</span>);</span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> set.iterator();</span><br><span class="line">    <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;obj: &quot;</span> + obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//方式2：使用增强for(因为增强for的底层实现实际上还是迭代器)</span></span><br><span class="line">    System.out.println(<span class="string">&quot;==使用增强for遍历==&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(Object obj : set)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;obj: &quot;</span> + obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他看文件<a href="/posts/3546711884.html" title="集合">集合</a></p><h3 id="主要实现类"><a href="#主要实现类" class="headerlink" title="主要实现类"></a>主要实现类</h3><ol><li><a href="/posts/1222166338.html" title="HashSet">HashSet</a></li><li><a href="/posts/570165348.html" title="LinkedHashSet">LinkedHashSet</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Map接口</title>
      <link href="/posts/3513711414.html"/>
      <url>/posts/3513711414.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="Map接口"><a href="#Map接口" class="headerlink" title="Map接口"></a>Map接口</h1><h2 id="常用Map接口实现类"><a href="#常用Map接口实现类" class="headerlink" title="常用Map接口实现类"></a>常用Map接口实现类</h2><ol><li>HashMap</li><li>Hashtable</li><li>Properties</li></ol><h3 id="HashMap小结"><a href="#HashMap小结" class="headerlink" title="HashMap小结"></a>HashMap小结</h3><ul><li>HashMap是Map接口使用频率最高的实现类</li><li>HashMap是以key-value对的方式来储存数据</li><li>key不能重复,但是值可以重复,允许使用null键和null值</li><li>如果添加相同的key,则会覆盖原来的key-value,等同于修改(key不会替换,val会替换)</li><li>与HashSet一样,不能保证映射的顺序,因为底层是以hash表的方式来储存的(jdk8的hashMap底层是 数组+链表+红黑树)</li><li>HashMap没有实现同步,因此是线程不安全的</li></ul><h2 id="Map接口实现类-都有的特点"><a href="#Map接口实现类-都有的特点" class="headerlink" title="Map接口实现类 都有的特点"></a>Map接口实现类 都有的特点</h2><p>以HashMap举例:</p><ol><li>Map与Collection并列存在。用于保存具有映射关系的数据：Key-Value(无序)</li><li>Map中的key和value可以是任何引用类型的数据，会封装到HashMap$Node对象中</li><li>Map中的key不允许重复，原因和HashSet一样（前面分析过源码）</li><li>Map中的key可以为null，value也可以为null，注意，key为null，只能有一个，value为null，可以为多个</li><li>常用String类作为Map的key</li><li>key和value之间存在单向一对一关系，即通过指定的key总能找到对应的value</li><li>一对k-v是放在一个HashMap$Node中的，因为Node实现了Entry的接口，有些书也说 一对k-v就是一个Entry<br> 自我总结：key影响位置，value是值，key相等表示在同一个位置</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Map_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        1. Map与Collection并列存在。用于保存具有映射关系的数据：Key-Value(无序)</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;no.1&quot;</span>,<span class="string">&quot;牛逼&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;no.2&quot;</span>,<span class="string">&quot;牛人&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;map= &quot;</span> + map);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2. Map中的key和value可以是任何引用类型的数据，会封装到HashMap$Node对象中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        3. Map中的key不允许重复，原因和HashSet一样（前面分析过源码）</span></span><br><span class="line">        map.put(<span class="string">&quot;no.1&quot;</span>,<span class="string">&quot;小狗&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;map= &quot;</span> + map);<span class="comment">//可以看出当key相等的时候就相当于是替换value</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        4. Map中的key可以为null，value也可以为null，注意，key为null，只能有一个，value为null，可以为多个</span></span><br><span class="line">        map.put(<span class="literal">null</span>,<span class="string">&quot;小牛&quot;</span>);</span><br><span class="line">        map.put(<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">        map.put(<span class="string">&quot;no.3&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;map= &quot;</span> + map);<span class="comment">//因为多个key为null，既然都是null那么这几个的位置都相同，就会被替换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        5. 常用String类作为Map的key//本例中基本上都是用到String类作为key（key可以为任何类型）</span></span><br><span class="line"><span class="comment">//        6. key和value之间存在单向一对一关系，即通过指定的key总能找到对应的value</span></span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;no.2&quot;</span>));<span class="comment">//&quot;no.2&quot;是key，key相当于是位置，等价于数组中的下标，所以可以类似得到对应位置的值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapSource_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;no1&quot;</span>, <span class="string">&quot;韩顺平&quot;</span>);<span class="comment">//k-v</span></span><br><span class="line">        map.put(<span class="string">&quot;no2&quot;</span>, <span class="string">&quot;张无忌&quot;</span>);<span class="comment">//k-v</span></span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Car</span>(), <span class="keyword">new</span> <span class="title class_">Person</span>());<span class="comment">//k-v</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1. k-v 最后是 HashMap$Node node = newNode(hash, key, value, null)</span></span><br><span class="line">        <span class="comment">//2. k-v 为了方便程序员的遍历，还会 创建 EntrySet 集合 ，该集合存放的元素的类型 Entry, 而一个Entry</span></span><br><span class="line">        <span class="comment">//   对象就有k,v EntrySet&lt;Entry&lt;K,V&gt;&gt; 即： transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span></span><br><span class="line">        <span class="comment">//3. entrySet 中， 定义的类型是 Map.Entry ，但是实际上存放的还是 HashMap$Node</span></span><br><span class="line">        <span class="comment">//   这时因为 static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt;</span></span><br><span class="line">        <span class="comment">//4. 当把 HashMap$Node 对象 存放到 entrySet 就方便我们的遍历, 因为 Map.Entry 提供了重要方法</span></span><br><span class="line">        <span class="comment">//   K getKey(); V getValue();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Set</span> <span class="variable">set</span> <span class="operator">=</span> map.entrySet();</span><br><span class="line">        System.out.println(set.getClass());<span class="comment">// HashMap$EntrySet</span></span><br><span class="line">        <span class="keyword">for</span> (Object obj : set) &#123;</span><br><span class="line">            <span class="comment">//System.out.println(obj.getClass()); //HashMap$Node</span></span><br><span class="line">            <span class="comment">//为了从 HashMap$Node 取出k-v</span></span><br><span class="line">            <span class="comment">//1. 先做一个向下转型</span></span><br><span class="line">            Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) obj;</span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot;-&quot;</span> + entry.getValue() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Set</span> <span class="variable">set1</span> <span class="operator">=</span> map.keySet();</span><br><span class="line">        System.out.println(set1.getClass());</span><br><span class="line">        <span class="type">Collection</span> <span class="variable">values</span> <span class="operator">=</span> map.values();</span><br><span class="line">        System.out.println(values.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><h3 id="方法列举"><a href="#方法列举" class="headerlink" title="方法列举"></a>方法列举</h3><ol><li>put():添加</li><li>remove():根据键删除映射关系</li><li>get():根据键获取值</li><li>size():获取元素个数</li><li>isEmpty():判断个数是否为0</li><li>clear():清除</li><li>containsKey():查找键是否存在</li><li>containsValue():查找值是否存在</li></ol><h3 id="代码尝试"><a href="#代码尝试" class="headerlink" title="代码尝试"></a>代码尝试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapMethod_</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//演示Map常用方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        1. put():添加 返回类型是Object</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;邓超&quot;</span>,<span class="string">&quot;孙俪&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;牛逼&quot;</span>,<span class="string">&quot;小牛人&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;牛逼&quot;</span>,<span class="string">&quot;大牛人&quot;</span>);<span class="comment">//演示替换</span></span><br><span class="line">        map.put(<span class="string">&quot;zyr&quot;</span>,<span class="string">&quot;fengweng&quot;</span>);</span><br><span class="line">        map.put(<span class="literal">null</span>,<span class="string">&quot;单身狗&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;book&quot;</span>,<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;无&quot;</span>,<span class="number">100</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;map= &quot;</span> + map);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2. remove():根据键删除映射关系</span></span><br><span class="line">        map.remove(<span class="string">&quot;邓超&quot;</span>);<span class="comment">//删除key为&quot;邓超&quot;的一对k-v</span></span><br><span class="line">        System.out.println(<span class="string">&quot;map= &quot;</span> + map);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        3. get():根据键获取值,返回Object类型,只能是Object类型(可直接输出)</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">v</span> <span class="operator">=</span> map.get(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;key=null对应value: &quot;</span> + v);</span><br><span class="line">        System.out.println(<span class="string">&quot;key=zyr对应value: &quot;</span> + map.get(<span class="string">&quot;zyr&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        4. size():获取元素个数,返回值是int类型</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> map.size();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">map1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map1.put(<span class="string">&quot;测试&quot;</span>,<span class="string">&quot;个数&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;map.size() = &quot;</span> + num);</span><br><span class="line">        System.out.println(<span class="string">&quot;map1.size() = &quot;</span> + map1.size());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        5. isEmpty():判断个数是否为0,返回值是boolean类型</span></span><br><span class="line"><span class="comment">//        6. clear():清除(将所有内容都删除)，返回类型是void</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">is</span> <span class="operator">=</span> map.isEmpty();</span><br><span class="line">        map1.clear();<span class="comment">//清空map1</span></span><br><span class="line">        System.out.println(<span class="string">&quot;map.isEmpty() = &quot;</span> + is);</span><br><span class="line">        System.out.println(<span class="string">&quot;map1.isEmpty() = &quot;</span> + map1.isEmpty());</span><br><span class="line"></span><br><span class="line"><span class="comment">//        7. containsKey():查找键是否存在,返回类型是boolean</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ck</span> <span class="operator">=</span> map.containsKey(<span class="string">&quot;zyr&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;map.containsKey(\&quot;zyr\&quot;) = &quot;</span> + ck);</span><br><span class="line">        System.out.println(<span class="string">&quot;map.containsKey(\&quot;没有的键\&quot;) = &quot;</span> + map.containsKey(<span class="string">&quot;没有的键&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        8.containsValue():查找值是否存在，返回类型是boolean</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">cv</span> <span class="operator">=</span> map.containsValue(<span class="string">&quot;fengweng&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;map.containsValue(\&quot;fengewng\&quot;) = &quot;</span> + cv);</span><br><span class="line">        System.out.println(<span class="string">&quot;map.containsVaule(\&quot;没有的值\&quot;) = &quot;</span> + map.containsValue(<span class="string">&quot;没有的值&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Book</span><span class="params">(String name, <span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Book&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, num=&quot;</span> + num +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="输出展示"><a href="#输出展示" class="headerlink" title="输出展示"></a>输出展示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">map= &#123;邓超=孙俪, <span class="literal">null</span>=单身狗, zyr=fengweng, book=Book&#123;name=<span class="string">&#x27;无&#x27;</span>, num=<span class="number">100</span>&#125;, 牛逼=大牛人&#125;</span><br><span class="line">map= &#123;<span class="literal">null</span>=单身狗, zyr=fengweng, book=Book&#123;name=<span class="string">&#x27;无&#x27;</span>, num=<span class="number">100</span>&#125;, 牛逼=大牛人&#125;</span><br><span class="line">key=<span class="literal">null</span>对应value: 单身狗</span><br><span class="line">key=zyr对应value: fengweng</span><br><span class="line">map.size() = <span class="number">4</span></span><br><span class="line">map1.size() = <span class="number">1</span></span><br><span class="line">map.isEmpty() = <span class="literal">false</span></span><br><span class="line">map1.isEmpty() = <span class="literal">true</span></span><br><span class="line">map.containsKey(<span class="string">&quot;zyr&quot;</span>) = <span class="literal">true</span></span><br><span class="line">map.containsKey(<span class="string">&quot;没有的键&quot;</span>) = <span class="literal">false</span></span><br><span class="line">map.containsValue(<span class="string">&quot;fengweng&quot;</span>) = <span class="literal">true</span></span><br><span class="line">map.containsVaule(<span class="string">&quot;没有的值&quot;</span>) = <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="Map六大遍历方式"><a href="#Map六大遍历方式" class="headerlink" title="Map六大遍历方式"></a>Map六大遍历方式</h2><ol><li>containsKey():查找键的方式</li><li>containsValue():查找值的方式</li><li>keySet():获取所有值v</li><li>entrySet():获取所有关系k-v</li><li>values():获取所有值v</li><li>key():获取所有键k</li></ol><h3 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h3><p>只展示了较复杂的遍历情况</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Map_traversal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//将六大遍历方式</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建待遍历map</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;邓超&quot;</span>,<span class="string">&quot;孙俪&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;牛逼&quot;</span>,<span class="string">&quot;牛人&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;zyr&quot;</span>,<span class="string">&quot;fengweng&quot;</span>);</span><br><span class="line">        map.put(<span class="literal">null</span>,<span class="string">&quot;单身狗&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        3. keySet():获取所有值v</span></span><br><span class="line">        <span class="comment">//先取出所有的key，通过key取出对应的value (Set)</span></span><br><span class="line">        <span class="type">Set</span> <span class="variable">kset</span> <span class="operator">=</span> map.keySet();</span><br><span class="line">        <span class="comment">//Set又有两种遍历方式</span></span><br><span class="line">        <span class="comment">//(1)增强for</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----keySet()增强for----&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(Object o : kset)&#123;</span><br><span class="line">            System.out.println(o + <span class="string">&quot;-&quot;</span> + map.get(o));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//(2)迭代器</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----keySet()迭代器----&quot;</span>);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> kset.iterator();</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            <span class="comment">//System.out.println(iterator.next() + &quot;-&quot; + map.get(iterator.next()));//这样些有问题，两次next()</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">ob</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(ob + <span class="string">&quot;-&quot;</span> + map.get(ob));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        4. entrySet():获取所有关系k-v</span></span><br><span class="line">        <span class="type">Set</span> <span class="variable">entrySet</span> <span class="operator">=</span> map.entrySet();</span><br><span class="line">        <span class="comment">//(1)增强for</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----entrySet()增强for----&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(Object entry : entrySet) &#123;</span><br><span class="line">            Map.<span class="type">Entry</span> <span class="variable">m</span> <span class="operator">=</span> (Map.Entry) entry;<span class="comment">//要先转型</span></span><br><span class="line">            System.out.println(m.getKey() + <span class="string">&quot;-&quot;</span> + m.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//(2)迭代器</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----entrySet()迭代器----&quot;</span>);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator2</span> <span class="operator">=</span> entrySet.iterator();</span><br><span class="line">        <span class="keyword">while</span>(iterator2.hasNext())&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">next</span> <span class="operator">=</span> iterator2.next();</span><br><span class="line"><span class="comment">//            System.out.println(next + &quot;-&quot; + map.get(next));//这一句也可输出</span></span><br><span class="line">            Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) next;<span class="comment">//要先转型</span></span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot;-&quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        5. values():获取所有值v</span></span><br><span class="line">        <span class="comment">//先把所有values取出来(Collection)</span></span><br><span class="line">        <span class="type">Collection</span> <span class="variable">vcol</span> <span class="operator">=</span> map.values();</span><br><span class="line">        <span class="comment">//Collection有两种遍历方式</span></span><br><span class="line">        <span class="comment">//(1)增强for</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----values()增强for----&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(Object o : vcol)&#123;<span class="comment">//冒号后面其实也可以直接式map.values()</span></span><br><span class="line">            System.out.println(o + <span class="string">&quot;-&quot;</span> + map.get(o));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//(2)迭代器(省略)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vector</title>
      <link href="/posts/482495853.html"/>
      <url>/posts/482495853.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><ul><li>Vector底层也是一个对象数组，<code>protected Object[] elementData;</code></li><li>Vector是线程同步的，即线程安全的，Vector类的操作方法带有  <code>synchronized</code>关键字，即：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(indexx &gt;= elementCount) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ArrayIndexOutOfBoundsException</span>(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> elementDate(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在开发中，需要线程同步安全时，考虑使用Vector</li></ul><h2 id="与ArrayList比较"><a href="#与ArrayList比较" class="headerlink" title="与ArrayList比较"></a>与ArrayList比较</h2><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">底层结构</th><th style="text-align:center">版本</th><th style="text-align:center">线程安全（同步）效率</th><th style="text-align:center">扩容倍速</th></tr></thead><tbody><tr><td style="text-align:center">ArrayList</td><td style="text-align:center">可变数组</td><td style="text-align:center">jdk1.2</td><td style="text-align:center">不安全，效率高</td><td style="text-align:center">如果是有参构造器就扩容1.5倍；如果是无参，第一次讲容量设为10，从第二次开始就扩容1.5倍</td></tr><tr><td style="text-align:center">Vector</td><td style="text-align:center">可变数组Object[]</td><td style="text-align:center">jdk1.0</td><td style="text-align:center">安全，效率不高</td><td style="text-align:center">如果是无参，默认容量为10，满后，就按2倍扩容；如果指定大小，则每次直接2被扩容</td></tr></tbody></table></div><h2 id="看源码"><a href="#看源码" class="headerlink" title="看源码"></a>看源码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//无参构造器</span></span><br><span class="line">    <span class="comment">//有参数的构造</span></span><br><span class="line">    <span class="type">Vector</span> <span class="variable">vector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vector</span>(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        vector.add(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;vector=&quot;</span> + vector)</span><br><span class="line">    <span class="comment">//1. new Vector() 底层</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        public Vector() &#123;</span></span><br><span class="line"><span class="comment">        this(10);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        补充：如果是 Vector vector = new Vector(8);</span></span><br><span class="line"><span class="comment">        走的方法:</span></span><br><span class="line"><span class="comment">        public Vector(int initialCapacity) &#123;</span></span><br><span class="line"><span class="comment">        this(initialCapacity, 0);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        2. vector.add(i)</span></span><br><span class="line"><span class="comment">        2.1 //下面这个方法就添加数据到 vector 集合</span></span><br><span class="line"><span class="comment">        public synchronized boolean add(E e) &#123;</span></span><br><span class="line"><span class="comment">        modCount++;</span></span><br><span class="line"><span class="comment">        ensureCapacityHelper(elementCount + 1);</span></span><br><span class="line"><span class="comment">        elementData[elementCount++] = e;</span></span><br><span class="line"><span class="comment">        return true;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        2.2 //确定是否需要扩容 条件 ： minCapacity - elementData.length&gt;0</span></span><br><span class="line"><span class="comment">        private void ensureCapacityHelper(int minCapacity) &#123;</span></span><br><span class="line"><span class="comment">        // overflow-conscious code</span></span><br><span class="line"><span class="comment">        if (minCapacity - elementData.length &gt; 0</span></span><br><span class="line"><span class="comment">        grow(minCapacity);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        2.3 //如果 需要的数组大小 不够用，就扩容 , 扩容的算法</span></span><br><span class="line"><span class="comment">        //newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ?</span></span><br><span class="line"><span class="comment">        // capacityIncrement : oldCapacity);</span></span><br><span class="line"><span class="comment">        //就是扩容两倍. private void grow(int minCapacity) &#123;</span></span><br><span class="line"><span class="comment">        // overflow-conscious code</span></span><br><span class="line"><span class="comment">        int oldCapacity = elementData.length;</span></span><br><span class="line"><span class="comment">        int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ?</span></span><br><span class="line"><span class="comment">        capacityIncrement : oldCapacity);</span></span><br><span class="line"><span class="comment">        if (newCapacity - minCapacity &lt; 0)</span></span><br><span class="line"><span class="comment">        newCapacity = minCapacity;</span></span><br><span class="line"><span class="comment">        if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span></span><br><span class="line"><span class="comment">        newCapacity = hugeCapacity(minCapacity);</span></span><br><span class="line"><span class="comment">        elementData = Arrays.copyOf(elementData, newCapacity);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>List接口</title>
      <link href="/posts/1168613674.html"/>
      <url>/posts/1168613674.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="List接口"><a href="#List接口" class="headerlink" title="List接口"></a>List接口</h1><h2 id="List接口的介绍"><a href="#List接口的介绍" class="headerlink" title="List接口的介绍"></a>List接口的介绍</h2><p>List接口是Collection的子接口</p><ol><li>List集合类中的元素有序（即添加顺序和取出顺序一致）、且可重复</li><li>List集合类中的每个元素都有其对应的顺序索引，即支持索引(List特点)</li><li>List容器中的元素都对应一个整数型的序号记载其在容器中的位置，可以根据序号存取容器中的元素</li><li>常见的实现类有：ArrayList、LinkedList、Vector（基本一样，很多都有的方法，例如add,remove,set等）</li></ol><h2 id="选择使用"><a href="#选择使用" class="headerlink" title="选择使用"></a>选择使用</h2><ul><li>ArrayList效率高，但多线程的时候不安全，在非多线程的情况下使用ArrayList更好</li><li>Vector线程安全，在多线程情况下考虑用Vector更好</li><li>LinkedList增删效率最高，因为底层不是用数组实现的，线程也不安全</li></ul><h3 id="ArrayList与Vector比较"><a href="#ArrayList与Vector比较" class="headerlink" title="ArrayList与Vector比较"></a>ArrayList与Vector比较</h3><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">底层结构</th><th style="text-align:center">版本</th><th style="text-align:center">线程安全（同步）效率</th><th style="text-align:center">扩容倍速</th></tr></thead><tbody><tr><td style="text-align:center">ArrayList</td><td style="text-align:center">可变数组</td><td style="text-align:center">jdk1.2</td><td style="text-align:center">不安全，效率高</td><td style="text-align:center">如果是有参构造器就扩容1.5倍；如果是无参，第一次讲容量设为10，从第二次开始就扩容1.5倍</td></tr><tr><td style="text-align:center">Vector</td><td style="text-align:center">可变数组Object[]</td><td style="text-align:center">jdk1.0</td><td style="text-align:center">安全，效率不高</td><td style="text-align:center">如果是无参，默认容量为10，满后，就按2倍扩容；如果指定大小，则每次直接2被扩容</td></tr></tbody></table></div><h3 id="ArrayList与LinkedList比较"><a href="#ArrayList与LinkedList比较" class="headerlink" title="ArrayList与LinkedList比较"></a>ArrayList与LinkedList比较</h3><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">底层结构</th><th style="text-align:center">增删的效率</th><th style="text-align:center">改查效率</th></tr></thead><tbody><tr><td style="text-align:center">ArrayList</td><td style="text-align:center">可变数组</td><td style="text-align:center">较低，需要数组扩容</td><td style="text-align:center">较高，直接改下标位置值</td></tr><tr><td style="text-align:center">LinkedList</td><td style="text-align:center">双向链表</td><td style="text-align:center">较高，通过链表追加，不需要扩容</td><td style="text-align:center">较低，需要再建立连接等操作</td></tr></tbody></table></div><p>所以改查多用ArrayList，改查少用LinkedList<br>一般来说改查用到都多，一般都是ArrayList</p><h2 id="List常用方法介绍"><a href="#List常用方法介绍" class="headerlink" title="List常用方法介绍"></a>List常用方法介绍</h2><h3 id="常用方法："><a href="#常用方法：" class="headerlink" title="常用方法："></a>常用方法：</h3><ul><li>void add(int index, Object ele):在 index 位置插入 ele 元素</li><li>boolean addAll(int index, Collection eles):从 index 位置开始将 eles 中的所有元素添加进来</li><li>Object get(int index):获取指定 index 位置的元素</li><li>int indexOf(Object obj):返回 obj 在集合中首次出现的位置</li><li>int lastIndexOf(Object obj):返回 obj 在当前集合中末次出现的位置</li><li>Object remove(int index):移除指定 index 位置的元素，并返回此元素</li><li>Object set(int index, Object ele):设置指定 index 位置的元素为 ele , 相当于是替换. list.set(1, “玛丽”);</li><li>List subList(int fromIndex, int toIndex):返回从 fromIndex 到 toIndex 位置的子集合</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    list.add(<span class="string">&quot;张三丰&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;贾宝玉&quot;</span>);</span><br><span class="line">    <span class="comment">// void add(int index, Object ele):在 index 位置插入 ele 元素</span></span><br><span class="line">    <span class="comment">//在 index = 1 的位置插入一个对象</span></span><br><span class="line">    list.add(<span class="number">1</span>, <span class="string">&quot;牛人&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;list=&quot;</span> + list);</span><br><span class="line">    <span class="comment">// boolean addAll(int index, Collection eles):从 index 位置开始将 eles 中的所有元素添加进来</span></span><br><span class="line">    <span class="type">List</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    list2.add(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">    list2.add(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">    list.addAll(<span class="number">1</span>, list2);</span><br><span class="line">    System.out.println(<span class="string">&quot;list=&quot;</span> + list);</span><br><span class="line">    <span class="comment">// Object get(int index):获取指定 index 位置的元素</span></span><br><span class="line">    <span class="comment">//说过</span></span><br><span class="line">    <span class="comment">// int indexOf(Object obj):返回 obj 在集合中首次出现的位置</span></span><br><span class="line">    System.out.println(list.indexOf(<span class="string">&quot;tom&quot;</span>));<span class="comment">//2</span></span><br><span class="line">    <span class="comment">// int lastIndexOf(Object obj):返回 obj 在当前集合中末次出现的位置</span></span><br><span class="line">    list.add(<span class="string">&quot;牛人&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;list=&quot;</span> + list);</span><br><span class="line">    System.out.println(list.lastIndexOf(<span class="string">&quot;牛人&quot;</span>));</span><br><span class="line">    <span class="comment">// Object remove(int index):移除指定 index 位置的元素，并返回此元素</span></span><br><span class="line">    list.remove(<span class="number">0</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;list=&quot;</span> + list);</span><br><span class="line">    <span class="comment">// Object set(int index, Object ele):设置指定 index 位置的元素为 ele , 相当于是替换. list.set(1, &quot;玛丽&quot;);</span></span><br><span class="line">    System.out.println(<span class="string">&quot;list=&quot;</span> + list);</span><br><span class="line">    <span class="comment">// List subList(int fromIndex, int toIndex):返回从 fromIndex 到 toIndex 位置的子集合</span></span><br><span class="line">    <span class="comment">// 注意返回的子集合 fromIndex &lt;= subList</span></span><br><span class="line">    <span class="type">List</span> <span class="variable">returnlist</span> <span class="operator">=</span> list.subList(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;returnlist=&quot;</span> + returnlist);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用普通for遍历输出"><a href="#使用普通for遍历输出" class="headerlink" title="使用普通for遍历输出"></a>使用普通for遍历输出</h2><p>由于List有<strong>索引</strong>的特点索引可以有第三种遍历输出方式(实现了List的类都可以)<br>第一种为迭代器输出，第二种为增强for循环输出（底层还是迭代器输出），具体看文章<a href="/posts/3546711884.html" title="集合">集合</a></p><h3 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;list.size();i++)&#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">    System.out.println(object);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="常用类解析"><a href="#常用类解析" class="headerlink" title="常用类解析"></a>常用类解析</h2><ol><li><a href="/posts/1219920510.html" title="ArrayList">ArrayList</a></li><li><a href="/posts/482495853.html" title="Vector">Vector</a></li><li><a href="/posts/707384687.html" title="LinkedList">LinkedList</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinkedList</title>
      <link href="/posts/707384687.html"/>
      <url>/posts/707384687.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><ol><li>LinkedList 底层实现了双向链表和双端队列</li><li>可以添加任意元素（元素可以重复），包括null</li><li>线程不安全，没有实现同步</li></ol><h2 id="LinkedList-底层结构"><a href="#LinkedList-底层结构" class="headerlink" title="LinkedList 底层结构"></a>LinkedList 底层结构</h2><ol><li>底层维护了一个双向链表</li><li>维护了两个属性first和last分别指向 首节点和尾节点</li><li>每个节点（Node对象），里面又维护了prev、next、item三个属性，其中通过prev指向前一个，通过next指向后一个节点。最终实现双向链表。</li><li>所以LinkedList的元素的添加和删除，不是通过数组完成的，相对来说效率较高</li><li>模拟一个简单的双向链表</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.list_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jdk.nashorn.internal.objects.annotations.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList_01</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   <span class="comment">//模拟一个简单的双向链表(只是最简单的)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//先创建三个对象</span></span><br><span class="line">   <span class="type">Node</span> <span class="variable">jack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">   <span class="type">Node</span> <span class="variable">niuren</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="string">&quot;牛人&quot;</span>);</span><br><span class="line">   <span class="type">Node</span> <span class="variable">tom</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//将三个对象链接起来成为双向链表</span></span><br><span class="line">   <span class="comment">//先形成jack-&gt;tom-&gt;niuren的单向链表</span></span><br><span class="line">   jack.next = tom;</span><br><span class="line">   tom.next = niuren;</span><br><span class="line">   <span class="comment">//在形成jack&lt;-tom&lt;-niuren的链表，相当于就是双向了</span></span><br><span class="line">   niuren.pre = tom;</span><br><span class="line">   tom.pre = jack;</span><br><span class="line"></span><br><span class="line">   <span class="type">Node</span> <span class="variable">first</span> <span class="operator">=</span> jack;<span class="comment">//让first应用指向jack，就是双向链表的头结点</span></span><br><span class="line">   <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> niuren;<span class="comment">//让last引用指向niuren，就是双向链表的尾结点</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//演示从头到尾遍历</span></span><br><span class="line">   System.out.println(<span class="string">&quot;====从头到尾遍历====&quot;</span>);</span><br><span class="line">   <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">       <span class="keyword">if</span>(first == <span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//输出first的信息</span></span><br><span class="line">      System.out.println(first);</span><br><span class="line">       first = first.next;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//演示从尾到头遍历</span></span><br><span class="line">   System.out.println(<span class="string">&quot;====从尾到头遍历====&quot;</span>);</span><br><span class="line">   <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">       <span class="keyword">if</span>(last == <span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//输出last的值</span></span><br><span class="line">       System.out.println(last);</span><br><span class="line">       last = last.pre;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//演示插入节点</span></span><br><span class="line">   <span class="comment">//先创建一个节点，插入到tom和niuren之间</span></span><br><span class="line">   <span class="type">Node</span> <span class="variable">smith</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="string">&quot;smith&quot;</span>);</span><br><span class="line">   tom.next = smith;</span><br><span class="line">   smith.next = niuren;</span><br><span class="line">   niuren.pre = smith;</span><br><span class="line">   smith.pre = tom;</span><br><span class="line">   <span class="comment">//遍历输出，就只展示从头到尾了，从尾到头很类似</span></span><br><span class="line">   <span class="comment">//之前的first已经移动过了，所以先要再次指向头部（jack）</span></span><br><span class="line">   System.out.println(<span class="string">&quot;====插入新结点后遍历====&quot;</span>);</span><br><span class="line">   first = jack;</span><br><span class="line">   <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">       <span class="keyword">if</span>(first == <span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(first);</span><br><span class="line">       first = first.next;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//演示删除结点</span></span><br><span class="line">   <span class="comment">//删除tom</span></span><br><span class="line">   jack.next = smith;</span><br><span class="line">   smith.pre = jack;</span><br><span class="line">   tom = <span class="literal">null</span>;</span><br><span class="line">   <span class="comment">//遍历输出，就只展示从头到尾了，从尾到头很类似</span></span><br><span class="line">   <span class="comment">//之前的first已经移动过了，所以先要再次指向头部（jack）</span></span><br><span class="line">   System.out.println(<span class="string">&quot;====删除结点后遍历====&quot;</span>);</span><br><span class="line">   first = jack;</span><br><span class="line">   <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">       <span class="keyword">if</span>(first == <span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(first);</span><br><span class="line">       first = first.next;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义一个Node类，，Node 对象 表示双向链表的一个节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>&#123;</span><br><span class="line"><span class="keyword">public</span> Object item;<span class="comment">//真正的数据</span></span><br><span class="line"><span class="keyword">public</span> Node next;<span class="comment">//指向下一个节点(相当于指针)</span></span><br><span class="line"><span class="keyword">public</span> Node pre;<span class="comment">//指向前一个节点(相当于指针)</span></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span>  <span class="title function_">Node</span><span class="params">(Object name)</span>&#123;</span><br><span class="line">   <span class="built_in">this</span>.item = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;Node name=&quot;</span> + item;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LinkedList-的增删改查案例"><a href="#LinkedList-的增删改查案例" class="headerlink" title="LinkedList 的增删改查案例"></a>LinkedList 的增删改查案例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hspedu.list_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListCRUD</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建LinkedList</span></span><br><span class="line">        <span class="type">LinkedList</span> <span class="variable">linkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        linkedList.add(<span class="number">1</span>);</span><br><span class="line">        linkedList.add(<span class="number">2</span>);</span><br><span class="line">        linkedList.add(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;linkedList=&quot;</span> + linkedList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//演示一个删除结点的</span></span><br><span class="line">        linkedList.remove(); <span class="comment">// 这里默认删除的是第一个结点</span></span><br><span class="line">        <span class="comment">//linkedList.remove(2);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;linkedList=&quot;</span> + linkedList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改某个结点对象</span></span><br><span class="line">        linkedList.set(<span class="number">1</span>, <span class="number">999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;linkedList=&quot;</span> + linkedList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到某个结点对象</span></span><br><span class="line">        <span class="comment">//get(1) 是得到双向链表的第二个对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> linkedList.get(<span class="number">1</span>);</span><br><span class="line">        System.out.println(o);<span class="comment">//999</span></span><br><span class="line">        <span class="comment">//因为 LinkedList 是 实现了 List 接口, 遍历方式</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;===LinkeList 遍历迭代器====&quot;</span>);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> linkedList.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(<span class="string">&quot;next=&quot;</span> + next);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;===LinkeList 遍历增强 for====&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object o1 : linkedList) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;o1=&quot;</span> + o1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;===LinkeList 遍历普通 for====&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; linkedList.size(); i++) &#123;</span><br><span class="line">            System.out.println(linkedList.get(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//源码及解析：</span></span><br><span class="line">        <span class="comment">/* 1. LinkedList linkedList = new LinkedList();</span></span><br><span class="line"><span class="comment">            public LinkedList() &#123;&#125;</span></span><br><span class="line"><span class="comment">            2. 这时 linkeList 的属性 first = null last</span></span><br><span class="line"><span class="comment">            3. 执行 添加</span></span><br><span class="line"><span class="comment">            public boolean add(E e) &#123;</span></span><br><span class="line"><span class="comment">                linkLast(e);</span></span><br><span class="line"><span class="comment">                return true;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            4.将新的结点，加入到双向链表的最后</span></span><br><span class="line"><span class="comment">            void linkLast(E e) &#123;</span></span><br><span class="line"><span class="comment">                final Node&lt;E&gt; l = last;</span></span><br><span class="line"><span class="comment">                final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);</span></span><br><span class="line"><span class="comment">                last = newNode;</span></span><br><span class="line"><span class="comment">                if (l == null)</span></span><br><span class="line"><span class="comment">                first = newNode;</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                l.next = newNode;</span></span><br><span class="line"><span class="comment">                size++;</span></span><br><span class="line"><span class="comment">                modCount++;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            linkedList.remove(); // 这里默认删除的是第一个结点</span></span><br><span class="line"><span class="comment">            1. 执行 removeFirst</span></span><br><span class="line"><span class="comment">            public E remove() &#123;</span></span><br><span class="line"><span class="comment">                return removeFirst();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            2. 执行</span></span><br><span class="line"><span class="comment">            public E removeFirst() &#123;</span></span><br><span class="line"><span class="comment">                final Node&lt;E&gt; f = first;</span></span><br><span class="line"><span class="comment">                if (f == null)</span></span><br><span class="line"><span class="comment">                    throw new NoSuchElementException();</span></span><br><span class="line"><span class="comment">                return unlinkFirst(f);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            3. 执行 unlinkFirst, 将 f 指向的双向链表的第一个结点拿掉</span></span><br><span class="line"><span class="comment">            private E unlinkFirst(Node&lt;E&gt; f) &#123;</span></span><br><span class="line"><span class="comment">                // assert f == first &amp;&amp; f != null;</span></span><br><span class="line"><span class="comment">                final E element = f.item;</span></span><br><span class="line"><span class="comment">                final Node&lt;E&gt; next = f.next;</span></span><br><span class="line"><span class="comment">                f.item = null;</span></span><br><span class="line"><span class="comment">                f.next = null; // help GC</span></span><br><span class="line"><span class="comment">                first = next;</span></span><br><span class="line"><span class="comment">                if (next == null)</span></span><br><span class="line"><span class="comment">                    last = null;</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                    next.prev = null;</span></span><br><span class="line"><span class="comment">                size--;</span></span><br><span class="line"><span class="comment">                modCount++;</span></span><br><span class="line"><span class="comment">                return element;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="特殊点"><a href="#特殊点" class="headerlink" title="特殊点"></a>特殊点</h2><p>remove有三种，可选择下标删除，可选择指定对象删除<br>第三种，没有参数，默认删除最后一个元素</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinkedHashSet</title>
      <link href="/posts/570165348.html"/>
      <url>/posts/570165348.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><ul><li>LinkedHashSet继承了HashSet</li><li>LinkedHashSet的底层是一个LinkedHashMap(HashMap的一个子类),底层维护了一个 数组+==双向==链表（不同索引上的元素构成这个双向链表，即所有元素来形成链表，而不是在单个索引的范围内相互形成链表）</li><li>LinkedHashSet根据元素的hashCode值来决定元素的储存位置，同时使用链表来维护元素的次序，这使得元素看起来是以插入排序保存的（加入顺序和取出顺序相同）。==有顺序就是LinkedHashMap的优点==</li><li>LinkedHashSet也是Set接口实现类所以也不允许有重复的元素</li></ul><h2 id="实践尝试"><a href="#实践尝试" class="headerlink" title="实践尝试"></a>实践尝试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Car 类(属性:name,price)，  如果 name 和 price 一样，</span></span><br><span class="line"><span class="comment"> * 则认为是相同元素，就不能添加。 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedHashSetExercise</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">LinkedHashSet</span> <span class="variable">linkedHashSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>();</span><br><span class="line">        linkedHashSet.add(<span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;奥拓&quot;</span>, <span class="number">1000</span>));<span class="comment">//OK</span></span><br><span class="line">        linkedHashSet.add(<span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;奥迪&quot;</span>, <span class="number">300000</span>));<span class="comment">//OK</span></span><br><span class="line">        linkedHashSet.add(<span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;法拉利&quot;</span>, <span class="number">10000000</span>));<span class="comment">//OK</span></span><br><span class="line">        linkedHashSet.add(<span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;奥迪&quot;</span>, <span class="number">300000</span>));<span class="comment">//加入不了</span></span><br><span class="line">        linkedHashSet.add(<span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;保时捷&quot;</span>, <span class="number">70000000</span>));<span class="comment">//OK</span></span><br><span class="line">        linkedHashSet.add(<span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;奥迪&quot;</span>, <span class="number">300000</span>));<span class="comment">//加入不了</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;linkedHashSet=&quot;</span> + linkedHashSet);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(String name, <span class="type">double</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\nCar&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, price=&quot;</span> + price +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写equals 方法 和 hashCode</span></span><br><span class="line">    <span class="comment">//当 name 和 price 相同时， 就返回相同的 hashCode 值, equals返回t</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> (Car) o;</span><br><span class="line">        <span class="keyword">return</span> Double.compare(car.price, price) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                Objects.equals(name, car.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(name, price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedHashSetSource</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//分析一下LinkedHashSet的底层机制</span></span><br><span class="line">        <span class="type">Set</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;AA&quot;</span>));</span><br><span class="line">        set.add(<span class="number">456</span>);</span><br><span class="line">        set.add(<span class="number">456</span>);</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Customer</span>(<span class="string">&quot;刘&quot;</span>, <span class="number">1001</span>));</span><br><span class="line">        set.add(<span class="number">123</span>);</span><br><span class="line">        set.add(<span class="string">&quot;HSP&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;set=&quot;</span> + set);</span><br><span class="line">        <span class="comment">//1. LinkedHashSet 加入顺序和取出元素/数据的顺序一致</span></span><br><span class="line">        <span class="comment">//2. LinkedHashSet 底层维护的是一个LinkedHashMap(是HashMap的子类)</span></span><br><span class="line">        <span class="comment">//3. LinkedHashSet 底层结构 (数组table+双向链表)</span></span><br><span class="line">        <span class="comment">//4. 添加第一次时，直接将 数组table 扩容到 16 ,存放的结点类型是 LinkedHashMap$Entry</span></span><br><span class="line">        <span class="comment">//5. 数组是 HashMap$Node[] 存放的元素/数据是 LinkedHashMap$Entry类型</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                //继承关系是在内部类完成.</span></span><br><span class="line"><span class="comment">                static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123;</span></span><br><span class="line"><span class="comment">                    Entry&lt;K,V&gt; before, after;</span></span><br><span class="line"><span class="comment">                    Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span></span><br><span class="line"><span class="comment">                        super(hash, key, value, next);</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> no;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">(String name, <span class="type">int</span> no)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.no = no;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashSet</title>
      <link href="/posts/1222166338.html"/>
      <url>/posts/1222166338.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><ul><li>实现了Set接口</li><li>底层实际上是HashMap，HashMap的底层机制实际上是数组+链表+红黑树（目的是高效）（也就不能再用索引了）</li><li>可以存放null值，但只能有一个null</li><li>HashSet不保证元素是有序的，取决于hash后，再确定索引的结果</li><li>不能有重复的元素/对象。实现Set接口的类的共同点</li></ul><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>在执行add方法后，会返回一个boolean值，如果添加成功，返回true，如果添加失败返回false</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Set</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();<span class="comment">//底层走的是HashMap</span></span><br><span class="line"></span><br><span class="line">System.out.println(set.add(<span class="string">&quot;john&quot;</span>));<span class="comment">//true</span></span><br><span class="line">System.out.println(set.add(<span class="string">&quot;lucy&quot;</span>));<span class="comment">//true</span></span><br><span class="line">System.out.println(set.add(<span class="string">&quot;john&quot;</span>));<span class="comment">//false</span></span><br><span class="line">System.out.println(set.add(<span class="string">&quot;jack&quot;</span>));<span class="comment">//true</span></span><br><span class="line">System.out.println(set.add(<span class="string">&quot;mary&quot;</span>));<span class="comment">//true</span></span><br><span class="line">System.out.println(set.add(<span class="literal">null</span>));<span class="comment">//true</span></span><br><span class="line">System.out.println(set.add(<span class="literal">null</span>));<span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>这样就知道为什么set中没有重复的元素了</p><h2 id="添加机制"><a href="#添加机制" class="headerlink" title="添加机制"></a>添加机制</h2><p><strong>先获取哈希值（hashCode()方法），对哈希值进行运算，得出一个索引值为要存放在哈希标中的位置号，如果该位置上没有其他元素，则直接存放，若该位置上已经有其他元素了就需要调用equals判断，如果相等则不再添加</strong><br>如果每次添加的元素都是新的对象那一般都能加进去，不管对象内容是否一样都可以（因为是不同对象）因为比较的是对象的equals（可以重写），如果添加对象的equals相同则添加失败<br>如果equals相等表示可以添加，如果hashCode值相同则放在同一链表上（因为计算出来的位置索引都是一样的）<br>由于要用hashCode计算索引值，所以元素再HashSet中不一定是从第一个位置开始排列<br>一般添加对象要求不能添加相同内容的对象，那么对象的hashCode()方法就要重写，返回相同hashCode值</p><h3 id="添加实践代码"><a href="#添加实践代码" class="headerlink" title="添加实践代码"></a>添加实践代码</h3><p>初步尝试：（姓名和年龄下同就表示同一个人，则不在添加）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashSetExercise</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Set</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;牛人&quot;</span>,<span class="number">13</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;牛逼&quot;</span>,<span class="number">13</span>));</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;牛人&quot;</span>,<span class="number">13</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;set= &quot;</span> + set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span> == o)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(o <span class="keyword">instanceof</span> Employee)&#123;</span><br><span class="line">            <span class="type">Employee</span> <span class="variable">e</span> <span class="operator">=</span> (Employee) o;</span><br><span class="line">            <span class="keyword">if</span>(((Employee) o).age == <span class="built_in">this</span>.age &amp;&amp; ((Employee) o).name.equals(<span class="built_in">this</span>.name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&quot;</span>+<span class="string">&quot;name: &quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot; 年龄&quot;</span> + <span class="built_in">this</span>.age+<span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进阶尝试：(如果姓名和生日相同就表示同一个人，不能再添加了，其中生日的数据要是另外一个类，重点就是这个类的引入增加了难度)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashSetExercise02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Set</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Employee2</span>(<span class="string">&quot;牛逼&quot;</span>,<span class="number">2500</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2003</span>,<span class="number">7</span>,<span class="number">20</span>)));</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Employee2</span>(<span class="string">&quot;牛人&quot;</span>,<span class="number">3500</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2003</span>,<span class="number">12</span>,<span class="number">25</span>)));</span><br><span class="line">        set.add(<span class="keyword">new</span> <span class="title class_">Employee2</span>(<span class="string">&quot;牛逼&quot;</span>,<span class="number">3500</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2003</span>,<span class="number">7</span>,<span class="number">20</span>)));</span><br><span class="line">        System.out.println(<span class="string">&quot;set = &quot;</span> + set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDate</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> year;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> month;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> day;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyDate</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.year = year;</span><br><span class="line">        <span class="built_in">this</span>.month = month;</span><br><span class="line">        <span class="built_in">this</span>.day = day;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">MyDate</span> <span class="variable">myDate</span> <span class="operator">=</span> (MyDate) o;</span><br><span class="line">        <span class="keyword">return</span> year == myDate.year &amp;&amp; month == myDate.month &amp;&amp; day == myDate.day;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyDate&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;year=&quot;</span> + year +</span><br><span class="line">                <span class="string">&quot;, month=&quot;</span> + month +</span><br><span class="line">                <span class="string">&quot;, day=&quot;</span> + day +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> sal;</span><br><span class="line">    <span class="keyword">private</span> MyDate birthday;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee2</span><span class="params">(String name, <span class="type">int</span> sal, MyDate birthday)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sal = sal;</span><br><span class="line">        <span class="built_in">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Employee2</span> <span class="variable">employee2</span> <span class="operator">=</span> (Employee2) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(name, employee2.name) &amp;&amp; Objects.equals(birthday, employee2.birthday);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Employee2&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, sal=&quot;</span> + sal +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码查看"><a href="#源码查看" class="headerlink" title="源码查看"></a>源码查看</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashSetSource</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HashSet</span> <span class="variable">hashSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">        hashSet.add(<span class="string">&quot;java&quot;</span>);<span class="comment">//到此位置，第1次add分析完毕.</span></span><br><span class="line">        hashSet.add(<span class="string">&quot;php&quot;</span>);<span class="comment">//到此位置，第2次add分析完毕</span></span><br><span class="line">        hashSet.add(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;set=&quot;</span> + hashSet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1. 执行 HashSet()</span></span><br><span class="line"><span class="comment">            public HashSet() &#123;</span></span><br><span class="line"><span class="comment">                map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        2. 执行 add()</span></span><br><span class="line"><span class="comment">           public boolean add(E e) &#123;//e = &quot;java&quot;</span></span><br><span class="line"><span class="comment">                return map.put(e, PRESENT)==null;//(static) PRESENT = new Object();-&gt;PRESENT是静态共享的</span></span><br><span class="line"><span class="comment">           &#125;</span></span><br><span class="line"><span class="comment">         3.执行 put() , 该方法会执行 hash(key) 得到key对应的hash值 算法h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)-&gt;[无符号右移16位]</span></span><br><span class="line"><span class="comment">             public V put(K key, V value) &#123;//key = &quot;java&quot; value = PRESENT-&gt;共享</span></span><br><span class="line"><span class="comment">                return putVal(hash(key), key, value, false, true);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">         4.执行 putVal   (*核心代码*)</span></span><br><span class="line"><span class="comment">         final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</span></span><br><span class="line"><span class="comment">                   boolean evict) &#123;</span></span><br><span class="line"><span class="comment">                Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; //定义了辅助变量</span></span><br><span class="line"><span class="comment">                //table 就是 HashMap 的一个数组，类型是 Node[]   (用来形成链表)</span></span><br><span class="line"><span class="comment">                //if 语句表示如果当前table 是null, 或者 大小=0</span></span><br><span class="line"><span class="comment">                //就是第一次扩容，到16个空间.</span></span><br><span class="line"><span class="comment">                if ((tab = table) == null || (n = tab.length) == 0)</span></span><br><span class="line"><span class="comment">                    n = (tab = resize()).length;   -&gt;resize()返回一个newtable</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                //(1)根据key，得到hash 去计算该key应该存放到table表的哪个索引位置并把这个位置的对象，赋给 p</span></span><br><span class="line"><span class="comment">                //(2)判断p 是否为null</span></span><br><span class="line"><span class="comment">                //(2.1) 如果p 为null, 表示还没有存放元素, 就创建一个Node (key=&quot;java&quot;,value=PRESENT)</span></span><br><span class="line"><span class="comment">                //(2.2) 就放在该位置 tab[i] = newNode(hash, key, value, null)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                if ((p = tab[i = (n - 1) &amp; hash]) == null)//比较能否添加</span></span><br><span class="line"><span class="comment">                    tab[i] = newNode(hash, key, value, null);</span></span><br><span class="line"><span class="comment">                else &#123;</span></span><br><span class="line"><span class="comment">                    //一个开发技巧提示： 在需要局部变量(辅助变量)时候，在创建</span></span><br><span class="line"><span class="comment">                    Node&lt;K,V&gt; e; K k; </span></span><br><span class="line"><span class="comment">                    //如果当前索引位置对应的链表的第一个元素和准备添加的key的hash值一样</span></span><br><span class="line"><span class="comment">                    //并且满足 下面两个条件之一:</span></span><br><span class="line"><span class="comment">                    //(1) 准备加入的key 和 p 指向的Node 结点的 key 是同一个对象</span></span><br><span class="line"><span class="comment">                    //(2)  p 指向的Node 结点的 key 的equals() 和准备加入的key比较后相同</span></span><br><span class="line"><span class="comment">                    //就不能加入</span></span><br><span class="line"><span class="comment">                    if (p.hash == hash &amp;&amp;</span></span><br><span class="line"><span class="comment">                        ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))</span></span><br><span class="line"><span class="comment">                        e = p;</span></span><br><span class="line"><span class="comment">                    //再判断 p 是不是一颗红黑树,</span></span><br><span class="line"><span class="comment">                    //如果是一颗红黑树，就调用 putTreeVal , 来进行添加</span></span><br><span class="line"><span class="comment">                    else if (p instanceof TreeNode)</span></span><br><span class="line"><span class="comment">                        e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);</span></span><br><span class="line"><span class="comment">                    else &#123;//如果table对应索引位置，已经是一个链表, 就使用for循环比较</span></span><br><span class="line"><span class="comment">                          //(1) 依次和该链表的每一个元素比较后，都不相同, 则加入到该链表的最后</span></span><br><span class="line"><span class="comment">                          //    注意在把元素添加到链表后，立即判断 该链表是否已经达到8个结点</span></span><br><span class="line"><span class="comment">                          //    , 就调用 treeifyBin() 对当前这个链表进行树化-&gt;(转成红黑树)</span></span><br><span class="line"><span class="comment">                          //    注意，在转成红黑树时，要进行判断, 判断条件</span></span><br><span class="line"><span class="comment">                          //    if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY(值为64))</span></span><br><span class="line"><span class="comment">                          //            resize();</span></span><br><span class="line"><span class="comment">                          //    如果上面条件成立，先table扩容.</span></span><br><span class="line"><span class="comment">                          //    只有上面条件不成立时，才进行转成红黑树</span></span><br><span class="line"><span class="comment">                          //(2) 依次和该链表的每一个元素比较过程中，如果有相同情况,就直接break</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                        for (int binCount = 0; ; ++binCount) &#123;</span></span><br><span class="line"><span class="comment">                            if ((e = p.next) == null) &#123;</span></span><br><span class="line"><span class="comment">                                p.next = newNode(hash, key, value, null);//加入到链表的最后</span></span><br><span class="line"><span class="comment">                                if (binCount &gt;= TREEIFY_THRESHOLD【值为8】 - 1) // -1 for 1st</span></span><br><span class="line"><span class="comment">                                    treeifyBin(tab, hash);</span></span><br><span class="line"><span class="comment">                                break;</span></span><br><span class="line"><span class="comment">                            &#125;</span></span><br><span class="line"><span class="comment">                            if (e.hash == hash &amp;&amp;</span></span><br><span class="line"><span class="comment">                                ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))</span></span><br><span class="line"><span class="comment">                                break;</span></span><br><span class="line"><span class="comment">                            p = e;</span></span><br><span class="line"><span class="comment">                        &#125;</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                    if (e != null) &#123; // existing mapping for key</span></span><br><span class="line"><span class="comment">                        V oldValue = e.value;</span></span><br><span class="line"><span class="comment">                        if (!onlyIfAbsent || oldValue == null)</span></span><br><span class="line"><span class="comment">                            e.value = value;</span></span><br><span class="line"><span class="comment">                        afterNodeAccess(e);</span></span><br><span class="line"><span class="comment">                        return oldValue;</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                ++modCount;</span></span><br><span class="line"><span class="comment">                //size 就是我们每加入一个结点Node(k,v,h,next), size++</span></span><br><span class="line"><span class="comment">                if (++size &gt; threshold)</span></span><br><span class="line"><span class="comment">                    resize();//扩容</span></span><br><span class="line"><span class="comment">                afterNodeInsertion(evict);</span></span><br><span class="line"><span class="comment">                return null;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码总结"><a href="#源码总结" class="headerlink" title="源码总结"></a>源码总结</h2><ol><li>HashSet的底层实际上是HashMap，第一次添加时，table数扩容到16，临界值（threshold）[是16]*加载因子（loadFactor）[是0.75]=12</li><li>如果table数组使用到了临界值12，就会扩容到16<em>2 = 32，新的临界值就是32</em>0.75=24，以此类推（==只要是添加了对象size就会++==，即单个链表中添加一个结点，table的size就会++，到了临界值就扩容）</li><li>在Java8中，如果一条链表的元素个数到达TREEIFY_THRESHOLD（默认为8），并且table的大小 &gt;= MIN_TREEIFY_CAPACITY（默认为64，即数组的大小），就进行树化（树化为红黑树）</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ArrayList</title>
      <link href="/posts/1219920510.html"/>
      <url>/posts/1219920510.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h1><h2 id="基本函数介绍"><a href="#基本函数介绍" class="headerlink" title="基本函数介绍"></a>基本函数介绍</h2><div class="table-container"><table><thead><tr><th style="text-align:left">方法原型</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">add(Object elem)</td><td style="text-align:left">在list中加入对象参数（添加元素）</td></tr><tr><td style="text-align:left">add(int index,Objece elem)</td><td style="text-align:left">指定在下标index前添加一个对象</td></tr><tr><td style="text-align:left">remove(int index)</td><td style="text-align:left">根据下标索引删除元素</td></tr><tr><td style="text-align:left">remove(Object elem)</td><td style="text-align:left">删除具体对象（元素）</td></tr><tr><td style="text-align:left">contains(Object elem)</td><td style="text-align:left">如果和对象参数匹配就返回true</td></tr><tr><td style="text-align:left">isEmpty()</td><td style="text-align:left">如果list中没有元素就返回“true”</td></tr><tr><td style="text-align:left">indexOf(Object elem)</td><td style="text-align:left">返回对象的参数的索引或-1（如果没有这个元素）</td></tr><tr><td style="text-align:left">size()</td><td style="text-align:left">返回list中的元素的一个数</td></tr><tr><td style="text-align:left">get(int index)</td><td style="text-align:left">返回当前索引的对象</td></tr></tbody></table></div><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//假设有个类叫Egg</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Egg</span>&#123;&#125;</span><br><span class="line"><span class="comment">//创建一个包含Egg对象的ArrayList</span></span><br><span class="line">ArrayList&lt;Egg&gt; myList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Egg&gt; ();</span><br><span class="line"><span class="comment">//加入元素</span></span><br><span class="line"><span class="type">Egg</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Egg</span>();<span class="comment">//创建一个对象（后面可以赋值）</span></span><br><span class="line">myList.add(s);<span class="comment">//添加</span></span><br><span class="line"><span class="comment">//再加入一次元素</span></span><br><span class="line"><span class="type">Egg</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Egg</span>();</span><br><span class="line">myList.add(b);</span><br><span class="line"><span class="comment">//查询大小</span></span><br><span class="line"><span class="type">int</span> <span class="variable">theSize</span> <span class="operator">=</span> myList.size();</span><br><span class="line"><span class="comment">//查询特定元素</span></span><br><span class="line"><span class="type">boolean</span> isIn myList.contains(s);<span class="comment">//查询是否含有s对象</span></span><br><span class="line"><span class="comment">//查询特定元素的位置</span></span><br><span class="line"><span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> myList.indexOf(b);<span class="comment">//查询得到b对象再myList中的索引</span></span><br><span class="line"><span class="comment">//判断集合是否为空</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">empty</span> <span class="operator">=</span> myList.isEmpty();</span><br><span class="line"><span class="comment">//删除b对象</span></span><br><span class="line">myList.remove(b);</span><br><span class="line"><span class="comment">//得到下标索引为0的对象</span></span><br><span class="line"><span class="type">Egg</span> <span class="variable">k</span> <span class="operator">=</span> myList.get(<span class="number">0</span>);<span class="comment">//实际上就是让k也指向s指向的对象</span></span><br><span class="line"><span class="comment">//删除下标为0的对象</span></span><br><span class="line">myList.remove(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li>ArrayList的大小是可变化的，不需要规定大小</li><li>存放对象是不用给定下标位置，可以直接在后面添加</li><li>也可指定添加</li><li>不能使用[]运算符</li><li>格式要为ArrayList<Type>,即创建包含元素为Type类型的元素</li></ol><h2 id="实际使用代码"><a href="#实际使用代码" class="headerlink" title="实际使用代码"></a>实际使用代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">List</span> <span class="variable">arrayList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();<span class="comment">//编译类型为ArrayList的接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        add:添加当单个元素,参数类型是Object，所以所有类型的对象都可添加进同一个arrayList</span></span><br><span class="line">  arrayList.add(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">  arrayList.add(<span class="number">10</span>);</span><br><span class="line">  arrayList.add(<span class="literal">true</span>);</span><br><span class="line">  arrayList.add(<span class="number">21.001</span>);</span><br><span class="line">  arrayList.add(<span class="number">3</span>, <span class="literal">false</span>);<span class="comment">//在指定位置（下标为3的前面,添加后新的对象的下标就是3了）添加一个对象（false）</span></span><br><span class="line">  <span class="comment">//可如此直接输出集合内容，格式和Arrays.toString()一样，输出结果：arrayList= [jack, 10, true, false, 21.001]</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList= &quot;</span> + arrayList);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        remove:删除单个元素</span></span><br><span class="line">  arrayList.remove(<span class="number">0</span>);<span class="comment">//删除第一个元素（按下标索引删除）</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList= &quot;</span> + arrayList);<span class="comment">//输出arrayList= [10, true, false, 21.001]</span></span><br><span class="line">  arrayList.remove(<span class="literal">true</span>);<span class="comment">//指定对象删除</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList= &quot;</span> + arrayList);<span class="comment">//输出arrayList= [10, false, 21.001]</span></span><br><span class="line">  arrayList.add(<span class="number">0</span>, <span class="string">&quot;tom&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        contains:查找元素是否存在，返回值为Boolean类型</span></span><br><span class="line">  System.out.println(<span class="string">&quot;找jack &quot;</span> + arrayList.contains(<span class="string">&quot;jack&quot;</span>));<span class="comment">//输出：找jack false</span></span><br><span class="line">  System.out.println(<span class="string">&quot;找tom &quot;</span> + arrayList.contains(<span class="string">&quot;tom&quot;</span>));<span class="comment">//输出：找tom true</span></span><br><span class="line">  <span class="type">boolean</span> <span class="variable">con</span> <span class="operator">=</span> arrayList.contains(<span class="literal">false</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;找false(arrayList中的一个对象) &quot;</span> + con);<span class="comment">//输出：找false(arrayList中的一个对象) true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        size:获取元素个数，返回值是int类型的</span></span><br><span class="line">  System.out.println(<span class="string">&quot;先看一下有几个元素：&quot;</span> + arrayList);<span class="comment">//输出：先看一下有几个元素：[tom, 10, false, 21.001]（4个元素）</span></span><br><span class="line">  System.out.println(<span class="string">&quot;用size()输出元素个数：&quot;</span> + arrayList.size());<span class="comment">//输出：用size()输出元素个数：4</span></span><br><span class="line">  <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> arrayList.size();</span><br><span class="line">  System.out.println(<span class="string">&quot;得到返回值后再输出&quot;</span> + size);<span class="comment">//输出：得到返回值后再输出4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        isEmpty:判断是否为空，返回值为boolean</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList.isEmpty(): &quot;</span> + arrayList.isEmpty());<span class="comment">//输出：arrayList.isEmpty(): false</span></span><br><span class="line">  <span class="type">List</span> <span class="variable">arrayList2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();<span class="comment">//创建一个空集合</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList2.isEmoty(): &quot;</span> + arrayList2.isEmpty());<span class="comment">//输出：arrayList2.isEmoty(): true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        clear:清空</span></span><br><span class="line">  arrayList2.add(<span class="string">&quot;有元素了&quot;</span>);</span><br><span class="line">  arrayList2.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;调用clear()前的arrayList2: &quot;</span>+arrayList2);<span class="comment">//输出：调用clear()前的arrayList2: [有元素了, yes]</span></span><br><span class="line">  arrayList2.clear();<span class="comment">//将arratList2的元素清空</span></span><br><span class="line">  System.out.println(<span class="string">&quot;调用clear()后的arrayList2: &quot;</span>+arrayList2);<span class="comment">//输出：调用clear()后的arrayList2: []</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        addAll:添加多个元素</span></span><br><span class="line">  System.out.println(<span class="string">&quot;使用addAll()前的arrayList: &quot;</span> + arrayList);<span class="comment">//输出：使用addAll()前的arrayList: [tom, 10, false, 21.001]</span></span><br><span class="line">  <span class="comment">//先给arrayList2添加两个元素（之前被clear()了）</span></span><br><span class="line">  arrayList2.add(<span class="string">&quot;西游记&quot;</span>);</span><br><span class="line">  arrayList2.add(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">  arrayList.addAll(arrayList2);<span class="comment">//将arrayList2的所有元素添加到末尾</span></span><br><span class="line">  System.out.println(<span class="string">&quot;使用addAll()后的arrayList: &quot;</span> + arrayList);<span class="comment">//输出：使用addAll()后的arrayList: [tom, 10, false, 21.001, 西游记, 三国演义]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        containsAll:查找多个元素是否都存在,也是返回boolean类型的值</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList&quot;</span> + arrayList);</span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList2&quot;</span> + arrayList2);</span><br><span class="line">  System.out.println(arrayList.containsAll(arrayList2));<span class="comment">//输出true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        removeAll:删除多个元素</span></span><br><span class="line">  arrayList.removeAll(arrayList2);</span><br><span class="line">  System.out.println(<span class="string">&quot;删除arrayList2元素后的arrayList：&quot;</span> + arrayList);<span class="comment">//输出删除arrayList2元素后的arrayList：[tom, 10, false, 21.001]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ArrayList-使用细节"><a href="#ArrayList-使用细节" class="headerlink" title="ArrayList 使用细节"></a>ArrayList 使用细节</h1><ol><li>ArrayList可以放任何值，包括null，并且多个</li><li>ArrayList是由数组来实现的数据存储的</li><li>ArrayList基本等同于Vector,除了ArrayList是线程不安全（但执行效率高）,在多线程的情况下，不建议使用ArrayList<br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-04%20143557.png" alt=""><br> 可用debug追看一下源码<br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-04%20152038.png" alt=""><br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-04%20152126.png" alt=""></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
          <category> 集合 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>集合</title>
      <link href="/posts/3546711884.html"/>
      <url>/posts/3546711884.html</url>
      
        <content type="html"><![CDATA[<details>B站 韩顺平 老师课程的笔记</details><h1 id="集合（collection）"><a href="#集合（collection）" class="headerlink" title="集合（collection）"></a>集合（collection）</h1><p>本文件讲的是实现Collection接口的集合的共性<br>独有的看别的文件</p><h2 id="集合的优点"><a href="#集合的优点" class="headerlink" title="集合的优点"></a>集合的优点</h2><ol><li>可以==动态==保存任意多个对象，使用比较方便</li><li>提供一系列方便的操作对象的方法：add、remove、set、get等（相当于增删改查都写好了）</li><li>使用集合添加，删除新元素更简洁方便</li></ol><h2 id="数组的不足之处"><a href="#数组的不足之处" class="headerlink" title="数组的不足之处"></a>数组的不足之处</h2><ol><li>长度开始必须指定，而且一旦指定不能更改</li><li>保存的必须为同一类型的的元素</li><li>使用数组进行增加/删除元素比较麻烦<br> 总之，灵活性不够</li></ol><h2 id="集合的框架体系（常用）"><a href="#集合的框架体系（常用）" class="headerlink" title="集合的框架体系（常用）"></a>集合的框架体系（常用）</h2><p>Collection接口继承了Iterable接口<br>Collection接口被List接口和Set接口实现了<br>List接口被Vector、ArrayList、LinkedList类实现了<br>Set接口被TreeSet、HashSet类实现了<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-04%20124708.png" alt=""><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-03-04%20124744.png" alt=""><br>List是有序的，Set是无序的(有序指的是添加顺序和取出顺序相同)</p><h3 id="不同集合之间的区别"><a href="#不同集合之间的区别" class="headerlink" title="不同集合之间的区别"></a>不同集合之间的区别</h3><h4 id="取长度方面"><a href="#取长度方面" class="headerlink" title="取长度方面"></a>取长度方面</h4><p>==主要注意是length、length()还是size()==</p><p>普通数组：int[] a = new int[10]; ==&gt; a.length;</p><p>字符串：String a = “zhang”; ==&gt; a.length();<br>StringBuffer、StringBuilder ==&gt; a.length();</p><p>Collection(List(ArrayList、LinkedList、Vector)、Set(TreeSet、HashSet)) ==&gt; col.zise();<br>Map(HashMap、TreeMap、HashTable) ==&gt; map.size();</p><p>Stack ==&gt; stack.size();<br>Queue(LinkedList、ArrayQueue) ==&gt; queue.size();<br>Deque(ArrayDeque、LinkedList) ==&gt; deque.size();<br>==总结==<br><strong>普通数组用length;字符串以及和字符串有关的StringBuffer等用length();集合有关的都用size()</strong></p><h4 id="存取方法"><a href="#存取方法" class="headerlink" title="存取方法"></a>存取方法</h4><p>Collection接口下的List、Set接口的方法都是使用add()添加、使用get()取出元素</p><p>Map接口下的实现类都是使用put(K,V)进行存，使用get()取</p><p>Stack使用push()或add()存、使用pop()、get()、peek()取</p><p>Queue、和Deque都是接口，其实现类都可是LinkedList,使用offer()、add()进行存、使用poll()、pop()、peek()、get()取</p><h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><p>add:添加单个元素<br>remove:删除单个元素<br>contains：查找元素是否存在<br>size:获取元素个数<br>isEmpty:判断是否为空<br>clear:清空<br>addAll:添加多个元素<br>containsAll:查找多个元素是否都存在<br>removeAll:删除多个元素<br>以ArrayList演示，可看文件：<a href="/posts/1219920510.html" title="ArrayList">ArrayList</a></p><h4 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">List</span> <span class="variable">arrayList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();<span class="comment">//编译类型为ArrayList的接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        add:添加当单个元素,参数类型是Object，所以所有类型的对象都可添加进同一个arrayList</span></span><br><span class="line">  arrayList.add(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">  arrayList.add(<span class="number">10</span>);</span><br><span class="line">  arrayList.add(<span class="literal">true</span>);</span><br><span class="line">  arrayList.add(<span class="number">21.001</span>);</span><br><span class="line">  arrayList.add(<span class="number">3</span>, <span class="literal">false</span>);<span class="comment">//在指定位置（下标为3的前面,添加后新的对象的下标就是3了）添加一个对象（false）(List接口中特有的)</span></span><br><span class="line">  <span class="comment">//可如此直接输出集合内容，格式和Arrays.toString()一样，输出结果：arrayList= [jack, 10, true, false, 21.001]</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList= &quot;</span> + arrayList);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        remove:删除单个元素</span></span><br><span class="line">  arrayList.remove(<span class="number">0</span>);<span class="comment">//删除第一个元素（按下标索引删除）</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList= &quot;</span> + arrayList);<span class="comment">//输出arrayList= [10, true, false, 21.001]</span></span><br><span class="line">  arrayList.remove(<span class="literal">true</span>);<span class="comment">//指定对象删除</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList= &quot;</span> + arrayList);<span class="comment">//输出arrayList= [10, false, 21.001]</span></span><br><span class="line">  arrayList.add(<span class="number">0</span>, <span class="string">&quot;tom&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        contains:查找元素是否存在，返回值为Boolean类型</span></span><br><span class="line">  System.out.println(<span class="string">&quot;找jack &quot;</span> + arrayList.contains(<span class="string">&quot;jack&quot;</span>));<span class="comment">//输出：找jack false</span></span><br><span class="line">  System.out.println(<span class="string">&quot;找tom &quot;</span> + arrayList.contains(<span class="string">&quot;tom&quot;</span>));<span class="comment">//输出：找tom true</span></span><br><span class="line">  <span class="type">boolean</span> <span class="variable">con</span> <span class="operator">=</span> arrayList.contains(<span class="literal">false</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;找false(arrayList中的一个对象) &quot;</span> + con);<span class="comment">//输出：找false(arrayList中的一个对象) true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        size:获取元素个数，返回值是int类型的</span></span><br><span class="line">  System.out.println(<span class="string">&quot;先看一下有几个元素：&quot;</span> + arrayList);<span class="comment">//输出：先看一下有几个元素：[tom, 10, false, 21.001]（4个元素）</span></span><br><span class="line">  System.out.println(<span class="string">&quot;用size()输出元素个数：&quot;</span> + arrayList.size());<span class="comment">//输出：用size()输出元素个数：4</span></span><br><span class="line">  <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> arrayList.size();</span><br><span class="line">  System.out.println(<span class="string">&quot;得到返回值后再输出&quot;</span> + size);<span class="comment">//输出：得到返回值后再输出4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        isEmpty:判断是否为空，返回值为boolean</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList.isEmpty(): &quot;</span> + arrayList.isEmpty());<span class="comment">//输出：arrayList.isEmpty(): false</span></span><br><span class="line">  <span class="type">List</span> <span class="variable">arrayList2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();<span class="comment">//创建一个空集合</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList2.isEmoty(): &quot;</span> + arrayList2.isEmpty());<span class="comment">//输出：arrayList2.isEmoty(): true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        clear:清空</span></span><br><span class="line">  arrayList2.add(<span class="string">&quot;有元素了&quot;</span>);</span><br><span class="line">  arrayList2.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">  System.out.println(<span class="string">&quot;调用clear()前的arrayList2: &quot;</span>+arrayList2);<span class="comment">//输出：调用clear()前的arrayList2: [有元素了, yes]</span></span><br><span class="line">  arrayList2.clear();<span class="comment">//将arratList2的元素清空</span></span><br><span class="line">  System.out.println(<span class="string">&quot;调用clear()后的arrayList2: &quot;</span>+arrayList2);<span class="comment">//输出：调用clear()后的arrayList2: []</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        addAll:添加多个元素</span></span><br><span class="line">  System.out.println(<span class="string">&quot;使用addAll()前的arrayList: &quot;</span> + arrayList);<span class="comment">//输出：使用addAll()前的arrayList: [tom, 10, false, 21.001]</span></span><br><span class="line">  <span class="comment">//先给arrayList2添加两个元素（之前被clear()了）</span></span><br><span class="line">  arrayList2.add(<span class="string">&quot;西游记&quot;</span>);</span><br><span class="line">  arrayList2.add(<span class="string">&quot;三国演义&quot;</span>);</span><br><span class="line">  arrayList.addAll(arrayList2);<span class="comment">//将arrayList2的所有元素添加到末尾</span></span><br><span class="line">  System.out.println(<span class="string">&quot;使用addAll()后的arrayList: &quot;</span> + arrayList);<span class="comment">//输出：使用addAll()后的arrayList: [tom, 10, false, 21.001, 西游记, 三国演义]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        containsAll:查找多个元素是否都存在,也是返回boolean类型的值</span></span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList&quot;</span> + arrayList);</span><br><span class="line">  System.out.println(<span class="string">&quot;arrayList2&quot;</span> + arrayList2);</span><br><span class="line">  System.out.println(arrayList.containsAll(arrayList2));<span class="comment">//输出true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        removeAll:删除多个元素</span></span><br><span class="line">  arrayList.removeAll(arrayList2);</span><br><span class="line">  System.out.println(<span class="string">&quot;删除arrayList2元素后的arrayList：&quot;</span> + arrayList);<span class="comment">//输出删除arrayList2元素后的arrayList：[tom, 10, false, 21.001]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="集合遍历"><a href="#集合遍历" class="headerlink" title="集合遍历"></a>集合遍历</h2><h3 id="迭代器遍历"><a href="#迭代器遍历" class="headerlink" title="迭代器遍历"></a>迭代器遍历</h3><p>iterator对象成为迭代器，主要用于遍历Collection集合中的元素<br>实现了Collection接口的的集合类都有一个iterator()方法，用以返回一个实现了iterator接口的对象</p><h4 id="iterator的方法"><a href="#iterator的方法" class="headerlink" title="iterator的方法"></a>iterator的方法</h4><p>Iterator iterator = coll.iterator();//得到一个集合的迭代器<br>hasNext():判断是否还有下一个元素<br>next():指针下移，将下移以后集合位置上的元素返回（有两步）<br>==在使用next()前一定要使用hasNext()判断==<br>==得到next一定要用Object类型来引用，即只能：Object = iterator.next()==</p><h4 id="使用代码"><a href="#使用代码" class="headerlink" title="使用代码"></a>使用代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectionIterator01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Collection</span> <span class="variable">col</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">        col.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;三国演义&quot;</span>,<span class="string">&quot;罗贯中&quot;</span> , <span class="number">110</span>));</span><br><span class="line">        col.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;西游记&quot;</span>,<span class="string">&quot;吴承恩&quot;</span>,<span class="number">150</span>));</span><br><span class="line">        col.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;红楼梦&quot;</span>,<span class="string">&quot;曹雪芹&quot;</span>,<span class="number">115</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第一种输出</span></span><br><span class="line">        System.out.println(col);<span class="comment">//输出：[书名：三国演义 作者：罗贯中 价格：110, 书名：西游记 作者：吴承恩 价格：150, 书名：红楼梦 作者：曹雪芹 价格：115]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用迭代器遍历输出</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> col.iterator();<span class="comment">//实现Collection接口的类都有iterator()对象直接取出来用</span></span><br><span class="line">        <span class="comment">//使用while循环遍历输出</span></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();<span class="comment">//接收下一个位置的返回值</span></span><br><span class="line">            System.out.println(next);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//输出：</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 书名：三国演义 作者：罗贯中 价格：110</span></span><br><span class="line"><span class="comment">         * 书名：西游记 作者：吴承恩 价格：150</span></span><br><span class="line"><span class="comment">         * 书名：红楼梦 作者：曹雪芹 价格：115</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//退出循环后iterator要指向最后一个元素</span></span><br><span class="line">        <span class="comment">//如果需要再次遍历需要重置迭代器，方式：</span></span><br><span class="line">        iterator = col.iterator();</span><br><span class="line">        <span class="comment">//重置迭代器后，第二次遍历输出</span></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Book</span><span class="params">(String name, String author, <span class="type">int</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.author = author;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAuthor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAuthor</span><span class="params">(String author)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.author = author;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">int</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;书名：&quot;</span> + name + <span class="string">&quot; 作者：&quot;</span> + author + <span class="string">&quot; 价格：&quot;</span> + price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="增强for循环遍历"><a href="#增强for循环遍历" class="headerlink" title="增强for循环遍历"></a>增强for循环遍历</h3><p>相当于是使用简便的迭代器</p><h4 id="使用代码-1"><a href="#使用代码-1" class="headerlink" title="使用代码"></a>使用代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Collection</span> <span class="variable">col</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">    col.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;三国演义&quot;</span>,<span class="string">&quot;罗贯中&quot;</span> , <span class="number">110</span>));</span><br><span class="line">    col.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;西游记&quot;</span>,<span class="string">&quot;吴承恩&quot;</span>,<span class="number">150</span>));</span><br><span class="line">    col.add(<span class="keyword">new</span> <span class="title class_">Book</span>(<span class="string">&quot;红楼梦&quot;</span>,<span class="string">&quot;曹雪芹&quot;</span>,<span class="number">115</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用增强for循环遍历</span></span><br><span class="line">    <span class="keyword">for</span>(Object book : col)&#123;<span class="comment">//底层其实还是用的迭代器，只是使用起来更方便,一定要用Object来接收</span></span><br><span class="line">        System.out.println(<span class="string">&quot;book = &quot;</span> + book);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** 输出：</span></span><br><span class="line"><span class="comment">        * book = 书名：三国演义 作者：罗贯中 价格：110</span></span><br><span class="line"><span class="comment">        * book = 书名：西游记 作者：吴承恩 价格：150</span></span><br><span class="line"><span class="comment">        * book = 书名：红楼梦 作者：曹雪芹 价格：115</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛型</title>
      <link href="/posts/1987617322.html"/>
      <url>/posts/1987617322.html</url>
      
        <content type="html"><![CDATA[<details>我学习 B站 韩顺平 老师课程的学习笔记</details><h1 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h1><h2 id="泛型引入"><a href="#泛型引入" class="headerlink" title="泛型引入"></a>泛型引入</h2><h3 id="需要泛型的体现"><a href="#需要泛型的体现" class="headerlink" title="需要泛型的体现"></a>需要泛型的体现</h3><h4 id="使用代码"><a href="#使用代码" class="headerlink" title="使用代码"></a>使用代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Needgenericity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        //传统</span></span><br><span class="line"><span class="comment">//        ArrayList arrayList = new ArrayList();</span></span><br><span class="line"><span class="comment">//        arrayList.add(new Dog(&quot;小黄&quot;,10));</span></span><br><span class="line"><span class="comment">//        arrayList.add(new Dog(&quot;旺财&quot;,5));</span></span><br><span class="line"><span class="comment">//        arrayList.add(new Dog(&quot;牛狗&quot;,6));</span></span><br><span class="line"><span class="comment">//        //加入不小心添加了一只猫</span></span><br><span class="line"><span class="comment">//        arrayList.add(new Cat(&quot;招财猫&quot;,8));//因为ArrayList实现了泛型所以没有错误</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        //遍历，当添加了猫进去后就会出问题，不能将Cat转型为Dog(只能运行到Cat这里才会抛出异常，编译器开始不报错)，所以前面需要泛型，限制添加类型</span></span><br><span class="line"><span class="comment">//        for(Object o : arrayList)&#123;</span></span><br><span class="line"><span class="comment">//            Dog dog  = (Dog) o;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;名字：&quot; + dog.getName() +&quot; 年龄&quot;+ dog.getAge());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用泛型</span></span><br><span class="line">        ArrayList&lt;Dog&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Dog&gt;();</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;小黄&quot;</span>,<span class="number">10</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;旺财&quot;</span>,<span class="number">5</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&quot;牛狗&quot;</span>,<span class="number">6</span>));</span><br><span class="line">        <span class="comment">//arrayList.add(new Cat(&quot;招财猫&quot;,8));//报错，编译时就会报错，表示不能添加</span></span><br><span class="line">        <span class="comment">//使用泛型后遍历</span></span><br><span class="line">        <span class="keyword">for</span>(Dog dog : arrayList)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;名字：&quot;</span> + dog.getName() + <span class="string">&quot; 年龄：&quot;</span> + dog.getAge());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dog</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Cat</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="代码说明"><a href="#代码说明" class="headerlink" title="代码说明"></a>代码说明</h4><ul><li><p>使用<code>ArrayList&lt;Dog&gt;()</code>替换原本的<code>ArrayList()</code>表示存放到ArrayList集合中的元素只能是Dog的对象实例</p></li><li><p>当编译器发现添加的类型不满足要求就会提前报错(不会在等到运行时再报错)</p></li><li><p>在遍历时可以直接取出Dog类型,而不是Object<br>  原本:</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Object obj : arrayList) &#123;...&#125;</span><br></pre></td></tr></table></figure><p>  使用泛型后:</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Dog dog : arrayList) &#123;...&#125;</span><br></pre></td></tr></table></figure></li><li><p>ArrayList的原型为:</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; &#123;...&#125;</span><br></pre></td></tr></table></figure><p>  这个E称为泛型,当上面使用泛型后,那么E就全用Dog来表示了<br>  E相当于C++的模板中的Type,声明是写就好了,可以不仅仅是E也可以是Q,A,R等任意名字,用来代表传入的类型</p></li></ul><h2 id="泛型基本介绍"><a href="#泛型基本介绍" class="headerlink" title="泛型基本介绍"></a>泛型基本介绍</h2><ol><li>泛型有称为参数化类型,时JDK5.0出现的新特性,解决数据类型的安全性问题</li><li>在类声明或实例化时只要指定好需要的具体类型即可</li><li>java泛型可以保证如果程序在编译时没有发出警告,那么在运行时也不会产生ClassCastException异常</li><li>java泛型也会放代码更简洁,健壮</li><li>泛型的作用是:可以在类声明时同时通过一个标识符表示类中的某个属性的类型,或是某个方法的返回值的类型,或者是参数模型</li></ol><h3 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generic03</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//注意：E 具体的数据类型在定义Person对象的时候指定，即在编译期间，就确定E是什么类型</span></span><br><span class="line">        Person&lt;String&gt; Person = <span class="keyword">new</span> <span class="title class_">Person</span>&lt;String&gt;(<span class="string">&quot;牛人&quot;</span>);<span class="comment">//构造器传参类型不同也会报错</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 上面的初始化相当于调用：</span></span><br><span class="line"><span class="comment">         * class Person &#123;</span></span><br><span class="line"><span class="comment">         *     private String s;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         *     public Person(String s) &#123;</span></span><br><span class="line"><span class="comment">         *         this.s = s;</span></span><br><span class="line"><span class="comment">         *     &#125;</span></span><br><span class="line"><span class="comment">         *     public String getS() &#123;</span></span><br><span class="line"><span class="comment">         *         return s;</span></span><br><span class="line"><span class="comment">         *     &#125;</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Person&lt;Integer&gt; integerPerson = <span class="keyword">new</span> <span class="title class_">Person</span>&lt;Integer&gt;(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 同样相当于：</span></span><br><span class="line"><span class="comment">         * class Person &#123;</span></span><br><span class="line"><span class="comment">         *     private Integer s;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         *     public Person(Integer s) &#123;</span></span><br><span class="line"><span class="comment">         *         this.s = s;</span></span><br><span class="line"><span class="comment">         *     &#125;</span></span><br><span class="line"><span class="comment">         *     public Integer getS() &#123;</span></span><br><span class="line"><span class="comment">         *         return s;</span></span><br><span class="line"><span class="comment">         *     &#125;</span></span><br><span class="line"><span class="comment">         * &#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&lt;E&gt; &#123;<span class="comment">//E是什么类型都可以（包括之定义类型）</span></span><br><span class="line">    <span class="keyword">private</span> E s;<span class="comment">//E类型的s对象,可以直接把E就看作是一个类型</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(E s)</span> &#123;<span class="comment">//可以是参数类型</span></span><br><span class="line">        <span class="built_in">this</span>.s = s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">getS</span><span class="params">()</span> &#123;<span class="comment">//可以是返回类型</span></span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然也可以有多个类型:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&lt;E,T,K&gt; &#123;</span><br><span class="line">    ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="泛型注意细节"><a href="#泛型注意细节" class="headerlink" title="泛型注意细节"></a>泛型注意细节</h2><ol><li><p>假设有interface List<T> {},public class HashSet<E>{}…..&lt;/br&gt;说明:T,E只能为引用类型,不能是基本类型,所以:</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();<span class="comment">//正确</span></span><br><span class="line">List&lt;<span class="type">int</span>&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;<span class="type">int</span>&gt;();<span class="comment">//错误</span></span><br></pre></td></tr></table></figure></li><li><p>在指定泛型具体类型后,可以传入该类型或<u>该类型的子类型</u></p></li><li><p>泛型使用形式:</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">List&lt;Integer&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><p> 如果像后者一样写,看等号右边默认给它的泛型是Object,但是等号左边给定了是Integer,所以实际上泛型类型是Integer,若等号左边也没规定,就会像之前没有引入泛型一样,为默认的Object</p></li></ol><h2 id="练习-重要"><a href="#练习-重要" class="headerlink" title="练习(重要)"></a>练习(重要)</h2><p>注意多看，认真看sort()写得很好,尤其是MyDate的compareTo()的封装</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericExercise</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Emp&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="string">&quot;Smith&quot;</span>,<span class="number">2500.1</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2003</span>,<span class="number">12</span>,<span class="number">5</span>)));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="string">&quot;Smith&quot;</span>,<span class="number">2500.1</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2002</span>,<span class="number">12</span>,<span class="number">5</span>)));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="string">&quot;Rose&quot;</span>,<span class="number">25000.4</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2004</span>,<span class="number">2</span>,<span class="number">15</span>)));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="string">&quot;Jack&quot;</span>,<span class="number">2503.13</span>,<span class="keyword">new</span> <span class="title class_">MyDate</span>(<span class="number">2003</span>,<span class="number">1</span>,<span class="number">6</span>)));</span><br><span class="line">        </span><br><span class="line">        list.sort(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Emp&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Emp emp, Emp t1)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(!((emp <span class="keyword">instanceof</span> Emp) &amp;&amp; (t1 <span class="keyword">instanceof</span> Emp)))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;类型不正确&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//比较姓名</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> emp.getName().compareTo(t1.getName());</span><br><span class="line">                <span class="keyword">if</span>(i != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//将生日的比较封装到MyDate的类定义里去</span></span><br><span class="line">                <span class="keyword">return</span> emp.getBirthday().compareTo(t1.getBirthday());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;list = &quot;</span> + list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDate</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;MyDate&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> year;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> month;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> day;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyDate</span><span class="params">(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.year = year;</span><br><span class="line">        <span class="built_in">this</span>.month = month;</span><br><span class="line">        <span class="built_in">this</span>.day = day;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getYear</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> year;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setYear</span><span class="params">(<span class="type">int</span> year)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.year = year;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMonth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> month;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMonth</span><span class="params">(<span class="type">int</span> month)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.month = month;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getDay</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> day;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDay</span><span class="params">(<span class="type">int</span> day)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.day = day;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyDate&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;year=&quot;</span> + year +</span><br><span class="line">                <span class="string">&quot;, month=&quot;</span> + month +</span><br><span class="line">                <span class="string">&quot;, day=&quot;</span> + day +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(MyDate o)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">yd</span> <span class="operator">=</span>year - o.getYear();</span><br><span class="line">        <span class="keyword">if</span>(yd != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> yd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">md</span> <span class="operator">=</span> month - o.getMonth();</span><br><span class="line">        <span class="keyword">if</span>(md != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> md;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> dd;</span><br><span class="line">        <span class="type">return</span> <span class="variable">dd</span> <span class="operator">=</span> day - o.getDay();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> sal;</span><br><span class="line">    <span class="keyword">private</span> MyDate birthday;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">(String name, <span class="type">double</span> sal, MyDate birthday)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sal = sal;</span><br><span class="line">        <span class="built_in">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Emp&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, sal=&quot;</span> + sal +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getSal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSal</span><span class="params">(<span class="type">double</span> sal)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sal = sal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MyDate <span class="title function_">getBirthday</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBirthday</span><span class="params">(MyDate birthday)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义泛型类"><a href="#自定义泛型类" class="headerlink" title="自定义泛型类"></a>自定义泛型类</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class 类名 &lt;T,R&gt; &#123;<span class="comment">//可以是多个</span></span><br><span class="line">    成员;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注意细节"><a href="#注意细节" class="headerlink" title="注意细节"></a>注意细节</h3><ol><li>普通成员可以使用泛型</li><li>使用泛型的数组,不能初始化(不能new,意思是不能直接实例化,因为不知道类型,不知道开辟多大空间,避免之后空间冲突)</li><li>静态方法中不能使用泛型(因为静态是和类相关的,在类被加载的时候,对象都还没创建,JVM还不知道什么类型,就无法在静态方法中将类型改变为指定类型,所以JVM不能完成这样的初始化,就会报错)</li><li>泛型的类型,是在创建对象时就确定的(因为创建对象需要确定类型)</li><li>如果在创建对象时,没有指定类型,默认为Object</li></ol><h3 id="代码演示-1"><a href="#代码演示-1" class="headerlink" title="代码演示"></a>代码演示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Tiger 类后面有&lt;&gt;所以Tiger是一个泛型类</span></span><br><span class="line"><span class="comment">//T,R,M时泛型常用的标识符，一般标识符都是大写</span></span><br><span class="line"><span class="comment">//泛型标识符可以有多个</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tiger</span> &lt;T,R,M&gt; &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="comment">//属性使用泛型</span></span><br><span class="line">    T t;</span><br><span class="line">    R r;</span><br><span class="line">    M m;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//普通方法可以使用泛型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f1</span> <span class="params">(M m1)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">//public static void f2 (M m2)&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法使用泛型（使用泛型作为参数）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Tiger</span><span class="params">(String name, T t, R r, M m)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.t = t;</span><br><span class="line">        <span class="built_in">this</span>.r = r;</span><br><span class="line">        <span class="built_in">this</span>.m = m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//方法使用泛型（使用泛型作为返回值）</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getT</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setT</span><span class="params">(T t)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.t = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">getR</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setR</span><span class="params">(R r)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> M <span class="title function_">getM</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setM</span><span class="params">(M m)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.m = m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../屏幕截图%202022-03-05%20163713.png" alt="" title="静态成员不能使用泛型"></p><h2 id="自定义泛型接口"><a href="#自定义泛型接口" class="headerlink" title="自定义泛型接口"></a>自定义泛型接口</h2><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><p>interface 接口名<R,T> {}</p><h3 id="注意细节-1"><a href="#注意细节-1" class="headerlink" title="注意细节"></a>注意细节</h3><ol><li>接口中,静态成员也不能使用泛型(这个和<a href="#自定义泛型类">泛型类</a>规定一样)</li><li>泛型接口的类型,在继承接口或者实现接口时确定</li><li>没有指定类型时,默认为Object</li></ol><h3 id="代码演示-2"><a href="#代码演示-2" class="headerlink" title="代码演示"></a>代码演示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IUsb</span>&lt;U,R&gt; &#123;</span><br><span class="line">    <span class="comment">//普通方法可以使用接口泛型</span></span><br><span class="line">    R <span class="title function_">get</span><span class="params">(U u)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">(R r)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span> <span class="params">(R r1,R r2,U u1 ,U u2)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> R <span class="title function_">method</span><span class="params">(U u)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面这样没有直接说明类型就会报错，一定要先将类型说明清楚</span></span><br><span class="line"><span class="comment">//class AA implements IUsb&lt;&gt;&#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AB</span> <span class="keyword">implements</span> <span class="title class_">IUsb</span>&#123;<span class="comment">//但是什么都不写也可以，但是是默认的Object，不好（最好直接指明）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">(Object o)</span> &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Object r1, Object r2, Object u1, Object u2)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现IUsb的时候自动填入对应类型</span></span><br><span class="line"><span class="comment">//U指定为String,R指定为Double</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AA</span> <span class="keyword">implements</span> <span class="title class_">IUsb</span>&lt;String, Double&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">get</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">(Double aDouble)</span> &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Double r1, Double r2, String u1, String u2)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//接口只能继承接口不能实现接口，和类实现接口差不多，但可以不用实现接口方法（可以等着实现此接口的类来实现）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IA</span> <span class="keyword">extends</span> <span class="title class_">IUsb</span>&lt;String, Double&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="自定义泛型方法"><a href="#自定义泛型方法" class="headerlink" title="自定义泛型方法"></a>自定义泛型方法</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><p>修饰符 <T,R> 返回类型 方法名(参数列表){…}</p><h3 id="注意细节-2"><a href="#注意细节-2" class="headerlink" title="注意细节"></a>注意细节</h3><ol><li>泛型方法,可以定义在普通类中,也可以定义在泛型类中</li><li>当泛型方法被调用时,类型会确定</li><li>像<code>public void eat(E e)&#123;&#125;</code>这样,修饰符后面没有<T,R...>,所以eat()就不是泛型方法,而是使用泛型的方法</li><li>一般时参数类型是什么标识符,泛型的修饰符后面就写什么标识符</li></ol><h3 id="代码演示-3"><a href="#代码演示-3" class="headerlink" title="代码演示"></a>代码演示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelfGeneric03</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">        car.fly(<span class="string">&quot;宝马&quot;</span>, <span class="number">100</span>);<span class="comment">//当调用方法时，传入参数，编译器，就会确定类型</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======&quot;</span>);</span><br><span class="line">        car.fly(<span class="number">300</span>, <span class="number">100.1</span>);<span class="comment">//当调用方法时，传入参数，编译器，就会确定类型</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        <span class="comment">//T-&gt;String, R-&gt; ArrayList</span></span><br><span class="line">        Fish&lt;String, ArrayList&gt; fish = <span class="keyword">new</span> <span class="title class_">Fish</span>&lt;&gt;();</span><br><span class="line">        fish.hello(<span class="keyword">new</span> <span class="title class_">ArrayList</span>(), <span class="number">11.3f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//泛型方法，可以定义在普通类中, 也可以定义在泛型类中</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;<span class="comment">//普通类</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;<span class="comment">//普通方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//说明 泛型方法</span></span><br><span class="line">    <span class="comment">//1. &lt;T,R&gt; 就是泛型</span></span><br><span class="line">    <span class="comment">//2. 是提供给 fly使用的</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T, R&gt; <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">(T t, R r)</span> &#123;<span class="comment">//泛型方法</span></span><br><span class="line">        System.out.println(t.getClass());<span class="comment">//String</span></span><br><span class="line">        System.out.println(r.getClass());<span class="comment">//Integer</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fish</span>&lt;T, R&gt; &#123;<span class="comment">//泛型类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;<span class="comment">//普通方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>&lt;U,M&gt; <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(U u, M m)</span> &#123;<span class="comment">//泛型方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//说明</span></span><br><span class="line">    <span class="comment">//1. 下面hi方法不是泛型方法</span></span><br><span class="line">    <span class="comment">//2. 是hi方法使用了类声明的 泛型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hi</span><span class="params">(T t)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//泛型方法，可以使用类声明的泛型，也可以使用自己声明泛型</span></span><br><span class="line">    <span class="keyword">public</span>&lt;K&gt; <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">(R r, K k)</span> &#123;</span><br><span class="line">        System.out.println(r.getClass());<span class="comment">//ArrayList</span></span><br><span class="line">        System.out.println(k.getClass());<span class="comment">//Float</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="泛型的继承和通配符说明"><a href="#泛型的继承和通配符说明" class="headerlink" title="泛型的继承和通配符说明"></a>泛型的继承和通配符说明</h2><ol><li>泛型不具备继承性<br> <code>List&lt;Object&gt; list = new ArrayList&lt;String&gt;();//报错</code><br> 意思是尖括号里的类型要前后一致,继承也不行</li><li><code>&lt;?&gt;:支持任意泛型类型</code></li><li><code>&lt;? extends A&gt;:支持A类以及A类的子类,规定了泛型的上限(为A类,比A高就不能用了)</code></li><li><code>&lt;? super A&gt;:支持A类以及A类的父类,不限于直接父类,规定了泛型的下限(为A类,比A低就不能用了)</code></li></ol><h3 id="演示代码"><a href="#演示代码" class="headerlink" title="演示代码"></a>演示代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericExtends</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;xx&quot;</span>);</span><br><span class="line">        <span class="comment">//List&lt;Object&gt; list = new ArrayList&lt;String&gt;();//报错，原因是泛型不具备继承性</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//举例使用下面的三个方法</span></span><br><span class="line">        List&lt;Object&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; list3 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;A&gt; list4 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;B&gt; list5 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;C&gt; list6 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果是 List&lt;?&gt; c 类型的参数就可都可以</span></span><br><span class="line">        printCollection1(list1);</span><br><span class="line">        printCollection1(list2);</span><br><span class="line">        printCollection1(list3);</span><br><span class="line">        printCollection1(list4);</span><br><span class="line">        printCollection1(list5);</span><br><span class="line">        printCollection1(list6);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果是 List&lt;? extends A&gt; c 类型的参数，则只能A以及A的子类能够传入，所以前三个均报错</span></span><br><span class="line"><span class="comment">//        printCollection2(list1);</span></span><br><span class="line"><span class="comment">//        printCollection2(list2);</span></span><br><span class="line"><span class="comment">//        printCollection2(list3);</span></span><br><span class="line">        printCollection2(list4);</span><br><span class="line">        printCollection2(list5);</span><br><span class="line">        printCollection2(list6);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果是 List&lt;? super A&gt; c 类型的参数，则只能A以及A的父类才能够参入参数，所以list2\list3\list5\list6均报错</span></span><br><span class="line">        <span class="comment">//list1为Object类型是A的父类，list4是A类，所以吧报错</span></span><br><span class="line">        printCollection3(list1);</span><br><span class="line"><span class="comment">//        printCollection3(list2);</span></span><br><span class="line"><span class="comment">//        printCollection3(list3);</span></span><br><span class="line">        printCollection3(list4);</span><br><span class="line"><span class="comment">//        printCollection3(list5);</span></span><br><span class="line"><span class="comment">//        printCollection3(list6);</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//写几个测试方法</span></span><br><span class="line">    <span class="comment">//List&lt;?&gt;说明：标识任意的泛型类型都能接收</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printCollection1</span><span class="params">(List&lt;?&gt; c)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Object object : c)&#123; <span class="comment">//使用通配符，取出是就是Object</span></span><br><span class="line">            System.out.println(object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//支持A类以及A类的子类,规定了泛型的上限</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printCollection2</span><span class="params">(List&lt;? extends A&gt; c)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Object object : c)&#123;</span><br><span class="line">            System.out.println(object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//支持A类以及A类的父类,不限于直接父类,规定了泛型的下限</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printCollection3</span><span class="params">(List&lt;? <span class="built_in">super</span> A&gt; c)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Object object : c)&#123;</span><br><span class="line">            System.out.println(object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span>&#123;&#125;</span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;unused&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> <span class="keyword">extends</span> <span class="title class_">B</span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="泛型进阶尝试"><a href="#泛型进阶尝试" class="headerlink" title="泛型进阶尝试"></a>泛型进阶尝试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 张永锐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericExercise01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        DAO&lt;User&gt; userDAO = <span class="keyword">new</span> <span class="title class_">DAO</span>&lt;User&gt;();</span><br><span class="line">        <span class="comment">//使用save</span></span><br><span class="line">        userDAO.save(<span class="string">&quot;牛人&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">123</span>,<span class="number">25</span>,<span class="string">&quot;牛人&quot;</span>));</span><br><span class="line">        userDAO.save(<span class="string">&quot;Jack&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">125</span>,<span class="number">24</span>,<span class="string">&quot;Jack&quot;</span>));</span><br><span class="line">        userDAO.save(<span class="string">&quot;Smith&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">133</span>,<span class="number">19</span>,<span class="string">&quot;Smith&quot;</span>));</span><br><span class="line">        userDAO.save(<span class="string">&quot;Tom&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">159</span>,<span class="number">20</span>,<span class="string">&quot;Tom&quot;</span>));</span><br><span class="line">        userDAO.save(<span class="string">&quot;Mary&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">115</span>,<span class="number">49</span>,<span class="string">&quot;Mary&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用get</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----使用get----&quot;</span>);</span><br><span class="line">        System.out.println(userDAO.get(<span class="string">&quot;Jack&quot;</span>));</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDAO.get(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用update</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----使用update----&quot;</span>);</span><br><span class="line">        userDAO.update(<span class="string">&quot;牛人&quot;</span>,<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">110</span>,<span class="number">48</span>,<span class="string">&quot;牛人他爹&quot;</span>));</span><br><span class="line">        System.out.println(userDAO.get(<span class="string">&quot;牛人&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用list</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----使用list----&quot;</span>);</span><br><span class="line">        List&lt;User&gt; ts = userDAO.list();</span><br><span class="line">        <span class="keyword">for</span>(Object obj : ts)&#123;</span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用delete</span></span><br><span class="line">        System.out.println(<span class="string">&quot;----使用delete----&quot;</span>);</span><br><span class="line">        userDAO.delete(<span class="string">&quot;牛人&quot;</span>);</span><br><span class="line">        ts = userDAO.list();</span><br><span class="line">        <span class="keyword">for</span>(Object obj : ts)&#123;</span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DAO</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, T&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">//注意要让map指向对象实例（之前没有等号后面一段，程序就报错了）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(String id,T entity)</span>&#123;</span><br><span class="line">        map.put(id,entity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String id , T entity)</span>&#123;</span><br><span class="line">        map.put(id,entity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//要遍历map[k-v],将map中的所以value(T entity),封装到ArrayList中</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建ArrayList</span></span><br><span class="line">        ArrayList&lt;T&gt; ts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历map</span></span><br><span class="line">        Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line">        Iterator&lt;String&gt; iterator = keySet.iterator();</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) o;</span><br><span class="line">            ts.add(get(s));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ts;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        map.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> age, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>latex语法字典</title>
      <link href="/posts/3259212833.html"/>
      <url>/posts/3259212833.html</url>
      
        <content type="html"><![CDATA[<p>${\Large LaTex}$是一种高质量的排版格式，可以生成复杂的表格与数学公式，是当前电子与数学出版行业的事实标准。本文以 markdown 作为 LaTex 渲染引擎（一款用于标记语言文档转换的命令行工具），分门别类的总结了撰写$\colorbox{LimeGreen}{数学公式}$所需要经常使用到的 LaTeX 语法，方便写作相关科技类文章时随手查阅。</p><p>由于大部分内容都是使用表格的方式陈列的，且大部分表格都比较长，在排版的过程中分页方面会不太美观。</p><h2 id="保留字符"><a href="#保留字符" class="headerlink" title="保留字符"></a>保留字符</h2><p>LaTeX 环境中具有特殊含义的保留字符，不能直接使用，必须通过指定的语法实现：</p><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center"><script type="math/tex">\#</script></td><td style="text-align:center"><code>\#</code></td><td style="text-align:center"><strong>6</strong></td><td style="text-align:center"><script type="math/tex">\{</script></td><td style="text-align:center"><code>\&#123;</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center"><script type="math/tex">\%</script></td><td style="text-align:center"><code>\%</code></td><td style="text-align:center"><strong>7</strong></td><td style="text-align:center"><script type="math/tex">\}</script></td><td style="text-align:center"><code>\&#125;</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center"><script type="math/tex">^\wedge</script></td><td style="text-align:center"><code>^\wedge</code></td><td style="text-align:center"><strong>8</strong></td><td style="text-align:center"><script type="math/tex">\sim</script></td><td style="text-align:center"><code>\sim</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center"><script type="math/tex">\&</script></td><td style="text-align:center"><code>\&amp;</code></td><td style="text-align:center"><strong>9</strong></td><td style="text-align:center"><script type="math/tex">\backslash</script></td><td style="text-align:center"><code>\backslash</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center"><script type="math/tex">\_</script></td><td style="text-align:center"><code>\_</code></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table></div><h2 id="希腊字母"><a href="#希腊字母" class="headerlink" title="希腊字母"></a>希腊字母</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">标准符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">首字母大写</th><th style="text-align:center">LaTeX</th><th style="text-align:center">使用 <code>var</code> 前缀</th><th style="text-align:center">LaTeX</th><th style="text-align:center">读音</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$\alpha$</td><td style="text-align:center"><code>\alpha</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/ˈælfə/</td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\beta$</td><td style="text-align:center"><code>\beta</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/ˈbeɪtə/</td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\gamma$</td><td style="text-align:center"><code>\gamma</code></td><td style="text-align:center">$\Gamma$</td><td style="text-align:center"><code>\Gamma</code></td><td style="text-align:center">$\varGamma$</td><td style="text-align:center"><code>\varGamma</code></td><td style="text-align:center">/ˈɡæmə/</td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\delta$</td><td style="text-align:center"><code>\delta</code></td><td style="text-align:center">$\Delta$</td><td style="text-align:center"><code>\Delta</code></td><td style="text-align:center">$\varDelta$</td><td style="text-align:center"><code>\varDelta</code></td><td style="text-align:center">/ˈdɛltə/</td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\epsilon$</td><td style="text-align:center"><code>\epsilon</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">$\varepsilon$</td><td style="text-align:center"><code>\varepsilon</code></td><td style="text-align:center">/ˈɛpsɪlɒn/</td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\zeta$</td><td style="text-align:center"><code>\zeta</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/ˈzeɪtə/</td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\eta$</td><td style="text-align:center"><code>\eta</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/ˈeɪtə/</td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">θ</td><td style="text-align:center"><code>\theta</code></td><td style="text-align:center">$\Theta$</td><td style="text-align:center"><code>\Theta</code></td><td style="text-align:center">$\vartheta$、$\varTheta$</td><td style="text-align:center"><code>\vartheta</code>、<code>\varTheta</code></td><td style="text-align:center">/ˈθiːtə/</td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$\iota$</td><td style="text-align:center"><code>\iota</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/aɪˈoʊtə/</td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\kappa$</td><td style="text-align:center"><code>\kappa</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">$\varkappa$</td><td style="text-align:center"><code>\varkappa</code></td><td style="text-align:center">/ˈkæpə/</td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\lambda$</td><td style="text-align:center"><code>\lambda</code></td><td style="text-align:center">$\Lambda$</td><td style="text-align:center"><code>\Lambda</code></td><td style="text-align:center">$\varLambda$</td><td style="text-align:center"><code>\varLambda</code></td><td style="text-align:center">/ˈlæmdə/</td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\mu$</td><td style="text-align:center"><code>\mu</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/mjuː/</td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\nu$</td><td style="text-align:center"><code>\nu</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/njuː/</td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\xi$</td><td style="text-align:center"><code>\xi</code></td><td style="text-align:center">$\Xi$</td><td style="text-align:center"><code>\Xi</code></td><td style="text-align:center">$\varXi$</td><td style="text-align:center"><code>\varXi</code></td><td style="text-align:center">/zaɪ, ksaɪ/</td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$o$</td><td style="text-align:center"><code>o</code></td><td style="text-align:center">$O$</td><td style="text-align:center"><code>O</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/ˈɒmɪkrɒn/</td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\pi$</td><td style="text-align:center"><code>\pi</code></td><td style="text-align:center">$\Pi$</td><td style="text-align:center"><code>\Pi</code></td><td style="text-align:center">$\varpi$、$\varPi$</td><td style="text-align:center"><code>\varpi</code>、<code>\varPi</code></td><td style="text-align:center">/paɪ/</td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\rho$</td><td style="text-align:center"><code>\rho</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">$\varrho$</td><td style="text-align:center"><code>\varrho</code></td><td style="text-align:center">/roʊ/</td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\sigma$</td><td style="text-align:center"><code>\sigma</code></td><td style="text-align:center">$\Sigma$</td><td style="text-align:center"><code>\Sigma</code></td><td style="text-align:center">$\varsigma$、$\varSigma$</td><td style="text-align:center"><code>\varsigma</code>、<code>\varSigma</code></td><td style="text-align:center">/ˈsɪɡmə/</td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\tau$</td><td style="text-align:center"><code>\tau</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/taʊ, tɔː/</td></tr><tr><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\upsilon$</td><td style="text-align:center"><code>\upsilon</code></td><td style="text-align:center">$\Upsilon$</td><td style="text-align:center"><code>\Upsilon</code></td><td style="text-align:center">$\varUpsilon$</td><td style="text-align:center"><code>\varUpsilon</code></td><td style="text-align:center">/ˈʌpsɪlɒn/</td></tr><tr><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\phi$</td><td style="text-align:center"><code>\phi</code></td><td style="text-align:center">$\Phi$</td><td style="text-align:center"><code>\Phi</code></td><td style="text-align:center">$\varphi$、$\varPhi$</td><td style="text-align:center"><code>\varphi</code>、<code>\varPhi</code></td><td style="text-align:center">/faɪ/</td></tr><tr><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\chi$</td><td style="text-align:center"><code>\chi</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/kaɪ/</td></tr><tr><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\psi$</td><td style="text-align:center"><code>\psi</code></td><td style="text-align:center">$\Psi$</td><td style="text-align:center"><code>\Psi</code></td><td style="text-align:center">$\varPsi$</td><td style="text-align:center"><code>\varPsi</code></td><td style="text-align:center">/psaɪ/</td></tr><tr><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\omega$</td><td style="text-align:center"><code>\omega</code></td><td style="text-align:center">$\Omega$</td><td style="text-align:center"><code>\Omega</code></td><td style="text-align:center">$\varOmega$</td><td style="text-align:center"><code>\varOmega</code></td><td style="text-align:center">/oʊˈmeɪɡə/</td></tr><tr><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$\digamma$</td><td style="text-align:center"><code>\digamma</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">/daɪ’gæmə/</td></tr></tbody></table></div><h2 id="希伯来字母"><a href="#希伯来字母" class="headerlink" title="希伯来字母"></a>希伯来字母</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">英文</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">英文</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$\aleph$</td><td style="text-align:center"><code>\aleph</code></td><td style="text-align:center">aleph</td><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\gimel$</td><td style="text-align:center"><code>\gimel</code></td><td style="text-align:center">gimel</td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\beth$</td><td style="text-align:center"><code>\beth</code></td><td style="text-align:center">beth</td><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\daleth$</td><td style="text-align:center"><code>\daleth</code></td><td style="text-align:center">daleth</td></tr></tbody></table></div><h2 id="二元运算符"><a href="#二元运算符" class="headerlink" title="二元运算符"></a>二元运算符</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$+$</td><td style="text-align:center"><code>+</code></td><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\bullet$</td><td style="text-align:center"><code>\bullet</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$−$</td><td style="text-align:center"><code>-</code></td><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\oplus$</td><td style="text-align:center"><code>\oplus</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\times$</td><td style="text-align:center"><code>\times</code></td><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\ominus$</td><td style="text-align:center"><code>\ominus</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\div$</td><td style="text-align:center"><code>\div</code></td><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\odot$</td><td style="text-align:center"><code>\odot</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\pm$</td><td style="text-align:center"><code>\pm</code></td><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\oslash$</td><td style="text-align:center"><code>\oslash</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\mp$</td><td style="text-align:center"><code>\mp</code></td><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$\otimes$</td><td style="text-align:center"><code>\otimes</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\triangleleft$</td><td style="text-align:center"><code>\triangleleft</code></td><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\bigcirc$</td><td style="text-align:center"><code>\bigcirc</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">$\triangleright$</td><td style="text-align:center"><code>\triangleright</code></td><td style="text-align:center"><strong>27</strong></td><td style="text-align:center">$\diamond$</td><td style="text-align:center"><code>\diamond</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$\cdot$</td><td style="text-align:center"><code>\cdot</code></td><td style="text-align:center"><strong>28</strong></td><td style="text-align:center">$\uplus$</td><td style="text-align:center"><code>\uplus</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\setminus$</td><td style="text-align:center"><code>\setminus</code></td><td style="text-align:center"><strong>29</strong></td><td style="text-align:center">$\bigtriangleup$</td><td style="text-align:center"><code>\bigtriangleup</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\star$</td><td style="text-align:center"><code>\star</code></td><td style="text-align:center"><strong>30</strong></td><td style="text-align:center">$\bigtriangledown$</td><td style="text-align:center"><code>\bigtriangledown</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\ast$</td><td style="text-align:center"><code>\ast</code></td><td style="text-align:center"><strong>31</strong></td><td style="text-align:center">$\lhd$</td><td style="text-align:center"><code>\lhd</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\cup$</td><td style="text-align:center"><code>\cup</code></td><td style="text-align:center"><strong>32</strong></td><td style="text-align:center">$\rhd$</td><td style="text-align:center"><code>\rhd</code></td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\cap$</td><td style="text-align:center"><code>\cap</code></td><td style="text-align:center"><strong>33</strong></td><td style="text-align:center">$\unlhd$</td><td style="text-align:center"><code>\unlhd</code></td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$\sqcup$</td><td style="text-align:center"><code>\sqcup</code></td><td style="text-align:center"><strong>34</strong></td><td style="text-align:center">$\unrhd$</td><td style="text-align:center"><code>\unrhd</code></td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\sqcap$</td><td style="text-align:center"><code>\sqcap</code></td><td style="text-align:center"><strong>35</strong></td><td style="text-align:center">$\amalg$</td><td style="text-align:center"><code>\amalg</code></td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\vee$</td><td style="text-align:center"><code>\vee</code></td><td style="text-align:center"><strong>36</strong></td><td style="text-align:center">$\wr$</td><td style="text-align:center"><code>\wr</code></td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\wedge$</td><td style="text-align:center"><code>\wedge</code></td><td style="text-align:center"><strong>37</strong></td><td style="text-align:center">$\dagger$</td><td style="text-align:center"><code>\dagger</code></td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\circ$</td><td style="text-align:center"><code>\circ</code></td><td style="text-align:center"><strong>38</strong></td><td style="text-align:center">$\ddagger$</td><td style="text-align:center"><code>\ddagger</code></td></tr></tbody></table></div><h2 id="二元关系符"><a href="#二元关系符" class="headerlink" title="二元关系符"></a>二元关系符</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$=$</td><td style="text-align:center"><code>=</code></td><td style="text-align:center"><strong>49</strong></td><td style="text-align:center">$\gneq$</td><td style="text-align:center"><code>\gneq</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\ne$</td><td style="text-align:center"><code>\ne</code></td><td style="text-align:center"><strong>50</strong></td><td style="text-align:center">$\geqq$</td><td style="text-align:center"><code>\geqq</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\neq$</td><td style="text-align:center"><code>\neq</code></td><td style="text-align:center"><strong>51</strong></td><td style="text-align:center">$\ngeq$</td><td style="text-align:center"><code>\ngeq</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\equiv$</td><td style="text-align:center"><code>\equiv</code></td><td style="text-align:center"><strong>52</strong></td><td style="text-align:center">$\ngeqq$</td><td style="text-align:center"><code>\ngeqq</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\not\equiv$</td><td style="text-align:center"><code>\not\equiv</code></td><td style="text-align:center"><strong>53</strong></td><td style="text-align:center">$\gneqq$</td><td style="text-align:center"><code>\gneqq</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\doteq$</td><td style="text-align:center"><code>\doteq</code></td><td style="text-align:center"><strong>54</strong></td><td style="text-align:center">$\gvertneqq$</td><td style="text-align:center"><code>\gvertneqq</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\doteqdot$</td><td style="text-align:center"><code>\doteqdot</code></td><td style="text-align:center"><strong>55</strong></td><td style="text-align:center">$\lessgtr$</td><td style="text-align:center"><code>\lessgtr</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">$\overset{\underset{\mathrm{def}}{}}{=}$</td><td style="text-align:center"><code>\overset&#123;\underset&#123;\mathrm&#123;def&#125;&#125;&#123;&#125;&#125;&#123;=&#125;</code></td><td style="text-align:center"><strong>56</strong></td><td style="text-align:center">$\lesseqgtr$</td><td style="text-align:center"><code>\lesseqgtr</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$:=$</td><td style="text-align:center"><code>:=</code></td><td style="text-align:center"><strong>57</strong></td><td style="text-align:center">$\lesseqqgtr$</td><td style="text-align:center"><code>\lesseqqgtr</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\sim$</td><td style="text-align:center"><code>\sim</code></td><td style="text-align:center"><strong>58</strong></td><td style="text-align:center">$\gtrless$</td><td style="text-align:center"><code>\gtrless</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\nsim$</td><td style="text-align:center"><code>\nsim</code></td><td style="text-align:center"><strong>59</strong></td><td style="text-align:center">$\gtreqless$</td><td style="text-align:center"><code>\gtreqless</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\backsim$</td><td style="text-align:center"><code>\backsim</code></td><td style="text-align:center"><strong>60</strong></td><td style="text-align:center">$\gtreqqless$</td><td style="text-align:center"><code>\gtreqqless</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\thicksim$</td><td style="text-align:center"><code>\thicksim</code></td><td style="text-align:center"><strong>61</strong></td><td style="text-align:center">$\leqslant$</td><td style="text-align:center"><code>\leqslant</code></td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\simeq$</td><td style="text-align:center"><code>\simeq</code></td><td style="text-align:center"><strong>62</strong></td><td style="text-align:center">$\nleqslant$</td><td style="text-align:center"><code>\nleqslant</code></td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$\eqsim$</td><td style="text-align:center"><code>\backsimeq</code></td><td style="text-align:center"><strong>63</strong></td><td style="text-align:center">$\eqslantless$</td><td style="text-align:center"><code>\eqslantless</code></td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\eqsim$</td><td style="text-align:center"><code>\eqsim</code></td><td style="text-align:center"><strong>64</strong></td><td style="text-align:center">$\geqslant$</td><td style="text-align:center"><code>\geqslant</code></td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\cong$</td><td style="text-align:center"><code>\cong</code></td><td style="text-align:center"><strong>65</strong></td><td style="text-align:center">$\ngeqslant$</td><td style="text-align:center"><code>\ngeqslant</code></td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\ncong$</td><td style="text-align:center"><code>\ncong</code></td><td style="text-align:center"><strong>66</strong></td><td style="text-align:center">$\eqslantgtr$</td><td style="text-align:center"><code>\eqslantgtr</code></td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\approx$</td><td style="text-align:center"><code>\approx</code></td><td style="text-align:center"><strong>67</strong></td><td style="text-align:center">$\lesssim$</td><td style="text-align:center"><code>\lesssim</code></td></tr><tr><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\thickapprox$</td><td style="text-align:center"><code>\thickapprox</code></td><td style="text-align:center"><strong>68</strong></td><td style="text-align:center">$\lnsim$</td><td style="text-align:center"><code>\lnsim</code></td></tr><tr><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\approxeq$</td><td style="text-align:center"><code>\approxeq</code></td><td style="text-align:center"><strong>69</strong></td><td style="text-align:center">$\lessapprox$</td><td style="text-align:center"><code>\lessapprox</code></td></tr><tr><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\asymp$</td><td style="text-align:center"><code>\asymp</code></td><td style="text-align:center"><strong>70</strong></td><td style="text-align:center">$\lnapprox$</td><td style="text-align:center"><code>\lnapprox</code></td></tr><tr><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\propto$</td><td style="text-align:center"><code>\propto</code></td><td style="text-align:center"><strong>71</strong></td><td style="text-align:center">$\gtrsim$</td><td style="text-align:center"><code>\gtrsim</code></td></tr><tr><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\varpropto$</td><td style="text-align:center"><code>\varpropto</code></td><td style="text-align:center"><strong>72</strong></td><td style="text-align:center">$\gnsim$</td><td style="text-align:center"><code>\gnsim</code></td></tr><tr><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$&lt;$</td><td style="text-align:center"><code>&lt;</code></td><td style="text-align:center"><strong>73</strong></td><td style="text-align:center">$\gtrapprox$</td><td style="text-align:center"><code>\gtrapprox</code></td></tr><tr><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\nless$</td><td style="text-align:center"><code>\nless</code></td><td style="text-align:center"><strong>74</strong></td><td style="text-align:center">$\gnapprox$</td><td style="text-align:center"><code>\gnapprox</code></td></tr><tr><td style="text-align:center"><strong>27</strong></td><td style="text-align:center">$\ll$</td><td style="text-align:center"><code>\ll</code></td><td style="text-align:center"><strong>75</strong></td><td style="text-align:center">$\prec$</td><td style="text-align:center"><code>\prec</code></td></tr><tr><td style="text-align:center"><strong>28</strong></td><td style="text-align:center">$\not\ll$</td><td style="text-align:center"><code>\not\ll</code></td><td style="text-align:center"><strong>76</strong></td><td style="text-align:center">$\nprec$</td><td style="text-align:center"><code>\nprec</code></td></tr><tr><td style="text-align:center"><strong>29</strong></td><td style="text-align:center">$\lll$</td><td style="text-align:center"><code>\lll</code></td><td style="text-align:center"><strong>77</strong></td><td style="text-align:center">$\preceq$</td><td style="text-align:center"><code>\preceq</code></td></tr><tr><td style="text-align:center"><strong>30</strong></td><td style="text-align:center">$\not\lll$</td><td style="text-align:center"><code>\not\lll</code></td><td style="text-align:center"><strong>78</strong></td><td style="text-align:center">$\npreceq$</td><td style="text-align:center"><code>\npreceq</code></td></tr><tr><td style="text-align:center"><strong>31</strong></td><td style="text-align:center">$\lessdot$</td><td style="text-align:center"><code>\lessdot</code></td><td style="text-align:center"><strong>79</strong></td><td style="text-align:center">$\precneqq$</td><td style="text-align:center"><code>\precneqq</code></td></tr><tr><td style="text-align:center"><strong>32</strong></td><td style="text-align:center">$&gt;$</td><td style="text-align:center"><code>&gt;</code></td><td style="text-align:center"><strong>80</strong></td><td style="text-align:center">$\succ$</td><td style="text-align:center"><code>\succ</code></td></tr><tr><td style="text-align:center"><strong>33</strong></td><td style="text-align:center">$\ngtr$</td><td style="text-align:center"><code>\ngtr</code></td><td style="text-align:center"><strong>81</strong></td><td style="text-align:center">$\nsucc$</td><td style="text-align:center"><code>\nsucc</code></td></tr><tr><td style="text-align:center"><strong>34</strong></td><td style="text-align:center">$\gg$</td><td style="text-align:center"><code>\gg</code></td><td style="text-align:center"><strong>82</strong></td><td style="text-align:center">$\succeq$</td><td style="text-align:center"><code>\succeq</code></td></tr><tr><td style="text-align:center"><strong>35</strong></td><td style="text-align:center">$\not\gg$</td><td style="text-align:center"><code>\not\gg</code></td><td style="text-align:center"><strong>83</strong></td><td style="text-align:center">$\nsucceq$</td><td style="text-align:center"><code>\nsucceq</code></td></tr><tr><td style="text-align:center"><strong>36</strong></td><td style="text-align:center">$\ggg$</td><td style="text-align:center"><code>\ggg</code></td><td style="text-align:center"><strong>84</strong></td><td style="text-align:center">$\succneqq$</td><td style="text-align:center"><code>\succneqq</code></td></tr><tr><td style="text-align:center"><strong>37</strong></td><td style="text-align:center">$\not\ggg$</td><td style="text-align:center"><code>\not\ggg</code></td><td style="text-align:center"><strong>85</strong></td><td style="text-align:center">$\preccurlyeq$</td><td style="text-align:center"><code>\preccurlyeq</code></td></tr><tr><td style="text-align:center"><strong>38</strong></td><td style="text-align:center">$\gtrdot$</td><td style="text-align:center"><code>\gtrdot</code></td><td style="text-align:center"><strong>86</strong></td><td style="text-align:center">$\curlyeqprec$</td><td style="text-align:center"><code>\curlyeqprec</code></td></tr><tr><td style="text-align:center"><strong>39</strong></td><td style="text-align:center">$\le$</td><td style="text-align:center"><code>\le</code></td><td style="text-align:center"><strong>87</strong></td><td style="text-align:center">$\succcurlyeq$</td><td style="text-align:center"><code>\succcurlyeq</code></td></tr><tr><td style="text-align:center"><strong>40</strong></td><td style="text-align:center">$\leq$</td><td style="text-align:center"><code>\leq</code></td><td style="text-align:center"><strong>88</strong></td><td style="text-align:center">$\curlyeqsucc$</td><td style="text-align:center"><code>\curlyeqsucc</code></td></tr><tr><td style="text-align:center"><strong>41</strong></td><td style="text-align:center">$\lneq$</td><td style="text-align:center"><code>\lneq</code></td><td style="text-align:center"><strong>89</strong></td><td style="text-align:center">$\precsim$</td><td style="text-align:center"><code>\precsim</code></td></tr><tr><td style="text-align:center"><strong>42</strong></td><td style="text-align:center">$\leqq$</td><td style="text-align:center"><code>\leqq</code></td><td style="text-align:center"><strong>90</strong></td><td style="text-align:center">$\precnsim$</td><td style="text-align:center"><code>\precnsim</code></td></tr><tr><td style="text-align:center"><strong>43</strong></td><td style="text-align:center">$\nleq$</td><td style="text-align:center"><code>\nleq</code></td><td style="text-align:center"><strong>91</strong></td><td style="text-align:center">$\precapprox$</td><td style="text-align:center"><code>\precapprox</code></td></tr><tr><td style="text-align:center"><strong>44</strong></td><td style="text-align:center">$\nleqq$</td><td style="text-align:center"><code>\nleqq</code></td><td style="text-align:center"><strong>92</strong></td><td style="text-align:center">$\precnapprox$</td><td style="text-align:center"><code>\precnapprox</code></td></tr><tr><td style="text-align:center"><strong>45</strong></td><td style="text-align:center">$\lneqq$</td><td style="text-align:center"><code>\lneqq</code></td><td style="text-align:center"><strong>93</strong></td><td style="text-align:center">$\succsim$</td><td style="text-align:center"><code>\succsim</code></td></tr><tr><td style="text-align:center"><strong>46</strong></td><td style="text-align:center">$\lvertneqq$</td><td style="text-align:center"><code>\lvertneqq</code></td><td style="text-align:center"><strong>94</strong></td><td style="text-align:center">$\succnsim$</td><td style="text-align:center"><code>\succnsim</code></td></tr><tr><td style="text-align:center"><strong>47</strong></td><td style="text-align:center">$\ge$</td><td style="text-align:center"><code>\ge</code></td><td style="text-align:center"><strong>95</strong></td><td style="text-align:center">$\succapprox$</td><td style="text-align:center"><code>\succapprox</code></td></tr><tr><td style="text-align:center"><strong>48</strong></td><td style="text-align:center">$\geq$</td><td style="text-align:center"><code>\geq</code></td><td style="text-align:center"><strong>96</strong></td><td style="text-align:center">$\succnapprox$</td><td style="text-align:center"><code>\succnapprox</code></td></tr></tbody></table></div><h2 id="几何符号"><a href="#几何符号" class="headerlink" title="几何符号"></a>几何符号</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$\parallel$</td><td style="text-align:center"><code>\parallel</code></td><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\lozenge$</td><td style="text-align:center"><code>\lozenge</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\nparallel$</td><td style="text-align:center"><code>\nparallel</code></td><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$\blacklozenge$</td><td style="text-align:center"><code>\blacklozenge</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\shortparallel$</td><td style="text-align:center"><code>\shortparallel</code></td><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\bigstar$</td><td style="text-align:center"><code>\bigstar</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\nshortparallel$</td><td style="text-align:center"><code>\nshortparallel</code></td><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\bigcirc$</td><td style="text-align:center"><code>\bigcirc</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\perp$</td><td style="text-align:center"><code>\perp</code></td><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\triangle$</td><td style="text-align:center"><code>\triangle</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\angle$</td><td style="text-align:center"><code>\angle</code></td><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\bigtriangleup$</td><td style="text-align:center"><code>\bigtriangleup</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\sphericalangle$</td><td style="text-align:center"><code>\sphericalangle</code></td><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\bigtriangledown$</td><td style="text-align:center"><code>\bigtriangledown</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">$\measuredangle$</td><td style="text-align:center"><code>\measuredangle</code></td><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\vartriangle$</td><td style="text-align:center"><code>\vartriangle</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$45^\circ$</td><td style="text-align:center"><code>45^\circ</code></td><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\triangledown$</td><td style="text-align:center"><code>\triangledown</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\Box$</td><td style="text-align:center"><code>\Box</code></td><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\blacktriangle$</td><td style="text-align:center"><code>\blacktriangle</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\blacksquare$</td><td style="text-align:center"><code>\blacksquare</code></td><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\blacktriangledown$</td><td style="text-align:center"><code>\blacktriangledown</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\diamond$</td><td style="text-align:center"><code>\diamond</code></td><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$\blacktriangleleft$</td><td style="text-align:center"><code>\blacktriangleleft</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\Diamond\lozenge$</td><td style="text-align:center"><code>\Diamond \lozenge</code></td><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\blacktriangleright$</td><td style="text-align:center"><code>\blacktriangleright</code></td></tr></tbody></table></div><h2 id="逻辑符号"><a href="#逻辑符号" class="headerlink" title="逻辑符号"></a>逻辑符号</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$\forall$</td><td style="text-align:center"><code>\forall</code></td><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\neg$</td><td style="text-align:center"><code>\neg</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\exists$</td><td style="text-align:center"><code>\exists</code></td><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\not\operatorname{R}$</td><td style="text-align:center"><code>\not\operatorname&#123;R&#125;</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\nexists$</td><td style="text-align:center"><code>\nexists</code></td><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\bot$</td><td style="text-align:center"><code>\bot</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\therefore$</td><td style="text-align:center"><code>\therefore</code></td><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\top$</td><td style="text-align:center"><code>\top</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\because$</td><td style="text-align:center"><code>\because</code></td><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\vdash$</td><td style="text-align:center"><code>\vdash</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\And$</td><td style="text-align:center"><code>\And</code></td><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$\dashv$</td><td style="text-align:center"><code>\dashv</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\lor$</td><td style="text-align:center"><code>\lor</code></td><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\vDash$</td><td style="text-align:center"><code>\vDash</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">$\vee$</td><td style="text-align:center"><code>\vee</code></td><td style="text-align:center"><strong>27</strong></td><td style="text-align:center">$\vdash$</td><td style="text-align:center"><code>\Vdash</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$\curlyvee$</td><td style="text-align:center"><code>\curlyvee</code></td><td style="text-align:center"><strong>28</strong></td><td style="text-align:center">$\models$</td><td style="text-align:center"><code>\models</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\bigvee$</td><td style="text-align:center"><code>\bigvee</code></td><td style="text-align:center"><strong>29</strong></td><td style="text-align:center">$\Vvdash$</td><td style="text-align:center"><code>\Vvdash</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\land$</td><td style="text-align:center"><code>\land</code></td><td style="text-align:center"><strong>30</strong></td><td style="text-align:center">$\nvdash$</td><td style="text-align:center"><code>\nvdash</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\wedge$</td><td style="text-align:center"><code>\wedge</code></td><td style="text-align:center"><strong>31</strong></td><td style="text-align:center">$\nVdash$</td><td style="text-align:center"><code>\nVdash</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\curlywedge$</td><td style="text-align:center"><code>\curlywedge</code></td><td style="text-align:center"><strong>32</strong></td><td style="text-align:center">$\nvdash$</td><td style="text-align:center"><code>\nvDash</code></td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\bigwedge$</td><td style="text-align:center"><code>\bigwedge</code></td><td style="text-align:center"><strong>33</strong></td><td style="text-align:center">$\nVDash$</td><td style="text-align:center"><code>\nVDash</code></td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$\bar{q}$</td><td style="text-align:center"><code>\bar&#123;q&#125;</code></td><td style="text-align:center"><strong>34</strong></td><td style="text-align:center">$\ulcorner$</td><td style="text-align:center"><code>\ulcorner</code></td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\bar{abc}$</td><td style="text-align:center"><code>\bar&#123;abc&#125;</code></td><td style="text-align:center"><strong>35</strong></td><td style="text-align:center">$\urcorner$</td><td style="text-align:center"><code>\urcorner</code></td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\overline{q}$</td><td style="text-align:center"><code>\overline&#123;q&#125;</code></td><td style="text-align:center"><strong>36</strong></td><td style="text-align:center">$\llcorner$</td><td style="text-align:center"><code>\llcorner</code></td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\overline{abc}$</td><td style="text-align:center"><code>\overline&#123;abc&#125;</code></td><td style="text-align:center"><strong>37</strong></td><td style="text-align:center">$\lrcorner$</td><td style="text-align:center"><code>\lrcorner</code></td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\lnot$</td><td style="text-align:center"><code>\lnot</code></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table></div><h2 id="集合符号"><a href="#集合符号" class="headerlink" title="集合符号"></a>集合符号</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">${}$</td><td style="text-align:center"><code>\&#123; \&#125;</code></td><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\sqsubset$</td><td style="text-align:center"><code>\sqsubset</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\emptyset$</td><td style="text-align:center"><code>\emptyset</code></td><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\supset$</td><td style="text-align:center"><code>\supset</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\varnothing$</td><td style="text-align:center"><code>\varnothing</code></td><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$\Supset$</td><td style="text-align:center"><code>\Supset</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\in$</td><td style="text-align:center"><code>\in</code></td><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\sqsupset$</td><td style="text-align:center"><code>\sqsupset</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\notin$</td><td style="text-align:center"><code>\notin</code></td><td style="text-align:center"><strong>27</strong></td><td style="text-align:center">$\subseteq$</td><td style="text-align:center"><code>\subseteq</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\ni$</td><td style="text-align:center"><code>\ni</code></td><td style="text-align:center"><strong>28</strong></td><td style="text-align:center">$\nsubseteq$</td><td style="text-align:center"><code>\nsubseteq</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\cap$</td><td style="text-align:center"><code>\cap</code></td><td style="text-align:center"><strong>29</strong></td><td style="text-align:center">$\subsetneq$</td><td style="text-align:center"><code>\subsetneq</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">$\Cap$</td><td style="text-align:center"><code>\Cap</code></td><td style="text-align:center"><strong>30</strong></td><td style="text-align:center">$\varsubsetneq$</td><td style="text-align:center"><code>\varsubsetneq</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$\sqcap$</td><td style="text-align:center"><code>\sqcap</code></td><td style="text-align:center"><strong>31</strong></td><td style="text-align:center">$\sqsubseteq$</td><td style="text-align:center"><code>\sqsubseteq</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\bigcap$</td><td style="text-align:center"><code>\bigcap</code></td><td style="text-align:center"><strong>32</strong></td><td style="text-align:center">$\supseteq$</td><td style="text-align:center"><code>\supseteq</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\cup$</td><td style="text-align:center"><code>\cup</code></td><td style="text-align:center"><strong>33</strong></td><td style="text-align:center">$\nsupseteq$</td><td style="text-align:center"><code>\nsupseteq</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\Cup$</td><td style="text-align:center"><code>\Cup</code></td><td style="text-align:center"><strong>34</strong></td><td style="text-align:center">$\supsetneq$</td><td style="text-align:center"><code>\supsetneq</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\sqcup$</td><td style="text-align:center"><code>\sqcup</code></td><td style="text-align:center"><strong>35</strong></td><td style="text-align:center">$\varsupsetneq$</td><td style="text-align:center"><code>\varsupsetneq</code></td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\bigcup$</td><td style="text-align:center"><code>\bigcup</code></td><td style="text-align:center"><strong>36</strong></td><td style="text-align:center">$\sqsupseteq$</td><td style="text-align:center"><code>\sqsupseteq</code></td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$\bigsqcup$</td><td style="text-align:center"><code>\bigsqcup</code></td><td style="text-align:center"><strong>37</strong></td><td style="text-align:center">$\subseteqq$</td><td style="text-align:center"><code>\subseteqq</code></td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\uplus$</td><td style="text-align:center"><code>\uplus</code></td><td style="text-align:center"><strong>38</strong></td><td style="text-align:center">$\nsubseteqq$</td><td style="text-align:center"><code>\nsubseteqq</code></td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\biguplus$</td><td style="text-align:center"><code>\biguplus</code></td><td style="text-align:center"><strong>39</strong></td><td style="text-align:center">$\subsetneqq$</td><td style="text-align:center"><code>\subsetneqq</code></td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\setminus$</td><td style="text-align:center"><code>\setminus</code></td><td style="text-align:center"><strong>40</strong></td><td style="text-align:center">$\varsubsetneqq$</td><td style="text-align:center"><code>\varsubsetneqq</code></td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\smallsetminus$</td><td style="text-align:center"><code>\smallsetminus</code></td><td style="text-align:center"><strong>41</strong></td><td style="text-align:center">$\supseteqq$</td><td style="text-align:center"><code>\supseteqq</code></td></tr><tr><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\times$</td><td style="text-align:center"><code>\times</code></td><td style="text-align:center"><strong>42</strong></td><td style="text-align:center">$\nsupseteqq$</td><td style="text-align:center"><code>\nsupseteqq</code></td></tr><tr><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\subset$</td><td style="text-align:center"><code>\subset</code></td><td style="text-align:center"><strong>43</strong></td><td style="text-align:center">$\supsetneqq$</td><td style="text-align:center"><code>\supsetneqq</code></td></tr><tr><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\Subset$</td><td style="text-align:center"><code>\Subset</code></td><td style="text-align:center"><strong>44</strong></td><td style="text-align:center">$\varsupsetneqq$</td><td style="text-align:center"><code>\varsupsetneqq</code></td></tr></tbody></table></div><h2 id="箭头符号"><a href="#箭头符号" class="headerlink" title="箭头符号"></a>箭头符号</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">⇛</td><td style="text-align:center"><code>\Rrightarrow</code></td><td style="text-align:center"><strong>36</strong></td><td style="text-align:center">⟼</td><td style="text-align:center"><code>\longmapsto</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">⇚</td><td style="text-align:center"><code>\Lleftarrow</code></td><td style="text-align:center"><strong>37</strong></td><td style="text-align:center">⇀</td><td style="text-align:center"><code>\rightharpoonup</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">⇒</td><td style="text-align:center"><code>\Rightarrow</code></td><td style="text-align:center"><strong>38</strong></td><td style="text-align:center">⇁</td><td style="text-align:center"><code>\rightharpoondown</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">⇏</td><td style="text-align:center"><code>\nRightarrow</code></td><td style="text-align:center"><strong>39</strong></td><td style="text-align:center">↼</td><td style="text-align:center"><code>\leftharpoonup</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">⟹</td><td style="text-align:center"><code>\Longrightarrow</code></td><td style="text-align:center"><strong>40</strong></td><td style="text-align:center">↽</td><td style="text-align:center"><code>\leftharpoondown</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">⟹</td><td style="text-align:center"><code>\implies</code></td><td style="text-align:center"><strong>41</strong></td><td style="text-align:center">↿</td><td style="text-align:center"><code>\upharpoonleft</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">⇐</td><td style="text-align:center"><code>\Leftarrow</code></td><td style="text-align:center"><strong>42</strong></td><td style="text-align:center">↾</td><td style="text-align:center"><code>\upharpoonright</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">⇍</td><td style="text-align:center"><code>\nLeftarrow</code></td><td style="text-align:center"><strong>43</strong></td><td style="text-align:center">⇃</td><td style="text-align:center"><code>\downharpoonleft</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">⟸</td><td style="text-align:center"><code>\Longleftarrow</code></td><td style="text-align:center"><strong>44</strong></td><td style="text-align:center">⇂</td><td style="text-align:center"><code>\downharpoonright</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">⇔</td><td style="text-align:center"><code>\Leftrightarrow</code></td><td style="text-align:center"><strong>45</strong></td><td style="text-align:center">⇌</td><td style="text-align:center"><code>\rightleftharpoons</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">⇎</td><td style="text-align:center"><code>\nLeftrightarrow</code></td><td style="text-align:center"><strong>46</strong></td><td style="text-align:center">⇋</td><td style="text-align:center"><code>\leftrightharpoons</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">⟺</td><td style="text-align:center"><code>\Longleftrightarrow</code></td><td style="text-align:center"><strong>47</strong></td><td style="text-align:center">↶</td><td style="text-align:center"><code>\curvearrowleft</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">⟺</td><td style="text-align:center"><code>\iff</code></td><td style="text-align:center"><strong>48</strong></td><td style="text-align:center">↺</td><td style="text-align:center"><code>\circlearrowleft</code></td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">⇑</td><td style="text-align:center"><code>\Uparrow</code></td><td style="text-align:center"><strong>49</strong></td><td style="text-align:center">↰</td><td style="text-align:center"><code>\Lsh</code></td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">⇓</td><td style="text-align:center"><code>\Downarrow</code></td><td style="text-align:center"><strong>50</strong></td><td style="text-align:center">⇈</td><td style="text-align:center"><code>\upuparrows</code></td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">⇕</td><td style="text-align:center"><code>\Updownarrow</code></td><td style="text-align:center"><strong>51</strong></td><td style="text-align:center">⇉</td><td style="text-align:center"><code>\rightrightarrows</code></td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">→</td><td style="text-align:center"><code>\rightarrow</code></td><td style="text-align:center"><strong>52</strong></td><td style="text-align:center">⇄</td><td style="text-align:center"><code>\rightleftarrows</code></td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">→</td><td style="text-align:center"><code>\to</code></td><td style="text-align:center"><strong>53</strong></td><td style="text-align:center">↣</td><td style="text-align:center"><code>\rightarrowtail</code></td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\nrightarrow$</td><td style="text-align:center"><code>\nrightarrow</code></td><td style="text-align:center"><strong>54</strong></td><td style="text-align:center">↬</td><td style="text-align:center"><code>\looparrowright</code></td></tr><tr><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">⟶</td><td style="text-align:center"><code>\longrightarrow</code></td><td style="text-align:center"><strong>55</strong></td><td style="text-align:center">↷</td><td style="text-align:center"><code>\curvearrowright</code></td></tr><tr><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">←</td><td style="text-align:center"><code>\leftarrow</code></td><td style="text-align:center"><strong>56</strong></td><td style="text-align:center">↻</td><td style="text-align:center"><code>\circlearrowright</code></td></tr><tr><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">←</td><td style="text-align:center"><code>\gets</code></td><td style="text-align:center"><strong>57</strong></td><td style="text-align:center">↱</td><td style="text-align:center"><code>\Rsh</code></td></tr><tr><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\nleftarrow$</td><td style="text-align:center"><code>\nleftarrow</code></td><td style="text-align:center"><strong>58</strong></td><td style="text-align:center">⇊</td><td style="text-align:center"><code>\downdownarrows</code></td></tr><tr><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">⟵</td><td style="text-align:center"><code>\longleftarrow</code></td><td style="text-align:center"><strong>59</strong></td><td style="text-align:center">⇇</td><td style="text-align:center"><code>\leftleftarrows</code></td></tr><tr><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">↔</td><td style="text-align:center"><code>\leftrightarrow</code></td><td style="text-align:center"><strong>60</strong></td><td style="text-align:center">⇆</td><td style="text-align:center"><code>\leftrightarrows</code></td></tr><tr><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\nleftrightarrow$</td><td style="text-align:center"><code>\nleftrightarrow</code></td><td style="text-align:center"><strong>61</strong></td><td style="text-align:center">↢</td><td style="text-align:center"><code>\leftarrowtail</code></td></tr><tr><td style="text-align:center"><strong>27</strong></td><td style="text-align:center">⟷</td><td style="text-align:center"><code>\longleftrightarrow</code></td><td style="text-align:center"><strong>62</strong></td><td style="text-align:center">↫</td><td style="text-align:center"><code>\looparrowleft</code></td></tr><tr><td style="text-align:center"><strong>28</strong></td><td style="text-align:center">↑</td><td style="text-align:center"><code>\uparrow</code></td><td style="text-align:center"><strong>63</strong></td><td style="text-align:center">$\hookrightarrow$</td><td style="text-align:center"><code>\hookrightarrow</code></td></tr><tr><td style="text-align:center"><strong>29</strong></td><td style="text-align:center">↓</td><td style="text-align:center"><code>\downarrow</code></td><td style="text-align:center"><strong>64</strong></td><td style="text-align:center">$\hookleftarrow$</td><td style="text-align:center"><code>\hookleftarrow</code></td></tr><tr><td style="text-align:center"><strong>30</strong></td><td style="text-align:center">↕</td><td style="text-align:center"><code>\updownarrow</code></td><td style="text-align:center"><strong>65</strong></td><td style="text-align:center">⊸</td><td style="text-align:center"><code>\multimap</code></td></tr><tr><td style="text-align:center"><strong>31</strong></td><td style="text-align:center">$\nearrow$</td><td style="text-align:center"><code>\nearrow</code></td><td style="text-align:center"><strong>66</strong></td><td style="text-align:center">$\leftrightsquigarrow$</td><td style="text-align:center"><code>\leftrightsquigarrow</code></td></tr><tr><td style="text-align:center"><strong>32</strong></td><td style="text-align:center">$\swarrow$</td><td style="text-align:center"><code>\swarrow</code></td><td style="text-align:center"><strong>67</strong></td><td style="text-align:center">$\rightsquigarrow$</td><td style="text-align:center"><code>\rightsquigarrow</code></td></tr><tr><td style="text-align:center"><strong>33</strong></td><td style="text-align:center">$\nwarrow$</td><td style="text-align:center"><code>\nwarrow</code></td><td style="text-align:center"><strong>68</strong></td><td style="text-align:center">$\twoheadrightarrow$</td><td style="text-align:center"><code>\twoheadrightarrow</code></td></tr><tr><td style="text-align:center"><strong>34</strong></td><td style="text-align:center">$\searrow$</td><td style="text-align:center"><code>\searrow</code></td><td style="text-align:center"><strong>69</strong></td><td style="text-align:center">$\twoheadleftarrow$</td><td style="text-align:center"><code>\twoheadleftarrow</code></td></tr><tr><td style="text-align:center"><strong>35</strong></td><td style="text-align:center">↦</td><td style="text-align:center"><code>\mapsto</code></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table></div><h2 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h2><div class="table-container"><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th><th style="text-align:center">序号</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1</strong></td><td style="text-align:center">$\infty$</td><td style="text-align:center"><code>\infty</code></td><td style="text-align:center"><strong>33</strong></td><td style="text-align:center">$\flat$</td><td style="text-align:center"><code>\flat</code></td></tr><tr><td style="text-align:center"><strong>2</strong></td><td style="text-align:center">$\aleph$</td><td style="text-align:center"><code>\aleph</code></td><td style="text-align:center"><strong>34</strong></td><td style="text-align:center">$\natural$</td><td style="text-align:center"><code>\natural</code></td></tr><tr><td style="text-align:center"><strong>3</strong></td><td style="text-align:center">$\complement$</td><td style="text-align:center"><code>\complement</code></td><td style="text-align:center"><strong>35</strong></td><td style="text-align:center">$\sharp$</td><td style="text-align:center"><code>\sharp</code></td></tr><tr><td style="text-align:center"><strong>4</strong></td><td style="text-align:center">$\backepsilon$</td><td style="text-align:center"><code>\backepsilon</code></td><td style="text-align:center"><strong>36</strong></td><td style="text-align:center">$\diagup$</td><td style="text-align:center"><code>\diagup</code></td></tr><tr><td style="text-align:center"><strong>5</strong></td><td style="text-align:center">$\eth$</td><td style="text-align:center"><code>\eth</code></td><td style="text-align:center"><strong>37</strong></td><td style="text-align:center">$\diagdown$</td><td style="text-align:center"><code>\diagdown</code></td></tr><tr><td style="text-align:center"><strong>6</strong></td><td style="text-align:center">$\Finv$</td><td style="text-align:center"><code>\Finv</code></td><td style="text-align:center"><strong>38</strong></td><td style="text-align:center">$\centerdot$</td><td style="text-align:center"><code>\centerdot</code></td></tr><tr><td style="text-align:center"><strong>7</strong></td><td style="text-align:center">$\hbar$</td><td style="text-align:center"><code>\hbar</code></td><td style="text-align:center"><strong>39</strong></td><td style="text-align:center">$\ltimes$</td><td style="text-align:center"><code>\ltimes</code></td></tr><tr><td style="text-align:center"><strong>8</strong></td><td style="text-align:center">$\Im$</td><td style="text-align:center"><code>\Im</code></td><td style="text-align:center"><strong>40</strong></td><td style="text-align:center">$\rtimes$</td><td style="text-align:center"><code>\rtimes</code></td></tr><tr><td style="text-align:center"><strong>9</strong></td><td style="text-align:center">$\imath$</td><td style="text-align:center"><code>\imath</code></td><td style="text-align:center"><strong>41</strong></td><td style="text-align:center">$\leftthreetimes$</td><td style="text-align:center"><code>\leftthreetimes</code></td></tr><tr><td style="text-align:center"><strong>10</strong></td><td style="text-align:center">$\jmath$</td><td style="text-align:center"><code>\jmath</code></td><td style="text-align:center"><strong>42</strong></td><td style="text-align:center">$\rightthreetimes$</td><td style="text-align:center"><code>\rightthreetimes</code></td></tr><tr><td style="text-align:center"><strong>11</strong></td><td style="text-align:center">$\Bbbk$</td><td style="text-align:center"><code>\Bbbk</code></td><td style="text-align:center"><strong>43</strong></td><td style="text-align:center">$\eqcirc$</td><td style="text-align:center"><code>\eqcirc</code></td></tr><tr><td style="text-align:center"><strong>12</strong></td><td style="text-align:center">$\ell$</td><td style="text-align:center"><code>\ell</code></td><td style="text-align:center"><strong>44</strong></td><td style="text-align:center">$\circeq$</td><td style="text-align:center"><code>\circeq</code></td></tr><tr><td style="text-align:center"><strong>13</strong></td><td style="text-align:center">$\mho$</td><td style="text-align:center"><code>\mho</code></td><td style="text-align:center"><strong>45</strong></td><td style="text-align:center">$\triangleq$</td><td style="text-align:center"><code>\triangleq</code></td></tr><tr><td style="text-align:center"><strong>14</strong></td><td style="text-align:center">$\wp$</td><td style="text-align:center"><code>\wp</code></td><td style="text-align:center"><strong>46</strong></td><td style="text-align:center">$\bumpeq$</td><td style="text-align:center"><code>\bumpeq</code></td></tr><tr><td style="text-align:center"><strong>15</strong></td><td style="text-align:center">$\Re$</td><td style="text-align:center"><code>\Re</code></td><td style="text-align:center"><strong>47</strong></td><td style="text-align:center">$\Bumpeq$</td><td style="text-align:center"><code>\Bumpeq</code></td></tr><tr><td style="text-align:center"><strong>16</strong></td><td style="text-align:center">$\circledS$</td><td style="text-align:center"><code>\circledS</code></td><td style="text-align:center"><strong>48</strong></td><td style="text-align:center">$\doteqdot$</td><td style="text-align:center"><code>\doteqdot</code></td></tr><tr><td style="text-align:center"><strong>17</strong></td><td style="text-align:center">$\amalg$</td><td style="text-align:center"><code>\amalg</code></td><td style="text-align:center"><strong>49</strong></td><td style="text-align:center">$\risingdotseq$</td><td style="text-align:center"><code>\risingdotseq</code></td></tr><tr><td style="text-align:center"><strong>18</strong></td><td style="text-align:center">$\%$</td><td style="text-align:center"><code>\%</code></td><td style="text-align:center"><strong>50</strong></td><td style="text-align:center">≒</td><td style="text-align:center"><code>\fallingdotseq</code></td></tr><tr><td style="text-align:center"><strong>19</strong></td><td style="text-align:center">$\dagger$</td><td style="text-align:center"><code>\dagger</code></td><td style="text-align:center"><strong>51</strong></td><td style="text-align:center">$\intercal$</td><td style="text-align:center"><code>\intercal</code></td></tr><tr><td style="text-align:center"><strong>20</strong></td><td style="text-align:center">$\ddagger$</td><td style="text-align:center"><code>\ddagger</code></td><td style="text-align:center"><strong>52</strong></td><td style="text-align:center">$\barwedge$</td><td style="text-align:center"><code>\barwedge</code></td></tr><tr><td style="text-align:center"><strong>21</strong></td><td style="text-align:center">$\ldots$</td><td style="text-align:center"><code>\ldots</code></td><td style="text-align:center"><strong>53</strong></td><td style="text-align:center">$\veebar$</td><td style="text-align:center"><code>\veebar</code></td></tr><tr><td style="text-align:center"><strong>22</strong></td><td style="text-align:center">$\cdots$</td><td style="text-align:center"><code>\cdots</code></td><td style="text-align:center"><strong>54</strong></td><td style="text-align:center">$\doublebarwedge$</td><td style="text-align:center"><code>\doublebarwedge</code></td></tr><tr><td style="text-align:center"><strong>23</strong></td><td style="text-align:center">$\smile$</td><td style="text-align:center"><code>\smile</code></td><td style="text-align:center"><strong>55</strong></td><td style="text-align:center">$\between$</td><td style="text-align:center"><code>\between</code></td></tr><tr><td style="text-align:center"><strong>24</strong></td><td style="text-align:center">$\frown$</td><td style="text-align:center"><code>\frown</code></td><td style="text-align:center"><strong>56</strong></td><td style="text-align:center">$\pitchfork$</td><td style="text-align:center"><code>\pitchfork</code></td></tr><tr><td style="text-align:center"><strong>25</strong></td><td style="text-align:center">$\wr$</td><td style="text-align:center"><code>\wr</code></td><td style="text-align:center"><strong>57</strong></td><td style="text-align:center">$\vartriangleleft$</td><td style="text-align:center"><code>\vartriangleleft</code></td></tr><tr><td style="text-align:center"><strong>26</strong></td><td style="text-align:center">$\triangleleft$</td><td style="text-align:center"><code>\triangleleft</code></td><td style="text-align:center"><strong>58</strong></td><td style="text-align:center">$\ntriangleleft$</td><td style="text-align:center"><code>\ntriangleleft</code></td></tr><tr><td style="text-align:center"><strong>27</strong></td><td style="text-align:center">$\triangleright$</td><td style="text-align:center"><code>\triangleright</code></td><td style="text-align:center"><strong>59</strong></td><td style="text-align:center">$\vartriangleright$</td><td style="text-align:center"><code>\vartriangleright</code></td></tr><tr><td style="text-align:center"><strong>28</strong></td><td style="text-align:center">$\diamondsuit$</td><td style="text-align:center"><code>\diamondsuit</code></td><td style="text-align:center"><strong>60</strong></td><td style="text-align:center">$\ntriangleright$</td><td style="text-align:center"><code>\ntriangleright</code></td></tr><tr><td style="text-align:center"><strong>29</strong></td><td style="text-align:center">$\heartsuit$</td><td style="text-align:center"><code>\heartsuit</code></td><td style="text-align:center"><strong>61</strong></td><td style="text-align:center">$\trianglelefteq$</td><td style="text-align:center"><code>\trianglelefteq</code></td></tr><tr><td style="text-align:center"><strong>30</strong></td><td style="text-align:center">$\clubsuit$</td><td style="text-align:center"><code>\clubsuit</code></td><td style="text-align:center"><strong>62</strong></td><td style="text-align:center">$\ntrianglerighteq$</td><td style="text-align:center"><code>\ntrianglelefteq</code></td></tr><tr><td style="text-align:center"><strong>31</strong></td><td style="text-align:center">$\spadesuit$</td><td style="text-align:center"><code>\spadesuit</code></td><td style="text-align:center"><strong>63</strong></td><td style="text-align:center">$\trianglerighteq$</td><td style="text-align:center"><code>\trianglerighteq</code></td></tr><tr><td style="text-align:center"><strong>32</strong></td><td style="text-align:center">$\Game$</td><td style="text-align:center"><code>\Game</code></td><td style="text-align:center"><strong>64</strong></td><td style="text-align:center">$\ntrianglerighteq$</td><td style="text-align:center"><code>\ntrianglerighteq</code></td></tr></tbody></table></div><h2 id="分数"><a href="#分数" class="headerlink" title="分数"></a>分数</h2><div class="table-container"><table><thead><tr><th style="text-align:left">类型</th><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left"><strong>分数</strong></td><td style="text-align:left">$\frac{2}{4}x=0.5x$</td><td style="text-align:left"><code>\frac&#123;2&#125;&#123;4&#125;x=0.5x or &#123;2 \over 4&#125;x=0.5x</code></td></tr><tr><td style="text-align:left"><strong>小型分数</strong></td><td style="text-align:left">$\tfrac{2}{4}x=0.5x$</td><td style="text-align:left"><code>\tfrac&#123;2&#125;&#123;4&#125;x = 0.5x</code></td></tr><tr><td style="text-align:left"><strong>大型分数</strong> （不嵌套）</td><td style="text-align:left">$\dfrac{2}{4}=0.5$</td><td style="text-align:left"><code>\dfrac&#123;2&#125;&#123;4&#125; = 0.5</code></td></tr><tr><td style="text-align:left"><strong>大型分数</strong> （嵌套）</td><td style="text-align:left">$\dfrac{2}{c+\dfrac{2}{d + \dfrac{2}{4}}}=a$</td><td style="text-align:left"><code>\cfrac&#123;2&#125;&#123;c + \cfrac&#123;2&#125;&#123;d + \cfrac&#123;2&#125;&#123;4&#125;&#125;&#125; = a</code></td></tr></tbody></table></div><h2 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\exp_a b=a^b,\exp b = e^b,10^m$</td><td style="text-align:left"><code>\exp_a b = a^b, \exp b = e^b, 10^m</code></td></tr><tr><td style="text-align:left">$\ln c,\lg d=\log e,\log_{10} f$</td><td style="text-align:left"><code>\ln c, \lg d = \log e, \log_&#123;10&#125; f</code></td></tr><tr><td style="text-align:left">$\sin a,\cos b,\tan c,\cot d,\sec e,\csc f$</td><td style="text-align:left"><code>\sin a, \cos b, \tan c, \cot d, \sec e, \csc f</code></td></tr><tr><td style="text-align:left">$\arcsin a,\arccos b,\arctan c$</td><td style="text-align:left"><code>\arcsin a, \arccos b, \arctan c</code></td></tr><tr><td style="text-align:left">$\operatorname{arccot} d,\operatorname{arcsec} e,\operatorname{arccsc} f$</td><td style="text-align:left"><code>\operatorname&#123;arccot&#125; d, \operatorname&#123;arcsec&#125; e, \operatorname&#123;arccsc&#125; f</code></td></tr><tr><td style="text-align:left">$\sinh a,\cosh b,\tanh c,\coth d$</td><td style="text-align:left"><code>\sinh a, \cosh b, \tanh c, \coth d</code></td></tr><tr><td style="text-align:left">$\operatorname{sh}k,\operatorname{ch}l,\operatorname{th}m,\operatorname{coth}n$</td><td style="text-align:left"><code>\operatorname&#123;sh&#125;k, \operatorname&#123;ch&#125;l, \operatorname&#123;th&#125;m, \operatorname&#123;coth&#125;n</code></td></tr><tr><td style="text-align:left">$\operatorname{argsh}o,\operatorname{argch}p,\operatorname{argth}q$</td><td style="text-align:left"><code>\operatorname&#123;argsh&#125;o, \operatorname&#123;argch&#125;p, \operatorname&#123;argth&#125;q</code></td></tr><tr><td style="text-align:left">$\operatorname{sgn}r,\left\vert s \right\vert$</td><td style="text-align:left"><code>\operatorname&#123;sgn&#125;r, \left\vert s \right\vert</code></td></tr><tr><td style="text-align:left">$\min(x,y),\max(x,y)$</td><td style="text-align:left"><code>\min(x,y), \max(x,y)</code></td></tr></tbody></table></div><p>如果需要使用特殊的函数符号，那么可以采用 <code>\operatorname&#123;&#125;</code> 命令进行自定义：</p><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\operatorname{mydefine}x$</td><td style="text-align:left"><code>\operatorname&#123;mydefine&#125;x</code></td></tr></tbody></table></div><h2 id="根式"><a href="#根式" class="headerlink" title="根式"></a>根式</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\surd$</td><td style="text-align:left"><code>\surd</code></td><td style="text-align:left">$\sqrt[n]{\pi}$</td><td style="text-align:left"><code>\sqrt[n]&#123;\pi&#125;</code></td></tr><tr><td style="text-align:left">$\sqrt{\pi}$</td><td style="text-align:left"><code>\sqrt&#123;\pi&#125;</code></td><td style="text-align:left">$\sqrt[3]{\frac{x^3+y^3}{2}}$</td><td style="text-align:left"><code>\sqrt[3]&#123;\frac&#123;x^3+y^3&#125;&#123;2&#125;&#125;</code></td></tr></tbody></table></div><h2 id="微分与导数"><a href="#微分与导数" class="headerlink" title="微分与导数"></a>微分与导数</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$dt,\mathrm{d}t,\partial t.\nabla \psi$</td><td style="text-align:left"><code>dt, \mathrm&#123;d&#125;t, \partial t, \nabla\psi</code></td></tr><tr><td style="text-align:left">$dy/dx,\mathrm{d}y/\mathrm{d}x,\frac{dy}{dx},\frac{\mathrm{d}y}{\mathrm{d}x},\frac{\partial^2}{\partial x_1\partial x_2}y$</td><td style="text-align:left"><code>dy/dx, \mathrm&#123;d&#125;y/\mathrm&#123;d&#125;x, \frac&#123;dy&#125;&#123;dx&#125;, \frac&#123;\mathrm&#123;d&#125;y&#125;&#123;\mathrm&#123;d&#125;x&#125;, \frac&#123;\partial^2&#125;&#123;\partial x_1\partial x_2&#125;y</code></td></tr><tr><td style="text-align:left">$\prime,\backprime,f^\prime,f’,f’’,f^{3},\dot y,\ddot y$</td><td style="text-align:left"><code>\prime, \backprime, f^\prime, f&#39;, f&#39;&#39;, f^&#123;(3)&#125;, \dot y, \ddot y</code></td></tr></tbody></table></div><h2 id="模运算"><a href="#模运算" class="headerlink" title="模运算"></a>模运算</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$s_k \equiv 0 \pmod{m}$</td><td style="text-align:left"><code>s_k \equiv 0 \pmod&#123;m&#125;</code></td></tr><tr><td style="text-align:left">$a \bmod b$</td><td style="text-align:left"><code>a \bmod b</code></td></tr><tr><td style="text-align:left">$\gcd(m,n),\operatorname{lcm}(m,n)$</td><td style="text-align:left"><code>\gcd(m, n), \operatorname&#123;lcm&#125;(m, n)</code></td></tr><tr><td style="text-align:left">$\mid,\nmid,\shortmid,\nshortmid$</td><td style="text-align:left"><code>\mid, \nmid, \shortmid, \nshortmid</code></td></tr></tbody></table></div><h2 id="极限"><a href="#极限" class="headerlink" title="极限"></a>极限</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\lim\limits_{n \to \infty}x_n$</td><td style="text-align:left"><code>\lim\limits_&#123;n \to \infty&#125;x_n</code></td></tr><tr><td style="text-align:left">$\textstyle \lim\limits_{n \to \infty}x_n$</td><td style="text-align:left"><code>\textstyle \lim\limits_&#123;n \to \infty&#125;x_n</code></td></tr></tbody></table></div><h2 id="范围与预测"><a href="#范围与预测" class="headerlink" title="范围与预测"></a>范围与预测</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\min x,\max y,\inf s,\sup t$</td><td style="text-align:left"><code>\min x, \max y, \inf s, \sup t</code></td></tr><tr><td style="text-align:left">$\lim u,\liminf v,\limsup w$</td><td style="text-align:left"><code>\lim u, \liminf v, \limsup w</code></td></tr><tr><td style="text-align:left">$\dim p,\deg q,\det m.\ker\phi$</td><td style="text-align:left"><code>\dim p, \deg q, \det m, \ker\phi</code></td></tr><tr><td style="text-align:left">$\Pr j,\hom l,\lVert z\rVert,\arg z$</td><td style="text-align:left"><code>\Pr j, \hom l, \lVert z \rVert, \arg z</code></td></tr></tbody></table></div><h2 id="积分"><a href="#积分" class="headerlink" title="积分"></a>积分</h2><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\int\limits_{1}^{3}\frac{e^3/x}{x^2}\,dx$</td><td style="text-align:left"><code>\int\limits_&#123;1&#125;^&#123;3&#125;\frac&#123;e^3/x&#125;&#123;x^2&#125;\, dx</code></td></tr><tr><td style="text-align:left">$\int_{1}^{3}\frac{e^3/x}{x^2}\,dx$</td><td style="text-align:left"><code>\int_&#123;1&#125;^&#123;3&#125;\frac&#123;e^3/x&#125;&#123;x^2&#125;\, dx</code></td></tr><tr><td style="text-align:left">$\textstyle \int\limits_{-N}^{N} e^x dx$</td><td style="text-align:left"><code>\textstyle \int\limits_&#123;-N&#125;^&#123;N&#125; e^x dx</code></td></tr><tr><td style="text-align:left">$\textstyle \int_{-N}^{N} e^x dx$</td><td style="text-align:left"><code>\textstyle \int_&#123;-N&#125;^&#123;N&#125; e^x dx</code></td></tr><tr><td style="text-align:left">$\iint\limits_D dx\,dy$</td><td style="text-align:left"><code>\iint\limits_D dx\,dy</code></td></tr><tr><td style="text-align:left">$\iiint\limits_\Omega dx\,dy\,dz$</td><td style="text-align:left"><code>\iiint\limits_\Omega dx\,dy\,dz</code></td></tr><tr><td style="text-align:left">$\iiiint\limits_F dx\,dy\,dz\,dt$</td><td style="text-align:left"><code>\iiiint\limits_F dx\,dy\,dz\,dt</code></td></tr><tr><td style="text-align:left">$\int_{(x,y)\in C} x^3\,dx + 4y^2\,dy$</td><td style="text-align:left"><code>\int_&#123;(x,y)\in C&#125; x^3\, dx + 4y^2\, dy</code></td></tr><tr><td style="text-align:left">$\oint_{(x,y)\in C}x^3\,dx+4y^2\,dy$</td><td style="text-align:left"><code>\oint_&#123;(x,y)\in C&#125; x^3\, dx + 4y^2\, dy</code></td></tr></tbody></table></div><blockquote><p><strong>注意</strong>：积分符号采用 <code>\int\_&#123;&#125;^&#123;&#125;</code> 命令调用，双重积分符号采用 <code>\iint\_&#123;&#125;^&#123;&#125;</code>，以此类推，最高可以支持四重积分。</p><p>曲线积分可以使用 <code>\oint</code> 命令调用，但是 MathJax 并不支持该语法，因此在开启了 Unicode 扩展的前提下，可以改为采用 <code>\unicode&#123;&#125;</code> 命令调用：</p></blockquote><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">$\unicode{8751} \unicode{x222f}_c$</td><td style="text-align:left"><code>\unicode&#123;8751&#125; \unicode&#123;x222F&#125;_C</code></td><td style="text-align:left">曲面积分符号的 Unicode 码十进制为 <code>8751</code>,十六进制为 <code>x222F</code>；</td></tr><tr><td style="text-align:left">$\unicode{8752} \unicode{x2230}_C$</td><td style="text-align:left"><code>\unicode&#123;8752&#125; \unicode&#123;x2230&#125;_C</code></td><td style="text-align:left">三维曲面积分符号的 Unicode 码十进制为 <code>8752</code>,十六进制为 <code>x2230</code>；</td></tr><tr><td style="text-align:left">$\unicode{8753} \unicode{x2231}_c \unicode{8754} \unicode{x2232}_c \unicode{8755} \unicode{x2233}_c$</td><td style="text-align:left"><code>\unicode&#123;8753&#125; \unicode&#123;x2231&#125;_c \unicode&#123;8754&#125; \unicode&#123;x2232&#125;_c \unicode&#123;8755&#125; \unicode&#123;x2233&#125;_c</code></td><td style="text-align:left">其它积分符号；</td></tr></tbody></table></div><h2 id="大型运算符"><a href="#大型运算符" class="headerlink" title="大型运算符"></a>大型运算符</h2><div class="table-container"><table><thead><tr><th style="text-align:left">分类</th><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left"><strong>求和</strong></td><td style="text-align:center">$\sum_{a}^{b}$</td><td style="text-align:left"><code>\sum_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \sum_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \sum_&#123;a&#125;^&#123;b&#125;</code></td></tr><tr><td style="text-align:left"><strong>连乘积</strong></td><td style="text-align:center">$\prod_{a}^{b}$</td><td style="text-align:left"><code>\prod_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \prod_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \prod_&#123;a&#125;^&#123;b&#125;</code></td></tr><tr><td style="text-align:left"><strong>余积</strong></td><td style="text-align:center">$\coprod_{a}^{b}$</td><td style="text-align:left"><code>\coprod_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \coprod_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \coprod_&#123;a&#125;^&#123;b&#125;</code></td></tr><tr><td style="text-align:left"><strong>并集</strong></td><td style="text-align:center">$\bigcup_{a}^{b}$</td><td style="text-align:left"><code>\bigcup_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \bigcup_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \bigcup_&#123;a&#125;^&#123;b&#125;</code></td></tr><tr><td style="text-align:left"><strong>交集</strong></td><td style="text-align:center">$\bigcap_{a}^{b}$</td><td style="text-align:left"><code>\bigcap_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \bigcap_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \bigcap_&#123;a&#125;^&#123;b&#125;</code></td></tr><tr><td style="text-align:left"><strong>析取</strong></td><td style="text-align:center">$\bigvee_{a}^{b}$</td><td style="text-align:left"><code>\bigvee_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \bigvee_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \bigvee_&#123;a&#125;^&#123;b&#125;</code></td></tr><tr><td style="text-align:left"><strong>合取</strong></td><td style="text-align:center">$\bigwedge_{a}^{b}$</td><td style="text-align:left"><code>\bigwedge_&#123;a&#125;^&#123;b&#125;</code></td><td style="text-align:center">$\textstyle \bigwedge_{a}^{b}$</td><td style="text-align:left"><code>\textstyle \bigwedge_&#123;a&#125;^&#123;b&#125;</code></td></tr></tbody></table></div><h2 id="上下标"><a href="#上下标" class="headerlink" title="上下标"></a>上下标</h2><div class="table-container"><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">符号</th><th style="text-align:left">代码</th></tr></thead><tbody><tr><td style="text-align:center"><strong>上标</strong></td><td style="text-align:center">$a^2,a^{x+3}$</td><td style="text-align:left"><code>a^2</code> <code>a^&#123;x+3&#125;</code></td></tr><tr><td style="text-align:center"><strong>下标</strong></td><td style="text-align:center">$a_2$</td><td style="text-align:left"><code>a_2</code></td></tr><tr><td style="text-align:center"><strong>组合</strong></td><td style="text-align:center">$10^{30}a^{2+2}\\a_{ij}\\b{f’}$</td><td style="text-align:left"><code>10^&#123;30&#125;a^&#123;2+2&#125;</code> <br/><code>a_&#123;i,j&#125;</code><br/><code>b&#123;f&#39;&#125;</code></td></tr><tr><td style="text-align:center"><strong>上下标混合</strong></td><td style="text-align:center">$x_2^3\\{x_2}^3$</td><td style="text-align:left"><code>x_2^3</code><br/> <code>&#123;x_2&#125;^3</code></td></tr><tr><td style="text-align:center"><strong>上标的上标</strong></td><td style="text-align:center">$10^{10^8}$</td><td style="text-align:left"><code>10^&#123;10^&#123;8&#125;&#125;</code></td></tr><tr><td style="text-align:center"><strong>混合标识</strong></td><td style="text-align:center">$1^2X3{^4}_a^b\\{}_1^2!\Omega_3^4$</td><td style="text-align:left"><code>\sideset&#123;1^2&#125;&#123;3^4&#125;X_a^b</code> <code>&#123;&#125;_1^2!\Omega_3^4</code></td></tr><tr><td style="text-align:center"><strong>顶标底标</strong></td><td style="text-align:center">$\overset{\alpha}{\omega}\\\underset{\alpha}{\omega}\\\overset{\alpha}{\underset{\gamma}{\omega}}\\\stackrel{\alpha}{\omega}$</td><td style="text-align:left"><code>\overset&#123;\alpha&#125;&#123;\omega&#125;</code> <br/><code>\underset&#123;\alpha&#125;&#123;\omega&#125;</code> <br/><code>\overset&#123;\alpha&#125;&#123;\underset&#123;\gamma&#125;&#123;\omega&#125;&#125;</code> <br/><code>\stackrel&#123;\alpha&#125;&#123;\omega&#125;</code></td></tr><tr><td style="text-align:center"><strong>导数</strong></td><td style="text-align:center">$x’,y’’,f’,f’’,x^\prime,y^{\prime\prime}$</td><td style="text-align:left"><code>x&#39;, y&#39;&#39;, f&#39;, f&#39;&#39;</code> <code>x^\prime, y^&#123;\prime\prime&#125;</code></td></tr><tr><td style="text-align:center"><strong>导数点</strong></td><td style="text-align:center">$\dot{x},\ddot{x}$</td><td style="text-align:left"><code>\dot&#123;x&#125;, \ddot&#123;x&#125;</code></td></tr><tr><td style="text-align:center"><strong>上下划线与向量</strong></td><td style="text-align:center">$\hat a \ \bar b \ \vec c\\overrightarrow{a b} \ \overleftarrow{a b} \ \widehat{d e f}\\overline{g h i} \ \underline{j k l}$</td><td style="text-align:left"><code>\hat a \ \bar b \ \vec c</code><br/> <code>\overrightarrow&#123;a b&#125;\ \overleftarrow&#123;c d&#125;\ \widehat&#123;d e f&#125;</code> <code>\overline&#123;g h i&#125; \ \underline&#123;j k l&#125;</code></td></tr><tr><td style="text-align:center"><strong>弧度</strong></td><td style="text-align:center">$\overset{\frown} {AB}$</td><td style="text-align:left"><code>\overset&#123;\frown&#125; &#123;AB&#125;</code></td></tr><tr><td style="text-align:center"><strong>箭头</strong></td><td style="text-align:center">$A \xleftarrow{n+\mu-1} B \xrightarrow[T]{n\pm i-1} C$</td><td style="text-align:left"><code>A \xleftarrow&#123;n+\mu-1&#125; B \xrightarrow[T]&#123;n\pm i-1&#125; C</code></td></tr><tr><td style="text-align:center"><strong>大括号</strong></td><td style="text-align:center">$\overbrace{ 1+2+\cdots+100}^5050$</td><td style="text-align:left"><code>\overbrace&#123; 1+2+\cdots+100 &#125;^&#123;5050&#125;</code></td></tr><tr><td style="text-align:center"><strong>底部大括号</strong></td><td style="text-align:center">$\underbrace{a+b+\cdots+z}_{26}$</td><td style="text-align:left"><code>\underbrace&#123; a+b+\cdots+z &#125;_&#123;26&#125;</code></td></tr><tr><td style="text-align:center"><strong>求和运算</strong></td><td style="text-align:center">$\sum_{k=1}^N k^2$</td><td style="text-align:left"><code>\sum_&#123;k=1&#125;^N k^2</code></td></tr><tr><td style="text-align:center"><strong>文本模式下的求和运算</strong></td><td style="text-align:center">$\textstyle \sum_{k=1}^N k^2$</td><td style="text-align:left"><code>\textstyle \sum_&#123;k=1&#125;^N k^2</code></td></tr><tr><td style="text-align:center"><strong>分式中的求和运算</strong></td><td style="text-align:center">$\frac{\sum_{k=1}^N k^2}{a}$</td><td style="text-align:left"><code>\frac&#123;\sum_&#123;k=1&#125;^N k^2&#125;&#123;a&#125;</code></td></tr><tr><td style="text-align:center"><strong>分式中的求和运算</strong></td><td style="text-align:center">$\frac{\displaystyle \sum_{k=1}^N k^2}{a}$</td><td style="text-align:left"><code>\frac&#123;\displaystyle \sum_&#123;k=1&#125;^N k^2&#125;&#123;a&#125;</code></td></tr><tr><td style="text-align:center"><strong>分式中的求和运算</strong></td><td style="text-align:center">$\frac{\sum\limits_{k=1}^N k^2}{a}$</td><td style="text-align:left"><code>\frac&#123;\sum\limits^&#123;^N&#125;_&#123;k=1&#125; k^2&#125;&#123;a&#125;</code></td></tr><tr><td style="text-align:center"><strong>乘积运算</strong></td><td style="text-align:center">$\prod_{i=1}^N x_i$</td><td style="text-align:left"><code>\prod_&#123;i=1&#125;^N x_i</code></td></tr><tr><td style="text-align:center"><strong>文本模式下乘积运算</strong></td><td style="text-align:center">$\textstyle \prod_{i=1}^N x_i$</td><td style="text-align:left"><code>\textstyle \prod_&#123;i=1&#125;^N x_i</code></td></tr><tr><td style="text-align:center"><strong>副乘运算</strong></td><td style="text-align:center">$\coprod_{i=1}^N x_i$</td><td style="text-align:left"><code>\coprod_&#123;i=1&#125;^N x_i</code></td></tr><tr><td style="text-align:center"><strong>文本模式下副乘运算</strong></td><td style="text-align:center">$\textstyle \coprod_{i=1}^N x_i$</td><td style="text-align:left"><code>\textstyle \coprod_&#123;i=1&#125;^N x_i</code></td></tr><tr><td style="text-align:center"><strong>极限</strong></td><td style="text-align:center">$\lim\limits_{n \to\infty} x_n$</td><td style="text-align:left"><code>\lim\limits_&#123;n \to \infty&#125;x_n</code></td></tr><tr><td style="text-align:center"><strong>文本模式下极限</strong></td><td style="text-align:center">$\textstyle \lim\limits_{n \to \infty} x_n$</td><td style="text-align:left"><code>\textstyle \lim\limits_&#123;n \to \infty&#125;x_n</code></td></tr><tr><td style="text-align:center"><strong>积分</strong></td><td style="text-align:center">$\int\limits_1^3 \frac{e^3/x}{x^2}\,dx$</td><td style="text-align:left"><code>\int\limits_&#123;1&#125;^&#123;3&#125;\frac&#123;e^3/x&#125;&#123;x^2&#125;\, dx</code></td></tr><tr><td style="text-align:center"><strong>积分</strong></td><td style="text-align:center">$\int_1^3 \frac{e^3/x}{x^2}\,dx$</td><td style="text-align:left"><code>\int_&#123;1&#125;^&#123;3&#125;\frac&#123;e^3/x&#125;&#123;x^2&#125;\, dx</code></td></tr><tr><td style="text-align:center"><strong>交集</strong></td><td style="text-align:center">$\bigcap_{i=1}^n E_i$</td><td style="text-align:left"><code>\bigcap_&#123;i=1&#125;^n E_i</code></td></tr><tr><td style="text-align:center"><strong>并集</strong></td><td style="text-align:center">$\bigcup_{i=1}^N E_i$</td><td style="text-align:left"><code>\bigcup_&#123;i=1&#125;^n E_i</code></td></tr></tbody></table></div><h2 id="二项式系数"><a href="#二项式系数" class="headerlink" title="二项式系数"></a>二项式系数</h2><div class="table-container"><table><thead><tr><th style="text-align:left">类型</th><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">二项式系数</td><td style="text-align:left">$\binom{n}{k}$</td><td style="text-align:left"><code>\binom&#123;n&#125;&#123;k&#125;</code></td></tr><tr><td style="text-align:left">小型二项式系数</td><td style="text-align:left">$\tbinom{n}{k}$</td><td style="text-align:left"><code>\tbinom&#123;n&#125;&#123;k&#125;</code></td></tr><tr><td style="text-align:left">大型二项式系数</td><td style="text-align:left">$\dbinom{n}{k}$</td><td style="text-align:left"><code>\dbinom&#123;n&#125;&#123;k&#125;</code></td></tr></tbody></table></div><h2 id="矩阵"><a href="#矩阵" class="headerlink" title="矩阵"></a>矩阵</h2><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center"><script type="math/tex">\begin{matrix}x & y \\ z & v\end{matrix}</script></td><td style="text-align:left"><code>\begin&#123;matrix&#125;</code><br/><code>x &amp; y \\</code><br/><code>z &amp; v</code><br/><code>\end&#123;matrix&#125;</code></td></tr><tr><td style="text-align:center"><script type="math/tex">\begin{vmatrix}x & y \\ z & v\end{vmatrix}</script></td><td style="text-align:left"><code>\begin&#123;vmatrix&#125;</code><br/><code>x &amp; y \\</code><br/><code>z &amp; v</code><br/><code>\end&#123;vmatrix&#125;</code></td></tr><tr><td style="text-align:center">$\begin{Vmatrix}x &amp; y\ z&amp;v\end{Vmatrix}$</td><td style="text-align:left"><code>\begin&#123;Vmatrix&#125;</code><br/><code>x &amp; y \\</code><br><code>/z &amp; v</code><br/><code>\end&#123;Vmatrix&#125;</code></td></tr><tr><td style="text-align:center">$\begin{bmatrix}0 &amp; \cdots &amp; 0 \ \vdots &amp; \ddots &amp; \vdots\ 0 &amp; \cdots &amp; 0\end{bmatrix}$</td><td style="text-align:left"><code>\begin&#123;bmatrix&#125;</code><br/><code>0 &amp; \cdots &amp; 0 \\</code><br><code>\vdots &amp; \ddots &amp; \vdots \\</code><br/><code>0 &amp; \cdots &amp; 0</code><br/><code>\end&#123;bmatrix&#125;</code></td></tr><tr><td style="text-align:center">$\begin{Bmatrix}x &amp; y \ z &amp; v\end{Bmatrix}$</td><td style="text-align:left"><code>\begin&#123;Bmatrix&#125;x &amp; y \\z &amp; v\end&#123;Bmatrix&#125;</code></td></tr><tr><td style="text-align:center">$\begin{pmatrix}x &amp; y \ z &amp; v\end{pmatrix}$</td><td style="text-align:left"><code>\begin&#123;pmatrix&#125;</code><br/><code>x &amp; y \\</code><br/><code>z &amp; v</code><br/><code>\end&#123;pmatrix&#125;</code></td></tr><tr><td style="text-align:center">$\bigl(\begin{smallmatrix}a &amp; b\ c&amp;d\end{smallmatrix}\bigr)$</td><td style="text-align:left"><code>\bigl( \begin&#123;smallmatrix&#125;</code><br/><code>a &amp; b\\</code><br/><code>c &amp; d</code><br/><code>\end&#123;smallmatrix&#125; \bigr)</code></td></tr></tbody></table></div><blockquote><p>注意，最后一个矩阵写法比较特殊</p></blockquote><h2 id="方程与方程组"><a href="#方程与方程组" class="headerlink" title="方程与方程组"></a>方程与方程组</h2><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$\begin{cases}3x + 57 +z\ 7x - 2y + 4z\ -6x + 3y + 2z\end{cases}$</td><td style="text-align:left"><code>\begin&#123;cases&#125;</code><br/><code>3x + 5y + z \\</code><br/><code>7x - 2y + 4z \\</code><br/><code>-6x + 3y + 2z</code><br/><code>\end&#123;cases&#125;</code></td></tr></tbody></table></div><script type="math/tex; mode=display">f(x)\,=\,\begin{cases}\frac{1}{1+\cos x}\, , \quad-\pi\lt x\lt0.\\xe^{-x^2}\, , \qquad\quad x \geqslant0.\end{cases}</script><h3 id="条件定义"><a href="#条件定义" class="headerlink" title="条件定义"></a>条件定义</h3><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$f(n)=\begin{cases}n/2,&amp; \text{if }n\text{ is even} \ 3n+1,&amp; \text{if }n\text{ is odd}\end{cases}$</td><td style="text-align:left"><code>f(n) =</code><br/><code>\begin&#123;cases&#125;</code><br/><code>n/2, &amp; \text&#123;if &#125;n\text&#123; is even&#125; \\</code><br/><code>3n+1, &amp; \text&#123;if &#125;n\text&#123; is odd&#125;</code><br/><code>\end&#123;cases&#125;</code></td></tr></tbody></table></div><h3 id="多行等式"><a href="#多行等式" class="headerlink" title="多行等式"></a>多行等式</h3><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$\begin{align}f(x) &amp; = (a+b)^2\&amp; = a^2 + 2ab + b^2\end{align}$</td><td style="text-align:center"><code>\begin&#123;align&#125;f(x) &amp; = (a+b)^2\\&amp; = a^2+2ab+b^2\end&#123;align&#125;</code></td></tr><tr><td style="text-align:center">$\begin{alignat}{2}f(x) &amp; = (a-b)^2 \&amp; = a^2-2ab+b^2\end{alignat}$</td><td style="text-align:center"><code>\begin&#123;alignat&#125;&#123;2&#125;f(x) &amp; = (a-b)^2 \\&amp; = a^2-2ab+b^2\end&#123;alignat&#125;</code></td></tr><tr><td style="text-align:center">$\begin{array}{lcl}z &amp; = &amp; a \ f(x,y,z) &amp; = &amp; x + y + z\end{array}$</td><td style="text-align:center"><code>\begin&#123;array&#125;&#123;lcl&#125;z &amp; = &amp; a \\f(x,y,z) &amp; = &amp; x + y + z\end&#123;array&#125;</code></td></tr><tr><td style="text-align:center">$\begin{array}{lcr}z &amp; = &amp; a \ f(x,y,z) &amp; = &amp; x + y + z\end{array}$</td><td style="text-align:center"><code>\begin&#123;array&#125;&#123;lcr&#125;z &amp; = &amp; a \\f(x,y,z) &amp; = &amp; x + y + z\end&#123;array&#125;</code></td></tr></tbody></table></div><h3 id="自动编号"><a href="#自动编号" class="headerlink" title="自动编号"></a>自动编号</h3><div class="table-container"><table><thead><tr><th style="text-align:center">描述</th><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">开启 AMS 扩展包的情况下，会在部分环境的多行公式后自动编号；</td><td style="text-align:center">$\begin{eqnarray}E = mc^2 \ e^{i\pi}+1=0\end{eqnarray}$</td><td style="text-align:center"><code>\begin&#123;eqnarray&#125;E = mc^2 \\e^&#123;i\pi&#125;+1=0\end&#123;eqnarray&#125;</code></td></tr><tr><td style="text-align:center">整个公式都不进行编号，可以使用<code>&#123;equation*&#125;</code>、<code>&#123;eqnarray*&#125;</code>环境；</td><td style="text-align:center">$\begin{eqnarray<em>}E = mc^2 \ e^{i\pi}+1=0\end{eqnarray</em>}$</td><td style="text-align:center"><code>\begin&#123;eqnarray*&#125;E = mc^2 \\e^&#123;i\pi&#125;+1=0\end&#123;eqnarray*&#125;</code></td></tr><tr><td style="text-align:center">单个方程不进行编号，可以在指定方程后面添加<code>\nonumber</code>命令；</td><td style="text-align:center">$\begin{eqnarray}E = mc^2 \ e^{i\pi}+1=0 \nonumber\end{eqnarray}$</td><td style="text-align:center"><code>\begin&#123;eqnarray&#125;E = mc^2 \\e^&#123;i\pi&#125;+1=0 \nonumber\end&#123;eqnarray&#125;</code></td></tr><tr><td style="text-align:center">个别公式出现或者不出现编号，可以在公式后使用<code>\tag&#123;&#125;</code>或者<code>\notag</code>命令；</td><td style="text-align:center">$\begin{eqnarray}E = mc^2 \notag\ \e^{i\pi}+1=0 \tag{b}\end{eqnarray}$</td><td style="text-align:center"><code>\begin&#123;eqnarray&#125;E = mc^2 \notag\\e^&#123;i\pi&#125;+1=0 \tag&#123;b&#125;\end&#123;eqnarray&#125;</code></td></tr></tbody></table></div><h2 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h2><p>常用的 <code>()</code>、<code>[]</code>、<code>&#123;&#125;</code> 括号符号可以在 LaTeX 环境当中直接进行使用，但是如果处于较大的符号当中，就应该配合 <code>\left</code> 与 <code>\right</code> 命令来使用：</p><div class="table-container"><table><thead><tr><th style="text-align:left">类型</th><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">圆括号、小括号</td><td style="text-align:center">$\left ( \frac{a}{b} \right)$</td><td style="text-align:left"><code>\left ( \frac&#123;a&#125;&#123;b&#125; \right )</code></td></tr><tr><td style="text-align:left">方括号、中括号</td><td style="text-align:center">$\left[ \frac{a}{b} \right]\ \left \lbrack \frac{a}{b} \right \rbrack$</td><td style="text-align:left"><code>\left [ \frac&#123;a&#125;&#123;b&#125; \right ]</code><br/> <code>\left \lbrack \frac&#123;a&#125;&#123;b&#125; \right \rbrack</code></td></tr><tr><td style="text-align:left">花括号、大括号</td><td style="text-align:center">$\left{ \frac{a}{b} \right}\ \left \lbrace \frac{a}{b} \right \rbrace$</td><td style="text-align:left"><code>\left \&#123; \frac&#123;a&#125;&#123;b&#125; \right \&#125;</code> <br/><code>\left \lbrace \frac&#123;a&#125;&#123;b&#125; \right \rbrace</code></td></tr><tr><td style="text-align:left">角括号</td><td style="text-align:center">$\left \langle \frac{a}{b} \right \rangle$</td><td style="text-align:left"><code>\left \langle \frac&#123;a&#125;&#123;b&#125; \right \rangle</code></td></tr><tr><td style="text-align:left">单竖线和双竖线</td><td style="text-align:center">$\left \vert \frac{a}{b} \right \vert\ \left \vert \frac{a}{b} \right \vert$</td><td style="text-align:left"><code>\left \vert \frac&#123;a&#125;&#123;b&#125; \right \vert</code> <br/><code>\left \vert \frac&#123;a&#125;&#123;b&#125; \right \vert</code></td></tr><tr><td style="text-align:left">取整函数与取顶函数</td><td style="text-align:center">$\left\lfloor \frac{a}{b} \right\rfloor\ \left\lceil \frac{c}{d} \right\rceil$</td><td style="text-align:left"><code>\left \lfloor \frac&#123;a&#125;&#123;b&#125; \right \rfloor</code><br/> <code>\left \lceil \frac&#123;c&#125;&#123;d&#125; \right \rceil</code></td></tr><tr><td style="text-align:left">斜线与反斜线</td><td style="text-align:center">$\left/ \frac{a}{b} \right\backslash$</td><td style="text-align:left"><code>\left / \frac&#123;a&#125;&#123;b&#125; \right \backslash</code></td></tr><tr><td style="text-align:left">上下箭头</td><td style="text-align:center">$\left\uparrow \frac{a}{b} \right\downarrow\ \left\Uparrow \frac{a}{b} \right\Downarrow\ \left\updownarrow \frac{a}{b} \right\Updownarrow$</td><td style="text-align:left"><code>\left \uparrow \frac&#123;a&#125;&#123;b&#125; \right \downarrow</code><br/> <code>\left \Uparrow \frac&#123;a&#125;&#123;b&#125; \right \Downarrow</code> <br/><code>\left \updownarrow \frac&#123;a&#125;&#123;b&#125; \right \Updownarrow</code></td></tr><tr><td style="text-align:left">混合括号</td><td style="text-align:center">$\left[ 0,1 \right) \ \left \langle \psi \right \vert$</td><td style="text-align:left"><code>\left [ 0,1 \right )</code> <br/><code>\left \langle \psi \right \vert</code></td></tr><tr><td style="text-align:left">使用<code>\left.</code>和<code>\right.</code>不显示某侧的括号；</td><td style="text-align:center">$\left. \frac{A}{B} \right] \to X$</td><td style="text-align:left"><code>\left. \frac&#123;A&#125;&#123;B&#125; \right\&#125; \to X</code></td></tr></tbody></table></div><blockquote><p><strong>注意</strong>：在 Markdown 当中使用 LaTeX 时，为了避免语法冲突，花括号 <code>&#123;&#125;</code> 必须采用 <code>\&#123;</code>和<code>\&#125;</code> 进行转义，或者改用 <code>\lbrace</code> 和 <code>\rbrace</code> 的方式；如果是在 Markdown 表格当中使用 LaTeX，则必须采用 <code>\vert</code> 或者 <code>\Vert</code> 代替直接在公式当中书写 <code>|</code> 和 <code>||</code>。</p></blockquote><h3 id="括号尺寸"><a href="#括号尺寸" class="headerlink" title="括号尺寸"></a>括号尺寸</h3><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$( \bigl( \Bigl( \biggl( \Biggl( \dots \Biggr] \biggr] \Bigr] \bigr] ]$</td><td style="text-align:left"><code>( \bigl( \Bigl( \biggl( \Biggl( \dots \Biggr] \biggr] \Bigr] \bigr] ]</code></td></tr><tr><td style="text-align:center">${ \bigl{ \Bigl{ \biggl{ \Biggl{ \dots \Biggr \rangle \biggr \rangle \Bigr \rangle \bigr \rangle \rangle$</td><td style="text-align:left"><code>\&#123; \bigl \&#123; \Bigl \&#123; \biggl \&#123; \Biggl \&#123; \dots \Biggr\rangle \biggr\rangle \Bigr\rangle \bigr\rangle \rangle</code></td></tr><tr><td style="text-align:center">$\vert \big \vert \Big \vert \bigg \vert \Bigg \vert \dots \Bigg \vert \bigg \vert \Big \vert \big \vert$</td><td style="text-align:left"><code>\vert \big \vert \Big \vert \bigg \vert \Bigg \vert \dots \Bigg \vert \bigg \vert \Big \vert \big \vert</code></td></tr><tr><td style="text-align:center">$\lfloor \bigl\lfloor \Bigl\lfloor \biggl\lfloor \Biggl\lfloor \dots \Biggr\rceil \biggr\rceil \Bigr\rceil \bigr\rceil \rceil$</td><td style="text-align:left"><code>\lfloor \bigl\lfloor \Bigl\lfloor \biggl\lfloor \Biggl\lfloor \dots \Biggr\rceil \biggr\rceil \Bigr\rceil \bigr\rceil \rceil</code></td></tr><tr><td style="text-align:center">$\uparrow \big\uparrow \Big\uparrow \bigg\uparrow \Bigg\uparrow \dots \Bigg\Downarrow \bigg\Downarrow \Big\Downarrow \big\Downarrow \Downarrow$</td><td style="text-align:left"><code>\uparrow \big\uparrow \Big\uparrow \bigg\uparrow \Bigg\uparrow \dots \Bigg\Downarrow \bigg\Downarrow \Big\Downarrow \big\Downarrow \Downarrow</code></td></tr><tr><td style="text-align:center">$\updownarrow \big\updownarrow \Big\updownarrow \bigg\updownarrow \Bigg\updownarrow \dots \Bigg\Updownarrow \bigg\Updownarrow \Big\Updownarrow \big\Updownarrow \Updownarrow$</td><td style="text-align:left"><code>\updownarrow \big\updownarrow \Big\updownarrow \bigg\updownarrow \Bigg\updownarrow \dots \Bigg\Updownarrow \bigg\Updownarrow \Big\Updownarrow \big\Updownarrow \Updownarrow</code></td></tr><tr><td style="text-align:center">$/ \big/ \Big/ \bigg/ \Bigg/ \dots \Bigg\backslash \bigg\backslash \Big\backslash \big\backslash \backslash$</td><td style="text-align:left"><code>/ \big/ \Big/ \bigg/ \Bigg/ \dots \Bigg\backslash \bigg\backslash \Big\backslash \big\backslash \backslash</code></td></tr></tbody></table></div><h2 id="空格与换行"><a href="#空格与换行" class="headerlink" title="空格与换行"></a>空格与换行</h2><div class="table-container"><table><thead><tr><th style="text-align:left">序号</th><th style="text-align:left">符号</th><th>LaTeX</th></tr></thead><tbody><tr><td style="text-align:left"><strong>双空格</strong></td><td style="text-align:left">$a \qquad b$</td><td><code>a \qquad b</code></td></tr><tr><td style="text-align:left"><strong>单空格</strong></td><td style="text-align:left">$a \quad b$</td><td><code>a \quad b</code></td></tr><tr><td style="text-align:left"><strong>字符空格</strong></td><td style="text-align:left">$a\ b$</td><td><code>a\ b</code></td></tr><tr><td style="text-align:left"><strong>文本模式中的字符空格</strong></td><td style="text-align:left">$a \text{ } b$</td><td><code>a \text&#123; &#125; b</code></td></tr><tr><td style="text-align:left"><strong>大空格</strong></td><td style="text-align:left">$a\;b$</td><td><code>a\;b</code></td></tr><tr><td style="text-align:left"><strong>小空格</strong></td><td style="text-align:left">$a\,b$</td><td><code>a\,b</code></td></tr><tr><td style="text-align:left"><strong>极小空格</strong></td><td style="text-align:left">$ab$</td><td><code>ab</code></td></tr><tr><td style="text-align:left"><strong>极小空格</strong>（用于区分语法）</td><td style="text-align:left">$a b$</td><td><code>a b</code></td></tr><tr><td style="text-align:left"><strong>无空格</strong>（用于区分多字母变量）</td><td style="text-align:left">$\mathit{ab}$</td><td><code>\mathit&#123;ab&#125;</code></td></tr></tbody></table></div><p>MathJax 3.0 取消了单行公式环境下 \ 的强制换行功能，因此强制换行命令 <code>\\</code> 仅能用于 <code>eqnarray</code>、<code>align</code>、<code>array</code>、<code>matrix</code> 等多行环境当中。除此之外，还可以在 <code>\displaylines&#123;&#125;</code> 行显示命令当中使用 <code>\\</code> 强制换行命令：</p><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$\displaylines{y=1729x \ y=1729-x}$</td><td style="text-align:center"><code>\displaylines&#123;y=1729x \\ y=1729-x&#125;</code></td></tr></tbody></table></div><h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><p>编写 LaTeX 的时候，支持将<strong>文本</strong>、<strong>符号</strong>或者<strong>背景</strong>设置为下面表格当中的各种颜色：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/latex_color.png" alt="image-20220716162651861"></p><h3 id="字体颜色"><a href="#字体颜色" class="headerlink" title="字体颜色"></a>字体颜色</h3><p>公式当中可以使用 {\color{hues}text}调用颜色命令，其中 hues 数为<strong>字体颜色</strong>，而 text 参数是<strong>公式内容</strong>：</p><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">${\color{Blue}x^2}+{\color{Orange}2x}-{\color{LimeGreen}1}$</td><td style="text-align:center"><code>&#123;\color&#123;Blue&#125;x^2&#125;+&#123;\color&#123;Orange&#125;2x&#125;-&#123;\color&#123;LimeGreen&#125;1&#125;</code></td></tr></tbody></table></div><h3 id="背景颜色"><a href="#背景颜色" class="headerlink" title="背景颜色"></a>背景颜色</h3><p>文本环境中可以使用 \colorbox{hues}{text}来调用背景颜色命令，其中 hues参数为<strong>背景颜色</strong>，而 text 参数是<strong>公式内容</strong>：</p><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$\colorbox{yellow}{Thistext}$</td><td style="text-align:center"><code>\colorbox&#123;yellow&#125;&#123;Thistext&#125;</code></td></tr></tbody></table></div><p>该命令应用于数学环境当中时，需要在第 2 个参数加入 \displaystyle + 公式：</p><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$\colorbox{yellow}{$\displaystyle \frac{a}{b}$}$</td><td style="text-align:center"><code>\colorbox&#123;yellow&#125;&#123;$\displaystyle \frac&#123;a&#125;&#123;b&#125;$&#125;</code></td></tr></tbody></table></div><blockquote><p><strong>注意</strong>：在 Markdown 内联 LaTeX 公式 <script type="math/tex">...</script> 当中使用 <script type="math/tex">\displaystyle + 公式</script> 语法时将会引发冲突，因此该语法仅用于多行公式 $$$…$$$。</p></blockquote><h3 id="RGB-颜色"><a href="#RGB-颜色" class="headerlink" title="RGB 颜色"></a>RGB 颜色</h3><p>通过使用 \definecolor`命令可以自定义 LaTeX 公式的颜色：</p><div class="table-container"><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">LaTeX</th></tr></thead><tbody><tr><td style="text-align:center">$\definecolor{mygreen}{RGB}{0,200,0} {\color{mygreen}e^{i \pi} + 1 = 0 }$</td><td style="text-align:center"><code>\definecolor&#123;mygreen&#125;&#123;RGB&#125;&#123;0,200,0&#125; &#123;\color&#123;mygreen&#125;e^&#123;i \pi&#125; + 1 = 0 &#125;</code></td></tr></tbody></table></div><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><h3 id="字体加粗"><a href="#字体加粗" class="headerlink" title="字体加粗"></a>字体加粗</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\boldsymbol{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\boldsymbol&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\boldsymbol{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\boldsymbol&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\boldsymbol{0123456789}$</td><td style="text-align:left"><code>\boldsymbol&#123;0123456789&#125;</code></td></tr></tbody></table></div><h3 id="黑体"><a href="#黑体" class="headerlink" title="黑体"></a>黑体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathbf{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathbf&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\mathbf{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\mathbf&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\mathbf{0123456789}$</td><td style="text-align:left"><code>\mathbf&#123;0123456789&#125;</code></td></tr></tbody></table></div><p>一般可用<code>mathbf&#123;a&#125;</code>表示粗体向量<br>用<code>textbf&#123;解&#125;</code>表示粗体解</p><h3 id="黑板报体"><a href="#黑板报体" class="headerlink" title="黑板报体"></a>黑板报体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathbb{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathbb&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\mathbb{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\mathbb&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\mathbb{0123456789}$</td><td style="text-align:left"><code>\mathbb&#123;0123456789&#125;</code></td></tr></tbody></table></div><h3 id="斜体"><a href="#斜体" class="headerlink" title="斜体"></a>斜体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathit{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathit&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\mathit{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\mathit&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\mathit{0123456789}$</td><td style="text-align:left"><code>\mathit&#123;0123456789&#125;</code></td></tr></tbody></table></div><h3 id="罗马体"><a href="#罗马体" class="headerlink" title="罗马体"></a>罗马体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathrm{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathrm&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">abcdefghijklmnopqrstuvwxyz</td><td style="text-align:left"><code>\mathrm&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">0123456789</td><td style="text-align:left"><code>\mathrm&#123;0123456789&#125;</code></td></tr></tbody></table></div><h3 id="无衬线体"><a href="#无衬线体" class="headerlink" title="无衬线体"></a>无衬线体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathsf{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathsf&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\mathsf{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\mathsf&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\mathsf{0123456789}$</td><td style="text-align:left"><code>\mathsf&#123;0123456789&#125;</code></td></tr></tbody></table></div><h3 id="手写体"><a href="#手写体" class="headerlink" title="手写体"></a>手写体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathcal{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathcal&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\mathcal{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\mathcal&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\mathcal{0123456789}$</td><td style="text-align:left"><code>\mathcal&#123;0123456789&#125;</code></td></tr></tbody></table></div><h3 id="哥特字体"><a href="#哥特字体" class="headerlink" title="哥特字体"></a>哥特字体</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">$\mathfrak{ABCDEFGHIJKLMNOPQRSTUVWXYZ}$</td><td style="text-align:left"><code>\mathfrak&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></td></tr><tr><td style="text-align:left">$\mathfrak{abcdefghijklmnopqrstuvwxyz}$</td><td style="text-align:left"><code>\mathfrak&#123;abcdefghijklmnopqrstuvwxyz&#125;</code></td></tr><tr><td style="text-align:left">$\mathfrak{0123456789}$</td><td style="text-align:left"><code>\mathfrak&#123;0123456789&#125;</code></td></tr></tbody></table></div><blockquote><p>上面的七种以\math…开头的命令都可以省略math，比如罗马体$\rm{abcdefghijklmnopqrstuvwxyz}$-$\rm{abcdefghijklmnopqrstuvwxyz}</p></blockquote><h3 id="小脚本风格"><a href="#小脚本风格" class="headerlink" title="小脚本风格"></a>小脚本风格</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">${\scriptstyle\text{ABCDEFGHIJKLMNOPQRSTUVWXYZ}}$</td><td style="text-align:left"><code>&#123;\scriptstyle\text&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;&#125;</code></td></tr><tr><td style="text-align:left">${\scriptstyle\text{abcdefghijklmnopqrstuvwxyz}}$</td><td style="text-align:left"><code>&#123;\scriptstyle\text&#123;abcdefghijklmnopqrstuvwxyz&#125;&#125;</code></td></tr><tr><td style="text-align:left">${\scriptstyle\text{0123456789}}$</td><td style="text-align:left"><code>&#123;\scriptstyle\text&#123;0123456789&#125;&#125;</code></td></tr></tbody></table></div><h3 id="字号尺寸"><a href="#字号尺寸" class="headerlink" title="字号尺寸"></a>字号尺寸</h3><div class="table-container"><table><thead><tr><th style="text-align:left">符号</th><th style="text-align:left">LaTeX</th></tr></thead><tbody><tr><td style="text-align:left">${\tiny abc极小tiny}$</td><td style="text-align:left"><code>&#123;\tiny abc极小tiny&#125;</code></td></tr><tr><td style="text-align:left">${\scriptsize abc 超小 scriptsize}$</td><td style="text-align:left"><code>&#123;\scriptsize abc 超小 scriptsize&#125;</code></td></tr><tr><td style="text-align:left">${\small abc 小 small}$</td><td style="text-align:left"><code>&#123;\small abc 小 small&#125;</code></td></tr><tr><td style="text-align:left">${\normalsize abc 正常 normal}$</td><td style="text-align:left"><code>&#123;\normalsize abc 正常 normal&#125;</code></td></tr><tr><td style="text-align:left">${\large abc 大 large}$</td><td style="text-align:left"><code>&#123;\large abc 大 large&#125;</code></td></tr><tr><td style="text-align:left">${\Large abc 超大 Large}$</td><td style="text-align:left"><code>&#123;\Large abc 超大 Large&#125;</code></td></tr><tr><td style="text-align:left">${\LARGE abc 特大 LARGE}$</td><td style="text-align:left"><code>&#123;\LARGE abc 特大 LARGE&#125;</code></td></tr><tr><td style="text-align:left">${\huge abc 巨大 huge}$</td><td style="text-align:left"><code>&#123;\huge abc 巨大 huge&#125;</code></td></tr><tr><td style="text-align:left">${\Huge abc 巨无霸 Huge}$</td><td style="text-align:left"><code>&#123;\Huge abc 巨无霸 Huge&#125;</code></td></tr></tbody></table></div><h2 id="实战演练"><a href="#实战演练" class="headerlink" title="实战演练"></a>实战演练</h2><script type="math/tex; mode=display">f(x) = \frac 1 {\sqrt{2\pi} \sigma} {\rm e} ^ {-\frac {(x-\mu)^2}{2\sigma ^ 2}}\\f(x) = \frac 1 {\sqrt{2\pi} \sigma} \exp \left[ {-\frac {(x-\mu)^2}{2\sigma ^ 2}}\right] \\</script><script type="math/tex; mode=display">\lim\limits_{N\to \infty} P \left\{ \left| \frac {I\left( \alpha_i \right)}{N} - H(s) \right| < \varepsilon  \right\} = 1 \\</script><script type="math/tex; mode=display">\begin{align}\vec B \left( \vec r \right) &= \frac {\mu_0}{4\pi}\oint_C \frac {I \, {\rm d} \vec l \times \vec R}{R^3}\\&= \frac {\mu_0}{4\pi} \int_V \frac{\vec J_V \times \vec R}{R^3}\, {\rm d} V'\end{align}</script>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> latex </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> latex </tag>
            
            <tag> 论文 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Zookeeper集群常见问题</title>
      <link href="/posts/1571776361.html"/>
      <url>/posts/1571776361.html</url>
      
        <content type="html"><![CDATA[<h1 id="启动集群时失败"><a href="#启动集群时失败" class="headerlink" title="启动集群时失败"></a>启动集群时失败</h1><p>启动集群报如下错：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... FAILED TO START</span><br></pre></td></tr></table></figure><p>这个报错没有参考价值。</p><p>查看日志文件（<code>cat $ZOOKEEPER_HOME/logs/zookeeper-hadoop103-server-hadoop103.out</code>，就是logs下的.out文件，你的路径可能和我不一样哦）：</p><p>如果报错内容类似：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">org.apache.zookeeper.server.quorum.QuorumPeerConfig<span class="variable">$ConfigException</span>: Address unresolved: hadoop105:3888</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeer<span class="variable">$QuorumServer</span>.initializeWithAddressString(QuorumPeer.java:358)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeer<span class="variable">$QuorumServer</span>.&lt;init&gt;(QuorumPeer.java:279)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeer<span class="variable">$QuorumServer</span>.&lt;init&gt;(QuorumPeer.java:274)</span><br><span class="line">at org.apache.zookeeper.server.quorum.flexible.QuorumMaj.&lt;init&gt;(QuorumMaj.java:92)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.createQuorumVerifier(QuorumPeerConfig.java:658)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parseDynamicConfig(QuorumPeerConfig.java:689)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.setupQuorumPeerConfig(QuorumPeerConfig.java:663)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parseProperties(QuorumPeerConfig.java:491)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parse(QuorumPeerConfig.java:194)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:125)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:91)</span><br><span class="line">Invalid config, exiting abnormally</span><br><span class="line">2023-01-30 04:20:57,810 [myid:] - INFO  [main:ZKAuditProvider@42] - ZooKeeper audit is disabled.</span><br><span class="line">2023-01-30 04:20:57,811 [myid:] - ERROR [main:ServiceUtils@48] - Exiting JVM with code 2</span><br></pre></td></tr></table></figure><p>即表示可能是zoo.cfg配置文件出错了。</p><p>需要把后面的空格都删除掉，我是多加了空格。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####################### cluster ########################## </span></span><br><span class="line">server.3=hadoop103:2888:3888</span><br><span class="line">server.4=hadoop104:2888:3888</span><br><span class="line">server.5=hadoop105:2888:3888</span><br></pre></td></tr></table></figure><p>就是这一步。</p><p>修改完配置文件，单独分发配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync <span class="variable">$ZOOKEEPER_HOME</span>/conf/zoo.cfg</span><br></pre></td></tr></table></figure><hr><p>如果日志文件类似：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">org.apache.zookeeper.server.quorum.QuorumPeerConfig<span class="variable">$ConfigException</span>: Error processing /usr/local/zookeeper/bin/../conf/zoo.cfg</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parse(QuorumPeerConfig.java:198)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:125)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:91)</span><br><span class="line">Caused by: java.lang.IllegalArgumentException: myid file is missing</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.checkValidity(QuorumPeerConfig.java:796)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.setupQuorumPeerConfig(QuorumPeerConfig.java:667)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parseProperties(QuorumPeerConfig.java:491)</span><br><span class="line">at org.apache.zookeeper.server.quorum.QuorumPeerConfig.parse(QuorumPeerConfig.java:194)</span><br><span class="line">... 2 more</span><br><span class="line">Invalid config, exiting abnormally</span><br><span class="line">2023-01-30 07:49:35,165 [myid:] - INFO  [main:ZKAuditProvider@42] - ZooKeeper audit is disabled.</span><br><span class="line">2023-01-30 07:49:35,166 [myid:] - ERROR [main:ServiceUtils@48] - Exiting JVM with code 2</span><br></pre></td></tr></table></figure><p>可知是找不到myid。请前找一下<code>$ZOOKEEPER_HOME/zkData</code>下是否有<code>myid</code>文件.如果没有则创建，如果有也有可能是没有内容。</p><p>如果有内容还是会报错，那就是zoo.cfg中单dataDir配置的路径有问题，请去修改。</p><p>修改完配置文件，单独分发配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync <span class="variable">$ZOOKEEPER_HOME</span>/conf/zoo.cfg</span><br></pre></td></tr></table></figure><hr><p>如果是：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Could not find or load main class org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br></pre></td></tr></table></figure><p>那么可能是端口冲突，请考虑你的zookeeper的版本。</p><p>如果版本&gt;=3.5.0可能是端口冲突引起的。在zoo.cfg中添加（或修改）:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># admin port</span></span><br><span class="line">admin.serverPort=8081</span><br></pre></td></tr></table></figure><p>如果都试过了，且版本&gt;=3.5.5，则请降低版本。或者重新下载。因为版本&gt;=3.5.5时，官网首页会提供两个安装路径：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_version3.jpeg" alt="安装包"></p><p>一定要选择第一个，标准版的，不要下载源码版。</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Zookeeper </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
            <tag> 集群 </tag>
            
            <tag> Zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Zookeeper集群</title>
      <link href="/posts/983786067.html"/>
      <url>/posts/983786067.html</url>
      
        <content type="html"><![CDATA[<h1 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h1><p>首先搭建Zookeeper是在Linux上进行搭建的，并且我这里介绍的是基于我之前搭建好了的Hadoop集群，继续搭建的Zookeeper集群。也就是说您需要有Hadoop集群的基础才能和我的对应。</p><p>也不过多赘述关于IP，JDK等的基础环境问题了。</p><p>我的hadoop集群：</p><div class="table-container"><table><thead><tr><th></th><th>1号服务器</th><th>2号服务器</th><th>3号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop103</td><td>hadoop103</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode</td><td>DataNode</td><td>SecondaryNameNode、DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager、NodeManager</td><td>NodeManager</td></tr></tbody></table></div><p>如果您和我不一样，您大概要知道，我的hadoop103对应的是您的哪个节点…</p><h1 id="下载Zookeeper"><a href="#下载Zookeeper" class="headerlink" title="下载Zookeeper"></a>下载Zookeeper</h1><p>需要安装什么版本的Zookeeper？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_version.png" alt="版本描述" style="zoom:50%;" /></p><p>根据官网描述，我们下载版本越新越好。</p><blockquote><p>您已经有了hadoop的下载基础了，在Ubuntu里直接下载或是你主机浏览器中下载好再传到虚拟机你应该都了解了，不过多赘述。</p></blockquote><p>官网地址<a href="https://zookeeper.apache.org/">https://zookeeper.apache.org/</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_download.png" alt="地址页面" style="zoom: 40%;" /></p><p>可以自己选择对应版本下载，我下载的是3.7.1版本（我访问网站时的最新稳当版本），下载地址（可直达）：<a href="https://archive.apache.org/dist/zookeeper/zookeeper-3.7.1/">https://archive.apache.org/dist/zookeeper/zookeeper-3.7.1/</a></p><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_download2.png" alt="下载界面" style="zoom:50%;" /></p><p>点击 apache-zookeeper-3.7.1-bin.tar.gz 。点击即可下载。</p><p>下载完成后，移动到<code>/usr/local</code>目录下，过程于hadoop压缩包移动类似。</p><h1 id="Zookeeper安装"><a href="#Zookeeper安装" class="headerlink" title="Zookeeper安装"></a>Zookeeper安装</h1><blockquote><p>这里只在hadoop103搭建就好了，zookeeper安装包可以用集群分发脚本发到两台从机上。</p></blockquote><h2 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h2><ol><li><p>JDK（估计你安装好了，如果没有安装好，请参看：<a href="/posts/1141628095.html" title="搭建Hadoop环境">搭建Hadoop环境</a>）</p></li><li><p>下载Zookeeper安装包，弄到<code>/usr/local</code>目录下</p></li><li><p>解压安装包</p><ul><li><p>如果是 .tar.gz 后缀，则输入命令：</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf apache-zookeeper-3.7.1-bin.tar.gz -C /usr/local/</span><br></pre></td></tr></table></figure></li><li><p>如果是 .tar 后缀，则输入命令：</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf apache-zookeeper-3.7.1-bin.tar -C /usr/local/</span><br></pre></td></tr></table></figure></li></ul></li><li><p>修改安装包名称</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> apache-zookeeper-3.7.1-bin zookeeper</span><br></pre></td></tr></table></figure></li><li><p>配置zookeeper家目录</p><p> 这不需要，我只是为了方便：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p> 输入 i 进入编辑模式，在上面添加：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/usr/local/zookeeper</span><br></pre></td></tr></table></figure><p> 刷新资源：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p> 这样之后就可以<code>cd $ZOOKEEPER_HOME</code>就跳转到<code>/usr/local/zookeeper</code>。不用担心长，输入<code>$ZOOK</code>直接按Tab键就能补全，这个是Linux的代码补全，只要没有重复的配置，你输入<code>$Z</code>都能按Tab补全了。</p><p> 并且以后如果zookeeper目录位置改变了，只需要改变环境变量文件中的这一处，不用到处改变。</p></li></ol><p>准备工作完成的效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_praper.png" alt="完成的效果" style="zoom:50%;" /></p><h2 id="配置修改"><a href="#配置修改" class="headerlink" title="配置修改"></a>配置修改</h2><ol><li><p>将<code>$ZOOKEEPER_HOME/conf</code>目录下的<code>zoo_sample.cfg</code>修改为<code>zoo.cfg</code>：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> <span class="variable">$ZOOKEEPER_HOME</span>/conf/zoo_sample.cfg  <span class="variable">$ZOOKEEPER_HOME</span>/conf/zoo.cfg</span><br></pre></td></tr></table></figure></li><li><p>打开zoo.cfg并求改dataDir的路径：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$ZOOKEEPER_HOME</span>/conf/zoo.cfg <span class="comment"># 打开</span></span><br></pre></td></tr></table></figure><p> 按 i 编辑，修改如下内容：</p><p> 将原本的<code>dataDir=/tmp/zookeeper</code>,修改为：<code>dataDir=/usr/local/zookeeper/zkData</code></p><p> 其他zoo.cfg的配置参数如果后续也没有提到，您有需要请自行配置。</p></li><li><p>创建zkData目录</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> <span class="variable">$ZOOKEEPER_HOME</span>/zkData</span><br></pre></td></tr></table></figure></li></ol><p>到这里其实就配置好了单机了。</p><h2 id="操作Zookeeper"><a href="#操作Zookeeper" class="headerlink" title="操作Zookeeper"></a>操作Zookeeper</h2><p>这里也算是在做测试：</p><p>如果你在zookeeper根目录下，就可以不输入$ZOOKEEPER_HOME</p><ol><li><p>启动Zookeeper</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start</span><br></pre></td></tr></table></figure></li><li><p>查看是否启动</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_test1.png" alt="查看是否启动" style="zoom: 67%;" /></p></li><li><p>查看状态</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh status</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_test2.png" alt="查看状态" style="zoom:50%;" /></p></li><li><p>启动客户端</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ZOOKEEPER_HOME</span>/bin/zkCli.sh</span><br></pre></td></tr></table></figure></li><li><p>退出客户端</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br></pre></td></tr></table></figure></li><li><p>停止（关闭）Zookeeper</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh stop </span><br></pre></td></tr></table></figure></li></ol><hr><h1 id="集群安装"><a href="#集群安装" class="headerlink" title="集群安装"></a>集群安装</h1><h2 id="集群规划"><a href="#集群规划" class="headerlink" title="集群规划"></a>集群规划</h2><p>三个节点：</p><p>hadoop103、hadoop104、hadoop105</p><p>这里不区分主机和从机，也不特别区分分工。</p><h2 id="配置服务器编号"><a href="#配置服务器编号" class="headerlink" title="配置服务器编号"></a>配置服务器编号</h2><p>还是在hadoop103上操作：</p><p>在<code>$ZOOKEEPER_HOME/zkData</code>目录下创建一个<code>myid</code>文件（注意，源码中只读取这个文件，除非你去改源码，否则只能是这个文件名）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> <span class="variable">$ZOOKEEPER_HOME</span>/zkData/myid</span><br></pre></td></tr></table></figure><p>编辑文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$ZOOKEEPER_HOME</span>/zkData/myid</span><br></pre></td></tr></table></figure><p>写入一个数字就行了，故名思义，myid就是说我这个节点的编号，未来方便记，我这个hadoop103，就写的3；后面hadoop104的这里写4；hadoop105的这里写5。等脚本分发过去之后再改。</p><h2 id="配置zoo-cfg文件"><a href="#配置zoo-cfg文件" class="headerlink" title="配置zoo.cfg文件"></a>配置zoo.cfg文件</h2><p>打开文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$ZOOKEEPER_HOME</span>/conf/zoo.cfg</span><br></pre></td></tr></table></figure><p>新增配置（在文件最下面）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####################### cluster ########################## </span></span><br><span class="line">server.3=hadoop103:2888:3888</span><br><span class="line">server.4=hadoop104:2888:3888</span><br><span class="line">server.5=hadoop105:2888:3888</span><br></pre></td></tr></table></figure><p>解释一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.A=B:C:D</span><br></pre></td></tr></table></figure><ul><li>A是一个数字，表示这个是第几号服务器；对应集群模式下配置的一个文件myid里的内容，这个文件在dataDir目录下，这个文件里面有一个数据就是A的值，Zookeeper启动时读取此文件，拿到里面的数据与zoo.cfg里面的配置信息比较从而判断到底是哪个server。</li><li>B是这个服务器的地址；也就是该服务器的hostname或IP地址。</li><li>C是这个服务器Follower与集群中的Leader服务器交换信息的端口； </li><li>D是万一集群中的Leader服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用来执行选举时服务器相互通信的端口。 </li></ul><p>3.5.0以上的zookeeper提供了一个内嵌的Jetty容器来运行 AdminServer，默认占用的是 8080端口，AdminServer 主要是来查看 Zookeeper 的一些状态，如果机器上有其他程序（比如：Tomcat）占用了 8080 端口，会出现冲突，所以我添加你配置项：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># admin port</span></span><br><span class="line">admin.serverPort=8081</span><br></pre></td></tr></table></figure><p>把端口改到了8081。</p><h2 id="分发zookeeper"><a href="#分发zookeeper" class="headerlink" title="分发zookeeper"></a>分发zookeeper</h2><blockquote><p>如果您还没有编写集群分发脚本，请参看：<a href="/posts/3772089482.html" title="集群分发脚本">集群分发脚本</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync <span class="variable">$ZOOKEEPER_HOME</span></span><br></pre></td></tr></table></figure><p>然后分别去修改hadoop104和hadoop105的myid文件，和上面的修改方式一样，不赘述了。</p><p>值得一提的是，集群分发脚本是同步，如果未来zoo.cfg改变了，可不能再分发 <code>$ZOOKEEPER_HOME</code>了，应该单独分发<code>zoo.cfg</code>否则又得重新配置myid文件（因为分发之后myid的内容同步了）。</p><p>如果这一步报错，提到了：<code>Permission denied</code>那就是权限不够，不能在hadoop104和hadoop105上的<code>/usr/local</code>目录下创建文件夹zookeeper。解决办法：先在两台服务器上创建好zookeeper文件夹，并修改拥有者。</p><p>注意，前面配置Zookeeper的家目录了的，注意后面两台也要配置。这里不建议<code>xsync ~/.bashrc</code>因为hadoop103上可能有些Hadoop103特有的配置。所以就另外两台单独加上配置就好了。<a href="#安装前准备">安装前准备</a>的第5点。</p><h2 id="操作Zookeeper集群"><a href="#操作Zookeeper集群" class="headerlink" title="操作Zookeeper集群"></a>操作Zookeeper集群</h2><p>也算是检查后集群搭建是否成功。</p><p>分别启动zookeeper和查看状态</p><p>这里暂时没法一台控制三台一起启动，所以进入每台服务器都要执行一下这个命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><p>三台都启动了之后再分别查看状态：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh status</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/zookeeper_status.png" alt="状态"></p><p>可以看到hadoop104的Mode是leader，其他两个（hadoop103和hadoop105）是follower。这种就是对的，即一leader多follower。</p><p>如果启动过程报错了，请参看：<a href="/posts/1571776361.html" title="搭建Zookeeper集群常见问题">搭建Zookeeper集群常见问题</a></p><h1 id="Zookeeper-集群启停脚本"><a href="#Zookeeper-集群启停脚本" class="headerlink" title="Zookeeper 集群启停脚本"></a>Zookeeper 集群启停脚本</h1><p>上面启动zookeeper服务，很麻烦，还要专门到几个服务器来启动。下面编写zookeeper集群启停脚本，和Hadoop的类似：</p><p>在</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim zk</span><br></pre></td></tr></table></figure><p>其实直接vim，如果没有的文件会自动创建。</p><p>编写内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> hadoop103 hadoop104 hadoop105</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> ---------- zookeeper <span class="variable">$i</span> 启动 ------------</span><br><span class="line">        ssh <span class="variable">$i</span> <span class="string">&quot;<span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start&quot;</span>  </span><br><span class="line">    <span class="keyword">done</span> </span><br><span class="line">&#125;;;</span><br><span class="line"><span class="string">&quot;stop&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> hadoop103 hadoop104 hadoop105</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> ---------- zookeeper <span class="variable">$i</span> 停止 ------------</span><br><span class="line">    ssh <span class="variable">$i</span> <span class="string">&quot;<span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh stop&quot;</span>  </span><br><span class="line">    <span class="keyword">done</span> </span><br><span class="line">&#125;;; </span><br><span class="line"><span class="string">&quot;status&quot;</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hadoop103 hadoop104 hadoop105</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> ---------- zookeeper <span class="variable">$i</span> 状态 ------------</span><br><span class="line">ssh <span class="variable">$i</span> <span class="string">&quot;<span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh status&quot;</span>  </span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line">&#125;;;</span><br><span class="line"><span class="keyword">esac</span> </span><br></pre></td></tr></table></figure><p>增加脚本执行权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x zk</span><br></pre></td></tr></table></figure><p>使用：</p><ol><li><p>启动集群：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk start</span><br></pre></td></tr></table></figure></li><li><p>查看集群状态：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk status</span><br></pre></td></tr></table></figure></li><li><p>关闭集群：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk stop</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Zookeeper </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
            <tag> 集群 </tag>
            
            <tag> Zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop集群搭建指南</title>
      <link href="/posts/4177218757.html"/>
      <url>/posts/4177218757.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>搭建的集群为伪分布式集群。并且是基础的hadoop，而不包括生态的其他服务（后续会跟进的）。有三台机器，常将配置有NameNode节点的机器叫做主机，另外两台叫做从机。这里的主机是指集群中的三台虚拟机的主机。但我大多数情况描述的主机都是指您的Windows系统或Mac系统。请您注意区分。</p></blockquote><p>为了少出问题，您的搭建过程请尽量和我一样（包括用户名、主机名、静态IP），但是您自己能区分与我的内容对应便可不必。</p><p>为了稳妥起见，不论您先前收否执行过一些步骤，请按照流程，浏览一遍文章。</p><p>如果文章出现问题欢迎在评论区留言，如果您遇到了问题也可以在评论区看看。</p><hr><ol><li>如果还没有安装配置虚拟机，可以参看<a href="/posts/694347442.html" title="UTM安装配置Ubuntu">UTM安装配置Ubuntu</a>。如果你是MacOS可以完全照做；如果是Windows，那么安装过程不完全适合你，Windows下一般使用VMware，而不是UTM。但是在配置Ubuntu内部环境的时候就一样了，因为Ubuntu与外部的操作系统无关。如果您是Windows，您可以自行找文章了<span style="color: red">找文章前最好还是看看我配置了Ubuntu的什么环境</span>。<strong>这里的关键点是静态IP，最好配置上静态IP，文章中的静态IP配置Windows也适用</strong>。</li><li>如果您使用的以前的虚拟机，但是想要和我的用户名、主机名一致，请参看<a href="/posts/820223701.html" title="修改Ubuntu用户名、密码和主机名">修改Ubuntu用户名、密码和主机名</a>（为了后续搭建快速方便建议和我的用户名主机名一致）。</li><li>估计您还没有hadoop环境，参看<a href="/posts/1141628095.html" title="搭建Hadoop环境">搭建Hadoop环境</a>,hadoop先下载配置到您的主虚拟机就行了，两台从虚拟机之后有处理办法。</li><li>准备工作做完了，开始搭建集群，请参看：<a href="/posts/1271036369.html" title="搭建Hadoop集群">搭建Hadoop集群</a>.这里就是仔细配置<strong>五个配置文件</strong>就好了，并不难。</li><li>接下来就是介绍集群搭建的一些辅助配置了。请参看：<a href="/posts/3772089482.html" title="集群分发脚本">集群分发脚本</a>。虽然文章名叫集群分发脚本，但内容还涉及到ssh免密登录和hosts端口映射，这些都是重要内容。</li><li>这一步是检测您的Hadoop集群启动后能否访问web服务的。也是想您介绍hadoop集群配置好后的web服务端口。如果您觉得需要请参看：<a href="/posts/4130790367.html" title="hadoop常用端口号">hadoop常用端口号</a>。</li><li>如果您在搭建过程中遇到了问题，这可能是我最开始搭建出的一点纰漏，请参看：<a href="/posts/2075104059.html" title="搭建hadoop集群常见问题">搭建hadoop集群常见问题</a>。如果这里面也没有您出的错，请仔细比对一下是否按照我的描述配置完前面的全部内容。要注意有些配置我是专门说了三台机器是都要处理的哦，其中脚本分发指令只用于hadoop目录了，其他的ssh，hosts，环境变量等都是每台机器都需要配置的哦。</li></ol><p>搭建好了可继续跟着我博客笔记学习Hadoop的知识：</p><ul><li><a href="/posts/1547067935.html" title="HDFS">HDFS</a></li><li><a href="/posts/1767336200.html" title="Yarn">Yarn</a></li><li><a href="/posts/3156194925.html" title="MapReduce">MapReduce</a></li><li><a href="/posts/3297135020.html" title="搭建Hadoop HA(高可用)集群">搭建Hadoop HA(高可用)集群</a></li></ul><p>祝您一切顺利💪🏻 您也可以浏览我博客的其他内容，可以通过留言板或评论和我交流。很高兴能认识您🥳。</p><p>其他大数据相关内容可浏览博客主页查看，已上传Zookeeper、HBase、ElasticSearch等大数据方面的内容。</p><p><span style="background: rgba(100, 150, 150); color: white;box-shadow:5px 5px rgba(100,150,255,0.2); box-raduis: 5px; font-size=50px; weight: 600;">搭建好的朋友可以在评论区留下你的配置时长哦</span></p><p>文章这么多字，这么细致（虽然可能会有些错别字🧐）但是还是很辛苦的，麻烦您大发慈悲，给我打赏一点吧，不在于多少，而在于心意🤪。</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建hadoop集群常见问题</title>
      <link href="/posts/2075104059.html"/>
      <url>/posts/2075104059.html</url>
      
        <content type="html"><![CDATA[<h1 id="hadoop压缩包移动到-usr-local-目录下失败"><a href="#hadoop压缩包移动到-usr-local-目录下失败" class="headerlink" title="hadoop压缩包移动到/usr/local/目录下失败"></a>hadoop压缩包移动到/usr/local/目录下失败</h1><p>这应该是<code>/usr/local</code>属于管理员，用户没有权限，网上有坑人的办法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 777 /usr/local</span><br></pre></td></tr></table></figure><p>甚至有人：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 777 /usr</span><br></pre></td></tr></table></figure><p>这完全是坑人的做法，<code>-R</code>表示递归执行，即<code>/usr</code>目录下的所有文件夹、文件都改成了777的权限。那么你以后就再也不能用sudo、su命令了。</p><p>最好的做法是创建一个文件夹作为中转站：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /usr/local/hadoop</span><br></pre></td></tr></table></figure><p>这个新建的hadoop文件夹就是中转站。</p><p>然后改变该文件夹的拥有者：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> hadoop103 /usr/local/hadoop</span><br></pre></td></tr></table></figure><p>即可正常传过来了。</p><p>然后再移动位置…</p><h1 id="开启集群服务时报权限不足的错"><a href="#开启集群服务时报权限不足的错" class="headerlink" title="开启集群服务时报权限不足的错"></a>开启集群服务时报权限不足的错</h1><p>产生这个问题的原因可能是ssh登录自己仍然需要密码。请检查一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh localhost</span><br></pre></td></tr></table></figure><p>如果需要输入密码，则：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>即给自己一把公钥。如果您还没有公钥，请：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>生成公钥，然后在执行上一步给自己公钥。</p><p>当然也有可能是自己的公钥没有给某台服务器，自行检查，然后递交</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id 目标IP</span><br></pre></td></tr></table></figure><h1 id="集群中有一个或两个节点的服务没有启动"><a href="#集群中有一个或两个节点的服务没有启动" class="headerlink" title="集群中有一个或两个节点的服务没有启动"></a>集群中有一个或两个节点的服务没有启动</h1><p>多半是workers文件有问题，请前去修改。</p><p>如果三个都没启动，这是集群启动脚本出现问题了（或者是集群配置）。</p><p>也有可能是没有配置<code>$HADOOP_HOME</code>就使用脚本了，脚本里有这个内容，需要先配置hadoop的环境变量。</p><h1 id="启动服务时，Yarn的NodeManager服务没有启动"><a href="#启动服务时，Yarn的NodeManager服务没有启动" class="headerlink" title="启动服务时，Yarn的NodeManager服务没有启动"></a>启动服务时，Yarn的NodeManager服务没有启动</h1><p>其他的服务全都正常启动了，唯独Yarn的NodeManager一个没有启动。这种情况可能有两种原因：</p><ol><li>配置文件写得有问题，稳妥起见请检查所有配置文件（配置的那4个），也有可能是两个节点的服务器的文件内容不一致，请利用分发脚本统一。</li><li>权限问题，请参看上述第一点，克隆公钥给自己</li></ol><h1 id="关闭Yarn有WARNING"><a href="#关闭Yarn有WARNING" class="headerlink" title="关闭Yarn有WARNING"></a>关闭Yarn有WARNING</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop105: WARNING: nodemanager did not stop gracefully after 5 seconds: Trying to <span class="built_in">kill</span> with <span class="built_in">kill</span> -9</span><br><span class="line">hadoop103: WARNING: nodemanager did not stop gracefully after 5 seconds: Trying to <span class="built_in">kill</span> with <span class="built_in">kill</span> -9</span><br></pre></td></tr></table></figure><p>这个是服务器安全高产生的，其实不用管。如果输入：<code>jpsall</code>看到NodeManager服务已经关闭了，就不用管了，如果没有关闭则单独关闭一次Yarn即可：<code>$HADOOP_HOME/sbin/stop-yarn.sh</code></p><p>没有用的话就开启hdfs在关闭yarn（因为一般是要求是先关闭yarn再关闭hdfs）</p><h1 id="访问Web网站相关问题"><a href="#访问Web网站相关问题" class="headerlink" title="访问Web网站相关问题"></a>访问Web网站相关问题</h1><p>Hadoop集群正常启动（<code>jpsall</code>该启动的服务全都启动了），但是还是无法浏览器访问。</p><p>例如：无法访问hadoop103:9870。</p><h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><p>检查虚拟机防火墙是否关闭：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><p>正常情况，如果是跟着我走的流程的话应该是连这个防火墙服务都没有的。</p><p>如果确实是防火墙没关，则：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure><p>其实主机能够 ping 通虚拟机，就说明了虚拟机的防火墙是关闭状态。</p><h2 id="hosts映射"><a href="#hosts映射" class="headerlink" title="hosts映射"></a>hosts映射</h2><p>您有可能没有编写hosts映射（Windows或Mac中），查看：</p><p>如果将hadoop103改为192.168.64.103 。即改为IP，访问：192.168.64.103:9870，成功访问，则就是hosts配置错误。</p><p>在主机中输入：<code>vim /etc/hosts</code>查看是否正确映射。如果是Windows，则在<code>C:\Windows\System32\drivers\etc</code>下。</p><p>如果不正确则修改，或者没有配置则添加。</p><p>正确格式为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IP hadoop10x</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line">192.168.64.103 hadoop103</span><br></pre></td></tr></table></figure><p>主机检查完了，再挨个检查三台虚拟机是否也正确配置了hosts。</p><h2 id="检查hdfs配置文件是否配好"><a href="#检查hdfs配置文件是否配好" class="headerlink" title="检查hdfs配置文件是否配好"></a>检查hdfs配置文件是否配好</h2><p>正确内容（注意看value内的内容是否正确，是否和你的hosts映射一样）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;?xml-stylesheet <span class="built_in">type</span>=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- nn web 端访问地址--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.http-address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hadoop103:9870&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;!-- 2nn web 端访问地址--&gt;</span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;hadoop105:9868&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><h2 id="不确定的情况"><a href="#不确定的情况" class="headerlink" title="不确定的情况"></a>不确定的情况</h2><p>这个我其实也没拿捏到位：</p><p>我发现/etc/hosts发现第二行是：127.0.1.1 hadoop103，如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_IP.png" alt="配置端口号" style="zoom:33%;" /></p><p>然后我ping localhost是ping的127.0.0.1。然后ping hadoop103 ping的是127.0.1.1 。然后我把第二行这个删掉了，再启动集群就可以正常访问了。</p><p>我有这个想法是看到一片文章将hadoop103:9870改成0.0.0.0:9870就成功了，根据0.0.0.0的特性，我大概就猜到了配置文件最后启动的hadoop103应该是不我配置的静态IP，而是127.0.0.1 。</p><p>我目前是把三台虚拟机的第二行都删除了。</p><p>我也不太清楚删除这个第二行会不会有什么影响，因为它是默认就有的内容，我总感觉好像不能轻易删除。如果有友友知道删除会出现什么问题，麻烦提醒下我。如果可以用其他办法解决也提醒下我。</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hadoop常用端口号</title>
      <link href="/posts/4130790367.html"/>
      <url>/posts/4130790367.html</url>
      
        <content type="html"><![CDATA[<h1 id="常用端口号列举"><a href="#常用端口号列举" class="headerlink" title="常用端口号列举"></a>常用端口号列举</h1><p>HDFS NameNode 内部通常端口：8020/9000/9820<br>HDFS NameNode 对用户的查询端口：9870<br>Yarn查看任务运行情况的：8088<br>历史服务器：19888</p><h1 id="具体访问演示"><a href="#具体访问演示" class="headerlink" title="具体访问演示"></a>具体访问演示</h1><blockquote><p>可能会出现问题，如果出现了问题请参看：<a href="/posts/2075104059.html" title="搭建hadoop集群常见问题">搭建hadoop集群常见问题</a></p></blockquote><h2 id="web端查看HDFS的NameNode"><a href="#web端查看HDFS的NameNode" class="headerlink" title="web端查看HDFS的NameNode"></a>web端查看HDFS的NameNode</h2><p>浏览器访问：<a href="http://hadoop103:9870">http://hadoop103:9870</a> </p><p>注意我是配置了端口别名的，所以我可以hadoop103，如果了没配置，即把hadoop103替换为你hadoop103所在服务器的IP地址。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop103_9870.png" alt="查看NameNode效果"></p><p>如果没有配置静态IP或端口别名，可参看我博客里的文章（有介绍）。</p><p>查看2nn：<a href="http://hadoop105:9868">http://hadoop105:9868</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop105_9868.png" alt="查看2nn效果"></p><h2 id="Web-端查看-YARN-的-ResourceManager"><a href="#Web-端查看-YARN-的-ResourceManager" class="headerlink" title="Web 端查看 YARN 的 ResourceManager"></a>Web 端查看 YARN 的 ResourceManager</h2><p>浏览器访问：<a href="http://hadoop104:8088">http://hadoop104:8088</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop104_8088.png" alt="查看ResourceManage效果"></p><h2 id="查看JobHistory"><a href="#查看JobHistory" class="headerlink" title="查看JobHistory"></a>查看JobHistory</h2><p>浏览器访问：<a href="http://hadoop103:19888/jobhistory">http://hadoop103:19888/jobhistory</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop103_19888.png" alt="查看JobHistory效果"></p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Hadoop集群</title>
      <link href="/posts/1271036369.html"/>
      <url>/posts/1271036369.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注意，这里搭建的是伪分布式模式。</p><p>伪分布式模式：也是单机运行，但是具备 Hadoop 集群的所有功能，一台服务器模<br>拟一个分布式的环境。</p><p>如果出现问题，可以去参看文章 <a href="/posts/2075104059.html" title="搭建hadoop集群常见问题">搭建hadoop集群常见问题</a><br><!-- > [搭建hadoop集群常见问题](2075104059) --></p></blockquote><h1 id="再造虚拟机"><a href="#再造虚拟机" class="headerlink" title="再造虚拟机"></a>再造虚拟机</h1><p>前面已经创建了一台虚拟机了，两种选择：</p><ol><li>选择直接克隆。由于涉及分发脚本等，虚拟机最好配置成静态IP（不配置其实也可以，只是未来IP改变后有部分东西会受影响）。克隆之后Hadoop和jdk等就都配置好了。注意克隆是在虚拟机软件（VMware、UTM）上右键虚拟机就可以克隆了。如果之前是手动配置的静态IP(修改netplan文件的)，需要去看看netplan文件(配置静态IP的那个文件)看看IP信息，多半都需要改改，改成新的IP地址,可能用户名和主机名也需要修改，可以查看<a href="/posts/820223701.html" title="修改Ubuntu用户名、密码和主机名">修改Ubuntu用户名、密码和主机名</a>，<strong>具体改后的值先看看下面的内容</strong>。</li><li>再按照前面的流程创建两台虚拟机（Hadoop可以先不安装，但是jdk要安装上），这种适合非手动配置静态IP的人（在安装时就配置了静态IP的人）。</li></ol><p>对了，配置的时候不要想着内存、核心数、硬盘数太大了，其实虚拟机用的内存不大，设置的是最大的内存，也就是三台机子同时高功耗执行任务才就会有达到（<del>能到那种程度基本就用的公司的服务器了，学习更不用担心</del>），核心数也是用的虚拟核心数，类似于线程数，一般也跑不满，硬盘就是最大硬盘了，Linux中可能只有主服务器占资源多一点，另外两台基本就是占用10GB左右硬盘，但是搭建好集群后，可能虚拟机总的硬盘要占到50GB左右，和512GB比起来问题也不大。</p><h1 id="Hadoop集群配置规划"><a href="#Hadoop集群配置规划" class="headerlink" title="Hadoop集群配置规划"></a>Hadoop集群配置规划</h1><div class="table-container"><table><thead><tr><th></th><th>1号服务器</th><th>2号服务器</th><th>3号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode</td><td>DataNode</td><td>SecondaryNameNode、DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager、NodeManager</td><td>NodeManager</td></tr></tbody></table></div><blockquote><p> 1号服务器还要配置历史服务器：JobHistoryServer</p></blockquote><h1 id="集群分发脚本"><a href="#集群分发脚本" class="headerlink" title="集群分发脚本"></a>集群分发脚本</h1><p>未来避免每台服务器都执行相同操作，需要自行编写集群分发脚本，使得各服务器快速,方便地同步一些内容。</p><p>参看： <a href="/posts/3772089482.html" title="集群分发脚本">集群分发脚本</a><br><!-- [集群分发脚本](3772089482) --></p><h1 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h1><p>Hadoop 配置文件分两类：默认配置文件和自定义配置文件，只有用户想修改某一默认 配置值时，才需要修改自定义配置文件，更改相应属性值。</p><p>由于你可能和我的位置不太一样，那就统一把hadoop根目录配置到环境变量中：<code>vim ~/.bashrc</code>,添加内容（这在后面启停脚本中需要，请你务必配置这一项）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HADOOP_HOME</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/local/hadoop</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin</span><br></pre></td></tr></table></figure><p>刷新配置：<code>source ~/.bashrc</code>。之后就可以直接输入<code>cd $HADOOP_HOME</code>命令就可以跳转到hadoop的根目录<code>/ur/local/hadoop</code>下了。相当于是名词替换了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_setfiles.png" alt="相关配置文件" style="zoom:50%;" /></p><p>hadoop的配置文件都在<code>$HADOOP_HOME/etc/hadoop</code>目录下。</p><ol><li>默认配置文件</li></ol><pre><code>| 要获取的默认文件     | 文件存放在 Hadoop 的 jar 包中的位置                       || -------------------- | --------------------------------------------------------- || [core-default.xml]   | hadoop-common-3.3.1.jar/core-default.xml                  || [hdfs-default.xml]   | hadoop-hdfs-3.3.1.jar/hdfs-default.xml                    || [yarn-default.xml]   | hadoop-yarn-common-3.3.1.jar/yarn-default.xml             || [mapred-default.xml] | hadoop-mapreduce-client-core-3.3.1.jar/mapred-default.xml |</code></pre><ol><li><p>自定义配置文件</p><p> core-site.xml、hdfs-site.xml、yarn-site.xml、mapred-site.xml 四个配置文件存放在 <code>$HADOOP_HOME/etc/hadoop</code> 这个路径上，用户可以根据项目需求重新进行修改配置。我们后面进行的相关配置也是对这四个文件进行配置。</p></li><li><p>都是对应着核心配置文件core、hdfs配置文件、yarn配置文件、MapReduce配置文件。</p></li></ol><h1 id="配置集群"><a href="#配置集群" class="headerlink" title="配置集群"></a>配置集群</h1><blockquote><p>先都是在一号服务器（hadoop103）操作，之后利用分发脚本分发过去就行了，减少重复操作。</p></blockquote><p>进入配置文件目录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/etc/hadoop</span><br></pre></td></tr></table></figure><h2 id="核心配置文件"><a href="#核心配置文件" class="headerlink" title="核心配置文件"></a>核心配置文件</h2><p>配置 core-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim core-site.xml # 前提是跳转到了 $HADOOP_HOME/etc/hadoop 目录下</span><br></pre></td></tr></table></figure><p>文件内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 NameNode 的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop103:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 指定 hadoop 数据的存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置 HDFS 网页登录使用的静态用户为 hadoop103 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_core-site.png" alt="core-site" style="zoom:33%;" /></p><h2 id="HDFS配置文件"><a href="#HDFS配置文件" class="headerlink" title="HDFS配置文件"></a>HDFS配置文件</h2><p>配置hdfs-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim hdfs-site.xml</span><br></pre></td></tr></table></figure><p>文件内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- nn web 端访问地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2nn web 端访问地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop105:9868<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_hdfs_site.png" alt="hdfs-site" style="zoom:33%;" /></p><p>注意看端口，以后访问正确的端口.</p><h2 id="YARN配置文件"><a href="#YARN配置文件" class="headerlink" title="YARN配置文件"></a>YARN配置文件</h2><p>配置 yarn-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim yarn-site.xml</span><br></pre></td></tr></table></figure><p>文件内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 MR 走 shuffle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 ResourceManager 的地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 环境变量的继承 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CO</span><br><span class="line">            NF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAP</span><br><span class="line">            RED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启日志聚集功能 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置日志聚集服务器地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://hadoop103:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置日志保留时间为 7 天 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_yarn_site.png" alt="yarn-site" style="zoom:33%;" /></p><p>3.2版本以上不需要配置环境变量了。</p><h2 id="MapReduce配置文件"><a href="#MapReduce配置文件" class="headerlink" title="MapReduce配置文件"></a>MapReduce配置文件</h2><p>配置mapred-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mapred-site.xml</span><br></pre></td></tr></table></figure><p>文件内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 MapReduce 程序运行在 Yarn 上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/usr/local/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/usr/local/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=/usr/local/hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 历史服务器端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 历史服务器 web 端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop103:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_mapred_site.png" alt="mapred-site" style="zoom:33%;" /></p><h2 id="配置workers"><a href="#配置workers" class="headerlink" title="配置workers"></a>配置workers</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim workers</span><br></pre></td></tr></table></figure><p>写入（默认里面有内容localhost，但是我的hadoop103对于的有localhost，所以我把localhost删掉了，写入下面内容）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br><span class="line">hadoop105</span><br></pre></td></tr></table></figure><p>配置文件写完了，可以再cat检查一下写得对不对。</p><hr><h2 id="分发Hadoop配置文件"><a href="#分发Hadoop配置文件" class="headerlink" title="分发Hadoop配置文件"></a>分发Hadoop配置文件</h2><p>利用集群分发脚本，如果还没有弄集群分发脚本请参看<a href="/posts/3772089482.html" title="集群分发脚本">集群分发脚本</a><br><!-- [集群分发脚本](3772089482). --></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /usr/local/hadoop/etc/hadoop</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_xsync1.png" alt="分发结果" style="zoom:33%;" /></p><h1 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h1><blockquote><p>没有特别说明都是在$HADOOP_HOME目录下执行命令。</p></blockquote><h2 id="第一次启动"><a href="#第一次启动" class="headerlink" title="第一次启动"></a>第一次启动</h2><p><b>如果集群是第一次启动</b>，需要在 hadoop103 节点格式化 NameNode（注意：格式化 NameNode，会产生新的集群 id，导致 NameNode 和 DataNode 的集群 id 不一致，集群找不到已往数据。如果集群在运行过程中报错，需要重新格式化 NameNode 的话，一定要先停止 namenode 和 datanode 进程，并且要删除所有机器的 data 和 logs 目录，然后再进行格式化。）</p><p>注意是集群启动之前初始化，如果启动了请先停止集群再执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure><p>初始化完毕会新生成两个文件夹，一个是data（hadoop的数据存储目录），另一个是logs（hadoop的日志存储目录）.</p><p><b>再提醒一遍：之后再执行namenode初始化命令要提前把data和logs删除，且停止集群</b></p><h2 id="正式启动"><a href="#正式启动" class="headerlink" title="正式启动"></a>正式启动</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-dfs.sh</span><br></pre></td></tr></table></figure><p>关闭即为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/stop-dfs.sh</span><br></pre></td></tr></table></figure><h2 id="启动YARN"><a href="#启动YARN" class="headerlink" title="启动YARN"></a>启动YARN</h2><p>在配置了 ResourceManager 的节点启动，即hadoop104，输入下面命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/start-yarn.sh</span><br></pre></td></tr></table></figure><p>关闭即为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/stop-yarn.sh</span><br></pre></td></tr></table></figure><h2 id="启动历史服务器"><a href="#启动历史服务器" class="headerlink" title="启动历史服务器"></a>启动历史服务器</h2><p>在hadoop103上启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapred --daemon start historyserver</span><br></pre></td></tr></table></figure><p>查看历史服务器是否启动:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure><p>查看JobHistory:</p><p><a href="http://hadoop103:19888/jobhistory">http://hadoop103:19888/jobhistory</a></p><p>关闭即为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapred --daemon stop historyserver</span><br></pre></td></tr></table></figure><p>这样就启动成功了。</p><blockquote><p>注意启动和关闭顺序：</p><p>启动： dfs -&gt; yarn -&gt; historyserver</p><p>关闭；histroyserver -&gt; yarn -&gt; dfs</p></blockquote><hr><h1 id="封装集群启停脚本"><a href="#封装集群启停脚本" class="headerlink" title="封装集群启停脚本"></a>封装集群启停脚本</h1><blockquote><p>此脚本只包含HDFS、Yarn、Historyserver 。如果有其他服务，自行参照改写代码。</p></blockquote><p>作用：方便快速的启动和停止集群。</p><p>不用输入<code>sbin/start-dfs.sh</code>、<code>sbin/start-yarn.sh</code>等。</p><p>存放地址：</p><p><code>/home/hadoop/bin</code>这是自己编写的脚本的存放地。前面的xsync就是在这里面，这个文件路径也已经被添加进了环境变量。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/hadoop103/bin</span><br><span class="line">vim myhadoop</span><br></pre></td></tr></table></figure><p>写入脚本文件内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No Args Input...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> ;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; =================== 启动 hadoop 集群 ===================&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; --------------- 启动 hdfs ---------------&quot;</span></span><br><span class="line">    ssh hadoop103 <span class="string">&quot;<span class="variable">$HADOOP_HOME</span>/sbin/start-dfs.sh&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; --------------- 启动 yarn ---------------&quot;</span></span><br><span class="line">    ssh hadoop104 <span class="string">&quot;<span class="variable">$HADOOP_HOME</span>/sbin/start-yarn.sh&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; --------------- 启动 historyserver ---------------&quot;</span></span><br><span class="line">    ssh hadoop103 <span class="string">&quot;<span class="variable">$HADOOP_HOME</span>/bin/mapred --daemon start historyserver&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="string">&quot;stop&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; =================== 关闭 hadoop 集群 ===================&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; --------------- 关闭 historyserver ---------------&quot;</span></span><br><span class="line">    ssh hadoop103 <span class="string">&quot;<span class="variable">$HADOOP_HOME</span>/bin/mapred --daemon stop historyserver&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; --------------- 关闭 yarn ---------------&quot;</span></span><br><span class="line">    ssh hadoop104 <span class="string">&quot;<span class="variable">$HADOOP_HOME</span>/sbin/stop-yarn.sh&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; --------------- 关闭 hdfs ---------------&quot;</span></span><br><span class="line">    ssh hadoop103 <span class="string">&quot;<span class="variable">$HADOOP_HOME</span>/sbin/stop-dfs.sh&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Input Args Error...&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>其实内容很简单，就是先获取参数个数：<code>$#</code>；</p><ul><li><p>如果参数个数小于1（<code>if [ $# -lt 1]</code>），也就是没有参数，就输出提升说没有参数，然后结束脚本。</p></li><li><p>如果参数个数大于等于1，就执行下面的命令。</p><p>  直接就是一个switch-case判断参数是干嘛的，注意只判断第一个参数<code>$1</code>，如果是start就启动，启动就跳转到hadoop103中启动hdfs<code>ssh hadoop103 &quot;$HADOOP_HOME/sbin/start-dfs.sh&quot;</code>，然后启动yarn，跳转到hadoop104启动yarn<code>ssh hadoop104 &quot;$HADOOP_HOME/sbin/start-yarn.sh&quot;</code>。之后又跳转到hadoop103启动历史服务器功能<code>ssh hadoop103 &quot;$HADOOP_HOME/bin/mapred --daemon start historyserver&quot;</code>。</p></li></ul><p>关闭同理。</p><p>所以需要配置ssh免密登录，否则可能就报错，ssh免密登录请参看：<a href="/posts/3772089482.html" title="集群分发脚本">集群分发脚本</a><br><!-- [集群分发脚本](3772089482) --></p><h2 id="赋予脚本执行权限"><a href="#赋予脚本执行权限" class="headerlink" title="赋予脚本执行权限"></a>赋予脚本执行权限</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x myhadoop</span><br></pre></td></tr></table></figure><p>以后启动和关闭就简单了。</p><p>启动：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myhadoop start</span><br></pre></td></tr></table></figure><p>关闭：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myhadoop stop</span><br></pre></td></tr></table></figure><hr><h1 id="编写统一状态查看脚本"><a href="#编写统一状态查看脚本" class="headerlink" title="编写统一状态查看脚本"></a>编写统一状态查看脚本</h1><p>作用：一个命令，查看所有节点上的服务运行状态</p><p>原理：<code>jps</code>是查看一台节点上的服务运行状态命令。利用ssh跳转调用<code>jps</code>命令即可完成。很简答，有时间自己尝试写吧。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/hadoop103/bin</span><br><span class="line">vim jpsall</span><br></pre></td></tr></table></figure><p>编写脚本内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> hadoop103 hadoop104 hadoop105</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> =============== <span class="variable">$host</span> ===============</span><br><span class="line">    ssh <span class="variable">$host</span> jps</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>赋予脚本执行权限：<code>chmod +x jpsall</code></p><h1 id="统一测试"><a href="#统一测试" class="headerlink" title="统一测试"></a>统一测试</h1><p>这里直接就可以测试.</p><p>测试包含以下内容：</p><ol><li>测试集群是否能正常启动，搭建是否正确</li><li>测试myhadoop集群启停脚本是否正常工作</li><li>测试jpsall统一状态查看脚本是否正常工作</li><li>脚本是否符合预期计划，将服务配置到对应服务器上</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myhadoop start</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/myhadoop_test.png" alt="测试统一启动脚本" style="zoom: 50%;" /></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jpsall</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/test_jpsall.png" alt="测试统一状态查看脚本" style="zoom: 64%;" /></p><p>注意对照我们前面的规划表<a href="#Hadoop集群配置规划">Hadoop集群配置规划</a>.查看服务是否启动，以及启动节点是否正确。</p><p>如果谨慎的话可以查看对应端口是否能正常访问，请参看<a href="/posts/4130790367.html" title="hadoop常用端口号">hadoop常用端口号</a>（这里常常会出现一点问题）。<br><!-- [hadoop常用端口号](4130790367) --></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myhadoop stop</span><br></pre></td></tr></table></figure><p>然后在jpsall查看一下，如果所有服务器都只剩jps一个服务了，就代表顺利关闭了。</p><p>如果有问题请参看：<a href="/posts/2075104059.html" title="搭建hadoop集群常见问题">搭建hadoop集群常见问题</a></p><!-- [搭建hadoop集群常见问题](2075104059) -->]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>集群分发脚本</title>
      <link href="/posts/3772089482.html"/>
      <url>/posts/3772089482.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注意分布式集群操作一定会用到ssh，所以要开启ssh服务。并且要网络能够互相ping通</p></blockquote><h1 id="scp-secure-copy-安全拷贝"><a href="#scp-secure-copy-安全拷贝" class="headerlink" title="scp(secure copy)安全拷贝"></a>scp(secure copy)安全拷贝</h1><blockquote><p>这部分是分发脚本的基础介绍。如果只是想快速搭建，这部分可跳过。</p></blockquote><ol><li><p>定义</p><p> 可以实现服务器于服务器之间的数据拷贝。（一个服务器中的数据拷贝给另一个服务器）</p></li><li><p>基本语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scp     -r           $pdir/$fname $user@$host:$pdir/$fname</span><br><span class="line">命令名   递归方式执行   被拷贝的文件的用户名@主机，文件目录/文件名    接收的用户名@主机:存放目录/存放文件名</span><br><span class="line"></span><br><span class="line">如果是要拉取资源，也就是被拷贝文件是对方服务器，就将 $user@$host: 写在对象资源路径前：</span><br><span class="line">scp     -r           $user@$host:$pdir/$fname $pdir/$fname</span><br></pre></td></tr></table></figure></li><li><p>演练1</p><p> 将hadoop103的家目录下的a1.log(在家目录下新建一个：<code>touch ～/a1.log</code>)拷贝到hadoop105的家目录下</p><p> 被拷贝的文件：<code>/home/hadoop103/a1.log</code></p><p> 拷贝目标：<code>hadoop@192.168.64.105:/home/hadoop105/a1_copy.log</code></p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /home/hadoop103/a1.<span class="built_in">log</span> hadoop105@192.168.64.105:/home/hadoop105/a1_copy.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p> 注意，执行之后回询问是否继续连接，输入yes后，回要求输入<strong>对方</strong>的密码，过程如下：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E6%88%AA%E5%B1%8F2023-01-29%2010.05.56.png" alt="发送a1.log" style="zoom:50%;" /></p><p> 去hadoop105检查一下：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/scp1.png" alt="验证发送成功" style="zoom:50%;" /></p><p> 可以看到已经移动过去了。</p></li><li><p>演练2</p><p> 演练一是发送的感觉，现在试试拉取（a1_copy.log），本地存储为a1.log</p><p> 把hadoop103下的a1.log删除掉<code>rm ~/a1.log</code></p><p> 在hadoop103下：</p><p> 数据来源的地方写的<code>hadoop105@192.168.10.105:/home/hadoop105/a1_copy.log</code></p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r hadoop105@192.168.64.105:/home/hadoop105/a1_copy.<span class="built_in">log</span> /home/hadoop103/a1.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/scp2.png" alt="scp2" style="zoom:50%;" /></p><p> 如图即为成功。</p><h1 id="rsync远程同步指令"><a href="#rsync远程同步指令" class="headerlink" title="rsync远程同步指令"></a>rsync远程同步指令</h1><blockquote><p>这部分也是分发脚本的基础介绍。如果只是想快速搭建，这部分可跳过。</p></blockquote><ol><li><p>定义</p><p> 主要侧重在同步，意思是原本就有一部分数据，但是一方做出了变动，想要同步，这时候不需要再完全复制一份。</p><p> rsync 主要用于备份和镜像。具有速度快、避免复制相同内容和支持符号链接的优点。</p><p> rsync 和 scp 区别：用 rsync 做文件的复制要比 scp 的速度快，rsync 只对差异文件做更新。scp 是把所有文件都复制过去。</p></li><li><p>基本语法</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rsync -av $pdir/$fname  $user@$host:$pdir/$fname</span><br><span class="line">命令名  选项参数   要拷贝的文件路径/名称 目的地用户@主机:目的地路径/名称</span><br><span class="line"></span><br><span class="line">如果是拷贝来源是对方,就给对方加 $user@$host: 就好了，（拉取资源时）：</span><br><span class="line">rsync -av $user@$host:$pdir/$fname  $pdir/$fname</span><br><span class="line"></span><br><span class="line">-a归档拷贝</span><br><span class="line">-v显示复制过程</span><br></pre></td></tr></table></figure></li><li><p>演练</p><p> 同步<code>/home/hadoop103</code>，只有hadoop103中才有a1.log文件（在hadoop104下操作）</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -a hadoop103@192.168.64.103:/home/hadoop103 /home/hadoop104</span><br></pre></td></tr></table></figure><p> 由于有-v命令回显示很多内容（显示很多内容不一定时全都拷贝了，只是显示出来了）。</p><p> 注意看输入的命令的路径是<code>/home/hadoop103</code>，因为a1.log在<code>/home/hadoop103</code>下。如果在<code>/home</code>下，会把对方整个<code>home</code>拉取拷贝到<code>/home/hadoop104</code>下，这个时候的结果实际上就是：<code>/home/hadoop104/hadoop103</code>就不是同步资源了，就完全是新拷贝了一份资源。</p></li></ol></li></ol><h1 id="配置SSH免密登录"><a href="#配置SSH免密登录" class="headerlink" title="配置SSH免密登录"></a>配置SSH免密登录</h1><blockquote><p>我们提到了集群会经常用ssh，每次使用都要使用密码会很麻烦，上面可以看出来的。下面就介绍配置免密登录</p></blockquote><p>这个是为之后的集群分发脚本打基础，有了这个会方便一些。</p><p>原理和<a href="/posts/4192183953.html" title="终端连接Ubuntu">终端连接Ubuntu</a>类似，可参看。</p><p>在hadoop103下操作：</p><ol><li><p>只要执行过ssh命令就会多出来一个.ssh目录，现在cd到.ssh目录，多产生一个公钥和一个密钥。</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p> 按三次回车即可：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_ssh1.png" alt="生成密钥" style="zoom:50%;" /></p><p> 在<code>～/.ssh</code>目录下会多生成两个文件，一个id_rsa是密钥，id_rsa.pub就是公钥。</p></li></ol><ol><li><p>然后将公钥拷贝到服务器:</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ./id_rsa.pub &gt;&gt; ./authorized_keys</span><br></pre></td></tr></table></figure><p> 再检查一下登录本地是否需要密码：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh localhost</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_ssh2.png" alt="验证免密登录" style="zoom:50%;" /></p><p> 这样是自己登录时的免密登录。</p><p> 之后需要配置其他服务器登录自己服务器也免密登录：</p><p> （当前操作的服务器是hadoop103嘛，以传递给hadoop104为例）：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id hadoop104@192.168.10.104</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_ssh3.png" alt="公钥配置给别人" style="zoom:50%;" /></p><p> 然后检查一下登录hadoop104试试需不需要密码：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh hadoop104@192.168.64.104</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_ssh4.png" alt="检验是否配置成功" style="zoom:50%;" /></p><p> 如果不需要设置密码就算设置好了。</p></li><li><p>同理，将hadoop103的传递给hadoop104、hadoop105</p></li></ol><p>总结一下就是三条命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">cat ./id_rsa.pub &gt;&gt; ./authorized_keys</span><br><span class="line">ssh-copy-id username@IP # 跟的是要递交的用户名@IP地址或主机名</span><br><span class="line">exit # 退出</span><br></pre></td></tr></table></figure><p>配置自己的ssh免密登录：先用<code>cat id_rsa.pub</code>获取到公钥，然后再<code>vim authorized_keys</code>在文件中添加新的公钥，之后保存退出。</p><p>然后在其他三台服务器上同样操作（每台服务器都要产生公钥在拷贝给另外两台）。（不过可以提前配置一下端口映射，先看下一段，配置之后操作简单很多）。</p><h1 id="配置服务器别名"><a href="#配置服务器别名" class="headerlink" title="配置服务器别名"></a>配置服务器别名</h1><p>和<a href="/posts/4192183953.html" title="终端连接Ubuntu">终端连接Ubuntu</a>类似，同样的道理来配置服务器别名：</p><p>用vim编写：<code>/etc/hosts</code>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure><p>下如下内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hadoop</span></span><br><span class="line">192.168.64.103 hadoop103</span><br><span class="line">192.168.64.104 hadoop104</span><br><span class="line">192.168.64.105 hadoop105</span><br></pre></td></tr></table></figure><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_IP.png" alt="配置端口号"></p><p>这就是把第一台的弄好了，接下来换到其他两台服务器，直接复制这段内容即可。</p><p>到目前，登录hadoop104的命令从原来的：<code>ssh hadoop104@192.168.64.104</code>变成了<code>ssh hadoop104@hadoop104</code>.</p><p>接着配置服务器别名（还是先在hadoop103下操作）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> ~/.ssh/config <span class="comment"># 在～/.ssh目录下创建文件config</span></span><br><span class="line"></span><br><span class="line">vim ~/.ssh/config <span class="comment"># 编写config</span></span><br></pre></td></tr></table></figure><p>写下内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Host hadoop103</span><br><span class="line">  HostName hadoop103</span><br><span class="line">  User hadoop103</span><br><span class="line">Host hadoop104</span><br><span class="line">  HostName hadoop104</span><br><span class="line">  User hadoop104</span><br><span class="line">Host hadoop105</span><br><span class="line">  HostName hadoop105</span><br><span class="line">  User hadoop105</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_IP3.png" alt="编辑配置信息"></p><p>同样，在其他三台服务器上进行同样操作。</p><p>这样完成后，上一步的<code>ssh hadoop104@hadoop104</code>也变成了：<code>ssh hadoop104</code>。更简洁了，当然，如果了愿意，也可以配置得更短，更简单。</p><p>OK，现在可以继续去弄一下免密登录啦，会方便很多啦。例如上面知识配置了hadoop103免密登录hadoop104，现在配置hadoop103免密登录hadoop105只需要：<code>ssh-copy-id hadoop105</code></p><h1 id="正式编写集群分发脚本"><a href="#正式编写集群分发脚本" class="headerlink" title="正式编写集群分发脚本"></a>正式编写集群分发脚本</h1><p>脚本内容其实就是封装了一下<code>rsync</code>命令，也不复杂。</p><ol><li><p>需求</p><p> 循环赋值文件到所有节点的相同目录下</p></li><li><p>分析和准备</p><p> 想要全局使用就要放在全局目录下（配置了PATH的目录下），配置了PATH的目录：</p><p> 为了安全把脚本写在<code>/home/hadoop103/bin</code>，新建这个目录，然后配置环境变量：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /home/hadoop103/bin</span><br></pre></td></tr></table></figure><p> 然后配置环境变量：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p> 写入内容：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/home/hadoop103/bin</span><br></pre></td></tr></table></figure><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_env1.png" alt="配置环境变量"></p><p> 然后刷新：<code>source ~/.bashrc</code></p><p> 检验一下，输入<code>echo $PATH</code></p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_env2.png" alt="检查环境变量"></p><p> 可以看到新的环境变量已经添加到原本到系统变量后了。</p></li><li><p>在<code>/home/hadoop103/bin</code>下新建脚本，写脚本</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> ~/xsync</span><br><span class="line">vim ~/xsync</span><br></pre></td></tr></table></figure><p> 写入脚本内容：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1. 判断参数个数，如果小于1，就直接退出</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Not Enough Arguement!</span><br><span class="line"><span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2. 遍历集群所有机器</span></span><br><span class="line"><span class="comment">#for host in hadoop102 hadoop103 hadoop104 这种写法要求配置了对应名称的IP地址，没配置，就直接写IP地址</span></span><br><span class="line"><span class="comment"># 本来主机名就要转化成IP地址的，所以直接用IP地址也没问题</span></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> hadoop103 hadoop104 hadoop105</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> ==================== <span class="variable">$host</span> ====================</span><br><span class="line">    <span class="comment">#3. 遍历所有目录，挨个发送</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        <span class="comment">#4. 判断文件是否存在，存在是核心代码</span></span><br><span class="line">        <span class="keyword">if</span> [ -e <span class="variable">$file</span> ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="comment">#5. 获取父目录</span></span><br><span class="line">                pdir=$(<span class="built_in">cd</span> -P $(<span class="built_in">dirname</span> <span class="variable">$file</span>); <span class="built_in">pwd</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">#6. 获取当前文件的名称</span></span><br><span class="line">                fname=$(<span class="built_in">basename</span> <span class="variable">$file</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">#7. 直接跳转到对应host去（相当于100跳转到102操作102），跳转过去执行引号例的脚本命令</span></span><br><span class="line">                ssh <span class="variable">$host</span> <span class="string">&quot;mkdir -p <span class="variable">$pdir</span>&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">#8. 执行同步命令</span></span><br><span class="line">                rsync -av <span class="variable">$pdir</span>/<span class="variable">$fname</span> <span class="variable">$host</span>:<span class="variable">$pdir</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$file</span> does not exists!</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p>给脚本添加可执行权限：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x xsync</span><br></pre></td></tr></table></figure></li><li><p>测试使用，把hadoop目录给分发过去，这样hadoop也就出现在其他两台服务器上了</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /usr/local/hadoop</span><br></pre></td></tr></table></figure><p> 注意：如果用了 sudo，那么 xsync 一定要给它的路径补全：<code>sudo ./bin/xsync  /usr/local/hadoop</code></p><p> 我在分发到时候遇到了问题，就是说权限不允许，解决办法：</p><p> 在其他两台服务器：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /usr/local/hadoop</span><br><span class="line">sudo <span class="built_in">chown</span> hadoop104 hadoop <span class="comment"># hadoop105 下写 hadoop105</span></span><br><span class="line">sudo <span class="built_in">chgrp</span> hadoop104 hadoop <span class="comment"># hadoop105 下写 hadoop105</span></span><br></pre></td></tr></table></figure><p> 然后再执行脚本分发命令，就分发过去了。</p></li></ol><p>到这里集群分发脚本就写好了。在其他两台服务上也如此操作。</p><p>注意集群分发脚本的使用就是直接分发这个目录，最好是路径是都有的。</p><p>如果：<code>xsync /home/hadoop103/bin</code>不是把bin给其他两个服务器，而是在其他两个服务器的<code>/home</code>目录下新建：<code>/hadoop103/bin</code>。和想的不一样哦，不是在<code>/home/hadoop104</code>或<code>/home/hadoop105</code>目录下新建<code>bin</code>目录。</p><p>可以继续看<a href="/posts/1271036369.html" title="搭建Hadoop集群">搭建Hadoop集群</a>啦</p>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> 操作系统 </category>
          
          <category> Hadoop </category>
          
          <category> Linux </category>
          
          <category> 环境搭建 </category>
          
          <category> Zookeeper </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>终端连接Ubuntu</title>
      <link href="/posts/4192183953.html"/>
      <url>/posts/4192183953.html</url>
      
        <content type="html"><![CDATA[<h1 id="终端连接服务器"><a href="#终端连接服务器" class="headerlink" title="终端连接服务器"></a>终端连接服务器</h1><blockquote><p>Windows用户如过想要使用xshell可以跳过(xshell根方便，很多人用这个，可自行搜索学习)。Mac下没有xshell，所以我需要配置下面的内容。当然，你Windows想配置也可以，可以不用下载xshell，但是Windows的终端用起来体验不太好…</p></blockquote><h2 id="终端连接服务器原理"><a href="#终端连接服务器原理" class="headerlink" title="终端连接服务器原理"></a>终端连接服务器原理</h2><p>输入:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 用户名@主机名 -port</span><br></pre></td></tr></table></figure><p>例如，我上面给我的主机名取名为zyr，ip设置为静态，为192.168.64.103。没有端口，所以为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh zyr@192.168.64.103</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2016.09.05.png" alt="截屏2023-01-18 16.09.05"></p><p>服务器端口就改变了，也可以执行操作了。</p><p>但是每次都需要输入这么多内容很麻烦。</p><h2 id="配置ssh免密登陆"><a href="#配置ssh免密登陆" class="headerlink" title="配置ssh免密登陆"></a>配置ssh免密登陆</h2><p>再打开一个终端（上面已经连接了服务器的终端可以继续保留）。即现在有两个终端，一个终端控制服务器，一个终端控制主机。</p><ol><li><p>在主机输入命令生成一串密钥（如过之前已经生成过的可以跳过这一步）：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;你的邮箱&quot;</span></span><br></pre></td></tr></table></figure><p> 输入之后，一直回车即可。</p></li><li><p>跳转路径查看它的公钥</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">vim id_rsa.pub</span><br></pre></td></tr></table></figure><p> 查看内容复制就好了。</p></li><li><p>现在使用服务器终端配置公钥：</p><p> 利用服务器端端终端跳转路径：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">vim authorized_keys</span><br></pre></td></tr></table></figure><p> 如过没有authorized_keys文件，利用：<code>touch authorized_keys</code>创建，再编辑。</p><p> 然后将刚才复制的公钥粘贴在这里。保存退出。</p></li><li><p>配置IP端口号别名</p><p> Windows的hosts文件应该在<code>C:\Windows\System32\drivers\etc</code>下（如果不在自行搜索）</p><p> Mac：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure><p> 添加内容：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP-端口 别名</span><br></pre></td></tr></table></figure><p> 例如：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.64.103 server01</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>配置服务器别名</p><p> 在主机的终端中配置服务器的别名，之后登陆时就方便了。</p><p> 还是在～/.ssh目录下（不在就cd过去）</p><p> 创建config文件：<code>touch config</code></p><p> 便携config文件：<code>vim config</code></p><p> 内容：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  UseKeychain <span class="built_in">yes</span></span><br><span class="line">Host 服务器别名</span><br><span class="line">  HostName 服务器端口号或IP</span><br><span class="line">  User 用户名</span><br></pre></td></tr></table></figure><p> 例如：</p><p> 我上面创建的服务器的IP为192.168.64.103（可在/etc/hosts中配置对应端口）。服务器的用户为zyr。</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  UseKeychain <span class="built_in">yes</span></span><br><span class="line">Host server01</span><br><span class="line">  HostName 192.168.64.103</span><br><span class="line">  User zyr</span><br></pre></td></tr></table></figure><p> 如果设置了端口别名，可以：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  UseKeychain yes</span><br><span class="line">Host server01</span><br><span class="line">  HostName server01</span><br><span class="line">  User zyr</span><br></pre></td></tr></table></figure><p> 如果想配置多个服务器别名：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  UseKeychain yes</span><br><span class="line">Host server01</span><br><span class="line">  HostName server01</span><br><span class="line">  User zyr</span><br><span class="line">Host server02</span><br><span class="line">  HostName server02</span><br><span class="line">  User zyr2</span><br></pre></td></tr></table></figure></li></ol><blockquote><p>到这里就大功告成了！！！</p></blockquote><p>登陆方法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 刚才设置的服务器别名</span><br></pre></td></tr></table></figure><p>例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh server01</span><br></pre></td></tr></table></figure><h2 id="如何退出ssh"><a href="#如何退出ssh" class="headerlink" title="如何退出ssh"></a>如何退出ssh</h2><p>一下方法都可以（我比较喜欢用<code>exit</code>）</p><ol><li>直接关闭终端</li><li>执行<code>logout</code>命令</li><li>执行<code>exit</code>命令</li><li>ctrl+D</li></ol>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Mac </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Mac </tag>
            
            <tag> 编程环境 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Hadoop环境</title>
      <link href="/posts/1141628095.html"/>
      <url>/posts/1141628095.html</url>
      
        <content type="html"><![CDATA[<h1 id="新建虚拟机"><a href="#新建虚拟机" class="headerlink" title="新建虚拟机"></a>新建虚拟机</h1><blockquote><p>这里对集群有一点说明，但为了文章不过长此文章不讲解搭建集群，请看本博客的另一篇文章（有一台虚拟机的Hadoop安装好后）</p></blockquote><p>Mac系统可以参考我的另一篇文章：<a href="694347442">UTM安装Ubuntu</a>（我自己用的是22.04.1 LTS 服务器版（非桌面版））。</p><p>Windows系统就自行找文章（找之前先稍微浏览一下下面的内容），Windows系统不用UTM，一般使用VMware。只要把VMware下载好了，然后创建好了基本的Ubuntu虚拟机，差不多就可以看我的另一篇文章了，因为Ubuntu内部是一样的。</p><p>由于涉及分发脚本等，最好配置成静态IP（不配置也可以，只是以后使用时会稍微麻烦点）</p><blockquote><p>可以选择先创建好一台虚拟机，然后克隆（适合手动配置静态IP的人，如果是在安装时就配置了静态IP可能就会出现问题）。这样是最快的。</p><p>如果选择安装时配置静态IP就可以同时安装三台机器，因为中途有较长的等待时间。</p></blockquote><p>最好如下规划进行配置。</p><h2 id="Hadoop配置规划"><a href="#Hadoop配置规划" class="headerlink" title="Hadoop配置规划"></a>Hadoop配置规划</h2><div class="table-container"><table><thead><tr><th></th><th>1号服务器</th><th>2号服务器</th><th>3号服务器</th></tr></thead><tbody><tr><td>name</td><td>hadoop103</td><td>hadoop104</td><td>hadoop105</td></tr><tr><td>IP</td><td>192.168.64.103</td><td>192.168.64.104</td><td>192.168.64.105</td></tr><tr><td>HDFS</td><td>NameNode、DataNode</td><td>DataNode</td><td>SecondaryNameNode、DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager、NodeManager</td><td>NodeManager</td></tr></tbody></table></div><h2 id="安装好一台虚拟机后简单测试"><a href="#安装好一台虚拟机后简单测试" class="headerlink" title="安装好一台虚拟机后简单测试"></a>安装好一台虚拟机后简单测试</h2><p>避免后续白忙活，这里记得要先检查一下：</p><p>最重要的就是IP了，检查是否是静态IP：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig <span class="comment"># 如果找不到命令，先下载网络工具包：sudo apt install net-tools</span></span><br></pre></td></tr></table></figure><p>如果有IP并且和配置的一样这一步就OK了。没有配置静态IP就查看是否有IP就行。</p><p>是否能上网：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure><p>主机（Windows/Mac）的终端是否能ping通虚拟机：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 上上步看到的IP <span class="comment"># 虚拟机的IP</span></span><br></pre></td></tr></table></figure><p>如果无法ping通，但是上上步看到的IP正确，可能就是虚拟机防火墙没关：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure><p>虚拟机能否ping通主机：</p><p>首先先查看主机IP（主机终端中）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig <span class="comment"># Mac</span></span><br><span class="line"></span><br><span class="line">ipconfig <span class="comment"># Windows</span></span><br></pre></td></tr></table></figure><p>然后虚拟机再ping得到的IP。如果ping不通，但是能ping通百度，可能是主机防火墙影响。从安装性考虑：Mac可以关，Windows最好不要先关闭防火墙，在需要的时候才关。</p><p>这样就基本可以了。</p><p>最好再更新一下apt：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><p>有的时候apt和apt-get可能会产生包依赖问题，这里推荐使用aptitude来安装软件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install aptitude</span><br></pre></td></tr></table></figure><p>aptitude命令格式和apt基本一样，如果apt下载包依赖失败，可以利用aptitude。</p><blockquote><p>一切都安装好后，按理上可以删除iso镜像文件了，但是后面可能会出问题，可能需要重装，最好留手准备。</p></blockquote><h1 id="下载安装Hadoop"><a href="#下载安装Hadoop" class="headerlink" title="下载安装Hadoop"></a>下载安装Hadoop</h1><h2 id="查看版本依赖关系"><a href="#查看版本依赖关系" class="headerlink" title="查看版本依赖关系"></a>查看版本依赖关系</h2><blockquote><p>这里只是给出查看版本以来关系的办法。如果想要快速完成搭建，这部分可以跳过</p></blockquote><p>直接在下面网站中找即可找打HBase与hadoop的版本关系：</p><p><a href="https://hbase.apache.org/book.html#architecture">https://hbase.apache.org/book.html#architecture</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadopp-hbase_version.png" alt="版本对应关系"></p><p>查看依赖关系：由于之后计划安装2.4.11版本的Hbase，所以对应关系为：3.3.1比较好（因为3.3.1搭配Hive也兼容）。当然也可以自己查查HBase与ZooKeeper（可直接使用HBase自带的）、Hive的版本依赖关系。</p><h2 id="下载Hadoop"><a href="#下载Hadoop" class="headerlink" title="下载Hadoop"></a>下载Hadoop</h2><blockquote><p><strong>更新：</strong><br>由于版本问题，为在后续技术的环境搭建过程中发现版本依赖问题于2月24日改hadoop版本为3.3.4。</p><p>该版本下载链接：<a href="https://archive.apache.org/dist/hadoop/common/hadoop-3.3.4/">https://archive.apache.org/dist/hadoop/common/hadoop-3.3.4/</a></p><p>选择 <code>hadoop-3.3.4.tar.gz</code></p><p>其他操作是相同的。</p></blockquote><p>我在Mac电脑（Windows电脑上也是这个网址）上访问网址：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.3.1/">https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.3.1/</a></p><p>如果你用的是桌面版的Ubuntu，可以直接在虚拟机中的FireFox（直接用Linux系统的浏览器）中访问下载（如果网速快的话，或者嫌不同系统移动文件麻烦）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop.png" alt="截屏2023-01-28 17.54.11"></p><p>我选择的是 hadoop-3.3.1-aarch64.tar.gz 这个是Mac M系列芯片的ARM架构Ubuntu的包</p><p>Windows 选 hadoop-3.3.1.tar.gz</p><p>点击即可下载。</p><h2 id="安装Hadoop"><a href="#安装Hadoop" class="headerlink" title="安装Hadoop"></a>安装Hadoop</h2><p><strong>之后如果没有特殊说明都是在hadoop103上面操作</strong></p><p>之后把下载好的压缩包放在<code>/usr/local</code>目录下：</p><blockquote><p>如果是非桌面版（在主机的浏览器上下载的Hadoop压缩包）：</p><ul><li>我利用UTM安装虚拟机的时候配置了共享文件夹，所以我可以直接把文件拖入虚拟机中完成移动。</li><li>如果是没有配置的Mac用户，推荐下载FileZilla，使用FileZilla完成移动。</li><li>如果是Windows用户，可以下载Xftp完成移动。</li></ul><p><span style="background: cyan">注意：</span></p><p>要先修改Hadoop目录的权限，否则会移动失败：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 777 /usr/local <span class="comment"># 千万不要改/usr的权限，因为/usr/bin/sudo在/usr下，如果将/usr的权限改为777，则无法使用sudo命令</span></span><br></pre></td></tr></table></figure><p>移动完成后再改变权限改回去：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 4755 /usr/local</span><br></pre></td></tr></table></figure><p><b>但是这个命令很坑</b>，有另一种解决办法（或者可以看：<a href="/posts/2075104059.html" title="搭建hadoop集群常见问题">搭建hadoop集群常见问题</a>，和下面的内容说的一样）：</p><p>在/usr/local下创建目录：hadoop</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> hadoop</span><br></pre></td></tr></table></figure><p>然后更改拥有者为本用户：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> hadoop103 hadoop</span><br></pre></td></tr></table></figure><p>之后将压缩文件移动到hadoop目录下。</p><p>然后再在虚拟机中将压缩包移动出去（移到<code>/usr/local</code>(移动之前在<code>/usr/local/hadoop</code>下)）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> hadoop/hadoop-3.3.1-aarch64.tar ./</span><br></pre></td></tr></table></figure><p>删除原本的hadoop目录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rmdir</span> hadoop</span><br></pre></td></tr></table></figure></blockquote><h2 id="解压压缩包"><a href="#解压压缩包" class="headerlink" title="解压压缩包"></a>解压压缩包</h2><p>先要把压缩包移动到<code>/usr/local</code>目录下。</p><p>如果是桌面版，直接右键解压即可。</p><p>非桌面版，终端输入（先<code>cd /usr/local</code>到对应目录下）：</p><p>可能我的Mac下载到.tar.gz就解压了一遍，我下载下来之后的安装包变成了.tar后缀的压缩包，我执行命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xf hadoop-3.3.1-aarch64.tar</span><br></pre></td></tr></table></figure><p>如果还是.tar.gz后缀，则：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxf hadoop-3.3.1-aarch64.tar.gz</span><br></pre></td></tr></table></figure><p>当前目录下就多了一个hadoop-3.3.1的目录了，为了方便未来操作，修改目录名为hadoop：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> ./hadoop-3.3.1 hadoop</span><br></pre></td></tr></table></figure><p>如图： </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/tar_hadoop.png" alt="截屏2023-01-28 18.25.04"></p><p>将拥有者更改为hadoop103用户：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> hadoop103:hadoop103 hadoop</span><br></pre></td></tr></table></figure><h2 id="安装配置jdk"><a href="#安装配置jdk" class="headerlink" title="安装配置jdk"></a>安装配置jdk</h2><p>查看hadoop版本的时候，报错：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/error_no_jdk.png" alt="截屏2023-01-28 18.31.14"></p><p>Hadoop运行是需要jdk的，直接用ubuntu自带的jdk就行了（因为MapReduce其实是在主机的IDEA上编写Java代码的，这里好像只需要一个运行的Java编译环境，所以这里的jdk版本也不重要）</p><blockquote><p>如果还是想要指定版本下载，实际上这种更简单一些，因为不用配置环境变量(以安装jdk8为例子)：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure><p>然后配置环境变量。配置环境变量看下面。</p><p>之后可直接查看java版本.</p></blockquote><p>下载自带的jdk：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install default-jdk</span><br></pre></td></tr></table></figure><p>这里比较久，三台同时弄吧～</p><p>安装好jdk后，配置环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><p>进入编辑后，自己按 i 输入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/default-java</span><br></pre></td></tr></table></figure><p>如果是其他版本就需要具体看了，例如安装了jdk8，就先 <code>ls /usr/lib/jvm</code> 看看叫什么名字。</p><p>我安装jdk8之后在/usr/lib/jvm目录下有两个文件，环境变量是java开头的那个，比如我的配置文件内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-arm64</span><br></pre></td></tr></table></figure><p>保存退出。</p><p>如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_jdk1.png" alt="配置环境变量"></p><p>然后生效：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>这样其实就好了，可以检查一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br><span class="line"></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"><span class="variable">$JAVA_HOME</span>/bin/java -version</span><br></pre></td></tr></table></figure><p>效果应该如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_jdk2.png" alt="检查jdk安装是否成功"></p><blockquote><p>如果想要切换版本，则需要先删除原本的jdk：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dpkg --list | grep -i jdk</span><br><span class="line"></span><br><span class="line">sudo apt-get purge jdk*</span><br><span class="line"></span><br><span class="line">sudo apt-get purge icedtea-* jdk-*</span><br></pre></td></tr></table></figure></p></blockquote><p>现在可以再检查hadoop的版本了（顺便也是再检查jdk是否安装成功）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/hadoop</span><br><span class="line"></span><br><span class="line">./bin/hadoop version</span><br></pre></td></tr></table></figure><p>效果应该如图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_version1.png" alt="查看Hadoop版本"></p><p>到这里一个基本的Hadoop已经配置好了。</p><h1 id="简单使用Hadoop"><a href="#简单使用Hadoop" class="headerlink" title="简单使用Hadoop"></a>简单使用Hadoop</h1><blockquote><p>如果按照上述步骤执行，应该没有问题了，下面是简单介绍hadoop命令，进一步检验hadoop是否安装成功。可以不执行下面的操作，下面也相当于是一个新手演示。</p></blockquote><p>在<code>/usr/local/hadoop</code>目录下操作：</p><ol><li><p>创建一个输入文件夹（wcinput）</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir wcinput</span><br></pre></td></tr></table></figure></li><li><p>在wcinput文件下创建一个文件word.txt文件并添加内容。我们接下来用hadoop读取一下这个word.txt中的数据</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd wcinput</span><br><span class="line">vim word.txt</span><br></pre></td></tr></table></figure><p> 写入以下内容：</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zyr zyr</span><br><span class="line">fw fw</span><br><span class="line">qwe qwe</span><br><span class="line">ewq eqweqe</span><br></pre></td></tr></table></figure></li><li><p>回到Hadoop目录下（/usr/local/hadoop）</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd .. # 因为才从这里cd到wcinput文件夹下，所以返回上一级就好了</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者就是写全</span></span><br><span class="line">cd /usr/local/hadoop</span><br></pre></td></tr></table></figure></li><li><p>创建一个目录wcoutput，用来存放hadoop读取数据的结果</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir wcoutput</span><br></pre></td></tr></table></figure></li><li><p>执行程序，运行hadoop读取处理数据</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar wordcount wcinput/ wcoutput</span><br></pre></td></tr></table></figure><p> 解释一下：</p><ul><li><p>执行的是<code>/usr/local/hadoop/bin</code>目录下的<code>hadoop</code>命令（当前在<code>/usr/local/hadoop</code>目录下，所以运行<code>/bin/hadoop</code>）</p></li><li><p><code>jar</code>表示要执行一个jar包，之后指定要执行的jar包（<code>hadoop-mapreduce-examples-3.3.1.jar</code>）,写上完整路径就是：<code>share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar</code></p><p>  mapreduce的作用是计算。这里相当于选的是一个计算模板包。</p></li><li><p>执行程序的选项是：<code>wordcount</code>，也就是单词计数，就是统计每个单词出现的次数。</p></li><li><p>需要读取的文件是<code>wcinput</code>下的所有文件（<code>wcinput/</code>）。</p></li><li><p>输出位置是<code>wcoutput</code>文件夹，如果事先没有准备这个文件夹，就写：<code>./wcoutput</code></p><p>最终表示为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行命令 选择执行jar包 执行选项 数据来源 结果输出</span><br></pre></td></tr></table></figure></li></ul></li><li><p>执行结果后得到数据，进入wcoutput目录下，查看生成文件</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_wordcount.png" alt="生成结果"></p></li><li><p>正在有结果的的是part-r-00000文件，查看文件内容</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/hadoop_wordcout2.png" alt=""></p><p> 它统计的是刚才写入内容中词语的个数。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 大数据开发 </category>
          
          <category> Hadoop </category>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大数据 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sudo和su都不能使用的问题</title>
      <link href="/posts/1259097482.html"/>
      <url>/posts/1259097482.html</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>我不知道脑子出啥问题了，我命令了：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 777 /usr</span><br></pre></td></tr></table></figure><p>导致<code>/usr/local/sudo</code>命令和<code>/usr/local/su</code>命令都不能使用了。</p><p>看到网上的解决办法都是只有其中一种问题，例如：报错：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo: /usr/bin/sudo must be owned by uid 0 and have the setuid bit <span class="built_in">set</span></span><br></pre></td></tr></table></figure><p>本来就应该<code>su root</code>，然后</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> root:root /usr/bin/sudo</span><br></pre></td></tr></table></figure><p>之后：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 4755 /usr/bin/sudo</span><br></pre></td></tr></table></figure><p>最后重启，完美解决。</p><p>可是我第一步就完蛋了，我运行：<code>su root</code>时出现问题：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su: Authentication failure</span><br></pre></td></tr></table></figure><p>查了之后说要执行<code>sudo passwd root</code>给root设置密码。但是我不能用sudo啊。而且我是使用过su的，密码我也记得。</p><h1 id="解决过程"><a href="#解决过程" class="headerlink" title="解决过程"></a>解决过程</h1><p>根据报错：<code>sudo: /usr/bin/sudo must be owned by uid 0 and have the setuid bit set</code>：</p><p>sudo的用户属组要属于uid 0，即root用户；同时sudo要设置setuid位。我首先查询了一下我系统中sudo的信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /usr/bin/sudo</span><br></pre></td></tr></table></figure><p>结果为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rwxrwxrwx  1 root root      215944 Feb 14  2022  sudo*</span><br></pre></td></tr></table></figure><p>是root用户。</p><p>那么就要设置setuid位：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 4755 /usr/bin/sudo</span><br><span class="line">或者</span><br><span class="line"><span class="built_in">chmod</span> u+s /usr/bin/sudo</span><br></pre></td></tr></table></figure><p>可是我没法用<code>sudo</code>啊，这咋改啊。</p><p>没有办法了，只能进入恢复模式 recovery mode。</p><h2 id="恢复模式"><a href="#恢复模式" class="headerlink" title="恢复模式"></a>恢复模式</h2><p>进入恢复模式：</p><p>选择Advanced options for Ubuntu，按下[Enter]进入，选择recovery mode，不要按下回车键。</p><p>按E进入到编辑界面，按向下键找到 到 linux /boot/vmlinuz-……. ro recovery nomodeset 所在行，将“ro recovery nomodeset”替换为“quiet splash rw init=/bin/bash”，按下[F10]或者[Ctrl+x]重启系统。</p><p>重启以后进入到这个页面，向下键选择root回车。</p><p>但是我还是糟糕啊，完蛋孩子。再尝试一会儿决定重装（删除虚拟机后新建）😭</p><blockquote><p>长记性啊，可千万不能chmod -R 777 啊</p></blockquote><p>你以为我能解决啊，我也想解决啊😅</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改Ubuntu用户名、密码和主机名</title>
      <link href="/posts/820223701.html"/>
      <url>/posts/820223701.html</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>我最开始创建了一台虚拟机服务器，用户名叫zyr，主机名也叫zyr，我现在想把它作为hadoop集群中的一台，为了避免我误操作，我想把主机名和用户名都改成hadoop103。</p><h1 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h1><ol><li><p>临时修改：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname 新的主机名</span><br></pre></td></tr></table></figure><p> 例如：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname hadoop103</span><br></pre></td></tr></table></figure><p> 这样修改会导致重启虚拟机，主机名变回去。</p></li><li><p>永久修改</p><p> 我们知道Ubuntu的配置文件一般在<code>/etc</code>目录下，所以<code>ls</code>一下发现了hostname，修改hostname：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hostname</span><br></pre></td></tr></table></figure><p> 将原本的内容（zyr）修改为新的主机名（hadoop103）。一般情况下，这个文件就只有一行，其内容就是主机名。然后按<kbd>esc</kbd>,输入<code>:wq</code>保存退出。保存退出后再重启更新，输入：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><p> 重启虚拟机，就发现主机名被修改成功了。</p></li></ol><hr><h1 id="修改用户名"><a href="#修改用户名" class="headerlink" title="修改用户名"></a>修改用户名</h1><p>这一步比较复杂，由于有切换用户名的过程，最好切换到其他用户上<del>但是既然有另一个用户，为什么不直接创建一个新用户，再把原来这个注销掉呢，更简单吧</del>（可能是保护该用户的数据？）。总之，我是切换到root权限下操作的（<strong>建议切换到root权限下</strong>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br></pre></td></tr></table></figure><p>如果报错请看：<a href="#./修改密码">修改密码</a></p><ol><li><p>修改用户密码文件：<code>/etc/passwd</code></p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/passwd</span><br></pre></td></tr></table></figure><p> 直接把所有zyr相关内容替换为hadoop103:</p><p> ==在命令模式下：==</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/zyr/hadoop103/g</span><br></pre></td></tr></table></figure></li><li><p>修改用户加密方式文件：<code>/etc/shadow</code></p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shadow</span><br></pre></td></tr></table></figure><p> 直接把所有zyr相关内容替换为hadoop103:</p><p> ==在命令模式下：==</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/zyr/hadoop103/g</span><br></pre></td></tr></table></figure></li><li><p>修改用户组文件：<code>/etc/group</code></p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/group</span><br></pre></td></tr></table></figure><p> 同上，把所有zyr换成hadoop103</p></li><li><p>最后修改用户的家目录</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /home/zyr /home/hadoop103</span><br></pre></td></tr></table></figure></li><li><p>再次登录就行：</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su hadoop103</span><br></pre></td></tr></table></figure></li></ol><h1 id="修改其他"><a href="#修改其他" class="headerlink" title="修改其他"></a>修改其他</h1><h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd username</span><br></pre></td></tr></table></figure><p>username是待修改密码的用户名。</p><p>输入命令后输入两次密码即可。</p><p>如果第一次登录root登录不上就：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性规划</title>
      <link href="/posts/88294277.html"/>
      <url>/posts/88294277.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-基本原理"><a href="#1-基本原理" class="headerlink" title="1 基本原理"></a>1 基本原理</h1><h2 id="1-1-线性规划问题概述"><a href="#1-1-线性规划问题概述" class="headerlink" title="1.1 线性规划问题概述"></a>1.1 线性规划问题概述</h2><p>在人们的生产实践中，经常会遇到如何利用现有资源来安排生产，以取得最大经济效益的问题。此类问题构成了运筹学的一个重要分支——数学规划，而线性规划(Linear Programming简记LP)则是数学规划的一个重要分支。</p><p>自从1947年G.B.Dantzig提出求解线性规划的单纯形方法以来，线性规划在理论上趋向成熟，在实用中日益广泛与深入。特别是在计算机能处理成千上万个约束条件和决策变量的线性规划问题之后，线性规划的适用领域更为广泛了，已成为现代管理中经常采用的基本方法之一。</p><h2 id="1-2-线性规划的实例与定义"><a href="#1-2-线性规划的实例与定义" class="headerlink" title="1.2 线性规划的实例与定义"></a>1.2 线性规划的实例与定义</h2><p>例如        某机床厂生产甲、乙两种机床，每台销售后的利润分别为4千元与3千元。生产甲机床需用A、B机器加工，加工时间分别为每台2小时和1小时;生产乙机床需用A、B、C三种机器加工,加工时间为每台各一小时。若每天可用于加工的机器时数分别为A机器10小时、B机器8小时和C机器7小时，问该厂应生产甲、乙机床各几台，才能使总利润最大?</p><p>上述问题的数学模型：设该厂生产$x_1$台甲机床和$x_2$乙机床时总利润$z$最大，则$x_1,x_2$应满足：</p><script type="math/tex; mode=display">\max\limits_{x} \quad z= 4x_1+3x_2 \\\begin{cases}2x_1 + x_2 \leqslant 10 \\x_1 + x_2 \leqslant 8 \\x_1 \leqslant 8 \\x_2 \leqslant 7 \\x_1,x_2 \geqslant 0\end{cases}</script><p>变量$x_1,x_2$称之为决策变量，$z=4x_1+3x_2$被称为目标函数，$z$为最优值，不等式为约束条件，记为s.t.(subject to).</p><p>三部分组成：</p><ol><li><p>目标函数：max $z = 4x_1 + 3x_2$</p></li><li><p>决策变量：$x_1,x_2$</p></li><li><p>约束条件：</p><script type="math/tex; mode=display"> \begin{cases} 2x_1 + x_2 \leqslant 10, \\ x_1 + x_2 \leqslant 8, \\ x_1 \leqslant 8,\\ x_2 \leqslant 7, \\ x_1, x_2 \geqslant 0. \end{cases}</script></li></ol><p>目标函数及约束条件<strong>均为</strong>线性函数，故被称为线性规划问题。线性规划问题是在一组线性约束条件的限制下，求一<strong>线性目标函数最大</strong>或<strong>最小</strong>的问题。</p><p>在解决实际问题时，把问题归结成一个线性规划数学模型是很重要的一步，往往也是很困难的一步，模型建立得是否恰当，直接影响到求解。而选适当的决策变量，是我们建立有效模型的关键之一。</p><h2 id="1-3-线性规划问题的解的概念"><a href="#1-3-线性规划问题的解的概念" class="headerlink" title="1.3 线性规划问题的解的概念"></a>1.3 线性规划问题的解的概念</h2><script type="math/tex; mode=display">\min\limits_{x} \quad w =  \,c^T\,x \\s.t.\begin{cases}Ax \leqslant b \\Aeq \cdot x = beq \\lb \leqslant x \leqslant ub\end{cases}</script><p>其中：</p><ul><li><p>$c$ 和 $x$ 为 $n$ 维<strong>列</strong>向量</p><p>  例如上例：$z = 2x_1+x_2$</p><p>  对应这里：$c^T = [2,1]$，因为为转置矩阵，所以$c=[2;1]$</p><p>  $x=[x_1;x_2]$</p></li><li><p>$A$、$Aeq$为适当维数的矩阵</p><p>  $A$为不等式约束。例如上式：$A=[2,1; 1,1; 0,1]$</p><p>  $Aeq$为等式约束。上式没有。</p></li><li><p>$b$、$beq$为适当维数的列向量</p><p>  $b$是和$A$配对的不等式约束。例如上式：$b=[10; 8; 7]$</p><p>  $beq$为和$Aeq$配对的等式约束。上式没有。</p></li><li><p>$lb$、$ub$为n维列向量</p><p>  用来约束$x$的范围。例如上式：$lb=[0;0]$、$ub=[8;7]$</p></li></ul><p>一般线性规划问题的<strong>数学</strong>标准型为：</p><script type="math/tex; mode=display">\max\limits_{x} \quad \sum\limits_{j=1}^n c_jx_j \\s.t.\begin{cases}\sum\limits_{j=1}^n a_{ij}x_j = b_i\quad i=1,2,\cdots,m\\x_j \geqslant 0 \quad j = 1,2,\cdots, n\end{cases}</script><h3 id="1-3-1-可行解"><a href="#1-3-1-可行解" class="headerlink" title="1.3.1 可行解"></a>1.3.1 可行解</h3><p>满足上式条件的解$x=[x_1,\cdots,x_n]^T$，称维线性规划问题的可行解，而使目标函数$z$达到最大值或最小值的解叫作<strong>最优解</strong>。z的最大值或者最小值为<strong>最优值</strong></p><h3 id="1-3-2-可行域"><a href="#1-3-2-可行域" class="headerlink" title="1.3.2 可行域"></a>1.3.2 可行域</h3><p>所以可行解构成的集合称为问题的可行域，记为$R$。</p><h2 id="1-4-线性规划的Matlab标准形式及软件求解"><a href="#1-4-线性规划的Matlab标准形式及软件求解" class="headerlink" title="1.4 线性规划的Matlab标准形式及软件求解"></a>1.4 线性规划的Matlab标准形式及软件求解</h2><p>线性规划的目标函数可以是求最大值，也可以是求最小值,约束条件的不等号可以是小于号也可以是大于号。为了避免这种形式多样性带来的不便，Matlab中规定线性规划的标准形式为：</p><script type="math/tex; mode=display">\min\limits_{x} \qquad fval=f^Tx \\s.t.\begin{cases}Ax \leqslant b \\Aeq \cdot x = beq \\lb \leqslant x \leqslant ub\end{cases}</script><p>其中 $f,x,b,beq,lb,ub$都是列向量（<a href="#1.1.2 线性规划问题的解的概念">上面</a>解释过了）,$f$称为价值向量，$b$称为资源向量，$A,Aeq$为矩阵。</p><h3 id="1-4-1-Matlab-的求解命令："><a href="#1-4-1-Matlab-的求解命令：" class="headerlink" title="1.4.1 Matlab 的求解命令："></a>1.4.1 Matlab 的求解命令：</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[x, fval] = linprog(f, A, b)</span><br><span class="line">[x, fval] = linprog(f, A, b, Aeq, beq)</span><br><span class="line">[x, fval] = linprog(f, A, b, Aeq, beq, lb, ub)</span><br><span class="line">[x, fval] = linprog(f, A, b, Aeq, beq, lb, ub, x0, OPTIONS)</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li><p>返回值：</p><ul><li><code>x</code>：决策向量的取值，即最优解</li><li><code>fval</code>：目标函数的最优解</li></ul></li><li><p>参数：</p><ul><li><code>f</code>：价值向量</li><li><code>A</code>和<code>b</code>：不等式约束</li><li><code>Aeq</code>和<code>beq</code>：等式约束</li><li><code>lb</code>和<code>ub</code>：列向量，x的取值范围</li><li><code>x0</code>：x的初始值</li><li><code>OPTIONS</code>：指定参数进行最小化<ul><li><code>Display</code>：若为 <code>off</code> 则不显示输出；若选择 <code>Iter</code> （iteration的缩写）即显示每一步的迭代过程；若选择 <code>final</code> 即只显示最终结果。</li><li><code>MaxFunEvals</code>：函数评价的最大允许次数</li><li><code>Maxiter</code>：最大的允许迭代次数</li><li><code>Tolx</code>：x处的终止容限</li></ul></li></ul></li><li><p>其他返回值：</p><p>  <code>[x, fval, exitflag, output, lambda]</code></p><ul><li><code>exitflag</code>：收敛数</li><li><code>optput</code>：迭代次数</li><li><code>lambda</code>：x处的拉格朗日乘子<ul><li><code>lambda.lower</code>：lambda的下界</li><li><code>lambda.upper</code>：lambda的上界</li><li><code>lambda.ineqlin</code>：lambda的线性不等式</li><li><code>lambda.eqlin</code>：lambda的线性等式</li></ul></li></ul></li></ul><h2 id="1-5-练习"><a href="#1-5-练习" class="headerlink" title="1.5 练习"></a>1.5 练习</h2><h3 id="1-5-1-例1"><a href="#1-5-1-例1" class="headerlink" title="1.5.1 例1"></a>1.5.1 例1</h3><script type="math/tex; mode=display">\max\limits_{x} \quad z=2x_1+3x_2-5x_3 \\s.t.\begin{cases}x_1+x_2+x_3 = 7 \\2x_1 - 5x_2+x_3 \geqslant 10 \\x_1 + 3x_2 + x_3 \leqslant 12 \\x_1,x_2,x_3 \geqslant 0\end{cases}</script><p>化为Matlab标准形式（注意是最小值，所以fval有负号）：</p><script type="math/tex; mode=display">\min\limits_{x}\quad fval=-2x_1 - 3x_2+5x_3 \\z = -fval\\s.t.\begin{cases}\begin{bmatrix}-2 & 5 & -1 \\1 & 3 & 1\end{bmatrix}\begin{bmatrix}x_1 \\x_2 \\x_3\end{bmatrix}\leqslant\begin{bmatrix}-10 \\12\end{bmatrix}, \\\begin{bmatrix}1 & 1 & 1\end{bmatrix}\begin{bmatrix}x_1 \\x_2 \\x_3\end{bmatrix} = 7, \\\begin{bmatrix}x_1 \\x_2 \\x_3\end{bmatrix}\geqslant\begin{bmatrix}0 \\0 \\0\end{bmatrix}\end{cases}</script><p>matlab代码：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">f = [<span class="number">-2</span>; <span class="number">-3</span>; <span class="number">5</span>];</span><br><span class="line">a = [<span class="number">-2</span>, <span class="number">5</span>, <span class="number">-1</span>; <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>];</span><br><span class="line">b = [<span class="number">-10</span>; <span class="number">12</span>];</span><br><span class="line">Aeq = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br><span class="line">beq = <span class="number">7</span>;</span><br><span class="line">lb = <span class="built_in">zeros</span>(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">[x, favl] = linprog(f, a, b, Aeq, beq, lb)</span><br><span class="line">x</span><br><span class="line">z = -favl <span class="comment">% 因为求最大值</span></span><br></pre></td></tr></table></figure><p>结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/%E7%BA%BF%E6%80%A7%E8%A7%84%E5%88%921.png" alt="image-20230111191230508" style="zoom:50%;" /></p><p>即：最优解为：$x_1=6.4286,x_2=0.5714,x_3=0$；最优值为：$z=14.5714$。</p><h3 id="1-5-2-例2"><a href="#1-5-2-例2" class="headerlink" title="1.5.2 例2"></a>1.5.2 例2</h3><script type="math/tex; mode=display">\min\limits_{x} \quad z = 2x_1+3x_2+x_3 \\s.t.\begin{cases}x_1 + 4x_2 + 2x_3 \geqslant 8 \\3x_1 + 2x_2 \geqslant 6 \\x_1, x_2, x_3 \geqslant 0\end{cases}</script><p>化为Matlab标准形式：</p><script type="math/tex; mode=display">\min\limits_{x} \quad z = fval = 2x_1 + 3x_2 + x_3 \\s.t.\begin{cases}\begin{bmatrix}-1 & -4 & -2 \\-3 & -2 & 0\end{bmatrix}\begin{bmatrix}x_1 \\x_2 \\x_3\end{bmatrix}\leqslant\begin{bmatrix}-8 \\-6\end{bmatrix} \\\begin{bmatrix}x_1 \\x_2 \\x_3\end{bmatrix}\geqslant 0\end{cases}</script><p>matlab代码：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>];</span><br><span class="line">A = [<span class="number">-1</span>,<span class="number">-4</span>,<span class="number">-2</span>;<span class="number">-3</span>,<span class="number">-2</span>,<span class="number">0</span>]</span><br><span class="line">b = [<span class="number">-8</span>;<span class="number">-6</span>]</span><br><span class="line">[x, fval] = linprog(f, A, b, [], [], <span class="built_in">zeros</span>(<span class="number">3</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20230111195651964.png" alt="image-20230111195651964" style="zoom:50%;" /></p><p>即最优解为：$x_1=2.0000,x_2=0,x_3=3.0000$；最优值为：$z=7$。</p><h2 id="1-6-可转化为线性规划的问题"><a href="#1-6-可转化为线性规划的问题" class="headerlink" title="1.6 可转化为线性规划的问题"></a>1.6 可转化为线性规划的问题</h2><p>例如：规划问题为：</p><script type="math/tex; mode=display">\min\limits_{x}\quad \left| x_1 \right| + \left| x_2 \right| + \cdots + \left| x_n \right| \\s.t. \qquad Ax \leqslant b</script><p>其中：$x=[x_1, \cdots,x_n] ^ T$，$A$和$b$为相应维数的矩阵和向量。</p><p>​        要把上面的问题编程线性规划问题，要考虑到：</p><script type="math/tex; mode=display">\forall x_i，\exists u_i,v_i \gt 0 \\满足 \qquad x_i=u_i-v_i，\left| x_i \right|=u_i+v_i\qquad</script><p>所以，只需要取 $u_i=\frac{x_i+\left|x_i\right|}{2}$ , $v_i=\frac{\left| x_i \right| - x_i}{2}$ ,就可以满足上面的条件。</p><p>​        这样：记$u=[u_1,\cdots,u_n]^T,v=[v_1,\cdots,v_n]^T$，从而我们可以把上面的问题变成：</p><script type="math/tex; mode=display">\min\limits_{u,v}\quad \sum\limits_{i=1}^{n} (u_i+v_i) \\s.t.\begin{cases}u, v \geqslant 0 \\A(u-v) \leqslant b\end{cases}</script><h1 id="2-实际案例"><a href="#2-实际案例" class="headerlink" title="2 实际案例"></a>2 实际案例</h1><h2 id="2-1-投资的收益和风险"><a href="#2-1-投资的收益和风险" class="headerlink" title="2.1 投资的收益和风险"></a>2.1 投资的收益和风险</h2><h3 id="2-1-1-问题"><a href="#2-1-1-问题" class="headerlink" title="2.1.1 问题"></a>2.1.1 问题</h3><p>​        市场上有$n$种资产$s_i(i=1,2,\cdots,n)$可以选择，现用数额为$M$的相当大的资金作一个时期的投资。这$n$种资产在这一时期内购买$s_i$的平均收益率为$r_i$，风险损失率为$q_i$，投资越分散，总的风险越少，总体风险可用投资的$s_i$中最大的一个风险来度量。</p><p>​        购买$s_i$时要付交易费，费率为$p_i$，当购买额不超过给定值$u_i$时，交易费按购买$u_i$计算。另外，假定同期银行存款利率是$r_0$，既无交易费又无风险（$r_0$=5%)。</p><p>​        已知$n=4$时相关数据如表：</p><div class="table-container"><table><thead><tr><th style="text-align:center">$s_i$</th><th style="text-align:center">$r_i$(%)</th><th style="text-align:center">$q_i$(%)</th><th style="text-align:center">$p_i$(%)</th><th style="text-align:center">$u_i$(元)</th></tr></thead><tbody><tr><td style="text-align:center">$s_1$</td><td style="text-align:center">28</td><td style="text-align:center">2.5</td><td style="text-align:center">1</td><td style="text-align:center">103</td></tr><tr><td style="text-align:center">$s_2$</td><td style="text-align:center">21</td><td style="text-align:center">1.5</td><td style="text-align:center">2</td><td style="text-align:center">198</td></tr><tr><td style="text-align:center">$s_3$</td><td style="text-align:center">23</td><td style="text-align:center">5.5</td><td style="text-align:center">4.5</td><td style="text-align:center">52</td></tr><tr><td style="text-align:center">$s_4$</td><td style="text-align:center">25</td><td style="text-align:center">2.6</td><td style="text-align:center">6.5</td><td style="text-align:center">40</td></tr></tbody></table></div><p>​        试给该公式设计一种投资组合方案，即用给定资金$M$，有选择第购买若干种资产或存银行生息，使净收益尽可能大，使总体风险尽可能小。</p><h3 id="2-1-2-解答"><a href="#2-1-2-解答" class="headerlink" title="2.1.2 解答"></a>2.1.2 解答</h3><h4 id="2-1-2-1-符号规定："><a href="#2-1-2-1-符号规定：" class="headerlink" title="2.1.2.1 符号规定："></a>2.1.2.1 符号规定：</h4><ul><li>$s_i$表示第$i$种投资项目，如股票，债券等，$i=0,1,\cdots,n$，其中$s_0$表示存入银行；</li><li>$r_i,p_i,q_i$分别表示$s_i$的平均收益率，交易费率，风险损失率，$i=0,\cdots,n$，其中$p_0=0$，$q_0=0$；</li><li>$u_i$表示$s_i$的交易定额，$i=1,\cdots,n$；</li><li>$x_i$表示投资项目$s_i$的资金，$i=0,1,\cdots,n$；</li><li>$a$表示投资风险度；</li><li>$Q$表示总体收益；</li></ul><h4 id="2-1-2-2-基本假设："><a href="#2-1-2-2-基本假设：" class="headerlink" title="2.1.2.2 基本假设："></a>2.1.2.2 基本假设：</h4><ul><li>投资数额$M$相当大，为了便于计算，假设$M=1$；</li><li>投资越分散，总的风险越小；</li><li>总体风险用投资项目$s_i$中最大的一个风险来度量；</li><li>$n+1$种资产$s_i$之间是相互独立的；</li><li>在投资的这一时期内，$r_i,p_i,q_i$为定值，不受意外因素影响；</li><li>净收益和总体风险只受$r_i,p_i,q_i$影响，不受其它因素干扰。</li></ul><h4 id="2-1-2-3-模型的分析与建立"><a href="#2-1-2-3-模型的分析与建立" class="headerlink" title="2.1.2.3 模型的分析与建立"></a>2.1.2.3 模型的分析与建立</h4><ol><li><p>总体风险用所投资的$s_i$中最大的一个风险类衡量，即</p><script type="math/tex; mode=display"> max\,\{q_ix_i|i=1,2,\cdots,n\}.</script></li><li><p>购买$s_i(i=1,\cdots,n)$所付交易费是一个分段函数，即</p><script type="math/tex; mode=display"> 交易费= \begin{cases} p_ix_i, & x_i \gt u_i, \\ p_ix_i, & x_i \leqslant u_i. \end{cases}</script><p> 而题目所给的定值$u_i$（单位：元）相对总投资$M$很少($u_i\ll M$)，$p_iu_i$更小，这样购买$s_i$的净收益可以简化为$(r_i - p_i)x_i$。</p></li><li><p>总净收益为银行利息加$s_i$的净收益</p><script type="math/tex; mode=display"> Q = r_0x_0 + \sum\limits_{i=1}^n (r_i - p_i)x_i</script><p> 其中因为银行没有交易费率，所以令$p_0 = 0$，则：</p><script type="math/tex; mode=display"> Q = \sum\limits_{i=0}^n (r_i-p_i)x_i</script></li><li><p>要使净收益尽可能大，总体风险尽可能小，这是一个多目标规划模型。</p></li></ol><h5 id="2-1-2-3-1-归纳模型"><a href="#2-1-2-3-1-归纳模型" class="headerlink" title="2.1.2.3.1 归纳模型"></a>2.1.2.3.1 归纳模型</h5><p>目标函数为：</p><script type="math/tex; mode=display">\begin{cases}\max\limits_{x}\quad \sum\limits_{i=0}^n (r_i - p_i)x_i \\\min\limits_{x}\quad \max\limits_{i}\,\{q_ix_i\}\end{cases}</script><p>约束条件为：</p><script type="math/tex; mode=display">\begin{cases}\sum\limits_{i=0}^n (1+p_i)x_i = M \\x_i \geqslant 0, i = 0, 1, \cdots,n\end{cases}</script><p>这是一个多目标规划模型。</p><h5 id="2-1-2-3-2-多目标规划模型转化为一个目标的线性规划"><a href="#2-1-2-3-2-多目标规划模型转化为一个目标的线性规划" class="headerlink" title="2.1.2.3.2 多目标规划模型转化为一个目标的线性规划"></a>2.1.2.3.2 多目标规划模型转化为一个目标的线性规划</h5><ol><li><p>在实际投资中，投资者承受风险的程度不一样，若给定风险一个界限$a$，使最大的一个风险$\frac{q_ix_i}{M} \leqslant a$（$q_ix_i$为$s_i$的风险费，这里表示风险损失费占比总金额小于一个阈值），可找到相应的投资方案。这样把多目标规划变成一个目标的线性规划。</p><p> <strong>模型一</strong>        固定风险水平，优化收益</p><p> <strong>数学模型</strong></p><script type="math/tex; mode=display"> \max\limits_{x}\quad \sum\limits_{i=0}^n (r_i - p_i)x_i \\ \begin{cases} \frac{q_ix_i}{M} \leqslant a \\ \sum\limits_{i=0}^n (1+p_i)x_i = M \\ x_i \geqslant 0, i = 0, 1, \cdots,n \end{cases}</script><p> <strong>化为Matlab标准形式（$M=1$）</strong>：</p><script type="math/tex; mode=display"> \min\limits_{x}\quad fval = -0.05x_0-0.27x_1-0.19x_2-0.185x_3-0.185x_4 \\ Q = z = -fval \\ \qquad s.t. \begin{cases} 0.025x_1 \leqslant a \\ 0.015x_2 \leqslant a \\ 0.055x_3 \leqslant a \\ 0.026x_4 \leqslant a \\ x_0+1.01x_1+1.02x_2+1.045x_3+1.065x_4 = 1 \\ x_i \geqslant 0, (i=0,1,\cdots,4) \end{cases}</script><p> <strong>Matlab核心代码：</strong></p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f = [<span class="number">-0.05</span>;<span class="number">-0.27</span>;<span class="number">-0.1</span>;,<span class="number">-0.185</span>;<span class="number">-0.185</span>];</span><br><span class="line">A = [<span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">1</span>),<span class="built_in">diag</span>([<span class="number">0.025</span>,<span class="number">0.015</span>,<span class="number">0.055</span>,<span class="number">0.026</span>])];</span><br><span class="line">b = a*<span class="built_in">ones</span>(<span class="number">4</span>,<span class="number">1</span>); <span class="comment">% 但是这里的a没有赋值，老哥利用循环遍历，最终绘制曲线</span></span><br><span class="line">Aeq = [<span class="number">1</span>, <span class="number">1.01</span>, <span class="number">1.02</span>, <span class="number">1.045</span>, <span class="number">1.065</span>];</span><br><span class="line">beq = <span class="number">1</span>;</span><br><span class="line">lb = <span class="built_in">zeros</span>(<span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">[x, fval] = linprog(f, A, b, Aeq, beq, lb);</span><br></pre></td></tr></table></figure><p> 因为$a$没有赋值，令$a = 0$，步长$\Delta a = 0.001$进行循环搜索并绘图。</p><p> <strong>matlab绘制曲线：</strong></p> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line"><span class="keyword">while</span> a &lt; <span class="number">0.05</span></span><br><span class="line">f = [<span class="number">-0.05</span>;<span class="number">-0.27</span>;<span class="number">-0.19</span>;<span class="number">-0.185</span>;<span class="number">-0.185</span>];</span><br><span class="line">A = [<span class="built_in">zeros</span>(<span class="number">4</span>,<span class="number">1</span>),<span class="built_in">diag</span>([<span class="number">0.025</span>,<span class="number">0.015</span>,<span class="number">0.055</span>,<span class="number">0.026</span>])];</span><br><span class="line">b = a*<span class="built_in">ones</span>(<span class="number">4</span>,<span class="number">1</span>);</span><br><span class="line">Aeq = [<span class="number">1</span>, <span class="number">1.01</span>, <span class="number">1.02</span>, <span class="number">1.045</span>, <span class="number">1.065</span>];</span><br><span class="line">beq = <span class="number">1</span>;</span><br><span class="line">lb = <span class="built_in">zeros</span>(<span class="number">5</span>,<span class="number">1</span>)</span><br><span class="line">[x, fval] = linprog(f, A, b, Aeq, beq, lb);</span><br><span class="line">Q = -fval;</span><br><span class="line"><span class="built_in">plot</span>(a, Q, <span class="string">&#x27;*k&#x27;</span>);</span><br><span class="line">a = a + <span class="number">0.001</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">xlabel(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;Q&#x27;</span>);</span><br></pre></td></tr></table></figure><p> 结果：</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/image-20230111213013690.png" alt="image-20230111213013690" style="zoom:50%;" /></p></li><li><p>在实际投资中，可以固定一个盈利水平，例如盈利$\sum\limits_{i=0}^n (r_i - p_i)x_i \geqslant k$总盈利大于阈值$k$，之后就专注于降低风险度。可找到相应的投资方案。</p><p> <strong>模型二</strong>        固定盈利水平，极小化风险</p><p> <strong>数学模型</strong></p><script type="math/tex; mode=display"> \min\limits_{x}\quad \max\limits_{i}\,\{q_ix_i\} \\ s.t. \begin{cases} \sum\limits_{i=0}^n (r_i - p_i)x_i \geqslant k \\ \sum\limits_{i=0}^n (1+p_i)x_i = M \\ x_i \geqslant 0, i = 0, 1, \cdots,n \end{cases}</script></li></ol><ol><li><p>投资者在权衡资产风险和预期收益两方面时，希望选择一个令自己满意的投资组合。此时对风险、收益率分别赋予权重$s(0&lt;s\leqslant 1)$ 和 $(1-s)$，$s$称为投资偏好系数。</p><p> <strong>模型三</strong>        利用投资偏好系数平衡风险和收益率</p><p> <strong>数学模型</strong></p><script type="math/tex; mode=display"> \min\limits_{x}\quad s\cdot \max\limits_{i}\,\{q_ix_i\}-(1-s)\sum\limits_{i=0}^n (r_i-p_i)x_i\\ s.t. \begin{cases} \sum\limits_{i=0}^n (1+p_i)x_i = M,\\ x_i \geqslant 0, i = 0, 1, 2, \cdots,n \end{cases}</script></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数学建模 </category>
          
          <category> 优化类 </category>
          
          <category> 规划类 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 优化类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql安装配置</title>
      <link href="/posts/4261103898.html"/>
      <url>/posts/4261103898.html</url>
      
        <content type="html"><![CDATA[<h1 id="下载MySQL"><a href="#下载MySQL" class="headerlink" title="下载MySQL"></a>下载MySQL</h1><p>到<a href="https://www.mysql.com">官网下载</a></p><p>然后在上面点击Downloads。</p><p>找到下面的社区链接：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.01.38.png" alt="截屏2023-01-19 18.01.38" style="zoom:50%;" /></p><p>点进去</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.02.35.png" alt="截屏2023-01-19 18.02.35" style="zoom:50%;" /></p><p>打开后的界面：</p><p>也可以筛选一下系统 </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.18.40.png" alt="截屏2023-01-19 18.18.40" style="zoom: 33%;" /></p><p>可以选择DMG格式的安装包（第一个）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.23.11.png" alt="截屏2023-01-19 18.23.11" style="zoom:33%;" /></p><p>点击Download，跳转页面后点击 下面的一行字即可，不用登录(点击No thanks， just start mu download.)</p><h1 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h1><p>安装好后打开安装包。里面是一个pkg文件，点击打开。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.28.58.png" alt="截屏2023-01-19 18.28.58"></p><p>解下来点击继续即可，使用默认位置。</p><p>configure选择第二个，不使用加强密码：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.30.24.png" alt="截屏2023-01-19 18.30.24"></p><p>点击Next设置至少8位数的密码。然后Finish。</p><p>在系统便好设置中可以看到多了MySQL的服务：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2018.32.56.png" alt="截屏2023-01-19 18.32.56"></p><h1 id="登录配置MySQL"><a href="#登录配置MySQL" class="headerlink" title="登录配置MySQL"></a>登录配置MySQL</h1><p>终端输入：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><p>如过说找不到命令就是没有配置环境。配置环境：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_HOME=/usr/local/mysql <span class="comment"># mysql的位置可在设置里的mysql服务中看到</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$MTSQL_HOME</span>/bin</span><br></pre></td></tr></table></figure><hr><p>验证配置成功：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin --version</span><br></pre></td></tr></table></figure><p>看是否正常显示版本。</p><hr><p>登录mysql：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><p>可以输入密码，登录就成功了。</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
          <category> MySQL </category>
          
          <category> 编程环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> Mac </tag>
            
            <tag> 环境 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python环境</title>
      <link href="/posts/1605124548.html"/>
      <url>/posts/1605124548.html</url>
      
        <content type="html"><![CDATA[<h1 id="下载python"><a href="#下载python" class="headerlink" title="下载python"></a>下载python</h1><p>在<a href="https://www.python.org">python官网</a>上进行下载。</p><p>进入页面后选择Downloads，在下拉框中选择macOS。</p><p>之后选择一个稳定版本下载即可。我选择的是3.10.3。最好不要太新，否则不稳定；也不要太旧。</p><p>下载好后我放到了<code>/opt/devTools</code>目录下，<code>devTools</code>是我的自建目录。</p><h1 id="安装python"><a href="#安装python" class="headerlink" title="安装python"></a>安装python</h1><p>直接双击下载好的pkg文件即可。</p><p>之后就一直继续即可，该同意的同意，该输密码的输入密码。</p><p>安装好后终端输入python3命令，如过有效就行了。输入<code>python3</code>后就可以输入代码了，例如<code>print(&quot;Hello World!&quot;)</code>输入<code>exit()</code>退出。</p><p>但是我的python3之后的版本好像有问题，我输入<code>ls /Library/Frameworks/Python.framework/Versions</code>命令查看后又是对的。我也很迷惑。于是上网搜索了结果。可以给python3设置别名和命令目录。如下：</p><p>解下来就是查找python的安装位置。输入命令：<code>which python3</code>即可看到。记住它，去配置环境变量。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile <span class="comment"># 打开vim</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在vim中编辑</span></span><br><span class="line"><span class="built_in">alias</span> python=<span class="string">&quot;/usr/local/bin/python3&quot;</span> <span class="comment">#which查出来的路径</span></span><br></pre></td></tr></table></figure><p>保存退出。</p><p>然后刷新资源。<strong>注意</strong>：我是之前在<code>~/.zshrc</code>下配置了：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><p>这样就相当于给<code>~/.zshrc</code>配置了。我刷新资源：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>这样输入python即可使用了，不需要再输入python3了，版本也正确了。</p><hr><p>如果直接使用pip3，无法找到，这是因为没有配置pip3，解下来配置；</p><p>打开配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> pip=<span class="string">&quot;/usr/local/bin&quot;</span> <span class="comment"># 它是和python3在同级目录的</span></span><br></pre></td></tr></table></figure><p>刷新资源：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>再输入pip就OK了</p><p>更新pip：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade pip</span><br></pre></td></tr></table></figure><hr><h2 id="配置国内镜像源："><a href="#配置国内镜像源：" class="headerlink" title="配置国内镜像源："></a>配置国内镜像源：</h2><p>清华大学pypi镜像站(<a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">https://mirrors.tuna.tsinghua.edu.cn/help/pypi/</a>)<br>清华大学：<a href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a><br>阿里云：<a href="http://mirrors.aliyun.com/pypi/simple/">http://mirrors.aliyun.com/pypi/simple/</a><br>豆瓣：<a href="http://pypi.douban.com/simple/">http://pypi.douban.com/simple/</a></p><p>临时使用：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install -i http://pypi.douban.com/simple/ numpy</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果上一个提示不受信任，就使用这个，此参数“--trusted-host”表示信任</span></span><br><span class="line">pip install -i http://pypi.douban.com/simple/ --trusted-host pypi.douban.com  </span><br></pre></td></tr></table></figure><p>永久使用：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.pip</span><br><span class="line"><span class="built_in">cd</span> ~/.pip</span><br><span class="line"><span class="built_in">touch</span> pip.conf</span><br><span class="line">vim ~/.pip/pip.conf</span><br></pre></td></tr></table></figure><p>写下内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = http://pypi.douban.com/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host = http://pypi.douban.com</span><br></pre></td></tr></table></figure><h1 id="Pycharm使用解释器"><a href="#Pycharm使用解释器" class="headerlink" title="Pycharm使用解释器"></a>Pycharm使用解释器</h1><p>路径就是<code>which python3</code>之后出现的路径了。</p><p>选择现有解释器，最好不要新建，新建之后pycharm就不能直接使用外部终端pip的模块了。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 编程环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> 环境 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac文件系统</title>
      <link href="/posts/595890772.html"/>
      <url>/posts/595890772.html</url>
      
        <content type="html"><![CDATA[<h1 id="如何显示隐藏文件"><a href="#如何显示隐藏文件" class="headerlink" title="如何显示隐藏文件"></a>如何显示隐藏文件</h1><p>快捷键：<code>command+shift+.</code></p><h1 id="目录类型"><a href="#目录类型" class="headerlink" title="目录类型"></a>目录类型</h1><p>这里只介绍Linux和Mac中都有的主要目录。</p><h2 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h2><p>包含一些二进制文件的目录，即可以运行的一些应用程序。一些基础的命令就存储在这里，例如：ls，rm等。</p><h2 id="etc"><a href="#etc" class="headerlink" title="etc"></a>etc</h2><p>存放配置内容的地方。一般的系统配置文件就存储在这里。例如：<code>/etc/hosts</code>配置端口等，用户，用户组，密码都是在这里配置，例如；<code>/etc/sudoers</code>。</p><h2 id="home"><a href="#home" class="headerlink" title="home"></a>home</h2><p>主要是用户个人的目录信息，Mac中没存东西</p><h2 id="opt"><a href="#opt" class="headerlink" title="opt"></a>opt</h2><p>这个目录通常是编译软件（从源代码构建）的地方。应用程序最终会出现在<code>/opt/bin</code>目录下，库会在<code>/opt/lib</code>下</p><h2 id="sbin"><a href="#sbin" class="headerlink" title="sbin"></a>sbin</h2><p>与<code>/bin</code>类似，但它包含的应用程序是超级用户才能使用的，需要在这些命令前加上<code>sudo</code>。</p><h2 id="usr"><a href="#usr" class="headerlink" title="usr"></a>usr</h2><p><code>/usr</code> 目录是在 UNIX 早期用户的主目录所处的地方。然而，正如我们上面看到的，现在 <code>/home</code> 是用户保存他们的东西的地方。如今，<code>/usr</code> 包含了大量目录，而这些目录又包含了应用程序、库、文档、壁纸、图标和许多其他需要应用程序和服务共享的内容。</p><p>你还可以在 <code>/usr</code> 目录下找到 <code>bin</code>，<code>sbin</code>，<code>lib</code> 目录，它们与挂载到根目录下的那些有什么区别呢？现在的区别不是很大。在早期，<code>/bin</code> 目录（挂载在根目录下的）只会包含一些基本的命令，例如 <code>ls</code>、<code>mv</code> 和 <code>rm</code> ；这是一些在安装系统的时候就会预装的一些命令，用于维护系统的一个基本的命令。 而 <code>/usr/bin</code> 目录则包含了用户自己安装和用于工作的软件，例如文字处理器，浏览器和一些其他的软件。</p><p>但是许多现代的 Linux 发行版只是把所有的东西都放到 <code>/usr/bin</code> 中，并让 <code>/bin</code> 指向 <code>/usr/bin</code>，以防彻底删除它会破坏某些东西。因此，Debian、Ubuntu 和 Mint 仍然保持 <code>/bin</code> 和 <code>/usr/bin</code> （和 <code>/sbin</code> 和 <code>/usr/sbin</code> ）分离；其他的，比如 Arch 和它衍生版，只是有一个“真实”存储二进制程序的目录，<code>/usr/bin</code>，其余的任何 <code>bin</code> 目录是指向 <code>/usr/</code>bin` 的“假”目录。</p><h2 id="tmp"><a href="#tmp" class="headerlink" title="tmp"></a>tmp</h2><p>存放临时文件，通常由正在运行的应用程序放置。文件和目录通常包含应用程序的现在不需要但以后可能需要的数据。</p><h1 id="下载的软件该放在什么地方"><a href="#下载的软件该放在什么地方" class="headerlink" title="下载的软件该放在什么地方"></a>下载的软件该放在什么地方</h1><p>通常是两个地方：<code>/usr/local</code>、<code>/opt</code></p><p><code>/usr</code> 系统级的目录，可以理解为 <code>C:/Windows/</code> ， <code>/usr/lib</code> 可理解为 <code>C:/Windows/System32</code> 。</p><p><code>/usr/local</code> 用户级的程序目录，可以理解为 <code>C:/Progrem Files/</code> 。用户自己编译的软件默认会安装到这个目录下。</p><p><code>/opt</code> 用户级的程序目录，可以理解为 <code>D:/Software</code> ， <code>opt</code> 有可选的意思，这里可以用于放置第三方大型软件（或游戏），当你不需要时，直接 <code>rm -rf</code> 掉即可。</p><p>在硬盘容量不够时，也可将 <code>/opt</code> 单独挂载到其他磁盘上使用。</p><p>选择原则：</p><p>如果你认为是系统提供给你可选的程序，放在<code>/opt</code>里<br>如果你认为这是你个人行为，自主安装的，放在<code>/usr/local</code>里<br>如果你觉得对你来说是必不可少的运行库，放在<code>/usr/lib</code>里</p><h4 id="源码放哪里？"><a href="#源码放哪里？" class="headerlink" title="源码放哪里？"></a>源码放哪里？</h4><p><code>/usr/src</code> 系统级的源码目录。</p><p><code>/usr/local/src</code> 用户级的源码目录。</p><ul><li><p><code>opt</code></p><p>  这里主要存放那些可选的程序。你想尝试最新的firefox测试版吗?那就装到/opt目录下吧，这样，当你尝试完，想删掉firefox的时候，你就可 以直接删除它，而不影响系统其他任何设置。安装到/opt目录下的程序，它所有的数据、库文件等等都是放在同个目录下面。</p><p>  举个例子：刚才装的测试版firefox，就可以装到/opt/firefox_beta目录下，/opt/firefox_beta目录下面就包含了运行firefox所需要的所有文件、库、数据等等。要删除firefox的时候，你只需删除/opt/firefox_beta目录即可，非常简单。</p></li><li><p><code>usr/local</code></p><p>  这里主要存放那些手动安装的软件，即不是通过“新立得”或apt-get安装的软件。它和/usr目录具有相类似的目录结构。让软件包管理器来管理/usr目录，而把自定义的脚本(scripts)放到/usr/local目录下面，我想这应该是个不错的主意。</p></li></ul><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>jdk、maven、python等安装到/usr/local目录下。</p><p>大型应用可以放在/opt下。</p><p>但是我选择在/opt下新建文件夹devTools，用来存放jdk等。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UTM安装配置Ubuntu</title>
      <link href="/posts/694347442.html"/>
      <url>/posts/694347442.html</url>
      
        <content type="html"><![CDATA[<h1 id="下载UTM虚拟机"><a href="#下载UTM虚拟机" class="headerlink" title="下载UTM虚拟机"></a>下载UTM虚拟机</h1><p>其他虚拟机也可以，类似的。主要是这个免费，其他的破解起来太麻烦了，具体什么性能差异我也不太了解，我也不太感兴趣，总不至于一个Hello World级的程序多运行一分钟吧。🤔</p><p>下载地址：<a href="https://mac.getutm.app">https://mac.getutm.app</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2008.46.29.png" alt="截屏2023-01-18 08.46.29"></p><p>直接点击Download即可。</p><p>点击Mac App Store会跳转到苹果应用商店，收费¥50。</p><h1 id="下载Ubuntu"><a href="#下载Ubuntu" class="headerlink" title="下载Ubuntu"></a>下载Ubuntu</h1><p>M1是arm版本，直接访问：<a href="https://ubuntu.com/download/server/arm">https://ubuntu.com/download/server/arm</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2008.49.35.png" alt="截屏2023-01-18 08.49.35"></p><p>点击Download Ubuntu 22.04.1 LTS（绿色按钮）就行了。</p><h1 id="安装qemu"><a href="#安装qemu" class="headerlink" title="安装qemu"></a>安装qemu</h1><p>直接利用Homebrew安装即可：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install qemu</span><br></pre></td></tr></table></figure><h1 id="创建Ubuntu虚拟机"><a href="#创建Ubuntu虚拟机" class="headerlink" title="创建Ubuntu虚拟机"></a>创建Ubuntu虚拟机</h1><p>刚进入到的界面：</p><p>点击新建一个虚拟机。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2008.53.23.png" alt="截屏2023-01-18 08.53.23" style="zoom:50%;" /></p><p>选择虚拟化：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2008.56.37.png" alt="截屏2023-01-18 08.56.37" style="zoom:50%;" /></p><p>选择其他（选择Linux也可以，简单一点）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.07.48.png" alt="截屏2023-01-18 09.07.48" style="zoom:50%;" /></p><p>点击浏览选择下载的ubuntu镜像：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.10.23.png" alt="截屏2023-01-18 09.10.23" style="zoom:50%;" /></p><p>配置硬件信息，默认就好了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.11.54.png" alt="截屏2023-01-18 09.11.54" style="zoom:50%;" /></p><p>设置存储器的大小：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.17.57.png" alt="截屏2023-01-18 09.17.57" style="zoom:50%;" /></p><p>设置共享文件夹，这个可以一定程度上代替xftp、Filezilla，意思就是用一个文件夹来使得主机的虚拟机共享文件：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.23.32.png" alt="截屏2023-01-18 09.23.32" style="zoom:50%;" /></p><p>给虚拟机取个名字：</p><blockquote><p>我的命名规则是系统源类型+版本+第几台虚拟机。</p><p>因为后续有可能会使用centOS、Windows等其他源、或者其他Ubuntu版本、搭建集群会需要多台虚拟机。这样命名比较好区分。</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.25.29.png" alt="截屏2023-01-18 09.25.29" style="zoom:50%;" /></p><p>这样虚拟机本身就创建好了，只是内部的ubuntu还没有配置。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/npm/yongruizhang-blogimg@latest/UTM_Ubuntu.png" alt="截屏2023-01-18 09.29.33"></p><p>由于存储器占据空间比较大，可以移动到移动硬盘去，选择下面这个按钮：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.31.05.png" alt="截屏2023-01-18 09.31.05"></p><p>点击之后根据指示操作即可。</p><h1 id="安装配置Ubuntu"><a href="#安装配置Ubuntu" class="headerlink" title="安装配置Ubuntu"></a>安装配置Ubuntu</h1><p>点击运行虚拟机，直接回车即可，选择Try or Install Ubuntu Server：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.34.10.png" alt="截屏2023-01-18 09.34.10"></p><p>语言可以直接选英文，直接回车即可：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.35.08.png" alt="截屏2023-01-18 09.35.08"></p><p>之后基本都是直接选Done了，但是慢一点，仔细看。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.37.44.png" alt="截屏2023-01-18 09.37.44"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.38.48-4006024.png" alt="截屏2023-01-18 09.38.48"></p><p>如过要配置静态IP，下面就先不要直接选择Done，具体跳转<a href="#方法二-直接在安装Ubuntu时配置">静态IP配置</a>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.39.54.png" alt="截屏2023-01-18 09.39.54"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.41.13.png" alt="截屏2023-01-18 09.41.13"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.41.31.png" alt="截屏2023-01-18 09.41.31"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.42.29.png" alt="截屏2023-01-18 09.42.29"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.43.01.png" alt="截屏2023-01-18 09.43.01"></p><p>选择Continue：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.43.15.png" alt="截屏2023-01-18 09.43.15"></p><p>解下来输入基本信息，如过是自己学习的机子这个无所谓，可以乱输，密码也可以设置地简单些。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.44.40.png" alt="截屏2023-01-18 09.44.40"></p><p>设置好后选择Done。</p><p>我是直接Done，没有选择openSSH，可以根据需要自行选择：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.46.37.png" alt="截屏2023-01-18 09.46.37"></p><p>这里我都没选，直接Done，可根据需求选择：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.47.20.png" alt="截屏2023-01-18 09.47.20"></p><p>开始安装，等待</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.47.47.png" alt="截屏2023-01-18 09.47.47"></p><p>下面这样就是安装好了，选择Reboot NOW，现在重启：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2009.54.46.png" alt="截屏2023-01-18 09.54.46"></p><p>如过一直卡着黑屏，可以先在右上角的驱动中弹出驱动，然后点左上角三角形符号重启虚拟机。</p><p>这样就是可以登陆了，输入账户和密码：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.03.51.png" alt="截屏2023-01-18 10.03.51"></p><p>这样就好了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.04.38.png" alt="截屏2023-01-18 10.04.38"></p><p>就可以输入命令了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.05.35.png" alt="截屏2023-01-18 10.05.35"></p><h1 id="配置桌面"><a href="#配置桌面" class="headerlink" title="配置桌面"></a>配置桌面</h1><blockquote><p>上面的是服务器版的，对新手来说不好操作，安装桌面版。</p><p>但是总的来说在Linux环境中基本上也是需要锻炼使用终端的，这和服务器是差不多的，所以我认为没有必要配置。</p></blockquote><p>输入以下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ubuntu-desktop</span><br></pre></td></tr></table></figure><p>之后输入密码（因为使用了<code>sudo</code>）等待下载安装，大概有两个G，我等你十分钟左右。</p><p>之后输入完成重启。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><p>重启之后输入密码就可以进入桌面了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.47.19.png" alt="截屏2023-01-18 10.47.19"></p><p>注意，这样配置是没有浏览器的，需要去应用商店自行下载。</p><h1 id="设置中文"><a href="#设置中文" class="headerlink" title="设置中文"></a>设置中文</h1><blockquote><p>这之后都是选择操作了。</p></blockquote><p>右键，最下面的选项应该就是调出设置。在设置中选择Region &amp; Language：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.50.36.png" alt="截屏2023-01-18 10.50.36"></p><p>再选择Manage Installed Languages：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.51.20.png" alt="截屏2023-01-18 10.51.20"></p><p>选择Install/Remove Languages</p><p>找到简体中文，点击Apply进行安装：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2010.53.30.png" alt="截屏2023-01-18 10.53.30"></p><p>安装等待个两分钟左右。</p><p>安装好后重启虚拟机。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2011.18.20.png" alt="截屏2023-01-18 11.18.20"></p><p>重启后，虚拟机中的内容就显示为中文了。</p><h1 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h1><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><p>试一下网络是否配置成功，ping一下百度。我这里是直接成功的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2011.20.23.png" alt="截屏2023-01-18 11.20.23"></p><hr><h2 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h2><p>我这里默认是没有安装net-tools的，试试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p>是否可以看到IP地址，如果不可以，输入命令（安装网络工具包）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install net-tools</span><br></pre></td></tr></table></figure><p>这下再试试查看IP。</p><hr><h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><p>因为后续要搭建集群等，所以我会把防火墙关掉，可选择执行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure><hr><h2 id="root权限"><a href="#root权限" class="headerlink" title="root权限"></a>root权限</h2><p>为了方便，设置用户具有root权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sudoers</span><br></pre></td></tr></table></figure><p>进入配置，添加两行：</p><ol><li><p>在<code>root    ALL=(ALL:ALL) ALL</code>下面添加<code>zyr ALL=(ALL:ALL) ALL</code><strong>注意zyr是用户名，输入自己的。</strong></p></li><li><p>在<code>%sudo ALL=(ALL:ALL) ALL</code>下面输入<code>zyr ALL=(ALL:ALL) NOPASSWD:ALL</code></p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2012.05.23.png" alt="截屏2023-01-18 12.05.23"></p><p>输入完成后，按esc，然后输入<code>:wq</code>保存退出。</p><p>需要重启一下终端。这样操作后对于一些文件仍然没有管理权限，所以有时候使用cp，mv，mkdir命令时还是需要在前面加sudo，这是正常的，不是配置失败。</p><hr><h2 id="静态IP"><a href="#静态IP" class="headerlink" title="静态IP"></a>静态IP</h2><h3 id="方法一-修改配置文件"><a href="#方法一-修改配置文件" class="headerlink" title="方法一 修改配置文件"></a>方法一 修改配置文件</h3><p>查看I网卡名，IP，子网掩码，网关地址：</p><p>输入<code>ifconfig</code>，查看网卡名、IP和子网掩码：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2012.44.36.png" alt="截屏2023-01-18 12.44.36"></p><p>从图片中可以看出：</p><ul><li><p>网卡名为：<code>enp0s1</code>（第二排开头内容）</p></li><li><p>IP为：<code>192.168.64.2</code>（第三排，inet后面的内容）</p></li><li>子网掩码为：<code>255.255.255.0</code>（第三排，netmask后面的内容）</li></ul><p>输入<code>route -n</code>查看网关：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2013.01.34.png" alt="截屏2023-01-18 13.01.34"></p><p>从图片中可以看出：</p><ul><li>网关为：<code>192.168.64.1</code>（网关两个字下面）</li></ul><hr><p>修改配置文件：</p><p>先cd到<code>/etc/netplan</code>目录下。</p><p>可以<code>ls</code>看到文件只有一个，利用<code>cp</code>命令拷贝一份，方便后面恢复（<strong>注意，修改前最后先把原文件备份一份，出错还能还原，否则出错就只能重装了</strong>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> 00-installer-config.yaml 00-installer-config-before.yaml</span><br></pre></td></tr></table></figure><p>原本的内容为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is the network config written by &#x27;subiquity&#x27;</span></span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    enp0s1:</span><br><span class="line">      dhcp4: <span class="literal">true</span></span><br><span class="line">  version: 2</span><br></pre></td></tr></table></figure><p>修改为（<strong>注意需要提前看好自己的网卡、路由</strong>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">network:</span><br><span class="line"> ethernets:</span><br><span class="line">  ens33:                <span class="comment"># 网卡名称，提前查看</span></span><br><span class="line">   dhcp4: no</span><br><span class="line">   dhcp6: no</span><br><span class="line">   addresses:</span><br><span class="line">    - 192.168.64.103/24 <span class="comment"># 配置后的静态ip，192.168.64.xxx 其中只有xxx可以修改，前面的必须是你原本ip的前三位</span></span><br><span class="line">   routes:</span><br><span class="line">    - to: default</span><br><span class="line">      via: 192.168.64.1 <span class="comment"># 路由，提前查看</span></span><br><span class="line">   nameservers:</span><br><span class="line">    addresses:</span><br><span class="line">     - 114.114.114.114</span><br><span class="line">     - 8.8.8.8</span><br><span class="line"> version: 2</span><br></pre></td></tr></table></figure><p>这是yaml文件，注意缩进。</p><p>如果有问题可以试试下面这种方式（gateway4是Ubuntu20.04的配置）：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  ethernets:</span><br><span class="line">    enp0s1:   <span class="comment"># 网卡名称</span></span><br><span class="line">      addresses: </span><br><span class="line">      - 192.168.64.103/24  <span class="comment"># 静态ip</span></span><br><span class="line">      gateway4: 192.168.64.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: </span><br><span class="line">        - 8.8.8.8</span><br><span class="line">        - 114.114.114.114</span><br></pre></td></tr></table></figure></p><hr><p>然后应用配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure><h3 id="方法二-直接在安装Ubuntu时配置"><a href="#方法二-直接在安装Ubuntu时配置" class="headerlink" title="方法二 直接在安装Ubuntu时配置"></a>方法二 直接在安装Ubuntu时配置</h3><p>选择到enp0s1（其他电脑可能是ens33等），回车</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.43.42.png" alt="截屏2023-01-18 15.43.42"></p><p>回车之后选择IPV4：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.44.34.png" alt="截屏2023-01-18 15.44.34"></p><p>到下面的界面就直接再按一下回车：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.45.12.png" alt="截屏2023-01-18 15.45.12"></p><p>上一步按下回车后就可以选择IPv4的method</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.45.49.png" alt="截屏2023-01-18 15.45.49"></p><p>选择Manual，回车：</p><p>在接下来的页面输入信息</p><ul><li><p>Subnet：<code>网关的最后一个数减一/24</code>注意这后面不一定是24，也可能是26等，注意自行搜索</p><p>  我的网关是：<code>192.168.64.1</code>，所以我这里填的是：<code>192.168.64.0/24</code></p></li><li><p>Addresses：填写静态IP，就是之后固定的IP，这里我写的是<code>192.168.64.103</code>这里最好要让网段保持一致，前三个数最好和网关一致</p></li><li><p>Gateway：这个就是网关，我的是<code>192.168.64.1</code></p></li><li><p>Name servers：DNS解析路径，可以直接写<code>114.114.114.114,8.8.8.8</code>大家都一样，没有差异。</p></li><li><p>Search domains：我是空着的。</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.46.54.png" alt="截屏2023-01-18 15.46.54"></p><p>填写好后选择Save，就OK了。之后步骤继续看<a href="#安装配置Ubuntu">安装配置Ubuntu</a></p><p>最后安装好后检查一下：</p><p>我这里是直接使用的server端，没有使用桌面端，桌面端就是打开终端输入也行。</p><p>输入：</p><p>如过没有安装过net-tools就先安装：<code>sudo apt install net-tools</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看IP地址是否是静态了</span></span><br><span class="line">ifconfig</span><br><span class="line"><span class="comment"># 查看网关是否正确</span></span><br><span class="line">route -n</span><br><span class="line"><span class="comment"># 查看能否上网</span></span><br><span class="line">ping www.baidu.com</span><br><span class="line"><span class="comment"># 能否ping通主机,这里写自己的IP地址</span></span><br><span class="line">ping 192.168.10.103</span><br></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.55.14.png" alt="截屏2023-01-18 15.55.14"></p><p>ping的时候要0丢包才行。</p><p>之后可以试试主机ping一下服务器：</p><p>就是ping 后面跟着服务器配置静态IP时的地址：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2015.59.39.png" alt="截屏2023-01-18 15.59.39"></p><p>都能相互ping通就成功了。</p><blockquote><p>如过服务器可以ping通主机，但是主机无法ping通服务器，就需要关闭防火墙，看上面。</p></blockquote><h2 id="终端连接Ubuntu"><a href="#终端连接Ubuntu" class="headerlink" title="终端连接Ubuntu"></a>终端连接Ubuntu</h2><p>请参看：<a href="/posts/4192183953.html" title="终端连接Ubuntu">终端连接Ubuntu</a><br><!-- [终端连接Ubuntu](4192183953) --></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> Linux </tag>
            
            <tag> Java后端 </tag>
            
            <tag> Mac </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git笔记</title>
      <link href="/posts/1470079887.html"/>
      <url>/posts/1470079887.html</url>
      
        <content type="html"><![CDATA[<h1 id="Mac下git的安装配置"><a href="#Mac下git的安装配置" class="headerlink" title="Mac下git的安装配置"></a>Mac下git的安装配置</h1><p>安装：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install git</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;用户名&quot;</span></span><br><span class="line"></span><br><span class="line">git config --global user.email <span class="string">&quot;邮箱&quot;</span></span><br></pre></td></tr></table></figure><p> 环境变量可配可不配。如果是按照上面的方式安装的git就自动配好了。如果没配其实也无所谓的，可以直接打开。</p><h1 id="git基本理论"><a href="#git基本理论" class="headerlink" title="git基本理论"></a>git基本理论</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-21%2010.19.12.png" alt="截屏2023-01-21 10.19.12" style="zoom:50%;" /></p><ul><li>WorkSpace：工作区，就是平时存放项目代码的地方</li><li>Index/Stage：暂存区</li><li>Repository：仓库区，本地仓库，安全存放数据的位置，这里有提交的所有版本的数据</li><li>Remote：远程仓库，代码托管的服务器</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-21%2010.34.36.png" alt="截屏2023-01-21 10.34.36" style="zoom: 33%;" /></p><ul><li>Directory：使用Git管理的一个目录，也就是一个仓库，包含我们的工作空间和Git的管理空间。</li><li>WorkSpace：需要用哟Git进行版本控制的目录和文件，这些目录和文件组成了工作空间。</li><li>.git：存放Git进行本本控制的目录和文件，这些目录和文件组成了工作空间</li><li>Inde/Stage：暂存区，或者叫待提交更新区，在提交进入repo之前，我们可以把所有更新放在暂存区</li><li>Local Repo：本地仓库，一个存放在本地的版本库，HEAD会只是当前开发的分区</li><li>Stash：隐藏，是一个工作状态保存栈，用于保存/恢复WorkSpace中的临时状态</li></ul><h1 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h1><ol><li>在工作目录中添加，修改，写文件、代码——已修改（modified）</li><li>将需要进行版本管理的文件放入暂存区——已暂存（staged）</li><li>将暂存区中的文件提交到git仓库——已提交（commited）</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-21%2011.27.44.png" alt="截屏2023-01-21 11.27.44"></p><h1 id="Git项目搭建"><a href="#Git项目搭建" class="headerlink" title="Git项目搭建"></a>Git项目搭建</h1><h2 id="创建工作目录"><a href="#创建工作目录" class="headerlink" title="创建工作目录"></a>创建工作目录</h2><p>工作目录（Workspace）就是希望Git帮忙管理的文件夹，可以是项目的目录，也可以是一个空目录</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-21%2011.31.12.png" alt="截屏2023-01-21 11.31.12"></p><ul><li><p><code>git init</code></p><p>  初始化本地仓库，创建一个全新的仓库，在需要用GIt管理的项目的根目录执行</p><p>  执行之后可以看到，在项目目录里多出了一个.git目录，关于版本等多所有信息都在这个目录里面</p></li><li><p><code>git clone [url]</code></p><p>  克隆远程目录，相当于是将远程服务器上的仓库完全镜像一份至本地</p></li></ul><h2 id="文件状态"><a href="#文件状态" class="headerlink" title="文件状态"></a>文件状态</h2><blockquote><p>四种状态</p></blockquote><p>版本控制就是对文件的版本控制，要对文件进行修改、提交等操作，首先要知道文件当前在什么状态，不然可能会提交了现在还不想提交的文件，或者要提交的文件没提交上。</p><ul><li>Untracked: 未跟踪, 此文件在文件夹中, 但并没有加入到git库, 不参与版本控制. 通过<code>git add</code> 状态变为Staged.</li><li>Unmodify: 文件已经入库, 未修改, 即版本库中的文件快照内容与文件夹中完全一致. 这种类型的文件有两种去处, 如果它被修改, 而变为Modified. 如果使用<code>git rm</code>移出版本库, 则成为Untracked文件</li><li>Modified: 文件已修改, 仅仅是修改, 并没有进行其他的操作. 这个文件也有两个去处, 通过<code>git add</code>可进入暂存staged状态, 使用<code>git checkout</code>则丢弃修改过, 返回到unmodify状态, 这个<code>git checkout</code>即从库中取出文件, 覆盖当前修改 !</li><li>Staged: 暂存状态. 执行<code>git commit</code>则将修改同步到库中, 这时库中的文件和本地文件又变为一致, 文件为Unmodify状态. 执行<code>git reset HEAD filename</code>取消暂存, 文件状态为Modified</li></ul><blockquote><p>查看文件状态</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看指定文件状态</span></span><br><span class="line">git status [filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有文件状态</span></span><br><span class="line">git status</span><br></pre></td></tr></table></figure><blockquote><p>忽略文件</p></blockquote><p>有些时候我们不想把某些文件纳入版本控制中，比如数据库文件，临时文件，设计文件等</p><p>在主目录下建立”.gitignore”文件，此文件有如下规则：</p><ol><li>忽略文件中的空行或以井号（#）开始的行将会被忽略。</li><li>可以使用Linux通配符。例如：星号（*）代表任意多个字符，问号（？）代表一个字符，方括号（[abc]）代表可选字符范围，大括号（{string1,string2,…}）代表可选的字符串等。</li><li>如果名称的最前面有一个感叹号（!），表示例外规则，将不被忽略。</li><li>如果名称的最前面是一个路径分隔符（/），表示要忽略的文件在此目录下，而子目录中的文件不忽略。</li><li>如果名称的最后面是一个路径分隔符（/），表示要忽略的是此目录下该名称的子目录，而非文件（默认文件或目录都忽略）。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#为注释</span></span><br><span class="line">*.txt        <span class="comment">#忽略所有 .txt结尾的文件,这样的话上传就不会被选中！</span></span><br><span class="line">!lib.txt     <span class="comment">#但lib.txt除外</span></span><br><span class="line">/temp        <span class="comment">#仅忽略项目根目录下的TODO文件,不包括其它目录temp</span></span><br><span class="line">build/       <span class="comment">#忽略build/目录下的所有文件</span></span><br><span class="line">doc/*.txt    <span class="comment">#会忽略 doc/notes.txt 但不包括 doc/server/arch.txt</span></span><br></pre></td></tr></table></figure><p>后端：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">*.class</span><br><span class="line">*.<span class="built_in">log</span></span><br><span class="line">*.lock</span><br><span class="line"></span><br><span class="line"><span class="comment"># Package File </span></span><br><span class="line">*.jar</span><br><span class="line">*.war</span><br><span class="line">*.ear</span><br><span class="line">target/</span><br><span class="line"></span><br><span class="line">*velocity.log*</span><br><span class="line"></span><br><span class="line"><span class="comment"># STS</span></span><br><span class="line">.apt_generated</span><br><span class="line">.factorypath</span><br><span class="line">.springBeans</span><br><span class="line"></span><br><span class="line"><span class="comment"># IntelliJ IDEA</span></span><br><span class="line">*.iml</span><br><span class="line">*.ipr</span><br><span class="line">*.iws</span><br><span class="line">.idea</span><br><span class="line">.classpath</span><br><span class="line">.project</span><br><span class="line">.settings/</span><br><span class="line">bin/</span><br><span class="line"></span><br><span class="line">*.<span class="built_in">log</span></span><br><span class="line">tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># rebel</span></span><br><span class="line">*rebel.xml*</span><br></pre></td></tr></table></figure><h1 id="使用gitee、GitHub"><a href="#使用gitee、GitHub" class="headerlink" title="使用gitee、GitHub"></a>使用gitee、GitHub</h1><p>首先先生成公钥（终端中）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>查看公钥：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>复制里面的内容。然后在gitee或GitHub中添加公钥：</p><p>在设置中的安全设置中点击SSH公钥，然后将刚才复制的内容粘贴到公钥输入框里，标题可以不用管。点击确定。</p><p>之后就可以创建仓库了。</p><p>创建好仓库后克隆下来改改吧。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> 仓库的url</span><br></pre></td></tr></table></figure><p>然后在该目录下创建一个springboot项目。</p><p>可以直接把克隆的代码拷贝过来。</p><p>再点击锤子按钮（重新构建项目），右上角就会出现这些按钮：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-21%2014.50.11.png" alt="截屏2023-01-21 14.50.11"></p><p>左边一个是提交到本地，右边一个是推送。</p><p>其实可以用这些辅助按钮，也可以直接在命令行中提交：</p><p>命令行提交：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">&quot;第一次提交&quot;</span> <span class="comment"># -m选项代表message，即添加文字描述</span></span><br><span class="line"></span><br><span class="line">git push -f git@gitee.com:yr-zhang/test-git.git main <span class="comment"># 指定仓库和分支</span></span><br></pre></td></tr></table></figure><h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><p>上面是单人工作，如果是多人配合开发：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">git branch <span class="comment"># 查看本地分支</span></span><br><span class="line"></span><br><span class="line">git branch -r <span class="comment"># 查看所有远程分支</span></span><br><span class="line"></span><br><span class="line">git branch dev <span class="comment"># 新建一个叫dev的分支</span></span><br><span class="line"></span><br><span class="line">git checkout -b dev <span class="comment"># 新建dev分支并切换到该分支</span></span><br><span class="line"></span><br><span class="line">git checkout dev <span class="comment"># 切换到dev分支上</span></span><br><span class="line"></span><br><span class="line">git branch -d dev <span class="comment"># 删除dev分支</span></span><br><span class="line"></span><br><span class="line">git branch -f dev C6 <span class="comment"># 将dev分支移动到C6版本位置</span></span><br><span class="line"></span><br><span class="line">git checkout C1 <span class="comment"># 分离HEAD并让HEAD指向C1版本</span></span><br><span class="line"></span><br><span class="line">git merge dev <span class="comment"># 指定将dev分支合并当前分支</span></span><br><span class="line"></span><br><span class="line">git push origin --delete dev <span class="comment"># 删除远程到dev分支</span></span><br><span class="line">git branch -dr dev <span class="comment"># 删除远程到dev分支</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase dev <span class="comment"># 将当前的分支移到dev分支下，一起合并成下一个版本</span></span><br></pre></td></tr></table></figure><p>撤销变更：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset  C2 <span class="comment"># 直接撤销C2</span></span><br><span class="line"></span><br><span class="line">git revert C2 <span class="comment"># 产生一个C2‘，相当于克隆了一个新分支</span></span><br></pre></td></tr></table></figure><p>选择合并：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick C2 C5 C7 <span class="comment"># 只选择 C2 C5 C7 版本合并，产生C2‘-&gt;C5&#x27;-&gt;C7</span></span><br></pre></td></tr></table></figure><h1 id="练习网站"><a href="#练习网站" class="headerlink" title="练习网站"></a>练习网站</h1><p><a href="https://oschina.gitee.io/learn-git-branching/">https://oschina.gitee.io/learn-git-branching/</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java后端 </tag>
            
            <tag> Mac </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven 安装配置</title>
      <link href="/posts/1470079886.html"/>
      <url>/posts/1470079886.html</url>
      
        <content type="html"><![CDATA[<h1 id="下载-Maven"><a href="#下载-Maven" class="headerlink" title="下载 Maven"></a>下载 Maven</h1><p>在 maven 官网下载，直接搜索 maven 就行，链接：<a href="https://maven.apache.org">https://maven.apache.org</a></p><p>选择左侧 Download，点击进去，找到 Files，选择 Link 下面的 zip 文件下载即可。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/zhang07130711/blog-img/%E6%88%AA%E5%B1%8F2023-01-18%2017.31.37.png" alt="截屏2023-01-18 17.31.37"></p><h1 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h1><p>首先把 maven 放到固定的位置中，以后不要动了，如过要移动也要去改配置文件。</p><p>我先把下载解压后的 maven 放在了<code>/usr/local/devTools</code>下。Windows可以放在一个固定的地方。</p><p>Windows 直接就在设置中找到高级系统设置-》系统属性-〉环境变量-》新建</p><p>新建之后变量名为：MAVEN_HOME</p><p>变量值为 maven 所在路径。</p><p>之后再点击 Path，再点新建，添加：%MAVEN_HOME%\bin</p><hr><p>下面主要讲 Mac。</p><p>打开<code>~/bash_profile</code>配置环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure><p>编辑环境变量：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MAVEN_HOME=/opt/devTools/apache-maven-4.0.0-alpha-3 <span class="comment"># 整个maven的路径</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$MAVEN_HOME</span>/bin</span><br></pre></td></tr></table></figure><p>下面的设置都在：<code>/opt/devTools/apache-maven-4.0.0-alpha-3/conf/settings.xml</code>中。也就是 maven 目录下的大 conf 下的 settings.xml 文件下</p><p>Mac 下可以不用配置 Maven 的仓库位置，默认为：<code>Default: $&#123;user.home&#125;/.m2/repository</code>这也就是/Users/你的用户名/.m2/repository</p><p>我配置在：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/usr/local/devTools/apache-maven-4.0.0-alpha-3/repo<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h1 id="配置仓库镜像源："><a href="#配置仓库镜像源：" class="headerlink" title="配置仓库镜像源："></a>配置仓库镜像源：</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun public<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/central<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-spring<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun spring<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-spring-plugin<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun spring-plugin<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring-plugin<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-apache-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun apache-snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/apache-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-google<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun google<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/google<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-gradle-plugin<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun gradle-plugin<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/gradle-plugin<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-jcenter<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun jcenter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/jcenter<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun releases<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-grails-core<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun grails-core<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/grails-core<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-mapr-public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun mapr-public<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/mapr-public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我只配置了：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中千万要切记一点<code>&lt;mirrorof&gt;&lt;/mirrorof&gt;</code> 里面千万不能配置<em>号，如果不配置 </em> ，假设 aliyun maven 没有的话就会去国外仓库下载，如果配置了 *号 ，那阿里云仓库没有，就会报错.</p><hr><h1 id="配置-jdk17"><a href="#配置-jdk17" class="headerlink" title="配置 jdk17"></a>配置 jdk17</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-17<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>17<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="在-IDEA-中设置"><a href="#在-IDEA-中设置" class="headerlink" title="在 IDEA 中设置"></a>在 IDEA 中设置</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/YongRuiZhang/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2017.14.07.png" alt="截屏2023-01-19 17.14.07"></p><p>配置 IDEA 在没有网的情况下也可以创建 maven 工程：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/YongRuiZhang/blog-img/%E6%88%AA%E5%B1%8F2023-01-19%2017.42.33.png" alt="截屏2023-01-19 17.42.33"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> 后端 </category>
          
          <category> 编程环境 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java后端 </tag>
            
            <tag> Mac </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Homebrew</title>
      <link href="/posts/1470079885.html"/>
      <url>/posts/1470079885.html</url>
      
        <content type="html"><![CDATA[<h1 id="安装脚本"><a href="#安装脚本" class="headerlink" title="安装脚本"></a>安装脚本</h1><p>（推荐） 完全体 安装两分钟左右：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><p>精简版：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)</span>&quot;</span> speed</span><br></pre></td></tr></table></figure><p>安装完成后输入<code>brew -v</code>遇到问题：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fatal: detected dubious ownership <span class="keyword">in</span> repository at <span class="string">&#x27;/opt/homebrew/Library/Taps/homebrew/homebrew-core&#x27;</span></span><br><span class="line">To add an exception <span class="keyword">for</span> this directory, call:</span><br><span class="line"></span><br><span class="line">git config --global --add safe.directory /opt/homebrew/Library/Taps/homebrew/homebrew-core</span><br><span class="line">Homebrew/homebrew-core (no Git repository)</span><br><span class="line">fatal: detected dubious ownership <span class="keyword">in</span> repository at <span class="string">&#x27;/opt/homebrew/Library/Taps/homebrew/homebrew-cask&#x27;</span></span><br><span class="line">To add an exception <span class="keyword">for</span> this directory, call:</span><br><span class="line"></span><br><span class="line">git config --global --add safe.directory /opt/homebrew/Library/Taps/homebrew/homebrew-cask</span><br><span class="line">Homebrew/homebrew-cask (no Git repository)</span><br></pre></td></tr></table></figure><p>解决办法（根据提示，执行命令）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --add safe.directory /opt/homebrew/Library/Taps/homebrew/homebrew-core</span><br><span class="line">git config --global --add safe.directory /opt/homebrew/Library/Taps/homebrew/homebrew-cask</span><br></pre></td></tr></table></figure><h1 id="卸载脚本"><a href="#卸载脚本" class="headerlink" title="卸载脚本"></a>卸载脚本</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/HomebrewUninstall.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>查找：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew search git</span><br></pre></td></tr></table></figure><p>下载：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install git</span><br></pre></td></tr></table></figure><p>重新下载；</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew reinstall git</span><br></pre></td></tr></table></figure><p>卸载：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew uninstall git</span><br></pre></td></tr></table></figure><h1 id="ohmyzsh"><a href="#ohmyzsh" class="headerlink" title="ohmyzsh"></a>ohmyzsh</h1><p>我尝试了官网的命令下载，不行，链接不上主机。</p><p>下载 oh-my-zsh 的下载命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh</span><br></pre></td></tr></table></figure><p>添加可执行权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x install.sh</span><br></pre></td></tr></table></figure><p>执行 install.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./install.sh</span><br></pre></td></tr></table></figure><p>修改配置：</p><ul><li><p>环境变量：</p><p>将第二排的 # 号删就可以加载原本配置在 bash 中的环境了。当然还可以在后面加两行，更保险：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure></li><li><p>主题：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=<span class="string">&quot;robbyrussell&quot;</span></span><br></pre></td></tr></table></figure><p>改为：</p><p>可以在 oh-my-zsh 官网点击 themes 跳转查看各种主题。</p><p>我比较喜欢：jonathan</p><p>大家一般推荐：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME=<span class="string">&quot;ys&quot;</span></span><br></pre></td></tr></table></figure><p>当然也可以选择 powerlevel10k，但是要配置很多东西，我也不太喜欢，即没弄。</p></li><li><p>修改插件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins=(git)</span><br></pre></td></tr></table></figure><p>改为（添加代码高亮和代码建议）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins=(git zsh-syntx-highlighting zsh-autosuggestions)</span><br></pre></td></tr></table></figure><p>如果 not found：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure><p>最后</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> 资源下载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac环境变量配置文件</title>
      <link href="/posts/1470079884.html"/>
      <url>/posts/1470079884.html</url>
      
        <content type="html"><![CDATA[<h1 id="Mac-下的环境变量配置文件"><a href="#Mac-下的环境变量配置文件" class="headerlink" title="Mac 下的环境变量配置文件"></a>Mac 下的环境变量配置文件</h1><ul><li>/etc/paths</li><li>/etc/profile</li><li>~/.bash_profile</li><li>~/.bash_login</li><li>~/.profile</li><li>~/.bashrc</li></ul><p>​ 前两个时系统级别的配置文件，后面四个时用户级别。</p><p>加载顺序：从上到下；但是如果～/.bash_profile 文件存在，那么后面三个就会被忽略。其中～/.bashrc 是当 bash shell 被打开是才加载，其他的都是系统启动后就加载了。</p><p>如过环境变量在 zsh shell 环境下无效（只在 bash shell 下有效），则可以在～/.zshenv 或者~/.zshrc 文件中添加命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><p>​ 打开 zsh shell 时会顺序加载/.zshenv、~/.zshrc 文件，添加这两条命令就会去调用外部脚本文件。</p><blockquote><p>综上，一般配置环境变量在~/.bash_profile 中就好了。</p></blockquote><h1 id="查看-macOS-全部环境变量"><a href="#查看-macOS-全部环境变量" class="headerlink" title="查看 macOS 全部环境变量"></a>查看 macOS 全部环境变量</h1><p>输入命令<code>export</code>就可以查看全部的环境变量</p><h1 id="配置环境变量的语句"><a href="#配置环境变量的语句" class="headerlink" title="配置环境变量的语句"></a>配置环境变量的语句</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=<span class="string">&quot;/路径&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line"></span><br><span class="line">PATH=<span class="string">&quot;.:.<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH</span><br></pre></td></tr></table></figure><p>​ 其中是先给一个变量赋值，再暴露出去，<code>$变量名</code>是引用变量内容。</p><p>当然，也可以直接：<code>export JAVA_HOME=&quot;/路径&quot;</code></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Mac </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mac </tag>
            
            <tag> 环境变量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>first test</title>
      <link href="/posts/1410315814.html"/>
      <url>/posts/1410315814.html</url>
      
        <content type="html"><![CDATA[<h1 id="标题一"><a href="#标题一" class="headerlink" title="标题一"></a>标题一</h1><blockquote><p>引用</p></blockquote><pre><code>引用内容</code></pre><ul><li>无序列表 1</li><li>无序列表 2</li><li>无序列表 3</li></ul><ol><li>有序列表 1</li><li>有序列表 2</li><li>有序列表 3</li></ol><p>基本代码块：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello My Blog! 你好，我的博客&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="标题二"><a href="#标题二" class="headerlink" title="标题二"></a>标题二</h1><h2 id="长代码块"><a href="#长代码块" class="headerlink" title="长代码块"></a>长代码块</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="宽代码块"><a href="#宽代码块" class="headerlink" title="宽代码块"></a>宽代码块</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>; cout &lt;&lt; <span class="string">&quot;Hello&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="复合代码块"><a href="#复合代码块" class="headerlink" title="复合代码块"></a>复合代码块</h2><p>以 Hello World 为例，不同语言的代码风格：</p><div class="tabs" id="helloworld"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#helloworld-1">c++</button></li><li class="tab"><button type="button" data-href="#helloworld-2">java</button></li><li class="tab"><button type="button" data-href="#helloworld-3">javascript</button></li><li class="tab"><button type="button" data-href="#helloworld-4">python</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="helloworld-1"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello World1!&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="helloworld-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="helloworld-3"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consle.<span class="title function_">log</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="helloworld-4"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1 id="Echarts"><a href="#Echarts" class="headerlink" title="Echarts"></a>Echarts</h1>    <div id="echarts3133" style="width: 100%;height: 400px;margin: 0 auto"></div>    <script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/dist/echarts.min.js"></script>    <script type="text/javascript">            var myChart = echarts.init(document.getElementById('echarts3133'));            // 指定图表的配置项和数据var option = {    title: {        text: 'ECharts 标签示例'    },    tooltip: {},    legend: {        data:['销量']    },    xAxis: {        data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]    },    yAxis: {},    series: [{        name: '销量',        type: 'bar',        data: [5, 20, 36, 10, 10, 20]    }]};            myChart.setOption(option);    </script>    ]]></content>
      
      
      <categories>
          
          <category> 杂七杂八 </category>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试 </tag>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
