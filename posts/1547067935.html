<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>HDFS | 秋白's Blog</title><meta name="author" content="秋白"><meta name="copyright" content="秋白"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="分布式文件系统">
<meta property="og:type" content="article">
<meta property="og:title" content="HDFS">
<meta property="og:url" content="http://yongruizhang.cn/posts/1547067935.html">
<meta property="og:site_name" content="秋白&#39;s Blog">
<meta property="og:description" content="分布式文件系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://th.bing.com/th/id/OIP.pyCJhEElTwE2DtLJoh_yGgHaHa?pid=ImgDet&rs=1">
<meta property="article:published_time" content="2023-05-14T08:11:58.000Z">
<meta property="article:modified_time" content="2023-11-06T14:57:39.987Z">
<meta property="article:author" content="秋白">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="Hadoop">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://th.bing.com/th/id/OIP.pyCJhEElTwE2DtLJoh_yGgHaHa?pid=ImgDet&rs=1"><link rel="shortcut icon" href="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/favicon.png"><link rel="canonical" href="http://yongruizhang.cn/posts/1547067935.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HDFS',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-06 22:57:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/twikoo1.css"><link rel="stylesheet" href="/css/footer1.css"><link rel="apple-touch-icon" href="/img/favicon.jpeg"><meta name="apple-mobile-web-app-title" content="秋白's Blog"><link rel="bookmark" href="/img/favicon.jpeg"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/favicon.jpeg" ><link rel="stylesheet" href="/css/footer_bg.css"><link rel="stylesheet" href="/css/nav1.css"><meta name="baidu-site-verification" content="codeva-qQP2iZOMLX" /><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/favicon.png" onerror="onerror=null;src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">60</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-regular fa-folder-open"></i><span> 找文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-envelope-open-text"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://th.bing.com/th/id/R.67b8d60d5faaeee5cb59b61461b08abf?rik=JeauDyAkLPTTGw&amp;riu=http%3a%2f%2fdeepdivetechblog.com%2fwp-content%2fuploads%2f2019%2f04%2fhadoop-hdfs-logo.jpg&amp;ehk=oQhlm0BD14KUpx2fan5ULxi13YTF5ng8rRQySfEhG1o%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0')"><nav id="nav"><span id="blog-info"><a href="/" title="秋白's Blog"><img class="site-icon" src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/favicon.png"/><span class="site-name">秋白's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-regular fa-folder-open"></i><span> 找文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-solid fa-envelope-open-text"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">HDFS</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-14T08:11:58.000Z" title="发表于 2023-05-14 16:11:58">2023-05-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-06T14:57:39.987Z" title="更新于 2023-11-06 22:57:39">2023-11-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/">大数据开发</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/">Hadoop</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91/Hadoop/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="HDFS"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post" style="background: white; backdrop-filter: blur(5px); opacity: 0.98"><article class="post-content" id="article-container"><details>此笔记是我学习 B站 尚硅谷相关课程的学习笔记</details>

<blockquote>
<p><strong>项目源码：</strong><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/YongRuiZhang/hadoop_study_demo">https://github.com/YongRuiZhang/hadoop_study_demo</a></p>
</blockquote>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>HDFS（Hadoop Distributed File System），它是一个<strong>文件系统</strong>，用于存储文件，通过目录树来定位文件；其次，它是分布式的，由很多服务器联合起来实现其功能，集群中的服务器有各自的角色。 </p>
<p>HDFS 的使用场景：适合一次写入，多次读出的场景。一个文件经过创建、写入和关闭 之后就不需要改变。</p>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>高容错<ul>
<li>数据自动保存多个副本。</li>
<li>某一个副本丢失以后，它可以自动恢复。</li>
</ul>
</li>
<li>适合处理海量数据<ul>
<li>数据规模：能够处理数据规模达到GB、TB、甚至PB级别的数据；</li>
<li>文件规模：能够处理百万规模以上的文件数量</li>
</ul>
</li>
<li>可构建的廉价的机器上，通过多副本机制，提高可靠性。</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>不适合低延时数据访问，比如毫秒级的存储结构（MySQL）</li>
<li>无法高效的对大量的小文件进行存储<ul>
<li>存储大量小文件的话，它会占用NameNode大量的内存来存储文件目录和块信息。这样试试不可取的，因为NameNode的内存总是有限的</li>
<li>小文件存储的寻址时间会超过读取时间，它违反了HDFS的设计目标</li>
</ul>
</li>
<li>不支持并发写入、文件随机修改<ul>
<li>一个文件只能由一个写，不允许多个线程同时写</li>
<li>仅支持数据append（追加），不支持文件的随机修改</li>
</ul>
</li>
</ol>
<h2 id="组成架构"><a href="#组成架构" class="headerlink" title="组成架构"></a>组成架构</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816095921419.png" alt="image-20220816095921419" style="zoom:67%;" /></p>
<ol>
<li><p>NameNode（nn）：就是Master，它 是一个主管、管理者。 </p>
<ol>
<li>管理HDFS的名称空间； </li>
<li>配置副本策略； </li>
<li>管理数据块（Block）映射信息； </li>
<li>处理客户端读写请求。 </li>
</ol>
</li>
<li><p>DataNode：就是Slave。NameNode 下达命令，DataNode执行实际的操作。 </p>
<ol>
<li>存储实际的数据块； </li>
<li>执行数据块的读/写操作。</li>
</ol>
</li>
<li><p>Client：就是客户端。 （网页和命令都是客户端，可以操作数据的端口）</p>
<ol>
<li>文件切分。文件上传HDFS的时候，Client将文件切分成一个一个的Block，然后进行上传； </li>
<li>与NameNode交互，获取文件的位置信息； </li>
<li>与DataNode交互，读取或者写入数据； </li>
<li>Client提供一些命令来管理HDFS，比如NameNode格式化； </li>
<li>Client可以通过一些命令来访问HDFS，比如对HDFS增删查改操作；</li>
</ol>
</li>
<li><p>Secondary NameNode：并非NameNode的热备。当NameNode挂掉的时候，它并不 能马上替换NameNode并提供服务。 </p>
<ol>
<li>辅助NameNode，分担其工作量，比如定期合并Fsimage和Edits，并推送给NameNode ； </li>
<li>在紧急情况下，可辅助恢复NameNode。但是只能恢复一部分数据，因为Secondary NameNode毕竟是老板的秘书，知道的信息没有老板多。</li>
</ol>
</li>
</ol>
<h2 id="HDFS文件块大小"><a href="#HDFS文件块大小" class="headerlink" title="HDFS文件块大小"></a>HDFS文件块大小</h2><p>这部分是面试重点。</p>
<p>HDFS中的文件在物理上是分块存储（Block），块的大小可以通过配置参数 (dfs.blocksize)来规定，默认大小在Hadoop2.x/3.x版本中是128M，1.x版本中是64M。</p>
<p>思考：为什么块的大小不能设置太小，也不能设置太大？ </p>
<p>答案：</p>
<ol>
<li>HDFS的块设置太小，会增加寻址时间，程序一直在找块的开始位置； </li>
<li>如果块设置的太大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间。导致程序在处理这块数据时，会非常慢。 </li>
</ol>
<p>总结：HDFS块的大小设置主要取决于磁盘传输速率。</p>
<h1 id="HDFS的Shell操作"><a href="#HDFS的Shell操作" class="headerlink" title="HDFS的Shell操作"></a>HDFS的Shell操作</h1><p> <strong><span style="font-size:30px">开发重点</span></strong> </p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>如果 没有配置环境变量 就在<code>$HADOOP_HOME/bin</code>下使用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs 具体命令</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">hdfs dfs 具体命令</span><br></pre></td></tr></table></figure>
<p><strong> 两者完全一样 </strong>，根据习惯使用就行了，涉及的具体命令也都是一模一样的。</p>
<h2 id="命令大全"><a href="#命令大全" class="headerlink" title="命令大全"></a>命令大全</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816112527249.png" alt="image-20220816112527249"></p>
<blockquote>
<p>整体分为两类：</p>
<ul>
<li>HDFS和服务器之间的数据操作<ul>
<li>上传（服务器上的文件送到HDFS上去）</li>
<li>下载（HDFS上的文件下载到服务器）</li>
</ul>
</li>
<li>HDFS自己的数据操作<ul>
<li>基本是就是linux的文件操作，大致一模一样</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="常用命令实操"><a href="#常用命令实操" class="headerlink" title="常用命令实操"></a>常用命令实操</h2><h3 id="1、准备工作"><a href="#1、准备工作" class="headerlink" title="1、准备工作"></a>1、准备工作</h3><ol>
<li><p>启动Hadoop集群（方便后续的测试工作）</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 <span class="variable">$HADOOP_HOME</span>下：</span></span><br><span class="line">sbin/start-dfs.sh</span><br><span class="line">sbin/start-yarn.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在任意路径下：</span></span><br><span class="line">myhadoop.sh start</span><br></pre></td></tr></table></figure>
<p> 现在学HDFS只启动HDFS就行，可以不用启动Yarn。</p>
</li>
<li><p>使用-help命令，输出命令的参数等</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdaoop fs -help rm</span><br></pre></td></tr></table></figure>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816121624315.png" alt="image-20220816121624315"></p>
</li>
<li><p>打开web端<br>先尝试自己能否打开这些端口，能否使用Hadoop的web端：<a href="/posts/4130790367.html" title="hadoop常用端口号">hadoop常用端口号</a>。<br>现在需要使用的是9870端口，即访问： <a target="_blank" rel="noopener external nofollow noreferrer" href="http://hadoop103:9870">http://hadoop103:9870</a><br>进入之后点击顶部菜单的 Utilities &gt; Browse the file system</p>
</li>
<li><p>创建一个<code>/sanguo</code>文件夹</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /sanguo</span><br></pre></td></tr></table></figure>
<p> 注意：要让创建的文件夹归HDFS管就要使用HDFS的命令来生成</p>
<p> 效果：</p>
<p> web端：</p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816202233983.png" alt="image-20220816202233983"></p>
<p> 命令行端：</p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816202357293.png" alt="image-20220816202357293"></p>
<p> 注意两者都是客户端。</p>
</li>
</ol>
<h3 id="2、上传"><a href="#2、上传" class="headerlink" title="2、上传"></a>2、上传</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#`-moveFromLocal`"><code>-moveFromLocal</code></a></td>
<td>从本地<strong>剪切粘贴</strong>到 HDFS（move，也就是移动，移动之后本地就没有了）</td>
</tr>
<tr>
<td><a href="#`-copyFromLocal`"><code>-copyFromLocal</code></a></td>
<td>从本地文件系统中<strong>拷贝</strong>文件到 HDFS 路径去（拷贝之后本地还有）</td>
</tr>
<tr>
<td><a href="#`-put`"><code>-put</code></a></td>
<td>等同于 <code>-copyFromLocal</code>，生产环境更习惯用 <code>-put</code>（简洁啊，少打字）</td>
</tr>
<tr>
<td><a href="#`-appendToFile`"><code>-appendToFile</code></a></td>
<td>追加一个文件到<strong>已经存在</strong>的文件<strong>末尾</strong></td>
</tr>
</tbody>
</table>
</div>
<p>命令可点击跳转</p>
<h4 id="moveFromLocal"><a href="#moveFromLocal" class="headerlink" title="-moveFromLocal"></a><code>-moveFromLocal</code></h4><p>从本地剪切粘贴到 HDFS（移动，移动之后本地就没有了）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim shuguo.txt   # 创建一个文件用来上传</span><br><span class="line">写入内容:shuguo	  # 蜀国</span><br><span class="line"></span><br><span class="line">hadoop fs -moveFromLocal ./shuguo.txt /sanguo</span><br><span class="line">命令名     从本地移动		待移动的文件	 移动的目标位置</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816202954368.png" alt="image-20220816202954368"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816203036181.png" alt="image-20220816203036181"></p>
<h4 id="copyFromLocal"><a href="#copyFromLocal" class="headerlink" title="-copyFromLocal"></a><code>-copyFromLocal</code></h4><p>从本地文件系统中<strong>拷贝</strong>文件到 HDFS 路径去（拷贝之后本地还有）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim weiguo.txt  # 创建一个文件用来上传</span><br><span class="line">写入内容：weiguo    # 魏国</span><br><span class="line"></span><br><span class="line">hadoop fs -copyFromLocal ./weiguo.txt /sanguo</span><br><span class="line">命令名		从本地拷贝		待拷贝的文件名 拷贝到的地方</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816203845165.png" alt="image-20220816203845165"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816204027291.png" alt="image-20220816204027291"></p>
<h4 id="put"><a href="#put" class="headerlink" title="-put"></a><code>-put</code></h4><p>等同于 <code>-copyFromLocal</code>，生产环境更习惯用 <code>-put</code>（简洁啊，少打字）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim wuguo.txt  # 创建一个文件用来上传</span><br><span class="line">写入内容：wuguo		# 吴国</span><br><span class="line"></span><br><span class="line">hadoop fs -put 			 ./weiguo.txt /sanguo</span><br><span class="line">命令名		从本地拷贝		待拷贝的文件名 拷贝到的地方</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816204327371.png" alt="image-20220816204327371"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816204437112.png" alt="image-20220816204437112"></p>
<h4 id="appendToFile"><a href="#appendToFile" class="headerlink" title="-appendToFile"></a><code>-appendToFile</code></h4><p>追加一个文件到已经存在的文件末尾.</p>
<p>这个用得少。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim liubei.txt # 创建一个文件用于演示</span><br><span class="line">输入内容：liubei		# 刘备</span><br><span class="line"></span><br><span class="line">hadoop fs -appendToFile ./liubei.txt /sanguo/shuguo.txt</span><br><span class="line">命令名		追加到文件		待追加的文件	接收追加的文件</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816205633423.png" alt="image-20220816205633423"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816205451689.png" alt="image-20220816205451689"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816205333123.png" alt="image-20220816205333123" style="zoom: 50%;" /></p>
<h3 id="3、下载"><a href="#3、下载" class="headerlink" title="3、下载"></a>3、下载</h3><div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#`-copyToLocal`"><code>-copyToLocal</code></a></td>
<td>从 HDFS <strong>拷贝</strong>到<strong>本地</strong></td>
</tr>
<tr>
<td><a href="#`-get`"><code>-get</code></a></td>
<td>等同于 <code>-copyToLocal</code>，生产环境更习惯用 <code>-get</code>（还是因为简洁）</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p> 因为蜀国是移动到HDFS上的（-moveFormLocal）所以本地是没有蜀国的，接下来的例子就演示下载蜀国。</p>
</blockquote>
<h4 id="copyToLocal"><a href="#copyToLocal" class="headerlink" title="-copyToLocal"></a><code>-copyToLocal</code></h4><p>从 HDFS 拷贝到本地</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -copyToLocal /sanguo/shuguo.txt ./</span><br><span class="line">命令名		拷贝到本地	  拷贝的位置			  下载的位置</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816211709438.png" alt="image-20220816211709438"></p>
<h4 id="get"><a href="#get" class="headerlink" title="-get"></a><code>-get</code></h4><p>等同于 <code>-copyToLocal</code>，生产环境更习惯用 <code>-get</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -get 		   /sanguo/shuguo.txt ./shuguo2.txt</span><br><span class="line">命令名		拷贝到本地	  拷贝的位置			  下载的位置</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816211813714.png" alt="image-20220816211813714"></p>
<h3 id="4、HDFS直接操作（Linux上也有的命令）"><a href="#4、HDFS直接操作（Linux上也有的命令）" class="headerlink" title="4、HDFS直接操作（Linux上也有的命令）"></a>4、HDFS直接操作（Linux上也有的命令）</h3><blockquote>
<p>也就是直接操作HDFS上的文件。上传和下载都是服务器本地和HDFS之间的操作。</p>
</blockquote>
<p>基本上和Linux命令一样。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-ls</code></td>
<td>显示目录信息</td>
</tr>
<tr>
<td><code>-cat</code></td>
<td>显示文件内容</td>
</tr>
<tr>
<td><code>-chgrp</code>、<code>-chmod</code>、<code>-chown</code></td>
<td>修改文件所属权限</td>
</tr>
<tr>
<td><code>-mkdir</code></td>
<td>创建路径</td>
</tr>
<tr>
<td><code>-cp</code></td>
<td>从 HDFS 的一个路径拷贝到 HDFS 的另一个路径</td>
</tr>
<tr>
<td><code>-mv</code></td>
<td>在 HDFS 目录中移动文件</td>
</tr>
<tr>
<td><code>-tail</code></td>
<td>显示一个文件的末尾 <strong> 1kb </strong> 的数据</td>
</tr>
<tr>
<td><code>-rm</code></td>
<td>删除文件或文件夹</td>
</tr>
<tr>
<td><code>-rm -r</code></td>
<td>递归删除目录及目录里面内容</td>
</tr>
<tr>
<td><code>-du</code></td>
<td>统计文件夹的大小信息</td>
</tr>
<tr>
<td><code>setrep</code></td>
<td>设置 HDFS 中文件的副本数量</td>
</tr>
</tbody>
</table>
</div>
<h4 id="ls："><a href="#ls：" class="headerlink" title="-ls："></a><code>-ls</code>：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /sanguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816211946705.png" alt="image-20220816211946705"></p>
<h4 id="cat："><a href="#cat：" class="headerlink" title="-cat："></a><code>-cat</code>：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -cat /sanguo/shuguo.txt</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816212040418.png" alt="image-20220816212040418"></p>
<h4 id="chmod"><a href="#chmod" class="headerlink" title="-chmod"></a><code>-chmod</code></h4><p>演示一个就够了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -chmod 666 /sanguo/shuguo.txt</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816212210137.png" alt="image-20220816212210137"></p>
<h4 id="mkdir"><a href="#mkdir" class="headerlink" title="-mkdir"></a><code>-mkdir</code></h4><p>前面的sanguo文件夹就是用这个命令传创建的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /jinguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816212443741.png" alt="image-20220816212443741"></p>
<h4 id="cp"><a href="#cp" class="headerlink" title="-cp"></a><code>-cp</code></h4><p>将蜀国拷贝到晋国。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -cp /sanguo/shuguo.txt /jinguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816212647668.png" alt="image-20220816212647668"></p>
<h4 id="mv"><a href="#mv" class="headerlink" title="-mv"></a><code>-mv</code></h4><p>将吴国移动到晋国</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mv /sanguo/wuguo.txt /jinguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816212936529.png" alt="image-20220816212936529"></p>
<h4 id="tail"><a href="#tail" class="headerlink" title="-tail"></a><code>-tail</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -tail /jinguo/shuguo.txt</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816213111666.png" alt="image-20220816213111666"></p>
<h4 id="rm"><a href="#rm" class="headerlink" title="-rm"></a><code>-rm</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -rm /sanguo/shuguo.txt</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816213219315.png" alt="image-20220816213219315"></p>
<h4 id="rm-r"><a href="#rm-r" class="headerlink" title="-rm -r"></a><code>-rm -r</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -rm -r /sanguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816213318272.png" alt="image-20220816213318272"></p>
<h4 id="du"><a href="#du" class="headerlink" title="-du"></a><code>-du</code></h4><p>du的参数选项：</p>
<blockquote>
<ul>
<li>-s或—summarize 仅显示总计。</li>
<li>-h或—human-readable 以K，M，G为单位，提高信息的可读性。</li>
</ul>
</blockquote>
<p>统计文件夹的大小</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -du -s -h /jinguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816213506749.png" alt="image-20220816213506749"></p>
<blockquote>
<p>27表示文件大小</p>
<p>81表示总三个副本：27*3</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -du -h /jinguo</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816213532559.png" alt="image-20220816213532559"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816213803253.png" alt="image-20220816213803253"></p>
<h4 id="setrep"><a href="#setrep" class="headerlink" title="-setrep"></a><code>-setrep</code></h4><p>设置晋国下面的蜀国有10个副本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -setrep 10 /jinguo/shuguo.txt</span><br></pre></td></tr></table></figure>
<p>这里设置的副本数只是记录在 NameNode 的元数据中，是否真的会有这么多副本，还得看 DataNode 的数量。因为目前只有 3 台设备，最多也就 3 个副本，只有节点数的增加到 10 台时，副本数才能达到 10。</p>
<p>如果只有一个副本，是谁还得学到后面才知道。</p>
<h1 id="HDFS的API操作"><a href="#HDFS的API操作" class="headerlink" title="HDFS的API操作"></a>HDFS的API操作</h1><blockquote>
<p> 目的是想要在windows中通过api操作HDFS。在Mac中使用API操作一样步骤，但是可以不获取winutils，不用配置winutils环境。</p>
<p> <strong>使用时一定要保证集群时启动的</strong></p>
<p> 注意如果Hadoop的版本是2.x的话会有一定差异（<strong>尤其是端口号</strong>），注意Hadoop版本。</p>
</blockquote>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><ol>
<li><p>获取依赖包</p>
<p> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kontext-tech/winutils">https://github.com/kontext-tech/winutils</a></p>
</li>
<li><p>将依赖包放到<strong>无中文的目录</strong></p>
</li>
<li><p>配置环境变量（类似于配置Windows中的JDK）</p>
</li>
</ol>
<h2 id="在IDEA中做准备工作"><a href="#在IDEA中做准备工作" class="headerlink" title="在IDEA中做准备工作"></a>在IDEA中做准备工作</h2><ol>
<li>创建maven项目</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220816221537811.png" alt="image-20220816221537811" style="zoom:50%;" /></p>
<ol>
<li>引入hadoop-client的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>版本不是和winutils的版本，<strong>是Linux中的Hadoop版本</strong>。</p>
<p>为了打印日志等其他功能，总共引入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>src/main/resources</code>目录下新建一个文件，命名为：“log4j.properties”在文件中填入：</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">INFO, stdout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br><span class="line"><span class="attr">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.File</span>=<span class="string">target/spring.log</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>创建包<code>com.zhang.hdfs</code></p>
</li>
<li><p>创建<code>HdfsClient</code>类</p>
<p> 客户端代码常用套路（最满足的就是HDFS和ZooKeeper）：</p>
<ol>
<li>获取一个客户端对象</li>
<li>执行相关的操作命令</li>
<li><p>关闭资源</p>
<p><strong>接下来写一个创建目录的函数。</strong></p>
<p>注意要连接的URI：</p>
</li>
</ol>
<ul>
<li><p>我们在hdfs-site.xml中设置了打开namenode web端的网址：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102:9870<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  这个网址就只是namenode web端的网址</p>
</li>
<li><p>我们在core-site.xml中设置了namenode的地址，这个地址才是真正的 namenode 的URI，我们就是要访问这个URI：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HdfsClient</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMkdirs</span><span class="params">()</span> <span class="keyword">throws</span> IOException, URISyntaxException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 连接集群的NameNode地址</span></span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020&quot;</span>);</span><br><span class="line">        <span class="comment">// 配置文件</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="comment">// 用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;zyr&quot;</span>;</span><br><span class="line">        <span class="comment">// 1. 获取到客户端对象</span></span><br><span class="line">        <span class="type">FileSystem</span> <span class="variable">fileSystem</span> <span class="operator">=</span> FileSystem.get(uri, configuration, user);</span><br><span class="line">        <span class="comment">// 2. 创建一给文件夹 西游 下面一个 花果山</span></span><br><span class="line">        fileSystem.mkdirs(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/xiyou/huaguoshan&quot;</span>)); <span class="comment">// 注意参数是一个Path对象，创建对象，用构造函数赋值</span></span><br><span class="line">        <span class="comment">// 3. 关闭资源</span></span><br><span class="line">        fileSystem.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意使用的包,知道那几个是要用hadoop的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<pre><code>效果：

![image-20220817094651701](https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817094651701.png)
</code></pre><ol>
<li><p>由于有大量相同操作，所以我们可以做一次封装，把获取一个客户端对象和关闭资源封装起来</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HdfsClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FileSystem fileSystem;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> URISyntaxException, IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 连接集群的NameNode地址</span></span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020&quot;</span>);</span><br><span class="line">        <span class="comment">// 配置文件</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        <span class="comment">// 用户</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;zyr&quot;</span>;</span><br><span class="line">        <span class="comment">// 1. 获取到客户端对象</span></span><br><span class="line">        fileSystem = FileSystem.get(uri, configuration, user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 3. 关闭资源</span></span><br><span class="line">        fileSystem.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMkdirs</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 创建一给文件夹 西游 下面一个 花果山</span></span><br><span class="line">        fileSystem.mkdirs(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/xiyou/huaguoshan1&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 效果：</p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817095950022.png" alt="image-20220817095950022"></p>
</li>
</ol>
<h2 id="参数优先级"><a href="#参数优先级" class="headerlink" title="参数优先级"></a>参数优先级</h2><p>参数优先级排序：客户端代码中设置的值 &gt; ClassPath 下的用户自定义配置文件 &gt; 然后是服务器的自定义配置（xxx-site.xml）&gt; 服务器的默认配置（xxx-default.xml）</p>
<p>客户端代码中设置的值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> URISyntaxException, IOException, InterruptedException &#123;</span><br><span class="line">    <span class="comment">// 连接集群的NameNode地址</span></span><br><span class="line">    <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;hdfs://hadoop102:8020&quot;</span>);</span><br><span class="line">    <span class="comment">// 配置文件</span></span><br><span class="line">    <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">    configuration.set(<span class="string">&quot;dfs.replication&quot;</span>,<span class="string">&quot;2&quot;</span>);<span class="comment">//设置副本数为2</span></span><br><span class="line">    <span class="comment">// 用户</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;zyr&quot;</span>;</span><br><span class="line">    <span class="comment">// 1. 获取到客户端对象</span></span><br><span class="line">    fileSystem = FileSystem.get(uri, configuration, user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ClassPath 下的用户自定义配置文件：</p>
<p>在<code>src/main/resources</code>下创建hdfs-site.xml文件，写入配置（设置副本数为1）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>服务器也就是Ubuntu中的Hadoop配置文件了。我们写的xxx-site.xml，优先级比xxx-defalut.xml高。</p>
<h2 id="进行HDFS的API操作"><a href="#进行HDFS的API操作" class="headerlink" title="进行HDFS的API操作"></a>进行HDFS的API操作</h2><h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><p><code>copyFromLocalFile()</code>：参数一：是否删除原数据，参数二：是否允许覆盖，参数三：源数据路径（Win），参数四：目的地路径（HDFS）</p>
<hr>
<p>在windows的E盘创建一个文本文件，sunwukong，写入sunwukong，用来测试上传。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPut</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：是否删除原数据，参数二：是否允许覆盖，参数三：源数据路径（Win），参数四：目的地路径（HDFS）</span></span><br><span class="line">    fileSystem.copyFromLocalFile(<span class="literal">false</span>,<span class="literal">false</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;E:\\sunwukong.txt&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;hdfs://hadoop102/xiyou/huaguoshan&quot;</span>) );<span class="comment">//加不加协议头都无所谓，实际开发不加，直接写/xiyou/huaguoshan</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p> 如果已经存在了文件，就会报错，因为第二个参数是false，表示不能覆盖，所以就上传不上去，就会报错 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817102854602.png" alt="image-20220817102854602"></p>
<p>因为第一个参数时false，表示不删除原数据，所以原数据还在：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817102905963.png" alt="image-20220817102905963"></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><code>copyToLocalFile()</code>：参数一：是否删除原数据，参数二：源数据路径（HDFS），参数三：目的地路径（Win）,参数四：是否本地校验</p>
<hr>
<p>删掉本地的sunwukong.txxt，来测试下载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试下载</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 参数一：是否删除原数据，参数二：源数据路径（HDFS），参数三：目的地路径（Win）,参数四：是否本地校验</span></span><br><span class="line">        fileSystem.copyToLocalFile(<span class="literal">false</span>,<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/xiyou/huaguoshan&quot;</span>),<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;E:\\sunwukong.txt&quot;</span>),<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p>生成的是文件夹：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817105805791.png" alt="image-20220817105805791" style="zoom:50%;" /></p>
<p>文件夹中内容：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817105822929.png" alt="image-20220817105822929" style="zoom:50%;" /></p>
<p>sunwukong.txt中内容是一样的。。sunwukong.txt.crc是校验文件的工具。</p>
<p> 如果第四个参数为true，就不会产生.sunwukong.txt.crc文件 </p>
<p>第四个参数一般都不使用。</p>
<h3 id="直接操作"><a href="#直接操作" class="headerlink" title="直接操作"></a>直接操作</h3><h4 id="文件删除"><a href="#文件删除" class="headerlink" title="文件删除"></a>文件删除</h4><p><code>delete()</code>：参数一：三处文件的地址，参数二：是否递归删除</p>
<hr>
<p>删除一个文件（不用递归）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文件删除</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：三处文件的地址，参数二：是否递归删除</span></span><br><span class="line">    fileSystem.delete(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/jinguo/wuguo.txt&quot;</span>),<span class="literal">false</span>); <span class="comment">// 一个文件，用不用递归都一样</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>删除一个目录（非空目录用递归（否则报错）、空目录（用不用递归都无所谓））</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试文件删除</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：三处文件的地址，参数二：是否递归删除</span></span><br><span class="line">    fileSystem.delete(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/jinguo&quot;</span>),<span class="literal">true</span>); <span class="comment">// 一个文件，用不用递归都一样</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="文件的更名和移动"><a href="#文件的更名和移动" class="headerlink" title="文件的更名和移动"></a>文件的更名和移动</h4><p><code>rename</code>：参数一：原文件路径，参数二：目标文件路径</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 文件的移动和更名</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testmv</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 参数一：原文件路径，参数二：目标文件路径</span></span><br><span class="line">        <span class="comment">// 文件的更名</span></span><br><span class="line"><span class="comment">//        fileSystem.rename(new Path(&quot;/xiyou/huaguoshan/sunwukong.txt&quot;),</span></span><br><span class="line"><span class="comment">//                new Path(&quot;/xiyou/huaguoshan/qitiandasheng.txt&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 文件移动和更名，又要移动，又要更名</span></span><br><span class="line"><span class="comment">//        fileSystem.rename(new Path(&quot;/input/word.txt&quot;),new Path(&quot;/word_mv.txt&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 目录的更名</span></span><br><span class="line">        fileSystem.rename(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/input&quot;</span>), <span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/output&quot;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取文件详情查看"><a href="#获取文件详情查看" class="headerlink" title="获取文件详情查看"></a>获取文件详情查看</h4><p><code>listFiles</code>：参数一：查看的路径，参数二：是否递归。返回一个迭代器</p>
<hr>
<p>相当于<code>-ls</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取文件详细信息</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fileDetail</span> <span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 参数一：查看的路径，参数二：是否递归。返回一个迭代器</span></span><br><span class="line">    RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fileSystem.listFiles(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 遍历文件</span></span><br><span class="line">    <span class="keyword">while</span> (listFiles.hasNext()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">        <span class="type">LocatedFileStatus</span> <span class="variable">fileStatus</span> <span class="operator">=</span> listFiles.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;Path : &quot;</span> + fileStatus.getPath());</span><br><span class="line">        System.out.println(<span class="string">&quot;Name : &quot;</span> + fileStatus.getPath().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Permission : &quot;</span> + fileStatus.getPermission());</span><br><span class="line">        System.out.println(<span class="string">&quot;Owner : &quot;</span> + fileStatus.getOwner());</span><br><span class="line">        System.out.println(<span class="string">&quot;Group : &quot;</span> + fileStatus.getGroup());</span><br><span class="line">        System.out.println(<span class="string">&quot;Len : &quot;</span> + fileStatus.getLen());</span><br><span class="line">        System.out.println(<span class="string">&quot;ModificationTime : &quot;</span> + fileStatus.getModificationTime());</span><br><span class="line">        System.out.println(<span class="string">&quot;Replication : &quot;</span> + fileStatus.getReplication());</span><br><span class="line">        System.out.println(<span class="string">&quot;BlockSize : &quot;</span> + fileStatus.getBlockSize());</span><br><span class="line">        <span class="comment">// 获取块信息</span></span><br><span class="line">        BlockLocation[] blockLocations = fileStatus.getBlockLocations();</span><br><span class="line">        System.out.println(Arrays.toString(blockLocations));</span><br><span class="line">        System.out.println(<span class="string">&quot;===============================================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果（输出）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">===============================================</span><br><span class="line">Path : hdfs:<span class="comment">//hadoop102:8020/word_mv.txt</span></span><br><span class="line">Name : word_mv.txt</span><br><span class="line">Permission : rw-r--r--</span><br><span class="line">Owner : zyr</span><br><span class="line">Group : zyr</span><br><span class="line">Len : <span class="number">12</span></span><br><span class="line">ModificationTime : <span class="number">1660706721280</span></span><br><span class="line">Replication : <span class="number">3</span></span><br><span class="line">BlockSize : <span class="number">134217728</span></span><br><span class="line">[<span class="number">0</span>,<span class="number">12</span>,hadoop104,hadoop103,hadoop103]</span><br><span class="line">===============================================</span><br><span class="line">===============================================</span><br><span class="line">Path : hdfs:<span class="comment">//hadoop102:8020/xiyou/huaguoshan/qitiandasheng.txt</span></span><br><span class="line">Name : qitiandasheng.txt</span><br><span class="line">Permission : rw-r--r--</span><br><span class="line">Owner : zyr</span><br><span class="line">Group : zyr</span><br><span class="line">Len : <span class="number">9</span></span><br><span class="line">ModificationTime : <span class="number">1660703296473</span></span><br><span class="line">Replication : <span class="number">3</span></span><br><span class="line">BlockSize : <span class="number">134217728</span></span><br><span class="line">[<span class="number">0</span>,<span class="number">9</span>,hadoop104,hadoop103,hadoop103]</span><br><span class="line">===============================================</span><br></pre></td></tr></table></figure>
<h4 id="文件和文件夹判断"><a href="#文件和文件夹判断" class="headerlink" title="文件和文件夹判断"></a>文件和文件夹判断</h4><p><code>listStatus</code>：参数一：路径</p>
<hr>
<p>判断目录下那些事文件夹那些事文件。</p>
<p>每一个对象都是<code>FileStatus</code>，上面的<code>listFiles()</code>得到的迭代器中的对象是<code>LocatedFileStatus</code>。方法都一样，上面也能判断是否是文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是文件夹还是文件</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    FileStatus[] listStatus = fileSystem.listStatus(<span class="keyword">new</span> <span class="title class_">Path</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">    <span class="keyword">for</span> (FileStatus status : listStatus) &#123;</span><br><span class="line">        <span class="keyword">if</span> (status.isFile()) &#123;</span><br><span class="line">            System.out.println(status.getPath().getName() + <span class="string">&quot;是一个文件&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(status.getPath().getName() + <span class="string">&quot;是一个目录&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果（输出）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output是一个目录</span><br><span class="line">tmp是一个目录</span><br><span class="line">word_mv.txt是一个文件</span><br><span class="line">xiyou是一个目录</span><br></pre></td></tr></table></figure>
<h1 id="HDFS的读写流程（面试重点）"><a href="#HDFS的读写流程（面试重点）" class="headerlink" title="HDFS的读写流程（面试重点）"></a>HDFS的读写流程（面试重点）</h1><h2 id="HDFS写数据流程"><a href="#HDFS写数据流程" class="headerlink" title="HDFS写数据流程"></a>HDFS写数据流程</h2><h3 id="剖析文件写入"><a href="#剖析文件写入" class="headerlink" title="剖析文件写入"></a>剖析文件写入</h3><blockquote>
<p>写数据就是客户端想要向HDFS上传文件的过程。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817160253882.png" alt="image-20220817160253882"></p>
<ol>
<li><p>客户端想要上传文件先创建一个Distributed FileSystem（分布式文件系统）模块向NameNode请求上传文件</p>
</li>
<li><p>NameNode检查目录树是否可以创建文件，可以上传文件就响应给客户端说可以上传文件</p>
<ol>
<li>检查权限是否满足</li>
<li>检查目录结构看目录是否存在</li>
</ol>
</li>
<li><p>客户端请求上传第一个Block（0-128M），请求返回DataNode节点用来储存数据</p>
</li>
<li><p>NameNode接收请求返回n个（副本数）DataNode节点（我们这里是三个，因为有三台服务器）（dn1,dn2,dn3）</p>
<p> 副本节点选择顺序</p>
<ol>
<li>本地节点</li>
<li>其他机架一个节点 （机架之后再讲）</li>
<li>其他机架另一个节点</li>
</ol>
</li>
<li><p>客户端接收到响应回来的节点，创建<code>FSDataOutputStream</code>输出流流对象，之后就请求建立Bolck通道。这个请求会向第3步返回的节点发送，并且只会往一个（dn1）里发送，这一个（dn1）通过了，由这一个向后面的节点（dn2）继续发送（有点串行的感觉）</p>
<p> 就是：客户端—&gt;dn1—&gt;dn2—&gt;dn3</p>
</li>
<li><p>最后一个节点（dn3）搜到请求建立好了Bolck通道之后就会响应，向发送给它请求的节点（dn2）响应，一层一层直到客户端</p>
<p> 就是：dn3—&gt;dn2—&gt;dn1—&gt;客户端</p>
</li>
<li><p>客户端收到响应后，开始往 dn1 上传第一个 Block（先从磁盘读取数据放到一个本地内存缓存）， 以 Packet 为单位，dn1 收到一个 Packet 就会传给 dn2，dn2 传给 dn3；dn1 每传一个 packet 会放入一个应答队列等待应答。</p>
</li>
<li><p>当一个 Block 传输完成之后，客户端再次请求 NameNode 上传第二个 Block 的服务器。（重复执行 3-7 步）。</p>
</li>
</ol>
<h3 id="网络拓扑——节点距离计算"><a href="#网络拓扑——节点距离计算" class="headerlink" title="网络拓扑——节点距离计算"></a>网络拓扑——节点距离计算</h3><blockquote>
<p>在 HDFS 写数据的过程中，NameNode 会选择距离待上传数据最近距离的 DataNode 接收数据。那么这个最近距离怎么计算呢？</p>
</blockquote>
<p> 节点距离：两个节点到达<strong>最近</strong>的<strong>共同祖先</strong>的<strong>距离总和</strong>。 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817154322485.png" alt="image-20220817154322485"></p>
<ul>
<li>Distance(/d1/r1/n0,/d1/r1/n0)=0 ： 因为本来就是同一个节点</li>
<li>Distance(/d1/r1/n1,/d1/r1/n2)=2 ： 因为这两个不是同一个节点，都往上找发现机架r1是这两个节点最近的共同祖先。/d1/r1/n1距离这个公共祖先的距离为1，/d1/r1/n2距离这个公祖先的距离为1，所以距离总和为2</li>
<li>Distance(/d1/r2/n0,/d1/r3/n2)=4 ： 因为这两个不是同一个节点，都往上找发现集群d1是这两个节点最近的共同祖先。/d1/r2/n0距离这个公共祖先的距离为2，/d1/r3/n2距离这个公祖先的距离为2，所以距离总和为4</li>
<li>Distance(/d1/r2/n1,/d2/r4/n1)=6 ： 因为这两个不是同一个节点，都往上找发现根节点是这两个节点最近的共同祖先。/d1/r2/n1距离这个公共祖先的距离为3，/d2/r4/n1距离这个公祖先的距离为3，所以距离总和为6</li>
</ul>
<h3 id="机架感知——副本存储节点选择"><a href="#机架感知——副本存储节点选择" class="headerlink" title="机架感知——副本存储节点选择"></a>机架感知——副本存储节点选择</h3><ol>
<li><p>机架感知说明</p>
<p> 官方说明：</p>
 <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">For the common case, when the replication factor is three, HDFS’s placement policy is to put one replica on the local machine if the writer is on a datanode, otherwise on a random datanode, another replica on a node in a different (remote) rack, and the last on a different node in the same remote rack. This policy cuts the inter-rack write traffic which generally improves write performance. The chance of rack failure is far less than that of node failure; this policy does not impact data reliability and availability guarantees. However, it does reduce the aggregate network bandwidth used when reading data since a block is placed in only two unique racks rather than three. With this policy, the replicas of a file do not evenly distribute across the racks. One third of replicas are on one node, two thirds of replicas are on one rack, and the other third are evenly distributed across the remaining racks. This policy improves write performance without compromising data reliability or read performance.</span><br></pre></td></tr></table></figure>
<p> 翻译：</p>
 <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于常见情况，当复制系数为3时，HDFS的放置策略是，如果编写器位于DataNode上，则将一个副本放在本地计算机上，否则放在随机DataNode上，将另一个副本放在不同(远程)机架中的节点上，最后将最后一个副本放在同一远程机架中的不同节点上。此策略减少了机架间写入流量，这通常会提高写入性能。机架故障的可能性远远小于节点故障的可能性；此策略不会影响数据可靠性和可用性保证。但是，它确实减少了读取数据时使用的聚合网络带宽，因为一个数据块只放置在两个唯一的机架中，而不是三个。使用此策略时，文件的副本不会在机架上均匀分布。三分之一的副本位于一个节点上，三分之二的副本位于一个机架上，另外三分之一均匀分布在其余机架上。此策略可在不影响数据可靠性或读取性能的情况下提高写入性能。</span><br></pre></td></tr></table></figure>
</li>
<li><p>副本节点选择</p>
<p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817155622663.png" alt="image-20220817155622663"></p>
<ol>
<li>第一个副本保证效率，所以存在客户端所处的节点上（如果客户端再集群中）。如果客户端不在集群中根本就不知道客户端再哪一个节点上，选择任何一个节点的效率都差不多，所以就随机选一个节点</li>
<li>第二个副本保证可靠性，不和第一份节点存在同一个机架上，只要是另一个机架就行，随机选一个节点</li>
<li><p>第三个副本又要保证效率，就随机存在第二个副本所在的机架的随机另一个节点就可以了</p>
<p><strong>存到同一个机架的效率比存到另一个机架效率更高</strong></p>
</li>
</ol>
</li>
</ol>
<h2 id="HDFS读数据流程"><a href="#HDFS读数据流程" class="headerlink" title="HDFS读数据流程"></a>HDFS读数据流程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817160320155.png" alt="image-20220817160320155"></p>
<ol>
<li>客户端先请求读数据，先创建DistributedFileSystem（分布式文件系统）向NameNode发送请求，请求下载文件。</li>
<li>NameNode先检查是否满足权限，再通过查找元数据，找到文件块所在的DataNode地址，返回该文件块的DataNode节点位置给客户端</li>
<li>客户端拿到DataNode节点地址后，创建<code>FSDataInputStream</code>输入数据流，之后向元数据中的DataNode发送请求，请求读入数据，也是分块拿。选择读取的DataNode顺序和写入一样。</li>
<li>节点收到请求，返回数据给客户端</li>
<li>如果前面的DataNode由于访问量过大，就可以先去访问其他DataNode节点。实际上还是串行不是并行</li>
<li>后面的节点接收到请求，响应数据给客户端</li>
</ol>
<h1 id="NameNode-和-SecondaryNameNode"><a href="#NameNode-和-SecondaryNameNode" class="headerlink" title="NameNode 和 SecondaryNameNode"></a>NameNode 和 SecondaryNameNode</h1><blockquote>
<p>NameNode 简称 NN 或 nn</p>
<p>SecondaryNamdeNode 简称 2NN 或 2nn</p>
</blockquote>
<h2 id="NN-和-2NN-工作机制"><a href="#NN-和-2NN-工作机制" class="headerlink" title="NN 和 2NN 工作机制"></a>NN 和 2NN 工作机制</h2><p> 思考：NameNode 中的元数据是存储在哪里的？ </p>
<blockquote>
<p>首先，我们做个假设，如果存储在 NameNode 节点的磁盘中，因为经常需要进行随机访问，还有响应客户请求，必然是效率过低。因此，<strong>元数据需要存放在内存中</strong>。</p>
<p>但如果<strong>只存在</strong>内存中，一旦断电，元数据丢失，整个集群就无法工作了。因此产生在<strong>磁盘</strong>中<strong>备份</strong>元数据的<strong>FsImage</strong>。 </p>
<p>这样又会带来新的问题，当在内存中的元数据更新时，如果同时更新 FsImage，就会导致效率过低，但如果不更新，就会发生一致性问题，一旦 NameNode 节点断电，就会产生数据丢失。因此，引入 Edits 文件（只进行追加操作，效率很高）。每当元数据有更新或者添加元数据时，修改内存中的元数据并追加到 Edits 中。这样，一旦 NameNode 节点断电，可以通过 FsImage 和 Edits 的合并，合成元数据。</p>
<p>但是，如果长时间添加数据到 Edits 中，会导致该文件数据过大，效率降低，而且一旦断电，恢复元数据需要的时间过长。因此，需要定期进行 FsImage 和 Edits 的合并，如果这 个操作由NameNode节点完成，又会效率过低。因此，引入一个新的节点SecondaryNamenode， 专门用于 FsImage 和 Edits 的合并。</p>
</blockquote>
<p>总结：数据存在内存中。为了安全产生FsImage，为了更新FsImage引入Edits文件。通过FsImage和Edits的合并可以合成元数据。但避免恢复元数据效率慢，引入SecondaryNameNode来定期进行FsImage和Edits的合并。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817161904373.png" alt="image-20220817161904373"></p>
<h3 id="第一阶段：NameNode启动"><a href="#第一阶段：NameNode启动" class="headerlink" title="第一阶段：NameNode启动"></a>第一阶段：NameNode启动</h3><ol>
<li>第一次启动 NameNode 格式化后，创建 Fsimage 和 Edits 文件。如果不是第一次启动，直接加载编辑日志和镜像文件到内存。</li>
<li>客户端对元数据进行增删改的请求。</li>
<li>NameNode 记录操作日志，更新滚动日志。</li>
<li>NameNode 在内存中对元数据进行增删改。</li>
</ol>
<h3 id="第二阶段：SecondaryNameNode工作"><a href="#第二阶段：SecondaryNameNode工作" class="headerlink" title="第二阶段：SecondaryNameNode工作"></a>第二阶段：SecondaryNameNode工作</h3><ol>
<li>Secondary NameNode 询问 NameNode 是否需要 CheckPoint。直接带回 NameNode 是否检查结果。</li>
<li>Secondary NameNode 请求执行 CheckPoint。</li>
<li>NameNode 滚动正在写的 Edits 日志</li>
<li>将滚动前的编辑日志和镜像文件拷贝到 Secondary NameNode。</li>
<li>Secondary NameNode 加载编辑日志和镜像文件到内存，并合并。</li>
<li>生成新的镜像文件 fsimage.chkpoint。</li>
<li>拷贝 fsimage.chkpoint 到 NameNode。</li>
<li>NameNode 将 fsimage.chkpoint 重新命名成 fsimage。</li>
</ol>
<h2 id="FsImage-和-Edits-解析"><a href="#FsImage-和-Edits-解析" class="headerlink" title="FsImage 和 Edits 解析"></a>FsImage 和 Edits 解析</h2><p>NameNode被格式化之后，将在<code>/usr/local/hadoop/data/dfs/name/current</code>目录中产生如下文件</p>
<p>​                            fsimage_0000000000000000000</p>
<p>​                            fsimage_0000000000000000000.md5</p>
<p>​                            seen_txid</p>
<p>​                            VERSION</p>
<ol>
<li><p>FsImage文件：HDFS文件系统元数据的一个<strong>永久性的检查点</strong>，其中包含HDFS文件系统的所有目录和文件inode的序列化信息。 </p>
</li>
<li><p>Edits文件：存放HDFS文件系统的所有更新操作的<strong>路径</strong>，文件系统客户端执行的所有写操作首先会被记录到Edits文件中。 </p>
</li>
<li><p>seen<em>txid文件保存的是一个<strong>数字</strong>，就是最后一个edits</em>的数字 </p>
</li>
<li><p>每次NameNode启动的时候都会将FsImage文件读入内存，加载Edits里面的更新操作，保证内存中的元数据信息是<strong>最新的、同步的</strong>，可以看成NameNode启动的时候就将FsImage和Edits文件进行了合并。</p>
</li>
</ol>
<h3 id="oiv-查看-FsImage-文件"><a href="#oiv-查看-FsImage-文件" class="headerlink" title="oiv 查看 FsImage 文件"></a>oiv 查看 FsImage 文件</h3><ul>
<li><p>基本语法</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oiv -p 转换后的文件类型 -i 镜像文件 -o 转换后文件输出路径（即保存路径）</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例实操</p>
<p>  再<code>/usr/local/hadoop/data/dfs/name/current</code>目录下：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oiv -p XML -i fsimage_0000000000000000125 -o /usr/local/hadoop/fsimage.xml</span><br></pre></td></tr></table></figure>
<p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817164247588.png" alt="image-20220817164247588"></p>
<p>  通过Xftp将文件传到Windows，将这个xml文件内容拷贝到IDEA中创建的xml文件中，并格式化（不格式化也能看懂，只是乱七八糟的不太好看）。</p>
<p>  内容太多，就不粘贴了。在可以看出来里面执行了写什么操作。</p>
<blockquote>
<p>思考：可以看出，Fsimage 中没有记录块所对应 DataNode，为什么？ </p>
<p>在集群启动后，要求 DataNode 上报数据块信息，并间隔一段时间后再次上报。</p>
</blockquote>
</li>
</ul>
<h3 id="oev-查看-Edits-文件"><a href="#oev-查看-Edits-文件" class="headerlink" title="oev 查看 Edits 文件"></a>oev 查看 Edits 文件</h3><ul>
<li><p>基本语法</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oev -p 转换后的文件类型 -i 编辑日志 -o 转化后文件输出路径（保存地址）</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例实操</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs oev -p XML -i edits_inprogress_0000000000000000128 -o  /usr/local/hadoop/edits.xml</span><br></pre></td></tr></table></figure>
<p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817173235373.png" alt="image-20220817173235373"></p>
<p>  看了xml之后得出结论， Edits是对文件做追加操作 </p>
<blockquote>
<p>思考：NameNode 如何确定下次开机启动的时候合并哪些 Edits？</p>
<p>合并大于127的因为：fsimage_0000000000000000127，最后的fsimage是127的。</p>
<p>所以下一次就是合并：edits_inprogress_0000000000000000128，其他的edits已经合并过了</p>
<p>edits_inprogress_0000000000000000128这个就是现在最新的操作数据。唯一比SecondaryNameNode多的文件</p>
</blockquote>
</li>
</ul>
<h2 id="CheckPoint-时间设置"><a href="#CheckPoint-时间设置" class="headerlink" title="CheckPoint 时间设置"></a>CheckPoint 时间设置</h2><ul>
<li><p>通常情况下，SecondaryNameNode 每隔一小时执行一次。</p>
<p>  因为：hdfs-defaule.xml中：(一般都不会配置这个，所以通常就是3600s)</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.period<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>3600s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817174042498.png" alt="image-20220817174042498" style="zoom: 67%;" /></p>
<p>  可以看出来，除了关闭服务器之外，两次备份实际上就是间隔3600s也就是1h。</p>
</li>
<li><p>一分钟检查一次操作次数，当操作次数达到1百万是，SecondaryNameNode执行一次（我们数据量没有那么大）</p>
<p>  hdfs-defaule.xml中：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.checkpoint.txns<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1000000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h1><h2 id="DataNode-工作机制"><a href="#DataNode-工作机制" class="headerlink" title="DataNode 工作机制"></a>DataNode 工作机制</h2><p>  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817174352584.png" alt="image-20220817174352584"></p>
</li>
</ul>
<ol>
<li><p>一个数据块在 DataNode 上以<strong>文件形式</strong>存储在<strong>磁盘</strong>上，包括两个文件：</p>
<ul>
<li>一个是数据本身</li>
<li>一个是元数据包括数据块的长度，块数据的校验和，以及时间戳。</li>
</ul>
</li>
<li><p>DataNode 启动后向 NameNode 注册，通过后，周期性（6 小时）地向 NameNode <strong>上报</strong>所有的块信息。</p>
<p> 配置在hdfs-default.xml中：</p>
<p> DN 扫描自己节点块信息列表的时间，默认 6 小时</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.directoryscan.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>21600s<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> DN 向 NN 汇报当前解读信息的时间间隔，默认 6 小时；</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.blockreport.intervalMsec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>21600000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>心跳是每 3 秒一次，心跳返回结果带有 NameNode 给该 DataNode 的命令如复制 块数据 到另一台机器，或删除某个 数据块 。<a href="#掉线时限参数有关设置">如果超过 10 分钟没有收到某个 DataNode 的心跳， 则 NameNode 认为该节点已不可用。</a></p>
<p> 心跳主要是为了证明还存活，周期性的交互（不会像第2步那样传那么多信息）</p>
</li>
<li><p>集群运行中可以安全加入和退出一些机器。</p>
</li>
</ol>
<h2 id="数据完整性"><a href="#数据完整性" class="headerlink" title="数据完整性"></a>数据完整性</h2><blockquote>
<p>思考：如果电脑磁盘里面存储的数据是控制高铁信号灯的红灯信号（1）和绿灯信号（0）， 但是存储该数据的磁盘坏了，一直显示是绿灯，是否很危险？同理 DataNode 节点上的数据 损坏了，却没有发现，是否也很危险，那么如何解决呢？</p>
</blockquote>
<p>DataNode保证数据完整性的方法：</p>
<ol>
<li>当 DataNode 读取 Block 的时候，它会计算 CheckSum。 </li>
<li>如果计算后的 CheckSum，与 Block 创建时值不一样，说明 Block 已经损坏。 </li>
<li>Client 读取其他 DataNode 上的 Block。 </li>
<li>常见的校验算法 crc（32），md5（128），sha1（160） —— 都是些加密算法，原理是先保存数据，然后加密发过去，之后再解密看看数据是不是一样。数据不一样就是第2步</li>
<li>DataNode 在其文件创建后周期验证 CheckSum。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817175610441.png" alt="image-20220817175610441"></p>
<h2 id="掉线时限参数有关设置"><a href="#掉线时限参数有关设置" class="headerlink" title="掉线时限参数有关设置"></a>掉线时限参数有关设置</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/image-20220817180207789.png" alt="image-20220817180207789"></p>
<blockquote>
<p>需要注意的是 hdfs-site.xml 配置文件中的 heartbeat.recheck.interval （超时时长） 的单位为毫秒， dfs.heartbeat.interval （心跳间隔时间）的单位为秒。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.heartbeat.recheck-interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>300000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.heartbeat.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li><p>HDFS文件块大小（面试重点）</p>
<ul>
<li>硬盘读写速度</li>
<li>在企业中  一般128m（中小公司）   256m （大公司）</li>
</ul>
</li>
<li><p>HDFS的Shell操作（开发重点）</p>
<p> 熟悉相关命令就行，不然开发速度不够</p>
</li>
<li><p>HDFS的读写流程（面试重点）</p>
</li>
<li><p>NN和2NN、DataNode有关东西了解就好</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://yongruizhang.cn">YongRui Zhang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yongruizhang.cn/posts/1547067935.html">http://yongruizhang.cn/posts/1547067935.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yongruizhang.cn" target="_blank">秋白's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><a class="post-meta__tags" href="/tags/Hadoop/">Hadoop</a><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="https://th.bing.com/th/id/OIP.pyCJhEElTwE2DtLJoh_yGgHaHa?pid=ImgDet&amp;rs=1" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/weixin.jpeg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/weixin.jpeg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/alipay.jpeg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/alipay.jpeg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1767336200.html" title="Yarn"><img class="cover" src="https://www.leixue.com/uploads/2020/09/Apache-Hadoop-YARN.png!760" onerror="onerror=null;src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Yarn</div></div></a></div><div class="next-post pull-right"><a href="/posts/778231993.html" title="搭建Redis集群"><img class="cover" src="https://tse2-mm.cn.bing.net/th/id/OIP-C.tZ5YbghLPGHA_d-pW41eLQHaEf?pid=ImgDet&amp;rs=1" onerror="onerror=null;src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">搭建Redis集群</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/3156194925.html" title="MapReduce"><img class="cover" src="https://th.bing.com/th/id/R.d60c7923a45b06826278a8d3fa6cd1cc?rik=N6M9fQqCw7Ijsg&riu=http%3a%2f%2ferrequeerre.es%2fwp-content%2fuploads%2f2017%2f08%2fHadoop-Map-Reduce.png&ehk=4zYF4J3scSG5mcQ%2fFQqylAoWYreGhEr7IFpmCu8lXnc%3d&risl=&pid=ImgRaw&r=0" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-14</div><div class="title">MapReduce</div></div></a></div><div><a href="/posts/1767336200.html" title="Yarn"><img class="cover" src="https://www.leixue.com/uploads/2020/09/Apache-Hadoop-YARN.png!760" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-14</div><div class="title">Yarn</div></div></a></div><div><a href="/posts/4130790367.html" title="hadoop常用端口号"><img class="cover" src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/Big-Data-Hadoop.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-29</div><div class="title">hadoop常用端口号</div></div></a></div><div><a href="/posts/4177218757.html" title="hadoop集群搭建指南"><img class="cover" src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/hadoop_2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-29</div><div class="title">hadoop集群搭建指南</div></div></a></div><div><a href="/posts/1817748743.html" title="搭建HBase集群"><img class="cover" src="https://www.wenjiangs.com/wp-content/uploads/2020/03/hbase.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-25</div><div class="title">搭建HBase集群</div></div></a></div><div><a href="/posts/1141628095.html" title="搭建Hadoop环境"><img class="cover" src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/hadoop.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-28</div><div class="title">搭建Hadoop环境</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/favicon.png" onerror="this.onerror=null;this.src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">秋白</div><div class="author-info__description">埋头学习 抬头恋爱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">100</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">60</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">68</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/yongruizhang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yongruizhang" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:yongruizhang@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/367319940?spm_id_from=333.337.0.0" rel="external nofollow noreferrer" target="_blank" title="bilibili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p style="text-indent:2em;">我是数据科学与大数据专业本科生。<br/></p><p style="text-indent:2em;">目前主要学习AR、CV、大数据开发，数学建模，机器学习，算法。之前浅学过Java后端，有一点前端基础。<br/></p><p style="text-indent:2em;">为了您的体验，没有设置复制权限，您可以复制文章内容和代码来做笔记等，但您要发布文章请注明内容出处，请遵循开源原则🤝</p><p style="text-indent:2em;">如果文章内容有错误，或者版本等问题拜托在评论区留言，为后来人搭桥。感谢🙏</p><p style="text-indent:2em;">由于我是利用电脑端Safari浏览器写的相关样式，所以不同平台的效果可能不同，不推荐使用手机访问博客（我没怎么适配，可能会有些显示问题）。前端技术有限😅<br/></p></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E6%88%90%E6%9E%B6%E6%9E%84"><span class="toc-text">组成架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS%E6%96%87%E4%BB%B6%E5%9D%97%E5%A4%A7%E5%B0%8F"><span class="toc-text">HDFS文件块大小</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HDFS%E7%9A%84Shell%E6%93%8D%E4%BD%9C"><span class="toc-text">HDFS的Shell操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8"><span class="toc-text">命令大全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%AE%9E%E6%93%8D"><span class="toc-text">常用命令实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">1、准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%8A%E4%BC%A0"><span class="toc-text">2、上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#moveFromLocal"><span class="toc-text">-moveFromLocal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#copyFromLocal"><span class="toc-text">-copyFromLocal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#put"><span class="toc-text">-put</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#appendToFile"><span class="toc-text">-appendToFile</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%B8%8B%E8%BD%BD"><span class="toc-text">3、下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#copyToLocal"><span class="toc-text">-copyToLocal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get"><span class="toc-text">-get</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81HDFS%E7%9B%B4%E6%8E%A5%E6%93%8D%E4%BD%9C%EF%BC%88Linux%E4%B8%8A%E4%B9%9F%E6%9C%89%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%89"><span class="toc-text">4、HDFS直接操作（Linux上也有的命令）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ls%EF%BC%9A"><span class="toc-text">-ls：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cat%EF%BC%9A"><span class="toc-text">-cat：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chmod"><span class="toc-text">-chmod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mkdir"><span class="toc-text">-mkdir</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cp"><span class="toc-text">-cp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mv"><span class="toc-text">-mv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tail"><span class="toc-text">-tail</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rm"><span class="toc-text">-rm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rm-r"><span class="toc-text">-rm -r</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#du"><span class="toc-text">-du</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setrep"><span class="toc-text">-setrep</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HDFS%E7%9A%84API%E6%93%8D%E4%BD%9C"><span class="toc-text">HDFS的API操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">配置环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8IDEA%E4%B8%AD%E5%81%9A%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">在IDEA中做准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">参数优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8CHDFS%E7%9A%84API%E6%93%8D%E4%BD%9C"><span class="toc-text">进行HDFS的API操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0"><span class="toc-text">上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-text">下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%93%8D%E4%BD%9C"><span class="toc-text">直接操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4"><span class="toc-text">文件删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E6%9B%B4%E5%90%8D%E5%92%8C%E7%A7%BB%E5%8A%A8"><span class="toc-text">文件的更名和移动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E8%AF%A6%E6%83%85%E6%9F%A5%E7%9C%8B"><span class="toc-text">获取文件详情查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%92%8C%E6%96%87%E4%BB%B6%E5%A4%B9%E5%88%A4%E6%96%AD"><span class="toc-text">文件和文件夹判断</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HDFS%E7%9A%84%E8%AF%BB%E5%86%99%E6%B5%81%E7%A8%8B%EF%BC%88%E9%9D%A2%E8%AF%95%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-text">HDFS的读写流程（面试重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="toc-text">HDFS写数据流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%96%E6%9E%90%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-text">剖析文件写入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E2%80%94%E2%80%94%E8%8A%82%E7%82%B9%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97"><span class="toc-text">网络拓扑——节点距离计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%BA%E6%9E%B6%E6%84%9F%E7%9F%A5%E2%80%94%E2%80%94%E5%89%AF%E6%9C%AC%E5%AD%98%E5%82%A8%E8%8A%82%E7%82%B9%E9%80%89%E6%8B%A9"><span class="toc-text">机架感知——副本存储节点选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS%E8%AF%BB%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="toc-text">HDFS读数据流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NameNode-%E5%92%8C-SecondaryNameNode"><span class="toc-text">NameNode 和 SecondaryNameNode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NN-%E5%92%8C-2NN-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-text">NN 和 2NN 工作机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9ANameNode%E5%90%AF%E5%8A%A8"><span class="toc-text">第一阶段：NameNode启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%EF%BC%9ASecondaryNameNode%E5%B7%A5%E4%BD%9C"><span class="toc-text">第二阶段：SecondaryNameNode工作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FsImage-%E5%92%8C-Edits-%E8%A7%A3%E6%9E%90"><span class="toc-text">FsImage 和 Edits 解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#oiv-%E6%9F%A5%E7%9C%8B-FsImage-%E6%96%87%E4%BB%B6"><span class="toc-text">oiv 查看 FsImage 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oev-%E6%9F%A5%E7%9C%8B-Edits-%E6%96%87%E4%BB%B6"><span class="toc-text">oev 查看 Edits 文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CheckPoint-%E6%97%B6%E9%97%B4%E8%AE%BE%E7%BD%AE"><span class="toc-text">CheckPoint 时间设置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DataNode"><span class="toc-text">DataNode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DataNode-%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-text">DataNode 工作机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-text">数据完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%89%E7%BA%BF%E6%97%B6%E9%99%90%E5%8F%82%E6%95%B0%E6%9C%89%E5%85%B3%E8%AE%BE%E7%BD%AE"><span class="toc-text">掉线时限参数有关设置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/765481613.html" title="KMP算法"><img src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img101.jpg" onerror="this.onerror=null;this.src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="KMP算法"/></a><div class="content"><a class="title" href="/posts/765481613.html" title="KMP算法">KMP算法</a><time datetime="2023-11-16T12:37:37.000Z" title="发表于 2023-11-16 20:37:37">2023-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1674202625.html" title="Mac下载安装Kettle"><img src="https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/img6.jpg" onerror="this.onerror=null;this.src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="Mac下载安装Kettle"/></a><div class="content"><a class="title" href="/posts/1674202625.html" title="Mac下载安装Kettle">Mac下载安装Kettle</a><time datetime="2023-09-05T13:01:38.000Z" title="发表于 2023-09-05 21:01:38">2023-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/517302816.html" title="搭建Spark环境"><img src="https://crehana-blog.imgix.net/media/filer_public/82/d4/82d4658f-8f16-4179-9f28-4f1e7423a10b/apache-spark-infog.jpg?auto=format&amp;q=50" onerror="this.onerror=null;this.src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="搭建Spark环境"/></a><div class="content"><a class="title" href="/posts/517302816.html" title="搭建Spark环境">搭建Spark环境</a><time datetime="2023-06-20T04:54:56.000Z" title="发表于 2023-06-20 12:54:56">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3292663995.html" title="安装Jupyter并配置主题代码提示等"><img src="https://th.bing.com/th/id/OIP.PYrJLuEyZhNu-y_Qz2nr4wHaJ4?pid=ImgDet&amp;rs=1" onerror="this.onerror=null;this.src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="安装Jupyter并配置主题代码提示等"/></a><div class="content"><a class="title" href="/posts/3292663995.html" title="安装Jupyter并配置主题代码提示等">安装Jupyter并配置主题代码提示等</a><time datetime="2023-06-08T09:22:53.000Z" title="发表于 2023-06-08 17:22:53">2023-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/67485572.html" title="Vue组件化编程"><img src="https://ts1.cn.mm.bing.net/th/id/R-C.7a131031711c74fa64145ef288032dbe?rik=cZtWL1%2fgyDKdhg&amp;riu=http%3a%2f%2fwww.lgwimonday.cn%2fcosyblog%2fwordpress%2fwp-content%2fuploads%2f2019%2f07%2ftimgvue.jpg&amp;ehk=Co5mIoKNa2j55UOcR7sOyNZdvRYGYIlrK2aCMBur1cQ%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0" onerror="this.onerror=null;this.src='https://zyr-blog-image.oss-cn-beijing.aliyuncs.com/img/blog-img-main/404.jpg'" alt="Vue组件化编程"/></a><div class="content"><a class="title" href="/posts/67485572.html" title="Vue组件化编程">Vue组件化编程</a><time datetime="2023-06-01T00:53:13.000Z" title="发表于 2023-06-01 08:53:13">2023-06-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By 秋白</div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/">蜀ICP备2023012316号-1</a><br/>埋头学习 抬头恋爱<br/>本博客为个人博客，内容仅供学习参考<br/>如果文章帮到您了，或者您觉得我比较有趣请给我评论或打赏～</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://blog-comments-phi-eight.vercel.app',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://blog-comments-phi-eight.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async src="https://cdn.jsdelivr.net/gh/zhheo/twikoo@dev/dist/twikoo.all.min.js"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "52b81d8c-40b2-40bc-bd82-3bceb709cf4b";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (true) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>